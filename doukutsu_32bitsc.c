/* This file has been generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2017 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


// Function declarations

#define __thiscall __cdecl // Test compile in C mode

int init_proc();
void _do_global_dtors_aux();
int frame_dummy();
void __cdecl RGB(SDL_Color_0 *retstr, Uint8 r, Uint8 g, Uint8 b);
void InitFlash();
void __cdecl SetFlash(int x, int y, int mode);
void __cdecl ActFlash_Explosion(int flx, int fly);
void ActFlash_Flash();
void __cdecl ActFlash(int flx, int fly);
void PutFlash();
void ResetFlash();
bool __cdecl is_RECT_valid(const RECT *const r, const SDL_Surface_0 *s);
void __cdecl RECT_to_SDL_Rect(SDL_Rect_0 *retstr, const RECT *const src, const SDL_Surface_0 *s);
bool __cdecl Flip_SystemTask(SDL_Surface_0 *screen);
bool __cdecl StartDirectDraw(SDL_Surface_0 *screen, int magnification);
void __cdecl EndDirectDraw();
void __cdecl ReleaseSurface(int s);
bool __cdecl MakeSurface(SDL_RWops_0 *rw, int surf_no);
bool __cdecl MakeSurface_Resource(char *name, int surf_no);
bool __cdecl MakeSurface_File(char *name, int surf_no);
bool __cdecl ReloadBitmap_Resource(char *name, int surf_no);
bool __cdecl ReloadBitmap_File(char *name, int surf_no);
bool __cdecl MakeSurface_Generic(int bxsize, int bysize, int surf_no);
void __cdecl Blit(SDL_Surface_0 *src, const RECT *const srcrect, SDL_Surface_0 *dst, const RECT *const dstrect);
void __cdecl BackupSurface(int surf_no, RECT *rect);
void __cdecl PutBitmap3(RECT *rcView, int x, int y, RECT *rect, int surf_no);
void __cdecl PutBitmap4(RECT *rcView, int x, int y, RECT *rect, int surf_no);
void __cdecl Surface2Surface(int x, int y, RECT *rect, int to, int from);
Uint32 __cdecl GetCortBoxColor(const SDL_Color_0 *const rgb);
void __cdecl Fill(const RECT *const rect, SDL_Surface_0 *surface, Uint32 col);
void __cdecl CortBox(RECT *rect, Uint32 col);
void __cdecl CortBox2(RECT *rect, Uint32 col, int surf);
void __cdecl InitTextObject();
void __cdecl PutTextImpl(int x, int y, const char *text, const SDL_Color_0 *const color, SDL_Surface_0 *surface);
void __cdecl PutText(int x, int y, const char *text, const SDL_Color_0 *const color);
void __cdecl PutText2(int x, int y, const char *text, const SDL_Color_0 *const color, int surf);
void EndTextObject();
void __cdecl ActNpc180(NPCHAR_0 *npc);
void __cdecl ActNpc181(NPCHAR_0 *npc);
void __cdecl ActNpc182(NPCHAR_0 *npc);
void __cdecl ActNpc183(NPCHAR_0 *npc);
void __cdecl ActNpc184(NPCHAR_0 *npc);
void __cdecl ActNpc185(NPCHAR_0 *npc);
void __cdecl ActNpc186(NPCHAR_0 *npc);
void __cdecl ActNpc187(NPCHAR_0 *npc);
void __cdecl ActNpc188(NPCHAR_0 *npc);
void __cdecl ActNpc189(NPCHAR_0 *npc);
void __cdecl ActNpc190(NPCHAR_0 *npc);
void __cdecl ActNpc191(NPCHAR_0 *npc);
void __cdecl ActNpc192(NPCHAR_0 *npc);
void __cdecl ActNpc193(NPCHAR_0 *npc);
void __cdecl ActNpc194(NPCHAR_0 *npc);
void __cdecl ActNpc195(NPCHAR_0 *npc);
void __cdecl ActNpc196(NPCHAR_0 *npc);
void __cdecl ActNpc197(NPCHAR_0 *npc);
void __cdecl ActNpc198(NPCHAR_0 *npc);
void __cdecl ActNpc199(NPCHAR_0 *npc);
void __cdecl RGB(SDL_Color_0 *retstr, Uint8 r, Uint8 g, Uint8 b);
void ActionStripper();
void PutStripper();
void __cdecl SetStripper(int x, int y, char *text, int cast);
void RestoreStripper();
void ActionIllust();
void PutIllust();
void __cdecl ReloadIllust(int a);
void InitCreditScript();
void ReleaseCreditScript();
signed int StartCreditScript();
int __cdecl _GetScriptNumber(char *text);
void _ActionCredit_Read();
void ActionCredit();
void __cdecl SetCreditIllust(int a);
void CutCreditIllust();
signed int __cdecl Scene_DownIsland(SDL_Surface_0 *screen, int mode);
char *__cdecl get_resource(const char *name, int *size);
SDL_RWops_0 *__cdecl open_resource(const char *name);
void ClearValueView();
void __cdecl SetValueView(int *px, int *py, int value);
void ActValueView();
void __cdecl PutValueView(int flx, int fly);
signed int __cdecl Call_Escape(SDL_Surface_0 *screen);
void MoveFrame3();
void __cdecl GetFramePosition(int *fx, int *fy);
void __cdecl SetFramePosition(int fx, int fy);
void SetFrameMyChar();
void __cdecl SetFrameTargetMyChar(int wait);
void __cdecl SetFrameTargetNpChar(int event, int wait);
void __cdecl SetFrameTargetBoss(int no, int wait);
void __cdecl SetQuake(int time);
void __cdecl SetQuake2(int time);
void ResetQuake();
void __cdecl ActNpc340(NPCHAR_0 *npc);
void __cdecl ActNpc341(NPCHAR_0 *npc);
void __cdecl ActNpc342(NPCHAR_0 *npc);
void __cdecl ActNpc343(NPCHAR_0 *npc);
void __cdecl ActNpc344(NPCHAR_0 *npc);
void __cdecl ActNpc345(NPCHAR_0 *npc);
void __cdecl ActNpc346(NPCHAR_0 *npc);
void __cdecl ActNpc347(NPCHAR_0 *npc);
void __cdecl ActNpc348(NPCHAR_0 *npc);
void __cdecl ActNpc349(NPCHAR_0 *npc);
void __cdecl ActNpc350(NPCHAR_0 *npc);
void __cdecl ActNpc351(NPCHAR_0 *npc);
void __cdecl ActNpc352(NPCHAR_0 *npc);
void __cdecl ActNpc353(NPCHAR_0 *npc);
void __cdecl ActNpc354(NPCHAR_0 *npc);
void __cdecl ActNpc355(NPCHAR_0 *npc);
void __cdecl ActNpc356(NPCHAR_0 *npc);
void __cdecl ActNpc357(NPCHAR_0 *npc);
void __cdecl ActNpc358(NPCHAR_0 *npc);
void __cdecl ActNpc359(NPCHAR_0 *npc);
void __cdecl ActNpc360(NPCHAR_0 *npc);
void __cdecl scoped_profile::scoped_profile(scoped_profile *const this, const char *id);
void __cdecl scoped_profile::scoped_profile(scoped_profile *const this, const char *id);
void __cdecl scoped_profile::~scoped_profile(scoped_profile *const this);
void __cdecl scoped_profile::~scoped_profile(scoped_profile *const this);
void __cdecl scoped_profile::~scoped_profile(scoped_profile *const this);
void __cdecl ActNpc300(NPCHAR_0 *npc);
void __cdecl ActNpc301(NPCHAR_0 *npc);
void __cdecl ActNpc302(NPCHAR_0 *npc);
void __cdecl ActNpc303(NPCHAR_0 *npc);
void __cdecl ActNpc304(NPCHAR_0 *npc);
void __cdecl ActNpc305(NPCHAR_0 *npc);
void __cdecl ActNpc306(NPCHAR_0 *npc);
void __cdecl ActNpc307(NPCHAR_0 *npc);
void __cdecl ActNpc308(NPCHAR_0 *npc);
void __cdecl ActNpc309(NPCHAR_0 *npc);
void __cdecl ActNpc310(NPCHAR_0 *npc);
void __cdecl ActNpc311(NPCHAR_0 *npc);
void __cdecl ActNpc312(NPCHAR_0 *npc);
void __cdecl ActNpc313(NPCHAR_0 *npc);
void __cdecl ActNpc314(NPCHAR_0 *npc);
void __cdecl ActNpc315(NPCHAR_0 *npc);
void __cdecl ActNpc316(NPCHAR_0 *npc);
void __cdecl ActNpc317(NPCHAR_0 *npc);
void __cdecl ActNpc318(NPCHAR_0 *npc);
void __cdecl ActNpc319(NPCHAR_0 *npc);
void __cdecl RGB(SDL_Color_0 *retstr, Uint8 r, Uint8 g, Uint8 b);
void InitFade();
void SetFadeMask();
void ClearFade();
void __cdecl StartFadeOut(char dir);
void __cdecl StartFadeIn(char dir);
void ProcFade();
void PutFade();
_BOOL4 GetFadeActive();
void __cdecl ActNpc060(NPCHAR_0 *npc);
void __cdecl ActNpc061(NPCHAR_0 *npc);
void __cdecl ActNpc062(NPCHAR_0 *npc);
void __cdecl ActNpc063(NPCHAR_0 *npc);
void __cdecl ActNpc064(NPCHAR_0 *npc);
void __cdecl ActNpc065(NPCHAR_0 *npc);
void __cdecl ActNpc066(NPCHAR_0 *npc);
void __cdecl ActNpc067(NPCHAR_0 *npc);
void __cdecl ActNpc068(NPCHAR_0 *npc);
void __cdecl ActNpc069(NPCHAR_0 *npc);
void __cdecl ActNpc070(NPCHAR_0 *npc);
void __cdecl ActNpc071(NPCHAR_0 *npc);
void __cdecl ActNpc072(NPCHAR_0 *npc);
void __cdecl ActNpc073(NPCHAR_0 *npc);
void __cdecl ActNpc074(NPCHAR_0 *npc);
void __cdecl ActNpc075(NPCHAR_0 *npc);
void __cdecl ActNpc076(NPCHAR_0 *npc);
void __cdecl ActNpc077(NPCHAR_0 *npc);
void __cdecl ActNpc078(NPCHAR_0 *npc);
void __cdecl ActNpc079(NPCHAR_0 *npc);
void InitMyChar();
void __cdecl AnimationMyChar(bool bKey);
void __cdecl ShowMyChar(bool bShow);
void __cdecl PutMyChar(int fx, int fy);
void __cdecl ActMyChar_Normal(bool bKey);
void __cdecl ActMyChar_Stream(bool bKey);
void AirProcess();
void __cdecl ActMyChar(bool bKey);
void __cdecl GetMyCharPosition(int *x, int *y);
void __cdecl SetMyCharPosition(int x, int y);
void __cdecl MoveMyChar(int x, int y);
void ZeroMyCharXMove();
int GetUnitMyChar();
void __cdecl SetMyCharDirect(unsigned __int8 dir);
void __cdecl ChangeMyUnit(unsigned __int8 a);
void PitMyChar();
void __cdecl EquipItem(int flag, bool b);
void ResetCheck();
void __cdecl SetNoise(int no, int freq);
void CutNoise();
void ResetNoise();
void SleepNoise();
void __cdecl ActNpc320(NPCHAR_0 *npc);
void __cdecl ActNpc321(NPCHAR_0 *npc);
void __cdecl ActNpc322(NPCHAR_0 *npc);
void __cdecl ActNpc323(NPCHAR_0 *npc);
void __cdecl ActNpc324(NPCHAR_0 *npc);
void __cdecl ActNpc325(NPCHAR_0 *npc);
void __cdecl ActNpc326(NPCHAR_0 *npc);
void __cdecl ActNpc327(NPCHAR_0 *npc);
void __cdecl ActNpc328(NPCHAR_0 *npc);
void __cdecl ActNpc329(NPCHAR_0 *npc);
void __cdecl ActNpc330(NPCHAR_0 *npc);
void __cdecl ActNpc331(NPCHAR_0 *npc);
void __cdecl ActNpc332(NPCHAR_0 *npc);
void __cdecl ActNpc333(NPCHAR_0 *npc);
void __cdecl ActNpc334(NPCHAR_0 *npc);
void __cdecl ActNpc335(NPCHAR_0 *npc);
void __cdecl ActNpc336(NPCHAR_0 *npc);
void __cdecl ActNpc337(NPCHAR_0 *npc);
void __cdecl ActNpc338(NPCHAR_0 *npc);
void __cdecl ActNpc339(NPCHAR_0 *npc);
void InitBossLife();
signed int __cdecl StartBossLife(int code_event);
signed int StartBossLife2();
void PutBossLife();
void InitFlags();
void InitSkipFlags();
void __cdecl SetNPCFlag(int a);
void __cdecl CutNPCFlag(int a);
_BOOL4 __cdecl GetNPCFlag(int a);
void __cdecl SetSkipFlag(int a);
void __cdecl CutSkipFlag(int a);
_BOOL4 __cdecl GetSkipFlag(int a);
void __cdecl _ActBossChar_Eye(NPCHAR_0 *npc);
void __cdecl _ActBossChar_Body(NPCHAR_0 *npc);
void __cdecl _ActBossChar_HITAI(NPCHAR_0 *npc);
void __cdecl _ActBossChar_HARA(NPCHAR_0 *npc);
void ActBossChar_Ballos();
void __cdecl ActNpc280(NPCHAR_0 *npc);
void __cdecl ActNpc281(NPCHAR_0 *npc);
void __cdecl ActNpc282(NPCHAR_0 *npc);
void __cdecl ActNpc283(NPCHAR_0 *npc);
void __cdecl ActNpc284(NPCHAR_0 *npc);
void __cdecl ActNpc285(NPCHAR_0 *npc);
void __cdecl ActNpc286(NPCHAR_0 *npc);
void __cdecl ActNpc287(NPCHAR_0 *npc);
void __cdecl ActNpc288(NPCHAR_0 *npc);
void __cdecl ActNpc289(NPCHAR_0 *npc);
void __cdecl ActNpc290(NPCHAR_0 *npc);
void __cdecl ActNpc291(NPCHAR_0 *npc);
void __cdecl ActNpc292();
void __cdecl ActNpc293(NPCHAR_0 *npc);
void __cdecl ActNpc294(NPCHAR_0 *npc);
void __cdecl ActNpc295(NPCHAR_0 *npc);
void __cdecl ActNpc296(NPCHAR_0 *npc);
void __cdecl ActNpc297(NPCHAR_0 *npc);
void __cdecl ActNpc298(NPCHAR_0 *npc);
void __cdecl ActNpc299(NPCHAR_0 *npc);
$C1127D3748787668AAF0293B2D646CFD *__cdecl loadORG(const char *path);
void __cdecl freeORG($C1127D3748787668AAF0293B2D646CFD *org);
void __cdecl playORG($C1127D3748787668AAF0293B2D646CFD *org);
void __cdecl setPlayerFadeout(Uint8 fadeout);
void __cdecl setPlayerVolume(Uint16 volume);
Uint32 __cdecl getORGPosition($C1127D3748787668AAF0293B2D646CFD *org);
void __cdecl setORGPosition($C1127D3748787668AAF0293B2D646CFD *org, Uint32 position);
void stopORG();
int __cdecl _interpolate(Sint16 v1, Sint16 v2, Uint16 f);
void __cdecl _renderDrumWave(Sint32 *buffer, int no, $04553E4401276348CEA0C0E6398A028E *instrument, int len);
void __cdecl _renderOrgWave(Sint32 *buffer, $04553E4401276348CEA0C0E6398A028E *instrument, int len);
void __cdecl org_mixer(void *param, Uint8 *stream, int len);
void initORG();
void quitORG();
void InitStar();
void ActStar();
void __cdecl PutStar(int fx, int fy);
bool __cdecl LoadConfigData($88CD5C1514A19B01CE178CB8EAE44D15 *conf);
void __cdecl map_button($88CD5C1514A19B01CE178CB8EAE44D15 *conf, size_t index, Sint32 action);
void __cdecl DefaultConfigData($88CD5C1514A19B01CE178CB8EAE44D15 *conf);
void __cdecl ActNpc100(NPCHAR_0 *npc);
void __cdecl ActNpc101(NPCHAR_0 *npc);
void __cdecl ActNpc102(NPCHAR_0 *npc);
void __cdecl ActNpc103(NPCHAR_0 *npc);
void __cdecl ActNpc104(NPCHAR_0 *npc);
void __cdecl ActNpc105(NPCHAR_0 *npc);
void __cdecl ActNpc106(NPCHAR_0 *npc);
void __cdecl ActNpc107(NPCHAR_0 *npc);
void __cdecl ActNpc108(NPCHAR_0 *npc);
void __cdecl ActNpc109(NPCHAR_0 *npc);
void __cdecl ActNpc110(NPCHAR_0 *npc);
void __cdecl ActNpc111(NPCHAR_0 *npc);
void __cdecl ActNpc112(NPCHAR_0 *npc);
void __cdecl ActNpc113(NPCHAR_0 *npc);
void __cdecl ActNpc114(NPCHAR_0 *npc);
void __cdecl ActNpc115(NPCHAR_0 *npc);
void __cdecl ActNpc116(NPCHAR_0 *npc);
void __cdecl ActNpc117(NPCHAR_0 *npc);
void __cdecl ActNpc118(NPCHAR_0 *npc);
void __cdecl ActNpc119(NPCHAR_0 *npc);
void ClearPermitStage();
signed int __cdecl AddPermitStage(int index, int event);
signed int __cdecl SubPermitStage(int index);
void MoveStageSelectCursor();
void PutStageSelectObject();
signed int __cdecl StageSelectLoop(int *p_event);
void initWaveTables();
void __cdecl makePTWave(Uint8 **buf, $296577AB1FDEBC0CA4D43AF2DF231431 *param);
void __cdecl mixPTWaves(Uint8 **buf, $296577AB1FDEBC0CA4D43AF2DF231431 *param, int count);
signed int LoadGenericData();
void __cdecl ActNpc220(NPCHAR_0 *npc);
void __cdecl ActNpc221(NPCHAR_0 *npc);
void __cdecl ActNpc222(NPCHAR_0 *npc);
void __cdecl ActNpc223(NPCHAR_0 *npc);
void __cdecl ActNpc224(NPCHAR_0 *npc);
void __cdecl ActNpc225(NPCHAR_0 *npc);
void __cdecl ActNpc226(NPCHAR_0 *npc);
void __cdecl ActNpc227(NPCHAR_0 *npc);
void __cdecl ActNpc228(NPCHAR_0 *npc);
void __cdecl ActNpc229(NPCHAR_0 *npc);
void __cdecl ActNpc230(NPCHAR_0 *npc);
void __cdecl ActNpc231(NPCHAR_0 *npc);
void __cdecl ActNpc232(NPCHAR_0 *npc);
void __cdecl ActNpc233(NPCHAR_0 *npc);
void __cdecl ActNpc234(NPCHAR_0 *npc);
void __cdecl ActNpc235(NPCHAR_0 *npc);
void __cdecl ActNpc236(NPCHAR_0 *npc);
void __cdecl ActNpc237(NPCHAR_0 *npc);
void __cdecl ActNpc238(NPCHAR_0 *npc);
void __cdecl ActNpc239(NPCHAR_0 *npc);
void InitBullet();
int __cdecl CountArmsBullet(int arms_code);
int __cdecl CountBulletNum(int bullet_code);
void __cdecl DeleteBullet(int code);
void ClearBullet();
void __cdecl PutBullet(int fx, int fy);
void __cdecl SetBullet(int no, int x, int y, int dir);
void __cdecl ActBullet_Frontia1($96A7816609F59F56E43A9A5E8F547E1B *bul);
void __cdecl ActBullet_Frontia2($96A7816609F59F56E43A9A5E8F547E1B *bul, int level);
void __cdecl ActBullet_PoleStar($96A7816609F59F56E43A9A5E8F547E1B *bul, int level);
void __cdecl ActBullet_FireBall($96A7816609F59F56E43A9A5E8F547E1B *bul, int level);
void __cdecl ActBullet_MachineGun($96A7816609F59F56E43A9A5E8F547E1B *bul, int level);
void __cdecl ActBullet_Missile($96A7816609F59F56E43A9A5E8F547E1B *bul, int level);
void __cdecl ActBullet_Bom($96A7816609F59F56E43A9A5E8F547E1B *bul, int level);
void __cdecl ActBullet_Bubblin1($96A7816609F59F56E43A9A5E8F547E1B *bul);
void __cdecl ActBullet_Bubblin2($96A7816609F59F56E43A9A5E8F547E1B *bul);
void __cdecl ActBullet_Bubblin3($96A7816609F59F56E43A9A5E8F547E1B *bul);
void __cdecl ActBullet_Spine($96A7816609F59F56E43A9A5E8F547E1B *bul);
void __cdecl ActBullet_Sword1($96A7816609F59F56E43A9A5E8F547E1B *bul);
void __cdecl ActBullet_Sword2($96A7816609F59F56E43A9A5E8F547E1B *bul);
void __cdecl ActBullet_Sword3($96A7816609F59F56E43A9A5E8F547E1B *bul);
void __cdecl ActBullet_Edge($96A7816609F59F56E43A9A5E8F547E1B *bul);
void __cdecl ActBullet_Drop($96A7816609F59F56E43A9A5E8F547E1B *bul);
void __cdecl ActBullet_SuperMissile($96A7816609F59F56E43A9A5E8F547E1B *bul, int level);
void __cdecl ActBullet_SuperBom($96A7816609F59F56E43A9A5E8F547E1B *bul, int level);
void __cdecl ActBullet_Nemesis($96A7816609F59F56E43A9A5E8F547E1B *bul, int level);
void __cdecl ActBullet_Spur($96A7816609F59F56E43A9A5E8F547E1B *bul, int level);
void __cdecl ActBullet_SpurTail($96A7816609F59F56E43A9A5E8F547E1B *bul, int level);
void __cdecl ActBullet_EnemyClear($96A7816609F59F56E43A9A5E8F547E1B *bul);
void __cdecl ActBullet_Star($96A7816609F59F56E43A9A5E8F547E1B *bul);
void ActBullet();
signed int IsActiveSomeBullet();
signed int __cdecl InitBack(char *fName, int type);
void ActBack();
void __cdecl PutBack(int fx, int fy);
void __cdecl PutFront(int fx, int fy);
void __cdecl ActNpc020(NPCHAR_0 *npc);
void __cdecl ActNpc021(NPCHAR_0 *npc);
void __cdecl ActNpc022(NPCHAR_0 *npc);
void __cdecl ActNpc023(NPCHAR_0 *npc);
void __cdecl ActNpc024(NPCHAR_0 *npc);
void __cdecl ActNpc025(NPCHAR_0 *npc);
void __cdecl ActNpc026(NPCHAR_0 *npc);
void __cdecl ActNpc027(NPCHAR_0 *npc);
void __cdecl ActNpc028(NPCHAR_0 *npc);
void __cdecl ActNpc029(NPCHAR_0 *npc);
void __cdecl ActNpc030(NPCHAR_0 *npc);
void __cdecl ActNpc031(NPCHAR_0 *npc);
void __cdecl ActNpc032(NPCHAR_0 *npc);
void __cdecl ActNpc033(NPCHAR_0 *npc);
void __cdecl ActNpc034(NPCHAR_0 *npc);
void __cdecl ActNpc035(NPCHAR_0 *npc);
void __cdecl ActNpc036(NPCHAR_0 *npc);
void __cdecl ActNpc037(NPCHAR_0 *npc);
void __cdecl ActNpc038(NPCHAR_0 *npc);
void __cdecl ActNpc039(NPCHAR_0 *npc);
void __cdecl ActNpc040(NPCHAR_0 *npc);
void __cdecl ActNpc041(NPCHAR_0 *npc);
void __cdecl ActNpc042(NPCHAR_0 *npc);
void __cdecl ActNpc043(NPCHAR_0 *npc);
void __cdecl ActNpc044(NPCHAR_0 *npc);
void __cdecl ActNpc045(NPCHAR_0 *npc);
void __cdecl ActNpc046(NPCHAR_0 *npc);
void __cdecl ActNpc047(NPCHAR_0 *npc);
void __cdecl ActNpc048(NPCHAR_0 *npc);
void __cdecl ActNpc049(NPCHAR_0 *npc);
void __cdecl ActNpc050(NPCHAR_0 *npc);
void __cdecl ActNpc051(NPCHAR_0 *npc);
void __cdecl ActNpc052(NPCHAR_0 *npc);
void __cdecl ActNpc053(NPCHAR_0 *npc);
void __cdecl ActNpc054(NPCHAR_0 *npc);
void __cdecl ActNpc055(NPCHAR_0 *npc);
void __cdecl ActNpc056(NPCHAR_0 *npc);
void __cdecl ActNpc057(NPCHAR_0 *npc);
void __cdecl ActNpc058(NPCHAR_0 *npc);
void __cdecl ActNpc059(NPCHAR_0 *npc);
void __cdecl JadgeHitNpCharBlock(NPCHAR_0 *npc, int x, int y);
void __cdecl JudgeHitNpCharTriangleA(NPCHAR_0 *npc, int x, int y);
void __cdecl JudgeHitNpCharTriangleB(NPCHAR_0 *npc, int x, int y);
void __cdecl JudgeHitNpCharTriangleC(NPCHAR_0 *npc, int x, int y);
void __cdecl JudgeHitNpCharTriangleD(NPCHAR_0 *npc, int x, int y);
void __cdecl JudgeHitNpCharTriangleE(NPCHAR_0 *npc, int x, int y);
void __cdecl JudgeHitNpCharTriangleF(NPCHAR_0 *npc, int x, int y);
void __cdecl JudgeHitNpCharTriangleG(NPCHAR_0 *npc, int x, int y);
void __cdecl JudgeHitNpCharTriangleH(NPCHAR_0 *npc, int x, int y);
void __cdecl JudgeHitNpCharWater(NPCHAR_0 *npc, int x, int y);
void HitNpCharMap();
void __cdecl LoseNpChar(NPCHAR_0 *npc, bool bVanish);
void HitNpCharBullet();
void __cdecl ActNpc240(NPCHAR_0 *npc);
void __cdecl ActNpc241(NPCHAR_0 *npc);
void __cdecl ActNpc242(NPCHAR_0 *npc);
void __cdecl ActNpc243(NPCHAR_0 *npc);
void __cdecl ActNpc244(NPCHAR_0 *npc);
void __cdecl ActNpc245(NPCHAR_0 *npc);
void __cdecl ActNpc246(NPCHAR_0 *npc);
void __cdecl ActNpc247(NPCHAR_0 *npc);
void __cdecl ActNpc248(NPCHAR_0 *npc);
void __cdecl ActNpc249(NPCHAR_0 *npc);
void __cdecl ActNpc250(NPCHAR_0 *npc);
void __cdecl ActNpc251(NPCHAR_0 *npc);
void __cdecl ActNpc252(NPCHAR_0 *npc);
void __cdecl ActNpc253(NPCHAR_0 *npc);
void __cdecl ActNpc254(NPCHAR_0 *npc);
void __cdecl ActNpc255(NPCHAR_0 *npc);
void __cdecl ActNpc256(NPCHAR_0 *npc);
void __cdecl ActNpc257(NPCHAR_0 *npc);
void __cdecl ActNpc258(NPCHAR_0 *npc);
void __cdecl ActNpc259(NPCHAR_0 *npc);
void __cdecl ShootBullet_Frontia1(int level);
void __cdecl ShootBullet_PoleStar(int level);
void __cdecl ShootBullet_FireBall(int level);
void __cdecl ShootBullet_Machinegun1(int level);
void __cdecl ShootBullet_Missile(int level, bool bSuper);
void ShootBullet_Bubblin1();
void __cdecl ShootBullet_Bubblin2(int level);
void __cdecl ShootBullet_Sword(int level);
void __cdecl ShootBullet_Nemesis(int level);
void ResetSpurCharge();
void __cdecl ShootBullet_Spur(int level);
void ShootBullet();
void MakeWaveTables();
signed int __cdecl MakePixelWaveData($296577AB1FDEBC0CA4D43AF2DF231431 *ptp, unsigned __int8 *pData);
void __cdecl ActNpc200(NPCHAR_0 *npc);
void __cdecl ActNpc201(NPCHAR_0 *npc);
void __cdecl ActNpc202(NPCHAR_0 *npc);
void __cdecl ActNpc203(NPCHAR_0 *npc);
void __cdecl ActNpc204(NPCHAR_0 *npc);
void __cdecl ActNpc205(NPCHAR_0 *npc);
void __cdecl ActNpc206(NPCHAR_0 *npc);
void __cdecl ActNpc207(NPCHAR_0 *npc);
void __cdecl ActNpc208(NPCHAR_0 *npc);
void __cdecl ActNpc209(NPCHAR_0 *npc);
void __cdecl ActNpc210(NPCHAR_0 *npc);
void __cdecl ActNpc211(NPCHAR_0 *npc);
void __cdecl ActNpc212(NPCHAR_0 *npc);
void __cdecl ActNpc213(NPCHAR_0 *npc);
void __cdecl ActNpc214(NPCHAR_0 *npc);
void __cdecl ActNpc215(NPCHAR_0 *npc);
void __cdecl ActNpc216(NPCHAR_0 *npc);
void __cdecl ActNpc217(NPCHAR_0 *npc);
void __cdecl ActNpc218(NPCHAR_0 *npc);
void __cdecl ActNpc219(NPCHAR_0 *npc);
void __cdecl AddExpMyChar(int x);
void ZeroExpMyChar();
_BOOL4 IsMaxExpMyChar();
void __cdecl DamageMyChar(int damage);
void ZeroArmsEnergy_All();
void __cdecl AddBulletMyChar(int no, int val);
void __cdecl AddLifeMyChar(int x);
void __cdecl AddMaxLifeMyChar(int val);
void __cdecl PutArmsEnergy(bool flash);
void PutActiveArmsList();
void __cdecl PutMyLife(bool flash);
void __cdecl PutMyAir(int x, int y);
void __cdecl PutTimeCounter(int x, int y);
signed int SaveTimeCounter();
int LoadTimeCounter();
void ResetMyCharFlag();
void _PutlittleStar();
int __cdecl JudgeHitMyCharBlock(int x, int y);
int __cdecl JudgeHitMyCharTriangleA(int x, int y);
int __cdecl JudgeHitMyCharTriangleB(int x, int y);
int __cdecl JudgeHitMyCharTriangleC(int x, int y);
int __cdecl JudgeHitMyCharTriangleD(int x, int y);
int __cdecl JudgeHitMyCharTriangleE(int x, int y);
int __cdecl JudgeHitMyCharTriangleF(int x, int y);
int __cdecl JudgeHitMyCharTriangleG(int x, int y);
int __cdecl JudgeHitMyCharTriangleH(int x, int y);
int __cdecl JudgeHitMyCharWater(int x, int y);
int __cdecl JudgeHitMyCharDamage(int x, int y);
int __cdecl JudgeHitMyCharDamageW(int x, int y);
int __cdecl JudgeHitMyCharVectLeft(int x, int y);
int __cdecl JudgeHitMyCharVectUp(int x, int y);
int __cdecl JudgeHitMyCharVectRight(int x, int y);
int __cdecl JudgeHitMyCharVectDown(int x, int y);
void HitMyCharMap();
int __cdecl JudgeHitMyCharNPC(NPCHAR_0 *npc);
signed int __cdecl JudgeHitMyCharNPC3(NPCHAR_0 *npc);
int __cdecl JudgeHitMyCharNPC4(NPCHAR_0 *npc);
void HitMyCharNpChar();
void HitMyCharBoss();
void __cdecl WriteMiniMapLine(int line);
signed int MiniMapLoop();
_BOOL4 IsMapping();
void StartMapping();
void __cdecl SetMapping(int a);
void InitTriangleTable();
int __cdecl GetSin(unsigned __int8 deg);
int __cdecl GetCos(unsigned __int8 deg);
int __cdecl GetArktan(int x, int y);
void ActBossChar_Press();
void __cdecl ReadyMapName(unsigned __int8 *str);
void __cdecl PutMapName(bool bMini);
void StartMapName();
void RestoreMapName();
void __cdecl InitBossChar(int code);
void __cdecl PutBossChar(int fx, int fy);
void __cdecl SetBossCharActNo(int a);
void HitBossBullet();
void ActBossChar_0();
void ActBossChar();
void HitBossMap();
signed int __cdecl TransferStage(int no, int w, int x, int y);
void __cdecl ChangeMusic(int no);
void ReCallMusic();
void __cdecl _ActBossCharA_Head(NPCHAR_0 *npc);
void __cdecl _ActBossCharA_Tail(NPCHAR_0 *npc);
void __cdecl _ActBossCharA_Face(NPCHAR_0 *npc);
void __cdecl _ActBossCharA_Mini(NPCHAR_0 *npc);
void __cdecl _ActBossCharA_Hit(NPCHAR_0 *npc);
void ActBossChar_Undead();
void __cdecl ActBossChar_Core_Face(NPCHAR_0 *npc);
void __cdecl ActBossChar_Core_Tail(NPCHAR_0 *npc);
void __cdecl ActBossChar_Core_Mini(NPCHAR_0 *npc);
void __cdecl ActBossChar_Core_Hit(NPCHAR_0 *npc);
void ActBossChar_Core();
void InitCaret();
void __cdecl ActCaret00();
void __cdecl ActCaret01($4AB8D1A8A7198C298836BEA20F02E4D8 *crt);
void __cdecl ActCaret02($4AB8D1A8A7198C298836BEA20F02E4D8 *crt);
void __cdecl ActCaret03($4AB8D1A8A7198C298836BEA20F02E4D8 *crt);
void __cdecl ActCaret04($4AB8D1A8A7198C298836BEA20F02E4D8 *crt);
void __cdecl ActCaret05($4AB8D1A8A7198C298836BEA20F02E4D8 *crt);
void __cdecl ActCaret07($4AB8D1A8A7198C298836BEA20F02E4D8 *crt);
void __cdecl ActCaret08($4AB8D1A8A7198C298836BEA20F02E4D8 *crt);
void __cdecl ActCaret09($4AB8D1A8A7198C298836BEA20F02E4D8 *crt);
void __cdecl ActCaret10($4AB8D1A8A7198C298836BEA20F02E4D8 *crt);
void __cdecl ActCaret11($4AB8D1A8A7198C298836BEA20F02E4D8 *crt);
void __cdecl ActCaret12($4AB8D1A8A7198C298836BEA20F02E4D8 *crt);
void __cdecl ActCaret13($4AB8D1A8A7198C298836BEA20F02E4D8 *crt);
void __cdecl ActCaret14($4AB8D1A8A7198C298836BEA20F02E4D8 *crt);
void __cdecl ActCaret15($4AB8D1A8A7198C298836BEA20F02E4D8 *crt);
void __cdecl ActCaret16($4AB8D1A8A7198C298836BEA20F02E4D8 *crt);
void __cdecl ActCaret17($4AB8D1A8A7198C298836BEA20F02E4D8 *crt);
void ActCaret();
void __cdecl PutCaret(int fx, int fy);
void __cdecl SetCaret(int x, int y, int code, int dir);
signed int InitDirectSound();
void EndDirectSound();
void __cdecl PlaySoundObject(int no, int mode);
void __cdecl ChangeSoundFrequency(int no, Uint32 rate);
int __cdecl MakePixToneObject($296577AB1FDEBC0CA4D43AF2DF231431 *ptp, int ptp_num, int no);
void ReleaseDirectInput();
bool __cdecl InitDirectInput();
signed int __cdecl GetJoystickStatus($CC5B0FEB395DC4593A946B3182F5E0FD *pStatus);
signed int ResetJoystickStatus();
void ClearArmsData();
void ClearItemData();
signed int __cdecl AddArmsData(int code, int max_num);
signed int __cdecl SubArmsData(int code);
signed int __cdecl TradeArms(int code1, int code2, int max_num);
signed int __cdecl AddItemData(int code);
signed int __cdecl SubItemData(int code);
void MoveCampCursor();
void PutCampObject();
signed int CampLoop();
signed int __cdecl CheckItem(int a);
signed int __cdecl CheckArms(int a);
signed int __cdecl UseArmsEnergy(int num);
signed int __cdecl ChargeArmsEnergy(int num);
void FullArmsEnergy();
int RotationArms();
int RotationArmsRev();
void ChangeToFirstArms();
void ActBossChar_Ironhead();
void __cdecl _Vanish($96A7816609F59F56E43A9A5E8F547E1B *bul);
int __cdecl JudgeHitBulletBlock(int x, int y, $96A7816609F59F56E43A9A5E8F547E1B *bul);
int __cdecl JudgeHitBulletBlock2(int x, int y, unsigned __int8 *atrb, $96A7816609F59F56E43A9A5E8F547E1B *bul);
int __cdecl JudgeHitBulletTriangleA(int x, int y, $96A7816609F59F56E43A9A5E8F547E1B *bul);
int __cdecl JudgeHitBulletTriangleB(int x, int y, $96A7816609F59F56E43A9A5E8F547E1B *bul);
int __cdecl JudgeHitBulletTriangleC(int x, int y, $96A7816609F59F56E43A9A5E8F547E1B *bul);
int __cdecl JudgeHitBulletTriangleD(int x, int y, $96A7816609F59F56E43A9A5E8F547E1B *bul);
int __cdecl JudgeHitBulletTriangleE(int x, int y, $96A7816609F59F56E43A9A5E8F547E1B *bul);
int __cdecl JudgeHitBulletTriangleF(int x, int y, $96A7816609F59F56E43A9A5E8F547E1B *bul);
int __cdecl JudgeHitBulletTriangleG(int x, int y, $96A7816609F59F56E43A9A5E8F547E1B *bul);
int __cdecl JudgeHitBulletTriangleH(int x, int y, $96A7816609F59F56E43A9A5E8F547E1B *bul);
void HitBulletMap();
signed int get_language();
void __cdecl ActNpc260(NPCHAR_0 *npc);
void __cdecl ActNpc261(NPCHAR_0 *npc);
void __cdecl ActNpc262(NPCHAR_0 *npc);
void __cdecl ActNpc263(NPCHAR_0 *npc);
void __cdecl ActNpc264(NPCHAR_0 *npc);
void __cdecl ActNpc265(NPCHAR_0 *npc);
void __cdecl ActNpc266(NPCHAR_0 *npc);
void __cdecl ActNpc267(NPCHAR_0 *npc);
void __cdecl ActNpc268(NPCHAR_0 *npc);
void __cdecl ActNpc269(NPCHAR_0 *npc);
void __cdecl ActNpc270(NPCHAR_0 *npc);
void __cdecl ActNpc271(NPCHAR_0 *npc);
void __cdecl ActNpc272(NPCHAR_0 *npc);
void __cdecl ActNpc273(NPCHAR_0 *npc);
void __cdecl ActNpc274(NPCHAR_0 *npc);
void __cdecl ActNpc275(NPCHAR_0 *npc);
void __cdecl ActNpc276(NPCHAR_0 *npc);
void __cdecl ActNpc277(NPCHAR_0 *npc);
void __cdecl ActNpc278(NPCHAR_0 *npc);
void __cdecl ActNpc279(NPCHAR_0 *npc);
void ActBossChar02_01();
void ActBossChar02_02();
void ActBossChar_Frog();
void ActBoss01_12();
void ActBoss01_34();
void ActBoss01_5();
void ActBossChar_Omega();
void __cdecl GetCompileDate(int *year, int *month, int *day);
signed int __cdecl GetCompileVersion(int *v1, int *v2, int *v3, int *v4);
signed int __cdecl ErrorLog(const char *str, int value);
int __cdecl GetFileSizeLong(char *path);
bool __cdecl IsShiftJIS(unsigned __int8 c);
bool __cdecl IsEnableBitmap(char *path);
void __cdecl ActBossCharT_DragonBody(NPCHAR_0 *npc);
void __cdecl ActBossCharT_DragonHead(NPCHAR_0 *npc);
void ActBossChar_Twin();
void __cdecl ActNpc120(NPCHAR_0 *npc);
void __cdecl ActNpc121(NPCHAR_0 *npc);
void __cdecl ActNpc122(NPCHAR_0 *npc);
void __cdecl ActNpc123(NPCHAR_0 *npc);
void __cdecl ActNpc124(NPCHAR_0 *npc);
void __cdecl ActNpc125(NPCHAR_0 *npc);
void __cdecl ActNpc126(NPCHAR_0 *npc);
void __cdecl ActNpc127(NPCHAR_0 *npc);
void __cdecl ActNpc128(NPCHAR_0 *npc);
void __cdecl ActNpc129(NPCHAR_0 *npc);
void __cdecl ActNpc130(NPCHAR_0 *npc);
void __cdecl ActNpc131(NPCHAR_0 *npc);
void __cdecl ActNpc132(NPCHAR_0 *npc);
void __cdecl ActNpc133(NPCHAR_0 *npc);
void __cdecl ActNpc134(NPCHAR_0 *npc);
void __cdecl ActNpc135(NPCHAR_0 *npc);
void __cdecl ActNpc136(NPCHAR_0 *npc);
void __cdecl ActNpc137(NPCHAR_0 *npc);
void __cdecl ActNpc138(NPCHAR_0 *npc);
void __cdecl ActNpc139(NPCHAR_0 *npc);
int __cdecl _interpolate($8D9359E30B30BEB685C90F8A0F30C069 *chan, bool left);
void __cdecl _advance($8D9359E30B30BEB685C90F8A0F30C069 *chan);
signed int __cdecl _checkRepeat($8D9359E30B30BEB685C90F8A0F30C069 *chan);
void __cdecl _mix_callback(void *userdata, Uint8 *stream, int len);
void __cdecl SMixer_StopChunk($FE85C58A60403E3389C96E96D80030A8 *c);
void __cdecl SMixer_Reset($FE85C58A60403E3389C96E96D80030A8 *c);
void __cdecl SMixer_SetVolume($FE85C58A60403E3389C96E96D80030A8 *c, Uint16 volume);
void __cdecl SMixer_SetPan($FE85C58A60403E3389C96E96D80030A8 *c, Uint16 pan);
void __cdecl SMixer_SetFrequency($FE85C58A60403E3389C96E96D80030A8 *c, Uint32 freq);
void __cdecl SMixer_InitChunk($FE85C58A60403E3389C96E96D80030A8 *c);
void __cdecl SMixer_PlayChunk($FE85C58A60403E3389C96E96D80030A8 *c, Sint32 repeat);
void SMixer_FreeChunks();
void SMixer_Init();
void SMixer_Start();
void SMixer_Quit();
void PutFramePerSecound();
int __cdecl main(int argc, const char **argv, const char **envp);
void InactiveWindow();
void ActiveWindow();
void JoystickProc();
bool __cdecl SystemTask();
void __cdecl ChangeOrganFrequency(Uint8 key, Sint8 track, Uint32 a);
void __cdecl ChangeOrganPan(Uint8 key, Uint8 pan, Sint8 track);
void __cdecl ChangeOrganVolume(int no, int volume, Sint8 track);
void __cdecl PlayOrganObject(Uint8 key, int mode, Sint8 track, Uint32 freq);
void __cdecl ReleaseOrganyaObject(Sint8 track);
signed int InitWaveData100();
signed int __cdecl MakeOrganyaWave(char track, char wave_no);
void __cdecl ChangeDramFrequency(unsigned __int8 key, char track);
void __cdecl ChangeDramPan(unsigned __int8 pan, char track);
void __cdecl ChangeDramVolume(int volume, char track);
void __cdecl PlayDramObject(unsigned __int8 key, int mode, char track);
void __cdecl OrgData::OrgData(OrgData *const this);
void __cdecl OrgData::OrgData(OrgData *const this);
void __cdecl OrgData::InitOrgData(OrgData *const this);
signed int __cdecl OrgData::SetMusicInfo(OrgData *const this, MUSICINFO_0 *mi, Uint32 flag);
signed int __cdecl OrgData::NoteAlloc(OrgData *const this, unsigned __int16 alloc);
void __cdecl OrgData::ReleaseNote(OrgData *const this);
signed int __cdecl OrgData::InitMusicData(OrgData *const this, char *path);
void __cdecl OrgData::GetMusicInfo(OrgData *const this, MUSICINFO_0 *mi);
void __thiscall OrgData::PlayData(OrgData *const this);
void __cdecl OrgData::SetPlayPointer(OrgData *const this, Sint32 x);
signed int __cdecl StartOrganya();
signed int __cdecl LoadOrganya(char *path);
void __cdecl SetOrganyaPosition(Sint32 x);
Uint32 GetOrganyaPosition();
void PlayOrganyaMusic();
signed int __cdecl ChangeOrganyaVolume(int vol);
void StopOrganyaMusic();
void SetOrganyaFadeout();
void EndOrganya();
int __cdecl Random(int min, int max);
void __cdecl PutNumber4(int x, int y, int value, bool bZero);
int __cdecl _ModeOpening();
int __cdecl _ModeTitle();
int __cdecl _ModeAction();
signed int __cdecl Game();
void GetTrg();
signed int __cdecl LoadNpcTable(char *path);
void ReleaseNpcTable();
_BOOL4 InitTextScript2();
void EndTextScript();
void __cdecl EncryptionBinaryData2(unsigned __int8 *pData, int size);
signed int __cdecl LoadTextScript2(char *name);
signed int __cdecl LoadTextScript_Stage(char *name);
void __cdecl GetTextScriptPath(char *path);
int __cdecl GetTextScriptNo(int a);
signed int __cdecl StartTextScript(int no);
signed int __cdecl JumpTextScript(int no);
void StopTextScript();
void CheckNewLine();
void __cdecl SetNumberTextScript(int index);
void ClearTextLine();
void PutTextScript();
signed int TextScriptProc();
void RestoreTextScript();
signed int InitMapData2();
signed int __cdecl LoadMapData2(char *path_map);
signed int __cdecl LoadAttributeData(char *path_atrb);
void EndMapData();
void ReleasePartsImage();
void __cdecl GetMapData(unsigned __int8 **data, __int16 *mw, __int16 *ml);
int __cdecl GetAttribute(int x, int y);
void __cdecl DeleteMapParts(int x, int y);
void __cdecl ShiftMapParts(int x, int y);
signed int __cdecl ChangeMapParts(int x, int y, unsigned __int8 no);
void __cdecl PutStage_Back(int fx, int fy);
void __cdecl PutStage_Front(int fx, int fy);
void __cdecl PutMapDataVector(int fx, int fy);
void __cdecl ActNpc160(NPCHAR_0 *npc);
void __cdecl ActNpc161(NPCHAR_0 *npc);
void __cdecl ActNpc162(NPCHAR_0 *npc);
void __cdecl ActNpc163(NPCHAR_0 *npc);
void __cdecl ActNpc164(NPCHAR_0 *npc);
void __cdecl ActNpc165(NPCHAR_0 *npc);
void __cdecl ActNpc166(NPCHAR_0 *npc);
void __cdecl ActNpc167(NPCHAR_0 *npc);
void __cdecl ActNpc168(NPCHAR_0 *npc);
void __cdecl ActNpc169(NPCHAR_0 *npc);
void __cdecl ActNpc170(NPCHAR_0 *npc);
void __cdecl ActNpc171(NPCHAR_0 *npc);
void __cdecl ActNpc172(NPCHAR_0 *npc);
void __cdecl ActNpc173(NPCHAR_0 *npc);
void __cdecl ActNpc174(NPCHAR_0 *npc);
void __cdecl ActNpc175(NPCHAR_0 *npc);
void __cdecl ActNpc176(NPCHAR_0 *npc);
void __cdecl ActNpc177(NPCHAR_0 *npc);
void __cdecl ActNpc178(NPCHAR_0 *npc);
void __cdecl ActNpc179(NPCHAR_0 *npc);
void __cdecl ActBossChar03_01(NPCHAR_0 *npc);
void __cdecl ActBossChar03_02(NPCHAR_0 *npc);
void __cdecl ActBossChar03_03(NPCHAR_0 *npc);
void __cdecl ActBossChar03_04(NPCHAR_0 *npc);
void __cdecl ActBossChar03_face(NPCHAR_0 *npc);
void ActBossChar_MonstX();
void __cdecl ActNpc080(NPCHAR_0 *npc);
void __cdecl ActNpc081(NPCHAR_0 *npc);
void __cdecl ActNpc082(NPCHAR_0 *npc);
void __cdecl ActNpc083(NPCHAR_0 *npc);
void __cdecl ActNpc084(NPCHAR_0 *npc);
void __cdecl ActNpc085(NPCHAR_0 *npc);
void __cdecl ActNpc086(NPCHAR_0 *npc);
void __cdecl ActNpc087(NPCHAR_0 *npc);
void __cdecl ActNpc088(NPCHAR_0 *npc);
void __cdecl ActNpc089(NPCHAR_0 *npc);
void __cdecl ActNpc090(NPCHAR_0 *npc);
void __cdecl ActNpc091(NPCHAR_0 *npc);
void __cdecl ActNpc092(NPCHAR_0 *npc);
void __cdecl ActNpc093(NPCHAR_0 *npc);
void __cdecl ActNpc094(NPCHAR_0 *npc);
void __cdecl ActNpc095(NPCHAR_0 *npc);
void __cdecl ActNpc096(NPCHAR_0 *npc);
void __cdecl ActNpc097(NPCHAR_0 *npc);
void __cdecl ActNpc098(NPCHAR_0 *npc);
void __cdecl ActNpc099(NPCHAR_0 *npc);
signed int IsProfile();
void __cdecl Swap(__int16 *variable);
void __cdecl Swap(int *variable);
void __cdecl ByteSwapProfile($B183609F1A8F1989C6F45ED51C9AAA7D *profile);
signed int __cdecl SaveProfile(char *name);
signed int __cdecl LoadProfile(char *name);
signed int __cdecl InitializeGame();
void __cdecl ActNpc140(NPCHAR_0 *npc);
void __cdecl ActNpc141(NPCHAR_0 *npc);
void __cdecl ActNpc142(NPCHAR_0 *npc);
void __cdecl ActNpc143(NPCHAR_0 *npc);
void __cdecl ActNpc144(NPCHAR_0 *npc);
void __cdecl ActNpc145(NPCHAR_0 *npc);
void __cdecl ActNpc146(NPCHAR_0 *npc);
void __cdecl ActNpc147(NPCHAR_0 *npc);
void __cdecl ActNpc148(NPCHAR_0 *npc);
void __cdecl ActNpc149(NPCHAR_0 *npc);
void __cdecl ActNpc150(NPCHAR_0 *npc);
void __cdecl ActNpc151(NPCHAR_0 *npc);
void __cdecl ActNpc152(NPCHAR_0 *npc);
void __cdecl ActNpc153(NPCHAR_0 *npc);
void __cdecl ActNpc154(NPCHAR_0 *npc);
void __cdecl ActNpc155(NPCHAR_0 *npc);
void __cdecl ActNpc156(NPCHAR_0 *npc);
void __cdecl ActNpc157(NPCHAR_0 *npc);
void __cdecl ActNpc158(NPCHAR_0 *npc);
void __cdecl ActNpc159(NPCHAR_0 *npc);
void InitNpChar();
void __cdecl _SetUniqueParameter(NPCHAR_0 *npc);
signed int __cdecl LoadEvent(char *path_event);
void __cdecl SetNpChar(int code_char, int x, int y, int xm, int ym, int dir, NPCHAR_0 *npc, int start_index);
void __cdecl SetDestroyNpChar(int x, int y, int w, int num);
void __cdecl SetDestroyNpCharUp(int x, int y, int w, int num);
void __cdecl SetExpObjects(int x, int y, int exp);
signed int __cdecl SetBulletObject(int x, int y, int val);
signed int __cdecl SetLifeObject(int x, int y, int val);
void __cdecl VanishNpChar(NPCHAR_0 *npc);
void __cdecl PutNpChar(int fx, int fy);
void ActNpChar();
void __cdecl ChangeNpCharByEvent(int code_event, int code_char, int dir);
void __cdecl ChangeCheckableNpCharByEvent(int code_event, int code_char, int dir);
void __cdecl SetNpCharActionNo(int code_event, int act_no, int dir);
void __cdecl MoveNpChar(int code_event, int x, int y, int dir);
void __cdecl BackStepMyChar(int code_event);
void __cdecl DeleteNpCharEvent(int code);
void __cdecl DeleteNpCharCode(int code, bool bSmoke);
void __cdecl GetNpCharPosition(int *x, int *y, int i);
signed int __cdecl IsNpCharCode(int code);
_BOOL4 __cdecl GetNpCharAlive(int code_event);
int CountAliveNpChar();
void __cdecl ActNpc000(NPCHAR_0 *npc);
void __cdecl ActNpc001(NPCHAR_0 *npc);
void __cdecl ActNpc002(NPCHAR_0 *npc);
void __cdecl ActNpc003(NPCHAR_0 *npc);
void __cdecl ActNpc004(NPCHAR_0 *npc);
void __cdecl ActNpc005(NPCHAR_0 *npc);
void __cdecl ActNpc006(NPCHAR_0 *npc);
void __cdecl ActNpc007(NPCHAR_0 *npc);
void __cdecl ActNpc008(NPCHAR_0 *npc);
void __cdecl ActNpc009(NPCHAR_0 *npc);
void __cdecl ActNpc010(NPCHAR_0 *npc);
void __cdecl ActNpc011(NPCHAR_0 *npc);
void __cdecl ActNpc012(NPCHAR_0 *npc);
void __cdecl ActNpc013(NPCHAR_0 *npc);
void __cdecl ActNpc014(NPCHAR_0 *npc);
void __cdecl ActNpc015(NPCHAR_0 *npc);
void __cdecl ActNpc016(NPCHAR_0 *npc);
void __cdecl ActNpc017(NPCHAR_0 *npc);
void __cdecl ActNpc018(NPCHAR_0 *npc);
void __cdecl ActNpc019(NPCHAR_0 *npc);
void _libc_csu_fini(void);
void __cdecl _libc_csu_init(int a1, int a2, int a3);
void (*_do_global_ctors_aux())(void);
void term_proc();

// Data declarations

_UNKNOWN ActNpc199(NPCHAR *)::C.16;
_UNKNOWN ActNpc180(NPCHAR *)::C.0;
_UNKNOWN ActNpc180(NPCHAR *)::C.1;

_UNKNOWN SetValueView(long *,long *,long)::C.21;
RECT ActNpc358(NPCHAR *)::C.16[5] =
{
  { 208, 8, 224, 32 },
  { 224, 8, 240, 32 },
  { 240, 8, 256, 32 },
  { 256, 8, 272, 32 },
  { 272, 8, 288, 32 }
};
RECT ActNpc352(NPCHAR *)::C.15[28] =
{
  { 304, 48, 320, 64 },
  { 224, 48, 240, 64 },
  { 32, 80, 48, 96 },
  { 0, 80, 16, 96 },
  { 224, 216, 240, 240 },
  { 192, 216, 208, 240 },
  { 48, 16, 64, 32 },
  { 0, 16, 16, 32 },
  { 112, 192, 128, 216 },
  { 80, 192, 96, 216 },
  { 304, 0, 320, 16 },
  { 224, 0, 240, 16 },
  { 176, 32, 192, 48 },
  { 176, 32, 192, 48 },
  { 240, 16, 256, 32 },
  { 224, 16, 240, 32 },
  { 208, 16, 224, 32 },
  { 192, 16, 208, 32 },
  { 280, 128, 320, 152 },
  { 280, 152, 320, 176 },
  { 32, 112, 48, 128 },
  { 0, 112, 16, 128 },
  { 80, 0, 96, 16 },
  { 112, 0, 128, 16 },
  { 16, 152, 32, 176 },
  { 0, 152, 16, 176 },
  { 48, 16, 64, 32 },
  { 48, 0, 64, 16 }
};
RECT ActNpc351(NPCHAR *)::C.13[9] =
{
  { 0, 96, 32, 136 },
  { 32, 96, 64, 136 },
  { 64, 96, 96, 136 },
  { 96, 96, 128, 136 },
  { 128, 96, 160, 136 },
  { 0, 176, 32, 216 },
  { 32, 176, 64, 216 },
  { 64, 176, 96, 216 },
  { 96, 176, 128, 216 }
};
RECT ActNpc350(NPCHAR *)::C.11 = { 0, 160, 24, 184 };
RECT ActNpc350(NPCHAR *)::C.12 = { 0, 184, 24, 208 };
RECT ActNpc340(NPCHAR *)::C.0 = { 0, 0, 48, 40 };
RECT ActNpc340(NPCHAR *)::C.1 = { 0, 40, 48, 80 };
_DWORD (__cdecl *off_81454D8[2])(scoped_profile *this) = { &scoped_profile::~scoped_profile, &scoped_profile::~scoped_profile };
RECT ActNpc313(NPCHAR *)::C.13[14] =
{
  { 128, 0, 144, 16 },
  { 144, 0, 160, 16 },
  { 160, 0, 176, 16 },
  { 176, 0, 192, 16 },
  { 192, 0, 208, 16 },
  { 208, 0, 224, 16 },
  { 224, 0, 240, 16 },
  { 240, 0, 256, 16 },
  { 256, 0, 272, 16 },
  { 272, 0, 288, 16 },
  { 288, 0, 304, 16 },
  { 128, 0, 144, 16 },
  { 176, 0, 192, 16 },
  { 304, 0, 320, 16 }
};
RECT ActNpc313(NPCHAR *)::C.14[14] =
{
  { 128, 16, 144, 32 },
  { 144, 16, 160, 32 },
  { 160, 16, 176, 32 },
  { 176, 16, 192, 32 },
  { 192, 16, 208, 32 },
  { 208, 16, 224, 32 },
  { 224, 16, 240, 32 },
  { 240, 16, 256, 32 },
  { 256, 16, 272, 32 },
  { 272, 16, 288, 32 },
  { 288, 16, 304, 32 },
  { 128, 16, 144, 32 },
  { 176, 16, 192, 32 },
  { 304, 16, 320, 32 }
};
RECT ActNpc312(NPCHAR *)::C.11[5] =
{
  { 0, 160, 16, 176 },
  { 16, 160, 32, 176 },
  { 32, 160, 48, 176 },
  { 48, 160, 64, 176 },
  { 64, 160, 80, 176 }
};
RECT ActNpc312(NPCHAR *)::C.12[5] =
{
  { 0, 176, 16, 192 },
  { 16, 176, 32, 192 },
  { 32, 176, 48, 192 },
  { 48, 176, 64, 192 },
  { 64, 176, 80, 192 }
};
RECT ActNpc311(NPCHAR *)::C.9[7] =
{
  { 0, 32, 24, 56 },
  { 24, 32, 48, 56 },
  { 48, 32, 72, 56 },
  { 72, 32, 96, 56 },
  { 96, 32, 120, 56 },
  { 120, 32, 144, 56 },
  { 144, 32, 168, 56 }
};
RECT ActNpc311(NPCHAR *)::C.10[7] =
{
  { 0, 56, 24, 80 },
  { 24, 56, 48, 80 },
  { 48, 56, 72, 80 },
  { 72, 56, 96, 80 },
  { 96, 56, 120, 80 },
  { 120, 56, 144, 80 },
  { 144, 56, 168, 80 }
};
RECT ActNpc310(NPCHAR *)::C.7[5] =
{
  { 32, 0, 56, 16 },
  { 56, 0, 80, 16 },
  { 80, 0, 104, 16 },
  { 104, 0, 128, 16 },
  { 128, 0, 152, 16 }
};
RECT ActNpc310(NPCHAR *)::C.8[5] =
{
  { 32, 16, 56, 32 },
  { 56, 16, 80, 32 },
  { 80, 16, 104, 32 },
  { 104, 16, 128, 32 },
  { 128, 16, 152, 32 }
};
RECT ActNpc301(NPCHAR *)::C.0[8] =
{
  { 144, 0, 160, 16 },
  { 160, 0, 176, 16 },
  { 176, 0, 192, 16 },
  { 192, 0, 208, 16 },
  { 144, 16, 160, 32 },
  { 160, 16, 176, 32 },
  { 176, 16, 192, 32 },
  { 192, 16, 208, 32 }
};
_UNKNOWN ActNpc074(NPCHAR *)::C.38;
_UNKNOWN ActNpc074(NPCHAR *)::C.39;
_UNKNOWN ActNpc073(NPCHAR *)::C.37;
_UNKNOWN ActNpc069(NPCHAR *)::C.32;
_UNKNOWN ActNpc069(NPCHAR *)::C.33;
_UNKNOWN ActNpc068(NPCHAR *)::C.30;
_UNKNOWN ActNpc068(NPCHAR *)::C.31;
_UNKNOWN ActNpc067(NPCHAR *)::C.26;
_UNKNOWN ActNpc067(NPCHAR *)::C.27;
_UNKNOWN ActNpc063(NPCHAR *)::C.16;
_UNKNOWN ActNpc063(NPCHAR *)::C.17;
_UNKNOWN ActNpc061(NPCHAR *)::C.9;
_UNKNOWN ActNpc061(NPCHAR *)::C.10;
_UNKNOWN ActNpc060(NPCHAR *)::C.0;
_UNKNOWN ActNpc060(NPCHAR *)::C.1;
_UNKNOWN AnimationMyChar(bool)::C.0;
_UNKNOWN AnimationMyChar(bool)::C.1;
_UNKNOWN ActNpc326(NPCHAR *)::C.10;
_UNKNOWN ActNpc326(NPCHAR *)::C.11;
_UNKNOWN ActNpc325(NPCHAR *)::C.5;
_UNKNOWN _ActBossChar_Eye(NPCHAR *)::C.0;
_UNKNOWN _ActBossChar_Eye(NPCHAR *)::C.1;
_UNKNOWN ActNpc298(NPCHAR *)::C.11;
_UNKNOWN ActNpc288(NPCHAR *)::C.9;
_UNKNOWN ActNpc287(NPCHAR *)::C.8;
_UNKNOWN ActNpc284(NPCHAR *)::C.4;
_UNKNOWN ActNpc284(NPCHAR *)::C.5;
_UNKNOWN ActNpc283(NPCHAR *)::C.1;
_UNKNOWN ActNpc283(NPCHAR *)::C.2;
_UNKNOWN ActNpc118(NPCHAR *)::C.17;
_UNKNOWN ActNpc118(NPCHAR *)::C.18;
_UNKNOWN ActNpc117(NPCHAR *)::C.13;
_UNKNOWN ActNpc117(NPCHAR *)::C.14;
_UNKNOWN ActNpc115(NPCHAR *)::C.11;
_UNKNOWN ActNpc115(NPCHAR *)::C.12;
_UNKNOWN ActNpc113(NPCHAR *)::C.8;
_UNKNOWN ActNpc113(NPCHAR *)::C.9;
_UNKNOWN ActNpc107(NPCHAR *)::C.3;
_UNKNOWN ActNpc236(NPCHAR *)::C.14;
_UNKNOWN ActNpc236(NPCHAR *)::C.15;
_UNKNOWN ActNpc226(NPCHAR *)::C.9;
_UNKNOWN ActNpc221(NPCHAR *)::C.1;
_UNKNOWN ActNpc221(NPCHAR *)::C.2;
_UNKNOWN ActBullet_Edge(BULLET *)::C.71;
_UNKNOWN ActBullet_Edge(BULLET *)::C.72;
_UNKNOWN ActNpc036(NPCHAR *)::C.12;
_UNKNOWN ActNpc036(NPCHAR *)::C.13;
_UNKNOWN ActNpc031(NPCHAR *)::C.6;
_UNKNOWN ActNpc031(NPCHAR *)::C.7;
_UNKNOWN ActNpc028(NPCHAR *)::C.3;
_UNKNOWN ActNpc028(NPCHAR *)::C.4;
_UNKNOWN ActNpc024(NPCHAR *)::C.1;
_UNKNOWN ActNpc024(NPCHAR *)::C.2;
_UNKNOWN ActNpc023(NPCHAR *)::C.0;
_UNKNOWN ActNpc057(NPCHAR *)::C.20;
_UNKNOWN ActNpc057(NPCHAR *)::C.21;
_UNKNOWN ActNpc055(NPCHAR *)::C.18;
_UNKNOWN ActNpc055(NPCHAR *)::C.19;
_UNKNOWN ActNpc051(NPCHAR *)::C.16;
_UNKNOWN ActNpc051(NPCHAR *)::C.17;
_UNKNOWN ActNpc047(NPCHAR *)::C.14;
_UNKNOWN ActNpc042(NPCHAR *)::C.3;
_UNKNOWN ActNpc042(NPCHAR *)::C.4;
_UNKNOWN ActNpc040(NPCHAR *)::C.0;
_UNKNOWN ActNpc040(NPCHAR *)::C.1;
_UNKNOWN ActNpc256(NPCHAR *)::C.11;
_UNKNOWN ActNpc247(NPCHAR *)::C.5;
_UNKNOWN ActNpc247(NPCHAR *)::C.6;
_UNKNOWN ActNpc240(NPCHAR *)::C.0;
_UNKNOWN ActNpc240(NPCHAR *)::C.1;
_UNKNOWN ActNpc217(NPCHAR *)::C.8;
_UNKNOWN ActNpc215(NPCHAR *)::C.7;
_UNKNOWN ActNpc213(NPCHAR *)::C.6;
_UNKNOWN ActNpc207(NPCHAR *)::C.4;
_UNKNOWN ActNpc200(NPCHAR *)::C.0;
_UNKNOWN ActNpc200(NPCHAR *)::C.1;
_UNKNOWN _ActBossCharA_Face(NPCHAR *)::C.0;
_UNKNOWN ActCaret14(CARET *)::C.4;
_UNKNOWN ActCaret11(CARET *)::C.3;
_UNKNOWN ActCaret07(CARET *)::C.2;
_UNKNOWN ActCaret05(CARET *)::C.1;
_UNKNOWN ActCaret04(CARET *)::C.0;
_UNKNOWN ActBossChar_Ironhead(void)::C.0;
_UNKNOWN ActBossChar_Ironhead(void)::C.1;
_UNKNOWN ActNpc276(NPCHAR *)::C.29;
_UNKNOWN ActNpc276(NPCHAR *)::C.30;
_UNKNOWN ActNpc274(NPCHAR *)::C.25;
_UNKNOWN ActNpc274(NPCHAR *)::C.26;
_UNKNOWN ActNpc268(NPCHAR *)::C.22;
_UNKNOWN ActNpc268(NPCHAR *)::C.23;
_UNKNOWN ActNpc267(NPCHAR *)::C.9;
_UNKNOWN ActNpc267(NPCHAR *)::C.10;
_UNKNOWN ActNpc263(NPCHAR *)::C.3;
_UNKNOWN ActNpc263(NPCHAR *)::C.4;
_UNKNOWN ActBossChar_Frog(void)::C.0;
_UNKNOWN ActBossChar_Frog(void)::C.1;
_UNKNOWN unk_814B854;
_UNKNOWN unk_814B858;
_UNKNOWN unk_814B85C;
_UNKNOWN unk_814B860;
_UNKNOWN unk_814B864;
_UNKNOWN unk_814B868;
_UNKNOWN unk_814B86C;
_UNKNOWN unk_814B870;
_UNKNOWN unk_814B874;
_UNKNOWN unk_814B878;
_UNKNOWN unk_814B87C;
_UNKNOWN unk_814B880;
_UNKNOWN unk_814B884;
_UNKNOWN ActNpc132(NPCHAR *)::C.15;
_UNKNOWN ActNpc132(NPCHAR *)::C.16;
_UNKNOWN ActNpc129(NPCHAR *)::C.13;
_UNKNOWN ActNpc128(NPCHAR *)::C.9;
_UNKNOWN ActNpc128(NPCHAR *)::C.10;
_UNKNOWN ActNpc128(NPCHAR *)::C.11;
_UNKNOWN ActNpc128(NPCHAR *)::C.12;
_UNKNOWN ActNpc126(NPCHAR *)::C.4;
_UNKNOWN ActNpc126(NPCHAR *)::C.5;
_UNKNOWN ActNpc122(NPCHAR *)::C.1;
_UNKNOWN ActNpc122(NPCHAR *)::C.2;
char aUMaxim[9] = "\x93\xB4\x8CA\x95\xA8\x8C";
const SystemTask::key_mapping_t SystemTask(void)::mapping[15] =
{
  { SDLK_LEFT, 1 },
  { SDLK_RIGHT, 2 },
  { SDLK_UP, 4 },
  { SDLK_DOWN, 8 },
  { SDLK_w, 16 },
  { SDLK_x, 32 },
  { SDLK_z, 64 },
  { SDLK_s, 128 },
  { SDLK_a, 256 },
  { SDLK_LSHIFT, 512 },
  { SDLK_RSHIFT, 512 },
  { SDLK_F1, 1024 },
  { SDLK_F2, 2048 },
  { SDLK_ESCAPE, 32768 },
  { SDLK_q, 4096 }
};
_UNKNOWN PutNumber4(long,long,long,bool)::C.0;
_UNKNOWN unk_814C220;
_UNKNOWN ActNpc169(NPCHAR *)::C.12;
_UNKNOWN ActNpc169(NPCHAR *)::C.13;
_UNKNOWN ActBossChar03_04(NPCHAR *)::C.2;
_UNKNOWN ActBossChar03_01(NPCHAR *)::C.0;
_UNKNOWN ActBossChar03_01(NPCHAR *)::C.1;
_UNKNOWN ActNpc094(NPCHAR *)::C.21;
_UNKNOWN ActNpc093(NPCHAR *)::C.18;
_UNKNOWN ActNpc093(NPCHAR *)::C.19;
_UNKNOWN ActNpc088(NPCHAR *)::C.14;
_UNKNOWN ActNpc088(NPCHAR *)::C.15;
_UNKNOWN ActNpc083(NPCHAR *)::C.12;
_UNKNOWN ActNpc083(NPCHAR *)::C.13;
_UNKNOWN ActNpc082(NPCHAR *)::C.8;
_UNKNOWN ActNpc082(NPCHAR *)::C.9;
_UNKNOWN ActNpc081(NPCHAR *)::C.2;
_UNKNOWN ActNpc081(NPCHAR *)::C.3;
_UNKNOWN ActNpc080(NPCHAR *)::C.0;
_UNKNOWN ActNpc080(NPCHAR *)::C.1;
_UNKNOWN ActNpc158(NPCHAR *)::C.21;
_UNKNOWN ActNpc150(NPCHAR *)::C.14;
_UNKNOWN ActNpc150(NPCHAR *)::C.15;
_UNKNOWN ActNpc147(NPCHAR *)::C.11;
_UNKNOWN ActNpc147(NPCHAR *)::C.12;
_UNKNOWN ActNpc146(NPCHAR *)::C.10;
_UNKNOWN ActNpc144(NPCHAR *)::C.7;
_UNKNOWN ActNpc144(NPCHAR *)::C.8;
_UNKNOWN ActNpc142(NPCHAR *)::C.6;
_UNKNOWN ActNpc140(NPCHAR *)::C.0;
_UNKNOWN ActNpc140(NPCHAR *)::C.1;
_UNKNOWN ActNpc016(NPCHAR *)::C.18;
_UNKNOWN ActNpc012(NPCHAR *)::C.15;
_UNKNOWN ActNpc012(NPCHAR *)::C.16;
_UNKNOWN ActNpc006(NPCHAR *)::C.6;
_UNKNOWN ActNpc006(NPCHAR *)::C.7;
_UNKNOWN ActNpc004(NPCHAR *)::C.4;
_UNKNOWN ActNpc004(NPCHAR *)::C.5;
_UNKNOWN ActNpc002(NPCHAR *)::C.2;
_UNKNOWN ActNpc002(NPCHAR *)::C.3;
_UNKNOWN ActNpc001(NPCHAR *)::C.1;
int _CTOR_LIST__ = 4294967295;
int _DTOR_LIST__[] = { 4294967295 };
_UNKNOWN _DTOR_END__;
int _JCR_LIST__ = 0;
int magnification = 1;
char *_credit_script = "Credit.tsc";

__int16 octfreq[12] = { 1, 2, 4, 8, 16, 32, 64, 128, 0, 0, 0, 0 };
__int16 notefreq[12] = { 262, 277, 294, 311, 330, 349, 370, 392, 415, 440, 466, 494 };
$296577AB1FDEBC0CA4D43AF2DF231431 gPtpTable[139] =
{
  {
    1,
    5000,
    { 5,  10.0, 32, 0 },
    { 4,  4.0, 32, 0 },
    { 0,  0.0, 63, 0 },
    63,
    6,
    63,
    45,
    8,
    119,
    46
  },
  {
    1,
    1000,
    { 0,  4.0, 32, 0 },
    { 3,  1.0, 63, 0 },
    { 0,  0.0, 63, 0 },
    63,
    64,
    63,
    128,
    63,
    255,
    63
  },
  {
    1,
    10000,
    { 0,  30.0, 32, 0 },
    { 3,  1.0, 32, 0 },
    { 0,  0.0, 63, 0 },
    0,
    19,
    44,
    111,
    13,
    198,
    9
  },
  {
    1,
    10000,
    { 5,  2.0, 31, 0 },
    { 3,  1.0, 57, 219 },
    { 0,  2.0, 32, 0 },
    0,
    19,
    44,
    111,
    13,
    198,
    9
  },
  {
    1,
    4000,
    { 5,  0.40000001, 32, 0 },
    { 3,  1.0, 53, 0 },
    { 0,  0.0, 63, 0 },
    12,
    19,
    63,
    111,
    21,
    198,
    18
  },
  {
    1,
    1000,
    { 1,  12.0, 32, 0 },
    { 2,  1.0, 63, 0 },
    { 0,  0.0, 63, 0 },
    63,
    64,
    63,
    128,
    63,
    255,
    0
  },
  {
    1,
    1000,
    { 5,  1.0, 32, 0 },
    { 3,  1.0, 63, 0 },
    { 0,  0.0, 63, 0 },
    0,
    28,
    63,
    53,
    31,
    210,
    31
  },
  {
    1,
    1000,
    { 1,  5.0, 32, 0 },
    { 3,  1.0, 63, 0 },
    { 0,  0.0, 0, 0 },
    63,
    64,
    63,
    128,
    31,
    255,
    0
  },
  {
    1,
    3000,
    { 1,  17.0, 34, 0 },
    { 3,  2.0, 40, 0 },
    { 4,  1.0, 31, 0 },
    63,
    64,
    63,
    225,
    63,
    255,
    0
  },
  {
    1,
    6000,
    { 1,  930.0, 22, 0 },
    { 0,  0.69999999, 53, 0 },
    { 0,  7.0, 32, 0 },
    63,
    64,
    63,
    202,
    63,
    255,
    0
  },
  {
    1,
    6000,
    { 1,  918.0, 23, 0 },
    { 0,  0.69999999, 53, 0 },
    { 0,  7.0, 32, 0 },
    63,
    64,
    63,
    202,
    63,
    255,
    0
  },
  {
    1,
    10000,
    { 2,  200.0, 32, 0 },
    { 0,  1.0, 51, 0 },
    { 1,  20.0, 31, 0 },
    63,
    64,
    63,
    89,
    30,
    208,
    28
  },
  {
    1,
    10000,
    { 5,  23.0, 16, 0 },
    { 0,  1.0, 58, 0 },
    { 1,  17.0, 32, 0 },
    63,
    64,
    63,
    96,
    51,
    202,
    31
  },
  {
    1,
    20000,
    { 2,  100.0, 21, 0 },
    { 0,  1.0, 46, 0 },
    { 1,  40.0, 32, 0 },
    63,
    64,
    63,
    128,
    63,
    162,
    0
  },
  {
    1,
    20000,
    { 5,  5.0, 21, 0 },
    { 0,  1.0, 51, 0 },
    { 1,  40.0, 32, 0 },
    63,
    64,
    63,
    128,
    63,
    162,
    28
  },
  {
    1,
    10000,
    { 5,  20.0, 23, 0 },
    { 3,  0.69999999, 26, 235 },
    { 5,  1.0, 9, 0 },
    63,
    38,
    55,
    87,
    32,
    98,
    29
  },
  {
    1,
    2000,
    { 1,  20.0, 32, 0 },
    { 3,  2.0, 63, 0 },
    { 4,  1.0, 29, 0 },
    63,
    64,
    63,
    128,
    63,
    255,
    63
  },
  {
    1,
    15000,
    { 5,  10.0, 32, 0 },
    { 3,  0.69999999, 26, 235 },
    { 0,  0.0, 63, 0 },
    63,
    38,
    55,
    187,
    15,
    255,
    0
  },
  {
    1,
    4000,
    { 1,  20.0, 32, 0 },
    { 3,  2.0, 63, 0 },
    { 4,  1.0, 29, 0 },
    63,
    64,
    63,
    128,
    63,
    255,
    63
  },
  {
    1,
    22000,
    { 5,  6.0, 32, 0 },
    { 3,  0.69999999, 26, 246 },
    { 0,  0.0, 63, 0 },
    63,
    38,
    55,
    187,
    15,
    255,
    0
  },
  {
    1,
    8000,
    { 0,  20.0, 32, 0 },
    { 3,  2.0, 63, 0 },
    { 4,  1.0, 29, 0 },
    63,
    64,
    63,
    128,
    63,
    255,
    63
  },
  {
    1,
    10000,
    { 4,  400.0, 13, 0 },
    { 0,  0.80000001, 63, 0 },
    { 4,  8.0, 31, 0 },
    63,
    64,
    63,
    191,
    32,
    255,
    0
  },
  {
    1,
    10000,
    { 4,  800.0, 14, 0 },
    { 0,  0.80000001, 63, 0 },
    { 4,  8.0, 30, 125 },
    63,
    64,
    63,
    128,
    63,
    166,
    0
  },
  {
    1,
    5000,
    { 2,  50.0, 39, 0 },
    { 3,  0.5, 40, 217 },
    { 1,  0.0, 32, 0 },
    63,
    64,
    63,
    128,
    34,
    198,
    32
  },
  {
    1,
    5000,
    { 5,  10.0, 39, 0 },
    { 3,  0.5, 24, 217 },
    { 1,  4.0, 32, 0 },
    0,
    4,
    63,
    128,
    34,
    198,
    32
  },
  {
    1,
    40000,
    { 5,  10.0, 32, 0 },
    { 3,  1.0, 32, 241 },
    { 0,  0.0, 32, 0 },
    63,
    64,
    63,
    128,
    63,
    255,
    0
  },
  {
    1,
    40000,
    { 5,  20.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    { 5,  0.1, 32, 0 },
    63,
    64,
    63,
    128,
    63,
    255,
    0
  },
  {
    1,
    30000,
    { 2,  400.0, 32, 0 },
    { 3,  0.30000001, 60, 250 },
    { 0,  20.0, 32, 0 },
    63,
    64,
    63,
    128,
    63,
    255,
    0
  },
  {
    1,
    10000,
    { 4,  400.0, 13, 0 },
    { 0,  0.80000001, 63, 0 },
    { 4,  8.0, 50, 0 },
    63,
    64,
    63,
    191,
    32,
    255,
    0
  },
  {
    1,
    10000,
    { 4,  800.0, 5, 0 },
    { 0,  0.80000001, 63, 0 },
    { 4,  8.0, 63, 125 },
    63,
    64,
    63,
    128,
    63,
    166,
    0
  },
  {
    1,
    6000,
    { 3,  123.0, 32, 0 },
    { 4,  1.0, 16, 222 },
    { 4,  4.0, 37, 0 },
    0,
    6,
    63,
    104,
    25,
    255,
    0
  },
  {
    1,
    4000,
    { 5,  4.5, 32, 0 },
    { 3,  1.0, 46, 102 },
    { 3,  2.5, 47, 0 },
    63,
    64,
    63,
    128,
    63,
    255,
    0
  },
  {
    1,
    5000,
    { 4,  40.0, 52, 0 },
    { 2,  1.0, 63, 0 },
    { 3,  10.0, 63, 0 },
    63,
    47,
    27,
    47,
    29,
    255,
    0
  },
  {
    1,
    3000,
    { 0,  99.0, 32, 0 },
    { 2,  1.0, 55, 197 },
    { 5,  0.0, 0, 0 },
    63,
    0,
    63,
    164,
    28,
    255,
    0
  },
  {
    1,
    10000,
    { 1,  601.0, 32, 0 },
    { 4,  0.5, 15, 235 },
    { 0,  10.0, 54, 0 },
    63,
    0,
    63,
    0,
    63,
    255,
    0
  },
  {
    1,
    8000,
    { 5,  10.0, 15, 0 },
    { 4,  0.5, 16, 239 },
    { 4,  0.0, 50, 0 },
    63,
    0,
    63,
    96,
    17,
    255,
    0
  },
  {
    1,
    20000,
    { 1,  832.0, 32, 0 },
    { 2,  1.0, 46, 0 },
    { 0,  27.0, 63, 0 },
    63,
    0,
    63,
    140,
    10,
    255,
    0
  },
  {
    1,
    20000,
    { 1,  918.0, 32, 0 },
    { 2,  1.0, 46, 0 },
    { 0,  21.0, 63, 0 },
    63,
    0,
    63,
    140,
    10,
    255,
    0
  },
  {
    1,
    4000,
    { 1,  54.0, 32, 0 },
    { 5,  0.1, 33, 0 },
    { 0,  0.0, 32, 0 },
    53,
    57,
    44,
    128,
    24,
    255,
    0
  },
  {
    1,
    10000,
    { 1,  246.0, 23, 0 },
    { 4,  0.60000002, 22, 239 },
    { 4,  6.0, 63, 0 },
    0,
    11,
    63,
    13,
    63,
    255,
    0
  },
  {
    1,
    10000,
    { 1,  294.0, 23, 0 },
    { 4,  0.60000002, 22, 247 },
    { 4,  6.0, 63, 140 },
    0,
    15,
    63,
    17,
    63,
    255,
    0
  },
  {
    1,
    22050,
    { 0,  117.0, 63, 0 },
    { 5,  2.0, 18, 0 },
    { 5,  0.0, 0, 0 },
    63,
    0,
    63,
    64,
    19,
    255,
    0
  },
  {
    1,
    5000,
    { 0,  28.0, 32, 0 },
    { 3,  3.0, 27, 0 },
    { 5,  0.0, 0, 0 },
    63,
    0,
    63,
    0,
    63,
    255,
    0
  },
  {
    1,
    10000,
    { 0,  322.0, 32, 0 },
    { 2,  8.0, 37, 0 },
    { 2,  0.0, 0, 0 },
    0,
    13,
    63,
    106,
    11,
    255,
    0
  },
  {
    1,
    10000,
    { 5,  7.3000002, 32, 0 },
    { 5,  0.2, 29, 0 },
    { 0,  0.0, 32, 0 },
    63,
    91,
    63,
    149,
    25,
    255,
    0
  },
  {
    1,
    1000,
    { 0,  6.0, 32, 0 },
    { 3,  1.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    63,
    64,
    63,
    128,
    63,
    255,
    63
  },
  {
    1,
    20000,
    { 2,  186.0, 32, 0 },
    { 0,  4.0, 13, 98 },
    { 3,  4.0, 5, 0 },
    63,
    64,
    28,
    255,
    0,
    255,
    0
  },
  {
    1,
    20000,
    { 2,  285.0, 19, 0 },
    { 3,  4.0, 21, 0 },
    { 3,  4.0, 33, 130 },
    63,
    64,
    63,
    255,
    0,
    255,
    0
  },
  {
    1,
    10000,
    { 0,  970.0, 32, 0 },
    { 2,  1.0, 35, 195 },
    { 0,  31.0, 31, 0 },
    63,
    64,
    63,
    128,
    63,
    255,
    0
  },
  {
    1,
    20000,
    { 5,  6.0, 32, 0 },
    { 3,  1.0, 54, 239 },
    { 0,  0.0, 32, 0 },
    63,
    64,
    63,
    128,
    63,
    255,
    35
  },
  {
    1,
    40000,
    { 5,  4.0, 32, 0 },
    { 3,  0.0, 32, 230 },
    { 0,  0.0, 32, 0 },
    63,
    64,
    63,
    128,
    63,
    255,
    0
  },
  {
    1,
    40000,
    { 1,  238.0, 32, 0 },
    { 3,  1.0, 14, 0 },
    { 4,  30.0, 32, 0 },
    63,
    64,
    63,
    128,
    63,
    255,
    0
  },
  {
    1,
    3000,
    { 2,  62.0, 32, 0 },
    { 2,  3.0, 63, 0 },
    { 3,  3.0, 14, 0 },
    63,
    0,
    63,
    210,
    32,
    255,
    0
  },
  {
    1,
    5000,
    { 2,  58.0, 32, 0 },
    { 2,  3.0, 63, 0 },
    { 2,  3.0, 32, 0 },
    63,
    0,
    63,
    49,
    27,
    255,
    0
  },
  {
    1,
    3000,
    { 0,  13.0, 24, 0 },
    { 3,  2.0, 40, 0 },
    { 4,  1.0, 31, 0 },
    63,
    64,
    63,
    225,
    63,
    255,
    0
  },
  {
    1,
    3000,
    { 5,  6.0, 32, 0 },
    { 5,  1.0, 32, 0 },
    { 3,  0.0, 0, 0 },
    0,
    0,
    63,
    45,
    23,
    255,
    0
  },
  {
    1,
    20000,
    { 1,  477.0, 40, 0 },
    { 5,  93.0, 39, 0 },
    { 4,  17.0, 19, 0 },
    0,
    64,
    63,
    128,
    63,
    255,
    0
  },
  {
    1,
    6000,
    { 5,  11.0, 32, 0 },
    { 5,  1.0, 32, 0 },
    { 3,  3.0, 32, 0 },
    63,
    0,
    63,
    0,
    63,
    255,
    0
  },
  {
    1,
    6000,
    { 1,  329.0, 20, 0 },
    { 2,  2.0, 47, 77 },
    { 3,  3.0, 63, 0 },
    63,
    64,
    63,
    128,
    63,
    255,
    0
  },
  {
    1,
    8000,
    { 4,  2000.0, 32, 0 },
    { 2,  1.0, 0, 0 },
    { 0,  0.0, 32, 0 },
    43,
    21,
    7,
    255,
    0,
    255,
    0
  },
  {
    1,
    5000,
    { 1,  231.0, 32, 0 },
    { 4,  1.0, 32, 65 },
    { 3,  2.0, 32, 0 },
    63,
    64,
    63,
    128,
    63,
    255,
    63
  },
  {
    1,
    3000,
    { 0,  107.0, 32, 0 },
    { 4,  1.0, 15, 0 },
    { 0,  0.0, 17, 0 },
    63,
    64,
    63,
    128,
    63,
    255,
    63
  },
  {
    1,
    20000,
    { 5,  4.0, 32, 0 },
    { 5,  1.0, 32, 170 },
    { 5,  0.0, 32, 0 },
    63,
    38,
    22,
    255,
    0,
    255,
    0
  },
  {
    1,
    5000,
    { 1,  16.0, 32, 0 },
    { 3,  1.0, 32, 238 },
    { 0,  0.0, 0, 0 },
    63,
    64,
    63,
    128,
    63,
    255,
    63
  },
  {
    1,
    20000,
    { 5,  4.0, 32, 0 },
    { 0,  0.69999999, 61, 43 },
    { 3,  1.0, 22, 224 },
    63,
    64,
    63,
    204,
    46,
    255,
    0
  },
  {
    1,
    5000,
    { 0,  880.0, 19, 0 },
    { 0,  0.0, 32, 0 },
    { 0,  8.0, 32, 0 },
    0,
    11,
    63,
    34,
    25,
    255,
    0
  },
  {
    1,
    2000,
    { 5,  3.0, 16, 0 },
    { 3,  2.0, 12, 0 },
    { 3,  1.0, 37, 0 },
    0,
    51,
    63,
    132,
    24,
    255,
    0
  },
  {
    1,
    22050,
    { 1,  400.0, 32, 0 },
    { 0,  20.0, 10, 0 },
    { 3,  10.0, 8, 0 },
    0,
    6,
    63,
    60,
    21,
    255,
    0
  },
  {
    1,
    2000,
    { 5,  2.0, 32, 0 },
    { 2,  3.0, 54, 0 },
    { 0,  0.0, 32, 0 },
    0,
    17,
    63,
    98,
    22,
    255,
    0
  },
  {
    1,
    8000,
    { 1,  814.0, 32, 0 },
    { 2,  11.0, 32, 0 },
    { 3,  16.0, 32, 0 },
    63,
    23,
    63,
    74,
    12,
    255,
    0
  },
  {
    1,
    10000,
    { 5,  21.0, 21, 0 },
    { 0,  5.0, 32, 178 },
    { 0,  3.0, 33, 181 },
    63,
    38,
    63,
    104,
    20,
    255,
    0
  },
  {
    1,
    6000,
    { 5,  1.0, 28, 0 },
    { 3,  6.0, 56, 0 },
    { 0,  8.0, 32, 0 },
    63,
    57,
    63,
    98,
    20,
    255,
    0
  },
  {
    1,
    4000,
    { 5,  6.0, 32, 0 },
    { 3,  2.0, 32, 0 },
    { 3,  2.0, 32, 0 },
    63,
    26,
    30,
    66,
    29,
    255,
    0
  },
  {
    1,
    22050,
    { 5,  711.0, 32, 0 },
    { 5,  7.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    0,
    13,
    0,
    17,
    63,
    255,
    0
  },
  {
    1,
    2000,
    { 5,  2.0, 32, 0 },
    { 5,  1.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    63,
    64,
    63,
    128,
    63,
    255,
    63
  },
  {
    1,
    62050,
    { 5,  40.0, 32, 0 },
    { 5,  1.0, 32, 0 },
    { 5,  0.0, 0, 0 },
    0,
    17,
    63,
    36,
    63,
    255,
    0
  },
  {
    1,
    8000,
    { 0,  77.0, 32, 0 },
    { 3,  3.0, 56, 189 },
    { 0,  0.0, 17, 0 },
    0,
    38,
    63,
    140,
    28,
    255,
    0
  },
  {
    1,
    8000,
    { 5,  8.0, 32, 0 },
    { 3,  3.0, 54, 189 },
    { 3,  3.0, 32, 0 },
    63,
    38,
    42,
    140,
    21,
    255,
    0
  },
  {
    1,
    9050,
    { 5,  9.0, 26, 0 },
    { 0,  1.0, 32, 209 },
    { 0,  0.0, 32, 0 },
    63,
    64,
    63,
    132,
    63,
    255,
    0
  },
  {
    1,
    9050,
    { 2,  43.0, 32, 0 },
    { 3,  1.0, 47, 172 },
    { 0,  0.0, 32, 0 },
    63,
    64,
    63,
    198,
    63,
    255,
    0
  },
  {
    1,
    22050,
    { 1,  754.0, 32, 0 },
    { 2,  0.5, 14, 126 },
    { 4,  18.0, 17, 0 },
    0,
    64,
    63,
    128,
    63,
    255,
    0
  },
  {
    1,
    22050,
    { 0,  597.0, 12, 0 },
    { 2,  0.5, 14, 126 },
    { 4,  18.0, 17, 0 },
    0,
    64,
    40,
    128,
    41,
    255,
    0
  },
  {
    1,
    6000,
    { 2,  217.0, 32, 0 },
    { 0,  0.69999999, 16, 0 },
    { 3,  0.0, 32, 0 },
    0,
    32,
    63,
    49,
    15,
    255,
    0
  },
  {
    1,
    5000,
    { 5,  1.0, 32, 0 },
    { 3,  1.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    0,
    64,
    63,
    81,
    28,
    255,
    0
  },
  {
    1,
    10000,
    { 5,  11.0, 32, 0 },
    { 2,  4.0, 32, 0 },
    { 0,  3.0, 32, 0 },
    0,
    64,
    63,
    128,
    30,
    255,
    0
  },
  {
    1,
    10000,
    { 5,  1.0, 32, 0 },
    { 4,  1.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    63,
    64,
    32,
    128,
    33,
    255,
    0
  },
  {
    1,
    10000,
    { 2,  168.0, 32, 0 },
    { 0,  0.5, 29, 173 },
    { 0,  0.0, 32, 0 },
    0,
    13,
    63,
    68,
    35,
    255,
    0
  },
  {
    1,
    10000,
    { 2,  50.0, 32, 0 },
    { 0,  0.5, 29, 173 },
    { 2,  100.0, 32, 0 },
    0,
    13,
    63,
    68,
    35,
    255,
    0
  },
  {
    1,
    4000,
    { 5,  11.0, 25, 0 },
    { 3,  3.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    0,
    9,
    63,
    128,
    14,
    255,
    0
  },
  {
    1,
    4000,
    { 5,  3.0, 27, 0 },
    { 3,  3.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    0,
    9,
    63,
    128,
    14,
    255,
    0
  },
  {
    1,
    3000,
    { 4,  9.0, 20, 0 },
    { 3,  3.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    63,
    64,
    63,
    128,
    63,
    255,
    0
  },
  {
    1,
    3000,
    { 4,  18.0, 20, 0 },
    { 3,  3.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    63,
    64,
    63,
    128,
    63,
    255,
    0
  },
  {
    1,
    3000,
    { 5,  4.0, 32, 0 },
    { 3,  1.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    0,
    64,
    63,
    128,
    63,
    255,
    0
  },
  {
    1,
    12000,
    { 5,  2.0, 32, 0 },
    { 3,  1.7, 53, 0 },
    { 0,  0.0, 32, 0 },
    63,
    64,
    63,
    162,
    25,
    255,
    0
  },
  {
    1,
    12000,
    { 3,  77.0, 32, 0 },
    { 3,  1.0, 61, 200 },
    { 0,  19.0, 22, 0 },
    63,
    64,
    63,
    172,
    25,
    255,
    0
  },
  {
    1,
    5000,
    { 0,  16.0, 63, 0 },
    { 3,  1.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    63,
    64,
    63,
    166,
    35,
    255,
    0
  },
  {
    1,
    1000,
    { 5,  1.0, 16, 0 },
    { 0,  1.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    63,
    64,
    63,
    91,
    28,
    255,
    0
  },
  {
    1,
    5000,
    { 0,  20.0, 30, 0 },
    { 3,  1.0, 44, 0 },
    { 0,  0.0, 32, 0 },
    63,
    64,
    63,
    111,
    19,
    255,
    0
  },
  {
    1,
    10000,
    { 5,  14.0, 41, 0 },
    { 5,  3.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    63,
    64,
    18,
    91,
    12,
    255,
    0
  },
  {
    1,
    1000,
    { 5,  48.0, 30, 0 },
    { 5,  1.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    63,
    64,
    63,
    166,
    27,
    255,
    0
  },
  {
    1,
    10000,
    { 5,  48.0, 30, 0 },
    { 5,  1.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    63,
    64,
    43,
    166,
    41,
    255,
    7
  },
  {
    1,
    4000,
    { 5,  35.0, 30, 0 },
    { 3,  35.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    63,
    53,
    21,
    166,
    13,
    255,
    0
  },
  {
    1,
    10000,
    { 1,  63.0, 32, 0 },
    { 3,  1.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    63,
    64,
    39,
    91,
    20,
    255,
    0
  },
  {
    1,
    22050,
    { 5,  52.0, 22, 0 },
    { 5,  1.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    3,
    23,
    23,
    57,
    10,
    255,
    0
  },
  {
    1,
    22050,
    { 5,  80.0, 22, 0 },
    { 5,  1.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    63,
    23,
    23,
    57,
    10,
    255,
    0
  },
  {
    1,
    44100,
    { 5,  54.0, 12, 0 },
    { 5,  1.0, 32, 0 },
    { 5,  1.0, 27, 0 },
    40,
    64,
    63,
    128,
    38,
    255,
    63
  },
  {
    1,
    44100,
    { 5,  119.0, 9, 0 },
    { 5,  2.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    61,
    64,
    39,
    128,
    60,
    255,
    28
  },
  {
    1,
    4000,
    { 5,  11.0, 32, 0 },
    { 5,  1.0, 17, 197 },
    { 0,  0.0, 32, 0 },
    51,
    100,
    63,
    100,
    0,
    255,
    0
  },
  {
    1,
    4000,
    { 5,  21.0, 32, 0 },
    { 5,  1.0, 17, 197 },
    { 0,  0.0, 32, 0 },
    0,
    119,
    0,
    117,
    63,
    255,
    0
  },
  {
    1,
    5000,
    { 2,  143.0, 25, 0 },
    { 3,  0.5, 40, 217 },
    { 1,  0.0, 32, 0 },
    63,
    64,
    63,
    128,
    34,
    198,
    32
  },
  {
    1,
    5000,
    { 5,  10.0, 23, 0 },
    { 3,  0.5, 24, 217 },
    { 1,  4.0, 32, 0 },
    0,
    4,
    63,
    128,
    34,
    198,
    32
  },
  {
    1,
    4000,
    { 5,  6.0, 32, 0 },
    { 3,  2.0, 32, 0 },
    { 3,  2.0, 32, 0 },
    63,
    26,
    30,
    66,
    29,
    255,
    0
  },
  {
    1,
    4000,
    { 0,  150.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    { 3,  2.0, 32, 0 },
    63,
    26,
    30,
    66,
    29,
    255,
    0
  },
  {
    1,
    40050,
    { 4,  100.0, 32, 0 },
    { 3,  8.0, 22, 0 },
    { 3,  8.0, 8, 0 },
    63,
    28,
    44,
    81,
    23,
    255,
    0
  },
  {
    1,
    40050,
    { 4,  150.0, 32, 0 },
    { 3,  8.0, 22, 0 },
    { 3,  8.0, 8, 0 },
    63,
    28,
    44,
    81,
    23,
    255,
    0
  },
  {
    1,
    40050,
    { 4,  294.0, 32, 0 },
    { 3,  8.0, 22, 0 },
    { 3,  8.0, 8, 0 },
    63,
    28,
    44,
    81,
    23,
    255,
    0
  },
  {
    1,
    5000,
    { 3,  621.0, 32, 0 },
    { 2,  2.0, 22, 0 },
    { 3,  6.0, 32, 0 },
    0,
    4,
    63,
    77,
    30,
    255,
    0
  },
  {
    1,
    30000,
    { 5,  28.0, 44, 0 },
    { 3,  1.0, 45, 0 },
    { 0,  0.0, 32, 0 },
    63,
    64,
    63,
    208,
    63,
    255,
    0
  },
  {
    1,
    30000,
    { 2,  101.0, 44, 0 },
    { 2,  0.5, 63, 118 },
    { 0,  0.0, 32, 0 },
    63,
    64,
    63,
    176,
    63,
    255,
    0
  },
  {
    1,
    30000,
    { 2,  86.0, 44, 0 },
    { 2,  0.5, 63, 118 },
    { 0,  0.0, 32, 0 },
    63,
    64,
    63,
    176,
    63,
    255,
    0
  },
  {
    1,
    2000,
    { 5,  1.0, 32, 0 },
    { 0,  1.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    63,
    64,
    63,
    128,
    63,
    255,
    63
  },
  {
    1,
    2000,
    { 3,  99.0, 12, 0 },
    { 3,  1.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    63,
    64,
    63,
    128,
    63,
    255,
    63
  },
  {
    1,
    6000,
    { 3,  388.0, 22, 0 },
    { 0,  0.69999999, 53, 0 },
    { 0,  7.0, 32, 0 },
    25,
    64,
    63,
    202,
    63,
    255,
    0
  },
  {
    1,
    6000,
    { 1,  918.0, 23, 0 },
    { 0,  0.69999999, 53, 0 },
    { 0,  7.0, 32, 0 },
    63,
    64,
    63,
    202,
    63,
    255,
    0
  },
  {
    1,
    10000,
    { 5,  118.0, 19, 0 },
    { 3,  1.0, 63, 0 },
    { 0,  3.0, 32, 0 },
    0,
    19,
    63,
    66,
    41,
    255,
    0
  },
  {
    1,
    10000,
    { 5,  6.0, 24, 0 },
    { 3,  1.0, 32, 208 },
    { 2,  8.0, 12, 0 },
    63,
    64,
    63,
    128,
    38,
    255,
    0
  },
  {
    1,
    400,
    { 1,  20.0, 12, 0 },
    { 0,  0.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    0,
    43,
    63,
    193,
    63,
    255,
    0
  },
  {
    1,
    400,
    { 1,  30.0, 12, 0 },
    { 0,  0.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    0,
    43,
    63,
    193,
    63,
    255,
    0
  },
  {
    1,
    400,
    { 1,  40.0, 12, 0 },
    { 0,  0.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    0,
    43,
    63,
    193,
    63,
    255,
    0
  },
  {
    1,
    8000,
    { 3,  800.0, 24, 0 },
    { 0,  8.0, 4, 0 },
    { 0,  0.0, 32, 0 },
    0,
    13,
    63,
    138,
    63,
    255,
    0
  },
  {
    1,
    8000,
    { 5,  53.0, 12, 0 },
    { 5,  1.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    0,
    0,
    63,
    68,
    63,
    255,
    0
  },
  {
    1,
    8000,
    { 3,  400.0, 24, 0 },
    { 0,  8.0, 4, 0 },
    { 0,  0.0, 32, 0 },
    0,
    13,
    63,
    138,
    63,
    255,
    0
  },
  {
    1,
    8000,
    { 5,  53.0, 12, 0 },
    { 5,  1.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    0,
    0,
    63,
    68,
    63,
    255,
    0
  },
  {
    1,
    8000,
    { 3,  200.0, 32, 0 },
    { 0,  8.0, 4, 0 },
    { 0,  0.0, 32, 0 },
    0,
    13,
    63,
    138,
    63,
    255,
    0
  },
  {
    1,
    8000,
    { 5,  25.0, 17, 0 },
    { 3,  1.0, 32, 0 },
    { 0,  0.0, 32, 0 },
    0,
    0,
    63,
    68,
    63,
    255,
    0
  },
  {
    1,
    8000,
    { 4,  800.0, 32, 0 },
    { 4,  2.0, 21, 0 },
    { 4,  8.0, 32, 0 },
    0,
    106,
    63,
    130,
    27,
    255,
    0
  },
  {
    1,
    3000,
    { 4,  31.0, 10, 0 },
    { 3,  2.0, 40, 0 },
    { 4,  1.0, 31, 0 },
    0,
    9,
    63,
    94,
    63,
    255,
    0
  },
  {
    1,
    5000,
    { 2,  168.0, 32, 0 },
    { 0,  0.5, 29, 173 },
    { 0,  0.0, 32, 0 },
    0,
    13,
    63,
    68,
    35,
    255,
    0
  },
  {
    1,
    1000,
    { 0,  20.0, 0, 0 },
    { 0,  0.0, 0, 0 },
    { 0,  0.0, 0, 0 },
    0,
    64,
    0,
    128,
    0,
    255,
    0
  }
};
$296577AB1FDEBC0CA4D43AF2DF231431 ptp =
{
  1,
  10000,
  { 0,  30.0, 32, 0 },
  { 3,  1.0, 32, 0 },
  { 0,  0.0, 63, 0 },
  0,
  19,
  44,
  111,
  13,
  198,
  9
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BE310 =
{
  1,
  4000,
  { 5,  0.40000001, 32, 0 },
  { 3,  1.0, 53, 0 },
  { 0,  0.0, 63, 0 },
  12,
  19,
  63,
  111,
  21,
  198,
  18
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BE3B8 =
{
  1,
  1000,
  { 5,  1.0, 32, 0 },
  { 3,  1.0, 63, 0 },
  { 0,  0.0, 63, 0 },
  0,
  28,
  63,
  53,
  31,
  210,
  31
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BE40C =
{
  1,
  1000,
  { 1,  5.0, 32, 0 },
  { 3,  1.0, 63, 0 },
  { 0,  0.0, 0, 0 },
  63,
  64,
  63,
  128,
  31,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BE460 =
{
  1,
  3000,
  { 1,  17.0, 34, 0 },
  { 3,  2.0, 40, 0 },
  { 4,  1.0, 31, 0 },
  63,
  64,
  63,
  225,
  63,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BE4B4 =
{
  1,
  6000,
  { 1,  930.0, 22, 0 },
  { 0,  0.69999999, 53, 0 },
  { 0,  7.0, 32, 0 },
  63,
  64,
  63,
  202,
  63,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BE55C =
{
  1,
  10000,
  { 2,  200.0, 32, 0 },
  { 0,  1.0, 51, 0 },
  { 1,  20.0, 31, 0 },
  63,
  64,
  63,
  89,
  30,
  208,
  28
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BE604 =
{
  1,
  20000,
  { 2,  100.0, 21, 0 },
  { 0,  1.0, 46, 0 },
  { 1,  40.0, 32, 0 },
  63,
  64,
  63,
  128,
  63,
  162,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BE6AC =
{
  1,
  10000,
  { 5,  20.0, 23, 0 },
  { 3,  0.69999999, 26, 235 },
  { 5,  1.0, 9, 0 },
  63,
  38,
  55,
  87,
  32,
  98,
  29
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BE754 =
{
  1,
  15000,
  { 5,  10.0, 32, 0 },
  { 3,  0.69999999, 26, 235 },
  { 0,  0.0, 63, 0 },
  63,
  38,
  55,
  187,
  15,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BE7FC =
{
  1,
  22000,
  { 5,  6.0, 32, 0 },
  { 3,  0.69999999, 26, 246 },
  { 0,  0.0, 63, 0 },
  63,
  38,
  55,
  187,
  15,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BE94C =
{
  1,
  5000,
  { 2,  50.0, 39, 0 },
  { 3,  0.5, 40, 217 },
  { 1,  0.0, 32, 0 },
  63,
  64,
  63,
  128,
  34,
  198,
  32
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BE9F4 =
{
  1,
  40000,
  { 5,  10.0, 32, 0 },
  { 3,  1.0, 32, 241 },
  { 0,  0.0, 32, 0 },
  63,
  64,
  63,
  128,
  63,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BEAF0 =
{
  1,
  10000,
  { 4,  400.0, 13, 0 },
  { 0,  0.80000001, 63, 0 },
  { 4,  8.0, 50, 0 },
  63,
  64,
  63,
  191,
  32,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BEB98 =
{
  1,
  6000,
  { 3,  123.0, 32, 0 },
  { 4,  1.0, 16, 222 },
  { 4,  4.0, 37, 0 },
  0,
  6,
  63,
  104,
  25,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BEBEC =
{
  1,
  4000,
  { 5,  4.5, 32, 0 },
  { 3,  1.0, 46, 102 },
  { 3,  2.5, 47, 0 },
  63,
  64,
  63,
  128,
  63,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BEC40 =
{
  1,
  5000,
  { 4,  40.0, 52, 0 },
  { 2,  1.0, 63, 0 },
  { 3,  10.0, 63, 0 },
  63,
  47,
  27,
  47,
  29,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BEC94 =
{
  1,
  3000,
  { 0,  99.0, 32, 0 },
  { 2,  1.0, 55, 197 },
  { 5,  0.0, 0, 0 },
  63,
  0,
  63,
  164,
  28,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BECE8 =
{
  1,
  10000,
  { 1,  601.0, 32, 0 },
  { 4,  0.5, 15, 235 },
  { 0,  10.0, 54, 0 },
  63,
  0,
  63,
  0,
  63,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BED3C =
{
  1,
  8000,
  { 5,  10.0, 15, 0 },
  { 4,  0.5, 16, 239 },
  { 4,  0.0, 50, 0 },
  63,
  0,
  63,
  96,
  17,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BED90 =
{
  1,
  20000,
  { 1,  832.0, 32, 0 },
  { 2,  1.0, 46, 0 },
  { 0,  27.0, 63, 0 },
  63,
  0,
  63,
  140,
  10,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BEE38 =
{
  1,
  4000,
  { 1,  54.0, 32, 0 },
  { 5,  0.1, 33, 0 },
  { 0,  0.0, 32, 0 },
  53,
  57,
  44,
  128,
  24,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BEE8C =
{
  1,
  10000,
  { 1,  246.0, 23, 0 },
  { 4,  0.60000002, 22, 239 },
  { 4,  6.0, 63, 0 },
  0,
  11,
  63,
  13,
  63,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BEF34 =
{
  1,
  22050,
  { 0,  117.0, 63, 0 },
  { 5,  2.0, 18, 0 },
  { 5,  0.0, 0, 0 },
  63,
  0,
  63,
  64,
  19,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BEFDC =
{
  1,
  10000,
  { 0,  322.0, 32, 0 },
  { 2,  8.0, 37, 0 },
  { 2,  0.0, 0, 0 },
  0,
  13,
  63,
  106,
  11,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BF030 =
{
  1,
  10000,
  { 5,  7.3000002, 32, 0 },
  { 5,  0.2, 29, 0 },
  { 0,  0.0, 32, 0 },
  63,
  91,
  63,
  149,
  25,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BF0D8 =
{
  1,
  20000,
  { 2,  186.0, 32, 0 },
  { 0,  4.0, 13, 98 },
  { 3,  4.0, 5, 0 },
  63,
  64,
  28,
  255,
  0,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BF180 =
{
  1,
  10000,
  { 0,  970.0, 32, 0 },
  { 2,  1.0, 35, 195 },
  { 0,  31.0, 31, 0 },
  63,
  64,
  63,
  128,
  63,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BF1D4 =
{
  1,
  20000,
  { 5,  6.0, 32, 0 },
  { 3,  1.0, 54, 239 },
  { 0,  0.0, 32, 0 },
  63,
  64,
  63,
  128,
  63,
  255,
  35
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BF2D0 =
{
  1,
  3000,
  { 2,  62.0, 32, 0 },
  { 2,  3.0, 63, 0 },
  { 3,  3.0, 14, 0 },
  63,
  0,
  63,
  210,
  32,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BF378 =
{
  1,
  3000,
  { 0,  13.0, 24, 0 },
  { 3,  2.0, 40, 0 },
  { 4,  1.0, 31, 0 },
  63,
  64,
  63,
  225,
  63,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BF420 =
{
  1,
  20000,
  { 1,  477.0, 40, 0 },
  { 5,  93.0, 39, 0 },
  { 4,  17.0, 19, 0 },
  0,
  64,
  63,
  128,
  63,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BF474 =
{
  1,
  6000,
  { 5,  11.0, 32, 0 },
  { 5,  1.0, 32, 0 },
  { 3,  3.0, 32, 0 },
  63,
  0,
  63,
  0,
  63,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BF51C =
{
  1,
  8000,
  { 4,  2000.0, 32, 0 },
  { 2,  1.0, 0, 0 },
  { 0,  0.0, 32, 0 },
  43,
  21,
  7,
  255,
  0,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BF570 =
{
  1,
  5000,
  { 1,  231.0, 32, 0 },
  { 4,  1.0, 32, 65 },
  { 3,  2.0, 32, 0 },
  63,
  64,
  63,
  128,
  63,
  255,
  63
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BF5C4 =
{
  1,
  3000,
  { 0,  107.0, 32, 0 },
  { 4,  1.0, 15, 0 },
  { 0,  0.0, 17, 0 },
  63,
  64,
  63,
  128,
  63,
  255,
  63
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BF618 =
{
  1,
  20000,
  { 5,  4.0, 32, 0 },
  { 5,  1.0, 32, 170 },
  { 5,  0.0, 32, 0 },
  63,
  38,
  22,
  255,
  0,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BF714 =
{
  1,
  5000,
  { 0,  880.0, 19, 0 },
  { 0,  0.0, 32, 0 },
  { 0,  8.0, 32, 0 },
  0,
  11,
  63,
  34,
  25,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BF768 =
{
  1,
  2000,
  { 5,  3.0, 16, 0 },
  { 3,  2.0, 12, 0 },
  { 3,  1.0, 37, 0 },
  0,
  51,
  63,
  132,
  24,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BF810 =
{
  1,
  2000,
  { 5,  2.0, 32, 0 },
  { 2,  3.0, 54, 0 },
  { 0,  0.0, 32, 0 },
  0,
  17,
  63,
  98,
  22,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BF864 =
{
  1,
  8000,
  { 1,  814.0, 32, 0 },
  { 2,  11.0, 32, 0 },
  { 3,  16.0, 32, 0 },
  63,
  23,
  63,
  74,
  12,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BF8B8 =
{
  1,
  10000,
  { 5,  21.0, 21, 0 },
  { 0,  5.0, 32, 178 },
  { 0,  3.0, 33, 181 },
  63,
  38,
  63,
  104,
  20,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BF960 =
{
  1,
  4000,
  { 5,  6.0, 32, 0 },
  { 3,  2.0, 32, 0 },
  { 3,  2.0, 32, 0 },
  63,
  26,
  30,
  66,
  29,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BF9B4 =
{
  1,
  22050,
  { 5,  711.0, 32, 0 },
  { 5,  7.0, 32, 0 },
  { 0,  0.0, 32, 0 },
  0,
  13,
  0,
  17,
  63,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BFAB0 =
{
  1,
  8000,
  { 0,  77.0, 32, 0 },
  { 3,  3.0, 56, 189 },
  { 0,  0.0, 17, 0 },
  0,
  38,
  63,
  140,
  28,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BFB58 =
{
  1,
  9050,
  { 5,  9.0, 26, 0 },
  { 0,  1.0, 32, 209 },
  { 0,  0.0, 32, 0 },
  63,
  64,
  63,
  132,
  63,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BFC00 =
{
  1,
  22050,
  { 1,  754.0, 32, 0 },
  { 2,  0.5, 14, 126 },
  { 4,  18.0, 17, 0 },
  0,
  64,
  63,
  128,
  63,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BFC54 =
{
  1,
  22050,
  { 0,  597.0, 12, 0 },
  { 2,  0.5, 14, 126 },
  { 4,  18.0, 17, 0 },
  0,
  64,
  40,
  128,
  41,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BFCA8 =
{
  1,
  6000,
  { 2,  217.0, 32, 0 },
  { 0,  0.69999999, 16, 0 },
  { 3,  0.0, 32, 0 },
  0,
  32,
  63,
  49,
  15,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BFCFC =
{
  1,
  5000,
  { 5,  1.0, 32, 0 },
  { 3,  1.0, 32, 0 },
  { 0,  0.0, 32, 0 },
  0,
  64,
  63,
  81,
  28,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BFDA4 =
{
  1,
  10000,
  { 5,  1.0, 32, 0 },
  { 4,  1.0, 32, 0 },
  { 0,  0.0, 32, 0 },
  63,
  64,
  32,
  128,
  33,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BFDF8 =
{
  1,
  10000,
  { 2,  168.0, 32, 0 },
  { 0,  0.5, 29, 173 },
  { 0,  0.0, 32, 0 },
  0,
  13,
  63,
  68,
  35,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BFE4C =
{
  1,
  10000,
  { 2,  50.0, 32, 0 },
  { 0,  0.5, 29, 173 },
  { 2,  100.0, 32, 0 },
  0,
  13,
  63,
  68,
  35,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BFEA0 =
{
  1,
  4000,
  { 5,  11.0, 25, 0 },
  { 3,  3.0, 32, 0 },
  { 0,  0.0, 32, 0 },
  0,
  9,
  63,
  128,
  14,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BFEF4 =
{
  1,
  4000,
  { 5,  3.0, 27, 0 },
  { 3,  3.0, 32, 0 },
  { 0,  0.0, 32, 0 },
  0,
  9,
  63,
  128,
  14,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BFF48 =
{
  1,
  3000,
  { 4,  9.0, 20, 0 },
  { 3,  3.0, 32, 0 },
  { 0,  0.0, 32, 0 },
  63,
  64,
  63,
  128,
  63,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BFF9C =
{
  1,
  3000,
  { 4,  18.0, 20, 0 },
  { 3,  3.0, 32, 0 },
  { 0,  0.0, 32, 0 },
  63,
  64,
  63,
  128,
  63,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81BFFF0 =
{
  1,
  3000,
  { 5,  4.0, 32, 0 },
  { 3,  1.0, 32, 0 },
  { 0,  0.0, 32, 0 },
  0,
  64,
  63,
  128,
  63,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C0044 =
{
  1,
  12000,
  { 5,  2.0, 32, 0 },
  { 3,  1.7, 53, 0 },
  { 0,  0.0, 32, 0 },
  63,
  64,
  63,
  162,
  25,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C00EC =
{
  1,
  5000,
  { 0,  16.0, 63, 0 },
  { 3,  1.0, 32, 0 },
  { 0,  0.0, 32, 0 },
  63,
  64,
  63,
  166,
  35,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C0194 =
{
  1,
  5000,
  { 0,  20.0, 30, 0 },
  { 3,  1.0, 44, 0 },
  { 0,  0.0, 32, 0 },
  63,
  64,
  63,
  111,
  19,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C023C =
{
  1,
  1000,
  { 5,  48.0, 30, 0 },
  { 5,  1.0, 32, 0 },
  { 0,  0.0, 32, 0 },
  63,
  64,
  63,
  166,
  27,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C0290 =
{
  1,
  10000,
  { 5,  48.0, 30, 0 },
  { 5,  1.0, 32, 0 },
  { 0,  0.0, 32, 0 },
  63,
  64,
  43,
  166,
  41,
  255,
  7
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C02E4 =
{
  1,
  4000,
  { 5,  35.0, 30, 0 },
  { 3,  35.0, 32, 0 },
  { 0,  0.0, 32, 0 },
  63,
  53,
  21,
  166,
  13,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C038C =
{
  1,
  22050,
  { 5,  52.0, 22, 0 },
  { 5,  1.0, 32, 0 },
  { 0,  0.0, 32, 0 },
  3,
  23,
  23,
  57,
  10,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C0434 =
{
  1,
  44100,
  { 5,  54.0, 12, 0 },
  { 5,  1.0, 32, 0 },
  { 5,  1.0, 27, 0 },
  40,
  64,
  63,
  128,
  38,
  255,
  63
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C04DC =
{
  1,
  4000,
  { 5,  11.0, 32, 0 },
  { 5,  1.0, 17, 197 },
  { 0,  0.0, 32, 0 },
  51,
  100,
  63,
  100,
  0,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C0584 =
{
  1,
  5000,
  { 2,  143.0, 25, 0 },
  { 3,  0.5, 40, 217 },
  { 1,  0.0, 32, 0 },
  63,
  64,
  63,
  128,
  34,
  198,
  32
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C062C =
{
  1,
  4000,
  { 5,  6.0, 32, 0 },
  { 3,  2.0, 32, 0 },
  { 3,  2.0, 32, 0 },
  63,
  26,
  30,
  66,
  29,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C06D4 =
{
  1,
  40050,
  { 4,  100.0, 32, 0 },
  { 3,  8.0, 22, 0 },
  { 3,  8.0, 8, 0 },
  63,
  28,
  44,
  81,
  23,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C07D0 =
{
  1,
  5000,
  { 3,  621.0, 32, 0 },
  { 2,  2.0, 22, 0 },
  { 3,  6.0, 32, 0 },
  0,
  4,
  63,
  77,
  30,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C0824 =
{
  1,
  30000,
  { 5,  28.0, 44, 0 },
  { 3,  1.0, 45, 0 },
  { 0,  0.0, 32, 0 },
  63,
  64,
  63,
  208,
  63,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C0920 =
{
  1,
  2000,
  { 5,  1.0, 32, 0 },
  { 0,  1.0, 32, 0 },
  { 0,  0.0, 32, 0 },
  63,
  64,
  63,
  128,
  63,
  255,
  63
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C09C8 =
{
  1,
  6000,
  { 3,  388.0, 22, 0 },
  { 0,  0.69999999, 53, 0 },
  { 0,  7.0, 32, 0 },
  25,
  64,
  63,
  202,
  63,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C0A70 =
{
  1,
  10000,
  { 5,  118.0, 19, 0 },
  { 3,  1.0, 63, 0 },
  { 0,  3.0, 32, 0 },
  0,
  19,
  63,
  66,
  41,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C0B18 =
{
  1,
  400,
  { 1,  20.0, 12, 0 },
  { 0,  0.0, 32, 0 },
  { 0,  0.0, 32, 0 },
  0,
  43,
  63,
  193,
  63,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C0B6C =
{
  1,
  400,
  { 1,  30.0, 12, 0 },
  { 0,  0.0, 32, 0 },
  { 0,  0.0, 32, 0 },
  0,
  43,
  63,
  193,
  63,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C0BC0 =
{
  1,
  400,
  { 1,  40.0, 12, 0 },
  { 0,  0.0, 32, 0 },
  { 0,  0.0, 32, 0 },
  0,
  43,
  63,
  193,
  63,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C0C14 =
{
  1,
  8000,
  { 3,  800.0, 24, 0 },
  { 0,  8.0, 4, 0 },
  { 0,  0.0, 32, 0 },
  0,
  13,
  63,
  138,
  63,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C0CBC =
{
  1,
  8000,
  { 3,  400.0, 24, 0 },
  { 0,  8.0, 4, 0 },
  { 0,  0.0, 32, 0 },
  0,
  13,
  63,
  138,
  63,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C0D64 =
{
  1,
  8000,
  { 3,  200.0, 32, 0 },
  { 0,  8.0, 4, 0 },
  { 0,  0.0, 32, 0 },
  0,
  13,
  63,
  138,
  63,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C0E0C =
{
  1,
  8000,
  { 4,  800.0, 32, 0 },
  { 4,  2.0, 21, 0 },
  { 4,  8.0, 32, 0 },
  0,
  106,
  63,
  130,
  27,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C0E60 =
{
  1,
  3000,
  { 4,  31.0, 10, 0 },
  { 3,  2.0, 40, 0 },
  { 4,  1.0, 31, 0 },
  0,
  9,
  63,
  94,
  63,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C0EB4 =
{
  1,
  5000,
  { 2,  168.0, 32, 0 },
  { 0,  0.5, 29, 173 },
  { 0,  0.0, 32, 0 },
  0,
  13,
  63,
  68,
  35,
  255,
  0
};
$296577AB1FDEBC0CA4D43AF2DF231431 stru_81C0F08 =
{
  1,
  1000,
  { 0,  20.0, 0, 0 },
  { 0,  0.0, 0, 0 },
  { 0,  0.0, 0, 0 },
  0,
  64,
  0,
  128,
  0,
  255,
  0
};
$105B29886D5D4880B7955C7D7F8771E6 gBulTbl[46] =
{
  { '\0', '\0', 0, 0, 0, 0, 0, 0, { 0, 0, 0, 0 } },
  { '\x04', '\x01', 20, 36, 4, 4, 2, 2, { 8, 8, 8, 8 } },
  { '\x06', '\x01', 23, 36, 4, 4, 2, 2, { 8, 8, 8, 8 } },
  { '\b', '\x01', 30, 36, 4, 4, 2, 2, { 8, 8, 8, 8 } },
  { '\x01', '\x01', 8, 32, 6, 6, 2, 2, { 8, 8, 8, 8 } },
  { '\x02', '\x01', 12, 32, 6, 6, 2, 2, { 8, 8, 8, 8 } },
  { '\x04', '\x01', 16, 32, 6, 6, 2, 2, { 8, 8, 8, 8 } },
  { '\x02', '\x02', 100, 8, 8, 16, 4, 2, { 8, 8, 8, 8 } },
  { '\x03', '\x02', 100, 8, 4, 4, 4, 2, { 8, 8, 8, 8 } },
  { '\x03', '\x02', 100, 8, 4, 4, 4, 2, { 8, 8, 8, 8 } },
  { '\x02', '\x01', 20, 32, 2, 2, 2, 2, { 8, 8, 8, 8 } },
  { '\x04', '\x01', 20, 32, 2, 2, 2, 2, { 8, 8, 8, 8 } },
  { '\x06', '\x01', 20, 32, 2, 2, 2, 2, { 8, 8, 8, 8 } },
  { '\0', '\n', 50, 40, 2, 2, 2, 2, { 8, 8, 8, 8 } },
  { '\0', '\n', 70, 40, 4, 4, 4, 4, { 8, 8, 8, 8 } },
  { '\0', '\n', 90, 40, 4, 4, 0, 0, { 8, 8, 8, 8 } },
  { '\x01', 'd', 100, 20, 16, 16, 0, 0, { 0, 0, 0, 0 } },
  { '\x01', 'd', 100, 20, 16, 16, 0, 0, { 0, 0, 0, 0 } },
  { '\x01', 'd', 100, 20, 16, 16, 0, 0, { 0, 0, 0, 0 } },
  { '\x01', '\x01', 20, 8, 2, 2, 2, 2, { 4, 4, 4, 4 } },
  { '\x02', '\x01', 20, 8, 2, 2, 2, 2, { 4, 4, 4, 4 } },
  { '\x02', '\x01', 20, 8, 4, 4, 4, 4, { 4, 4, 4, 4 } },
  { '\x03', '\x01', 32, 32, 2, 2, 2, 2, { 4, 4, 4, 4 } },
  { '\0', 'd', 0, 36, 8, 8, 8, 8, { 12, 12, 12, 12 } },
  { '\x7F', '\x01', 2, 4, 8, 4, 8, 4, { 0, 0, 0, 0 } },
  { '\x0F', '\x01', 30, 36, 8, 8, 4, 2, { 8, 8, 8, 8 } },
  { '\x06', '\x03', 18, 36, 10, 10, 4, 2, { 12, 12, 12, 12 } },
  { '\x01', 'd', 30, 36, 6, 6, 4, 4, { 12, 12, 12, 12 } },
  { '\0', '\n', 30, 40, 2, 2, 2, 2, { 8, 8, 8, 8 } },
  { '\0', '\n', 40, 40, 4, 4, 4, 4, { 8, 8, 8, 8 } },
  { '\0', '\n', 40, 40, 4, 4, 0, 0, { 8, 8, 8, 8 } },
  { '\x02', 'd', 100, 20, 12, 12, 0, 0, { 0, 0, 0, 0 } },
  { '\x02', 'd', 100, 20, 12, 12, 0, 0, { 0, 0, 0, 0 } },
  { '\x02', 'd', 100, 20, 12, 12, 0, 0, { 0, 0, 0, 0 } },
  { '\x04', '\x04', 20, 32, 4, 4, 3, 3, { 8, 8, 24, 8 } },
  { '\x04', '\x02', 20, 32, 2, 2, 2, 2, { 8, 8, 24, 8 } },
  { '\x01', '\x01', 20, 32, 2, 2, 2, 2, { 8, 8, 24, 8 } },
  { '\x04', '\x04', 30, 64, 6, 6, 3, 3, { 8, 8, 8, 8 } },
  { '\b', '\b', 30, 64, 6, 6, 3, 3, { 8, 8, 8, 8 } },
  { '\f', '\f', 30, 64, 6, 6, 3, 3, { 8, 8, 8, 8 } },
  { '\x03', 'd', 30, 32, 6, 6, 3, 3, { 4, 4, 4, 4 } },
  { '\x06', 'd', 30, 32, 6, 6, 3, 3, { 4, 4, 4, 4 } },
  { '\v', 'd', 30, 32, 6, 6, 3, 3, { 4, 4, 4, 4 } },
  { '\x04', '\x04', 20, 32, 4, 4, 3, 3, { 8, 8, 24, 8 } },
  { '\0', '\x04', 4, 4, 0, 0, 0, 0, { 0, 0, 0, 0 } },
  { '\x01', '\x01', 1, 36, 1, 1, 1, 1, { 1, 1, 1, 1 } }
};
$74F7120D52ED14132C5D5934E9BCA40C gArmsLevelTable[14] =
{
  { { 0, 0, 100 } },
  { { 30, 40, 16 } },
  { { 10, 20, 10 } },
  { { 10, 20, 20 } },
  { { 30, 40, 10 } },
  { { 10, 20, 10 } },
  { { 10, 20, 30 } },
  { { 10, 20, 5 } },
  { { 10, 20, 100 } },
  { { 30, 60, 0 } },
  { { 30, 60, 10 } },
  { { 10, 20, 100 } },
  { { 1, 1, 1 } },
  { { 40, 60, 200 } }
};
RECT _rc = { 0, 0, 160, 12 };
BOSSFUNCTION gpBossFuncTbl[10] =
{
  &ActBossChar_0,
  &ActBossChar_Omega,
  &ActBossChar_Frog,
  &ActBossChar_MonstX,
  &ActBossChar_Core,
  &ActBossChar_Ironhead,
  &ActBossChar_Twin,
  &ActBossChar_Undead,
  &ActBossChar_Press,
  &ActBossChar_Ballos
};
$D0E8D2897BA5D40099F1B39E7818C056 gTMT[95] =
{
  {
    {
      '0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0'
    },
    "0",
    4,
    "bk0",
    "Guest",
    "0",
    '\0',
    "\x96\xB3",
    "Credits"
  },
  {
    "Pens",
    "Pens1",
    1,
    "bkBlue",
    "Guest",
    "0",
    '\0',
    "\x83A\x81[\x83T\x81[\x82̉\xC6",
    "Arthur's house"
  },
  {
    "Eggs",
    "Eggs",
    1,
    "bkGreen",
    "Eggs1",
    "Ravil",
    '\0',
    "\x83^\x83}\x83S\x89\xF1\x98\x4C",
    "Egg Corridor"
  },
  {
    "EggX",
    "EggX",
    4,
    "bk0",
    "Eggs1",
    "0",
    '\0',
    "\x83^\x83}\x83S No.00",
    "Egg No. 00"
  },
  {
    "EggIn",
    "Egg6",
    4,
    "bk0",
    "Eggs1",
    "0",
    '\0',
    "\x83^\x83}\x83S No.06",
    "Egg No. 06"
  },
  {
    "Store",
    "EggR",
    4,
    "bk0",
    "Eggs1",
    "0",
    '\0',
    "\x83^\x83}\x83S\x8AĎ\x8B\x8E\xBA",
    "Egg Observation Room"
  },
  {
    "Weed",
    "Weed",
    1,
    "bkBlue",
    "Weed",
    "0",
    '\0',
    "\x83N\x83T\x83\x80\x83\x89",
    "Grasstown"
  },
  {
    "Barr",
    "Santa",
    4,
    "bk0",
    "Weed",
    "0",
    '\0',
    "\x83T\x83\x93\x83^\x82̉\xC6",
    "Santa's House"
  },
  {
    "Barr",
    "Chako",
    1,
    "bkBlue",
    "Guest",
    "0",
    '\0',
    "\x83`\x83\x83\x83R\x82̉\xC6",
    "Chaco's House"
  },
  {
    "Maze",
    "MazeI",
    4,
    "bk0",
    "Maze",
    "0",
    '\0',
    "\x96\xC0\x8B{\x82h",
    "Labyrinth I"
  },
  {
    "Sand",
    "Sand",
    1,
    "bkGreen",
    "Sand",
    "Omg",
    '\x01',
    "\x8D\xBB\x8B\xE6",
    "Sand Zone"
  },
  {
    "Mimi",
    "Mimi",
    1,
    "bkBlue",
    "Guest",
    "0",
    '\0',
    "\x83~\x83~\x83K\x81[\x82̑\xBA",
    "Mimiga Village"
  },
  {
    "Cave",
    "Cave",
    4,
    "bk0",
    "Cemet",
    "0",
    '\0',
    "\x8Dŏ\x89\x82̓\xB4\x8CA",
    "First Cave"
  },
  {
    "Cave",
    "Start",
    4,
    "bk0",
    "Cemet",
    "0",
    '\0',
    "\x83X\x83^\x81[\x83g\x92n\x93_",
    "Start Point"
  },
  {
    "Mimi",
    "Barr",
    4,
    "bk0",
    "Cemet",
    "Bllg",
    '\0',
    "\x83o\x83\x89\x83b\x83N\x8F\xAC\x89\xAE",
    "Shack"
  },
  {
    "Mimi",
    "Pool",
    1,
    "bkBlue",
    "Guest",
    "0",
    '\0',
    "\x92\x99\x90\x85\x92r",
    "Reservoir"
  },
  {
    "Mimi",
    "Cemet",
    4,
    "bk0",
    "Cemet",
    "0",
    '\0',
    "\x82͂\xA9\x82\xCE",
    "Graveyard"
  },
  {
    "Mimi",
    "Plant",
    1,
    "bkGreen",
    "Plant",
    "0",
    '\0',
    "\x8ER\x89\xBA\x94_\x89\x80",
    "Yamashita Farm"
  },
  {
    "Store",
    "Shelt",
    4,
    "bk0",
    "Eggs1",
    "0",
    '\0',
    "\x83V\x83F\x83\x8B\x83^\x81[",
    "Shelter"
  },
  {
    "Pens",
    "Comu",
    1,
    "bkBlue",
    "Guest",
    "0",
    '\0',
    "\x8FW\x89\xEF\x8F\xEA",
    "Assembly Hall"
  },
  {
    "Mimi",
    "MiBox",
    4,
    "bk0",
    "0",
    "0",
    '\0',
    "\x83Z\x81[\x83u\x83|\x83C\x83\x93\x83g",
    "Save Point"
  },
  {
    "Store",
    "EgEnd1",
    4,
    "bk0",
    "0",
    "0",
    '\0',
    "\x83^\x83}\x83S\x89\xF1\x98\x4C\x82̌\u008E\xBA",
    "Side Room"
  },
  {
    "Store",
    "Cthu",
    4,
    "bk0",
    "0",
    "0",
    '\0',
    "\x83N\x83g\x83D\x83\x8B\x81[\x82̏Z\x8F\x88",
    "Cthulhu's Abode"
  },
  {
    "EggIn",
    "Egg1",
    4,
    "bk0",
    "Eggs1",
    "0",
    '\0',
    "\x83^\x83}\x83S No.01",
    "Egg No. 01"
  },
  {
    "Pens",
    "Pens2",
    1,
    "bkBlue",
    "Guest",
    "0",
    '\0',
    "\x83A\x81[\x83T\x81[\x82̉\xC6",
    "Arthur's House"
  },
  {
    "Barr",
    "Malco",
    1,
    "bkBlue",
    "Weed",
    "Bllg",
    '\0',
    "\x93d\x8C\xB9\x8E\xBA",
    "Power Room"
  },
  {
    "Barr",
    "WeedS",
    1,
    "bkBlue",
    "0",
    "0",
    '\0',
    "\x83Z\x81[\x83u\x83|\x83C\x83\x93\x83g",
    "Save Point"
  },
  {
    "Store",
    "WeedD",
    1,
    "bkBlue",
    "0",
    "0",
    '\0',
    "\x8F\x88\x8CY\x8E\xBA",
    "Execution Chamber"
  },
  {
    "Weed",
    "Frog",
    2,
    "bkGreen",
    "Weed",
    "Frog",
    '\x02',
    "\x83K\x83\x80",
    "Gum"
  },
  {
    "Sand",
    "Curly",
    4,
    "bk0",
    "Sand",
    "Curly",
    '\0',
    "\x8D\xBB\x8B撓\x8Dݏ\x8A",
    "Sand Zone Residence"
  },
  {
    "Pens",
    "WeedB",
    1,
    "bkBlue",
    "Ravil",
    "0",
    '\0',
    "\x83N\x83T\x83\x80\x83\x89\x82̏\xAC\x89\xAE",
    "Grasstown Hut"
  },
  {
    "River",
    "Stream",
    5,
    "bkBlue",
    "Stream",
    "IronH",
    '\x05',
    "\x91哮\x96\xAC",
    "Main Artery"
  },
  {
    "Pens",
    "CurlyS",
    4,
    "bk0",
    "Sand",
    "Curly",
    '\0',
    "\x8F\xAC\x95\x94\x89\xAE",
    "Small Room"
  },
  {
    "Barr",
    "Jenka1",
    4,
    "bk0",
    "Sand",
    "Bllg",
    '\0',
    "\x83W\x83F\x83\x93\x83J\x82̉\xC6",
    "Jenka's House"
  },
  {
    "Sand",
    "Dark",
    1,
    "bkBlack",
    "Sand",
    "0",
    '\0',
    "\x94p\x89\xAE",
    "Deserted House"
  },
  {
    "Gard",
    "Gard",
    1,
    "bkGard",
    "Toro",
    "Bllg",
    '\0',
    "\x8D\xBB\x8B\xE6\x91\x71\x8C\xC9",
    "Storehouse"
  },
  {
    "Barr",
    "Jenka2",
    4,
    "bk0",
    "Sand",
    "Bllg",
    '\0',
    "\x83W\x83F\x83\x93\x83J\x82̉\xC6",
    "Jenka's House"
  },
  {
    "Sand",
    "SandE",
    1,
    "bkGreen",
    "Sand",
    "Bllg",
    '\0',
    "\x8D\xBB\x8B\xE6",
    "Sand Zone"
  },
  {
    "Maze",
    "MazeH",
    4,
    "bk0",
    "Maze",
    "0",
    '\0',
    "\x96\xC0\x8B{\x82g",
    "Labyrinth H"
  },
  {
    "Maze",
    "MazeW",
    1,
    "bkMaze",
    "Maze",
    "X",
    '\x03',
    "\x96\xC0\x8B{\x82v",
    "Labyrinth W"
  },
  {
    "Maze",
    "MazeO",
    4,
    "bk0",
    "Guest",
    "0",
    '\0',
    "\x83L\x83\x83\x83\x93\x83v",
    "Camp"
  },
  {
    "Maze",
    "MazeD",
    4,
    "bk0",
    "Guest",
    "Dark",
    '\0',
    "\x90f\x97Ï\x8A\x90\xD5",
    "Clinic Ruins"
  },
  {
    "Store",
    "MazeA",
    4,
    "bk0",
    "Maze",
    "0",
    '\0',
    "\x96\xC0\x8B{\x82̓X",
    "Labyrinth Shop"
  },
  {
    "Maze",
    "MazeB",
    1,
    "bkBlue",
    "Maze",
    "0",
    '\0',
    "\x96\xC0\x8B{\x82a",
    "Labyrinth B"
  },
  {
    "Maze",
    "MazeS",
    2,
    "bkGray",
    "Maze",
    "Bllg",
    '\0',
    "\x91\xE5\x90\xCE\x82̍ǂ\xAE\x8F\x8A",
    "Boulder Chamber"
  },
  {
    "Maze",
    "MazeM",
    1,
    "bkRed",
    "Maze",
    "0",
    '\0',
    "\x96\xC0\x8B{\x82l",
    "Labyrinth M"
  },
  {
    "Cave",
    "Drain",
    3,
    "bkWater",
    "Cemet",
    "0",
    '\0',
    "\x88Â\xA2\x8F\x8A",
    "Dark Place"
  },
  {
    "Almond",
    "Almond",
    3,
    "bkWater",
    "Cemet",
    "Almo1",
    '\x04',
    "\x83R\x83A",
    "Core"
  },
  {
    "River",
    "River",
    2,
    "bkGreen",
    "Weed",
    "0",
    '\0',
    "\x90\x85\x98H",
    "Waterway"
  },
  {
    "Eggs",
    "Eggs2",
    1,
    "bkGreen",
    "Eggs2",
    "0",
    '\0',
    "\x83^\x83}\x83S\x89\xF1\x98\x4C\x81H",
    "Egg Corridor"
  },
  {
    "Store",
    "Cthu2",
    4,
    "bk0",
    "Eggs1",
    "0",
    '\0',
    "\x83N\x83g\x83D\x83\x8B\x81[\x82̏Z\x8F\x88\x81H",
    "Cthulhu's Abode"
  },
  {
    "Store",
    "EggR2",
    4,
    "bk0",
    "Eggs1",
    "TwinD",
    '\x06',
    "\x83^\x83}\x83S\x8AĎ\x8B\x8E\xBA\x81H",
    "Egg Observation Room"
  },
  {
    "EggX",
    "EggX2",
    4,
    "bk0",
    "Eggs1",
    "0",
    '\0',
    "\x83^\x83}\x83S No.00",
    "Egg No. 00"
  },
  {
    "Oside",
    "Oside",
    6,
    "bkMoon",
    "Moon",
    "0",
    '\0',
    "\x8AO\x95\xC7",
    "Outer Wall"
  },
  {
    "Store",
    "EgEnd2",
    4,
    "bk0",
    "Eggs1",
    "0",
    '\0',
    "\x83^\x83}\x83S\x89\xF1\x98\x4C\x82̌\u008E\xBA",
    "Side Room"
  },
  {
    "Store",
    "Itoh",
    2,
    "bkBlue",
    "Guest",
    "0",
    '\0',
    "\x91q\x8C\xC9",
    "Storehouse"
  },
  {
    "Cent",
    "Cent",
    1,
    "bkGreen",
    "Guest",
    "Cent",
    '\0',
    "\x91\xE5\x94\x5F\x89\x80",
    "Plantation"
  },
  {
    "Jail",
    "Jail1",
    4,
    "bk0",
    "Guest",
    "Cent",
    '\0',
    "\x91\xE6\x82\x50\x98S",
    "Jail No. 1"
  },
  {
    "Jail",
    "Momo",
    4,
    "bk0",
    "Guest",
    "0",
    '\0',
    "\x83J\x83N\x83\x8C\x83K",
    "Hideout"
  },
  {
    "Jail",
    "Lounge",
    4,
    "bk0",
    "Guest",
    "0",
    '\0',
    "\x8Bx\x8Ce\x8F\x8A",
    "Rest Area"
  },
  {
    "Store",
    "CentW",
    4,
    "bk0",
    "Guest",
    "Cent",
    '\0',
    "\x93]\x91\x97\x8E\xBA",
    "Teleporter"
  },
  {
    "Store",
    "Jail2",
    4,
    "bk0",
    "Guest",
    "Cent",
    '\0',
    "\x91\xE6\x82\x51\x98S",
    "Jail No. 2"
  },
  {
    "White",
    "Blcny1",
    7,
    "bkFog",
    "Ravil",
    "Heri",
    '\0',
    "\x83o\x83\x8B\x83R\x83j\x81[",
    "Balcony"
  },
  {
    "Jail",
    "Priso1",
    4,
    "bkGray",
    "Red",
    "0",
    '\0',
    "\x8DŌ\xE3\x82\xCC\x93\xB4\x8CA",
    "Last Cave"
  },
  {
    "White",
    "Ring1",
    7,
    "bkFog",
    "Guest",
    "Miza",
    '\0',
    "\x89\xA4\x82̋ʍ\xC0",
    "Throne Room"
  },
  {
    "White",
    "Ring2",
    7,
    "bkFog",
    "Guest",
    "Dr",
    '\0',
    "\x89\xA4\x82̐H\x91\xEC",
    "The King's Table"
  },
  {
    "Pens",
    "Prefa1",
    4,
    "bk0",
    "0",
    "0",
    '\0',
    "\x83v\x83\x8C\x83n\x83u",
    "Prefab House"
  },
  {
    "Jail",
    "Priso2",
    4,
    "bkGray",
    "Red",
    "0",
    '\0',
    "\x8DŌ\xE3\x82\xCC\x93\xB4\x8CA\x81E\x97\xA0",
    "Last Cave Hidden"
  },
  {
    "White",
    "Ring3",
    4,
    "bk0",
    "Miza",
    "Almo2",
    '\a',
    "\x8D\x95\x82\xA2\x8DL\x8A\xD4",
    "Black Space"
  },
  {
    "Pens",
    "Little",
    2,
    "bkBlue",
    "Guest",
    "0",
    '\0',
    "\x83\x8A\x83g\x83\x8B\x89\xC6",
    "Little House"
  },
  {
    "White",
    "Blcny2",
    7,
    "bkFog",
    "Ravil",
    "Heri",
    '\0',
    "\x83o\x83\x8B\x83R\x83j\x81[",
    "Balcony"
  },
  {
    "Fall",
    "Fall",
    1,
    "bkFall",
    "Guest",
    "Heri",
    '\0',
    "\x97\x8E\x89\xBA",
    "Ending"
  },
  { "White", "Kings", 4, "bk0", "Kings", "0", '\0', "u", "u" },
  {
    "Pens",
    "Pixel",
    1,
    "bkBlue",
    "Guest",
    "0",
    '\0',
    "\x90\x85\x98H\x82̏\xAC\x95\x94\x89\xAE",
    "Waterway Cabin"
  },
  { "Maze", "e_Maze", 1, "bkMaze", "Guest", "Maze", '\x03', "", "" },
  { "Barr", "e_Jenk", 4, "bk0", "Sand", "Bllg", '\0', "", "" },
  { "Barr", "e_Malc", 1, "bkBlue", "Weed", "Bllg", '\0', "", "" },
  { "Mimi", "e_Ceme", 4, "bk0", "Plant", "0", '\0', "", "" },
  { "Fall", "e_Sky", 1, "bkFall", "Guest", "Heri", '\0', "", "" },
  {
    "Pens",
    "Prefa2",
    4,
    "bk0",
    "0",
    "0",
    '\0',
    "\x83v\x83\x8C\x83n\x83u",
    "Prefab House"
  },
  {
    "Hell",
    "Hell1",
    2,
    "bkRed",
    "Hell",
    "0",
    '\0',
    "\x90\xB9\x88\xE6\x92\x6E\x89\xBA\x82P\x8AK",
    "Sacred Ground B1"
  },
  {
    "Hell",
    "Hell2",
    2,
    "bkRed",
    "Hell",
    "0",
    '\0',
    "\x90\xB9\x88\xE6\x92\x6E\x89\xBA\x82Q\x8AK",
    "Sacred Ground B2"
  },
  {
    "Hell",
    "Hell3",
    1,
    "bkRed",
    "Hell",
    "Press",
    '\b',
    "\x90\xB9\x88\xE6\x92\x6E\x89\xBA\x82R\x8AK",
    "Sacred Ground B3"
  },
  { "Cave", "Mapi", 2, "bk0", "Cemet", "0", '\0', "\x95\xA8\x92u", "Storage" },
  { "Hell", "Hell4", 4, "bk0", "Hell", "0", '\0', "\x92ʘH\x81H", "Passage" },
  {
    "Hell",
    "Hell42",
    4,
    "bk0",
    "Hell",
    "Press",
    '\b',
    "\x92ʘH\x81H",
    "Passage"
  },
  {
    "Hell",
    "Statue",
    1,
    "bkBlue",
    "0",
    "Cent",
    '\0',
    "\x90Α\x9C\x82̊\xD4",
    "Statue Chamber"
  },
  {
    "Hell",
    "Ballo1",
    2,
    "bkBlue",
    "Priest",
    "Ballos",
    '\t',
    "\x95\x95\x88\xF3\x82\xCC\x8A\xD4",
    "Seal Chamber"
  },
  {
    "White",
    "Ostep",
    7,
    "bkFog",
    "0",
    "0",
    '\0',
    "\x82킽\x82\xE8\x98\x4C\x89\xBA",
    "Corridor"
  },
  { "Labo", "e_Labo", 4, "bk0", "Guest", "0", '\0', "", "" },
  {
    "Cave",
    "Pole",
    4,
    "bk0",
    "Guest",
    "0",
    '\0',
    "\x82͂\xAE\x82\xEA\x8F\x65\x92b\x96\xE8",
    "Hermit Gunsmith"
  },
  { "0", "Island", 4, "bk0", "Island", "0", '\0', "", "" },
  {
    "Hell",
    "Ballo2",
    2,
    "bkBlue",
    "Priest",
    "Bllg",
    '\t',
    "\x95\x95\x88\xF3\x82\xCC\x8A\xD4",
    "Seal Chamber"
  },
  { "White", "e_Blcn", 7, "bkFog", "Miza", "0", '\t', "", "" },
  {
    "Oside",
    "Clock",
    6,
    "bkMoon",
    "Moon",
    "0",
    '\0',
    "\x8E\x9E\x8Cv\x89\xAE",
    "Clock Room"
  }
};
char *gMusicTable[42] =
{
  "XXXX",
  "Wanpaku",
  "Anzen",
  "Gameover",
  "Gravity",
  "Weed",
  "MDown2",
  "FireEye",
  "Vivi",
  "Mura",
  "Fanfale1",
  "Ginsuke",
  "Cemetery",
  "Plant",
  "Kodou",
  "Fanfale3",
  "Fanfale2",
  "Dr",
  "Escape",
  "Jenka",
  "Maze",
  "Access",
  "ironH",
  "Grand",
  "Curly",
  "Oside",
  "Requiem",
  "Wanpak2",
  "quiet",
  "LastCave",
  "Balcony",
  "LastBtl",
  "LastBtl3",
  "Ending",
  "Zonbie",
  "BreakDown",
  "Hell",
  "Jenka2",
  "Marine",
  "Ballos",
  "Toroko",
  "White"
};
$B39ED6C1613C80801629116D648EBE12 gCaretTable[18] =
{
  { 0, 0 },
  { 2048, 2048 },
  { 4096, 4096 },
  { 4096, 4096 },
  { 4096, 4096 },
  { 2048, 2048 },
  { 4096, 4096 },
  { 2048, 2048 },
  { 4096, 4096 },
  { 4096, 4096 },
  { 14336, 4096 },
  { 2048, 2048 },
  { 8192, 8192 },
  { 2048, 2048 },
  { 10240, 10240 },
  { 2048, 2048 },
  { 10240, 2048 },
  { 26624, 2048 }
};
CARETFUNCTION gpCaretFuncTbl[18] =
{
  &ActCaret00,
  &ActCaret01,
  &ActCaret02,
  &ActCaret03,
  &ActCaret04,
  &ActCaret05,
  &ActCaret04,
  &ActCaret07,
  &ActCaret08,
  &ActCaret09,
  &ActCaret10,
  &ActCaret11,
  &ActCaret12,
  &ActCaret13,
  &ActCaret14,
  &ActCaret15,
  &ActCaret16,
  &ActCaret17
};
int gArmsEnergyX = 16;
const char *_extra_text = "(C)Pixel";
$7E71A1045C51D94A65087D8D46AB5C4F oct_wave[8] =
{
  { 256, 1, 4 },
  { 256, 2, 8 },
  { 128, 4, 12 },
  { 128, 8, 16 },
  { 64, 16, 20 },
  { 32, 32, 24 },
  { 16, 64, 28 },
  { 8, 128, 32 }
};
__int16 freq_tbl[12] = { 262, 277, 294, 311, 330, 349, 370, 392, 415, 440, 466, 494 };
__int16 _pan_tbl[13] = { 0, 43, 86, 129, 172, 215, 256, 297, 340, 383, 426, 469, 512 };
Uint8 _old_key[16] =
{
  255u,
  255u,
  255u,
  255u,
  255u,
  255u,
  255u,
  255u,
  0u,
  0u,
  0u,
  0u,
  0u,
  0u,
  0u,
  0u
};
char pass[7] = "Org-01";
char pass2[7] = "Org-02";
int _Volume = 100;
RECT grcGame = { 0, 0, 320, 240 };
RECT grcFull = { 0, 0, 320, 240 };
int gKeyJump = 64;
int gKeyShot = 32;
int gKeyArms = 128;
int gKeyArmsRev = 256;
int gKeyItem = 4096;
int gKeyMap = 16;
int gKeyOk = 64;
int gKeyCancel = 32;
int gKeyLeft = 1;
int gKeyUp = 4;
int gKeyRight = 2;
int gKeyDown = 8;
NPCFUNCTION gpNpcFuncTbl[361] =
{
  &ActNpc000,
  &ActNpc001,
  &ActNpc002,
  &ActNpc003,
  &ActNpc004,
  &ActNpc005,
  &ActNpc006,
  &ActNpc007,
  &ActNpc008,
  &ActNpc009,
  &ActNpc010,
  &ActNpc011,
  &ActNpc012,
  &ActNpc013,
  &ActNpc014,
  &ActNpc015,
  &ActNpc016,
  &ActNpc017,
  &ActNpc018,
  &ActNpc019,
  &ActNpc020,
  &ActNpc021,
  &ActNpc022,
  &ActNpc023,
  &ActNpc024,
  &ActNpc025,
  &ActNpc026,
  &ActNpc027,
  &ActNpc028,
  &ActNpc029,
  &ActNpc030,
  &ActNpc031,
  &ActNpc032,
  &ActNpc033,
  &ActNpc034,
  &ActNpc035,
  &ActNpc036,
  &ActNpc037,
  &ActNpc038,
  &ActNpc039,
  &ActNpc040,
  &ActNpc041,
  &ActNpc042,
  &ActNpc043,
  &ActNpc044,
  &ActNpc045,
  &ActNpc046,
  &ActNpc047,
  &ActNpc048,
  &ActNpc049,
  &ActNpc050,
  &ActNpc051,
  &ActNpc052,
  &ActNpc053,
  &ActNpc054,
  &ActNpc055,
  &ActNpc056,
  &ActNpc057,
  &ActNpc058,
  &ActNpc059,
  &ActNpc060,
  &ActNpc061,
  &ActNpc062,
  &ActNpc063,
  &ActNpc064,
  &ActNpc065,
  &ActNpc066,
  &ActNpc067,
  &ActNpc068,
  &ActNpc069,
  &ActNpc070,
  &ActNpc071,
  &ActNpc072,
  &ActNpc073,
  &ActNpc074,
  &ActNpc075,
  &ActNpc076,
  &ActNpc077,
  &ActNpc078,
  &ActNpc079,
  &ActNpc080,
  &ActNpc081,
  &ActNpc082,
  &ActNpc083,
  &ActNpc084,
  &ActNpc085,
  &ActNpc086,
  &ActNpc087,
  &ActNpc088,
  &ActNpc089,
  &ActNpc090,
  &ActNpc091,
  &ActNpc092,
  &ActNpc093,
  &ActNpc094,
  &ActNpc095,
  &ActNpc096,
  &ActNpc097,
  &ActNpc098,
  &ActNpc099,
  &ActNpc100,
  &ActNpc101,
  &ActNpc102,
  &ActNpc103,
  &ActNpc104,
  &ActNpc105,
  &ActNpc106,
  &ActNpc107,
  &ActNpc108,
  &ActNpc109,
  &ActNpc110,
  &ActNpc111,
  &ActNpc112,
  &ActNpc113,
  &ActNpc114,
  &ActNpc115,
  &ActNpc116,
  &ActNpc117,
  &ActNpc118,
  &ActNpc119,
  &ActNpc120,
  &ActNpc121,
  &ActNpc122,
  &ActNpc123,
  &ActNpc124,
  &ActNpc125,
  &ActNpc126,
  &ActNpc127,
  &ActNpc128,
  &ActNpc129,
  &ActNpc130,
  &ActNpc131,
  &ActNpc132,
  &ActNpc133,
  &ActNpc134,
  &ActNpc135,
  &ActNpc136,
  &ActNpc137,
  &ActNpc138,
  &ActNpc139,
  &ActNpc140,
  &ActNpc141,
  &ActNpc142,
  &ActNpc143,
  &ActNpc144,
  &ActNpc145,
  &ActNpc146,
  &ActNpc147,
  &ActNpc148,
  &ActNpc149,
  &ActNpc150,
  &ActNpc151,
  &ActNpc152,
  &ActNpc153,
  &ActNpc154,
  &ActNpc155,
  &ActNpc156,
  &ActNpc157,
  &ActNpc158,
  &ActNpc159,
  &ActNpc160,
  &ActNpc161,
  &ActNpc162,
  &ActNpc163,
  &ActNpc164,
  &ActNpc165,
  &ActNpc166,
  &ActNpc167,
  &ActNpc168,
  &ActNpc169,
  &ActNpc170,
  &ActNpc171,
  &ActNpc172,
  &ActNpc173,
  &ActNpc174,
  &ActNpc175,
  &ActNpc176,
  &ActNpc177,
  &ActNpc178,
  &ActNpc179,
  &ActNpc180,
  &ActNpc181,
  &ActNpc182,
  &ActNpc183,
  &ActNpc184,
  &ActNpc185,
  &ActNpc186,
  &ActNpc187,
  &ActNpc188,
  &ActNpc189,
  &ActNpc190,
  &ActNpc191,
  &ActNpc192,
  &ActNpc193,
  &ActNpc194,
  &ActNpc195,
  &ActNpc196,
  &ActNpc197,
  &ActNpc198,
  &ActNpc199,
  &ActNpc200,
  &ActNpc201,
  &ActNpc202,
  &ActNpc203,
  &ActNpc204,
  &ActNpc205,
  &ActNpc206,
  &ActNpc207,
  &ActNpc208,
  &ActNpc209,
  &ActNpc210,
  &ActNpc211,
  &ActNpc212,
  &ActNpc213,
  &ActNpc214,
  &ActNpc215,
  &ActNpc216,
  &ActNpc217,
  &ActNpc218,
  &ActNpc219,
  &ActNpc220,
  &ActNpc221,
  &ActNpc222,
  &ActNpc223,
  &ActNpc224,
  &ActNpc225,
  &ActNpc226,
  &ActNpc227,
  &ActNpc228,
  &ActNpc229,
  &ActNpc230,
  &ActNpc231,
  &ActNpc232,
  &ActNpc233,
  &ActNpc234,
  &ActNpc235,
  &ActNpc236,
  &ActNpc237,
  &ActNpc238,
  &ActNpc239,
  &ActNpc240,
  &ActNpc241,
  &ActNpc242,
  &ActNpc243,
  &ActNpc244,
  &ActNpc245,
  &ActNpc246,
  &ActNpc247,
  &ActNpc248,
  &ActNpc249,
  &ActNpc250,
  &ActNpc251,
  &ActNpc252,
  &ActNpc253,
  &ActNpc254,
  &ActNpc255,
  &ActNpc256,
  &ActNpc257,
  &ActNpc258,
  &ActNpc259,
  &ActNpc260,
  &ActNpc261,
  &ActNpc262,
  &ActNpc263,
  &ActNpc264,
  &ActNpc265,
  &ActNpc266,
  &ActNpc267,
  &ActNpc268,
  &ActNpc269,
  &ActNpc270,
  &ActNpc271,
  &ActNpc272,
  &ActNpc273,
  &ActNpc274,
  &ActNpc275,
  &ActNpc276,
  &ActNpc277,
  &ActNpc278,
  &ActNpc279,
  &ActNpc280,
  &ActNpc281,
  &ActNpc282,
  &ActNpc283,
  &ActNpc284,
  &ActNpc285,
  &ActNpc286,
  &ActNpc287,
  &ActNpc288,
  &ActNpc289,
  &ActNpc290,
  &ActNpc291,
  &ActNpc292,
  &ActNpc293,
  &ActNpc294,
  &ActNpc295,
  &ActNpc296,
  &ActNpc297,
  &ActNpc298,
  &ActNpc299,
  &ActNpc300,
  &ActNpc301,
  &ActNpc302,
  &ActNpc303,
  &ActNpc304,
  &ActNpc305,
  &ActNpc306,
  &ActNpc307,
  &ActNpc308,
  &ActNpc309,
  &ActNpc310,
  &ActNpc311,
  &ActNpc312,
  &ActNpc313,
  &ActNpc314,
  &ActNpc315,
  &ActNpc316,
  &ActNpc317,
  &ActNpc318,
  &ActNpc319,
  &ActNpc320,
  &ActNpc321,
  &ActNpc322,
  &ActNpc323,
  &ActNpc324,
  &ActNpc325,
  &ActNpc326,
  &ActNpc327,
  &ActNpc328,
  &ActNpc329,
  &ActNpc330,
  &ActNpc331,
  &ActNpc332,
  &ActNpc333,
  &ActNpc334,
  &ActNpc335,
  &ActNpc336,
  &ActNpc337,
  &ActNpc338,
  &ActNpc339,
  &ActNpc340,
  &ActNpc341,
  &ActNpc342,
  &ActNpc343,
  &ActNpc344,
  &ActNpc345,
  &ActNpc346,
  &ActNpc347,
  &ActNpc348,
  &ActNpc349,
  &ActNpc350,
  &ActNpc351,
  &ActNpc352,
  &ActNpc353,
  &ActNpc354,
  &ActNpc355,
  &ActNpc356,
  &ActNpc357,
  &ActNpc358,
  &ActNpc359,
  &ActNpc360
};
RECT gRect_line = { 0, 0, 216, 16 };
char *gDefaultName = "Profile.dat";
char *gProfileCode = "Do041220";
RECT grcKitL[21] =
{
  { 0, 0, 24, 24 },
  { 24, 0, 48, 24 },
  { 48, 0, 72, 24 },
  { 0, 0, 24, 24 },
  { 72, 0, 96, 24 },
  { 0, 0, 24, 24 },
  { 96, 0, 120, 24 },
  { 120, 0, 144, 24 },
  { 144, 0, 168, 24 },
  { 168, 0, 192, 24 },
  { 192, 0, 216, 24 },
  { 216, 0, 240, 24 },
  { 240, 0, 264, 24 },
  { 264, 0, 288, 24 },
  { 0, 48, 24, 72 },
  { 24, 48, 48, 72 },
  { 48, 48, 72, 72 },
  { 72, 48, 96, 72 },
  { 288, 0, 312, 24 },
  { 24, 48, 48, 72 },
  { 96, 48, 120, 72 }
};
RECT grcKitR[21] =
{
  { 0, 24, 24, 48 },
  { 24, 24, 48, 48 },
  { 48, 24, 72, 48 },
  { 0, 24, 24, 48 },
  { 72, 24, 96, 48 },
  { 0, 24, 24, 48 },
  { 96, 24, 120, 48 },
  { 120, 24, 144, 48 },
  { 144, 24, 168, 48 },
  { 168, 24, 192, 48 },
  { 192, 24, 216, 48 },
  { 216, 24, 240, 48 },
  { 240, 24, 264, 48 },
  { 264, 24, 288, 48 },
  { 0, 72, 24, 96 },
  { 24, 72, 48, 96 },
  { 48, 72, 72, 96 },
  { 72, 72, 96, 96 },
  { 288, 24, 312, 48 },
  { 24, 72, 48, 96 },
  { 96, 72, 120, 96 }
};
char *gPassPixEve = &unk_814DC60;
FILE *stderr;
char completed_5829;
int dtor_idx_5831;
$A04024D9D3FA77925171298B9D10BD38 flash;
_UNKNOWN unk_81C79E4;
_UNKNOWN unk_81C79E8;
_UNKNOWN unk_81C79EC;
_UNKNOWN unk_81C79F0;
_UNKNOWN unk_81C79F4;
_UNKNOWN unk_81C79F8;
RECT rect;
RECT stru_81C7A0C;
Uint32 gFlashColor;
SDL_Surface_0 *screen;
SDL_Surface_0 *_surf_S[40];
int x_offset;
int y_offset;
_UNKNOWN `guard variable for'Flip_SystemTask(SDL_Surface *)::previous_time;
SDL_Surface_0 *font;
Uint32 Flip_SystemTask(SDL_Surface *)::previous_time;
$820603ACFA14E4E40D60090335ECC668 Credit;
$B5C5C810E4DC04C130B6868ED05D4052 Strip[16];
$97E62D55470466FFD17F9A56C5290DBC Illust;
$BB6E7CC5619195A5A6517E054D903FD5 gVV[16];
int gVVIndex;
$E3392BADC5CC9370D93DF6C5C1F3CB22 gFrame;
int ActNpc342(NPCHAR *)::_flash;
$EEE7987CBFE674A81758BE97986F1045 gFade;
Uint32 _mask_color;
$B90EA47B6E9A23B893DF2789D4C5DBB1 gMC;
_DWORD dword_81C8584;
int dir;
_UNKNOWN unk_81C858C;
_UNKNOWN unk_81C8590;
_UNKNOWN unk_81C8594;
_UNKNOWN unk_81C8598;
int x;
int y;
_UNKNOWN unk_81C85A4;
_UNKNOWN unk_81C85A8;
_UNKNOWN unk_81C85AC;
_UNKNOWN unk_81C85B0;
_UNKNOWN unk_81C85B4;
_UNKNOWN unk_81C85B8;
_UNKNOWN unk_81C85BC;
_UNKNOWN unk_81C85C0;
_UNKNOWN unk_81C85C4;
_UNKNOWN unk_81C85C8;
_UNKNOWN unk_81C85CC;
_UNKNOWN unk_81C85D0;
_UNKNOWN unk_81C85D4;
_UNKNOWN unk_81C85D8;
_UNKNOWN unk_81C85DC;
_UNKNOWN unk_81C85E0;
__int128 xmmword_81C85E4;
RECT stru_81C85F4;
_UNKNOWN unk_81C8608;
int value;
_UNKNOWN unk_81C8610;
_UNKNOWN unk_81C8612;
_UNKNOWN unk_81C8613;
signed __int16 word_81C8614;
_UNKNOWN unk_81C8616;
_UNKNOWN unk_81C8618;
int dword_81C861C;
_UNKNOWN unk_81C8620;
_UNKNOWN unk_81C8624;
_UNKNOWN unk_81C8628;
_UNKNOWN unk_81C862C;
_UNKNOWN unk_81C862D;
_UNKNOWN unk_81C862E;
_UNKNOWN unk_81C8630;
int _noise_no;
Uint32 _noise_freq;
$E6546247C29CB722C536082DCFE3A174 gBL;
unsigned __int8 gFlagNPC[1000];
unsigned __int8 gSkipFlag[8];
unsigned __int8 ActBossChar_Ballos(void)::_flash;
Uint8 *org_waves;
$5F3F5665D4853494D3935C18994FCA41 Player;
$4AB8D1A8A7198C298836BEA20F02E4D8 _star[3];
int ActStar(void)::_a;
$DC890D5E5AA9C328B36A6715ACB40917 gPermitStage[8];
int gSelectedStage;
int gStageSelectTitleY;
unsigned int PutStageSelectObject(void)::flash;
Sint8 waveModelTable[1536];
$96A7816609F59F56E43A9A5E8F547E1B gBul[64];
unsigned int ActBullet_SuperMissile(BULLET *,long)::inc;
unsigned int ActBullet_Missile(BULLET *,long)::inc;
unsigned int ActBullet_Frontia2(BULLET *,long)::inc;
$223C71E5D7CCC0F84FEFCDD656B66DEC gBack;
int gWaterY;
unsigned int _color_black;
int _empty;
int _spur_charge;
int ShootBullet(void)::soft_rensha;
bool ShootBullet_Spur(long)::_bMax;
int ShootBullet_Bubblin2(long)::wait;
int ShootBullet_Bubblin1(void)::wait;
int ShootBullet_Machinegun1(long)::wait;
Sint8 gWaveModelTable[1536];
bool wave_tables_made;
int _time_count;
unsigned __int8 PutArmsEnergy(bool)::add_flash;
char gMapping[128];
int gSin[256];
__int16 gTan[33];
unsigned __int8 ActBossChar_Press(void)::_flash;
MapName gMapName;
int gStageNo;
int gMusicNo;
Sint32 gOldPos;
int gOldNo;
int ActBossChar_Undead(void)::_life;
unsigned __int8 ActBossChar_Undead(void)::_flash;
unsigned __int8 ActBossChar_Core(void)::_flash;
$4AB8D1A8A7198C298836BEA20F02E4D8 gCrt[64];
SDL_Joystick *joystick;
$D3B267130C558B6C8C7B7A80A5697BE6 gArmsData[8];
$4010822F30180CACF39DC1B3C7E9022D gItemData[32];
int gSelectedArms;
int gSelectedItem;
int gCampTitleY;
int gCampActive;
unsigned int PutCampObject(void)::flash;
unsigned __int8 ActBossChar_Ironhead(void)::_flash;
NPCHAR_0 gBoss[20];
_UNKNOWN unk_81CCFC4;
int unk_81CCFC8;
int unk_81CCFCC;
_UNKNOWN unk_81CCFD0;
_UNKNOWN unk_81CCFD4;
_UNKNOWN unk_81CCFE0;
_UNKNOWN unk_81CCFE4;
_UNKNOWN unk_81CCFE8;
_UNKNOWN unk_81CCFF0;
_UNKNOWN unk_81CCFF8;
_UNKNOWN unk_81CCFFC;
_UNKNOWN unk_81CD000;
_UNKNOWN unk_81CD004;
_UNKNOWN unk_81CD008;
_UNKNOWN unk_81CD00C;
_UNKNOWN unk_81CD010;
_UNKNOWN unk_81CD014;
_UNKNOWN unk_81CD018;
_UNKNOWN unk_81CD01C;
_UNKNOWN unk_81CD020;
_UNKNOWN unk_81CD024;
_UNKNOWN unk_81CD028;
_UNKNOWN unk_81CD034;
_DWORD dword_81CD038;
_UNKNOWN unk_81CD03C;
_UNKNOWN unk_81CD040;
_UNKNOWN unk_81CD044;
_UNKNOWN unk_81CD048;
_UNKNOWN unk_81CD04C;
_UNKNOWN unk_81CD050;
_UNKNOWN unk_81CD054;
_UNKNOWN unk_81CD058;
_UNKNOWN unk_81CD05C;
_UNKNOWN unk_81CD060;
_UNKNOWN unk_81CD064;
NPCHAR_0 npc;
NPCHAR_0 stru_81CD118;
NPCHAR_0 stru_81CD1C4;
NPCHAR_0 stru_81CD270;
NPCHAR_0 stru_81CD31C;
NPCHAR_0 stru_81CD3C8;
NPCHAR_0 stru_81CD474;
NPCHAR_0 stru_81CD520;
NPCHAR_0 stru_81CD5CC;
NPCHAR_0 stru_81CD678;
NPCHAR_0 stru_81CD724;
NPCHAR_0 stru_81CD7D0;
NPCHAR_0 stru_81CD87C;
NPCHAR_0 stru_81CD928;
NPCHAR_0 stru_81CD9D4;
NPCHAR_0 stru_81CDA80;
$FE85C58A60403E3389C96E96D80030A8 *orgs[8][8][2];
$FE85C58A60403E3389C96E96D80030A8 *chunks[160];
int device_frequency;
Uint16 device_format;
int device_channels;
$8D9359E30B30BEB685C90F8A0F30C069 mix_chans[255];
unsigned int mix_nextfree;
SDL_Surface_0 *gscreen;
char gModulePath[260];
char gDataPath[260];
bool gbUseJoystick;
int gJoystickButtonTable[8];
bool _bActive;
int g_mute[16];
Uint8 _key_on[16];
Uint8 _key_twin[16];
char wave_data[25600];
$C1127D3748787668AAF0293B2D646CFD *org_data;
Sint32 _PlayPos;
NOTELIST_0 *np[16];
int _now_leng[8];
int _TrackVol[16];
bool _bFadeout;
int g_GameFlags;
int gCounter;
bool _bContinue;
int gKey;
int gKeyTrg;
int GetTrg(void)::_key_old;
$3999A2E3BC6E7A1D19AF6FBFAF274F94 *gNpcTable;
$ADBFBA5FD9F608539A549A0DE3CC3084 gTS;
_DWORD dword_81D59CC[62];
int unk_81D5AC4;
unsigned __int8 *unk_81D5AC8;
_UNKNOWN unk_81D5ACC;
_UNKNOWN unk_81D5ACD;
int unk_81D5AD0;
_UNKNOWN unk_81D5AD4;
_UNKNOWN unk_81D5AD8;
_UNKNOWN unk_81D5AEC;
_UNKNOWN unk_81D5AF0;
int no;
_UNKNOWN unk_81D5AF8;
_UNKNOWN unk_81D5AFC;
_UNKNOWN unk_81D5B00;
_DWORD dword_81D5B04;
int dword_81D5B08;
RECT rcView;
_UNKNOWN unk_81D5B1C;
_UNKNOWN unk_81D5B20;
int gNumberTextScript[4];
char _text[256];
$F81DAB7A3C5C75230BC79406CA55D892 gMap;
unsigned __int8 PutMapDataVector(long,long)::count;
unsigned __int8 ActBossChar03_face(NPCHAR *)::flash;
NPCHAR_0 gNPC[512];
int gCurlyShoot_wait;
int gCurlyShoot_x;
int gCurlyShoot_y;
int gSuperXpos;
int gSuperYpos;
// extern _UNKNOWN _gmon_start__; weak


//----- (0804901C) --------------------------------------------------------
int init_proc()
{
  int v1;

  if ( &_gmon_start__ )
    __gmon_start__();
  frame_dummy();
  _do_global_ctors_aux();
  return v1;
}


//----- (08049470) --------------------------------------------------------
#error "8049473: positive sp value has been found (funcsize=2)"

//----- (080494A0) --------------------------------------------------------
void _do_global_dtors_aux()
{
  int v0;
  unsigned int i;

  if ( !completed_5829 )
  {
    v0 = dtor_idx_5831;
    for ( i = ((&_DTOR_END__ - (_UNKNOWN *)_DTOR_LIST__) >> 2) - 1; dtor_idx_5831 < i; v0 = dtor_idx_5831 )
    {
      dtor_idx_5831 = v0 + 1;
      ((void (*)(void))_DTOR_LIST__[v0 + 1])();
    }
    completed_5829 = 1;
  }
}




//----- (08049500) --------------------------------------------------------
int frame_dummy()
{
  int result;

  result = _JCR_LIST__;
  if ( _JCR_LIST__ )
    result = 0;
  return result;
}


//----- (08049524) --------------------------------------------------------
void __cdecl RGB(SDL_Color_0 *retstr, Uint8 r, Uint8 g, Uint8 b)
{
  *retstr = 0;                                  // TODO: More of a memset 0 of the SDL_Color struct
  retstr->unused = -1;
  retstr->r = r;
  retstr->g = g;
  retstr->b = b;
}

//----- (08049566) --------------------------------------------------------
void InitFlash()
{
  SDL_Color_0 r;

  RGB(&r, 0xFFu, 0xFFu, 0xFEu);
  gFlashColor = GetCortBoxColor(&r);
}

//----- (080495A4) --------------------------------------------------------
void __cdecl SetFlash(int x, int y, int mode)
{
  unk_81C79E4 = 0;
  unk_81C79E8 = 1;
  unk_81C79F4 = x;
  unk_81C79F8 = y;
  flash.mode = mode;
  unk_81C79EC = 0;
  unk_81C79F0 = 0;
}

//----- (080495E9) --------------------------------------------------------
void __cdecl ActFlash_Explosion(int flx, int fly)
{
  Sint32 left;
  Sint32 top;
  Sint32 topa;
  Sint32 right;
  Sint32 bottom;
  Sint32 bottoma;

  if ( unk_81C79E4 )
  {
    if ( unk_81C79E4 == 1 )
    {
      unk_81C79F0 -= unk_81C79F0 / 8;
      if ( (unsigned int)(unk_81C79F0 + 255) <= 0x1FE )
        unk_81C79E8 = 0;
      topa = (unk_81C79F8 - fly - unk_81C79F0) / 512;
      if ( topa < 0 )
        topa = 0;
      bottoma = (unk_81C79F8 - fly + unk_81C79F0) / 512;
      if ( bottoma > 240 )
        bottoma = 240;
      rect.left = 0;
      rect.right = 0;
      rect.top = 0;
      rect.bottom = 0;
      stru_81C7A0C.top = topa;
      stru_81C7A0C.bottom = bottoma;
      stru_81C7A0C.left = 0;
      stru_81C7A0C.right = 320;
    }
  }
  else
  {
    unk_81C79EC += 512;
    unk_81C79F0 += unk_81C79EC;
    left = (unk_81C79F4 - flx - unk_81C79F0) / 512;
    top = (unk_81C79F8 - fly - unk_81C79F0) / 512;
    right = (unk_81C79F4 - flx + unk_81C79F0) / 512;
    bottom = (unk_81C79F8 - fly + unk_81C79F0) / 512;
    if ( left < 0 )
      left = 0;
    if ( top < 0 )
      top = 0;
    if ( right > 320 )
      right = 320;
    if ( bottom > 240 )
      bottom = 240;
    rect.left = left;
    rect.right = right;
    rect.top = 0;
    rect.bottom = 240;
    stru_81C7A0C.left = 0;
    stru_81C7A0C.right = 320;
    stru_81C7A0C.top = top;
    stru_81C7A0C.bottom = bottom;
    if ( unk_81C79F0 > 655360 )
    {
      unk_81C79E4 = 1;
      unk_81C79EC = 0;
      unk_81C79F0 = 122880;
    }
  }
}

//----- (08049865) --------------------------------------------------------
void ActFlash_Flash()
{
  ++unk_81C79EC;
  rect.left = 0;
  rect.right = 0;
  rect.top = 0;
  rect.bottom = 0;
  if ( unk_81C79EC / 2 & 1 )
  {
    stru_81C7A0C.top = 0;
    stru_81C7A0C.bottom = 240;
    stru_81C7A0C.left = 0;
    stru_81C7A0C.right = 320;
  }
  else
  {
    stru_81C7A0C.left = 0;
    stru_81C7A0C.right = 0;
    stru_81C7A0C.top = 0;
    stru_81C7A0C.bottom = 0;
  }
  if ( unk_81C79EC > 20 )
    unk_81C79E8 = 0;
}

//----- (0804991B) --------------------------------------------------------
void __cdecl ActFlash(int flx, int fly)
{
  if ( unk_81C79E8 )
  {
    if ( flash.mode == 1 )
    {
      ActFlash_Explosion(flx, fly);
    }
    else if ( flash.mode == 2 )
    {
      ActFlash_Flash();
    }
  }
}

//----- (08049959) --------------------------------------------------------
void PutFlash()
{
  if ( unk_81C79E8 )
  {
    CortBox(&rect, gFlashColor);
    CortBox(&stru_81C7A0C, gFlashColor);
  }
}

//----- (08049997) --------------------------------------------------------
void ResetFlash()
{
  unk_81C79E8 = 0;
}

//----- (080499A8) --------------------------------------------------------
bool __cdecl is_RECT_valid(const RECT *const r, const SDL_Surface_0 *s)
{
  return r->right >= 0
      && r->bottom >= 0
      && r->right >= r->left
      && r->bottom >= r->top
      && r->left < s->w * magnification
      && r->top < s->h * magnification;
}

//----- (08049A1B) --------------------------------------------------------
void __cdecl RECT_to_SDL_Rect(SDL_Rect_0 *retstr, const RECT *const src, const SDL_Surface_0 *s)
{
  int x;
  int y;
  unsigned int w;
  unsigned int h;

  x = src->left * magnification;
  y = src->top * magnification;
  w = (src->right - src->left) * magnification;
  h = (src->bottom - src->top) * magnification;
  *(_DWORD *)&retstr->x = 0;                    // TODO: More memsets
  *(_DWORD *)&retstr->w = 0;                    // These can just be removed since they get written to
  retstr->x = x;
  retstr->y = y;
  retstr->w = w;
  retstr->h = h;
}

//----- (08049AA6) --------------------------------------------------------
bool __cdecl Flip_SystemTask(SDL_Surface_0 *screen)
{
  Uint32 current_time;
  Uint32 next_time;

  if ( !`guard variable for'Flip_SystemTask(SDL_Surface *)::previous_time// TODO: WTF
    && __cxa_guard_acquire(&`guard variable for'Flip_SystemTask(SDL_Surface *)::previous_time) != 0 )
  {
    Flip_SystemTask(SDL_Surface *)::previous_time = SDL_GetTicks();
    __cxa_guard_release(&`guard variable for'Flip_SystemTask(SDL_Surface *)::previous_time);
  }
  current_time = SDL_GetTicks();
  next_time = Flip_SystemTask(SDL_Surface *)::previous_time + 20;
  if ( current_time >= Flip_SystemTask(SDL_Surface *)::previous_time + 20 )
  {
    Flip_SystemTask(SDL_Surface *)::previous_time = current_time;
  }
  else
  {
    while ( current_time < next_time )
    {
      SDL_Delay(1);
      current_time = SDL_GetTicks();
    }
    Flip_SystemTask(SDL_Surface *)::previous_time = next_time;
  }
  SDL_Flip(screen);
  return SystemTask() == 1;                     // TODO: This is dumb
}






//----- (08049B88) --------------------------------------------------------
bool __cdecl StartDirectDraw(SDL_Surface_0 *screen, int magnification)
{
  const SDL_Rect_0 clip;
  const int w;
  const int h;

  ::screen = screen;
  ::magnification = magnification;
  w = screen->w / magnification;
  h = screen->h / magnification;
  x_offset = (w - 320) / 2;
  y_offset = (h - 240) / 2;
  clip.x = (w - 320) / 2 * magnification;
  clip.y = (h - 240) / 2 * magnification;
  clip.w = 320 * magnification;
  clip.h = 240 * magnification;
  SDL_SetClipRect(screen, &clip);
  return 1;
}


//----- (08049C60) --------------------------------------------------------
void __cdecl EndDirectDraw()
{
  int i;

  for ( i = 0; i <= 39; ++i )
  {
    if ( _surf_S[i] )
    {
      SDL_FreeSurface(_surf_S[i]);
      _surf_S[i] = 0;
    }
  }
}


//----- (08049CAE) --------------------------------------------------------
void __cdecl ReleaseSurface(int s)
{
  if ( _surf_S[s] )
  {
    SDL_FreeSurface(_surf_S[s]);
    _surf_S[s] = 0;
  }
}


//----- (08049CE4) --------------------------------------------------------
bool __cdecl MakeSurface(SDL_RWops_0 *rw, int surf_no)
{
  int v3;
  int v4;
  Uint32 v5;
  SDL_Surface_0 *v6;
  SDL_Rect_0 dstrect;
  SDL_Rect_0 srcrect;
  SDL_Surface_0 *unscaled;
  SDL_Surface_0 *scaled;
  SDL_Surface_0 **const display_format;

  if ( surf_no > 40 )
  {
    ErrorLog("surface no", surf_no);
    return 0;
  }
  if ( _surf_S[surf_no] )
  {
    ErrorLog("existing", surf_no);
    return 0;
  }
  unscaled = SDL_LoadBMP_RW(rw, 1);
  if ( !unscaled )
  {
    ErrorLog("path", 1);
    return 0;
  }
  if ( magnification == 1 )
  {
    scaled = unscaled;
    ++unscaled->refcount;
  }
  else
  {
    scaled = SDL_CreateRGBSurface(
               4096,
               unscaled->w * magnification,
               magnification * unscaled->h,     // TODO: Lawl
               unscaled->format->BitsPerPixel,
               unscaled->format->Rmask,
               unscaled->format->Gmask,
               unscaled->format->Bmask,
               unscaled->format->Amask);
    if ( !scaled )
    {
      ErrorLog("scale", 0);
      return 0;
    }
    v3 = *(_DWORD *)&unscaled->clip_rect.w;     // TODO: Annoying optimisation. It's just a struct-to-struct copy
    *(_DWORD *)&srcrect.x = *(_DWORD *)&unscaled->clip_rect.x;
    *(_DWORD *)&srcrect.w = v3;
    v4 = *(_DWORD *)&scaled->clip_rect.w;
    *(_DWORD *)&dstrect.x = *(_DWORD *)&scaled->clip_rect.x;
    *(_DWORD *)&dstrect.w = v4;
    SDL_SoftStretch(unscaled, &srcrect, scaled, &dstrect);
    SDL_SetColors(scaled, unscaled->format->palette->colors, 0, unscaled->format->palette->ncolors);
  }
  SDL_FreeSurface(unscaled);
  unscaled = 0;
  v5 = SDL_MapRGB(scaled->format, 0, 0, 0);
  SDL_SetColorKey(scaled, 4096, v5);
  display_format = &_surf_S[surf_no];
  v6 = SDL_DisplayFormat(scaled);
  *display_format = v6;
  SDL_FreeSurface(scaled);
  return 1;
}





//----- (08049F3E) --------------------------------------------------------
bool __cdecl MakeSurface_Resource(char *name, int surf_no)
{
  SDL_RWops_0 *v2;

  v2 = open_resource(name);
  return MakeSurface(v2, surf_no);
}

//----- (08049F60) --------------------------------------------------------
bool __cdecl MakeSurface_File(char *name, int surf_no)
{
  bool result;
  SDL_RWops_0 *v3;
  char path[260];

  sprintf(path, "%s/%s.pbm", gDataPath, name);
  if ( !IsEnableBitmap(path) )
  {
    ErrorLog(path, 0);
    result = 0;
  }
  else
  {
    v3 = SDL_RWFromFile(path, "rb");
    result = MakeSurface(v3, surf_no);
  }
  return result;
}

//----- (08049FE7) --------------------------------------------------------
bool __cdecl ReloadBitmap_Resource(char *name, int surf_no)
{
  ReleaseSurface(surf_no);
  return MakeSurface_Resource(name, surf_no);
}

//----- (0804A00C) --------------------------------------------------------
bool __cdecl ReloadBitmap_File(char *name, int surf_no)
{
  ReleaseSurface(surf_no);
  return MakeSurface_File(name, surf_no);
}

//----- (0804A031) --------------------------------------------------------
bool __cdecl MakeSurface_Generic(int bxsize, int bysize, int surf_no)
{
  Uint32 v4;
  SDL_Surface_0 *surface;

  surface = SDL_CreateRGBSurface(
              4096,
              bxsize * magnification,
              bysize * magnification,
              screen->format->BitsPerPixel,
              screen->format->Rmask,
              screen->format->Gmask,
              screen->format->Bmask,
              screen->format->Amask);
  if ( !surface )
    return 0;
  v4 = SDL_MapRGB(surface->format, 0, 0, 0);
  SDL_SetColorKey(surface, 4096, v4);
  _surf_S[surf_no] = SDL_DisplayFormat(surface);
  SDL_FreeSurface(surface);
  return 1;
}



//----- (0804A153) --------------------------------------------------------
void __cdecl Blit(SDL_Surface_0 *src, const RECT *const srcrect, SDL_Surface_0 *dst, const RECT *const dstrect)
{
  bool v4;
  SDL_Rect_0 dstrect2;
  SDL_Rect_0 srcrect2;

  v4 = is_RECT_valid(srcrect, src) && is_RECT_valid(dstrect, dst);
  if ( v4 )
  {
    RECT_to_SDL_Rect(&srcrect2, srcrect, src);
    RECT_to_SDL_Rect(&dstrect2, dstrect, dst);
    SDL_UpperBlit(src, &srcrect2, dst, &dstrect2);
  }
}


//----- (0804A1EF) --------------------------------------------------------
void __cdecl BackupSurface(int surf_no, RECT *rect)
{
  const RECT srcrect;

  srcrect.left = 0;
  srcrect.top = 0;
  srcrect.right = 0;
  srcrect.bottom = 0;
  srcrect.left = rect->left + x_offset;
  srcrect.top = rect->top + y_offset;
  srcrect.right = rect->right + x_offset;
  srcrect.bottom = rect->bottom + y_offset;
  Blit(screen, &srcrect, _surf_S[surf_no], rect);
}

//----- (0804A27F) --------------------------------------------------------
void __cdecl PutBitmap3(RECT *rcView, int x, int y, RECT *rect, int surf_no)
{
  RECT rcSet;
  RECT rcWork;
  SDL_Surface_0 *surface;

  rcWork.left = rect->left;
  rcWork.top = rect->top;
  rcWork.right = rect->right;
  rcWork.bottom = rect->bottom;
  if ( x + rect->right - rect->left > rcView->right )
    rcWork.right += rcView->right + rect->left - (x + rect->right);
  if ( rcView->left > x )
  {
    rcWork.left += rcView->left - x;
    x = rcView->left;
  }
  if ( y + rect->bottom - rect->top > rcView->bottom )
    rcWork.bottom += rcView->bottom + rect->top - (y + rect->bottom);
  if ( rcView->top > y )
  {
    rcWork.top += rcView->top - y;
    y = rcView->top;
  }
  rcSet.left = x + x_offset;
  rcSet.top = y + y_offset;
  rcSet.right = rcWork.right + x + x_offset - rcWork.left;
  rcSet.bottom = rcWork.bottom + y + y_offset - rcWork.top;
  surface = _surf_S[surf_no];
  if ( surface )
    Blit(surface, &rcWork, screen, &rcSet);
}

//----- (0804A3EA) --------------------------------------------------------
void __cdecl PutBitmap4(RECT *rcView, int x, int y, RECT *rect, int surf_no)
{
  PutBitmap3(rcView, x, y, rect, surf_no);
}

//----- (0804A419) --------------------------------------------------------
void __cdecl Surface2Surface(int x, int y, RECT *rect, int to, int from)
{
  RECT rcSet;

  rcSet.left = x;
  rcSet.top = y;
  rcSet.right = x + rect->right - rect->left;
  rcSet.bottom = y + rect->bottom - rect->top;
  Blit(_surf_S[from], rect, _surf_S[to], &rcSet);
}

//----- (0804A48E) --------------------------------------------------------
Uint32 __cdecl GetCortBoxColor(const SDL_Color_0 *const rgb)
{
  return SDL_MapRGB(screen->format, rgb->r, rgb->g, rgb->b);
}

//----- (0804A4D4) --------------------------------------------------------
void __cdecl Fill(const RECT *const rect, SDL_Surface_0 *surface, Uint32 col)
{
  SDL_Rect_0 dstrect;

  if ( is_RECT_valid(rect, surface) )
  {
    RECT_to_SDL_Rect(&dstrect, rect, surface);
    SDL_FillRect(surface, &dstrect, col);
  }
}


//----- (0804A527) --------------------------------------------------------
void __cdecl CortBox(RECT *rect, Uint32 col)
{
  const RECT dstrect;

  dstrect.left = 0;
  dstrect.top = 0;
  dstrect.right = 0;
  dstrect.bottom = 0;
  dstrect.left = rect->left + x_offset;
  dstrect.top = rect->top + y_offset;
  dstrect.right = rect->right + x_offset;
  dstrect.bottom = rect->bottom + y_offset;
  Fill(&dstrect, screen, col);
}

//----- (0804A5A9) --------------------------------------------------------
void __cdecl CortBox2(RECT *rect, Uint32 col, int surf)
{
  Fill(rect, _surf_S[surf], col);
}

//----- (0804A5D1) --------------------------------------------------------
void __cdecl InitTextObject()
{
  SDL_RWops_0 *v0;
  SDL_Surface_0 *v1;
  Uint32 v2;
  char font_name[128];

  memset(font_name, 0, sizeof(font_name));
  sprintf(font_name, "font_en_%d", magnification);
  v0 = open_resource(font_name);
  v1 = SDL_LoadBMP_RW(v0, 1);
  font = v1;
  v2 = SDL_MapRGB(v1->format, 0, 0, 0);
  SDL_SetColorKey(font, 4096, v2);
}


//----- (0804A680) --------------------------------------------------------
void __cdecl PutTextImpl(int x, int y, const char *text, const SDL_Color_0 *const color, SDL_Surface_0 *surface)
{
  Sint16 v5;
  SDL_Color_0 palette[256];
  SDL_Rect_0 dstrect;
  SDL_Rect_0 srcrect;
  const Uint16 src_char_size;
  const Sint16 dst_char_width;
  const Sint16 dst_char_height;
  const unsigned __int8 *c;
  Sint16 dst_x;
  const Sint16 dst_y;
  Sint16 space_width;
  size_t i;
  const Sint16 src_x;
  const Sint16 src_y;

  if ( font && surface )
  {
    for ( i = 0; i <= 0xFF; ++i )
    {
      palette[i].r = i * color->r / 0xFF;
      palette[i].g = i * color->g / 0xFF;
      palette[i].b = i * color->b / 0xFF;
      palette[i].unused = i;
    }
    SDL_SetColors(font, palette, 0, 256);
    src_char_size = 8 * magnification;
    dst_char_width = 6 * magnification;
    dst_char_height = 12 * magnification;
    c = (const unsigned __int8 *)text;
    dst_x = magnification * x                   // TODO: WTF
          - ((((unsigned __int16)(8 * magnification) < (signed int)(signed __int16)(6 * magnification))
            + (unsigned __int16)(8 * magnification)
            - (signed int)(signed __int16)(6 * magnification)) >> 1);
    dst_y = magnification * y
          - ((((unsigned __int16)(8 * magnification) < (signed int)(signed __int16)(12 * magnification))
            + (unsigned __int16)(8 * magnification)
            - (signed int)(signed __int16)(12 * magnification)) >> 1);
    space_width = 9 * magnification / 2;
    if ( magnification == 1 )
      space_width = 5;
    while ( *c )
    {
      src_x = src_char_size * (*c & 0xF);
      src_y = src_char_size * (*c >> 4);
      srcrect.x = src_x;
      srcrect.y = src_y;
      srcrect.w = src_char_size;
      srcrect.h = src_char_size;
      dstrect.x = dst_x;
      dstrect.y = dst_y;
      dstrect.w = src_char_size;
      dstrect.h = src_char_size;
      SDL_UpperBlit(font, &srcrect, surface, &dstrect);
      if ( *c == 32 )
      {
        dst_x += space_width;
        if ( magnification == 1 )
        {
          if ( space_width == 4 )
            v5 = 5;
          else
            v5 = 4;
          space_width = v5;
        }
      }
      else
      {
        dst_x += dst_char_width;
      }
      ++c;
    }
  }
}



//----- (0804A96F) --------------------------------------------------------
void __cdecl PutText(int x, int y, const char *text, const SDL_Color_0 *const color)
{
  PutTextImpl(x + x_offset, y + y_offset, text, color, screen);
}

//----- (0804A9AD) --------------------------------------------------------
void __cdecl PutText2(int x, int y, const char *text, const SDL_Color_0 *const color, int surf)
{
  PutTextImpl(x, y, text, color, _surf_S[surf]);
}

//----- (0804A9E3) --------------------------------------------------------
void EndTextObject()
{
  if ( font )
  {
    SDL_FreeSurface(font);
    font = 0;
  }
}


//----- (0804AA0C) --------------------------------------------------------
void __cdecl ActNpc180(NPCHAR_0 *npc)
{
  int v1;
  unsigned __int16 v2;
  bool v3;
  int v4;
  int v5;
  NPCHAR_0 *v6;
  RECT *v7;
  RECT rcRight[11];
  RECT rcLeft[11];
  int xx;
  int yy;
  RECT *v12;

  qmemcpy(rcLeft, &ActNpc180(NPCHAR *)::C.0, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc180(NPCHAR *)::C.1, sizeof(rcRight));
  if ( npc->y >= y - 0x14000 )
  {
    if ( gCurlyShoot_wait )
    {
      npc->tgt_x = gCurlyShoot_x;
      npc->tgt_y = gCurlyShoot_y;
    }
    else
    {
      npc->tgt_x = x;
      npc->tgt_y = y;
    }
  }
  else
  {
    if ( npc->y > 0x1FFFF )
      npc->tgt_x = 0;
    else
      npc->tgt_x = 2621440;
    npc->tgt_y = npc->y;
  }
  if ( npc->xm < 0 && npc->flag & 1 )
    npc->xm = 0;
  if ( npc->xm > 0 && npc->flag & 4 )
    npc->xm = 0;
  v1 = npc->act_no;
  if ( v1 == 41 )
  {
LABEL_34:
    if ( ++npc->act_wait == 750 )
    {
      v2 = npc->bits;
      HIBYTE(v2) &= 0xDFu;                      // TODO: This is probably a compiler optimisation. Compare to unoptimised Windows build.
      npc->bits = v2;
      npc->ani_no = 0;
    }
    if ( npc->act_wait > 1000 )
    {
      npc->act_no = 100;
      npc->ani_no = 0;
      SetNpChar(183, 0, 0, 0, 0, 0, npc, 256);
      if ( (unsigned __int8)GetNPCFlag(563) )
        SetNpChar(182, 0, 0, 0, 0, 0, npc, 256);
      else
        SetNpChar(181, 0, 0, 0, 0, 0, npc, 256);
    }
    goto LABEL_54;
  }
  if ( v1 <= 41 )
  {
    if ( v1 == 11 || v1 <= 11 )
      goto LABEL_54;
    if ( v1 == 20 )
    {
      npc->x = x;
      npc->y = y;
      npc->act_no = 100;
      npc->ani_no = 0;
      SetNpChar(183, 0, 0, 0, 0, 0, npc, 256);
      if ( (unsigned __int8)GetNPCFlag(563) )
        SetNpChar(182, 0, 0, 0, 0, 0, npc, 256);
      else
        SetNpChar(181, 0, 0, 0, 0, 0, npc, 256);
      goto LABEL_54;
    }
    if ( v1 != 40 )
      goto LABEL_54;
    npc->act_no = 41;
    npc->act_wait = 0;
    npc->ani_no = 10;
    goto LABEL_34;
  }
  if ( v1 == 210 )
  {
    npc->xm -= 32;
    npc->direct = 0;
    if ( npc->flag & 8 )
      npc->act_no = 100;
  }
  else if ( v1 > 210 )
  {
    if ( v1 == 300 )
    {
      npc->xm += 32;
      npc->direct = 2;
      if ( npc->flag & 4 )
        ++npc->count1;
      else
        npc->count1 = 0;
    }
    else if ( v1 == 310 )
    {
      npc->xm += 32;
      npc->direct = 2;
      if ( npc->flag & 8 )
        npc->act_no = 100;
    }
  }
  else if ( v1 == 100 )
  {
    npc->ani_no = 0;
    npc->xm = 7 * npc->xm / 8;
    npc->count1 = 0;
    if ( npc->x <= npc->tgt_x + 0x2000 )
    {
      if ( npc->x < npc->tgt_x - 0x2000 )
      {
        npc->act_no = 300;
        npc->ani_no = 1;
        npc->direct = 2;
        npc->act_wait = Random(20, 60);
      }
    }
    else
    {
      npc->act_no = 200;
      npc->ani_no = 1;
      npc->direct = 0;
      npc->act_wait = Random(20, 60);
    }
  }
  else if ( v1 == 200 )
  {
    npc->xm -= 32;
    npc->direct = 0;
    if ( npc->flag & 1 )
      ++npc->count1;
    else
      npc->count1 = 0;
  }
LABEL_54:
  if ( gCurlyShoot_wait )
    --gCurlyShoot_wait;
  if ( gCurlyShoot_wait == 70 )
    npc->count2 = 10;
  v3 = gCurlyShoot_wait == 60 && npc->flag & 8 && Random(0, 2);
  if ( v3 )
  {
    npc->count1 = 0;
    npc->ym = -1536;
    npc->ani_no = 1;
    PlaySoundObject(15, 1);
    if ( npc->x <= npc->tgt_x )
      npc->act_no = 310;
    else
      npc->act_no = 210;
  }
  xx = npc->x - npc->tgt_x;
  yy = npc->y - npc->tgt_y;
  if ( xx < 0 )
    xx = -xx;
  if ( npc->act_no == 100 )
  {
    if ( xx + 1024 >= yy )
      npc->ani_no = 0;
    else
      npc->ani_no = 5;
  }
  if ( npc->act_no == 210 || npc->act_no == 310 )
  {
    if ( xx + 1024 >= yy )
      npc->ani_no = 1;
    else
      npc->ani_no = 6;
  }
  if ( npc->act_no == 200 || npc->act_no == 300 )
  {
    ++npc->ani_wait;
    if ( xx + 1024 >= yy )
      v4 = npc->ani_wait / 4 % 4 + 1;
    else
      v4 = npc->ani_wait / 4 % 4 + 6;
    npc->ani_no = v4;
    if ( npc->act_wait )
    {
      --npc->act_wait;
      if ( npc->flag && npc->count1 > 10 )
      {
        npc->count1 = 0;
        npc->ym = -1536;
        npc->act_no += 10;
        npc->ani_no = 1;
        PlaySoundObject(15, 1);
      }
    }
    else
    {
      npc->act_no = 100;
      npc->ani_no = 0;
    }
  }
  if ( npc->act_no > 99 && npc->act_no <= 499 )
  {
    if ( npc->x >= x - 40960 && npc->x <= x + 40960 )
    {
      npc->ym += 51;
    }
    else
    {
      if ( npc->flag )
        v5 = npc->ym + 16;
      else
        v5 = npc->ym + 51;
      npc->ym = v5;
    }
  }
  if ( npc->xm > 768 )
    npc->xm = 768;
  if ( npc->xm < -768 )
    npc->xm = -768;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->act_no > 99 && !(npc->flag & 8) && npc->ani_no != 1000 )
  {
    if ( xx + 1024 >= yy )
      npc->ani_no = 1;
    else
      npc->ani_no = 6;
  }
  if ( npc->direct )
  {
    v6 = npc;
    v7 = (RECT *)(&v12 + 4 * npc->ani_no - 90);
  }
  else
  {
    v6 = npc;
    v7 = (RECT *)(&v12 + 4 * npc->ani_no - 46);
  }
  npc->rect.left = v7->left;
  v6->rect.top = v7->top;
  v6->rect.right = v7->right;
  v6->rect.bottom = v7->bottom;
}
/* Orphan comments:
TODO: More WTF
TODO: Actually points at end of RECT array
*/

//----- (0804B422) --------------------------------------------------------
void __cdecl ActNpc181(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  NPCHAR_0 *v3;
  RECT *v4;
  RECT rcRight[2];
  RECT rcLeft[2];
  RECT *v7;

  rcLeft[0].left = 216;
  rcLeft[0].top = 152;
  rcLeft[0].right = 232;
  rcLeft[0].bottom = 168;
  rcLeft[1].left = 232;
  rcLeft[1].top = 152;
  rcLeft[1].right = 248;
  rcLeft[1].bottom = 168;
  rcRight[0].left = 216;
  rcRight[0].top = 168;
  rcRight[0].right = 232;
  rcRight[0].bottom = 184;
  rcRight[1].left = 232;
  rcRight[1].top = 168;
  rcRight[1].right = 248;
  rcRight[1].bottom = 184;
  if ( npc->pNpc )
  {
    if ( npc->pNpc->ani_no > 4 )
    {
      if ( npc->pNpc->direct )
        npc->direct = 2;
      else
        npc->direct = 0;
      npc->x = npc->pNpc->x;
      npc->y = npc->pNpc->y - 5120;
      npc->ani_no = 1;
    }
    else
    {
      if ( npc->pNpc->direct )
      {
        npc->direct = 2;
        v1 = npc->pNpc->x + 4096;
      }
      else
      {
        npc->direct = 0;
        v1 = npc->pNpc->x - 4096;
      }
      npc->x = v1;
      npc->y = npc->pNpc->y;
      npc->ani_no = 0;
    }
    if ( npc->pNpc->ani_no == 1 || npc->pNpc->ani_no == 3 || npc->pNpc->ani_no == 6 || npc->pNpc->ani_no == 8 )
      npc->y -= 512;
    v2 = npc->act_no;
    if ( v2 )
    {
      if ( v2 == 10 )
      {
        if ( ++npc->act_wait % 6 == 1 )
        {
          if ( npc->ani_no )
          {
            if ( npc->direct )
            {
              SetBullet(12, npc->x + 1024, npc->y - 2048, 1);
              SetCaret(npc->x + 1024, npc->y - 2048, 3, 0);
            }
            else
            {
              SetBullet(12, npc->x - 1024, npc->y - 2048, 1);
              SetCaret(npc->x - 1024, npc->y - 2048, 3, 0);
            }
          }
          else if ( npc->direct )
          {
            SetBullet(12, npc->x + 2048, npc->y + 1536, 2);
            SetCaret(npc->x + 2048, npc->y + 1536, 3, 0);
          }
          else
          {
            SetBullet(12, npc->x - 2048, npc->y + 1536, 0);
            SetCaret(npc->x - 2048, npc->y + 1536, 3, 0);
          }
        }
        if ( npc->act_wait == 60 )
          npc->act_no = 0;
      }
    }
    else if ( npc->pNpc->count2 == 10 )
    {
      npc->pNpc->count2 = 0;
      npc->act_no = 10;
      npc->act_wait = 0;
    }
    if ( npc->direct )
    {
      v3 = npc;
      v4 = (RECT *)&(&v7)[4 * npc->ani_no - 1]; // rcRight
    }
    else
    {
      v3 = npc;
      v4 = (RECT *)(&v7 + 4 * npc->ani_no - 8); // rcLeft
    }
    npc->rect.left = v4->left;
    v3->rect.top = v4->top;
    v3->rect.right = v4->right;
    v3->rect.bottom = v4->bottom;
  }
}

//----- (0804B8C3) --------------------------------------------------------
void __cdecl ActNpc182(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  NPCHAR_0 *v3;
  RECT *v4;
  RECT rcRight[2];
  RECT rcLeft[2];
  RECT *v7;

  rcLeft[0].left = 184;
  rcLeft[0].top = 152;
  rcLeft[0].right = 200;
  rcLeft[0].bottom = 168;
  rcLeft[1].left = 200;
  rcLeft[1].top = 152;
  rcLeft[1].right = 216;
  rcLeft[1].bottom = 168;
  rcRight[0].left = 184;
  rcRight[0].top = 168;
  rcRight[0].right = 200;
  rcRight[0].bottom = 184;
  rcRight[1].left = 200;
  rcRight[1].top = 168;
  rcRight[1].right = 216;
  rcRight[1].bottom = 184;
  if ( npc->pNpc )
  {
    if ( npc->pNpc->ani_no > 4 )
    {
      if ( npc->pNpc->direct )
        npc->direct = 2;
      else
        npc->direct = 0;
      npc->x = npc->pNpc->x;
      npc->y = npc->pNpc->y - 5120;
      npc->ani_no = 1;
    }
    else
    {
      if ( npc->pNpc->direct )
      {
        npc->direct = 2;
        v1 = npc->pNpc->x + 4096;
      }
      else
      {
        npc->direct = 0;
        v1 = npc->pNpc->x - 4096;
      }
      npc->x = v1;
      npc->y = npc->pNpc->y;
      npc->ani_no = 0;
    }
    if ( npc->pNpc->ani_no == 1 || npc->pNpc->ani_no == 3 || npc->pNpc->ani_no == 6 || npc->pNpc->ani_no == 8 )
      npc->y -= 512;
    v2 = npc->act_no;
    if ( v2 )
    {
      if ( v2 == 10 )
      {
        if ( ++npc->act_wait % 12 == 1 )
        {
          if ( npc->ani_no )
          {
            if ( npc->direct )
            {
              SetBullet(6, npc->x + 1024, npc->y - 2048, 1);
              SetCaret(npc->x + 1024, npc->y - 2048, 3, 0);
            }
            else
            {
              SetBullet(6, npc->x - 1024, npc->y - 2048, 1);
              SetCaret(npc->x - 1024, npc->y - 2048, 3, 0);
            }
          }
          else if ( npc->direct )
          {
            SetBullet(6, npc->x + 2048, npc->y + 1536, 2);
            SetCaret(npc->x + 2048, npc->y + 1536, 3, 0);
          }
          else
          {
            SetBullet(6, npc->x - 2048, npc->y + 1536, 0);
            SetCaret(npc->x - 2048, npc->y + 1536, 3, 0);
          }
        }
        if ( npc->act_wait == 60 )
          npc->act_no = 0;
      }
    }
    else if ( npc->pNpc->count2 == 10 )
    {
      npc->pNpc->count2 = 0;
      npc->act_no = 10;
      npc->act_wait = 0;
    }
    if ( npc->direct )
    {
      v3 = npc;
      v4 = (RECT *)&(&v7)[4 * npc->ani_no - 1];
    }
    else
    {
      v3 = npc;
      v4 = (RECT *)(&v7 + 4 * npc->ani_no - 8);
    }
    npc->rect.left = v4->left;
    v3->rect.top = v4->top;
    v3->rect.right = v4->right;
    v3->rect.bottom = v4->bottom;
  }
}

//----- (0804BD67) --------------------------------------------------------
void __cdecl ActNpc183(NPCHAR_0 *npc)
{
  RECT rect[2];
  RECT *v2;

  rect[0].left = 56;
  rect[0].top = 96;
  rect[0].right = 80;
  rect[0].bottom = 120;
  rect[1].left = 80;
  rect[1].top = 96;
  rect[1].right = 104;
  rect[1].bottom = 120;
  if ( npc->pNpc )
  {
    if ( !npc->act_no )
    {
      npc->x = npc->pNpc->x;
      npc->y = npc->pNpc->y;
      npc->act_no = 1;
    }
    npc->x += (npc->pNpc->x - npc->x) / 2;
    npc->y += (npc->pNpc->y - npc->y) / 2;
    if ( ++npc->ani_wait > 1 )
    {
      npc->ani_wait = 0;
      ++npc->ani_no;
    }
    if ( npc->ani_no > 1 )
      npc->ani_no = 0;
    if ( npc->pNpc->flag & 0x100 )
      npc->rect = (RECT)*((_OWORD *)&v2 + npc->ani_no - 2);
    else
      npc->rect.right = 0;
  }
}

//----- (0804BEED) --------------------------------------------------------
void __cdecl ActNpc184(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  RECT rc[4];
  int i;
  RECT *v9;

  rc[0].left = 0;
  rc[0].top = 64;
  rc[0].right = 32;
  rc[0].bottom = 96;
  rc[1].left = 32;
  rc[1].top = 64;
  rc[1].right = 64;
  rc[1].bottom = 96;
  rc[2].left = 64;
  rc[2].top = 64;
  rc[2].right = 96;
  rc[2].bottom = 96;
  rc[3].left = 32;
  rc[3].top = 64;
  rc[3].right = 64;
  rc[3].bottom = 96;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->x += 4096;
      npc->y += 4096;
      break;
    case 0xA:
      npc->act_no = 11;
      npc->ani_no = 1;
      npc->act_wait = 0;
      npc->bits |= 8u;
      goto LABEL_4;
    case 0xB:
LABEL_4:
      v1 = npc->direct;
      if ( v1 == 1 )
      {
        npc->y -= 128;
      }
      else if ( v1 > 1 )
      {
        if ( v1 == 2 )
        {
          npc->x += 128;
        }
        else if ( v1 == 3 )
        {
          npc->y += 128;
        }
      }
      else if ( !v1 )
      {
        npc->x -= 128;
      }
      if ( !(++npc->act_wait & 7) )
        PlaySoundObject(26, 1);
      SetQuake(20);
      break;
    case 0x14:
      for ( i = 0; i <= 3; ++i )
      {
        v2 = Random(-1536, 0);
        v3 = Random(-341, 341);
        v4 = npc->y + 0x2000;
        v5 = npc->x;
        v6 = Random(-12, 12);
        SetNpChar(4, v5 + (v6 << 9), v4, v3, v2, 0, 0, 256);
      }
      npc->act_no = 1;
      break;
    default:
      break;
  }
  if ( ++npc->ani_wait > 10 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 3 )
    npc->ani_no = 0;
  npc->rect = *(RECT *)(&(&v9)[4 * npc->ani_no - 1] - 1);
}

//----- (0804C1C7) --------------------------------------------------------
void __cdecl ActNpc185(NPCHAR_0 *npc)
{
  int v1;

  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->y += 4096;
      break;
    case 0xA:
      npc->act_no = 11;
      npc->ani_no = 1;
      npc->act_wait = 0;
      npc->bits |= 8u;
      goto LABEL_4;
    case 0xB:
LABEL_4:
      v1 = npc->direct;
      if ( v1 == 1 )
      {
        npc->y -= 128;
      }
      else if ( v1 > 1 )
      {
        if ( v1 == 2 )
        {
          npc->x += 128;
        }
        else if ( v1 == 3 )
        {
          npc->y += 128;
        }
      }
      else if ( !v1 )
      {
        npc->x -= 128;
      }
      ++npc->act_wait;
      break;
    case 0x14:
      npc->y -= 12288;
      npc->act_no = 1;
      break;
    default:
      break;
  }
  npc->rect.left = 96;
  npc->rect.top = 64;
  npc->rect.right = 112;
  npc->rect.bottom = 96;
}

//----- (0804C307) --------------------------------------------------------
void __cdecl ActNpc186(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  RECT *v3;
  RECT rc[4];

  rc[0].left = 48;
  rc[0].top = 48;
  rc[0].right = 64;
  rc[0].bottom = 64;
  rc[1].left = 64;
  rc[1].top = 48;
  rc[1].right = 80;
  rc[1].bottom = 64;
  rc[2].left = 80;
  rc[2].top = 48;
  rc[2].right = 96;
  rc[2].bottom = 64;
  rc[3].left = 64;
  rc[3].top = 48;
  rc[3].right = 80;
  rc[3].bottom = 64;
  v1 = npc->act_no;
  if ( v1 != 1 )
  {
    if ( v1 > 1 )
    {
      if ( v1 == 10 )
      {
        npc->act_no = 11;
        npc->ani_no = 1;
        npc->act_wait = 0;
        npc->bits |= 8u;
      }
      else if ( v1 != 11 )
      {
        goto LABEL_22;
      }
      v2 = npc->direct;
      if ( v2 == 1 )
      {
        npc->y -= 128;
      }
      else if ( v2 > 1 )
      {
        if ( v2 == 2 )
        {
          npc->x += 128;
        }
        else if ( v2 == 3 )
        {
          npc->y += 128;
        }
      }
      else if ( !v2 )
      {
        npc->x -= 128;
      }
      ++npc->act_wait;
    }
    else if ( !v1 )
    {
      npc->act_no = 1;
    }
  }
LABEL_22:
  if ( ++npc->ani_wait > 10 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 3 )
    npc->ani_no = 0;
  v3 = &rc[npc->ani_no];
  npc->rect.left = v3->left;
  npc->rect.top = v3->top;
  npc->rect.right = v3->right;
  npc->rect.bottom = v3->bottom;
}

//----- (0804C4D9) --------------------------------------------------------
void __cdecl ActNpc187(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rect_right[2];
  RECT rect_left[2];
  int i;
  RECT *v7;

  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_7:
    if ( ++npc->act_wait > 49 )
    {
      npc->act_wait = 0;
      npc->act_no = 2;
      npc->ym = 768;
    }
    goto LABEL_20;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_20;
    npc->act_no = 1;
    npc->tgt_x = npc->x;
    npc->tgt_y = npc->y;
    npc->count1 = 120;
    npc->act_wait = Random(0, 50);
    for ( i = 0; i <= 4; ++i )
      SetNpChar(188, 0, 0, 0, 0, 51 * i, npc, 256);
    goto LABEL_7;
  }
  npc->count1 += 4;
  if ( x >= npc->x )
    npc->direct = 2;
  else
    npc->direct = 0;
  if ( npc->tgt_y < npc->y )
    npc->ym -= 16;
  if ( npc->tgt_y > npc->y )
    npc->ym += 16;
  if ( npc->ym > 853 )
    npc->ym = 853;
  if ( npc->ym < -853 )
    npc->ym = -853;
LABEL_20:
  npc->x += npc->xm;
  npc->y += npc->ym;
  rect_left[0].left = 224;
  rect_left[0].top = 104;
  rect_left[0].right = 256;
  rect_left[0].bottom = 136;
  rect_left[1].left = 256;
  rect_left[1].top = 104;
  rect_left[1].right = 288;
  rect_left[1].bottom = 136;
  rect_right[0].left = 224;
  rect_right[0].top = 136;
  rect_right[0].right = 256;
  rect_right[0].bottom = 168;
  rect_right[1].left = 256;
  rect_right[1].top = 136;
  rect_right[1].right = 288;
  rect_right[1].bottom = 168;
  if ( ++npc->ani_wait > 2 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 1 )
    npc->ani_no = 0;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)(&(&v7)[4 * npc->ani_no - 1] - 1);
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)(&v7 + 4 * npc->ani_no - 9);
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}

//----- (0804C7CD) --------------------------------------------------------
void __cdecl ActNpc188(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  NPCHAR_0 *v6;
  RECT *v7;
  RECT rect_right[2];
  RECT rect_left[2];
  unsigned __int8 deg;
  RECT *v11;

  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    if ( npc->pNpc->code_char != 187 || (npc->pNpc->cond & 0x80u) == 0 )
    {
      npc->xm = Random(-512, 512);
      npc->ym = Random(-512, 512);
      npc->act_no = 10;
    }
    else
    {
      deg = LOBYTE(npc->count1) + LOBYTE(npc->pNpc->count1);
      v2 = npc->pNpc->x;
      npc->x = v2 + 20 * GetSin(deg);
      v3 = npc->pNpc->y;
      npc->y = v3 + 32 * GetCos(deg);
    }
    goto LABEL_24;
  }
  if ( v1 != 10 )
  {
    if ( v1 )
      goto LABEL_24;
    npc->act_no = 1;
    npc->count1 = npc->direct;
    goto LABEL_5;
  }
  if ( x >= npc->x )
    v4 = npc->xm + 32;
  else
    v4 = npc->xm - 32;
  npc->xm = v4;
  if ( y >= npc->y )
    v5 = npc->ym + 32;
  else
    v5 = npc->ym - 32;
  npc->ym = v5;
  if ( npc->xm > 2048 )
    npc->xm = 2048;
  if ( npc->xm < -2048 )
    npc->xm = -2048;
  if ( npc->ym > 512 )
    npc->ym = 512;
  if ( npc->ym < -512 )
    npc->ym = -512;
  npc->x += npc->xm;
  npc->y += npc->ym;
LABEL_24:
  if ( x >= npc->x )
    npc->direct = 2;
  else
    npc->direct = 0;
  if ( ++npc->ani_wait > 2 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 1 )
    npc->ani_no = 0;
  rect_left[0].left = 288;
  rect_left[0].top = 104;
  rect_left[0].right = 304;
  rect_left[0].bottom = 120;
  rect_left[1].left = 304;
  rect_left[1].top = 104;
  rect_left[1].right = 320;
  rect_left[1].bottom = 120;
  rect_right[0].left = 288;
  rect_right[0].top = 120;
  rect_right[0].right = 304;
  rect_right[0].bottom = 136;
  rect_right[1].left = 304;
  rect_right[1].top = 120;
  rect_right[1].right = 320;
  rect_right[1].bottom = 136;
  if ( npc->direct )
  {
    v6 = npc;
    v7 = (RECT *)(&(&v11)[4 * npc->ani_no - 1] - 1);
  }
  else
  {
    v6 = npc;
    v7 = (RECT *)(&v11 + 4 * npc->ani_no - 9);
  }
  npc->rect.left = v7->left;
  v6->rect.top = v7->top;
  v6->rect.right = v7->right;
  v6->rect.bottom = v7->bottom;
}

//----- (0804CB24) --------------------------------------------------------
void __cdecl ActNpc189(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  RECT *v4;
  RECT rect[3];

  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    npc->y += npc->ym;
    if ( ++npc->act_wait > 256 )
      npc->act_no = 10;
    goto LABEL_22;
  }
  if ( v1 != 10 )
  {
    if ( v1 )
      goto LABEL_22;
    npc->act_no = 1;
    npc->xm = -64;
    goto LABEL_5;
  }
  if ( x >= npc->x )
    v2 = npc->xm + 8;
  else
    v2 = npc->xm - 8;
  npc->xm = v2;
  if ( y >= npc->y )
    v3 = npc->ym + 8;
  else
    v3 = npc->ym - 8;
  npc->ym = v3;
  if ( npc->xm > 1024 )
    npc->xm = 1024;
  if ( npc->xm < -1024 )
    npc->xm = -1024;
  if ( npc->ym > 1024 )
    npc->ym = 1024;
  if ( npc->ym < -1024 )
    npc->ym = -1024;
  npc->x += npc->xm;
  npc->y += npc->ym;
LABEL_22:
  if ( x >= npc->x )
    npc->direct = 2;
  else
    npc->direct = 0;
  if ( ++npc->ani_wait > 2 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 2 )
    npc->ani_no = 0;
  rect[0].left = 224;
  rect[0].top = 184;
  rect[0].right = 232;
  rect[0].bottom = 200;
  rect[1].left = 232;
  rect[1].top = 184;
  rect[1].right = 240;
  rect[1].bottom = 200;
  rect[2].left = 240;
  rect[2].top = 184;
  rect[2].right = 248;
  rect[2].bottom = 200;
  v4 = &rect[npc->ani_no];
  npc->rect.left = v4->left;
  npc->rect.top = v4->top;
  npc->rect.right = v4->right;
  npc->rect.bottom = v4->bottom;
}

//----- (0804CD6E) --------------------------------------------------------
void __cdecl ActNpc190(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  RECT rect[2];
  int i;
  RECT *v8;

  rect[0].left = 192;
  rect[0].top = 32;
  rect[0].right = 208;
  rect[0].bottom = 48;
  rect[1].left = 208;
  rect[1].top = 32;
  rect[1].right = 224;
  rect[1].bottom = 48;
  v1 = npc->act_no;
  switch ( v1 )
  {
    case 10:
      PlaySoundObject(72, 1);
      for ( i = 0; i <= 7; ++i )
      {
        v2 = Random(-3, 3) << 9;
        v3 = Random(-8, -2) << 9;
        v4 = npc->y;
        v5 = Random(-8, 8);
        SetNpChar(4, npc->x, v4 + (v5 << 9), v3, v2, 0, 0, 256);
      }
      npc->cond = 0;
      break;
    case 20:
      if ( ++npc->ani_wait > 10 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 1 )
        npc->ani_no = 0;
      break;
    case 0:
      npc->ani_no = 0;
      break;
  }
  npc->rect = *(RECT *)(&v8 + 4 * npc->ani_no - 9);
}

//----- (0804CF1D) --------------------------------------------------------
void __cdecl ActNpc191(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;

  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 10;
      npc->tgt_y = npc->y;
      npc->ym = 512;
      goto LABEL_3;
    case 0xA:
LABEL_3:
      if ( npc->y >= npc->tgt_y )
        v1 = npc->ym - 4;
      else
        v1 = npc->ym + 4;
      npc->ym = v1;
      if ( npc->ym < -256 )
        npc->ym = -256;
      if ( npc->ym > 256 )
        npc->ym = 256;
      npc->y += npc->ym;
      break;
    case 0x14:
      npc->act_no = 21;
      npc->act_wait = 0;
      goto LABEL_12;
    case 0x15:
LABEL_12:
      if ( npc->y >= npc->tgt_y )
        v2 = npc->ym - 4;
      else
        v2 = npc->ym + 4;
      npc->ym = v2;
      if ( npc->ym < -512 )
        npc->ym = -512;
      if ( npc->ym > 512 )
        npc->ym = 512;
      npc->y += npc->ym;
      if ( ++npc->act_wait > 1000 )
        npc->act_no = 22;
      break;
    case 0x16:
      if ( npc->y >= 0 )
        v3 = npc->ym - 4;
      else
        v3 = npc->ym + 4;
      npc->ym = v3;
      if ( npc->ym < -512 )
        npc->ym = -512;
      if ( npc->ym > 512 )
        npc->ym = 512;
      npc->y += npc->ym;
      if ( npc->y <= 0x7FFF || gSuperYpos )
      {
        npc->act_no = 21;
        npc->act_wait = 0;
      }
      break;
    case 0x1E:
      if ( npc->y >= 0 )
        v4 = npc->ym - 4;
      else
        v4 = npc->ym + 4;
      npc->ym = v4;
      if ( npc->ym < -512 )
        npc->ym = -512;
      if ( npc->ym > 256 )
        npc->ym = 256;
      npc->y += npc->ym;
      break;
    default:
      break;
  }
  gWaterY = npc->y;
  npc->rect.right = 0;
  npc->rect.bottom = 0;
}

//----- (0804D1B3) --------------------------------------------------------
void __cdecl ActNpc192(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  NPCHAR_0 *v4;
  RECT *v5;
  RECT rcRight[2];
  RECT rcLeft[2];
  RECT *v8;

  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->view.back = 0x2000;
      npc->view.front = 0x2000;
      npc->view.top = 4096;
      npc->view.bottom = 4096;
      break;
    case 0xA:
      npc->act_no = 11;
      npc->ani_no = 1;
      npc->view.top = 0x2000;
      npc->view.bottom = 0x2000;
      npc->y -= 2560;
      break;
    case 0x14:
      npc->act_no = 21;
      npc->act_wait = 1;
      npc->tgt_x = npc->x;
      npc->tgt_y = npc->y;
      goto LABEL_5;
    case 0x15:
LABEL_5:
      v1 = npc->tgt_x;
      npc->x = v1 + (Random(-1, 1) << 9);
      v2 = npc->tgt_y;
      npc->y = v2 + (Random(-1, 1) << 9);
      if ( ++npc->act_wait > 30 )
        npc->act_no = 30;
      break;
    case 0x1E:
      npc->act_no = 31;
      npc->act_wait = 1;
      npc->xm = -2048;
      npc->x = npc->tgt_x;
      npc->y = npc->tgt_y;
      PlaySoundObject(44, 1);
      goto LABEL_8;
    case 0x1F:
LABEL_8:
      npc->xm += 32;
      npc->x += npc->xm;
      ++npc->act_wait;
      v3 = npc->tgt_y;
      npc->y = v3 + (Random(-1, 1) << 9);
      if ( npc->act_wait > 10 )
        npc->direct = 2;
      if ( npc->act_wait > 200 )
        npc->act_no = 40;
      break;
    case 0x28:
      npc->act_no = 41;
      npc->act_wait = 2;
      npc->direct = 0;
      npc->y -= 24576;
      npc->xm = -4096;
      goto LABEL_13;
    case 0x29:
LABEL_13:
      npc->x += npc->xm;
      npc->y += npc->ym;
      npc->act_wait += 2;
      if ( npc->act_wait > 1200 )
        npc->cond = 0;
      break;
    default:
      break;
  }
  if ( !(npc->act_wait & 3) && npc->act_no > 19 )
  {
    PlaySoundObject(34, 1);
    if ( npc->direct )
      SetCaret(npc->x - 5120, npc->y + 5120, 7, 0);
    else
      SetCaret(npc->x + 5120, npc->y + 5120, 7, 2);
  }
  rcLeft[0].left = 224;
  rcLeft[0].top = 64;
  rcLeft[0].right = 256;
  rcLeft[0].bottom = 80;
  rcLeft[1].left = 256;
  rcLeft[1].top = 64;
  rcLeft[1].right = 288;
  rcLeft[1].bottom = 96;
  rcRight[0].left = 224;
  rcRight[0].top = 80;
  rcRight[0].right = 256;
  rcRight[0].bottom = 96;
  rcRight[1].left = 288;
  rcRight[1].top = 64;
  rcRight[1].right = 320;
  rcRight[1].bottom = 96;
  if ( npc->direct )
  {
    v4 = npc;
    v5 = (RECT *)&(&v8)[4 * npc->ani_no - 1];
  }
  else
  {
    v4 = npc;
    v5 = (RECT *)(&v8 + 4 * npc->ani_no - 8);
  }
  npc->rect.left = v5->left;
  v4->rect.top = v5->top;
  v4->rect.right = v5->right;
  v4->rect.bottom = v5->bottom;
}

//----- (0804D5E0) --------------------------------------------------------
void __cdecl ActNpc193(NPCHAR_0 *npc)
{
  if ( !npc->act_no )
  {
    npc->act_no = 1;
    npc->y = npc->y;
    npc->x += 12288;
  }
  npc->rect.left = 256;
  npc->rect.top = 96;
  npc->rect.right = 320;
  npc->rect.bottom = 112;
}

//----- (0804D651) --------------------------------------------------------
void __cdecl ActNpc194(NPCHAR_0 *npc)
{
  if ( !npc->act_no )
  {
    npc->act_no = 1;
    npc->y += 2048;
  }
  npc->rect.left = 192;
  npc->rect.top = 120;
  npc->rect.right = 224;
  npc->rect.bottom = 128;
}

//----- (0804D6B6) --------------------------------------------------------
void __cdecl ActNpc195(NPCHAR_0 *npc)
{
  npc->rect.left = 112;
  npc->rect.top = 64;
  npc->rect.right = 128;
  npc->rect.bottom = 80;
}

//----- (0804D6F5) --------------------------------------------------------
void __cdecl ActNpc196(NPCHAR_0 *npc)
{
  npc->x -= 3072;
  if ( npc->x <= 155648 )
    npc->x += 180224;
  if ( npc->direct )
  {
    npc->rect.left = 112;
    npc->rect.top = 80;
    npc->rect.right = 144;
    npc->rect.bottom = 96;
  }
  else
  {
    npc->rect.left = 112;
    npc->rect.top = 64;
    npc->rect.right = 144;
    npc->rect.bottom = 80;
  }
}

//----- (0804D7A8) --------------------------------------------------------
void __cdecl ActNpc197(NPCHAR_0 *npc)
{
  int v1;
  RECT rc[4];
  RECT *v3;

  rc[0].left = 0;
  rc[0].top = 0;
  rc[0].right = 16;
  rc[0].bottom = 16;
  rc[1].left = 16;
  rc[1].top = 0;
  rc[1].right = 32;
  rc[1].bottom = 16;
  rc[2].left = 32;
  rc[2].top = 0;
  rc[2].right = 48;
  rc[2].bottom = 16;
  rc[3].left = 48;
  rc[3].top = 0;
  rc[3].right = 64;
  rc[3].bottom = 16;
  v1 = npc->act_no;
  if ( v1 == 10 )
  {
LABEL_5:
    if ( ++npc->ani_wait > 2 )
    {
      npc->ani_wait = 0;
      ++npc->ani_no;
    }
    if ( npc->ani_no > 1 )
      npc->ani_no = 0;
    if ( npc->xm < 0 )
    {
      npc->damage = 3;
      npc->act_no = 20;
    }
    goto LABEL_17;
  }
  if ( v1 != 20 )
  {
    if ( v1 )
      goto LABEL_17;
    npc->act_no = 10;
    npc->ani_wait = 0;
    npc->ym = Random(-512, 512);
    npc->xm = 2048;
    goto LABEL_5;
  }
  npc->damage = 3;
  if ( ++npc->ani_wait > 0 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 3 )
    npc->ani_no = 2;
  if ( npc->x <= 24575 )
  {
    npc->destroy_voice = 0;
    LoseNpChar(npc, 1);
  }
LABEL_17:
  if ( npc->flag & 2 )
    npc->ym = 512;
  if ( npc->flag & 8 )
    npc->ym = -512;
  npc->xm -= 12;
  npc->x += npc->xm;
  npc->y += npc->ym;
  npc->rect = *(RECT *)&(&v3)[4 * npc->ani_no - 1];
}

//----- (0804D9F8) --------------------------------------------------------
void __cdecl ActNpc198(NPCHAR_0 *npc)
{
  int v1;
  RECT rcRight[3];
  RECT *v3;

  rcRight[0].left = 208;
  rcRight[0].top = 48;
  rcRight[0].right = 224;
  rcRight[0].bottom = 72;
  rcRight[1].left = 224;
  rcRight[1].top = 48;
  rcRight[1].right = 240;
  rcRight[1].bottom = 72;
  rcRight[2].left = 240;
  rcRight[2].top = 48;
  rcRight[2].right = 256;
  rcRight[2].bottom = 72;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 == 1 )
      npc->xm += 32;
  }
  else if ( ++npc->act_wait > 20 )
  {
    npc->act_no = 1;
    npc->xm = 0;
    npc->ym = 0;
    npc->count1 = 0;
  }
  if ( ++npc->ani_wait > 0 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 2 )
    npc->ani_no = 0;
  npc->x += npc->xm;
  npc->y += npc->ym;
  npc->rect = (RECT)*((_OWORD *)&v3 + npc->ani_no - 3);
  if ( ++npc->count1 > 100 )
    npc->cond = 0;
  if ( npc->count1 % 4 == 1 )
    PlaySoundObject(46, 1);
}
/* Orphan comments:
TODO: More WTF
*/

//----- (0804DBA4) --------------------------------------------------------
void __cdecl ActNpc199(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  RECT rect[5];
  RECT *v5;

  qmemcpy(rect, &ActNpc199(NPCHAR *)::C.16, sizeof(rect));
  if ( !npc->act_no )
  {
    npc->act_no = 1;
    npc->ani_no = Random(0, 2);
    v1 = npc->direct;
    if ( v1 == 1 )
    {
      npc->ym = -1;
    }
    else if ( v1 > 1 )
    {
      if ( v1 == 2 )
      {
        npc->xm = 1;
      }
      else if ( v1 == 3 )
      {
        npc->ym = 1;
      }
    }
    else if ( !v1 )
    {
      npc->xm = -1;
    }
    v2 = npc->xm;
    npc->xm = (Random(4, 8) << 9) / 2 * v2;
    v3 = npc->ym;
    npc->ym = (Random(4, 8) << 9) / 2 * v3;
  }
  if ( ++npc->ani_wait > 6 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 4 )
    npc->cond = 0;
  npc->x += npc->xm;
  npc->y += npc->ym;
  npc->rect = (RECT)*((_OWORD *)&v5 + npc->ani_no - 5);
}

//----- (0804DD48) --------------------------------------------------------
void __cdecl RGB(SDL_Color_0 *retstr, Uint8 r, Uint8 g, Uint8 b)
{
  *retstr = 0;                                  // TODO: Dumb memset
  retstr->unused = -1;
  retstr->r = r;
  retstr->g = g;
  retstr->b = b;
}

//----- (0804DD8A) --------------------------------------------------------
void ActionStripper()
{
  int s;

  for ( s = 0; s <= 15; ++s )
  {
    if ( Strip[s].flag & 0x80 && Credit.mode )
      Strip[s].y -= 256;
    if ( Strip[s].y < -8191 )
      Strip[s].flag = 0;
  }
}

//----- (0804DE33) --------------------------------------------------------
void PutStripper()
{
  RECT rc;
  int s;

  for ( s = 0; s <= 15; ++s )
  {
    if ( Strip[s].flag & 0x80 )
    {
      rc.left = 0;
      rc.right = 320;
      rc.top = 16 * s;
      rc.bottom = 16 * s + 16;
      PutBitmap3(&grcFull, Strip[s].x / 512, Strip[s].y / 512, &rc, 35);
      rc.left = 24 * (Strip[s].cast % 13);
      rc.right = rc.left + 24;
      rc.top = 24 * (Strip[s].cast / 13);
      rc.bottom = rc.top + 24;
      PutBitmap3(&grcFull, Strip[s].x / 512 - 24, Strip[s].y / 512 - 8, &rc, 37);
    }
  }
}

//----- (0804DFF1) --------------------------------------------------------
void __cdecl SetStripper(int x, int y, char *text, int cast)
{
  RECT rc;
  SDL_Color_0 r;
  int s;

  for ( s = 0; s <= 15 && Strip[s].flag & 0x80; ++s )
    ;
  if ( s != 16 )
  {
    Strip[s].flag = 128;
    Strip[s].x = x;
    Strip[s].y = y;
    Strip[s].cast = cast;
    strcpy((char *)Strip + 16 * (5 * s + 1), text);
    rc.left = 0;
    rc.right = 320;
    rc.top = 16 * s;
    rc.bottom = 16 * s + 16;
    CortBox2(&rc, 0, 35);
    RGB(&r, 0xFFu, 0xFFu, 0xFEu);
    PutText2(0, rc.top, text, &r, 35);
  }
}

//----- (0804E14B) --------------------------------------------------------
void RestoreStripper()
{
  RECT rc;
  SDL_Color_0 r;
  int s;

  for ( s = 0; s <= 15; ++s )
  {
    if ( Strip[s].flag & 0x80 )
    {
      rc.left = 0;
      rc.right = 320;
      rc.top = 16 * s;
      rc.bottom = 16 * s + 16;
      CortBox2(&rc, 0, 35);
      RGB(&r, 0xFFu, 0xFFu, 0xFEu);
      PutText2(0, rc.top, (const char *)Strip + 16 * (5 * s + 1), &r, 35);// TODO: Actually Strip[s].str
    }
  }
}

//----- (0804E22F) --------------------------------------------------------
void ActionIllust()
{
  switch ( Illust.act_no )
  {
    case 1:
      Illust.x += 20480;
      if ( Illust.x > 0 )
        Illust.x = 0;
      break;
    case 2:
      Illust.x -= 20480;
      if ( Illust.x < -81920 )
        Illust.x = -81920;
      break;
    case 0:
      Illust.x = -81920;
      break;
  }
}

//----- (0804E29F) --------------------------------------------------------
void PutIllust()
{
  RECT rcIllust;

  rcIllust.left = 0;
  rcIllust.top = 0;
  rcIllust.right = 160;
  rcIllust.bottom = 240;
  PutBitmap3(&grcFull, Illust.x / 512, 0, &rcIllust, 36);
}

//----- (0804E2FD) --------------------------------------------------------
void __cdecl ReloadIllust(int a)
{
  char name[16];

  sprintf(name, "Credit%02ld", a);
  ReloadBitmap_Resource(name, 36);
}

//----- (0804E332) --------------------------------------------------------
void InitCreditScript()
{
  memset(&Credit, 0, 0x18u);
  memset(Strip, 0, 0x500u);
}

//----- (0804E372) --------------------------------------------------------
void ReleaseCreditScript()
{
  if ( Credit.pData )
  {
    free(Credit.pData);
    Credit.pData = 0;
  }
}

//----- (0804E39A) --------------------------------------------------------
signed int StartCreditScript()
{
  signed int result;
  char path[260];
  SDL_RWops_0 *fp;

  if ( Credit.pData )
  {
    free(Credit.pData);
    Credit.pData = 0;
  }
  sprintf(path, "%s/%s", gDataPath, _credit_script);
  Credit.size = GetFileSizeLong(path);
  if ( Credit.size == -1 )
    return 0;
  Credit.pData = (char *)malloc(Credit.size);
  if ( !Credit.pData )
    return 0;
  fp = SDL_RWFromFile(path, "rb");
  if ( fp )
  {
    fp->read(fp, Credit.pData, 1, Credit.size);
    EncryptionBinaryData2((unsigned __int8 *)Credit.pData, Credit.size);
    Credit.offset = 0;
    Credit.wait = 0;
    Credit.mode = 1;
    Illust.x = -81920;
    Illust.act_no = 0;
    grcGame.left = 160;
    if ( !ReloadBitmap_File("casts", 37) )
    {
      result = 0;
    }
    else
    {
      memset(Strip, 0, 0x500u);
      result = 1;
    }
  }
  else
  {
    free(Credit.pData);
    fprintf(stderr, "Couldn't load %s!", path);
    result = 0;
  }
  return result;
}

//----- (0804E54C) --------------------------------------------------------
int __cdecl _GetScriptNumber(char *text)
{
  return 1000 * *text - 48000 + 100 * text[1] - 4800 + 10 * text[2] - 480 + text[3] - 48;
}

//----- (0804E5AC) --------------------------------------------------------
void _ActionCredit_Read()
{
  signed int v0;
  char text[40];
  int a;
  int b;
  int len;

  while ( Credit.offset < Credit.size )
  {
    v0 = Credit.pData[Credit.offset];
    if ( v0 == 91 )
    {
      a = ++Credit.offset;
      while ( Credit.pData[a] != 93 )
      {
        if ( IsShiftJIS(Credit.pData[a]) )
          a += 2;
        else
          ++a;
      }
      len = a - Credit.offset;
      memcpy(text, &Credit.pData[Credit.offset], a - Credit.offset);
      text[len] = 0;
      Credit.offset = a + 1;
      len = _GetScriptNumber(&Credit.pData[a + 1]);
      SetStripper(Credit.start_x, 126976, text, len);
      Credit.offset += 4;
      return;
    }
    if ( v0 > 91 )
    {
      switch ( v0 )
      {
        case 106:
          b = _GetScriptNumber(&Credit.pData[++Credit.offset]);
          Credit.offset += 4;
          while ( Credit.offset < Credit.size )
          {
            if ( Credit.pData[Credit.offset] == 108 )
            {
              a = _GetScriptNumber(&Credit.pData[++Credit.offset]);
              Credit.offset += 4;
              if ( b == a )
                return;
            }
            else if ( IsShiftJIS(Credit.pData[Credit.offset]) )
            {
              Credit.offset += 2;
            }
            else
            {
              ++Credit.offset;
            }
          }
          return;
        case 126:
          ++Credit.offset;
          SetOrganyaFadeout();
          return;
        case 102:
          a = _GetScriptNumber(&Credit.pData[++Credit.offset]);
          Credit.offset += 5;
          b = _GetScriptNumber(&Credit.pData[Credit.offset]);
          Credit.offset += 4;
          if ( (unsigned __int8)GetNPCFlag(a) )
          {
            while ( Credit.offset < Credit.size )
            {
              if ( Credit.pData[Credit.offset] == 108 )
              {
                a = _GetScriptNumber(&Credit.pData[++Credit.offset]);
                Credit.offset += 4;
                if ( b == a )
                  return;
              }
              else if ( IsShiftJIS(Credit.pData[Credit.offset]) )
              {
                Credit.offset += 2;
              }
              else
              {
                ++Credit.offset;
              }
            }
          }
          return;
      }
    }
    else
    {
      if ( v0 == 43 )
      {
        Credit.start_x = _GetScriptNumber(&Credit.pData[++Credit.offset]) << 9;
        Credit.offset += 4;
        return;
      }
      if ( v0 > 43 )
      {
        if ( v0 == 45 )
        {
          Credit.wait = _GetScriptNumber(&Credit.pData[++Credit.offset]);
          Credit.offset += 4;
          Credit.mode = 2;
          return;
        }
        if ( v0 == 47 )
        {
          Credit.mode = 0;
          return;
        }
      }
      else if ( v0 == 33 )
      {
        a = _GetScriptNumber(&Credit.pData[++Credit.offset]);
        Credit.offset += 4;
        ChangeMusic(a);
        return;
      }
    }
    ++Credit.offset;
  }
}

//----- (0804EA37) --------------------------------------------------------
void ActionCredit()
{
  if ( Credit.offset < Credit.size )
  {
    if ( Credit.mode == 1 )
    {
      _ActionCredit_Read();
    }
    else if ( Credit.mode == 2 && --Credit.wait <= 0 )
    {
      Credit.mode = 1;
    }
  }
}

//----- (0804EA8B) --------------------------------------------------------
void __cdecl SetCreditIllust(int a)
{
  ReloadIllust(a);
  Illust.act_no = 1;
}

//----- (0804EAA8) --------------------------------------------------------
void CutCreditIllust()
{
  Illust.act_no = 2;
}

//----- (0804EAB7) --------------------------------------------------------
signed int __cdecl Scene_DownIsland(SDL_Surface_0 *screen, int mode)
{
  signed int v2;
  RECT rc_sprite;
  RECT rc_ground;
  RECT rc_sky;
  RECT rc_frame;
  $0FBB943D0F44CD4E1A64E57ECDAAF024 sprite;
  int wait;

  rc_frame.left = 80;
  rc_frame.top = 80;
  rc_frame.right = 240;
  rc_frame.bottom = 160;
  rc_sky.left = 0;
  rc_sky.top = 0;
  rc_sky.right = 160;
  rc_sky.bottom = 80;
  rc_ground.left = 160;
  rc_ground.top = 48;
  rc_ground.right = 320;
  rc_ground.bottom = 80;
  rc_sprite.left = 160;
  rc_sprite.top = 0;
  rc_sprite.right = 200;
  rc_sprite.bottom = 24;
  sprite.x = 86016;
  sprite.y = 0x8000;
  for ( wait = 0; wait <= 899; ++wait )
  {
    GetTrg();
    if ( gKey & 0x8000 )
    {
      v2 = Call_Escape(screen);
      if ( !v2 )
        return 0;
      if ( v2 == 2 )
        return 2;
    }
    if ( mode )
    {
      if ( mode == 1 )
      {
        if ( wait > 349 )
        {
          if ( wait > 499 )
          {
            if ( wait > 599 )
            {
              if ( wait == 750 )
                wait = 900;
            }
            else
            {
              sprite.y += 12;
            }
          }
          else
          {
            sprite.y += 25;
          }
        }
        else
        {
          sprite.y += 51;
        }
      }
    }
    else
    {
      sprite.y += 51;
    }
    CortBox(&grcFull, 0);
    PutBitmap3(&rc_frame, 80, 80, &rc_sky, 21);
    PutBitmap3(&rc_frame, sprite.x / 512 - 20, sprite.y / 512 - 12, &rc_sprite, 21);
    PutBitmap3(&rc_frame, 80, 128, &rc_ground, 21);
    PutTimeCounter(16, 8);
    PutFramePerSecound();
    if ( !Flip_SystemTask(screen) )
      return 0;
  }
  return 1;
}

//----- (0804ECEC) --------------------------------------------------------
char *__cdecl get_resource(const char *name, int *size)
{
  char *result;

  *size = 0;
  if ( !strcmp(name, "Credit01") )
  {
    *size = size_Credit01;
    result = (char *)Credit01;
  }
  else if ( !strcmp(name, "Credit02") )
  {
    *size = size_Credit02;
    result = (char *)Credit02;
  }
  else if ( !strcmp(name, "Credit03") )
  {
    *size = size_Credit03;
    result = (char *)Credit03;
  }
  else if ( !strcmp(name, "Credit04") )
  {
    *size = size_Credit04;
    result = (char *)Credit04;
  }
  else if ( !strcmp(name, "Credit05") )
  {
    *size = size_Credit05;
    result = (char *)Credit05;
  }
  else if ( !strcmp(name, "Credit06") )
  {
    *size = size_Credit06;
    result = (char *)Credit06;
  }
  else if ( !strcmp(name, "Credit07") )
  {
    *size = size_Credit07;
    result = (char *)Credit07;
  }
  else if ( !strcmp(name, "Credit08") )
  {
    *size = size_Credit08;
    result = (char *)Credit08;
  }
  else if ( !strcmp(name, "Credit09") )
  {
    *size = size_Credit09;
    result = (char *)Credit09;
  }
  else if ( !strcmp(name, "Credit10") )
  {
    *size = size_Credit10;
    result = (char *)Credit10;
  }
  else if ( !strcmp(name, "Credit11") )
  {
    *size = size_Credit11;
    result = (char *)Credit11;
  }
  else if ( !strcmp(name, "Credit12") )
  {
    *size = size_Credit12;
    result = (char *)Credit12;
  }
  else if ( !strcmp(name, "Credit14") )
  {
    *size = size_Credit14;
    result = (char *)Credit14;
  }
  else if ( !strcmp(name, "Credit15") )
  {
    *size = size_Credit15;
    result = (char *)Credit15;
  }
  else if ( !strcmp(name, "Credit16") )
  {
    *size = size_Credit16;
    result = (char *)Credit16;
  }
  else if ( !strcmp(name, "Credit17") )
  {
    *size = size_Credit17;
    result = (char *)Credit17;
  }
  else if ( !strcmp(name, "Credit18") )
  {
    *size = size_Credit18;
    result = (char *)Credit18;
  }
  else if ( !strcmp(name, "font_en_1") )
  {
    *size = size_font_en_1;
    result = (char *)font_en_1;
  }
  else if ( !strcmp(name, "font_en_2") )
  {
    *size = size_font_en_2;
    result = (char *)font_en_2;
  }
  else if ( !strcmp(name, "pixel") )
  {
    *size = size_pixel;
    result = (char *)pixel;
  }
  else if ( !strcmp(name, "Access") )
  {
    *size = 1138;
    result = Access;
  }
  else if ( !strcmp(name, "Anzen") )
  {
    *size = 9194;
    result = Anzen;
  }
  else if ( !strcmp(name, "Balcony") )
  {
    *size = 3082;
    result = Balcony;
  }
  else if ( !strcmp(name, "Ballos") )
  {
    *size = 3570;
    result = Ballos;
  }
  else if ( !strcmp(name, "BreakDown") )
  {
    *size = 2570;
    result = BreakDown;
  }
  else if ( !strcmp(name, "Cemetery") )
  {
    *size = 4578;
    result = Cemetery;
  }
  else if ( !strcmp(name, "Curly") )
  {
    *size = 25738;
    result = Curly;
  }
  else if ( !strcmp(name, "Dr") )
  {
    *size = 2162;
    result = Dr;
  }
  else if ( !strcmp(name, "Ending") )
  {
    *size = 17898;
    result = Ending;
  }
  else if ( !strcmp(name, "Escape") )
  {
    *size = 7618;
    result = Escape;
  }
  else if ( !strcmp(name, "Fanfale1") )
  {
    *size = 914;
    result = Fanfale1;
  }
  else if ( !strcmp(name, "Fanfale2") )
  {
    *size = 922;
    result = Fanfale2;
  }
  else if ( !strcmp(name, "Fanfale3") )
  {
    *size = 1074;
    result = Fanfale3;
  }
  else if ( !strcmp(name, "FireEye") )
  {
    *size = 21354;
    result = FireEye;
  }
  else if ( !strcmp(name, "Gameover") )
  {
    *size = 1138;
    result = Gameover;
  }
  else if ( !strcmp(name, "Ginsuke") )
  {
    *size = 5970;
    result = Ginsuke;
  }
  else if ( !strcmp(name, "Grand") )
  {
    *size = 13466;
    result = Grand;
  }
  else if ( !strcmp(name, "Gravity") )
  {
    *size = 20578;
    result = Gravity;
  }
  else if ( !strcmp(name, "Hell") )
  {
    *size = 18386;
    result = Hell;
  }
  else if ( !strcmp(name, "ironH") )
  {
    *size = 13450;
    result = ironH;
  }
  else if ( !strcmp(name, "Jenka2") )
  {
    *size = 11986;
    result = Jenka2;
  }
  else if ( !strcmp(name, "Jenka") )
  {
    *size = 8306;
    result = Jenka;
  }
  else if ( !strcmp(name, "Kodou") )
  {
    *size = 10418;
    result = Kodou;
  }
  else if ( !strcmp(name, "LastBtl3") )
  {
    *size = 21122;
    result = LastBtl3;
  }
  else if ( !strcmp(name, "LastBtl") )
  {
    *size = 2770;
    result = LastBtl;
  }
  else if ( !strcmp(name, "LastCave") )
  {
    *size = 18122;
    result = LastCave;
  }
  else if ( !strcmp(name, "Marine") )
  {
    *size = 16962;
    result = Marine;
  }
  else if ( !strcmp(name, "Maze") )
  {
    *size = 14786;
    result = Maze;
  }
  else if ( !strcmp(name, "MDown2") )
  {
    *size = 21074;
    result = MDown2;
  }
  else if ( !strcmp(name, "Mura") )
  {
    *size = 10634;
    result = Mura;
  }
  else if ( !strcmp(name, "NewData") )
  {
    *size = 3018;
    result = NewData;
  }
  else if ( !strcmp(name, "Oside") )
  {
    *size = 25634;
    result = Oside;
  }
  else if ( !strcmp(name, "Plant") )
  {
    *size = 11378;
    result = Plant;
  }
  else if ( !strcmp(name, "quiet") )
  {
    *size = 4770;
    result = quiet;
  }
  else if ( !strcmp(name, "Requiem") )
  {
    *size = 9722;
    result = Requiem;
  }
  else if ( !strcmp(name, "Toroko") )
  {
    *size = 18482;
    result = Toroko;
  }
  else if ( !strcmp(name, "Vivi") )
  {
    *size = 10458;
    result = Vivi;
  }
  else if ( !strcmp(name, "Wanpak2") )
  {
    *size = 15994;
    result = Wanpak2;
  }
  else if ( !strcmp(name, "Wanpaku") )
  {
    *size = 19626;
    result = Wanpaku;
  }
  else if ( !strcmp(name, "Weed") )
  {
    *size = 23706;
    result = Weed;
  }
  else if ( !strcmp(name, "White") )
  {
    *size = 23714;
    result = White;
  }
  else if ( !strcmp(name, "XXXX") )
  {
    *size = 114;
    result = XXXX;
  }
  else if ( !strcmp(name, "Zonbie") )
  {
    *size = 5346;
    result = Zonbie;
  }
  else if ( !strcmp(name, "Wave") )
  {
    *size = 25600;
    result = Wave;
  }
  else
  {
    fprintf(stderr, "Unmapped resource %s!\n", name);
    result = 0;
  }
  return result;
}

//----- (0804F7D1) --------------------------------------------------------
SDL_RWops_0 *__cdecl open_resource(const char *name)
{
  SDL_RWops_0 *result;
  int size;
  const void *const mem;

  size = 0;
  mem = get_resource(name, &size);
  if ( mem )
    result = SDL_RWFromConstMem(mem, size);
  else
    result = 0;
  return result;
}

//----- (0804F814) --------------------------------------------------------
void ClearValueView()
{
  memset(gVV, 0, 0x280u);
  gVVIndex = 0;
}

//----- (0804F842) --------------------------------------------------------
void __cdecl SetValueView(int *px, int *py, int value)
{
  RECT rect[20];
  RECT rcMinus;
  RECT rcPlus;
  int fig[4];
  int dig[4];
  int minus;
  int v;
  int index;
  int i;
  int width;
  int sw;

  for ( i = 0;
        i <= 15
     && (!gVV[i].flag || gVV[i].px != px || (gVV[i].value >= 0 || value >= 0) && (gVV[i].value <= 0 || value <= 0));
        ++i )
  {
    ;
  }
  if ( i == 16 )
  {
    index = gVVIndex++;
    if ( gVVIndex == 16 )
      gVVIndex = 0;
    gVV[index].count = 0;
    gVV[index].offset_y = 0;
    gVV[index].value = value;
  }
  else
  {
    index = i;
    gVV[i].count = 32;
    gVV[index].value += value;
    value = gVV[index].value;
  }
  if ( value >= 0 )
  {
    minus = 0;
  }
  else
  {
    value = -value;
    minus = 1;
  }
  v = value;
  if ( value <= 999 )
  {
    if ( value <= 99 )
    {
      if ( value <= 9 )
        width = 16;
      else
        width = 24;
    }
    else
    {
      width = 32;
    }
  }
  else
  {
    width = 40;
  }
  gVV[index].flag = 1;
  gVV[index].px = px;
  gVV[index].py = py;
  gVV[index].rect.left = 40 - width;
  gVV[index].rect.top = 8 * index;
  gVV[index].rect.right = 40;
  gVV[index].rect.bottom = 8 * (index + 1);
  qmemcpy(rect, &SetValueView(long *,long *,long)::C.21, sizeof(rect));// TODO: This shit's weird, yo
  dig[0] = 1;
  dig[1] = 10;
  dig[2] = 100;
  dig[3] = 1000;
  for ( i = 3; i >= 0; --i )                    // TODO: Split these 'i's
  {
    fig[i] = 0;
    while ( dig[i] <= v )
    {
      v -= dig[i];
      ++fig[i];
    }
  }
  sw = 0;
  rcPlus.left = 32;
  rcPlus.top = 48;
  rcPlus.right = 40;
  rcPlus.bottom = 56;
  rcMinus.left = 40;
  rcMinus.top = 48;
  rcMinus.right = 48;
  rcMinus.bottom = 56;
  CortBox2(&gVV[index].rect, 0, 29);
  if ( minus )
    Surface2Surface(gVV[index].rect.left, gVV[index].rect.top, &rcMinus, 29, 26);
  else
    Surface2Surface(gVV[index].rect.left, gVV[index].rect.top, &rcPlus, 29, 26);
  for ( i = 3; i >= 0; --i )
  {
    if ( sw || !i || fig[i] )
    {
      sw = 1;
      if ( minus )
        fig[i] += 10;
      Surface2Surface(8 * (4 - i), gVV[index].rect.top, &rect[fig[i]], 29, 26);
    }
  }
}

//----- (0804FCFE) --------------------------------------------------------
void ActValueView()
{
  int v;

  for ( v = 0; v <= 15; ++v )
  {
    if ( gVV[v].flag )
    {
      if ( ++gVV[v].count <= 31 )
        gVV[v].offset_y -= 256;
      if ( gVV[v].count > 72 )
        ++gVV[v].rect.top;
      if ( gVV[v].count > 80 )
        gVV[v].flag = 0;
    }
  }
}

//----- (0804FE1A) --------------------------------------------------------
void __cdecl PutValueView(int flx, int fly)
{
  __int64 v2;
  int v3;
  __int64 v4;
  int v;

  for ( v = 0; v <= 15; ++v )
  {
    if ( gVV[v].flag )
    {
      v2 = *gVV[v].py;
      v3 = ((signed int)((HIDWORD(v2) >> 23) + v2) >> 9) + gVV[v].offset_y / 512 - 4 - fly / 512;// TODO: Probably broken divisions
      v4 = *gVV[v].px;
      PutBitmap3(
        &grcGame,
        ((signed int)((HIDWORD(v4) >> 23) + v4) >> 9) - (gVV[v].rect.right - gVV[v].rect.left) / 2 - flx / 512,
        v3,
        &gVV[v].rect,
        29);
    }
  }
}

//----- (0804FF78) --------------------------------------------------------
signed int __cdecl Call_Escape(SDL_Surface_0 *screen)
{
  RECT rc;

  rc.left = 0;
  rc.top = 128;
  rc.right = 208;
  rc.bottom = 144;
  do
  {
    GetTrg();
    if ( gKeyTrg & 0x8000 )
    {
      gKeyTrg = 0;
      return 0;
    }
    if ( gKeyTrg & 0x400 )
    {
      gKeyTrg = 0;
      return 1;
    }
    if ( gKeyTrg & 0x800 )
    {
      gKeyTrg = 0;
      return 2;
    }
    CortBox(&grcFull, 0);
    PutBitmap3(&grcFull, 56, 112, &rc, 26);
    PutFramePerSecound();
  }
  while ( Flip_SystemTask(screen) );
  gKeyTrg = 0;
  return 0;
}

//----- (08050070) --------------------------------------------------------
void MoveFrame3()
{
  int v0;
  int v1;
  int v2;
  int v3;
  __int16 map_l;
  __int16 map_w;

  GetMapData(0, &map_w, &map_l);
  gFrame.x += (*gFrame.tgt_x - 81920 - gFrame.x) / gFrame.wait;
  gFrame.y += (*gFrame.tgt_y - 61440 - gFrame.y) / gFrame.wait;
  if ( gFrame.x < -511 )
    gFrame.x = 0;
  if ( gFrame.y < -511 )
    gFrame.y = 0;
  if ( gFrame.x > (map_w - 21) << 13 )
    gFrame.x = (map_w - 21) << 13;
  if ( gFrame.y > (map_l - 16) << 13 )
    gFrame.y = (map_l - 16) << 13;
  if ( gFrame.quake2 )
  {
    v0 = gFrame.x;
    gFrame.x = v0 + (Random(-5, 5) << 9);
    v1 = gFrame.y;
    gFrame.y = v1 + (Random(-3, 3) << 9);
    --gFrame.quake2;
  }
  else if ( gFrame.quake )
  {
    v2 = gFrame.x;
    gFrame.x = v2 + (Random(-1, 1) << 9);
    v3 = gFrame.y;
    gFrame.y = v3 + (Random(-1, 1) << 9);
    --gFrame.quake;
  }
  if ( gFrame.x < -511 )
    gFrame.x = 0;
  if ( gFrame.y < -511 )
    gFrame.y = 0;
}

//----- (0805026B) --------------------------------------------------------
void __cdecl GetFramePosition(int *fx, int *fy)
{
  *fx = gFrame.x;
  *fy = gFrame.y;
}

//----- (08050286) --------------------------------------------------------
void __cdecl SetFramePosition(int fx, int fy)
{
  __int16 map_l;
  __int16 map_w;

  gFrame.quake = 0;
  gFrame.quake2 = 0;
  GetMapData(0, &map_w, &map_l);
  gFrame.x = fx;
  gFrame.y = fy;
  if ( fx < -511 )
    gFrame.x = 0;
  if ( gFrame.y < -511 )
    gFrame.y = 0;
  if ( gFrame.x > (map_w - 21) << 13 )
    gFrame.x = (map_w - 21) << 13;
  if ( gFrame.y > (map_l - 16) << 13 )
    gFrame.y = (map_l - 16) << 13;
}

//----- (08050344) --------------------------------------------------------
void SetFrameMyChar()
{
  __int16 map_l;
  __int16 map_w;
  int mc_y;
  int mc_x;

  GetMyCharPosition(&mc_x, &mc_y);
  GetMapData(0, &map_w, &map_l);
  gFrame.x = mc_x - 81920;
  gFrame.y = mc_y - 61440;
  if ( mc_x - 81920 < -511 )
    gFrame.x = 0;
  if ( gFrame.y < -511 )
    gFrame.y = 0;
  if ( gFrame.x > (map_w - 21) << 13 )
    gFrame.x = (map_w - 21) << 13;
  if ( gFrame.y > (map_l - 16) << 13 )
    gFrame.y = (map_l - 16) << 13;
}

//----- (0805040A) --------------------------------------------------------
void __cdecl SetFrameTargetMyChar(int wait)
{
  gFrame.tgt_x = (_DWORD *)&unk_81C85A4;        // TODO: Figure these out
  gFrame.tgt_y = (_DWORD *)&unk_81C85A8;
  gFrame.wait = wait;
}

//----- (0805042B) --------------------------------------------------------
void __cdecl SetFrameTargetNpChar(int event, int wait)
{
  int i;

  for ( i = 0; i <= 511 && gNPC[i].code_event != event; ++i )
    ;                                           // TODO: Rework this
  if ( i != 512 )
  {
    gFrame.tgt_x = &gNPC[i].x;
    gFrame.tgt_y = &gNPC[i].y;
    gFrame.wait = wait;
  }
}

//----- (080504A5) --------------------------------------------------------
void __cdecl SetFrameTargetBoss(int no, int wait)
{
  gFrame.tgt_x = &gBoss[no].x;
  gFrame.tgt_y = &gBoss[no].y;
  gFrame.wait = wait;
}

//----- (080504DE) --------------------------------------------------------
void __cdecl SetQuake(int time)
{
  gFrame.quake = time;
}

//----- (080504EB) --------------------------------------------------------
void __cdecl SetQuake2(int time)
{
  gFrame.quake2 = time;
}

//----- (080504F8) --------------------------------------------------------
void ResetQuake()
{
  gFrame.quake = 0;
  gFrame.quake2 = 0;
}

//----- (08050514) --------------------------------------------------------
void __cdecl ActNpc340(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  int v8;
  NPCHAR_0 *v9;
  RECT *v10;
  RECT rcRight[11];
  RECT rcLeft[11];
  int i;
  int x;
  RECT *v15;

  v1 = npc->act_no;
  if ( v1 == 221 )
  {
LABEL_108:
    npc->ym = -2048;
    if ( ++npc->act_wait / 2 & 1 )
      npc->ani_no = 8;
    else
      npc->ani_no = 9;
    if ( npc->y <= 24575 )
    {
      npc->y = 24576;
      npc->ym = 0;
      npc->act_no = 222;
      npc->act_wait = 0;
      npc->damage = 3;
      for ( i = 0; i <= 7; ++i )
      {
        v3 = npc->x;
        x = v3 + (Random(-16, 16) << 9);
        SetNpChar(4, x, npc->y - 5120, 0, 0, 0, 0, 256);
      }
      SetNpChar(332, npc->x - 6144, npc->y - 6144, 0, 0, 0, 0, 256);
      SetNpChar(332, npc->x + 6144, npc->y - 6144, 0, 0, 2, 0, 256);
      SetQuake2(10);
      PlaySoundObject(26, 1);
    }
    if ( npc->count1 <= 3 && y > npc->y - 0x2000 && y < npc->y + 0x2000 )
      npc->act_no = 201;
    goto LABEL_217;
  }
  if ( v1 <= 221 )
  {
    if ( v1 == 200 )
    {
      npc->act_no = 201;
      npc->count1 = 0;
      goto LABEL_70;
    }
    if ( v1 <= 200 )
    {
      if ( v1 == 11 )
      {
LABEL_49:
        if ( ++npc->act_wait > 100 )
          npc->act_no = 100;
        goto LABEL_217;
      }
      if ( v1 <= 11 )
      {
        if ( v1 == 1 )
          goto LABEL_217;
        if ( v1 != 10 )
        {
          if ( !v1 )
          {
            npc->act_no = 1;
            npc->cond = -128;
            npc->exp = 1;
            npc->direct = 0;
            npc->y -= 3072;
            npc->damage = 0;
            SetNpChar(341, npc->x, npc->y - 0x2000, 0, 0, 0, npc, 256);
          }
          goto LABEL_217;
        }
        npc->act_no = 11;
        npc->act_wait = 0;
        goto LABEL_49;
      }
      if ( v1 != 110 )
      {
        if ( v1 == 111 )
        {
LABEL_53:
          if ( ++npc->ani_wait > 10 )
          {
            npc->ani_wait = 0;
            ++npc->ani_no;
          }
          if ( npc->ani_no > 2 )
            npc->ani_no = 1;
          ++npc->act_wait;
          if ( npc->life < npc->tgt_x - 50 || npc->act_wait > 150 )
          {
            v2 = npc->count2 % 5;
            if ( v2 >= 0 )
            {
              if ( v2 <= 3 )
              {
                npc->act_no = 200;
              }
              else if ( v2 == 4 )
              {
                npc->act_no = 300;
              }
            }
            ++npc->count2;
          }
          if ( ::x >= npc->x )
            npc->direct = 2;
          else
            npc->direct = 0;
          goto LABEL_217;
        }
        if ( v1 != 100 )
          goto LABEL_217;
        npc->act_no = 110;
        npc->act_wait = 0;
        npc->ani_no = 1;
        npc->ani_wait = 0;
        npc->damage = 4;
        npc->bits |= 0x20u;
      }
      npc->act_no = 111;
      npc->damage = 3;
      npc->tgt_x = npc->life;
      goto LABEL_53;
    }
    if ( v1 == 210 )
    {
      npc->act_no = 211;
      npc->act_wait = 0;
      npc->ani_no = 6;
      npc->ani_wait = 0;
      npc->ym = 0;
      npc->damage = 10;
      if ( ::x >= npc->x )
        npc->direct = 2;
      else
        npc->direct = 0;
      PlaySoundObject(25, 1);
LABEL_87:
      if ( npc->direct )
        npc->xm = 2048;
      else
        npc->xm = -2048;
      if ( ++npc->act_wait / 2 & 1 )
        npc->ani_no = 6;
      else
        npc->ani_no = 7;
      if ( !npc->direct && npc->flag & 1 )
      {
        npc->act_no = 212;
        npc->act_wait = 0;
        npc->damage = 3;
        SetQuake2(10);
        PlaySoundObject(26, 1);
      }
      if ( npc->direct == 2 && npc->flag & 4 )
      {
        npc->act_no = 212;
        npc->act_wait = 0;
        npc->damage = 3;
        SetQuake2(10);
        PlaySoundObject(26, 1);
      }
      if ( npc->count1 <= 3 && ::x > npc->x - 0x2000 && ::x < npc->x + 0x2000 )
        npc->act_no = 201;
      goto LABEL_217;
    }
    if ( v1 <= 210 )
    {
      if ( v1 == 202 )
        goto LABEL_74;
      if ( v1 >= 202 )
      {
        if ( v1 == 203 )
        {
          npc->xm = 8 * npc->xm / 9;
          npc->ym = 8 * npc->ym / 9;
          if ( ++npc->act_wait > 20 )
          {
            if ( y >= npc->y + 6144 )
              npc->act_no = 230;
            else
              npc->act_no = 220;
          }
        }
        goto LABEL_217;
      }
LABEL_70:
      if ( npc->xm )
        npc->act_no = 203;
      else
        npc->act_no = 202;
      npc->act_wait = 0;
      npc->ani_no = 3;
      npc->damage = 3;
      ++npc->count1;
LABEL_74:
      if ( ::x >= npc->x )
        npc->direct = 2;
      else
        npc->direct = 0;
      npc->xm = 8 * npc->xm / 9;
      npc->ym = 8 * npc->ym / 9;
      if ( ++npc->act_wait > 20 )
        npc->act_no = 210;
      goto LABEL_217;
    }
    if ( v1 != 212 )
    {
      if ( v1 >= 212 )
      {
        if ( v1 != 220 )
          goto LABEL_217;
        npc->act_no = 221;
        npc->act_wait = 0;
        npc->ani_no = 8;
        npc->ani_wait = 0;
        npc->xm = 0;
        npc->damage = 10;
        npc->direct = 0;
        PlaySoundObject(25, 1);
        goto LABEL_108;
      }
      goto LABEL_87;
    }
    ++npc->act_wait;
    npc->xm = 0;
    npc->ani_no = 6;
    if ( npc->act_wait > 30 )
    {
      if ( npc->count1 <= 3 )
        npc->act_no = 201;
      else
        npc->act_no = 240;
    }
    goto LABEL_217;
  }
  if ( v1 == 300 )
  {
    npc->act_no = 310;
    npc->act_wait = 0;
    npc->ym = -1536;
    if ( npc->x <= 163840 )
      npc->direct = 0;
    else
      npc->direct = 2;
    npc->tgt_x = ::x;
    npc->tgt_y = 90112;
    npc->ani_wait = 0;
LABEL_160:
    ++npc->ani_wait;
    if ( ++npc->act_wait <= 200 || npc->ani_wait > 19 )
      npc->direct = 0;
    else
      npc->direct = 2;
    if ( npc->ani_wait / 2 & 1 )
      npc->ani_no = 4;
    else
      npc->ani_no = 5;
    if ( npc->x >= npc->tgt_x )
      v5 = npc->xm - 64;
    else
      v5 = npc->xm + 64;
    npc->xm = v5;
    if ( npc->y >= npc->tgt_y )
      v6 = npc->ym - 64;
    else
      v6 = npc->ym + 64;
    npc->ym = v6;
    if ( npc->xm > 1024 )
      npc->xm = 1024;
    if ( npc->xm < -1024 )
      npc->xm = -1024;
    if ( npc->ym > 1024 )
      npc->ym = 1024;
    if ( npc->ym < -1024 )
      npc->ym = -1024;
    if ( npc->act_wait > 200 && npc->act_wait % 40 == 1 )
    {
      npc->ani_wait = 0;
      SetNpChar(333, ::x, 155648, 0, 0, 0, 0, 256);
    }
    if ( npc->act_wait > 480 )
    {
      npc->act_no = 320;
      npc->act_wait = 0;
    }
    goto LABEL_217;
  }
  if ( v1 > 300 )
  {
    if ( v1 != 1001 )
    {
      if ( v1 > 1001 )
      {
        if ( v1 == 1003 )
        {
          if ( ++npc->act_wait > 30 )
          {
            npc->act_wait = 0;
            npc->act_no = 1004;
            npc->ani_no = 3;
            npc->ym -= 2560;
            npc->direct = 0;
            npc->bits |= 8u;
          }
        }
        else if ( v1 < 1003 )
        {
          if ( ++npc->act_wait > 150 )
          {
            npc->act_wait = 0;
            npc->act_no = 1003;
            npc->ani_no = 3;
          }
          if ( npc->act_wait / 2 & 1 )
            v8 = npc->tgt_x + 512;
          else
            v8 = npc->tgt_x - 512;
          npc->x = v8;
        }
        else if ( v1 == 1004 )
        {
          if ( npc->y < 0 )
          {
            npc->xm = 0;
            npc->ym = 0;
            npc->act_no = 1005;
            npc->act_wait = 0;
            SetFlash(0, 0, 2);
            PlaySoundObject(29, 1);
          }
          if ( ++npc->act_wait / 2 & 1 )
            npc->ani_no = 8;
          else
            npc->ani_no = 9;
        }
        goto LABEL_217;
      }
      if ( v1 == 320 )
      {
        npc->xm = 0;
        npc->ym = 0;
        npc->direct = 2;
        if ( ++npc->act_wait == 40 )
          SetFlash(0, 0, 2);
        if ( npc->act_wait > 50 && npc->act_wait % 10 == 1 )
        {
          x = (4 * (npc->act_wait - 50) / 10 + 2) << 13;
          SetNpChar(333, x, 155648, 0, 0, 0, 0, 256);
        }
        if ( npc->act_wait > 140 )
          npc->act_no = 240;
        if ( ++npc->ani_wait / 2 & 1 )
          npc->ani_no = 4;
        else
          npc->ani_no = 5;
        goto LABEL_217;
      }
      if ( v1 != 1000 )
      {
        if ( v1 != 310 )
          goto LABEL_217;
        goto LABEL_160;
      }
      npc->act_no = 1001;
      npc->act_wait = 0;
      npc->ani_no = 10;
      npc->tgt_x = npc->x;
      npc->xm = 0;
      npc->bits &= 0xFFDFu;
      SetDestroyNpChar(npc->x, npc->y, 16, 16);
      PlaySoundObject(72, 1);
    }
    npc->ym += 32;
    if ( npc->ym > 1535 )
      npc->ym = 1535;
    if ( ++npc->act_wait / 2 & 1 )
      v7 = npc->tgt_x + 512;
    else
      v7 = npc->tgt_x - 512;
    npc->x = v7;
    if ( npc->flag & 8 )
    {
      npc->act_no = 1002;
      npc->act_wait = 0;
    }
    goto LABEL_217;
  }
  if ( v1 == 232 )
  {
    ++npc->act_wait;
    npc->xm = 0;
    npc->ani_no = 3;
    if ( npc->act_wait > 30 )
    {
      if ( npc->count1 <= 3 )
        npc->act_no = 201;
      else
        npc->act_no = 242;
    }
  }
  else
  {
    if ( v1 > 232 )
    {
      if ( v1 != 241 )
      {
        if ( v1 == 242 )
        {
          npc->xm = 3 * npc->xm / 4;
          npc->ani_no = 3;
          if ( ++npc->act_wait > 10 )
            npc->act_no = 110;
          goto LABEL_217;
        }
        if ( v1 != 240 )
          goto LABEL_217;
        npc->act_no = 241;
        npc->direct = 0;
      }
      npc->ym += 128;
      if ( npc->ym > 1535 )
        npc->ym = 1535;
      if ( ++npc->ani_wait / 2 & 1 )
        npc->ani_no = 4;
      else
        npc->ani_no = 5;
      if ( npc->flag & 8 )
      {
        npc->act_no = 242;
        npc->act_wait = 0;
        npc->ani_no = 3;
        if ( ::x >= npc->x )
          npc->direct = 2;
        else
          npc->direct = 0;
      }
      goto LABEL_217;
    }
    if ( v1 == 230 )
    {
      npc->act_no = 231;
      npc->act_wait = 0;
      npc->ani_no = 8;
      npc->ani_wait = 0;
      npc->xm = 0;
      npc->damage = 10;
      npc->direct = 2;
      PlaySoundObject(25, 1);
    }
    else if ( v1 <= 230 )
    {
      if ( v1 == 222 )
      {
        ++npc->act_wait;
        npc->xm = 0;
        npc->ani_no = 8;
        if ( npc->act_wait > 30 )
        {
          if ( npc->count1 <= 3 )
            npc->act_no = 201;
          else
            npc->act_no = 240;
        }
      }
      goto LABEL_217;
    }
    npc->ym = 2048;
    if ( ++npc->act_wait / 2 & 1 )
      npc->ani_no = 8;
    else
      npc->ani_no = 9;
    if ( npc->flag & 8 )
    {
      npc->act_no = 232;
      npc->act_wait = 0;
      npc->damage = 3;
      if ( ::x >= npc->x )
        npc->direct = 2;
      else
        npc->direct = 0;
      for ( i = 0; i <= 7; ++i )
      {
        v4 = npc->x;
        x = v4 + (Random(-16, 16) << 9);
        SetNpChar(4, x, npc->y + 5120, 0, 0, 0, 0, 256);
      }
      SetNpChar(332, npc->x - 6144, npc->y + 6144, 0, 0, 0, 0, 256);
      SetNpChar(332, npc->x + 6144, npc->y + 6144, 0, 0, 2, 0, 256);
      SetQuake2(10);
      PlaySoundObject(26, 1);
    }
    if ( npc->count1 <= 3 && y > npc->y - 0x2000 && y < npc->y + 0x2000 )
      npc->act_no = 201;
  }
LABEL_217:
  npc->x += npc->xm;
  npc->y += npc->ym;
  qmemcpy(rcLeft, &ActNpc340(NPCHAR *)::C.0, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc340(NPCHAR *)::C.1, sizeof(rcRight));
  if ( npc->direct )
  {
    v9 = npc;
    v10 = (RECT *)(&v15 + 4 * npc->ani_no - 90);
  }
  else
  {
    v9 = npc;
    v10 = (RECT *)(&v15 + 4 * npc->ani_no - 46);
  }
  npc->rect.left = v10->left;
  v9->rect.top = v10->top;
  v9->rect.right = v10->right;
  v9->rect.bottom = v10->bottom;
}

//----- (08051B47) --------------------------------------------------------
void __cdecl ActNpc341(NPCHAR_0 *npc)
{
  RECT *v1;
  RECT rc[3];

  rc[0].left = 288;
  rc[0].top = 32;
  rc[0].right = 320;
  rc[0].bottom = 48;
  rc[1].left = 288;
  rc[1].top = 48;
  rc[1].right = 320;
  rc[1].bottom = 64;
  rc[2].left = 288;
  rc[2].top = 64;
  rc[2].right = 320;
  rc[2].bottom = 80;
  if ( npc->pNpc->act_no == 11 && npc->pNpc->act_wait > 50 )
    ++npc->ani_wait;
  if ( npc->ani_wait > 4 )
  {
    npc->ani_wait = 0;
    if ( npc->ani_no <= 1 )
      ++npc->ani_no;
  }
  if ( npc->pNpc->ani_no )
    npc->cond = 0;
  v1 = &rc[npc->ani_no];
  npc->rect.left = v1->left;
  npc->rect.top = v1->top;
  npc->rect.right = v1->right;
  npc->rect.bottom = v1->bottom;
}

//----- (08051C43) --------------------------------------------------------
void __cdecl ActNpc342(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  Sint32 *v5;
  RECT rc[3];
  unsigned __int8 deg;
  char v8[8];

  rc[0].left = 240;
  rc[0].top = 48;
  rc[0].right = 280;
  rc[0].bottom = 88;
  rc[1].left = 240;
  rc[1].top = 88;
  rc[1].right = 280;
  rc[1].bottom = 128;
  rc[2].left = 280;
  rc[2].top = 48;
  rc[2].right = 320;
  rc[2].bottom = 88;
  if ( npc->act_no <= 999 && npc->pNpc->act_no > 999 )
    npc->act_no = 1000;
  v1 = npc->act_no;
  if ( v1 == 22 )
  {
    npc->ani_no = 2;
    npc->count1 -= 2;
    if ( npc->count1 < 0 )
      npc->count1 += 512;
    if ( npc->pNpc->act_no == 401 )
      npc->act_no = 23;
    goto LABEL_87;
  }
  if ( v1 <= 22 )
  {
    if ( v1 == 11 )
    {
      if ( npc->count2 <= 304 )
        npc->act_no = 12;
      else
        npc->count2 -= 4;
      goto LABEL_87;
    }
    if ( v1 > 11 )
    {
      if ( v1 == 20 )
      {
        npc->act_no = 21;
        npc->bits |= 0x20u;
        npc->life = 1000;
      }
      else if ( v1 <= 20 )
      {
        if ( v1 == 12 && npc->pNpc->act_no == 311 )
          npc->act_no = 20;
        goto LABEL_87;
      }
      npc->count1 -= 2;
      if ( npc->count1 < 0 )
        npc->count1 += 512;
      if ( npc->shock )
      {
        if ( ++ActNpc342(NPCHAR *)::_flash / 2 & 1 )
          npc->ani_no = 1;
        else
          npc->ani_no = 0;
      }
      else
      {
        npc->ani_no = 0;
      }
      if ( npc->life <= 899 )
      {
        npc->act_no = 22;
        npc->bits &= 0xFFDFu;                   // TODO: Hey look, it really was a compiler optimisation
        SetDestroyNpChar(npc->x, npc->y, 0x2000, 32);
        PlaySoundObject(71, 1);
      }
      npc->pNpc->count1 = 4;
      if ( npc->pNpc->act_no == 401 )
        npc->act_no = 23;
      goto LABEL_87;
    }
    if ( v1 )
    {
      if ( v1 != 10 )
        goto LABEL_87;
    }
    else
    {
      npc->act_no = 10;
      npc->count1 = 2 * (npc->direct & 0xFF);
      npc->direct >>= 8;
      npc->count2 = 192;
      npc->damage = 14;
    }
    if ( npc->count2 > 319 )
      npc->act_no = 11;
    else
      npc->count2 += 8;
    goto LABEL_87;
  }
  if ( v1 == 40 )
  {
    npc->act_no = 41;
    npc->xm = 0;
    npc->ym = 0;
    npc->ani_no = 2;
    npc->damage = 5;
    npc->bits &= 0xFFD7u;
    SetDestroyNpChar(npc->x, npc->y, 0x2000, 32);
    PlaySoundObject(71, 1);
    goto LABEL_69;
  }
  if ( v1 <= 40 )
  {
    if ( v1 == 30 )
    {
      npc->act_no = 31;
      npc->life = 1000;
      npc->damage = 10;
      if ( !npc->direct )
        npc->bits |= 0x20u;
      npc->ym = 0;
    }
    else if ( v1 != 31 )
    {
      if ( v1 == 23 )
      {
        npc->ani_no = 2;
        npc->count1 -= 4;
        if ( npc->count1 < 0 )
          npc->count1 += 512;
        if ( npc->pNpc->act_no == 420 )
          npc->act_no = 30;
      }
      goto LABEL_87;
    }
    ++npc->count1;
    npc->count1 %= 512;                         // TODO: More WTF
    if ( npc->count2 > 256 )
      --npc->count2;
    if ( npc->bits & 0x20 )
    {
      if ( npc->shock )
      {
        if ( ++ActNpc342(NPCHAR *)::_flash / 2 & 1 )// Fix me
          npc->ani_no = 1;
        else
          npc->ani_no = 0;
      }
      else
      {
        npc->ani_no = 0;
      }
    }
    else
    {
      npc->ani_no = 2;
    }
    if ( npc->life <= 899 )
      npc->act_no = 40;
    goto LABEL_87;
  }
  switch ( v1 )
  {
    case 1000:
      npc->act_no = 1001;
      npc->xm = 0;
      npc->ym = 0;
      npc->ani_no = 2;
      npc->bits &= 0xFFD7u;
      npc->damage = 0;
      npc->count1 /= 4;
      npc->exp = 0;
      break;
    case 1001:
      break;
    case 41:
LABEL_69:
      if ( npc->flag & 1 )
        npc->xm = 256;
      if ( npc->flag & 4 )
        npc->xm = -256;
      if ( npc->flag & 8 )
      {
        if ( !npc->xm )
        {
          if ( x >= npc->x )
            npc->xm = -256;
          else
            npc->xm = 256;
        }
        npc->ym = -2048;
        PlaySoundObject(26, 1);
      }
      npc->ym += 32;
      if ( npc->ym > 1535 )
        npc->ym = 1535;
      goto LABEL_87;
    default:
      goto LABEL_87;
  }
  if ( npc->count1 <= 0 )
  {
    SetDestroyNpChar(npc->x, npc->y, 0x2000, 32);
    PlaySoundObject(71, 1);
    VanishNpChar(npc);
    return;
  }
  if ( --npc->count1 / 2 & 1 )
    npc->ani_no = 1;
  else
    npc->ani_no = 0;
LABEL_87:
  if ( npc->act_no == 21 || npc->act_no == 22 )
  {
    v2 = npc->pNpc->direct;
    if ( v2 == 1 )
    {
      if ( npc->count1 == 268 )
      {
        SetNpChar(4, npc->x - 6144, npc->y + 4096, 0, 0, 0, 0, 256);
        SetNpChar(4, npc->x - 6144, npc->y - 4096, 0, 0, 0, 0, 256);
        PlaySoundObject(26, 1);
      }
    }
    else if ( v2 > 1 )
    {
      if ( v2 == 2 )
      {
        if ( npc->count1 == 396 )
        {
          SetNpChar(4, npc->x + 4096, npc->y - 6144, 0, 0, 0, 0, 256);
          SetNpChar(4, npc->x - 4096, npc->y - 6144, 0, 0, 0, 0, 256);
          SetNpChar(345, npc->x - 4096, npc->y - 6144, 0, 0, 0, 0, 256);
          PlaySoundObject(26, 1);
        }
      }
      else if ( v2 == 3 && npc->count1 == 12 )
      {
        SetNpChar(4, npc->x + 6144, npc->y + 4096, 0, 0, 0, 0, 256);
        SetNpChar(4, npc->x + 6144, npc->y - 4096, 0, 0, 0, 0, 256);
        PlaySoundObject(26, 1);
      }
    }
    else if ( !v2 && npc->count1 == 140 )
    {
      SetNpChar(4, npc->x + 4096, npc->y + 6144, 0, 0, 0, 0, 256);
      SetNpChar(4, npc->x - 4096, npc->y + 6144, 0, 0, 0, 0, 256);
      PlaySoundObject(26, 1);
    }
  }
  if ( npc->act_no <= 39 )
  {
    deg = npc->count1 / 2;
    v3 = npc->pNpc->x;
    npc->tgt_x = v3 + npc->count2 * GetCos(deg) / 4;
    v4 = npc->pNpc->y;
    npc->tgt_y = v4 + npc->count2 * GetSin(deg) / 4;
    npc->xm = npc->tgt_x - npc->x;
    npc->ym = npc->tgt_y - npc->y;
  }
  npc->x += npc->xm;
  npc->y += npc->ym;
  v5 = (Sint32 *)&v8[16 * npc->ani_no - 52];
  npc->rect.left = *v5;
  npc->rect.top = v5[1];
  npc->rect.right = v5[2];
  npc->rect.bottom = v5[3];
}


//----- (080528A2) --------------------------------------------------------
void __cdecl ActNpc343(NPCHAR_0 *npc)
{
  npc->rect.left = 0;
  npc->rect.top = 0;
  npc->rect.right = 120;
  npc->rect.bottom = 120;
  if ( ++npc->act_wait > 100 )
    npc->cond = 0;
  npc->x = npc->pNpc->x;
  npc->y = npc->pNpc->y;
}

//----- (08052925) --------------------------------------------------------
void __cdecl ActNpc344(NPCHAR_0 *npc)
{
  int v1;

  if ( npc->direct )
  {
    npc->rect.left = 296;
    npc->rect.top = 0;
    npc->rect.right = 320;
    npc->rect.bottom = 16;
    v1 = npc->pNpc->x + 12288;
  }
  else
  {
    npc->rect.left = 272;
    npc->rect.top = 0;
    npc->rect.right = 296;
    npc->rect.bottom = 16;
    v1 = npc->pNpc->x - 12288;
  }
  npc->x = v1;
  if ( ++npc->act_wait > 100 )
    npc->cond = 0;
  npc->y = npc->pNpc->y - 18432;
}

//----- (08052A0F) --------------------------------------------------------
void __cdecl ActNpc345(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  RECT rc[4];
  int i;
  RECT *v10;

  rc[0].left = 128;
  rc[0].top = 176;
  rc[0].right = 144;
  rc[0].bottom = 192;
  rc[1].left = 144;
  rc[1].top = 176;
  rc[1].right = 160;
  rc[1].bottom = 192;
  rc[2].left = 160;
  rc[2].top = 176;
  rc[2].right = 176;
  rc[2].bottom = 192;
  rc[3].left = 176;
  rc[3].top = 176;
  rc[3].right = 192;
  rc[3].bottom = 192;
  v1 = npc->act_no;
  switch ( v1 )
  {
    case 100:
      goto LABEL_5;
    case 110:
      npc->ym += 64;
      if ( npc->y > (gMap.length + 2) << 13 )
      {
        npc->cond = 0;
        return;
      }
      break;
    case 0:
      npc->act_no = 100;
      npc->ani_no = Random(0, 16) % 4;          // TODO: Extra WTF
LABEL_5:
      npc->ym += 64;
      if ( npc->ym > 1792 )
        npc->ym = 1792;
      if ( npc->y > 0x10000 )
        npc->bits &= 0xFFF7u;
      v2 = npc->act_wait;
      npc->act_wait = v2 + 1;
      if ( v2 / 2 & 1 )
        SetNpChar(4, npc->x, npc->y, 0, 0, 0, 0, 256);
      if ( npc->flag & 8 )
      {
        npc->ym = -512;
        npc->act_no = 110;
        npc->bits |= 8u;
        PlaySoundObject(12, 1);
        SetQuake(10);
        for ( i = 0; i <= 3; ++i )
        {
          v3 = Random(-1536, 0);
          v4 = Random(-341, 341);
          v5 = npc->y + 0x2000;
          v6 = npc->x;
          v7 = Random(-12, 12);
          SetNpChar(4, v6 + (v7 << 9), v5, v4, v3, 0, 0, 256);
        }
      }
      break;
  }
  if ( ++npc->ani_wait > 8 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 3 )
    npc->ani_no = 0;
  npc->y += npc->ym;
  npc->rect = *(RECT *)(&(&v10)[4 * npc->ani_no - 1] - 1);
}

//----- (08052D59) --------------------------------------------------------
void __cdecl ActNpc346(NPCHAR_0 *npc)
{
  int v1;
  unsigned __int8 deg;
  int v3;
  int v4;
  __int64 v5;

  if ( npc->act_no <= 999 && npc->pNpc->act_no > 999 )
    npc->act_no = 1000;
  v1 = npc->act_no;
  if ( v1 == 30 )
  {
    ++npc->count1;
    npc->count1 %= 1024;
    if ( npc->pNpc->act_no == 425 )
      npc->act_no = 50;
    if ( npc->pNpc->act_no == 427 )
      npc->act_no = 100;
  }
  else if ( v1 > 30 )
  {
    if ( v1 == 100 )
    {
      npc->ani_no = 0;
      if ( npc->pNpc->act_no == 424 )
        npc->act_no = 30;
      if ( npc->pNpc->act_no == 428 )
        npc->act_no = 20;
    }
    else if ( v1 > 100 )
    {
      if ( v1 == 1000 )
      {
        npc->act_no = 1001;
        npc->xm = 0;
        npc->ym = 0;
        npc->bits &= 0xFFBFu;
      }
      else if ( v1 != 1001 )
      {
        goto LABEL_50;
      }
      npc->ym += 64;
      if ( npc->y > gMap.length << 13 )
        npc->cond = 0;
    }
    else if ( v1 == 40 )
    {
      npc->count1 -= 2;
      if ( npc->count1 < 0 )
        npc->count1 += 1024;
      if ( npc->pNpc->act_no == 422 )
        npc->act_no = 20;
    }
    else if ( v1 == 50 )
    {
      npc->count1 += 2;
      npc->count1 %= 1024;
      if ( npc->pNpc->act_no == 426 )
        npc->act_no = 30;
    }
  }
  else
  {
    if ( v1 == 10 )
    {
LABEL_22:
      if ( npc->count2 > 447 )
        npc->act_no = 11;
      else
        npc->count2 += 8;
      goto LABEL_50;
    }
    if ( v1 <= 10 )
    {
      if ( v1 )
        goto LABEL_50;
      npc->act_no = 10;
      npc->count1 = 4 * npc->direct;
      npc->count2 = 192;
      npc->ani_no = 0;
      goto LABEL_22;
    }
    if ( v1 == 11 )
    {
      if ( npc->pNpc->act_no == 411 )
        npc->act_no = 20;
    }
    else if ( v1 == 20 )
    {
      if ( --npc->count1 < 0 )
        npc->count1 += 1024;
      if ( npc->pNpc->act_no == 421 )
        npc->act_no = 40;
      if ( npc->pNpc->act_no == 423 )
        npc->act_no = 100;
    }
  }
LABEL_50:
  if ( npc->act_no <= 999 )
  {
    if ( y <= npc->y - 4096 || unk_81C85B8 >= 0 )
      npc->bits |= 0x40u;
    else
      npc->bits &= 0xFFBFu;
    deg = npc->count1 / 4;
    v3 = npc->pNpc->x;
    npc->tgt_x = v3 + npc->count2 * GetCos(deg) / 4;
    v4 = npc->pNpc->y + 0x2000;
    npc->tgt_y = v4 + npc->count2 * GetSin(deg) / 4;
    npc->xm = npc->tgt_x - npc->x;
    if ( npc->act_no != 20 && npc->act_no != 30 )
    {
      if ( npc->act_no != 40 && npc->act_no != 50 )
      {
        npc->ani_no = npc->tgt_y - npc->y;
      }
      else if ( (npc->count1 / 2 & 1) != 1 )
      {
        npc->ani_no = (npc->tgt_y - npc->y) / 2;
      }
    }
    else if ( !(npc->count1 & 3) )
    {
      v5 = npc->tgt_y - npc->y;
      npc->ani_no = (signed int)((HIDWORD(v5) >> 30) + v5) >> 2;// TODO
    }
    npc->ym = npc->ani_no;
  }
  npc->x += npc->xm;
  npc->y += npc->ym;
  npc->rect.left = 240;
  npc->rect.top = 0;
  npc->rect.right = 272;
  npc->rect.bottom = 16;
}
/* Orphan comments:
TODO: WTF
TODO
*/

//----- (080532F6) --------------------------------------------------------
void __cdecl ActNpc347(NPCHAR_0 *npc)
{
  RECT rc[4];
  RECT *v2;

  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      goto LABEL_3;
    case 1:
LABEL_3:
      npc->ani_no = 0;
      if ( y < npc->y + 0x10000 && y > npc->y - 0x10000 )
      {
        npc->act_no = 10;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      break;
    case 0xA:
      if ( ++npc->act_wait == 4 )
        npc->ani_no = 2;
      if ( npc->act_wait > 12 )
      {
        npc->act_no = 12;
        npc->xm = 1792;
        PlaySoundObject(6, 1);
        npc->ani_no = 3;
      }
      break;
    case 0xC:
      if ( y >= npc->y )
        npc->ym = 170;
      else
        npc->ym = -170;
      if ( npc->flag & 1 )
      {
        npc->act_no = 13;
        npc->act_wait = 0;
        npc->ani_no = 2;
        npc->xm = 0;
        npc->ym = 0;
      }
      else
      {
        npc->xm -= 42;
        if ( npc->xm < -1535 )
          npc->xm = -1535;
        npc->x += npc->xm;
        npc->y += npc->ym;
      }
      break;
    case 0xD:
      if ( ++npc->act_wait == 2 )
        npc->ani_no = 1;
      if ( npc->act_wait == 6 )
        npc->ani_no = 0;
      if ( npc->act_wait > 16 )
        npc->act_no = 1;
      break;
    default:
      break;
  }
  rc[0].left = 256;
  rc[0].top = 48;
  rc[0].right = 272;
  rc[0].bottom = 64;
  rc[1].left = 272;
  rc[1].top = 48;
  rc[1].right = 288;
  rc[1].bottom = 64;
  rc[2].left = 288;
  rc[2].top = 48;
  rc[2].right = 304;
  rc[2].bottom = 64;
  rc[3].left = 304;
  rc[3].top = 48;
  rc[3].right = 320;
  rc[3].bottom = 64;
  npc->rect = *(RECT *)&(&v2)[4 * npc->ani_no - 1];
}

//----- (08053596) --------------------------------------------------------
void __cdecl ActNpc348(NPCHAR_0 *npc)
{
  int v1;
  RECT *v2;
  RECT rc[2];

  rc[0].left = 128;
  rc[0].top = 152;
  rc[0].right = 160;
  rc[0].bottom = 176;
  rc[1].left = 160;
  rc[1].top = 152;
  rc[1].right = 192;
  rc[1].bottom = 176;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_10;
  }
  else
  {
    npc->act_no = 1;
  }
  if ( ++npc->act_wait > 127 )
  {
    npc->act_no = 10;
    npc->ani_no = 0;
    npc->damage = 2;
  }
  else
  {
    npc->y -= 128;
    if ( npc->act_wait / 2 & 1 )
      npc->ani_no = 1;
    else
      npc->ani_no = 0;
  }
LABEL_10:
  v2 = &rc[npc->ani_no];
  npc->rect.left = v2->left;
  npc->rect.top = v2->top;
  npc->rect.right = v2->right;
  npc->rect.bottom = v2->bottom;
}

//----- (08053697) --------------------------------------------------------
void __cdecl ActNpc349(NPCHAR_0 *npc)
{
  if ( !npc->act_no )
  {
    npc->act_no = 1;
    if ( !npc->direct )
      npc->x += 4096;
    if ( npc->direct == 2 )
      npc->y += 0x2000;
  }
  npc->rect.left = 0;
  npc->rect.top = 0;
  npc->rect.right = 16;
  npc->rect.bottom = 16;
}

//----- (08053723) --------------------------------------------------------
void __cdecl ActNpc350(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  NPCHAR_0 *v3;
  RECT *v4;
  RECT rcRight[7];
  RECT rcLeft[7];
  RECT *v7;

  qmemcpy(rcLeft, &ActNpc350(NPCHAR *)::C.11, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc350(NPCHAR *)::C.12, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      if ( npc->direct )
        v1 = npc->x + 0x10000;
      else
        v1 = npc->x - 0x10000;
      npc->tgt_x = v1;
      npc->tgt_y = npc->y;
      npc->ym = 2 * Random(-512, 512);
      npc->xm = 2 * Random(-512, 512);
      goto LABEL_6;
    case 1:
LABEL_6:
      if ( ++npc->ani_wait > 1 )
      {
        npc->ani_wait = 0;
        if ( ++npc->ani_no > 1 )
          npc->ani_no = 0;
      }
      if ( npc->direct )
      {
        if ( npc->x > npc->tgt_x )
          npc->act_no = 20;
      }
      else if ( npc->x < npc->tgt_x )
      {
        npc->act_no = 20;
      }
      goto LABEL_48;
    case 0x14:
      npc->act_no = 21;
      npc->act_wait = Random(0, 150);
      npc->ani_no = 2;
      npc->ani_wait = 0;
      goto LABEL_15;
    case 0x15:
LABEL_15:
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        if ( ++npc->ani_no > 3 )
          npc->ani_no = 2;
      }
      if ( ++npc->act_wait > 300 )
        npc->act_no = 30;
      if ( x < npc->x + 57344 && x > npc->x - 57344 && y < npc->y + 0x2000 && y > npc->y - 0x2000 )
        npc->act_no = 30;
      goto LABEL_48;
    case 0x1E:
      npc->act_no = 31;
      npc->act_wait = 0;
      npc->ani_wait = 0;
      goto LABEL_26;
    case 0x1F:
LABEL_26:
      if ( ++npc->ani_wait / 2 & 1 )
        npc->ani_no = 3;
      else
        npc->ani_no = 4;
      if ( ++npc->act_wait > 30 )
      {
        npc->act_no = 40;
        npc->ani_no = 5;
        if ( npc->direct )
          SetNpChar(312, npc->x, npc->y, 2048, 0, 2, 0, 409);
        else
          SetNpChar(312, npc->x, npc->y, -2048, 0, 0, 0, 409);
      }
      goto LABEL_48;
    case 0x28:
      npc->act_no = 41;
      npc->act_wait = 0;
      npc->ani_wait = 0;
      goto LABEL_34;
    case 0x29:
LABEL_34:
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        if ( ++npc->ani_no > 6 )
          npc->ani_no = 5;
      }
      if ( ++npc->act_wait > 40 )
      {
        npc->act_no = 50;
        npc->ani_no = 0;
        npc->xm = 0;
        npc->ym = 0;
      }
      goto LABEL_48;
    case 0x32:
      if ( ++npc->ani_wait > 1 )
      {
        npc->ani_wait = 0;
        if ( ++npc->ani_no > 1 )
          npc->ani_no = 0;
      }
      if ( npc->direct )
        v2 = npc->xm + 32;
      else
        v2 = npc->xm - 32;
      npc->xm = v2;
      if ( npc->x >= 0 && npc->x <= gMap.width << 13 )
        goto LABEL_48;
      VanishNpChar(npc);
      break;
    default:
LABEL_48:
      if ( npc->act_no <= 49 )
      {
        if ( npc->x < npc->tgt_x )
          npc->xm += 42;
        if ( npc->x > npc->tgt_x )
          npc->xm -= 42;
        if ( npc->y < npc->tgt_y )
          npc->ym += 42;
        if ( npc->y > npc->tgt_y )
          npc->ym -= 42;
        if ( npc->xm > 1024 )
          npc->xm = 1024;
        if ( npc->xm < -1024 )
          npc->xm = -1024;
        if ( npc->ym > 1024 )
          npc->ym = 1024;
        if ( npc->ym < -1024 )
          npc->ym = -1024;
      }
      npc->x += npc->xm;
      npc->y += npc->ym;
      if ( npc->direct )
      {
        v3 = npc;
        v4 = (RECT *)(&v7 + 4 * npc->ani_no - 56);
      }
      else
      {
        v3 = npc;
        v4 = (RECT *)(&v7 + 4 * npc->ani_no - 28);
      }
      npc->rect.left = v4->left;
      v3->rect.top = v4->top;
      v3->rect.right = v4->right;
      v3->rect.bottom = v4->bottom;
      break;
  }
}

//----- (08053DC3) --------------------------------------------------------
void __cdecl ActNpc351(NPCHAR_0 *npc)
{
  RECT rc[9];
  RECT *v2;

  qmemcpy(rc, ActNpc351(NPCHAR *)::C.13, sizeof(rc));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = npc->direct / 10;
      npc->x += 4096;
      npc->y += 6144;
      break;
    case 0xA:
      if ( (unsigned __int8)GetNPCFlag(npc->code_flag) )
      {
        npc->act_no = 20;
      }
      else
      {
        npc->act_no = 11;
        npc->bits |= 0x20u;
      }
      goto LABEL_6;
    case 0xB:
LABEL_6:
      if ( npc->life <= 900 )
      {
        SetNpChar(351, npc->x - 4096, npc->y - 6144, 0, 0, 10 * npc->ani_no + 40, 0, 0);
        npc->cond |= 8u;
      }
      break;
    case 0x14:
      npc->ani_no += 4;
      npc->act_no = 1;
      break;
    default:
      break;
  }
  npc->rect = (RECT)*((_OWORD *)&v2 + npc->ani_no - 9);
}

//----- (08053F66) --------------------------------------------------------
void __cdecl ActNpc352(NPCHAR_0 *npc)
{
  int v1;
  unsigned int v2;
  unsigned int v3;
  RECT rc[28];
  RECT *v5;

  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_19;
  }
  else
  {
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->count1 = npc->direct / 100;
    npc->direct %= 100;
    v2 = npc->count1;
    if ( v2 <= 0xD && (1 << v2) & 0x3380 )
      npc->surf = 21;
    v3 = npc->count1;
    if ( v3 <= 0xC && (1 << v3) & 0x1214 )
      npc->view.top = 0x2000;
    if ( npc->count1 == 9 )
    {
      npc->view.back = 10240;
      npc->view.front = 10240;
      npc->x -= 512;
    }
    if ( !npc->count1 )
      SetNpChar(145, 0, 0, 0, 0, 2, npc, 256);
  }
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  if ( npc->flag & 8 )
  {
    npc->ym = 0;
    npc->act_no = 2;
    npc->ani_no = 1;
  }
  npc->y += npc->ym;
LABEL_19:
  qmemcpy(rc, ActNpc352(NPCHAR *)::C.15, sizeof(rc));
  npc->rect = *(RECT *)&(&v5)[4 * (npc->ani_no + 2 * npc->count1) - 7];
}

//----- (08054188) --------------------------------------------------------
void __cdecl ActNpc353(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  RECT *v3;
  int v4;
  int v5;
  int v6;
  NPCHAR_0 *v7;
  RECT *v8;
  RECT rc[4];
  RECT rcRight[2];
  RECT rcLeft[2];

  rc[0].left = 168;
  rc[0].top = 160;
  rc[0].right = 184;
  rc[0].bottom = 184;
  rc[1].left = 184;
  rc[1].top = 160;
  rc[1].right = 200;
  rc[1].bottom = 184;
  rc[2].left = 168;
  rc[2].top = 184;
  rc[2].right = 184;
  rc[2].bottom = 208;
  rc[3].left = 184;
  rc[3].top = 184;
  rc[3].right = 200;
  rc[3].bottom = 208;
  rcLeft[0].left = 200;
  rcLeft[0].top = 160;
  rcLeft[0].right = 216;
  rcLeft[0].bottom = 176;
  rcLeft[1].left = 216;
  rcLeft[1].top = 160;
  rcLeft[1].right = 232;
  rcLeft[1].bottom = 176;
  rcRight[0].left = 200;
  rcRight[0].top = 176;
  rcRight[0].right = 216;
  rcRight[0].bottom = 192;
  rcRight[1].left = 216;
  rcRight[1].top = 176;
  rcRight[1].right = 232;
  rcRight[1].bottom = 192;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_19:
    if ( ++npc->act_wait == 8 )
      npc->bits &= 0xFFF7u;
    npc->x += npc->xm;
    npc->y += npc->ym;
    if ( npc->act_wait == 16 )
      npc->act_no = 10;
    if ( ++npc->ani_wait > 2 )
    {
      npc->ani_wait = 0;
      if ( ++npc->ani_no > 3 )
        npc->ani_no = 0;
    }
    v3 = &rc[npc->ani_no];
    npc->rect.left = v3->left;
    npc->rect.top = v3->top;
    npc->rect.right = v3->right;
    npc->rect.bottom = v3->bottom;
    return;
  }
  if ( v1 <= 1 )
  {
    if ( v1 )
      return;
    npc->act_no = 1;
    v2 = npc->direct;
    if ( v2 == 1 )
    {
      npc->ym = -1536;
    }
    else if ( v2 > 1 )
    {
      if ( v2 == 2 )
      {
        npc->xm = 1536;
      }
      else if ( v2 == 3 )
      {
        npc->ym = 1536;
      }
    }
    else if ( !v2 )
    {
      npc->xm = -1536;
    }
    goto LABEL_19;
  }
  if ( v1 == 10 )
  {
    npc->act_no = 11;
    npc->ani_no = 0;
    npc->bits |= 0x20u;
    npc->bits &= 0xFFF7u;
    npc->damage = 5;
    npc->view.top = 4096;
  }
  else if ( v1 != 11 )
  {
    return;
  }
  if ( npc->x <= x )
    npc->direct = 2;
  else
    npc->direct = 0;
  if ( y - 12288 <= npc->y )
  {
    if ( npc->direct )
      v5 = npc->xm2 + 16;
    else
      v5 = npc->xm2 - 16;
    npc->xm2 = v5;
  }
  else
  {
    if ( npc->direct )
      v4 = npc->xm2 - 16;
    else
      v4 = npc->xm2 + 16;
    npc->xm2 = v4;
  }
  if ( npc->y <= y )
    v6 = npc->ym2 + 16;
  else
    v6 = npc->ym2 - 16;
  npc->ym2 = v6;
  if ( npc->xm2 < 0 && npc->flag & 1 )
    npc->xm2 = -npc->xm2;
  if ( npc->xm2 > 0 && npc->flag & 4 )
    npc->xm2 = -npc->xm2;
  if ( npc->ym2 < 0 && npc->flag & 2 )
    npc->ym2 = -npc->ym2;
  if ( npc->ym2 > 0 && npc->flag & 8 )
    npc->ym2 = -npc->ym2;
  if ( npc->xm2 < -1535 )
    npc->xm2 = -1535;
  if ( npc->xm2 > 1535 )
    npc->xm2 = 1535;
  if ( npc->ym2 < -1535 )
    npc->ym2 = -1535;
  if ( npc->ym2 > 1535 )
    npc->ym2 = 1535;
  npc->x += npc->xm2;
  npc->y += npc->ym2;
  if ( ++npc->ani_wait > 1 )
  {
    npc->ani_wait = 0;
    if ( ++npc->ani_no > 1 )
      npc->ani_no = 0;
  }
  if ( npc->direct )
  {
    v7 = npc;
    v8 = &rcRight[npc->ani_no];
  }
  else
  {
    v7 = npc;
    v8 = &rcLeft[npc->ani_no];
  }
  npc->rect.left = v8->left;
  v7->rect.top = v8->top;
  v7->rect.right = v8->right;
  v7->rect.bottom = v8->bottom;
}

//----- (080546B6) --------------------------------------------------------
void __cdecl ActNpc354(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int i;

  v1 = npc->act_no;
  if ( v1 != 1 )
  {
    if ( v1 > 1 )
    {
      if ( v1 == 10 )
      {
        npc->act_no = 11;
        npc->act_wait = 0;
        if ( npc->direct )
          v2 = npc->x - 0x2000;
        else
          v2 = npc->x + 0x2000;
        npc->x = v2;
      }
      else if ( v1 != 11 )
      {
        return;
      }
      if ( ++npc->act_wait > 100 )
      {
        npc->act_wait = 0;
        SetQuake(20);
        PlaySoundObject(26, 1);
        PlaySoundObject(12, 1);
        if ( npc->direct )
          v3 = npc->x + 0x2000;
        else
          v3 = npc->x - 0x2000;
        npc->x = v3;
        for ( i = 0; i <= 19; ++i )
          ChangeMapParts(npc->x / 0x2000, i + npc->y / 0x2000, 0x6Du);
      }
    }
    else if ( !v1 )
    {
      npc->hit.bottom = 143360;
    }
  }
}

//----- (08054832) --------------------------------------------------------
void __cdecl ActNpc355(NPCHAR_0 *npc)
{
  int v1;
  RECT *v2;
  RECT rc[4];

  rc[0].left = 80;
  rc[0].top = 16;
  rc[0].right = 96;
  rc[0].bottom = 32;
  rc[1].left = 80;
  rc[1].top = 96;
  rc[1].right = 96;
  rc[1].bottom = 112;
  rc[2].left = 128;
  rc[2].top = 16;
  rc[2].right = 144;
  rc[2].bottom = 32;
  rc[3].left = 208;
  rc[3].top = 96;
  rc[3].right = 224;
  rc[3].bottom = 112;
  if ( !npc->act_no )
  {
    v1 = npc->direct;
    if ( v1 == 1 )
    {
      npc->surf = 23;
      npc->ani_no = 1;
      npc->x = npc->pNpc->x + 7168;
      npc->y = npc->pNpc->y + 5120;
    }
    else if ( v1 > 1 )
    {
      if ( v1 == 2 )
      {
        npc->surf = 16;
        npc->ani_no = 2;
        npc->x = npc->pNpc->x - 3584;
        npc->y = npc->pNpc->y - 9728;
      }
      else if ( v1 == 3 )
      {
        npc->surf = 23;
        npc->ani_no = 3;
        npc->x = npc->pNpc->x + 2048;
        npc->y = npc->pNpc->y - 9728;
      }
    }
    else if ( !v1 )
    {
      npc->surf = 16;
      npc->ani_no = 0;
      npc->x = npc->pNpc->x - 7168;
      npc->y = npc->pNpc->y + 5120;
    }
  }
  v2 = &rc[npc->ani_no];
  npc->rect.left = v2->left;
  npc->rect.top = v2->top;
  npc->rect.right = v2->right;
  npc->rect.bottom = v2->bottom;
}

//----- (08054A2E) --------------------------------------------------------
void __cdecl ActNpc356(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  RECT rcRight[2];
  RECT *v4;

  rcRight[0].left = 240;
  rcRight[0].top = 128;
  rcRight[0].right = 280;
  rcRight[0].bottom = 152;
  rcRight[1].left = 240;
  rcRight[1].top = 152;
  rcRight[1].right = 280;
  rcRight[1].bottom = 176;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 11;
      npc->ani_wait = 0;
      npc->tgt_y = npc->y - 0x2000;
      npc->tgt_x = npc->x - 3072;
      npc->ym = 0;
      SetNpChar(355, 0, 0, 0, 0, 3, npc, 170);
      SetNpChar(355, 0, 0, 0, 0, 2, npc, 170);
      goto LABEL_3;
    case 0xB:
LABEL_3:
      if ( npc->x >= npc->tgt_x )
        v1 = npc->xm - 8;
      else
        v1 = npc->xm + 8;
      npc->xm = v1;
      if ( npc->y >= npc->tgt_y )
        v2 = npc->ym - 8;
      else
        v2 = npc->ym + 8;
      npc->ym = v2;
      npc->x += npc->xm;
      npc->y += npc->ym;
      break;
    case 0x14:
      npc->act_no = 21;
      npc->xm = -1024;
      npc->ym = 512;
      goto LABEL_11;
    case 0x15:
LABEL_11:
      ++npc->ani_wait;
      npc->xm += 16;
      npc->ym -= 8;
      npc->x += npc->xm;
      npc->y += npc->ym;
      if ( npc->x > 491520 )
        npc->act_no = 22;
      break;
    case 0x16:
      npc->xm = 0;
      npc->ym = 0;
      break;
    default:
      break;
  }
  if ( ++npc->ani_wait > 4 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 1 )
    npc->ani_no = 0;
  npc->rect = (RECT)*((_OWORD *)&v4 + npc->ani_no - 2);
}

//----- (08054CF2) --------------------------------------------------------
void __cdecl ActNpc357(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;

  v1 = npc->act_no;
  if ( !v1 )
  {
    npc->rect.left = 224;
    npc->rect.top = 136;
    npc->rect.right = 240;
    npc->rect.bottom = 152;
    ++npc->act_wait;
    goto LABEL_12;
  }
  if ( v1 < 0 )
    goto LABEL_12;
  if ( v1 == 10 )
  {
    npc->act_wait = 0;
    npc->act_no = 11;
    PlaySoundObject(29, 1);
  }
  else if ( v1 != 11 )
  {
    goto LABEL_12;
  }
  ++npc->act_wait;
  npc->rect.left = 224;
  npc->rect.top = 136;
  npc->rect.right = 240;
  npc->rect.bottom = 152;
  if ( npc->act_wait / 2 & 1 )
    npc->rect.right = npc->rect.left;
  if ( npc->act_wait > 50 )
    npc->cond = 0;
LABEL_12:
  if ( npc->act_wait % 8 == 1 )
  {
    v2 = npc->y + 4096;
    v3 = npc->x;
    v4 = Random(-8, 8);
    SetCaret(v3 + (v4 << 9), v2, 13, 1);
  }
}
/* Orphan comments:
TODO
*/

//----- (08054E55) --------------------------------------------------------
void __cdecl ActNpc358(NPCHAR_0 *npc)
{
  int v1;
  RECT rc[5];
  RECT *v3;

  qmemcpy(rc, ActNpc358(NPCHAR *)::C.16, sizeof(rc));
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 == 10 )
    {
      if ( ++npc->ani_wait > 6 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 4 )
        npc->ani_no = 3;
    }
  }
  else
  {
    if ( ++npc->ani_wait > 6 )
    {
      npc->ani_wait = 0;
      ++npc->ani_no;
    }
    if ( npc->ani_no > 1 )
      npc->ani_no = 0;
  }
  npc->rect = (RECT)*((_OWORD *)&v3 + npc->ani_no - 5);
}

//----- (08054F50) --------------------------------------------------------
void __cdecl ActNpc359(NPCHAR_0 *npc)
{
  int v1;

  if ( x < npc->x + 163840 && x > npc->x - 163840 && y < npc->y + 163840 && y > npc->y - 81920 && Random(0, 100) == 2 )
  {
    v1 = Random(-6, 6);
    SetNpChar(73, (v1 << 9) + npc->x, npc->y - 3584, 0, 0, 0, 0, 0);
  }
}

//----- (08055049) --------------------------------------------------------
void __cdecl ActNpc360(NPCHAR_0 *npc)
{
  if ( !npc->act_no )
  {
    ++npc->act_no;
    npc->x -= 4096;
    npc->y -= 4096;
  }
  npc->rect.left = 0;
  npc->rect.top = 176;
  npc->rect.right = 48;
  npc->rect.bottom = 184;
}

//----- (080550E8) --------------------------------------------------------
// No idea what this crap is
void __cdecl scoped_profile::scoped_profile(scoped_profile *const this, const char *id)
{
  this->_vptr.scoped_profile = (int (**)(...))off_81454D8;
  this->id = id;
  this->start = SDL_GetTicks();
}



//----- (0805510E) --------------------------------------------------------
void __cdecl scoped_profile::scoped_profile(scoped_profile *const this, const char *id)
{
  this->_vptr.scoped_profile = (int (**)(...))off_81454D8;
  this->id = id;
  this->start = SDL_GetTicks();
}



//----- (08055134) --------------------------------------------------------
void __cdecl scoped_profile::~scoped_profile(scoped_profile *const this)
{
  int v1;

  this->_vptr.scoped_profile = (int (**)(...))off_81454D8;
  v1 = SDL_GetTicks();
  ErrorLog(this->id, v1 - this->start);
}



//----- (08055188) --------------------------------------------------------
void __cdecl scoped_profile::~scoped_profile(scoped_profile *const this)
{
  int v1;

  this->_vptr.scoped_profile = (int (**)(...))off_81454D8;
  v1 = SDL_GetTicks();
  ErrorLog(this->id, v1 - this->start);
}



//----- (080551DC) --------------------------------------------------------
void __cdecl scoped_profile::~scoped_profile(scoped_profile *const this)
{
  int v1;

  this->_vptr.scoped_profile = (int (**)(...))off_81454D8;
  v1 = SDL_GetTicks();
  ErrorLog(this->id, v1 - this->start);
  operator delete(this);
}



//----- (08055230) --------------------------------------------------------
void __cdecl ActNpc300(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;

  if ( !npc->act_no )
  {
    npc->act_no = 1;
    npc->y += 3072;
  }
  if ( ++npc->ani_wait % 8 == 1 )
  {
    v1 = npc->y + 4096;
    v2 = npc->x;
    v3 = Random(-8, 8);
    SetCaret(v2 + (v3 << 9), v1, 13, 1);
  }
  npc->rect.left = 192;
  npc->rect.top = 80;
  npc->rect.right = 208;
  npc->rect.bottom = 96;
}
/* Orphan comments:
TODO
*/

//----- (0805530D) --------------------------------------------------------
void __cdecl ActNpc301(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  RECT rect[8];
  int dir;
  RECT *v6;

  qmemcpy(rect, ActNpc301(NPCHAR *)::C.0, sizeof(rect));
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_18;
  }
  else
  {
    npc->act_no = 1;
    npc->count1 = npc->direct;
  }
  npc->xm = 2 * GetCos(npc->count1);
  npc->ym = 2 * GetSin(npc->count1);
  npc->y += npc->ym;
  npc->x += npc->xm;
  dir = (unsigned __int8)GetArktan(npc->x - x, npc->y - y);
  if ( npc->count1 <= dir )
  {
    if ( dir - npc->count1 > 127 )
      v3 = npc->count1 - 1;
    else
      v3 = npc->count1 + 1;
    npc->count1 = v3;
  }
  else
  {
    if ( npc->count1 - dir > 127 )
      v2 = npc->count1 + 1;
    else
      v2 = npc->count1 - 1;
    npc->count1 = v2;
  }
  if ( npc->count1 > 255 )
    npc->count1 -= 256;
  if ( npc->count1 < 0 )
    npc->count1 += 256;
LABEL_18:
  if ( ++npc->ani_wait > 2 )
  {
    npc->ani_wait = 0;
    SetCaret(npc->x, npc->y, 7, 4);
  }
  npc->ani_no = (npc->count1 + 16) / 32;
  if ( npc->ani_no > 7 )
    npc->ani_no = 7;
  npc->rect = *(RECT *)(&(&v6)[4 * npc->ani_no - 2] - 1);
}

//----- (0805554B) --------------------------------------------------------
void __cdecl ActNpc302(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int n;

  v1 = npc->act_no;
  if ( v1 != 20 )
  {
    if ( v1 <= 20 )
    {
      if ( v1 )
      {
        if ( v1 == 10 )
        {
          npc->x = x;
          npc->y = y - 0x4000;
        }
      }
      return;
    }
    if ( v1 == 100 )
    {
      npc->act_no = 101;
      if ( npc->direct )
      {
        for ( n = 170; n <= 511; ++n )
        {
          if ( (gNPC[n].cond & 0x80u) != 0 && gNPC[n].code_event == npc->direct )
          {
            npc->pNpc = &gNPC[n];
            break;
          }
        }
        if ( n == 512 )
        {
          npc->cond = 0;
          return;
        }
      }
      else
      {
        npc->pNpc = gBoss;
      }
    }
    else if ( v1 != 101 )
    {
      if ( v1 == 30 )
      {
        npc->x = x;
        npc->y = y + 40960;
      }
      return;
    }
    npc->x = (x + npc->pNpc->x) / 2;
    npc->y = (y + npc->pNpc->y) / 2;
    return;
  }
  v2 = npc->direct;
  if ( v2 == 1 )
  {
    npc->y -= 1024;
  }
  else if ( v2 > 1 )
  {
    if ( v2 == 2 )
    {
      npc->x += 1024;
    }
    else if ( v2 == 3 )
    {
      npc->y += 1024;
    }
  }
  else if ( !v2 )
  {
    npc->x -= 1024;
  }
  x = npc->x;
  y = npc->y;
}

//----- (0805574C) --------------------------------------------------------
void __cdecl ActNpc303(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  RECT *v3;
  RECT rcRight[2];
  RECT rcLeft[2];

  rcLeft[0].left = 216;
  rcLeft[0].top = 152;
  rcLeft[0].right = 232;
  rcLeft[0].bottom = 168;
  rcLeft[1].left = 232;
  rcLeft[1].top = 152;
  rcLeft[1].right = 248;
  rcLeft[1].bottom = 168;
  rcRight[0].left = 216;
  rcRight[0].top = 168;
  rcRight[0].right = 232;
  rcRight[0].bottom = 184;
  rcRight[1].left = 232;
  rcRight[1].top = 168;
  rcRight[1].right = 248;
  rcRight[1].bottom = 184;
  if ( npc->pNpc )
  {
    if ( npc->pNpc->direct )
    {
      npc->direct = 2;
      v1 = npc->pNpc->x + 4096;
    }
    else
    {
      npc->direct = 0;
      v1 = npc->pNpc->x - 4096;
    }
    npc->x = v1;
    npc->y = npc->pNpc->y;
    npc->ani_no = 0;
    if ( npc->pNpc->ani_no == 3 || npc->pNpc->ani_no == 5 )
      npc->y -= 512;
    if ( npc->direct )
    {
      v2 = npc;
      v3 = &rcRight[npc->ani_no];
    }
    else
    {
      v2 = npc;
      v3 = &rcLeft[npc->ani_no];
    }
    npc->rect.left = v3->left;
    v2->rect.top = v3->top;
    v2->rect.right = v3->right;
    v2->rect.bottom = v3->bottom;
  }
}

//----- (080558DE) --------------------------------------------------------
void __cdecl ActNpc304(NPCHAR_0 *npc)
{
  RECT *v1;
  RECT rc[4];

  rc[0].left = 0;
  rc[0].top = 176;
  rc[0].right = 24;
  rc[0].bottom = 192;
  rc[1].left = 24;
  rc[1].top = 176;
  rc[1].right = 48;
  rc[1].bottom = 192;
  rc[2].left = 48;
  rc[2].top = 176;
  rc[2].right = 72;
  rc[2].bottom = 192;
  rc[3].left = 72;
  rc[3].top = 176;
  rc[3].right = 96;
  rc[3].bottom = 192;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->y += 5120;
      goto LABEL_3;
    case 1:
LABEL_3:
      npc->ani_no = 0;
      break;
    case 0xA:
      npc->ani_no = 1;
      break;
    case 0x14:
      npc->act_no = 21;
      npc->ani_no = 2;
      goto LABEL_6;
    case 0x15:
LABEL_6:
      if ( ++npc->ani_wait > 10 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 3 )
        npc->ani_no = 2;
      break;
    default:
      break;
  }
  v1 = &rc[npc->ani_no];
  npc->rect.left = v1->left;
  npc->rect.top = v1->top;
  npc->rect.right = v1->right;
  npc->rect.bottom = v1->bottom;
}

//----- (08055A28) --------------------------------------------------------
void __cdecl ActNpc305(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  RECT *v3;
  RECT rcRight[2];
  RECT rcLeft[2];
  RECT *v6;

  rcLeft[0].left = 160;
  rcLeft[0].top = 144;
  rcLeft[0].right = 176;
  rcLeft[0].bottom = 160;
  rcLeft[1].left = 176;
  rcLeft[1].top = 144;
  rcLeft[1].right = 192;
  rcLeft[1].bottom = 160;
  rcRight[0].left = 160;
  rcRight[0].top = 160;
  rcRight[0].right = 176;
  rcRight[0].bottom = 176;
  rcRight[1].left = 176;
  rcRight[1].top = 160;
  rcRight[1].right = 192;
  rcRight[1].bottom = 176;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_9;
  }
  else
  {
    npc->act_no = 1;
    npc->y -= 0x2000;
    npc->ani_wait = Random(0, 6);
  }
  if ( ++npc->ani_wait > 6 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 1 )
    npc->ani_no = 0;
LABEL_9:
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (RECT *)&(&v6)[4 * npc->ani_no - 1];
  }
  else
  {
    v2 = npc;
    v3 = (RECT *)(&v6 + 4 * npc->ani_no - 8);
  }
  npc->rect.left = v3->left;
  v2->rect.top = v3->top;
  v2->rect.right = v3->right;
  v2->rect.bottom = v3->bottom;
}

//----- (08055B93) --------------------------------------------------------
void __cdecl ActNpc306(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  RECT *v3;
  RECT rcRight[2];
  RECT rcLeft[2];
  RECT *v6;

  rcLeft[0].left = 240;
  rcLeft[0].top = 96;
  rcLeft[0].right = 280;
  rcLeft[0].bottom = 128;
  rcLeft[1].left = 280;
  rcLeft[1].top = 96;
  rcLeft[1].right = 320;
  rcLeft[1].bottom = 128;
  rcRight[0].left = 160;
  rcRight[0].top = 152;
  rcRight[0].right = 200;
  rcRight[0].bottom = 184;
  rcRight[1].left = 200;
  rcRight[1].top = 152;
  rcRight[1].right = 240;
  rcRight[1].bottom = 184;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    if ( Random(0, 120) == 10 )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
      npc->ani_no = 1;
    }
    goto LABEL_9;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_9;
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->ani_wait = 0;
    npc->y += 2048;
    goto LABEL_5;
  }
  if ( ++npc->act_wait > 8 )
  {
    npc->act_no = 1;
    npc->ani_no = 0;
  }
LABEL_9:
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (RECT *)&(&v6)[4 * npc->ani_no - 1];
  }
  else
  {
    v2 = npc;
    v3 = (RECT *)(&v6 + 4 * npc->ani_no - 8);
  }
  npc->rect.left = v3->left;
  v2->rect.top = v3->top;
  v2->rect.right = v3->right;
  v2->rect.bottom = v3->bottom;
}

//----- (08055D26) --------------------------------------------------------
void __cdecl ActNpc307(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  RECT *v3;
  RECT rcRight[2];
  RECT rcLeft[2];
  RECT *v6;

  rcLeft[0].left = 0;
  rcLeft[0].top = 32;
  rcLeft[0].right = 16;
  rcLeft[0].bottom = 48;
  rcLeft[1].left = 16;
  rcLeft[1].top = 32;
  rcLeft[1].right = 32;
  rcLeft[1].bottom = 48;
  rcRight[0].left = 0;
  rcRight[0].top = 48;
  rcRight[0].right = 16;
  rcRight[0].bottom = 64;
  rcRight[1].left = 16;
  rcRight[1].top = 48;
  rcRight[1].right = 32;
  rcRight[1].bottom = 64;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    if ( Random(0, 160) == 1 )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
      npc->ani_no = 1;
    }
    goto LABEL_9;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_9;
    npc->x += 512;
    npc->y -= 1024;
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->ani_wait = 0;
    goto LABEL_5;
  }
  if ( ++npc->act_wait > 12 )
  {
    npc->act_no = 1;
    npc->ani_no = 0;
  }
LABEL_9:
  if ( x >= npc->x )
    npc->direct = 2;
  else
    npc->direct = 0;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (RECT *)&(&v6)[4 * npc->ani_no - 1];
  }
  else
  {
    v2 = npc;
    v3 = (RECT *)(&v6 + 4 * npc->ani_no - 8);
  }
  npc->rect.left = v3->left;
  v2->rect.top = v3->top;
  v2->rect.right = v3->right;
  v2->rect.bottom = v3->bottom;
}

//----- (08055EF5) --------------------------------------------------------
void __cdecl ActNpc308(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  RECT *v2;
  RECT rcRight[2];
  RECT rcLeft[2];
  unsigned __int8 deg;
  RECT *v6;

  rcLeft[0].left = 128;
  rcLeft[0].top = 112;
  rcLeft[0].right = 144;
  rcLeft[0].bottom = 128;
  rcLeft[1].left = 144;
  rcLeft[1].top = 112;
  rcLeft[1].right = 160;
  rcLeft[1].bottom = 128;
  rcRight[0].left = 128;
  rcRight[0].top = 128;
  rcRight[0].right = 144;
  rcRight[0].bottom = 144;
  rcRight[1].left = 144;
  rcRight[1].top = 128;
  rcRight[1].right = 160;
  rcRight[1].bottom = 144;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( x < npc->x + 0x1E000 && x > npc->x - 0x1E000 && y < npc->y + 0x18000 && y > npc->y - 0x18000 )
        npc->act_no = 10;
      break;
    case 0xA:
      npc->act_no = 11;
      npc->act_wait = 0;
      npc->xm2 = 0;
      npc->ym2 = 0;
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
      goto LABEL_11;
    case 0xB:
LABEL_11:
      if ( ++npc->act_wait > 50 )
        npc->act_no = 20;
      ++npc->ani_wait;
      if ( npc->act_wait > 1 )
      {
        npc->ani_wait = 0;
        if ( ++npc->ani_no > 1 )
          npc->ani_no = 0;
      }
      if ( x > npc->x + 0x28000 || x < npc->x - 0x28000 || y > npc->y + 0x1E000 || y < npc->y - 0x1E000 )
        npc->act_no = 0;
      break;
    case 0x14:
      npc->act_no = 21;
      npc->act_wait = 0;
      deg = GetArktan(npc->x - x, npc->y - y);
      deg += Random(-3, 3);
      npc->ym2 = 2 * GetSin(deg);
      npc->xm2 = 2 * GetCos(deg);
      if ( npc->xm2 >= 0 )
        npc->direct = 2;
      else
        npc->direct = 0;
      goto LABEL_24;
    case 0x15:
LABEL_24:
      if ( npc->xm2 < 0 && npc->flag & 1 )
      {
        npc->direct = 2;
        npc->xm2 = -npc->xm2;
      }
      if ( npc->xm2 > 0 && npc->flag & 4 )
      {
        npc->direct = 0;
        npc->xm2 = -npc->xm2;
      }
      if ( npc->ym2 < 0 && npc->flag & 2 )
        npc->ym2 = -npc->ym2;
      if ( npc->ym2 > 0 && npc->flag & 8 )
        npc->ym2 = -npc->ym2;
      if ( npc->flag & 0x100 )
        npc->ym2 = -512;
      npc->x += npc->xm2;
      npc->y += npc->ym2;
      if ( ++npc->act_wait > 50 )
        npc->act_no = 10;
      if ( ++npc->ani_no > 1 )
        npc->ani_no = 0;
      break;
    default:
      break;
  }
  if ( npc->direct )
  {
    v1 = npc;
    v2 = (RECT *)(&(&v6)[4 * npc->ani_no - 1] - 1);
  }
  else
  {
    v1 = npc;
    v2 = (RECT *)(&v6 + 4 * npc->ani_no - 9);
  }
  npc->rect.left = v2->left;
  v1->rect.top = v2->top;
  v1->rect.right = v2->right;
  v1->rect.bottom = v2->bottom;
}

//----- (08056375) --------------------------------------------------------
void __cdecl ActNpc309(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  NPCHAR_0 *v4;
  RECT *v5;
  RECT rcRight[2];
  RECT rcLeft[2];

  rcLeft[0].left = 0;
  rcLeft[0].top = 0;
  rcLeft[0].right = 16;
  rcLeft[0].bottom = 16;
  rcLeft[1].left = 16;
  rcLeft[1].top = 0;
  rcLeft[1].right = 32;
  rcLeft[1].bottom = 16;
  rcRight[0].left = 0;
  rcRight[0].top = 16;
  rcRight[0].right = 16;
  rcRight[0].bottom = 32;
  rcRight[1].left = 16;
  rcRight[1].top = 16;
  rcRight[1].right = 32;
  rcRight[1].bottom = 32;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_9:
    if ( npc->direct )
    {
      if ( x >= npc->x + 0x24000 || x <= npc->x + 0x22000 )
        return;
      npc->act_no = 10;
    }
    else
    {
      if ( x <= npc->x - 0x24000 || x >= npc->x - 0x22000 )
        return;
      npc->act_no = 10;
    }
    goto LABEL_50;
  }
  if ( v1 > 1 )
  {
    if ( v1 == 10 )
    {
      npc->act_no = 11;
      npc->bits |= 0x20u;
      npc->damage = 5;
    }
    else if ( v1 != 11 )
    {
      goto LABEL_50;
    }
    if ( npc->x <= x )
      npc->direct = 2;
    else
      npc->direct = 0;
    if ( npc->direct )
      v2 = npc->xm2 + 16;
    else
      v2 = npc->xm2 - 16;
    npc->xm2 = v2;
    if ( npc->y <= y )
      v3 = npc->ym2 + 16;
    else
      v3 = npc->ym2 - 16;
    npc->ym2 = v3;
    if ( npc->xm2 < 0 && npc->flag & 1 )
      npc->xm2 = -npc->xm2;
    if ( npc->xm2 > 0 && npc->flag & 4 )
      npc->xm2 = -npc->xm2;
    if ( npc->ym2 < 0 && npc->flag & 2 )
      npc->ym2 = -npc->ym2;
    if ( npc->ym2 > 0 && npc->flag & 8 )
      npc->ym2 = -npc->ym2;
    if ( npc->xm2 < -1535 )
      npc->xm2 = -1535;
    if ( npc->xm2 > 1535 )
      npc->xm2 = 1535;
    if ( npc->ym2 < -1535 )
      npc->ym2 = -1535;
    if ( npc->ym2 > 1535 )
      npc->ym2 = 1535;
    npc->x += npc->xm2;
    npc->y += npc->ym2;
    if ( ++npc->ani_wait > 1 )
    {
      npc->ani_wait = 0;
      ++npc->ani_no;
    }
    if ( npc->ani_no > 1 )
      npc->ani_no = 0;
    goto LABEL_50;
  }
  if ( !v1 )
  {
    npc->act_no = 1;
    goto LABEL_9;
  }
LABEL_50:
  if ( npc->direct )
  {
    v4 = npc;
    v5 = &rcRight[npc->ani_no];
  }
  else
  {
    v4 = npc;
    v5 = &rcLeft[npc->ani_no];
  }
  npc->rect.left = v5->left;
  v4->rect.top = v5->top;
  v4->rect.right = v5->right;
  v4->rect.bottom = v5->bottom;
  if ( npc->life <= 996 )
  {
    npc->code_char = 316;
    npc->act_no = 0;
  }
}

//----- (08056750) --------------------------------------------------------
void __cdecl ActNpc310(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  RECT *v2;
  RECT rcRight[5];
  RECT rcLeft[5];
  RECT *v5;

  qmemcpy(rcLeft, ActNpc310(NPCHAR *)::C.7, sizeof(rcLeft));
  qmemcpy(rcRight, ActNpc310(NPCHAR *)::C.8, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->bits &= 0xFFDFu;
      npc->bits |= 4u;
      npc->damage = 0;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
      npc->ani_no = 0;
      if ( x > npc->x - 0x10000 && x < npc->x + 0x10000 && y > npc->y - 0x10000 && y < npc->y + 0x2000 )
        npc->act_no = 10;
      break;
    case 0xA:
      npc->xm = 0;
      npc->act_no = 11;
      npc->act_wait = 0;
      npc->bits &= 0xFFDFu;
      npc->bits |= 4u;
      npc->damage = 0;
      npc->ani_no = 0;
      goto LABEL_12;
    case 0xB:
LABEL_12:
      if ( ++npc->act_wait > 30 )
        npc->act_no = 20;
      break;
    case 0x14:
      npc->act_no = 21;
      npc->act_wait = 0;
      npc->bits &= 0xFFFBu;
      npc->bits |= 0x20u;
      npc->damage = 0;
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
      goto LABEL_17;
    case 0x15:
LABEL_17:
      if ( npc->direct )
        npc->xm = 1024;
      else
        npc->xm = -1024;
      if ( ++npc->ani_wait > 3 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 1 )
        npc->ani_no = 0;
      if ( ++npc->act_wait > 50 )
        npc->act_no = 10;
      if ( npc->x < x + 20480 && npc->x > x - 20480 )
      {
        npc->ym = -768;
        npc->xm /= 2;
        npc->ani_no = 2;
        npc->act_no = 30;
        PlaySoundObject(30, 1);
      }
      break;
    case 0x1E:
      if ( npc->ym >= -127 )
      {
        npc->act_no = 31;
        npc->ani_wait = 0;
        npc->ani_no = 3;
        npc->damage = 9;
      }
      break;
    case 0x1F:
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        npc->ani_no = 4;
      }
      if ( npc->flag & 8 )
      {
        npc->act_no = 32;
        npc->act_wait = 0;
        npc->xm = 0;
        npc->damage = 3;
      }
      break;
    case 0x20:
      if ( ++npc->act_wait > 30 )
      {
        npc->act_no = 10;
        npc->damage = 0;
      }
      break;
    default:
      break;
  }
  npc->ym += 32;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v1 = npc;
    v2 = (RECT *)(&v5 + 4 * npc->ani_no - 40);
  }
  else
  {
    v1 = npc;
    v2 = (RECT *)(&v5 + 4 * npc->ani_no - 20);
  }
  npc->rect.left = v2->left;
  v1->rect.top = v2->top;
  v1->rect.right = v2->right;
  v1->rect.bottom = v2->bottom;
  if ( npc->life <= 996 )
  {
    npc->code_char = 316;
    npc->act_no = 0;
  }
}

//----- (08056C40) --------------------------------------------------------
void __cdecl ActNpc311(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  RECT *v2;
  RECT rcRight[7];
  RECT rcLeft[7];
  RECT *v5;

  qmemcpy(rcLeft, ActNpc311(NPCHAR *)::C.9, sizeof(rcLeft));
  qmemcpy(rcRight, ActNpc311(NPCHAR *)::C.10, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( npc->direct )
      {
        if ( x > npc->x && x < npc->x + 0x28000 && y > npc->y - 0x14000 && y < npc->y + 0x14000 )
          npc->act_no = 10;
      }
      else if ( x > npc->x - 0x28000 && x < npc->x && y > npc->y - 0x14000 && y < npc->y + 0x14000 )
      {
        npc->act_no = 10;
      }
      break;
    case 0xA:
      npc->act_no = 11;
      goto LABEL_15;
    case 0xB:
LABEL_15:
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
      if ( x <= npc->x - 0x1C000 || x >= npc->x + 0x1C000 || y <= npc->y - 0x1000 )
      {
        npc->ani_no = 4;
        npc->count1 = 1;
      }
      else
      {
        npc->ani_no = 1;
        npc->count1 = 0;
      }
      if ( ++npc->act_wait > 10 )
        npc->act_no = 20;
      break;
    case 0x14:
      npc->act_no = 21;
      npc->act_wait = 0;
      goto LABEL_26;
    case 0x15:
LABEL_26:
      if ( npc->count1 )
      {
        if ( ++npc->ani_no > 5 )
          npc->ani_no = 4;
      }
      else if ( ++npc->ani_no > 2 )
      {
        npc->ani_no = 1;
      }
      if ( ++npc->act_wait > 30 )
        npc->act_no = 30;
      break;
    case 0x1E:
      npc->act_no = 31;
      npc->act_wait = 0;
      if ( npc->count1 )
      {
        if ( npc->direct )
          SetNpChar(312, npc->x, npc->y, 1536, -1536, 2, 0, 256);
        else
          SetNpChar(312, npc->x, npc->y, -1536, -1536, 0, 0, 256);
        npc->ani_no = 6;
      }
      else
      {
        if ( npc->direct )
          SetNpChar(312, npc->x, npc->y, 1536, 0, 2, 0, 256);
        else
          SetNpChar(312, npc->x, npc->y, -1536, 0, 0, 0, 256);
        npc->ani_no = 3;
      }
      goto LABEL_42;
    case 0x1F:
LABEL_42:
      if ( ++npc->act_wait > 30 )
      {
        npc->act_no = 40;
        npc->act_wait = Random(0, 100);
      }
      break;
    case 0x28:
      npc->ani_no = 0;
      if ( ++npc->act_wait > 150 )
        npc->act_no = 10;
      if ( x < npc->x - 0x2C000 || x > npc->x + 0x2C000 || y < npc->y - 0x1E000 || y > npc->y + 0x1E000 )
      {
        npc->act_no = 40;
        npc->act_wait = 0;
      }
      break;
    default:
      break;
  }
  if ( npc->direct )
  {
    v1 = npc;
    v2 = (RECT *)(&v5 + 4 * npc->ani_no - 56);
  }
  else
  {
    v1 = npc;
    v2 = (RECT *)(&v5 + 4 * npc->ani_no - 28);
  }
  npc->rect.left = v2->left;
  v1->rect.top = v2->top;
  v1->rect.right = v2->right;
  v1->rect.bottom = v2->bottom;
  if ( npc->life <= 992 )
  {
    npc->code_char = 316;
    npc->act_no = 0;
  }
}

//----- (080571E7) --------------------------------------------------------
void __cdecl ActNpc312(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  RECT *v2;
  RECT rcRight[5];
  RECT rcLeft[5];
  RECT *v5;

  qmemcpy(rcLeft, ActNpc312(NPCHAR *)::C.11, sizeof(rcLeft));
  qmemcpy(rcRight, ActNpc312(NPCHAR *)::C.12, sizeof(rcRight));
  if ( npc->act_no > 0 && npc->act_no <= 19 && npc->flag & 0xFF )
    npc->act_no = 20;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->act_wait = 0;
      if ( npc->xm >= 0 )
        npc->direct = 2;
      else
        npc->direct = 0;
      if ( npc->ym >= 0 )
        npc->ani_no = 2;
      else
        npc->ani_no = 0;
      goto LABEL_12;
    case 1:
LABEL_12:
      if ( ++npc->act_wait == 4 )
        npc->bits &= 0xFFF7u;
      if ( npc->act_wait > 10 )
        npc->act_no = 10;
      goto LABEL_27;
    case 0xA:
      npc->act_no = 11;
      npc->ani_wait = 0;
      npc->xm = 3 * npc->xm / 4;
      npc->ym = 3 * npc->ym / 4;
      goto LABEL_17;
    case 0xB:
LABEL_17:
      npc->ym += 32;
      if ( ++npc->ani_wait > 10 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 4 )
        npc->ani_no = 4;
      goto LABEL_27;
    case 0x14:
      npc->act_no = 21;
      npc->act_wait = 0;
      npc->xm = 0;
      npc->ym = 0;
      npc->damage = 0;
      goto LABEL_22;
    case 0x15:
LABEL_22:
      if ( ++npc->act_wait > 30 )
        npc->act_no = 30;
      goto LABEL_27;
    case 0x1E:
      npc->act_no = 31;
      npc->act_wait = 0;
      goto LABEL_25;
    case 0x1F:
LABEL_25:
      if ( ++npc->act_wait <= 30 )
        goto LABEL_27;
      npc->cond = 0;
      break;
    default:
LABEL_27:
      if ( npc->ym > 1535 )
        npc->ym = 1535;
      npc->x += npc->xm;
      npc->y += npc->ym;
      if ( npc->direct )
      {
        v1 = npc;
        v2 = (RECT *)(&v5 + 4 * npc->ani_no - 40);
      }
      else
      {
        v1 = npc;
        v2 = (RECT *)(&v5 + 4 * npc->ani_no - 20);
      }
      npc->rect.left = v2->left;
      v1->rect.top = v2->top;
      v1->rect.right = v2->right;
      v1->rect.bottom = v2->bottom;
      if ( npc->act_no == 31 )
      {
        if ( npc->act_wait / 2 & 1 )
        {
          npc->rect.left = 0;
          npc->rect.right = 0;
        }
      }
      break;
  }
}

//----- (0805753F) --------------------------------------------------------
void __cdecl ActNpc313(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  unsigned __int16 v5;
  NPCHAR_0 *v6;
  RECT *v7;
  RECT rcRight[14];
  RECT rcLeft[14];
  RECT *v10;

  qmemcpy(rcLeft, ActNpc313(NPCHAR *)::C.13, sizeof(rcLeft));
  qmemcpy(rcRight, ActNpc313(NPCHAR *)::C.14, sizeof(rcRight));
  v1 = npc->act_no;
  if ( v1 == 210 )
  {
    if ( ++npc->ani_no > 7 )
      npc->ani_no = 6;
    if ( npc->xm < 0 && npc->flag & 1 )
      npc->act_no = 220;
    if ( npc->xm > 0 && npc->flag & 4 )
      npc->act_no = 220;
    goto LABEL_127;
  }
  if ( v1 > 210 )
  {
    if ( v1 == 310 )
    {
      npc->ani_no = 2;
      if ( ++npc->act_wait > 4 )
      {
        npc->act_no = 320;
        npc->ani_no = 12;
        npc->ym = -2048;
        PlaySoundObject(25, 1);
        npc->bits |= 8u;
        npc->bits &= 0xFFDFu;
        npc->bits |= 4u;
        npc->damage = 10;
      }
      goto LABEL_127;
    }
    if ( v1 > 310 )
    {
      if ( v1 != 331 )
      {
        if ( v1 > 331 )
        {
          if ( v1 == 500 )
          {
            npc->bits &= 0xFFDFu;
            npc->act_no = 501;
            npc->act_wait = 0;
            npc->ani_no = 8;
            npc->tgt_x = npc->x;
            npc->damage = 0;
            DeleteNpCharCode(315, 1);
          }
          else if ( v1 != 501 )
          {
            goto LABEL_127;
          }
          npc->ym += 32;
          ++npc->act_wait;
          if ( npc->act_wait & 1 )
            v4 = npc->tgt_x;
          else
            v4 = npc->tgt_x + 512;
          npc->x = v4;
          goto LABEL_127;
        }
        if ( v1 == 320 )
        {
          if ( ++npc->ani_no > 13 )
            npc->ani_no = 12;
          if ( npc->y <= 0x1FFF )
            npc->act_no = 330;
          goto LABEL_127;
        }
        if ( v1 != 330 )
          goto LABEL_127;
        npc->ym = 0;
        npc->act_no = 331;
        npc->act_wait = 0;
        SetQuake(16);
        PlaySoundObject(26, 1);
      }
      if ( ++npc->ani_no > 13 )
        npc->ani_no = 12;
      if ( !(++npc->act_wait % 6) )
      {
        v3 = Random(4, 16);
        SetNpChar(315, v3 << 13, 0, 0, 0, 0, 0, 256);
      }
      if ( npc->act_wait > 30 )
      {
        npc->count1 = 0;
        npc->act_no = 130;
        npc->bits |= 0x20u;
        npc->bits &= 0xFFFBu;
        npc->damage = 3;
      }
      goto LABEL_127;
    }
    if ( v1 != 221 )
    {
      if ( v1 > 221 )
      {
        if ( v1 == 300 )
        {
          npc->act_no = 301;
          npc->ani_no = 9;
          if ( npc->x <= x )
            npc->direct = 2;
          else
            npc->direct = 0;
        }
        else if ( v1 != 301 )
        {
          goto LABEL_127;
        }
        if ( ++npc->ani_no > 11 )
          npc->ani_no = 9;
        if ( npc->direct )
          npc->xm = 1024;
        else
          npc->xm = -1024;
        if ( x > npc->x - 2048 && x < npc->x + 2048 )
        {
          npc->act_no = 310;
          npc->act_wait = 0;
          npc->ani_no = 2;
          npc->xm = 0;
        }
        goto LABEL_127;
      }
      if ( v1 != 220 )
        goto LABEL_127;
      npc->act_no = 221;
      npc->act_wait = 0;
      SetQuake(16);
      PlaySoundObject(26, 1);
      npc->damage = 4;
    }
    if ( ++npc->ani_no > 7 )
      npc->ani_no = 6;
    if ( !(++npc->act_wait % 6) )
    {
      v2 = Random(4, 16);
      SetNpChar(314, v2 << 13, 0x2000, 0, 0, 0, 0, 256);
    }
    if ( npc->act_wait > 30 )
    {
      npc->count1 = 0;
      npc->act_no = 130;
      npc->bits |= 0x20u;
      npc->bits &= 0xFFFBu;
      npc->damage = 3;
    }
    goto LABEL_127;
  }
  if ( v1 == 110 )
  {
LABEL_47:
    npc->damage = 1;
    if ( npc->x <= x )
      npc->direct = 2;
    else
      npc->direct = 0;
    npc->ani_no = 0;
    if ( ++npc->act_wait > 4 )
    {
      npc->act_wait = 0;
      npc->act_no = 120;
      if ( ++npc->count2 > 12 )
      {
        npc->count2 = 0;
        npc->act_no = 300;
      }
    }
    goto LABEL_127;
  }
  if ( v1 > 110 )
  {
    if ( v1 == 130 )
    {
      npc->ym += 128;
      if ( npc->y > 0x10000 )
        npc->bits &= 0xFFF7u;
      if ( npc->xm < 0 && npc->flag & 1 )
        npc->xm = -npc->xm;
      if ( npc->xm > 0 && npc->flag & 4 )
        npc->xm = -npc->xm;
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
      if ( npc->ym >= -512 )
      {
        if ( npc->ym <= 512 )
          npc->ani_no = 0;
        else
          npc->ani_no = 4;
      }
      else
      {
        npc->ani_no = 3;
      }
      if ( npc->flag & 8 )
      {
        npc->act_no = 140;
        npc->act_wait = 0;
        npc->ani_no = 2;
        npc->xm = 0;
      }
      if ( npc->count1 > 4 && y < npc->y + 2048 )
      {
        npc->act_no = 200;
        npc->act_wait = 0;
        npc->xm = 0;
        npc->ym = 0;
      }
    }
    else if ( v1 > 130 )
    {
      if ( v1 == 140 )
      {
        npc->ani_no = 2;
        if ( ++npc->act_wait > 4 )
          npc->act_no = 110;
      }
      else if ( v1 == 200 )
      {
        npc->ani_no = 5;
        if ( ++npc->act_wait > 10 )
        {
          npc->act_no = 210;
          npc->ani_no = 6;
          if ( npc->direct )
            npc->xm = 1535;
          else
            npc->xm = -1535;
          PlaySoundObject(25, 1);
          npc->bits &= 0xFFDFu;
          npc->bits |= 4u;
          npc->damage = 10;
        }
      }
    }
    else if ( v1 == 120 )
    {
      npc->ani_no = 2;
      if ( ++npc->act_wait > 4 )
      {
        npc->act_no = 130;
        npc->ani_no = 3;
        npc->xm = 2 * Random(-512, 512);
        npc->ym = -2048;
        PlaySoundObject(30, 1);
        ++npc->count1;
      }
    }
  }
  else
  {
    if ( v1 == 1 )
    {
LABEL_37:
      npc->ym += 64;
      if ( Random(0, 120) == 10 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      if ( npc->x - 0x4000 < x && npc->x + 0x4000 > x )
      {
        if ( npc->x <= x )
          npc->direct = 2;
        else
          npc->direct = 0;
      }
      goto LABEL_127;
    }
    if ( v1 <= 1 )
    {
      if ( v1 )
        goto LABEL_127;
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      npc->y += 2048;
      goto LABEL_37;
    }
    if ( v1 != 2 )
    {
      if ( v1 != 100 )
        goto LABEL_127;
      npc->act_no = 110;
      npc->act_wait = 0;
      npc->count1 = 0;
      npc->bits |= 0x20u;
      goto LABEL_47;
    }
    if ( ++npc->act_wait > 8 )
    {
      npc->act_no = 1;
      npc->ani_no = 0;
    }
  }
LABEL_127:
  if ( npc->act_no > 100 && npc->act_no <= 499 && npc->act_no != 210 && npc->act_no != 320 )
  {
    if ( (unsigned __int8)IsActiveSomeBullet() )
    {
      npc->bits &= 0xFFDFu;
      v5 = npc->bits | 4;
    }
    else
    {
      npc->bits |= 0x20u;
      v5 = npc->bits & 0xFFFB;
    }
    npc->bits = v5;
  }
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v6 = npc;
    v7 = (RECT *)&(&v10)[4 * npc->ani_no - 7];
  }
  else
  {
    v6 = npc;
    v7 = (RECT *)(&v10 + 4 * npc->ani_no - 56);
  }
  npc->rect.left = v7->left;
  v6->rect.top = v7->top;
  v6->rect.right = v7->right;
  v6->rect.bottom = v7->bottom;
}

//----- (08058263) --------------------------------------------------------
void __cdecl ActNpc314(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  RECT rc[3];
  int i;
  RECT *v9;

  rc[0].left = 64;
  rc[0].top = 64;
  rc[0].right = 80;
  rc[0].bottom = 80;
  rc[1].left = 80;
  rc[1].top = 64;
  rc[1].right = 96;
  rc[1].bottom = 80;
  rc[2].left = 96;
  rc[2].top = 64;
  rc[2].right = 112;
  rc[2].bottom = 80;
  v1 = npc->act_no;
  switch ( v1 )
  {
    case 100:
      goto LABEL_5;
    case 110:
      npc->ym += 64;
      if ( npc->y > (gMap.length + 2) << 13 )
      {
        npc->cond = 0;
        return;
      }
      break;
    case 0:
      npc->count2 = 0;
      npc->act_no = 100;
      npc->bits |= 4u;
      npc->ani_no = Random(0, 2);
LABEL_5:
      npc->ym += 64;
      if ( npc->ym > 1792 )
        npc->ym = 1792;
      if ( npc->y > 0x10000 )
        npc->bits &= 0xFFF7u;
      if ( npc->flag & 8 )
      {
        npc->ym = -512;
        npc->act_no = 110;
        npc->bits |= 8u;
        PlaySoundObject(12, 1);
        SetQuake(10);
        for ( i = 0; i <= 1; ++i )
        {
          v2 = Random(-1536, 0);
          v3 = Random(-341, 341);
          v4 = npc->y + 0x2000;
          v5 = npc->x;
          v6 = Random(-12, 12);
          SetNpChar(4, v5 + (v6 << 9), v4, v3, v2, 0, 0, 256);
        }
      }
      break;
  }
  if ( ++npc->ani_wait > 6 )
  {
    ++npc->ani_wait;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 2 )
    npc->ani_no = 0;
  if ( y <= npc->y )
    npc->damage = 0;
  else
    npc->damage = 10;
  npc->y += npc->ym;
  npc->rect = *(RECT *)(&v9 + 4 * npc->ani_no - 13);
}

//----- (08058561) --------------------------------------------------------
void __cdecl ActNpc315(NPCHAR_0 *npc)
{
  int v1;
  unsigned __int16 v2;
  NPCHAR_0 *v3;
  RECT *v4;
  RECT rcRight[4];
  RECT rcLeft[4];
  RECT *v7;

  rcLeft[0].left = 128;
  rcLeft[0].top = 0;
  rcLeft[0].right = 144;
  rcLeft[0].bottom = 16;
  rcLeft[1].left = 160;
  rcLeft[1].top = 0;
  rcLeft[1].right = 176;
  rcLeft[1].bottom = 16;
  rcLeft[2].left = 176;
  rcLeft[2].top = 0;
  rcLeft[2].right = 192;
  rcLeft[2].bottom = 16;
  rcLeft[3].left = 192;
  rcLeft[3].top = 0;
  rcLeft[3].right = 208;
  rcLeft[3].bottom = 16;
  rcRight[0].left = 128;
  rcRight[0].top = 16;
  rcRight[0].right = 144;
  rcRight[0].bottom = 32;
  rcRight[1].left = 160;
  rcRight[1].top = 16;
  rcRight[1].right = 176;
  rcRight[1].bottom = 32;
  rcRight[2].left = 176;
  rcRight[2].top = 16;
  rcRight[2].right = 192;
  rcRight[2].bottom = 32;
  rcRight[3].left = 192;
  rcRight[3].top = 16;
  rcRight[3].right = 208;
  rcRight[3].bottom = 32;
  v1 = npc->act_no;
  if ( v1 == 110 )
  {
LABEL_13:
    if ( npc->x <= x )
      npc->direct = 2;
    else
      npc->direct = 0;
    npc->ani_no = 0;
    if ( ++npc->act_wait > 4 )
    {
      npc->act_wait = 0;
      npc->act_no = 120;
    }
    goto LABEL_38;
  }
  if ( v1 > 110 )
  {
    switch ( v1 )
    {
      case 130:
        npc->ym += 128;
        if ( npc->xm < 0 && npc->flag & 1 )
          npc->xm = -npc->xm;
        if ( npc->xm > 0 && npc->flag & 4 )
          npc->xm = -npc->xm;
        if ( npc->x <= x )
          npc->direct = 2;
        else
          npc->direct = 0;
        if ( npc->ym >= -512 )
        {
          if ( npc->ym <= 512 )
            npc->ani_no = 3;
          else
            npc->ani_no = 0;
        }
        else
        {
          npc->ani_no = 2;
        }
        if ( npc->flag & 8 )
        {
          npc->act_no = 140;
          npc->act_wait = 0;
          npc->ani_no = 1;
          npc->xm = 0;
        }
        break;
      case 140:
        npc->ani_no = 1;
        if ( ++npc->act_wait > 4 )
        {
          npc->act_no = 110;
          npc->bits |= 0x20u;
        }
        break;
      case 120:
        npc->ani_no = 1;
        if ( ++npc->act_wait > 4 )
        {
          npc->act_no = 130;
          npc->ani_no = 3;
          npc->xm = 2 * Random(-512, 512);
          npc->ym = -2048;
          PlaySoundObject(30, 1);
        }
        break;
    }
  }
  else
  {
    if ( v1 )
    {
      if ( v1 != 100 )
        goto LABEL_38;
      npc->act_no = 110;
      npc->act_wait = 0;
      npc->count1 = 0;
      npc->bits |= 0x20u;
      goto LABEL_13;
    }
    npc->ani_no = 3;
    npc->ym += 128;
    if ( npc->y > 0x10000 )
    {
      npc->act_no = 130;
      npc->bits &= 0xFFF7u;
    }
  }
LABEL_38:
  if ( npc->act_no > 100 )
  {
    if ( (unsigned __int8)IsActiveSomeBullet() )
    {
      npc->bits &= 0xFFDFu;
      v2 = npc->bits | 4;
    }
    else
    {
      npc->bits |= 0x20u;
      v2 = npc->bits & 0xFFFB;
    }
    npc->bits = v2;
  }
  if ( ++npc->count2 <= 300 )
  {
    if ( npc->ym > 1535 )
      npc->ym = 1535;
    npc->x += npc->xm;
    npc->y += npc->ym;
    if ( npc->direct )
    {
      v3 = npc;
      v4 = (RECT *)&(&v7)[4 * npc->ani_no - 2];
    }
    else
    {
      v3 = npc;
      v4 = (RECT *)&(&v7)[4 * npc->ani_no - 1];
    }
    npc->rect.left = v4->left;
    v3->rect.top = v4->top;
    v3->rect.right = v4->right;
    v3->rect.bottom = v4->bottom;
  }
  else
  {
    VanishNpChar(npc);
  }
}

//----- (08058A70) --------------------------------------------------------
void __cdecl ActNpc316(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  RECT *v3;
  RECT rcRight[3];
  RECT rcLeft[3];
  RECT *v6;

  rcLeft[0].left = 248;
  rcLeft[0].top = 32;
  rcLeft[0].right = 272;
  rcLeft[0].bottom = 56;
  rcLeft[1].left = 272;
  rcLeft[1].top = 32;
  rcLeft[1].right = 296;
  rcLeft[1].bottom = 56;
  rcLeft[2].left = 296;
  rcLeft[2].top = 32;
  rcLeft[2].right = 320;
  rcLeft[2].bottom = 56;
  rcRight[0].left = 248;
  rcRight[0].top = 56;
  rcRight[0].right = 272;
  rcRight[0].bottom = 80;
  rcRight[1].left = 272;
  rcRight[1].top = 56;
  rcRight[1].right = 296;
  rcRight[1].bottom = 80;
  rcRight[2].left = 296;
  rcRight[2].top = 56;
  rcRight[2].right = 320;
  rcRight[2].bottom = 80;
  v1 = npc->act_no;
  switch ( v1 )
  {
    case 1:
      if ( npc->flag & 8 )
      {
        npc->ani_no = 1;
        npc->ani_wait = 0;
        npc->act_no = 2;
        npc->act_wait = 0;
      }
      break;
    case 2:
      npc->xm = 8 * npc->xm / 9;
      if ( ++npc->ani_wait > 3 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 2 )
        npc->ani_no = 1;
      if ( ++npc->act_wait > 50 )
        npc->cond |= 8u;
      break;
    case 0:
      npc->bits &= 0xFFDFu;
      npc->bits &= 0xFFF7u;
      npc->damage = 0;
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->view.front = 6144;
      npc->view.back = 6144;
      npc->view.top = 6144;
      npc->ym = -512;
      if ( npc->direct )
        npc->xm = -256;
      else
        npc->xm = 256;
      PlaySoundObject(50, 1);
      break;
  }
  npc->ym += 32;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (RECT *)(&v6 + 4 * npc->ani_no - 24);
  }
  else
  {
    v2 = npc;
    v3 = (RECT *)(&v6 + 4 * npc->ani_no - 12);
  }
  npc->rect.left = v3->left;
  v2->rect.top = v3->top;
  v2->rect.right = v3->right;
  v2->rect.bottom = v3->bottom;
}

//----- (08058D7B) --------------------------------------------------------
void __cdecl ActNpc317(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  RECT *v2;
  RECT rcRight[4];
  RECT rcLeft[4];
  RECT *v5;

  rcLeft[0].left = 0;
  rcLeft[0].top = 80;
  rcLeft[0].right = 32;
  rcLeft[0].bottom = 120;
  rcLeft[1].left = 32;
  rcLeft[1].top = 80;
  rcLeft[1].right = 64;
  rcLeft[1].bottom = 120;
  rcLeft[2].left = 64;
  rcLeft[2].top = 80;
  rcLeft[2].right = 96;
  rcLeft[2].bottom = 120;
  rcLeft[3].left = 96;
  rcLeft[3].top = 80;
  rcLeft[3].right = 128;
  rcLeft[3].bottom = 120;
  rcRight[0].left = 0;
  rcRight[0].top = 120;
  rcRight[0].right = 32;
  rcRight[0].bottom = 160;
  rcRight[1].left = 32;
  rcRight[1].top = 120;
  rcRight[1].right = 64;
  rcRight[1].bottom = 160;
  rcRight[2].left = 64;
  rcRight[2].top = 120;
  rcRight[2].right = 96;
  rcRight[2].bottom = 160;
  rcRight[3].left = 96;
  rcRight[3].top = 120;
  rcRight[3].right = 128;
  rcRight[3].bottom = 160;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->y -= 4096;
      npc->tgt_x = npc->x;
      goto LABEL_3;
    case 1:
LABEL_3:
      npc->xm = 0;
      npc->act_no = 2;
      npc->ani_no = 0;
      npc->count1 = 0;
      goto LABEL_4;
    case 2:
LABEL_4:
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
      if ( ++npc->ani_wait > 40 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 1 )
        npc->ani_no = 0;
      if ( x > npc->x - 163840 && x < npc->x + 163840 && y > npc->y - 81920 && y < npc->y + 81920 && ++npc->count1 > 50 )
        npc->act_no = 10;
      break;
    case 0xA:
      npc->act_no = 11;
      npc->act_wait = 0;
      npc->ani_no = 2;
      SetNpChar(319, npc->x, npc->y, 0, 0, 0, npc, 256);
      goto LABEL_18;
    case 0xB:
LABEL_18:
      if ( ++npc->act_wait > 50 )
      {
        npc->act_wait = 0;
        npc->act_no = 12;
        npc->ani_no = 3;
        PlaySoundObject(39, 1);
      }
      break;
    case 0xC:
      if ( ++npc->act_wait > 20 )
        npc->act_no = 1;
      break;
    default:
      break;
  }
  npc->ym += 85;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v1 = npc;
    v2 = (RECT *)&(&v5)[4 * npc->ani_no - 2];
  }
  else
  {
    v1 = npc;
    v2 = (RECT *)&(&v5)[4 * npc->ani_no - 1];
  }
  npc->rect.left = v2->left;
  v1->rect.top = v2->top;
  v1->rect.right = v2->right;
  v1->rect.bottom = v2->bottom;
  if ( npc->life <= 936 )
  {
    npc->code_char = 318;
    npc->act_no = 0;
  }
}

//----- (0805918E) --------------------------------------------------------
void __cdecl ActNpc318(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  RECT *v3;
  RECT rcRight[3];
  RECT rcLeft[3];
  RECT *v6;

  rcLeft[0].left = 224;
  rcLeft[0].top = 80;
  rcLeft[0].right = 256;
  rcLeft[0].bottom = 120;
  rcLeft[1].left = 256;
  rcLeft[1].top = 80;
  rcLeft[1].right = 288;
  rcLeft[1].bottom = 120;
  rcLeft[2].left = 288;
  rcLeft[2].top = 80;
  rcLeft[2].right = 320;
  rcLeft[2].bottom = 120;
  rcRight[0].left = 224;
  rcRight[0].top = 120;
  rcRight[0].right = 256;
  rcRight[0].bottom = 160;
  rcRight[1].left = 256;
  rcRight[1].top = 120;
  rcRight[1].right = 288;
  rcRight[1].bottom = 160;
  rcRight[2].left = 288;
  rcRight[2].top = 120;
  rcRight[2].right = 320;
  rcRight[2].bottom = 160;
  v1 = npc->act_no;
  switch ( v1 )
  {
    case 1:
      if ( npc->flag & 8 )
      {
        npc->ani_no = 1;
        npc->ani_wait = 0;
        npc->act_no = 2;
        npc->act_wait = 0;
      }
      break;
    case 2:
      npc->xm = 8 * npc->xm / 9;
      if ( ++npc->ani_wait > 3 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 2 )
        npc->ani_no = 1;
      if ( ++npc->act_wait > 50 )
        npc->cond |= 8u;
      break;
    case 0:
      npc->bits &= 0xFFDFu;
      npc->bits &= 0xFFF7u;
      npc->bits &= 0xFFFEu;
      npc->damage = 0;
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ym = -512;
      if ( npc->direct )
        npc->xm = -64;
      else
        npc->xm = 64;
      PlaySoundObject(54, 1);
      break;
  }
  npc->ym += 32;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (RECT *)(&v6 + 4 * npc->ani_no - 24);
  }
  else
  {
    v2 = npc;
    v3 = (RECT *)(&v6 + 4 * npc->ani_no - 12);
  }
  npc->rect.left = v3->left;
  v2->rect.top = v3->top;
  v2->rect.right = v3->right;
  v2->rect.bottom = v3->bottom;
}

//----- (08059485) --------------------------------------------------------
void __cdecl ActNpc319(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  RECT rc[3];
  RECT *v4;

  rc[0].left = 16;
  rc[0].top = 0;
  rc[0].right = 32;
  rc[0].bottom = 16;
  rc[1].left = 16;
  rc[1].top = 0;
  rc[1].right = 32;
  rc[1].bottom = 16;
  rc[2].left = 96;
  rc[2].top = 80;
  rc[2].right = 112;
  rc[2].bottom = 96;
  v1 = npc->act_no;
  if ( v1 != 1 )
  {
    if ( v1 == 2 )
    {
      if ( ++npc->act_wait == 4 )
        npc->bits &= 0xFFF7u;
      npc->ym += 42;
      if ( npc->ym > 1535 )
        npc->ym = 1535;
      npc->x += npc->xm;
      npc->y += npc->ym;
      if ( npc->flag & 8 )
      {
        PlaySoundObject(12, 1);
        SetDestroyNpChar(npc->x, npc->y, 0, 3);
        npc->cond = 0;
      }
    }
    else if ( !v1 )
    {
      npc->y = npc->pNpc->y + 5120;
      if ( npc->pNpc->direct )
        v2 = npc->pNpc->x - 3584;
      else
        v2 = npc->pNpc->x + 3584;
      npc->x = v2;
      if ( npc->pNpc->code_char == 318 )
      {
        SetDestroyNpChar(npc->x, npc->y, 0, 3);
        npc->cond = 0;
        return;
      }
      if ( npc->pNpc->ani_no != 2 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ym = -1024;
        npc->y = npc->pNpc->y - 2048;
        if ( npc->pNpc->direct )
          npc->xm = 1024;
        else
          npc->xm = -1024;
      }
    }
  }
  if ( ++npc->ani_no > 2 )
    npc->ani_no = 0;
  npc->rect = (RECT)*((_OWORD *)&v4 + npc->ani_no - 3);
}

//----- (0805973C) --------------------------------------------------------
void __cdecl RGB(SDL_Color_0 *retstr, Uint8 r, Uint8 g, Uint8 b)
{
  *retstr = 0;                                  // TODO: Kill
  retstr->unused = -1;
  retstr->r = r;
  retstr->g = g;
  retstr->b = b;
}

//----- (0805977E) --------------------------------------------------------
void InitFade()
{
  SDL_Color_0 r;

  memset(&gFade, 0, 0x268u);
  RGB(&r, 0, 0, 0x20u);
  _mask_color = GetCortBoxColor(&r);
}

//----- (080597D8) --------------------------------------------------------
void SetFadeMask()
{
  gFade.bMask = 1;
}

//----- (080597E4) --------------------------------------------------------
void ClearFade()
{
  gFade.bMask = 0;
  gFade.mode = 0;
}

//----- (080597FA) --------------------------------------------------------
void __cdecl StartFadeOut(char dir)
{
  int x;
  int y;

  gFade.mode = 2;
  gFade.count = 0;
  gFade.dir = dir;
  gFade.bMask = 0;
  for ( y = 0; y <= 14; ++y )
  {
    for ( x = 0; x <= 19; ++x )
    {
      *(_BYTE *)(x + 20 * y + 136086284) = 0;
      *(_BYTE *)(x + 20 * y + 136086584) = 0;
    }
  }
}

//----- (08059892) --------------------------------------------------------
void __cdecl StartFadeIn(char dir)
{
  int x;
  int y;

  gFade.mode = 1;
  gFade.count = 0;
  gFade.dir = dir;
  gFade.bMask = 1;
  for ( y = 0; y <= 14; ++y )
  {
    for ( x = 0; x <= 19; ++x )
    {
      *(_BYTE *)(x + 20 * y + 136086284) = 15;
      *(_BYTE *)(x + 20 * y + 136086584) = 0;
    }
  }
}

//----- (0805992A) --------------------------------------------------------
void ProcFade()
{
  int x;
  int xa;
  int xb;
  int xc;
  int xd;
  int xe;
  int xf;
  int xg;
  int xh;
  int xi;
  int xj;
  int xk;
  int xl;
  int xm;
  int xn;
  int xo;
  int xp;
  int xq;
  int y;
  int ya;
  int yb;
  int yc;
  int yd;
  int ye;
  int yf;
  int yg;
  int yh;
  int yi;
  int yj;
  int yk;
  int yl;
  int ym;
  int yn;
  int yo;
  int yp;
  int yq;

  if ( gFade.mode == 1 )
  {
    gFade.bMask = 0;
    switch ( gFade.dir )
    {
      case 0:
        for ( yi = 0; yi <= 14; ++yi )
        {
          for ( xi = 0; xi <= 19; ++xi )
          {
            if ( 19 - gFade.count == xi )
              *(_BYTE *)(xi + 20 * yi + 136086584) = 1;
          }
        }
        break;
      case 1:
        for ( yk = 0; yk <= 14; ++yk )
        {
          for ( xk = 0; xk <= 19; ++xk )
          {
            if ( 14 - gFade.count == yk )
              *(_BYTE *)(xk + 20 * yk + 136086584) = 1;
          }
        }
        break;
      case 2:
        for ( yj = 0; yj <= 14; ++yj )
        {
          for ( xj = 0; xj <= 19; ++xj )
          {
            if ( gFade.count == xj )
              *(_BYTE *)(xj + 20 * yj + 136086584) = 1;
          }
        }
        break;
      case 3:
        for ( yl = 0; yl <= 14; ++yl )
        {
          for ( xl = 0; xl <= 19; ++xl )
          {
            if ( gFade.count == yl )
              *(_BYTE *)(xl + 20 * yl + 136086584) = 1;
          }
        }
        break;
      case 4:
        for ( ym = 0; ym <= 6; ++ym )
        {
          for ( xm = 0; xm <= 9; ++xm )
          {
            if ( 19 - gFade.count == xm + ym )
              *(_BYTE *)(xm + 20 * ym + 136086584) = 1;
          }
        }
        for ( yn = 0; yn <= 6; ++yn )
        {
          for ( xn = 10; xn <= 19; ++xn )
          {
            if ( 19 - gFade.count == yn + 19 - xn )
              *(_BYTE *)(xn + 20 * yn + 136086584) = 1;
          }
        }
        for ( yo = 7; yo <= 14; ++yo )
        {
          for ( xo = 0; xo <= 9; ++xo )
          {
            if ( 19 - gFade.count == xo + 14 - yo )
              *(_BYTE *)(xo + 20 * yo + 136086584) = 1;
          }
        }
        for ( yp = 7; yp <= 14; ++yp )
        {
          for ( xp = 10; xp <= 19; ++xp )
          {
            if ( 19 - gFade.count == 19 - xp + 14 - yp )
              *(_BYTE *)(xp + 20 * yp + 136086584) = 1;
          }
        }
        break;
      default:
        break;
    }
    for ( yq = 0; yq <= 14; ++yq )
    {
      for ( xq = 0; xq <= 19; ++xq )
      {
        if ( *(_BYTE *)(xq + 20 * yq + 136086284) > 0 && *(_BYTE *)(xq + 20 * yq + 136086584) )
          --*(_BYTE *)(xq + 20 * yq + 136086284);
      }
    }
    if ( ++gFade.count > 36 )
      gFade.mode = 0;
  }
  else if ( gFade.mode == 2 )
  {
    switch ( gFade.dir )
    {
      case 0:
        for ( y = 0; y <= 14; ++y )
        {
          for ( x = 0; x <= 19; ++x )
          {
            if ( 19 - gFade.count == x )
              *(_BYTE *)(x + 20 * y + 136086584) = 1;
          }
        }
        break;
      case 1:
        for ( yb = 0; yb <= 14; ++yb )
        {
          for ( xb = 0; xb <= 19; ++xb )
          {
            if ( 14 - gFade.count == yb )
              *(_BYTE *)(xb + 20 * yb + 136086584) = 1;
          }
        }
        break;
      case 2:
        for ( ya = 0; ya <= 14; ++ya )
        {
          for ( xa = 0; xa <= 19; ++xa )
          {
            if ( gFade.count == xa )
              *(_BYTE *)(xa + 20 * ya + 136086584) = 1;
          }
        }
        break;
      case 3:
        for ( yc = 0; yc <= 14; ++yc )
        {
          for ( xc = 0; xc <= 19; ++xc )
          {
            if ( gFade.count == yc )
              *(_BYTE *)(xc + 20 * yc + 136086584) = 1;
          }
        }
        break;
      case 4:
        for ( yd = 0; yd <= 6; ++yd )
        {
          for ( xd = 0; xd <= 9; ++xd )
          {
            if ( gFade.count == xd + yd )
              *(_BYTE *)(xd + 20 * yd + 136086584) = 1;
          }
        }
        for ( ye = 0; ye <= 6; ++ye )
        {
          for ( xe = 10; xe <= 19; ++xe )
          {
            if ( gFade.count == ye + 19 - xe )
              *(_BYTE *)(xe + 20 * ye + 136086584) = 1;
          }
        }
        for ( yf = 7; yf <= 14; ++yf )
        {
          for ( xf = 0; xf <= 9; ++xf )
          {
            if ( gFade.count == xf + 14 - yf )
              *(_BYTE *)(xf + 20 * yf + 136086584) = 1;
          }
        }
        for ( yg = 7; yg <= 14; ++yg )
        {
          for ( xg = 10; xg <= 19; ++xg )
          {
            if ( gFade.count == 19 - xg + 14 - yg )
              *(_BYTE *)(xg + 20 * yg + 136086584) = 1;
          }
        }
        break;
      default:
        break;
    }
    for ( yh = 0; yh <= 14; ++yh )
    {
      for ( xh = 0; xh <= 19; ++xh )
      {
        if ( *(_BYTE *)(xh + 20 * yh + 136086284) <= 14 && *(_BYTE *)(xh + 20 * yh + 136086584) )
          ++*(_BYTE *)(xh + 20 * yh + 136086284);
      }
    }
    if ( ++gFade.count > 36 )
    {
      gFade.bMask = 1;
      gFade.mode = 0;
    }
  }
}

//----- (0805A15A) --------------------------------------------------------
void PutFade()
{
  RECT rect;
  int x;
  int y;

  rect.top = 0;
  rect.bottom = 16;
  if ( gFade.bMask )
  {
    CortBox(&grcGame, _mask_color);
  }
  else if ( gFade.mode )
  {
    for ( y = 0; y <= 14; ++y )
    {
      for ( x = 0; x <= 19; ++x )
      {
        rect.left = 16 * *(char *)(x + 20 * y + 136086284);
        rect.right = rect.left + 16;
        PutBitmap3(&grcGame, 16 * x, 16 * y, &rect, 6);
      }
    }
  }
}

//----- (0805A239) --------------------------------------------------------
_BOOL4 GetFadeActive()
{
  return gFade.mode != 0;
}

//----- (0805A254) --------------------------------------------------------
void __cdecl ActNpc060(NPCHAR_0 *npc)
{
  int v1;
  bool v2;
  int v3;
  bool v4;
  int v5;
  bool v6;
  unsigned __int16 v7;
  NPCHAR_0 *v8;
  Sint32 *v9;
  RECT rcRight[8];
  RECT rcLeft[8];
  char v12[24];

  qmemcpy(rcLeft, &ActNpc060(NPCHAR *)::C.0, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc060(NPCHAR *)::C.1, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      npc->xm = 0;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( Random(0, 120) == 10 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      if ( npc->x - 0x2000 < x && npc->x + 0x2000 > x && npc->y - 0x2000 < y && npc->y + 0x2000 > y )
      {
        if ( npc->x <= x )
          npc->direct = 2;
        else
          npc->direct = 0;
      }
      break;
    case 2:
      if ( ++npc->act_wait > 8 )
      {
        npc->act_no = 1;
        npc->ani_no = 0;
      }
      break;
    case 3:
      npc->act_no = 4;
      npc->ani_no = 1;
      npc->ani_wait = 0;
      goto LABEL_15;
    case 4:
LABEL_15:
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 4 )
        npc->ani_no = 1;
      if ( npc->flag & 1 )
      {
        npc->direct = 2;
        npc->xm = 512;
      }
      if ( npc->flag & 4 )
      {
        npc->direct = 0;
        npc->xm = -512;
      }
      if ( npc->direct )
        npc->xm = 1024;
      else
        npc->xm = -1024;
      break;
    case 6:
      npc->act_no = 7;
      npc->act_wait = 0;
      npc->ani_no = 1;
      npc->ani_wait = 0;
      npc->ym = -1024;
      goto LABEL_27;
    case 7:
LABEL_27:
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 4 )
        npc->ani_no = 1;
      if ( npc->direct )
        npc->xm = 256;
      else
        npc->xm = -256;
      v1 = npc->act_wait;
      npc->act_wait = v1 + 1;
      v2 = v1 != 0 && npc->flag & 8;
      if ( v2 )
        npc->act_no = 3;
      break;
    case 8:
      npc->ani_no = 1;
      npc->act_wait = 0;
      npc->act_no = 9;
      npc->ym = -512;
      goto LABEL_41;
    case 9:
LABEL_41:
      v3 = npc->act_wait;
      npc->act_wait = v3 + 1;
      v4 = v3 != 0 && npc->flag & 8;
      if ( v4 )
        npc->act_no = 0;
      break;
    case 0xA:
      npc->act_no = 11;
      npc->ani_no = 6;
      npc->ym = -1024;
      PlaySoundObject(50, 1);
      if ( npc->direct )
        npc->xm = 256;
      else
        npc->xm = -256;
      break;
    case 0xB:
      v5 = npc->act_wait;
      npc->act_wait = v5 + 1;
      v6 = v5 != 0 && npc->flag & 8;
      if ( v6 )
      {
        npc->act_no = 12;
        npc->ani_no = 7;
        v7 = npc->bits;
        HIBYTE(v7) |= 0x20u;
        npc->bits = v7;
      }
      break;
    case 0xC:
      npc->xm = 0;
      break;
    default:
      break;
  }
  npc->ym += 64;
  if ( npc->xm > 1024 )
    npc->xm = 1024;
  if ( npc->xm < -1024 )
    npc->xm = -1024;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v8 = npc;
    v9 = (Sint32 *)&v12[16 * npc->ani_no - 256];
  }
  else
  {
    v8 = npc;
    v9 = (Sint32 *)&v12[16 * npc->ani_no - 128];
  }
  npc->rect.left = *v9;
  v8->rect.top = v9[1];
  v8->rect.right = v9[2];
  v8->rect.bottom = v9[3];
}


//----- (0805A7BE) --------------------------------------------------------
void __cdecl ActNpc061(NPCHAR_0 *npc)
{
  int v1;
  bool v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  int v8;
  NPCHAR_0 *v9;
  Sint32 *v10;
  RECT rcRight[11];
  RECT rcLeft[11];
  int i;
  char v14[24];

  qmemcpy(rcLeft, &ActNpc061(NPCHAR *)::C.9, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc061(NPCHAR *)::C.10, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      npc->xm = 0;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( Random(0, 120) == 10 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      break;
    case 2:
      if ( ++npc->act_wait > 8 )
      {
        npc->act_no = 1;
        npc->ani_no = 0;
      }
      break;
    case 5:
      npc->ani_no = 3;
      npc->xm = 0;
      break;
    case 6:
      npc->act_no = 7;
      npc->act_wait = 0;
      npc->ani_wait = 0;
      npc->ym = -1024;
      goto LABEL_9;
    case 7:
LABEL_9:
      npc->ani_no = 2;
      if ( npc->direct )
        npc->xm = 512;
      else
        npc->xm = -512;
      v1 = npc->act_wait;
      npc->act_wait = v1 + 1;
      v2 = v1 != 0 && npc->flag & 8;
      if ( v2 )
        npc->act_no = 5;
      break;
    case 8:
      npc->act_no = 9;
      npc->ani_no = 4;
      npc->ani_wait = 0;
      goto LABEL_19;
    case 9:
LABEL_19:
      if ( ++npc->ani_wait > 4 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 7 )
        npc->ani_no = 4;
      if ( npc->direct )
        npc->xm = 512;
      else
        npc->xm = -512;
      break;
    case 0xA:
      npc->act_no = 11;
      npc->ani_no = 4;
      npc->ani_wait = 0;
      goto LABEL_27;
    case 0xB:
LABEL_27:
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 7 )
        npc->ani_no = 4;
      if ( npc->direct )
        npc->xm = 1024;
      else
        npc->xm = -1024;
      break;
    case 0x14:
      SetNpChar(145, 0, 0, 0, 0, 2, npc, 256);
      npc->ani_no = 0;
      npc->act_no = 0;
      break;
    case 0x1E:
      npc->act_no = 31;
      npc->act_wait = 0;
      npc->ani_wait = 0;
      npc->ym = 0;
      goto LABEL_36;
    case 0x1F:
LABEL_36:
      npc->ani_no = 2;
      if ( npc->direct )
        npc->xm = 1536;
      else
        npc->xm = -1536;
      if ( npc->flag & 1 )
      {
        npc->direct = 2;
        npc->act_no = 7;
        npc->act_wait = 0;
        npc->ani_wait = 0;
        npc->ym = -1024;
        npc->xm = 512;
        PlaySoundObject(71, 1);
        SetDestroyNpChar(npc->x, npc->y, 2048, 4);
      }
      break;
    case 0x28:
      npc->act_no = 42;
      npc->act_wait = 0;
      npc->ani_no = 8;
      PlaySoundObject(29, 1);
      goto LABEL_42;
    case 0x2A:
LABEL_42:
      if ( ++npc->ani_no > 9 )
        npc->ani_no = 8;
      if ( ++npc->act_wait > 100 )
      {
        for ( i = 0; i <= 3; ++i )
        {
          v3 = Random(-1536, 0);
          v4 = Random(-341, 341);
          v5 = npc->y;
          v6 = (Random(-12, 12) << 9) + v5;
          v7 = npc->x;
          v8 = Random(-12, 12);
          SetNpChar(4, v7 + (v8 << 9), v6, v4, v3, 0, 0, 256);
        }
        npc->act_no = 50;
        npc->surf = 20;
        npc->ani_no = 10;
      }
      break;
    case 0x3C:
      npc->ani_no = 6;
      npc->act_no = 61;
      npc->ym = -1535;
      npc->xm = 1024;
      npc->count2 = 1;
      break;
    case 0x3D:
      npc->ym += 64;
      if ( npc->flag & 8 )
      {
        npc->act_no = 0;
        npc->count2 = 0;
        npc->xm = 0;
      }
      break;
    default:
      break;
  }
  if ( npc->act_no <= 29 || npc->act_no > 39 )
  {
    npc->ym += 64;
    if ( npc->xm > 1024 )
      npc->xm = 1024;
    if ( npc->xm < -1024 )
      npc->xm = -1024;
    if ( npc->ym > 1535 )
      npc->ym = 1535;
  }
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v9 = npc;
    v10 = (Sint32 *)&v14[16 * npc->ani_no - 356];
  }
  else
  {
    v9 = npc;
    v10 = (Sint32 *)&v14[16 * npc->ani_no - 180];
  }
  npc->rect.left = *v10;
  v9->rect.top = v10[1];
  v9->rect.right = v10[2];
  v9->rect.bottom = v10[3];
}


//----- (0805AEA0) --------------------------------------------------------
void __cdecl ActNpc062(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT rcLeft[3];
  char v4[8];

  rcLeft[0].left = 272;
  rcLeft[0].top = 192;
  rcLeft[0].right = 288;
  rcLeft[0].bottom = 216;
  rcLeft[1].left = 288;
  rcLeft[1].top = 192;
  rcLeft[1].right = 304;
  rcLeft[1].bottom = 216;
  rcLeft[2].left = 304;
  rcLeft[2].top = 192;
  rcLeft[2].right = 320;
  rcLeft[2].bottom = 216;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_9:
    if ( ++npc->ani_wait > 2 )
    {
      npc->ani_wait = 0;
      ++npc->ani_no;
    }
    if ( npc->ani_no > 1 )
      npc->ani_no = 0;
    if ( Random(0, 80) == 1 )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
      npc->ani_no = 1;
    }
    if ( Random(0, 120) == 10 )
    {
      npc->act_no = 3;
      npc->act_wait = 0;
      npc->ani_no = 2;
    }
    goto LABEL_21;
  }
  if ( v1 <= 1 )
  {
    if ( v1 )
      goto LABEL_21;
    npc->x -= 2048;
    npc->y += 0x2000;
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->ani_wait = 0;
    goto LABEL_9;
  }
  if ( v1 == 2 )
  {
    if ( ++npc->act_wait > 40 )
    {
      npc->act_no = 3;
      npc->act_wait = 0;
      npc->ani_no = 2;
    }
  }
  else if ( v1 == 3 && ++npc->act_wait > 80 )
  {
    npc->act_no = 1;
    npc->ani_no = 0;
  }
LABEL_21:
  v2 = (Sint32 *)&v4[16 * npc->ani_no - 48];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
}


//----- (0805B0CE) --------------------------------------------------------
void __cdecl ActNpc063(NPCHAR_0 *npc)
{
  int v1;
  bool v2;
  int v3;
  int v4;
  bool v5;
  unsigned __int16 v6;
  NPCHAR_0 *v7;
  Sint32 *v8;
  RECT rcRight[6];
  RECT rcLeft[6];
  char v11[12];

  qmemcpy(rcLeft, &ActNpc063(NPCHAR *)::C.16, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc063(NPCHAR *)::C.17, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->act_wait = 0;
      npc->ani_wait = 0;
      npc->ym = -1024;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( npc->ym > 0 )
        npc->bits &= 0xFFF7u;
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 3 )
        npc->ani_no = 0;
      if ( npc->direct )
        npc->xm = 256;
      else
        npc->xm = -256;
      v1 = npc->act_wait;
      npc->act_wait = v1 + 1;
      v2 = v1 != 0 && npc->flag & 8;
      if ( v2 )
        npc->act_no = 2;
      break;
    case 2:
      npc->act_no = 3;
      npc->act_wait = 0;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      goto LABEL_19;
    case 3:
LABEL_19:
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 3 )
        npc->ani_no = 0;
      if ( ++npc->act_wait > 50 )
      {
        npc->act_wait = 40;
        npc->xm = -npc->xm;
        if ( npc->direct )
          npc->direct = 0;
        else
          npc->direct = 2;
      }
      if ( npc->act_wait > 35 )
        npc->bits |= 0x20u;
      if ( npc->direct )
        v3 = npc->xm + 64;
      else
        v3 = npc->xm - 64;
      npc->xm = v3;
      if ( npc->shock )
      {
        npc->act_no = 4;
        npc->ani_no = 4;
        npc->ym = -1024;
        npc->bits &= 0xFFDFu;
        npc->damage = 0;
      }
      break;
    case 4:
      if ( npc->direct )
        npc->xm = 256;
      else
        npc->xm = -256;
      v4 = npc->act_wait;
      npc->act_wait = v4 + 1;
      v5 = v4 != 0 && npc->flag & 8;
      if ( v5 )
      {
        npc->act_no = 5;
        v6 = npc->bits;
        HIBYTE(v6) |= 0x20u;
        npc->bits = v6;
      }
      break;
    case 5:
      npc->xm = 0;
      npc->ani_no = 5;
      break;
    default:
      break;
  }
  npc->ym += 64;
  if ( npc->xm > 1024 )
    npc->xm = 1024;
  if ( npc->xm < -1024 )
    npc->xm = -1024;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v7 = npc;
    v8 = (Sint32 *)&v11[16 * npc->ani_no - 192];
  }
  else
  {
    v7 = npc;
    v8 = (Sint32 *)&v11[16 * npc->ani_no - 96];
  }
  npc->rect.left = *v8;
  v7->rect.top = v8[1];
  v7->rect.right = v8[2];
  v7->rect.bottom = v8[3];
}


//----- (0805B4F4) --------------------------------------------------------
void __cdecl ActNpc064(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[3];
  RECT rcLeft[3];
  char v6[8];

  rcLeft[0].left = 0;
  rcLeft[0].top = 0;
  rcLeft[0].right = 16;
  rcLeft[0].bottom = 16;
  rcLeft[1].left = 16;
  rcLeft[1].top = 0;
  rcLeft[1].right = 32;
  rcLeft[1].bottom = 16;
  rcLeft[2].left = 32;
  rcLeft[2].top = 0;
  rcLeft[2].right = 48;
  rcLeft[2].bottom = 16;
  rcRight[0].left = 0;
  rcRight[0].top = 16;
  rcRight[0].right = 16;
  rcRight[0].bottom = 32;
  rcRight[1].left = 16;
  rcRight[1].top = 16;
  rcRight[1].right = 32;
  rcRight[1].bottom = 32;
  rcRight[2].left = 32;
  rcRight[2].top = 16;
  rcRight[2].right = 48;
  rcRight[2].bottom = 32;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_9:
    if ( npc->x <= x )
      npc->direct = 2;
    else
      npc->direct = 0;
    if ( npc->tgt_x <= 99 )
      ++npc->tgt_x;
    if ( npc->act_wait <= 7 || npc->x - 57344 >= x || npc->x + 57344 <= x || npc->y - 40960 >= y || npc->y + 40960 <= y )
    {
      if ( npc->act_wait <= 7 )
        ++npc->act_wait;
      npc->ani_no = 0;
    }
    else
    {
      npc->ani_no = 1;
    }
    if ( npc->shock )
    {
      npc->act_no = 2;
      npc->ani_no = 0;
      npc->act_wait = 0;
    }
    if ( npc->act_wait > 7
      && npc->tgt_x > 99
      && npc->x - 0x8000 < x
      && npc->x + 0x8000 > x
      && npc->y - 40960 < y
      && npc->y + 24576 > y )
    {
      npc->act_no = 2;
      npc->ani_no = 0;
      npc->act_wait = 0;
    }
    goto LABEL_38;
  }
  if ( v1 <= 1 )
  {
    if ( v1 )
      goto LABEL_38;
    npc->y += 1536;
    npc->act_no = 1;
    goto LABEL_9;
  }
  if ( v1 == 2 )
  {
    if ( ++npc->act_wait > 8 )
    {
      npc->act_no = 3;
      npc->ani_no = 2;
      npc->ym = -1535;
      PlaySoundObject(30, 1);
      if ( npc->direct )
        npc->xm = 256;
      else
        npc->xm = -256;
    }
  }
  else if ( v1 == 3 && npc->flag & 8 )
  {
    npc->xm = 0;
    npc->act_wait = 0;
    npc->ani_no = 0;
    npc->act_no = 1;
    PlaySoundObject(23, 1);
  }
LABEL_38:
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 96];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 48];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (0805B911) --------------------------------------------------------
void __cdecl ActNpc065(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rect_right[4];
  RECT rect_left[4];
  char v6[8];

  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    if ( ++npc->act_wait > 49 )
    {
      npc->act_wait = 0;
      npc->act_no = 2;
      npc->ym = 768;
    }
    goto LABEL_18;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_18;
    npc->tgt_x = npc->x;
    npc->tgt_y = npc->y;
    npc->count1 = 120;
    npc->act_no = 1;
    npc->act_wait = Random(0, 50);
    goto LABEL_5;
  }
  if ( x >= npc->x )
    npc->direct = 2;
  else
    npc->direct = 0;
  if ( npc->tgt_y < npc->y )
    npc->ym -= 16;
  if ( npc->tgt_y > npc->y )
    npc->ym += 16;
  if ( npc->ym > 768 )
    npc->ym = 768;
  if ( npc->ym < -768 )
    npc->ym = -768;
LABEL_18:
  npc->x += npc->xm;
  npc->y += npc->ym;
  rect_left[0].left = 32;
  rect_left[0].top = 32;
  rect_left[0].right = 48;
  rect_left[0].bottom = 48;
  rect_left[1].left = 48;
  rect_left[1].top = 32;
  rect_left[1].right = 64;
  rect_left[1].bottom = 48;
  rect_left[2].left = 64;
  rect_left[2].top = 32;
  rect_left[2].right = 80;
  rect_left[2].bottom = 48;
  rect_left[3].left = 80;
  rect_left[3].top = 32;
  rect_left[3].right = 96;
  rect_left[3].bottom = 48;
  rect_right[0].left = 32;
  rect_right[0].top = 48;
  rect_right[0].right = 48;
  rect_right[0].bottom = 64;
  rect_right[1].left = 48;
  rect_right[1].top = 48;
  rect_right[1].right = 64;
  rect_right[1].bottom = 64;
  rect_right[2].left = 64;
  rect_right[2].top = 48;
  rect_right[2].right = 80;
  rect_right[2].bottom = 64;
  rect_right[3].left = 80;
  rect_right[3].top = 48;
  rect_right[3].right = 96;
  rect_right[3].bottom = 64;
  if ( ++npc->ani_wait > 1 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 2 )
    npc->ani_no = 0;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 128];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 64];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (0805BC0E) --------------------------------------------------------
void __cdecl ActNpc066(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT rect[4];
  int a;
  unsigned __int8 deg;
  char v6[8];

  rect[0].left = 32;
  rect[0].top = 192;
  rect[0].right = 56;
  rect[0].bottom = 216;
  rect[1].left = 56;
  rect[1].top = 192;
  rect[1].right = 80;
  rect[1].bottom = 216;
  rect[2].left = 32;
  rect[2].top = 216;
  rect[2].right = 56;
  rect[2].bottom = 240;
  rect[3].left = 56;
  rect[3].top = 216;
  rect[3].right = 80;
  rect[3].bottom = 240;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_10:
    if ( ++npc->ani_wait > 1 )
    {
      npc->ani_wait = 0;
      ++npc->ani_no;
    }
    if ( npc->ani_no > 1 )
      npc->ani_no = 0;
    if ( npc->x - 1536 < npc->tgt_x
      && npc->x + 1536 > npc->tgt_x
      && npc->y - 1536 < npc->tgt_y
      && npc->y + 1536 > npc->tgt_y )
    {
      npc->act_no = 2;
      npc->ani_no = 2;
      gNPC[npc->count1].cond = 0;
      PlaySoundObject(21, 1);
    }
    goto LABEL_29;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_29;
    for ( a = 0; a <= 511 && gNPC[a].code_event != 1000; ++a )
      ;
    if ( a == 512 )
      goto LABEL_29;
    npc->tgt_x = gNPC[a].x;
    npc->tgt_y = gNPC[a].y;
    npc->count1 = a;
    deg = GetArktan(npc->x - npc->tgt_x, npc->y - npc->tgt_y);
    npc->xm = 2 * GetCos(deg);
    npc->ym = 2 * GetSin(deg);
    npc->act_no = 1;
    goto LABEL_10;
  }
  npc->xm -= 32;
  npc->ym -= 32;
  if ( npc->xm < -1535 )
    npc->xm = -1535;
  if ( npc->ym < -1535 )
    npc->ym = -1535;
  if ( npc->y < -4096 )
    npc->cond = 0;
  if ( ++npc->ani_wait > 3 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 3 )
    npc->ani_no = 2;
LABEL_29:
  npc->x += npc->xm;
  npc->y += npc->ym;
  v2 = (Sint32 *)&v6[16 * npc->ani_no - 72];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
}


//----- (0805BF7C) --------------------------------------------------------
void __cdecl ActNpc067(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[8];
  RECT rcLeft[8];
  char v6[24];

  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->tgt_x = npc->x;
      npc->tgt_y = npc->y;
      npc->ani_no = 0;
      PlaySoundObject(29, 1);
      goto LABEL_3;
    case 1:
LABEL_3:
      v1 = npc->tgt_x;
      npc->x = v1 + (Random(-1, 1) << 9);
      if ( ++npc->act_wait == 32 )
        npc->act_no = 10;
      break;
    case 0xA:
      npc->act_no = 11;
      npc->act_wait = 0;
      npc->ani_no = 0;
      npc->ym = 512;
      goto LABEL_6;
    case 0xB:
LABEL_6:
      if ( npc->tgt_y < npc->y )
        npc->ym -= 16;
      if ( npc->tgt_y > npc->y )
        npc->ym += 16;
      if ( npc->ym > 256 )
        npc->ym = 256;
      if ( npc->ym < -256 )
        npc->ym = -256;
      break;
    case 0xD:
      npc->ani_no = 1;
      npc->ym += 64;
      if ( npc->ym > 1535 )
        npc->ym = 1535;
      if ( npc->flag & 8 )
      {
        PlaySoundObject(23, 1);
        npc->ym = 0;
        npc->act_no = 14;
        npc->bits |= 8u;
        npc->ani_no = 2;
      }
      break;
    case 0xF:
      npc->act_no = 16;
      npc->act_wait = 0;
      npc->ani_no = 4;
      goto LABEL_19;
    case 0x10:
LABEL_19:
      if ( ++npc->act_wait == 30 )
      {
        PlaySoundObject(21, 1);
        SetNpChar(66, npc->x, npc->y - 0x2000, 0, 0, 0, npc, 0);
      }
      if ( npc->act_wait == 50 )
        npc->act_no = 14;
      break;
    case 0x14:
      npc->act_no = 21;
      npc->ani_no = 0;
      npc->ym = 0;
      npc->bits |= 8u;
      goto LABEL_24;
    case 0x15:
LABEL_24:
      npc->ym -= 32;
      if ( npc->y < -4096 )
        npc->cond = 0;
      break;
    case 0x19:
      npc->act_no = 26;
      npc->act_wait = 0;
      npc->ani_no = 5;
      npc->ani_wait = 0;
      goto LABEL_27;
    case 0x1A:
LABEL_27:
      if ( ++npc->ani_no > 7 )
        npc->ani_no = 5;
      if ( ++npc->act_wait == 30 )
      {
        PlaySoundObject(101, 1);
        SetFlash(0, 0, 2);
        npc->act_no = 27;
        npc->ani_no = 7;
      }
      break;
    case 0x1B:
      if ( ++npc->act_wait == 50 )
        npc->act_no = 14;
      break;
    default:
      break;
  }
  npc->x += npc->xm;
  npc->y += npc->ym;
  qmemcpy(rcLeft, &ActNpc067(NPCHAR *)::C.26, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc067(NPCHAR *)::C.27, sizeof(rcRight));
  if ( npc->act_no == 11 )
  {
    if ( npc->ani_wait )
    {
      --npc->ani_wait;
      npc->ani_no = 1;
    }
    else
    {
      if ( Random(0, 100) == 1 )
        npc->ani_wait = 30;
      npc->ani_no = 0;
    }
  }
  if ( npc->act_no == 14 )
  {
    if ( npc->ani_wait )
    {
      --npc->ani_wait;
      npc->ani_no = 3;
    }
    else
    {
      if ( Random(0, 100) == 1 )
        npc->ani_wait = 30;
      npc->ani_no = 2;
    }
  }
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 256];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 128];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
  if ( npc->act_no == 1 && npc->ani_wait <= 31 )
    npc->rect.bottom += ++npc->ani_wait / 2 - 16;
}


//----- (0805C524) --------------------------------------------------------
void __cdecl ActNpc068(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rect_right[9];
  RECT rect_left[9];
  char v6[24];

  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->act_wait = 30;
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
      goto LABEL_5;
    case 1:
LABEL_5:
      if ( !--npc->act_wait )
      {
        npc->act_no = 2;
        ++npc->count1;
      }
      break;
    case 2:
      npc->act_no = 3;
      npc->act_wait = 0;
      npc->ani_no = 1;
      npc->ani_wait = 0;
      goto LABEL_8;
    case 3:
LABEL_8:
      if ( ++npc->ani_wait > 3 )
      {
        npc->ani_wait = 0;
        if ( ++npc->ani_no == 2 || npc->ani_no == 4 )
          PlaySoundObject(23, 1);
      }
      if ( npc->ani_no > 4 )
        npc->ani_no = 1;
      if ( npc->direct )
        v1 = npc->xm + 16;
      else
        v1 = npc->xm - 16;
      npc->xm = v1;
      if ( npc->act_wait <= 7 || npc->x - 6144 >= x || npc->x + 6144 <= x || npc->y - 6144 >= y || npc->y + 4096 <= y )
      {
        ++npc->act_wait;
        if ( npc->flag & 5 || npc->act_wait > 75 )
        {
          npc->act_no = 9;
          npc->ani_no = 0;
        }
        else if ( !(npc->count1 % 3) && npc->act_wait > 25 )
        {
          npc->act_no = 4;
          npc->ani_no = 7;
          npc->ym = -1024;
        }
      }
      else
      {
        npc->act_no = 10;
        npc->ani_no = 5;
        gMC.cond |= 2u;
        DamageMyChar(2);
      }
      break;
    case 4:
      if ( npc->flag & 8 )
      {
        npc->act_no = 9;
        npc->ani_no = 8;
        SetQuake(30);
        PlaySoundObject(26, 1);
      }
      if ( npc->act_wait > 7 && npc->x - 6144 < x && npc->x + 6144 > x && npc->y - 6144 < y && npc->y + 4096 > y )
      {
        npc->act_no = 10;
        npc->ani_no = 5;
        gMC.cond |= 2u;
        DamageMyChar(2);
      }
      break;
    case 9:
      npc->xm = 4 * npc->xm / 5;
      if ( !npc->xm )
        npc->act_no = 0;
      break;
    case 0xA:
      x = npc->x;
      y = npc->y;
      npc->xm = 4 * npc->xm / 5;
      if ( !npc->xm )
      {
        npc->act_no = 11;
        npc->act_wait = 0;
        npc->ani_no = 5;
        npc->ani_wait = 0;
      }
      break;
    case 0xB:
      x = npc->x;
      y = npc->y;
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 6 )
        npc->ani_no = 5;
      if ( ++npc->act_wait > 100 )
        npc->act_no = 20;
      break;
    case 0x14:
      PlaySoundObject(25, 1);
      gMC.cond &= 0xFDu;
      if ( npc->direct )
      {
        x -= 2048;
        y -= 4096;
        unk_81C85B4 = -1535;
        unk_81C85B8 = -512;
        dir = 0;
        npc->direct = 0;
      }
      else
      {
        x += 2048;
        y -= 4096;
        unk_81C85B4 = 1535;
        unk_81C85B8 = -512;
        dir = 2;
        npc->direct = 2;
      }
      npc->act_no = 21;
      npc->act_wait = 0;
      npc->ani_no = 7;
      goto LABEL_51;
    case 0x15:
LABEL_51:
      if ( ++npc->act_wait > 49 )
        npc->act_no = 0;
      break;
    default:
      break;
  }
  npc->ym += 32;
  if ( npc->xm < -1024 )
    npc->xm = -1024;
  if ( npc->xm > 1024 )
    npc->xm = 1024;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  qmemcpy(rect_left, &ActNpc068(NPCHAR *)::C.30, sizeof(rect_left));
  qmemcpy(rect_right, &ActNpc068(NPCHAR *)::C.31, sizeof(rect_right));
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 288];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 144];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (0805CC28) --------------------------------------------------------
void __cdecl ActNpc069(NPCHAR_0 *npc)
{
  unsigned int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[6];
  RECT rcLeft[6];
  char v6[24];

  qmemcpy(rcLeft, &ActNpc069(NPCHAR *)::C.32, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc069(NPCHAR *)::C.33, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      npc->xm = 0;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( Random(0, 100) == 1 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      else
      {
        if ( Random(0, 150) == 1 )
        {
          if ( npc->direct )
            npc->direct = 0;
          else
            npc->direct = 2;
        }
        if ( Random(0, 150) == 1 )
        {
          npc->act_no = 3;
          npc->act_wait = 50;
          npc->ani_no = 0;
        }
      }
      break;
    case 2:
      if ( ++npc->act_wait > 8 )
      {
        npc->act_no = 1;
        npc->ani_no = 0;
      }
      break;
    case 3:
      npc->act_no = 4;
      npc->ani_no = 2;
      npc->ani_wait = 0;
      goto LABEL_14;
    case 4:
LABEL_14:
      if ( !--npc->act_wait )
        npc->act_no = 0;
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 4 )
        npc->ani_no = 2;
      if ( npc->flag & 1 )
      {
        npc->direct = 2;
        npc->xm = 512;
      }
      if ( npc->flag & 4 )
      {
        npc->direct = 0;
        npc->xm = -512;
      }
      if ( npc->direct )
        npc->xm = 256;
      else
        npc->xm = -256;
      break;
    case 5:
      if ( npc->flag & 8 )
        npc->act_no = 0;
      break;
    default:
      break;
  }
  v1 = npc->act_no;
  if ( v1 <= 4 && (1 << v1) & 0x16 && npc->shock )
  {
    npc->ym = -512;
    npc->ani_no = 5;
    npc->act_no = 5;
  }
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 192];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 96];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (0805CFB1) --------------------------------------------------------
void __cdecl ActNpc070(NPCHAR_0 *npc)
{
  RECT *v1;
  RECT rect[4];

  rect[0].left = 96;
  rect[0].top = 48;
  rect[0].right = 112;
  rect[0].bottom = 64;
  rect[1].left = 112;
  rect[1].top = 48;
  rect[1].right = 128;
  rect[1].bottom = 64;
  rect[2].left = 128;
  rect[2].top = 48;
  rect[2].right = 144;
  rect[2].bottom = 64;
  rect[3].left = 144;
  rect[3].top = 48;
  rect[3].right = 160;
  rect[3].bottom = 64;
  if ( ++npc->ani_wait > 3 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 3 )
    npc->ani_no = 0;
  v1 = &rect[npc->ani_no];
  npc->rect.left = v1->left;
  npc->rect.top = v1->top;
  npc->rect.right = v1->right;
  npc->rect.bottom = v1->bottom;
}

//----- (0805D09B) --------------------------------------------------------
void __cdecl ActNpc071(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  RECT *v3;
  RECT rcRight[3];
  RECT rcLeft[3];

  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_13;
  }
  else
  {
    npc->act_no = 1;
    npc->tgt_x = npc->x;
    npc->tgt_y = npc->y;
    npc->ym = 128;
  }
  if ( npc->tgt_y < npc->y )
    npc->ym -= 8;
  if ( npc->tgt_y > npc->y )
    npc->ym += 8;
  if ( npc->ym > 256 )
    npc->ym = 256;
  if ( npc->ym < -256 )
    npc->ym = -256;
LABEL_13:
  npc->x += npc->xm;
  npc->y += npc->ym;
  rcLeft[0].left = 64;
  rcLeft[0].top = 32;
  rcLeft[0].right = 80;
  rcLeft[0].bottom = 48;
  rcLeft[1].left = 80;
  rcLeft[1].top = 32;
  rcLeft[1].right = 96;
  rcLeft[1].bottom = 48;
  rcLeft[2].left = 96;
  rcLeft[2].top = 32;
  rcLeft[2].right = 112;
  rcLeft[2].bottom = 48;
  rcRight[0].left = 64;
  rcRight[0].top = 48;
  rcRight[0].right = 80;
  rcRight[0].bottom = 64;
  rcRight[1].left = 80;
  rcRight[1].top = 48;
  rcRight[1].right = 96;
  rcRight[1].bottom = 64;
  rcRight[2].left = 96;
  rcRight[2].top = 48;
  rcRight[2].right = 112;
  rcRight[2].bottom = 64;
  if ( ++npc->ani_wait > 4 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 1 )
    npc->ani_no = 0;
  if ( npc->shock )
    npc->ani_no = 2;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = &rcRight[npc->ani_no];
  }
  else
  {
    v2 = npc;
    v3 = &rcLeft[npc->ani_no];
  }
  npc->rect.left = v3->left;
  v2->rect.top = v3->top;
  v2->rect.right = v3->right;
  v2->rect.bottom = v3->bottom;
}

//----- (0805D2DF) --------------------------------------------------------
void __cdecl ActNpc072(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  Sint32 *v5;
  RECT rect[2];
  char v7[8];

  if ( !npc->direct )
  {
    if ( ++npc->ani_wait > 1 )
    {
      npc->ani_wait = 0;
      ++npc->ani_no;
    }
    if ( npc->ani_no > 1 )
    {
      npc->ani_no = 0;
      return;
    }
    if ( x < npc->x + 163840 && x > npc->x - 163840 && y < npc->y + 122880 && y > npc->y - 122880 )
    {
      ++npc->act_no;
      if ( npc->act_no & 1 )
      {
        v1 = 3 * Random(-512, 128);
        v2 = Random(-512, 512);
        SetNpChar(73, npc->x, npc->y, 2 * v2, v1, 0, 0, 256);
      }
      v3 = 3 * Random(-512, 128);
      v4 = Random(-512, 512);
      SetNpChar(73, npc->x, npc->y, 2 * v4, v3, 0, 0, 256);
    }
  }
  rect[0].left = 224;
  rect[0].top = 48;
  rect[0].right = 240;
  rect[0].bottom = 64;
  rect[1].left = 240;
  rect[1].top = 48;
  rect[1].right = 256;
  rect[1].bottom = 64;
  v5 = (Sint32 *)&v7[16 * npc->ani_no - 32];
  npc->rect.left = *v5;
  npc->rect.top = v5[1];
  npc->rect.right = v5[2];
  npc->rect.bottom = v5[3];
}


//----- (0805D513) --------------------------------------------------------
void __cdecl ActNpc073(NPCHAR_0 *npc)
{
  Sint32 *v1;
  RECT rect[5];
  char v3[24];

  qmemcpy(rect, &ActNpc073(NPCHAR *)::C.37, sizeof(rect));
  npc->ym += 32;
  npc->ani_no = Random(0, 4);
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  v1 = (Sint32 *)&v3[16 * npc->ani_no - 80];
  npc->rect.left = *v1;
  npc->rect.top = v1[1];
  npc->rect.right = v1[2];
  npc->rect.bottom = v1[3];
  if ( npc->direct == 2 )
  {
    npc->rect.top += 2;
    npc->rect.bottom += 2;
  }
  if ( ++npc->act_wait > 10 )
  {
    if ( npc->flag & 1 )
      npc->cond = 0;
    if ( npc->flag & 4 )
      npc->cond = 0;
    if ( npc->flag & 8 )
      npc->cond = 0;
    if ( npc->flag & 0x100 )
      npc->cond = 0;
  }
  if ( npc->y > gMap.length << 13 )
    npc->cond = 0;
}


//----- (0805D67B) --------------------------------------------------------
void __cdecl ActNpc074(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  Sint32 *v2;
  RECT rcRight[6];
  RECT rcLeft[6];
  char v5[24];

  qmemcpy(rcLeft, &ActNpc074(NPCHAR *)::C.38, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc074(NPCHAR *)::C.39, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      npc->xm = 0;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( Random(0, 120) == 10 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      break;
    case 2:
      if ( ++npc->act_wait > 8 )
      {
        npc->act_no = 1;
        npc->ani_no = 0;
      }
      break;
    case 8:
      npc->act_no = 9;
      npc->ani_no = 2;
      npc->ani_wait = 0;
      goto LABEL_8;
    case 9:
LABEL_8:
      if ( ++npc->ani_wait > 4 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 5 )
        npc->ani_no = 2;
      if ( npc->direct )
        npc->xm = 512;
      else
        npc->xm = -512;
      break;
    default:
      break;
  }
  npc->ym += 64;
  if ( npc->xm > 1024 )
    npc->xm = 1024;
  if ( npc->xm < -1024 )
    npc->xm = -1024;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v1 = npc;
    v2 = (Sint32 *)&v5[16 * npc->ani_no - 192];
  }
  else
  {
    v1 = npc;
    v2 = (Sint32 *)&v5[16 * npc->ani_no - 96];
  }
  npc->rect.left = *v2;
  v1->rect.top = v2[1];
  v1->rect.right = v2[2];
  v1->rect.bottom = v2[3];
}


//----- (0805D8EA) --------------------------------------------------------
void __cdecl ActNpc075(NPCHAR_0 *npc)
{
  int v1;
  RECT *v2;
  RECT rcLeft[2];

  rcLeft[0].left = 272;
  rcLeft[0].top = 32;
  rcLeft[0].right = 296;
  rcLeft[0].bottom = 56;
  rcLeft[1].left = 296;
  rcLeft[1].top = 32;
  rcLeft[1].right = 320;
  rcLeft[1].bottom = 56;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_11;
  }
  else
  {
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->ani_wait = 0;
  }
  npc->ani_no = npc->x - 24576 < x && npc->x + 24576 > x && npc->y - 24576 < y && npc->y + 0x2000 > y;
LABEL_11:
  v2 = &rcLeft[npc->ani_no];
  npc->rect.left = v2->left;
  npc->rect.top = v2->top;
  npc->rect.right = v2->right;
  npc->rect.bottom = v2->bottom;
}

//----- (0805D9F0) --------------------------------------------------------
void __cdecl ActNpc076(NPCHAR_0 *npc)
{
  npc->rect.left = 16 * npc->code_event;
  npc->rect.top = 0;
  npc->rect.right = npc->rect.left + 16;
  npc->rect.bottom = 16;
}

//----- (0805DA29) --------------------------------------------------------
void __cdecl ActNpc077(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT rc[3];
  char v4[8];

  rc[0].left = 0;
  rc[0].top = 16;
  rc[0].right = 48;
  rc[0].bottom = 48;
  rc[1].left = 48;
  rc[1].top = 16;
  rc[1].right = 96;
  rc[1].bottom = 48;
  rc[2].left = 96;
  rc[2].top = 16;
  rc[2].right = 144;
  rc[2].bottom = 48;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    if ( Random(0, 120) == 10 )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
      npc->ani_no = 1;
    }
    goto LABEL_9;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_9;
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->ani_wait = 0;
    goto LABEL_5;
  }
  if ( ++npc->act_wait > 8 )
  {
    npc->act_no = 1;
    npc->ani_no = 0;
  }
LABEL_9:
  if ( npc->direct )
  {
    npc->rect.left = rc[2].left;
    npc->rect.top = rc[2].top;
    npc->rect.right = rc[2].right;
    npc->rect.bottom = rc[2].bottom;
  }
  else
  {
    v2 = (Sint32 *)&v4[16 * npc->ani_no - 48];
    npc->rect.left = *v2;
    npc->rect.top = v2[1];
    npc->rect.right = v2[2];
    npc->rect.bottom = v2[3];
  }
}


//----- (0805DB7D) --------------------------------------------------------
void __cdecl ActNpc078(NPCHAR_0 *npc)
{
  if ( npc->direct )
  {
    npc->rect.left = 176;
    npc->rect.top = 48;
    npc->rect.right = 192;
  }
  else
  {
    npc->rect.left = 160;
    npc->rect.top = 48;
    npc->rect.right = 176;
  }
  npc->rect.bottom = 64;
}

//----- (0805DBFF) --------------------------------------------------------
void __cdecl ActNpc079(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[3];
  RECT rcLeft[3];
  char v6[8];

  rcLeft[0].left = 0;
  rcLeft[0].top = 0;
  rcLeft[0].right = 16;
  rcLeft[0].bottom = 16;
  rcLeft[1].left = 16;
  rcLeft[1].top = 0;
  rcLeft[1].right = 32;
  rcLeft[1].bottom = 16;
  rcLeft[2].left = 32;
  rcLeft[2].top = 0;
  rcLeft[2].right = 48;
  rcLeft[2].bottom = 16;
  rcRight[0].left = 0;
  rcRight[0].top = 16;
  rcRight[0].right = 16;
  rcRight[0].bottom = 32;
  rcRight[1].left = 16;
  rcRight[1].top = 16;
  rcRight[1].right = 32;
  rcRight[1].bottom = 32;
  rcRight[2].left = 32;
  rcRight[2].top = 16;
  rcRight[2].right = 48;
  rcRight[2].bottom = 32;
  v1 = npc->act_no;
  if ( v1 != 1 )
  {
    if ( v1 > 1 )
    {
      if ( v1 == 2 )
      {
        npc->ani_no = 0;
        if ( Random(0, 120) == 10 )
        {
          npc->act_no = 3;
          npc->act_wait = 0;
          npc->ani_no = 1;
        }
        if ( npc->x - 0x4000 < x && npc->x + 0x4000 > x && npc->y - 0x4000 < y && npc->y + 0x2000 > y )
        {
          if ( npc->x <= x )
            npc->direct = 2;
          else
            npc->direct = 0;
        }
      }
      else if ( v1 == 3 && ++npc->act_wait > 8 )
      {
        npc->act_no = 2;
        npc->ani_no = 0;
      }
    }
    else if ( !v1 )
    {
      npc->act_no = 1;
      npc->ani_no = 2;
      npc->ani_wait = 0;
    }
  }
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 96];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 48];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (0805DEA8) --------------------------------------------------------
void InitMyChar()
{
  memset(&gMC, 0, 0xB4u);
  gMC.cond = -128;
  dir = 2;
  unk_81C85DC = 4096;
  unk_81C85D8 = 4096;
  unk_81C85D4 = 4096;
  unk_81C85E0 = 4096;
  unk_81C85CC = 2560;
  unk_81C85C8 = 4096;
  unk_81C85C4 = 2560;
  unk_81C85D0 = 4096;
  word_81C8614 = 3;
  unk_81C8618 = 3;
  unk_81C8594 = 0;
}

//----- (0805DF49) --------------------------------------------------------
void __cdecl AnimationMyChar(bool bKey)
{
  char *v1;
  RECT rcRight[12];
  RECT rcLeft[12];
  char v4[24];

  qmemcpy(rcLeft, &AnimationMyChar(bool)::C.0, sizeof(rcLeft));
  qmemcpy(rcRight, &AnimationMyChar(bool)::C.1, sizeof(rcRight));
  if ( !(gMC.cond & 2) )
  {
    if ( dword_81C8584 & 8 )
    {
      if ( gMC.cond & 1 )
      {
        unk_81C85C0 = 11;
      }
      else if ( gKey & gKeyUp && (gKeyRight | gKeyLeft) & gKey && bKey )
      {
        gMC.cond |= 4u;
        if ( ++unk_81C85BC > 4 )
        {
          unk_81C85BC = 0;
          if ( ++unk_81C85C0 == 7 || unk_81C85C0 == 9 )
            PlaySoundObject(24, 1);
        }
        if ( unk_81C85C0 > 9 || unk_81C85C0 <= 5 )
          unk_81C85C0 = 6;
      }
      else if ( (gKeyRight | gKeyLeft) & gKey && bKey )
      {
        gMC.cond |= 4u;
        if ( ++unk_81C85BC > 4 )
        {
          unk_81C85BC = 0;
          if ( ++unk_81C85C0 == 2 || unk_81C85C0 == 4 )
            PlaySoundObject(24, 1);
        }
        if ( unk_81C85C0 > 4 || unk_81C85C0 <= 0 )
          unk_81C85C0 = 1;
      }
      else if ( gKey & gKeyUp && bKey )
      {
        if ( gMC.cond & 4 )
          PlaySoundObject(24, 1);
        gMC.cond &= 0xFBu;
        unk_81C85C0 = 5;
      }
      else
      {
        if ( gMC.cond & 4 )
          PlaySoundObject(24, 1);
        gMC.cond &= 0xFBu;
        unk_81C85C0 = 0;
      }
    }
    else if ( unk_81C858C )
    {
      unk_81C85C0 = 6;
    }
    else if ( unk_81C8590 )
    {
      unk_81C85C0 = 10;
    }
    else if ( unk_81C85B8 <= 0 )
    {
      unk_81C85C0 = 3;
    }
    else
    {
      unk_81C85C0 = 1;
    }
    if ( dir )
      v1 = &v4[16 * unk_81C85C0 - 384];
    else
      v1 = &v4[16 * unk_81C85C0 - 192];
    *(_QWORD *)&xmmword_81C85E4 = *(_QWORD *)v1;
    *((_QWORD *)&xmmword_81C85E4 + 1) = *((_QWORD *)v1 + 1);
  }
}



//----- (0805E2C1) --------------------------------------------------------
void __cdecl ShowMyChar(bool bShow)
{
  if ( bShow )
    gMC.cond &= 0xFDu;
  else
    gMC.cond |= 2u;
}

//----- (0805E2F5) --------------------------------------------------------
void __cdecl PutMyChar(int fx, int fy)
{
  RECT rcBubble[2];
  RECT rect;
  int arms_offset_y;

  if ( (gMC.cond & 0x80u) != 0 && !(gMC.cond & 2) )
  {
    stru_81C85F4.left = 24 * (gArmsData[gSelectedArms].code % 13);
    stru_81C85F4.right = stru_81C85F4.left + 24;
    stru_81C85F4.top = 96 * (gArmsData[gSelectedArms].code / 13);
    stru_81C85F4.bottom = stru_81C85F4.top + 16;
    if ( dir == 2 )
    {
      stru_81C85F4.top += 16;
      stru_81C85F4.bottom += 16;
    }
    if ( unk_81C858C )
    {
      arms_offset_y = -4;
      stru_81C85F4.top += 32;
      stru_81C85F4.bottom += 32;
    }
    else if ( unk_81C8590 )
    {
      arms_offset_y = 4;
      stru_81C85F4.top += 64;
      stru_81C85F4.bottom += 64;
    }
    else
    {
      arms_offset_y = 0;
    }
    if ( unk_81C85C0 == 1 || unk_81C85C0 == 3 || unk_81C85C0 == 6 || unk_81C85C0 == 8 )
      ++stru_81C85F4.top;
    if ( dir )
      PutBitmap3(
        &grcGame,
        (x - unk_81C85D4) / 512 - fx / 512,
        arms_offset_y + (y - unk_81C85D8) / 512 - fy / 512,
        &stru_81C85F4,
        11);
    else
      PutBitmap3(
        &grcGame,
        (x - unk_81C85D4) / 512 - fx / 512 - 8,
        arms_offset_y + (y - unk_81C85D8) / 512 - fy / 512,
        &stru_81C85F4,
        11);
    if ( !((unk_81C8610 >> 1) & 1) )
    {
      rect = (RECT)xmmword_81C85E4;
      if ( unk_81C8598 & 0x40 )
      {
        rect.top += 32;
        rect.bottom += 32;
      }
      PutBitmap3(&grcGame, (x - unk_81C85D4) / 512 - fx / 512, (y - unk_81C85D8) / 512 - fy / 512, &rect, 16);
      rcBubble[0].left = 56;
      rcBubble[0].top = 96;
      rcBubble[0].right = 80;
      rcBubble[0].bottom = 120;
      rcBubble[1].left = 80;
      rcBubble[1].top = 96;
      rcBubble[1].right = 104;
      rcBubble[1].bottom = 120;
      ++unk_81C8613;
      if ( unk_81C8598 & 0x10 && dword_81C8584 & 0x100 )
      {
        PutBitmap3(&grcGame, x / 512 - 12 - fx / 512, y / 512 - 12 - fy / 512, &rcBubble[(unk_81C8613 >> 1) & 1], 19);
      }
      else if ( unk_81C8594 == 1 )
      {
        PutBitmap3(&grcGame, x / 512 - 12 - fx / 512, y / 512 - 12 - fy / 512, &rcBubble[(unk_81C8613 >> 1) & 1], 19);
      }
    }
  }
}


//----- (0805E845) --------------------------------------------------------
void __cdecl ActMyChar_Normal(bool bKey)
{
  int x;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int max_dash;
  int gravity1;
  int gravity2;
  int jump;
  int dash1;
  int dash2;
  int resist;
  int a;
  int aa;
  signed int dir;

  if ( !(gMC.cond & 2) )
  {
    if ( dword_81C8584 & 0x100 )
    {
      max_dash = 406;
      gravity1 = 40;
      gravity2 = 16;
      jump = 640;
      dash1 = 42;
      dash2 = 16;
      resist = 25;
    }
    else
    {
      max_dash = 812;
      gravity1 = 80;
      gravity2 = 32;
      jump = 1280;
      dash1 = 85;
      dash2 = 32;
      resist = 51;
    }
    unk_81C862D = 0;
    if ( bKey != 1 )
      unk_81C862E = 0;
    if ( dword_81C8584 & 8 || dword_81C8584 & 0x10 || dword_81C8584 & 0x20 )
    {
      unk_81C862E = 0;
      if ( unk_81C8598 & 1 )
      {
        unk_81C8630 = 50;
      }
      else if ( unk_81C8598 & 0x20 )
      {
        unk_81C8630 = 50;
      }
      else
      {
        unk_81C8630 = 0;
      }
      if ( bKey )
      {
        if ( gKeyTrg != gKeyDown || gKey != gKeyDown || (gMC.cond & 1) == 1 || g_GameFlags & 4 )
        {
          if ( gKey != gKeyDown )
          {
            if ( gKey & gKeyLeft && unk_81C85B4 > -max_dash )
              unk_81C85B4 -= dash1;
            if ( gKey & gKeyRight && unk_81C85B4 < max_dash )
              unk_81C85B4 += dash1;
            if ( gKey & gKeyLeft )
              ::dir = 0;
            if ( gKey & gKeyRight )
              ::dir = 2;
          }
        }
        else
        {
          gMC.cond |= 1u;
          unk_81C862D = 1;
        }
      }
      if ( !(gMC.cond & 0x20) )
      {
        if ( unk_81C85B4 < 0 )
        {
          if ( unk_81C85B4 <= -resist )
            unk_81C85B4 += resist;
          else
            unk_81C85B4 = 0;
        }
        if ( unk_81C85B4 > 0 )
        {
          if ( unk_81C85B4 >= resist )
            unk_81C85B4 -= resist;
          else
            unk_81C85B4 = 0;
        }
      }
    }
    else
    {
      if ( bKey )
      {
        if ( unk_81C8598 & 0x21 && gKeyTrg & gKeyJump && unk_81C8630 )
        {
          if ( unk_81C8598 & 1 )
          {
            unk_81C862E = 1;
            if ( unk_81C85B8 > 256 )
              unk_81C85B8 /= 2;
          }
          if ( unk_81C8598 & 0x20 )
          {
            if ( gKey & gKeyUp )
            {
              unk_81C862E = 2;
              unk_81C85B4 = 0;
              unk_81C85B8 = -1535;
            }
            else if ( gKey & gKeyLeft )
            {
              unk_81C862E = 1;
              unk_81C85B8 = 0;
              unk_81C85B4 = -1535;
            }
            else if ( gKey & gKeyRight )
            {
              unk_81C862E = 1;
              unk_81C85B8 = 0;
              unk_81C85B4 = 1535;
            }
            else if ( gKey & gKeyDown )
            {
              unk_81C862E = 3;
              unk_81C85B4 = 0;
              unk_81C85B8 = 1535;
            }
            else
            {
              unk_81C862E = 2;
              unk_81C85B4 = 0;
              unk_81C85B8 = -1535;
            }
          }
        }
        if ( gKey & gKeyLeft && unk_81C85B4 > -max_dash )
          unk_81C85B4 -= dash2;
        if ( gKey & gKeyRight && unk_81C85B4 < max_dash )
          unk_81C85B4 += dash2;
        if ( gKey & gKeyLeft )
          ::dir = 0;
        if ( gKey & gKeyRight )
          ::dir = 2;
      }
      if ( unk_81C8598 & 0x20 && unk_81C862E && (!(gKey & gKeyJump) || !unk_81C8630) )
      {
        if ( unk_81C862E == 1 )
        {
          unk_81C85B4 /= 2;
        }
        else if ( unk_81C862E == 2 )
        {
          unk_81C85B8 /= 2;
        }
      }
      if ( !unk_81C8630 || !(gKey & gKeyJump) )
        unk_81C862E = 0;
    }
    if ( bKey )
    {
      unk_81C858C = (gKey & gKeyUp) != 0;
      unk_81C8590 = gKey & gKeyDown && !(dword_81C8584 & 8);
      if ( gKeyTrg & gKeyJump
        && (dword_81C8584 & 8 || dword_81C8584 & 0x10 || dword_81C8584 & 0x20)
        && !(dword_81C8584 & 0x2000) )
      {
        unk_81C85B8 = -jump;
        PlaySoundObject(15, 1);
      }
    }
    if ( bKey && (gKeyShot | gKeyJump | gKeyUp | gKeyRight | gKeyLeft) & gKey )
      gMC.cond &= 0xFEu;
    if ( unk_81C862E && unk_81C8630 )
      --unk_81C8630;
    if ( dword_81C8584 & 0x1000 )
      unk_81C85B4 -= 136;
    if ( dword_81C8584 & 0x2000 )
      unk_81C85B8 -= 128;
    if ( dword_81C8584 & 0x4000 )
      unk_81C85B4 += 136;
    if ( dword_81C8584 & 0x8000 )
      unk_81C85B8 += 85;
    if ( unk_81C8598 & 0x20 && unk_81C862E )
    {
      if ( unk_81C862E == 1 )
      {
        if ( dword_81C8584 & 5 )
          unk_81C85B8 = -256;
        if ( !::dir )
          unk_81C85B4 -= 32;
        if ( ::dir == 2 )
          unk_81C85B4 += 32;
        if ( gKeyTrg & gKeyJump || unk_81C8630 % 3 == 1 )
        {
          if ( !::dir )
            SetCaret(::x + 1024, y + 1024, 7, 2);
          if ( ::dir == 2 )
            SetCaret(::x - 1024, y + 1024, 7, 0);
          PlaySoundObject(113, 1);
        }
      }
      else if ( unk_81C862E == 2 )
      {
        unk_81C85B8 -= 32;
        if ( gKeyTrg & gKeyJump || unk_81C8630 % 3 == 1 )
        {
          SetCaret(::x, y + 3072, 7, 3);
          PlaySoundObject(113, 1);
        }
      }
      else if ( unk_81C862E == 3 && (gKeyTrg & gKeyJump || unk_81C8630 % 3 == 1) )
      {
        SetCaret(::x, y - 3072, 7, 1);
        PlaySoundObject(113, 1);
      }
    }
    else if ( dword_81C8584 & 0x2000 )
    {
      unk_81C85B8 += gravity1;
    }
    else if ( unk_81C8598 & 1 && unk_81C862E && unk_81C85B8 >= -1023 )
    {
      unk_81C85B8 -= 32;
      if ( !(unk_81C8630 % 3) )
      {
        SetCaret(::x, unk_81C85D0 / 2 + y, 7, 3);
        PlaySoundObject(113, 1);
      }
      if ( dword_81C8584 & 2 )
        unk_81C85B8 = 512;
    }
    else if ( unk_81C85B8 < 0 && bKey && gKey & gKeyJump )
    {
      unk_81C85B8 += gravity2;
    }
    else
    {
      unk_81C85B8 += gravity1;
    }
    if ( bKey != 1 || !(gKeyTrg & gKeyJump) )
    {
      if ( dword_81C8584 & 0x10 && unk_81C85B4 < 0 )
        unk_81C85B8 = -unk_81C85B4;
      if ( dword_81C8584 & 0x20 && unk_81C85B4 > 0 )
        unk_81C85B8 = unk_81C85B4;
      if ( dword_81C8584 & 8 && dword_81C8584 & 0x80000 && unk_81C85B4 < 0 )
        unk_81C85B8 = 1024;
      if ( dword_81C8584 & 8 && dword_81C8584 & 0x10000 && unk_81C85B4 > 0 )
        unk_81C85B8 = 1024;
      if ( dword_81C8584 & 8 && dword_81C8584 & 0x20000 && dword_81C8584 & 0x40000 )
        unk_81C85B8 = 1024;
    }
    if ( !(dword_81C8584 & 0x100) || dword_81C8584 & 0xF000 )
    {
      if ( unk_81C85B4 < -1535 )
        unk_81C85B4 = -1535;
      if ( unk_81C85B4 > 1535 )
        unk_81C85B4 = 1535;
      if ( unk_81C85B8 < -1535 )
        unk_81C85B8 = -1535;
      if ( unk_81C85B8 > 1535 )
        unk_81C85B8 = 1535;
    }
    else
    {
      if ( unk_81C85B4 < -767 )
        unk_81C85B4 = -767;
      if ( unk_81C85B4 > 767 )
        unk_81C85B4 = 767;
      if ( unk_81C85B8 < -767 )
        unk_81C85B8 = -767;
      if ( unk_81C85B8 > 767 )
        unk_81C85B8 = 767;
    }
    if ( !unk_81C862C && dword_81C8584 & 0x100 )
    {
      if ( dword_81C8584 & 0x800 )
        dir = 2;
      else
        dir = 0;
      if ( dword_81C8584 & 8 || unk_81C85B8 <= 512 )
      {
        if ( unk_81C85B4 > 512 || unk_81C85B4 < -512 )
        {
          for ( aa = 0; aa <= 7; ++aa )
          {
            v4 = (Random(-8, 8) << 9) + ::x;
            v5 = Random(-512, 128);
            v6 = Random(-512, 512);
            SetNpChar(73, v4, y, v6 + unk_81C85B4, v5, dir, 0, 0);
          }
          PlaySoundObject(56, 1);
        }
      }
      else
      {
        for ( a = 0; a <= 7; ++a )
        {
          x = (Random(-8, 8) << 9) + ::x;
          v2 = Random(-512, 128) - unk_81C85B8 / 2;
          v3 = Random(-512, 512);
          SetNpChar(73, x, y, v3 + unk_81C85B4, v2, dir, 0, 0);
        }
        PlaySoundObject(56, 1);
      }
      unk_81C862C = 1;
    }
    if ( !(dword_81C8584 & 0x100) )
      unk_81C862C = 0;
    if ( dword_81C8584 & 0x400 )
      DamageMyChar(10);
    if ( ::dir )
    {
      unk_81C85AC += 512;
      if ( unk_81C85AC > 0x8000 )
        unk_81C85AC = 0x8000;
    }
    else
    {
      unk_81C85AC -= 512;
      if ( unk_81C85AC < -32768 )
        unk_81C85AC = -32768;
    }
    if ( gKey & gKeyUp && bKey )
    {
      unk_81C85B0 -= 512;
      if ( unk_81C85B0 < -32768 )
        unk_81C85B0 = -32768;
    }
    else if ( gKey & gKeyDown && bKey )
    {
      unk_81C85B0 += 512;
      if ( unk_81C85B0 > 0x8000 )
        unk_81C85B0 = 0x8000;
    }
    else
    {
      if ( unk_81C85B0 > 512 )
        unk_81C85B0 -= 512;
      if ( unk_81C85B0 < -512 )
        unk_81C85B0 += 512;
    }
    unk_81C85A4 = ::x + unk_81C85AC;
    unk_81C85A8 = y + unk_81C85B0;
    if ( unk_81C85B4 > resist || unk_81C85B4 < -resist )
      ::x += unk_81C85B4;
    y += unk_81C85B8;
  }
}

//----- (0805F817) --------------------------------------------------------
void __cdecl ActMyChar_Stream(bool bKey)
{
  unk_81C858C = 0;
  unk_81C8590 = 0;
  if ( bKey )
  {
    if ( (gKeyRight | gKeyLeft) & gKey )
    {
      if ( gKey & gKeyLeft )
        unk_81C85B4 -= 256;
      if ( gKey & gKeyRight )
        unk_81C85B4 += 256;
    }
    else if ( unk_81C85B4 > 127 || unk_81C85B4 < -127 )
    {
      if ( unk_81C85B4 <= 0 )
        unk_81C85B4 += unk_81C85B4 < 0 ? 0x80 : 0;
      else
        unk_81C85B4 -= 128;
    }
    else
    {
      unk_81C85B4 = 0;
    }
    if ( (gKeyDown | gKeyUp) & gKey )
    {
      if ( gKey & gKeyUp )
        unk_81C85B8 -= 256;
      if ( gKey & gKeyDown )
        unk_81C85B8 += 256;
    }
    else if ( unk_81C85B8 > 127 || unk_81C85B8 < -127 )
    {
      if ( unk_81C85B8 <= 0 )
        unk_81C85B8 += unk_81C85B8 < 0 ? 0x80 : 0;
      else
        unk_81C85B8 -= 128;
    }
    else
    {
      unk_81C85B8 = 0;
    }
  }
  else
  {
    if ( unk_81C85B4 > 127 || unk_81C85B4 < -63 )
    {
      if ( unk_81C85B4 <= 0 )
        unk_81C85B4 += unk_81C85B4 < 0 ? 0x80 : 0;
      else
        unk_81C85B4 -= 128;
    }
    else
    {
      unk_81C85B4 = 0;
    }
    if ( unk_81C85B8 > 127 || unk_81C85B8 < -63 )
    {
      if ( unk_81C85B8 <= 0 )
        unk_81C85B8 += unk_81C85B8 < 0 ? 0x80 : 0;
      else
        unk_81C85B8 -= 128;
    }
    else
    {
      unk_81C85B8 = 0;
    }
  }
  if ( unk_81C85B8 < -512 && dword_81C8584 & 2 )
    SetCaret(x, y - unk_81C85C8, 13, 5);
  if ( unk_81C85B8 > 512 && dword_81C8584 & 8 )
    SetCaret(x, unk_81C85D0 + y, 13, 5);
  if ( unk_81C85B4 > 1024 )
    unk_81C85B4 = 1024;
  if ( unk_81C85B4 < -1024 )
    unk_81C85B4 = -1024;
  if ( unk_81C85B8 > 1024 )
    unk_81C85B8 = 1024;
  if ( unk_81C85B8 < -1024 )
    unk_81C85B8 = -1024;
  if ( (gKey & (gKeyUp | gKeyLeft)) == (gKeyLeft | gKeyUp) )
  {
    if ( unk_81C85B4 < -780 )
      unk_81C85B4 = -780;
    if ( unk_81C85B8 < -780 )
      unk_81C85B8 = -780;
  }
  if ( (gKey & (gKeyUp | gKeyRight)) == (gKeyRight | gKeyUp) )
  {
    if ( unk_81C85B4 > 780 )
      unk_81C85B4 = 780;
    if ( unk_81C85B8 < -780 )
      unk_81C85B8 = -780;
  }
  if ( (gKey & (gKeyDown | gKeyLeft)) == (gKeyLeft | gKeyDown) )
  {
    if ( unk_81C85B4 < -780 )
      unk_81C85B4 = -780;
    if ( unk_81C85B8 > 780 )
      unk_81C85B8 = 780;
  }
  if ( (gKey & (gKeyDown | gKeyRight)) == (gKeyRight | gKeyDown) )
  {
    if ( unk_81C85B4 > 780 )
      unk_81C85B4 = 780;
    if ( unk_81C85B8 > 780 )
      unk_81C85B8 = 780;
  }
  x += unk_81C85B4;
  y += unk_81C85B8;
}

//----- (0805FCA5) --------------------------------------------------------
void AirProcess()
{
  if ( unk_81C8598 & 0x10 )
  {
    unk_81C8624 = 1000;
    unk_81C8628 = 0;
  }
  else
  {
    if ( dword_81C8584 & 0x100 )
    {
      if ( --unk_81C8624 <= 0 )
      {
        if ( (unsigned __int8)GetNPCFlag(4000) )
        {
          StartTextScript(1100);
        }
        else
        {
          StartTextScript(41);
          if ( dir )
            SetCaret(x, y, 8, 2);
          else
            SetCaret(x, y, 8, 0);
          gMC.cond &= 0x7Fu;
        }
      }
    }
    else
    {
      unk_81C8624 = 1000;
    }
    if ( dword_81C8584 & 0x100 )
    {
      unk_81C8628 = 60;
    }
    else if ( unk_81C8628 )
    {
      --unk_81C8628;
    }
  }
}

//----- (0805FDCB) --------------------------------------------------------
void __cdecl ActMyChar(bool bKey)
{
  if ( (gMC.cond & 0x80u) != 0 )
  {
    if ( unk_81C8608 )
      --unk_81C8608;
    if ( unk_81C8610 )
    {
      --unk_81C8610;
    }
    else if ( value )
    {
      SetValueView(&x, &y, value);
      value = 0;
    }
    if ( unk_81C8594 )
    {
      if ( unk_81C8594 == 1 )
        ActMyChar_Stream(bKey);
    }
    else
    {
      if ( !(g_GameFlags & 4) && bKey )
        AirProcess();
      ActMyChar_Normal(bKey);
    }
    gMC.cond &= 0xDFu;
  }
}

//----- (0805FE9D) --------------------------------------------------------
void __cdecl GetMyCharPosition(int *x, int *y)
{
  *x = ::x;
  *y = ::y;
}

//----- (0805FEB8) --------------------------------------------------------
void __cdecl SetMyCharPosition(int x, int y)
{
  ::x = x;
  ::y = y;
  unk_81C85A4 = x;
  unk_81C85A8 = y;
  unk_81C85AC = 0;
  unk_81C85B0 = 0;
  unk_81C85B4 = 0;
  unk_81C85B8 = 0;
  gMC.cond &= 0xFEu;
  InitStar();
}

//----- (0805FF20) --------------------------------------------------------
void __cdecl MoveMyChar(int x, int y)
{
  ::x = x;
  ::y = y;
}

//----- (0805FF35) --------------------------------------------------------
void ZeroMyCharXMove()
{
  unk_81C85B4 = 0;
}

//----- (0805FF44) --------------------------------------------------------
int GetUnitMyChar()
{
  return unk_81C8594;
}

//----- (0805FF4E) --------------------------------------------------------
void __cdecl SetMyCharDirect(unsigned __int8 dir)
{
  int i;

  if ( dir == 3 )
  {
    gMC.cond |= 1u;
LABEL_13:
    unk_81C85B4 = 0;
    AnimationMyChar(0);
    return;
  }
  gMC.cond &= 0xFEu;
  if ( dir <= 9u )
  {
    ::dir = dir;
    goto LABEL_13;
  }
  for ( i = 0; i <= 511 && gNPC[i].code_event != dir; ++i )
    ;
  if ( i != 512 )
  {
    if ( x <= gNPC[i].x )
      ::dir = 2;
    else
      ::dir = 0;
    goto LABEL_13;
  }
}

//----- (0806001C) --------------------------------------------------------
void __cdecl ChangeMyUnit(unsigned __int8 a)
{
  unk_81C8594 = a;
}

//----- (08060033) --------------------------------------------------------
void PitMyChar()
{
  y += 0x4000;
}

//----- (08060047) --------------------------------------------------------
void __cdecl EquipItem(int flag, bool b)
{
  if ( b )
    unk_81C8598 |= flag;
  else
    unk_81C8598 &= ~flag;
}

//----- (0806007B) --------------------------------------------------------
void ResetCheck()
{
  gMC.cond &= 0xFEu;
}

//----- (0806008F) --------------------------------------------------------
void __cdecl SetNoise(int no, int freq)
{
  _noise_freq = freq;
  _noise_no = no;
  if ( no == 1 )
  {
    ChangeSoundFrequency(40, _noise_freq);
    ChangeSoundFrequency(41, _noise_freq + 100);
    PlaySoundObject(40, -1);
    PlaySoundObject(41, -1);
  }
  else if ( no == 2 )
  {
    PlaySoundObject(58, -1);
  }
}

//----- (08060123) --------------------------------------------------------
void CutNoise()
{
  _noise_no = 0;
  PlaySoundObject(40, 0);
  PlaySoundObject(41, 0);
  PlaySoundObject(58, 0);
}

//----- (08060171) --------------------------------------------------------
void ResetNoise()
{
  if ( _noise_no == 1 )
  {
    ChangeSoundFrequency(40, _noise_freq);
    ChangeSoundFrequency(41, _noise_freq + 100);
    PlaySoundObject(40, -1);
    PlaySoundObject(41, -1);
  }
  else if ( _noise_no == 2 )
  {
    PlaySoundObject(58, -1);
  }
}

//----- (080601F5) --------------------------------------------------------
void SleepNoise()
{
  PlaySoundObject(40, 0);
  PlaySoundObject(41, 0);
  PlaySoundObject(58, 0);
}

//----- (0806023C) --------------------------------------------------------
void __cdecl ActNpc320(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  Sint32 *v2;
  RECT rcRight[3];
  RECT rcLeft[3];
  char v5[8];

  rcLeft[0].left = 16;
  rcLeft[0].top = 96;
  rcLeft[0].right = 32;
  rcLeft[0].bottom = 112;
  rcLeft[1].left = 48;
  rcLeft[1].top = 96;
  rcLeft[1].right = 64;
  rcLeft[1].bottom = 112;
  rcLeft[2].left = 96;
  rcLeft[2].top = 96;
  rcLeft[2].right = 112;
  rcLeft[2].bottom = 112;
  rcRight[0].left = 16;
  rcRight[0].top = 112;
  rcRight[0].right = 32;
  rcRight[0].bottom = 128;
  rcRight[1].left = 48;
  rcRight[1].top = 112;
  rcRight[1].right = 64;
  rcRight[1].bottom = 128;
  rcRight[2].left = 96;
  rcRight[2].top = 112;
  rcRight[2].right = 112;
  rcRight[2].bottom = 128;
  if ( !npc->act_no )
  {
    npc->act_no = 1;
    npc->x = x;
    npc->y = y;
    SetNpChar(321, 0, 0, 0, 0, 0, npc, 256);
  }
  if ( dword_81C8584 & 8 )
  {
    if ( unk_81C858C )
    {
      npc->tgt_x = x;
      npc->tgt_y = y - 5120;
      npc->ani_no = 1;
    }
    else
    {
      npc->ani_no = 0;
      if ( dir )
        npc->tgt_x = x - 3584;
      else
        npc->tgt_x = x + 3584;
      npc->tgt_y = y - 1536;
    }
  }
  else if ( unk_81C858C )
  {
    npc->tgt_x = x;
    npc->tgt_y = y + 4096;
    npc->ani_no = 2;
  }
  else if ( unk_81C8590 )
  {
    npc->tgt_x = x;
    npc->tgt_y = y - 4096;
    npc->ani_no = 1;
  }
  else
  {
    npc->ani_no = 0;
    if ( dir )
      npc->tgt_x = x - 3584;
    else
      npc->tgt_x = x + 3584;
    npc->tgt_y = y - 1536;
  }
  npc->x += (npc->tgt_x - npc->x) / 2;
  npc->y += (npc->tgt_y - npc->y) / 2;
  if ( unk_81C85C0 & 1 )
    npc->y -= 512;
  if ( dir )
  {
    v1 = npc;
    v2 = (Sint32 *)&v5[16 * npc->ani_no - 48];
  }
  else
  {
    v1 = npc;
    v2 = (Sint32 *)&v5[16 * npc->ani_no - 96];
  }
  npc->rect.left = *v2;
  v1->rect.top = v2[1];
  v1->rect.right = v2[2];
  v1->rect.bottom = v2[3];
}


//----- (080605A1) --------------------------------------------------------
void __cdecl ActNpc321(NPCHAR_0 *npc)
{
  int v1;
  bool v2;
  NPCHAR_0 *v3;
  Sint32 *v4;
  RECT rcRight[3];
  RECT rcLeft[3];
  int direct;
  char v8[8];

  rcLeft[0].left = 136;
  rcLeft[0].top = 152;
  rcLeft[0].right = 152;
  rcLeft[0].bottom = 168;
  rcLeft[1].left = 152;
  rcLeft[1].top = 152;
  rcLeft[1].right = 168;
  rcLeft[1].bottom = 168;
  rcLeft[2].left = 168;
  rcLeft[2].top = 152;
  rcLeft[2].right = 184;
  rcLeft[2].bottom = 168;
  rcRight[0].left = 136;
  rcRight[0].top = 168;
  rcRight[0].right = 152;
  rcRight[0].bottom = 184;
  rcRight[1].left = 152;
  rcRight[1].top = 168;
  rcRight[1].right = 168;
  rcRight[1].bottom = 184;
  rcRight[2].left = 168;
  rcRight[2].top = 168;
  rcRight[2].right = 184;
  rcRight[2].bottom = 184;
  if ( npc->pNpc )
  {
    v1 = npc->pNpc->ani_no;
    switch ( v1 )
    {
      case 1:
        npc->x = npc->pNpc->x;
        direct = 1;
        npc->y = npc->pNpc->y - 5120;
        break;
      case 2:
        npc->x = npc->pNpc->x;
        direct = 3;
        npc->y = npc->pNpc->y + 5120;
        break;
      case 0:
        if ( dir )
        {
          npc->x = npc->pNpc->x - 4096;
          direct = 0;
        }
        else
        {
          npc->x = npc->pNpc->x + 4096;
          direct = 2;
        }
        npc->y = npc->pNpc->y;
        break;
    }
    npc->ani_no = npc->pNpc->ani_no;
    v2 = g_GameFlags & 2 && CountBulletNum(43) <= 1 && gKeyTrg & gKeyShot;
    if ( v2 )
    {
      SetBullet(43, npc->pNpc->x, npc->pNpc->y, direct);
      SetCaret(npc->pNpc->x, npc->pNpc->y, 3, 0);
      PlaySoundObject(117, 1);
    }
    if ( dir )
    {
      v3 = npc;
      v4 = (Sint32 *)&v8[16 * npc->ani_no - 52];
    }
    else
    {
      v3 = npc;
      v4 = (Sint32 *)&v8[16 * npc->ani_no - 100];
    }
    npc->rect.left = *v4;
    v3->rect.top = v4[1];
    v3->rect.right = v4[2];
    v3->rect.bottom = v4[3];
  }
}


//----- (080608B6) --------------------------------------------------------
void __cdecl ActNpc322(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  int v3;
  RECT rc[3];
  char v5[8];

  rc[0].left = 272;
  rc[0].top = 216;
  rc[0].right = 296;
  rc[0].bottom = 240;
  rc[1].left = 296;
  rc[1].top = 216;
  rc[1].right = 320;
  rc[1].bottom = 240;
  rc[2].left = 160;
  rc[2].top = 216;
  rc[2].right = 184;
  rc[2].bottom = 240;
  if ( npc->act_no <= 1 && npc->life <= 968 )
  {
    npc->act_no = 2;
    npc->act_wait = 0;
    npc->bits &= 0xFFDFu;
    npc->bits |= 4u;
    PlaySoundObject(22, 1);
  }
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_10:
    if ( npc->shock )
      ++npc->count1;
    else
      npc->count1 = 0;
    v2 = (Sint32 *)&v5[16 * (npc->count1 / 2 % 2) - 48];
    npc->rect.left = *v2;
    npc->rect.top = v2[1];
    npc->rect.right = v2[2];
    npc->rect.bottom = v2[3];
    return;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      return;
    npc->act_no = 1;
    if ( npc->direct )
      npc->x += 4096;
    else
      npc->y += 4096;
    goto LABEL_10;
  }
  npc->ani_no = 2;
  v3 = npc->act_wait;
  if ( v3 == 100 )
  {
    SetNpChar(207, npc->x + 2048, npc->y, 0, 0, 2, 0, 384);
  }
  else if ( v3 > 100 )
  {
    switch ( v3 )
    {
      case 200:
        SetNpChar(207, npc->x + 2048, npc->y, 0, 0, 4, 0, 384);
        break;
      case 250:
        npc->hit.back = 24576;
        npc->hit.front = 24576;
        npc->hit.top = 24576;
        npc->hit.bottom = 24576;
        npc->damage = 12;
        PlaySoundObject(26, 1);
        SetDestroyNpChar(npc->x, npc->y, 24576, 40);
        SetQuake(10);
        if ( npc->direct )
        {
          DeleteMapParts((npc->x - 4096) / 0x2000, npc->y / 0x2000);
          DeleteMapParts((npc->x + 4096) / 0x2000, npc->y / 0x2000);
        }
        else
        {
          DeleteMapParts(npc->x / 0x2000, (npc->y - 4096) / 0x2000);
          DeleteMapParts(npc->x / 0x2000, (npc->y + 4096) / 0x2000);
        }
        npc->cond |= 8u;
        break;
      case 150:
        SetNpChar(207, npc->x + 2048, npc->y, 0, 0, 3, 0, 384);
        break;
    }
  }
  else if ( v3 )
  {
    if ( v3 == 50 )
      SetNpChar(207, npc->x + 2048, npc->y, 0, 0, 1, 0, 384);
  }
  else
  {
    SetNpChar(207, npc->x + 2048, npc->y, 0, 0, 0, 0, 384);
  }
  ++npc->act_wait;
  npc->rect.left = rc[2].left;
  npc->rect.top = rc[2].top;
  npc->rect.right = rc[2].right;
  npc->rect.bottom = rc[2].bottom;
}


//----- (08060DEC) --------------------------------------------------------
void __cdecl ActNpc323(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  RECT *v4;
  RECT rc[4];

  rc[0].left = 216;
  rc[0].top = 32;
  rc[0].right = 232;
  rc[0].bottom = 56;
  rc[1].left = 232;
  rc[1].top = 32;
  rc[1].right = 248;
  rc[1].bottom = 56;
  rc[2].left = 216;
  rc[2].top = 56;
  rc[2].right = 232;
  rc[2].bottom = 80;
  rc[3].left = 232;
  rc[3].top = 56;
  rc[3].right = 248;
  rc[3].bottom = 80;
  if ( ++npc->ani_wait > 3 )
  {
    npc->ani_wait = 0;
    if ( ++npc->ani_no > 3 )
      npc->ani_no = 0;
  }
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_38;
  }
  else
  {
    npc->act_no = 1;
    v2 = npc->direct;
    if ( v2 == 1 )
    {
      npc->ym = -1536;
    }
    else if ( v2 > 1 )
    {
      if ( v2 == 2 )
      {
        npc->xm = 1536;
      }
      else if ( v2 == 3 )
      {
        npc->ym = 1536;
      }
    }
    else if ( !v2 )
    {
      npc->xm = -1536;
    }
  }
  if ( ++npc->act_wait == 16 )
    npc->bits &= 0xFFF7u;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->flag & 0xFF )
    npc->act_no = 10;
  if ( npc->act_wait > 20 )
  {
    v3 = npc->direct;
    if ( v3 == 1 )
    {
      if ( npc->y <= y + 0x4000 )
        npc->act_no = 10;
    }
    else if ( v3 > 1 )
    {
      if ( v3 == 2 )
      {
        if ( npc->x >= x - 0x4000 )
          npc->act_no = 10;
      }
      else if ( v3 == 3 && npc->y >= y - 0x4000 )
      {
        npc->act_no = 10;
      }
    }
    else if ( !v3 && npc->x <= x + 0x4000 )
    {
      npc->act_no = 10;
    }
  }
LABEL_38:
  if ( npc->act_no == 10 )
  {
    npc->code_char = 309;
    npc->ani_no = 0;
    npc->act_no = 11;
    npc->bits |= 0x20u;
    npc->bits &= 0xFFF7u;
    npc->damage = 5;
    npc->view.top = 4096;
  }
  v4 = &rc[npc->ani_no];
  npc->rect.left = v4->left;
  npc->rect.top = v4->top;
  npc->rect.right = v4->right;
  npc->rect.bottom = v4->bottom;
}

//----- (080610E1) --------------------------------------------------------
void __cdecl ActNpc324(NPCHAR_0 *npc)
{
  int v1;

  v1 = npc->act_no;
  if ( v1 && v1 >= 0 )
  {
    if ( v1 == 10 )
    {
      npc->act_no = 11;
      npc->act_wait = 0;
    }
    else if ( v1 != 11 )
    {
      return;
    }
    if ( ++npc->act_wait % 50 == 1 )
      SetNpChar(323, npc->x, npc->y, 0, 0, npc->direct, 0, 256);
    if ( npc->act_wait > 351 )
      npc->act_no = 0;
  }
}

//----- (080611C5) --------------------------------------------------------
void __cdecl ActNpc325(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT rc[7];
  char v4[24];

  qmemcpy(rc, &ActNpc325(NPCHAR *)::C.5, sizeof(rc));
  v1 = npc->act_no;
  switch ( v1 )
  {
    case 1:
      goto LABEL_5;
    case 10:
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 6 )
      {
        npc->cond = 0;
        return;
      }
      break;
    case 0:
      npc->act_no = 1;
      PlaySoundObject(29, 1);
LABEL_5:
      if ( ++npc->ani_wait > 0 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 2 )
        npc->ani_no = 0;
      if ( ++npc->act_wait > 50 )
      {
        npc->act_no = 10;
        npc->ani_wait = 0;
        npc->ani_no = 3;
        npc->damage = 10;
        npc->view.front = 4096;
        npc->view.top = 6144;
        PlaySoundObject(101, 1);
        SetDestroyNpChar(npc->x, npc->y + 43008, 0, 3);
      }
      break;
  }
  v2 = (Sint32 *)&v4[16 * npc->ani_no - 112];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
}


//----- (0806138F) --------------------------------------------------------
void __cdecl ActNpc326(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  Sint32 *v2;
  RECT rcSu[8];
  RECT rcItoh[8];
  char v5[24];

  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->y -= 4096;
      npc->x += 0x2000;
      npc->ani_no = 0;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( ++npc->act_wait > 80 )
      {
        npc->act_no = 10;
        npc->act_wait = 0;
      }
      else if ( npc->direct )
      {
        if ( npc->act_wait == 50 )
          npc->ani_no = 1;
        if ( npc->act_wait == 60 )
          npc->ani_no = 0;
      }
      else
      {
        if ( npc->act_wait == 30 )
          npc->ani_no = 1;
        if ( npc->act_wait == 40 )
          npc->ani_no = 0;
      }
      break;
    case 0xA:
      if ( ++npc->act_wait > 50 )
      {
        npc->act_no = 15;
        npc->ani_no = 4;
        if ( npc->direct )
          npc->act_wait = -20;
        else
          npc->act_wait = 0;
      }
      else if ( npc->act_wait / 2 & 1 )
      {
        npc->ani_no = 2;
      }
      else
      {
        npc->ani_no = 3;
      }
      break;
    case 0xF:
      if ( ++npc->act_wait > 40 )
      {
        npc->act_wait = 0;
        npc->act_no = 20;
      }
      break;
    case 0x14:
      npc->ym += 64;
      if ( npc->ym > 1535 )
        npc->ym = 1535;
      npc->y += npc->ym;
      if ( ++npc->act_wait > 50 )
      {
        npc->act_no = 30;
        npc->act_wait = 0;
        npc->ani_no = 6;
        if ( npc->direct )
          SetNpChar(327, npc->x, npc->y - 4096, 0, 0, 0, npc, 256);
        else
          SetNpChar(327, npc->x, npc->y - 0x2000, 0, 0, 0, npc, 256);
      }
      break;
    case 0x1E:
      if ( ++npc->act_wait == 30 )
        npc->ani_no = 7;
      if ( npc->act_wait == 40 )
        npc->act_no = 40;
      break;
    case 0x28:
      npc->act_no = 41;
      npc->act_wait = 0;
      npc->ani_no = 0;
      goto LABEL_34;
    case 0x29:
LABEL_34:
      if ( ++npc->act_wait == 30 )
        npc->ani_no = 1;
      if ( npc->act_wait == 40 )
        npc->ani_no = 0;
      break;
    default:
      break;
  }
  qmemcpy(rcItoh, &ActNpc326(NPCHAR *)::C.10, sizeof(rcItoh));
  qmemcpy(rcSu, &ActNpc326(NPCHAR *)::C.11, sizeof(rcSu));
  if ( npc->direct )
  {
    v1 = npc;
    v2 = (Sint32 *)&v5[16 * npc->ani_no - 256];
  }
  else
  {
    v1 = npc;
    v2 = (Sint32 *)&v5[16 * npc->ani_no - 128];
  }
  npc->rect.left = *v2;
  v1->rect.top = v2[1];
  v1->rect.right = v2[2];
  v1->rect.bottom = v2[3];
}


//----- (080617CB) --------------------------------------------------------
void __cdecl ActNpc327(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  Sint32 *v4;
  RECT rc[2];
  char v6[8];

  rc[0].left = 240;
  rc[0].top = 80;
  rc[0].right = 256;
  rc[0].bottom = 96;
  rc[1].left = 256;
  rc[1].top = 80;
  rc[1].right = 272;
  rc[1].bottom = 96;
  ++npc->act_wait;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 == 1 )
    {
      if ( npc->act_wait > 47 )
      {
        npc->x = npc->tgt_x;
        npc->y = npc->tgt_y;
      }
      else
      {
        v2 = npc->tgt_x;
        npc->x = v2 + (Random(-1, 1) << 9);
        v3 = npc->tgt_y;
        npc->y = v3 + (Random(-1, 1) << 9);
      }
    }
  }
  else
  {
    if ( npc->act_wait <= 3 )
      npc->y -= 1024;
    if ( npc->pNpc->ani_no == 7 )
    {
      npc->ani_no = 1;
      npc->act_no = 1;
      npc->tgt_x = npc->x;
      npc->tgt_y = npc->y;
    }
  }
  if ( npc->act_wait > 70 )
    npc->cond = 0;
  v4 = (Sint32 *)&v6[16 * npc->ani_no - 32];
  npc->rect.left = *v4;
  npc->rect.top = v4[1];
  npc->rect.right = v4[2];
  npc->rect.bottom = v4[3];
}


//----- (08061944) --------------------------------------------------------
void __cdecl ActNpc328(NPCHAR_0 *npc)
{
  npc->rect.left = 96;
  npc->rect.top = 0;
  npc->rect.right = 128;
  npc->rect.bottom = 48;
}

//----- (08061983) --------------------------------------------------------
void __cdecl ActNpc329(NPCHAR_0 *npc)
{
  if ( ++npc->ani_wait / 2 & 1 )
  {
    npc->rect.left = 48;
    npc->rect.top = 0;
    npc->rect.right = 64;
  }
  else
  {
    npc->rect.left = 64;
    npc->rect.top = 0;
    npc->rect.right = 80;
  }
  npc->rect.bottom = 16;
}

//----- (08061A21) --------------------------------------------------------
void __cdecl ActNpc330(NPCHAR_0 *npc)
{
  Sint32 *v1;
  RECT rc[3];
  char v3[8];

  rc[0].left = 144;
  rc[0].top = 136;
  rc[0].right = 160;
  rc[0].bottom = 152;
  rc[1].left = 160;
  rc[1].top = 136;
  rc[1].right = 176;
  rc[1].bottom = 152;
  rc[2].left = 176;
  rc[2].top = 136;
  rc[2].right = 192;
  rc[2].bottom = 152;
  switch ( npc->act_no )
  {
    case 0:
      ChangeMapParts(npc->x / 0x2000, npc->y / 0x2000, 0);
      if ( npc->direct )
        npc->act_no = 30;
      else
        npc->act_no = 10;
      break;
    case 0xA:
      npc->xm -= 64;
      npc->ym = 0;
      if ( npc->flag & 1 )
        npc->act_no = 20;
      break;
    case 0x14:
      npc->xm = 0;
      npc->ym -= 64;
      if ( npc->flag & 2 )
        npc->act_no = 30;
      break;
    case 0x1E:
      npc->xm += 64;
      npc->ym = 0;
      if ( npc->flag & 4 )
        npc->act_no = 40;
      break;
    case 0x28:
      npc->xm = 0;
      npc->ym += 64;
      if ( npc->flag & 8 )
        npc->act_no = 10;
      break;
    default:
      break;
  }
  if ( npc->xm < -1024 )
    npc->xm = -1024;
  if ( npc->xm > 1024 )
    npc->xm = 1024;
  if ( npc->ym < -1024 )
    npc->ym = -1024;
  if ( npc->ym > 1024 )
    npc->ym = 1024;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( ++npc->ani_wait > 1 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 2 )
    npc->ani_no = 0;
  v1 = (Sint32 *)&v3[16 * npc->ani_no - 48];
  npc->rect.left = *v1;
  npc->rect.top = v1[1];
  npc->rect.right = v1[2];
  npc->rect.bottom = v1[3];
}


//----- (08061CC9) --------------------------------------------------------
void __cdecl ActNpc331(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  Sint32 *v3;
  RECT rc[4];
  char v5[8];

  rc[0].left = 288;
  rc[0].top = 80;
  rc[0].right = 304;
  rc[0].bottom = 96;
  rc[1].left = 304;
  rc[1].top = 80;
  rc[1].right = 320;
  rc[1].bottom = 96;
  rc[2].left = 288;
  rc[2].top = 96;
  rc[2].right = 304;
  rc[2].bottom = 112;
  rc[3].left = 304;
  rc[3].top = 96;
  rc[3].right = 320;
  rc[3].bottom = 112;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    if ( npc->flag & 8 )
    {
      npc->ym = -512;
      npc->act_no = 10;
    }
    goto LABEL_9;
  }
  if ( v1 != 10 )
  {
    if ( v1 )
      goto LABEL_9;
    npc->act_no = 1;
    goto LABEL_5;
  }
  if ( npc->flag & 8 )
  {
    npc->cond = 0;
    SetCaret(npc->x, npc->y, 2, 0);
  }
LABEL_9:
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->y += npc->ym;
  npc->x += npc->xm;
  if ( ++npc->ani_wait > 3 )
  {
    npc->ani_wait = 0;
    if ( npc->direct )
      v2 = npc->ani_no - 1;
    else
      v2 = npc->ani_no + 1;
    npc->ani_no = v2;
    if ( npc->ani_no < 0 )
      npc->ani_no += 4;
    if ( npc->ani_no > 3 )
      npc->ani_no -= 4;
  }
  v3 = (Sint32 *)&v5[16 * npc->ani_no - 64];
  npc->rect.left = *v3;
  npc->rect.top = v3[1];
  npc->rect.right = v3[2];
  npc->rect.bottom = v3[3];
}


//----- (08061EBB) --------------------------------------------------------
void __cdecl ActNpc332(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT rc[3];
  int xm;
  char v5[8];

  rc[0].left = 144;
  rc[0].top = 96;
  rc[0].right = 168;
  rc[0].bottom = 120;
  rc[1].left = 168;
  rc[1].top = 96;
  rc[1].right = 192;
  rc[1].bottom = 120;
  rc[2].left = 192;
  rc[2].top = 96;
  rc[2].right = 216;
  rc[2].bottom = 120;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_15;
  }
  else
  {
    PlaySoundObject(44, 1);
    npc->act_no = 1;
    if ( npc->direct )
      npc->xm = 1024;
    else
      npc->xm = -1024;
  }
  if ( ++npc->ani_wait > 1 )
  {
    npc->ani_wait = 0;
    if ( ++npc->ani_no > 2 )
      npc->ani_no = 0;
  }
  if ( ++npc->act_wait % 6 == 1 )
  {
    if ( npc->direct )
      xm = (Random(4, 16) << 9) / 8;
    else
      xm = (Random(-16, -4) << 9) / 8;
    SetNpChar(331, npc->x, npc->y, xm, -1024, 0, 0, 256);
    PlaySoundObject(12, 1);
  }
LABEL_15:
  if ( npc->flag & 1 )
    npc->cond = 0;
  if ( npc->flag & 4 )
    npc->cond = 0;
  npc->x += npc->xm;
  v2 = (Sint32 *)&v5[16 * npc->ani_no - 52];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
}


//----- (08062108) --------------------------------------------------------
void __cdecl ActNpc333(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT rc[2];
  char v4[8];

  rc[0].left = 80;
  rc[0].top = 120;
  rc[0].right = 104;
  rc[0].bottom = 144;
  rc[1].left = 104;
  rc[1].top = 120;
  rc[1].right = 128;
  rc[1].bottom = 144;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_13;
  }
  else
  {
    npc->act_no = 1;
    npc->tgt_x = npc->x;
    npc->tgt_y = npc->y;
    PlaySoundObject(103, 1);
    npc->y = y;
  }
  if ( ++npc->act_wait / 2 & 1 )
    npc->ani_no = 0;
  else
    npc->ani_no = 1;
  if ( !npc->direct && npc->act_wait == 20 )
    SetNpChar(146, npc->tgt_x, npc->tgt_y, 0, 0, 0, 0, 256);
  if ( npc->act_wait > 40 )
    npc->cond = 0;
LABEL_13:
  v2 = (Sint32 *)&v4[16 * npc->ani_no - 32];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
}


//----- (08062274) --------------------------------------------------------
void __cdecl ActNpc334(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  RECT *v3;
  RECT rcRight[2];
  RECT rcLeft[2];

  rcLeft[0].left = 160;
  rcLeft[0].top = 184;
  rcLeft[0].right = 168;
  rcLeft[0].bottom = 200;
  rcLeft[1].left = 168;
  rcLeft[1].top = 184;
  rcLeft[1].right = 176;
  rcLeft[1].bottom = 200;
  rcRight[0].left = 176;
  rcRight[0].top = 184;
  rcRight[0].right = 184;
  rcRight[0].bottom = 200;
  rcRight[1].left = 184;
  rcRight[1].top = 184;
  rcRight[1].right = 192;
  rcRight[1].bottom = 200;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 10 )
      goto LABEL_12;
  }
  else
  {
    npc->act_no = 10;
    if ( npc->direct )
    {
      npc->x = x - 5120;
      npc->y = y - 1024;
    }
    else
    {
      npc->x += 5120;
      npc->y -= 9216;
    }
  }
  if ( ++npc->act_wait / 8 & 1 )
    npc->ani_no = 0;
  else
    npc->ani_no = 1;
  if ( npc->act_wait > 63 )
    npc->cond = 0;
LABEL_12:
  if ( npc->direct )
  {
    v2 = npc;
    v3 = &rcRight[npc->ani_no];
  }
  else
  {
    v2 = npc;
    v3 = &rcLeft[npc->ani_no];
  }
  npc->rect.left = v3->left;
  v2->rect.top = v3->top;
  v2->rect.right = v3->right;
  v2->rect.bottom = v3->bottom;
}

//----- (0806240D) --------------------------------------------------------
void __cdecl ActNpc335(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT rc[3];
  char v4[8];

  rc[0].left = 0;
  rc[0].top = 16;
  rc[0].right = 16;
  rc[0].bottom = 32;
  rc[1].left = 16;
  rc[1].top = 16;
  rc[1].right = 32;
  rc[1].bottom = 32;
  rc[2].left = 32;
  rc[2].top = 16;
  rc[2].right = 48;
  rc[2].bottom = 32;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_9:
    if ( --npc->act_wait <= 0 )
    {
      npc->act_no = 2;
      npc->act_wait = Random(10, 50);
      npc->ani_no = 1;
      npc->xm = 1536;
    }
    goto LABEL_15;
  }
  if ( v1 <= 1 )
  {
    if ( v1 )
      goto LABEL_15;
    npc->act_no = 1;
    npc->act_wait = Random(3, 20);
    goto LABEL_9;
  }
  if ( v1 == 2 )
  {
    if ( --npc->act_wait <= 0 )
    {
      npc->act_no = 3;
      npc->act_wait = Random(40, 50);
      npc->ani_no = 2;
      npc->ym = Random(-256, 256);
    }
  }
  else if ( v1 == 3 && --npc->act_wait <= 0 )
  {
    npc->act_no = 1;
    npc->act_wait = 0;
    npc->ani_no = 0;
  }
LABEL_15:
  npc->xm -= 16;
  npc->x += npc->xm;
  npc->y += npc->ym;
  v2 = (Sint32 *)&v4[16 * npc->ani_no - 48];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
}


//----- (0806261E) --------------------------------------------------------
void __cdecl ActNpc336(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;

  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 == 10 && ++npc->act_wait % 4 == 1 )
    {
      v2 = npc->y;
      v3 = Random(0, 13);
      SetNpChar(335, npc->x, v2 + (v3 << 13), 0, 0, 0, 0, 0);
    }
  }
  else if ( unk_81C8610 )
  {
    npc->cond = 0;
  }
}

//----- (080626ED) --------------------------------------------------------
void __cdecl ActNpc337(NPCHAR_0 *npc)
{
  int v1;
  RECT *v2;
  RECT rcLeft[2];

  rcLeft[0].left = 256;
  rcLeft[0].top = 112;
  rcLeft[0].right = 288;
  rcLeft[0].bottom = 152;
  rcLeft[1].left = 288;
  rcLeft[1].top = 112;
  rcLeft[1].right = 320;
  rcLeft[1].bottom = 152;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    npc->xm = 0;
    npc->act_no = 2;
    npc->ani_no = 0;
    goto LABEL_6;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_10;
    npc->act_no = 1;
    npc->y -= 4096;
    goto LABEL_5;
  }
LABEL_6:
  if ( ++npc->ani_wait > 50 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 1 )
    npc->ani_no = 0;
LABEL_10:
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  v2 = &rcLeft[npc->ani_no];
  npc->rect.left = v2->left;
  npc->rect.top = v2->top;
  npc->rect.right = v2->right;
  npc->rect.bottom = v2->bottom;
}

//----- (0806283F) --------------------------------------------------------
void __cdecl ActNpc338(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  NPCHAR_0 *v4;
  Sint32 *v5;
  RECT rcRight[2];
  RECT rcLeft[2];
  char v8[8];

  rcLeft[0].left = 288;
  rcLeft[0].top = 0;
  rcLeft[0].right = 304;
  rcLeft[0].bottom = 16;
  rcLeft[1].left = 304;
  rcLeft[1].top = 0;
  rcLeft[1].right = 320;
  rcLeft[1].bottom = 16;
  rcRight[0].left = 288;
  rcRight[0].top = 16;
  rcRight[0].right = 304;
  rcRight[0].bottom = 32;
  rcRight[1].left = 304;
  rcRight[1].top = 16;
  rcRight[1].right = 320;
  rcRight[1].bottom = 32;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_24;
  }
  else
  {
    npc->act_no = 1;
    npc->view.top = 4096;
    npc->view.bottom = 4096;
    npc->damage = 3;
    npc->bits |= 0x20u;
    npc->tgt_y = npc->y;
    npc->ym = (Random(-10, 10) << 9) / 2;
  }
  if ( ++npc->ani_wait > 2 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 1 )
    npc->ani_no = 0;
  if ( npc->y >= npc->tgt_y )
    v2 = npc->ym - 128;
  else
    v2 = npc->ym + 128;
  npc->ym = v2;
  if ( npc->direct )
    v3 = npc->xm + 32;
  else
    v3 = npc->xm - 32;
  npc->xm = v3;
  if ( npc->xm > 1024 )
    npc->xm = 1024;
  if ( npc->xm < -1024 )
    npc->xm = -1024;
  if ( npc->x < 0 || npc->y < 0 || npc->x > gMap.width << 13 || npc->y > gMap.length << 13 )
  {
    VanishNpChar(npc);
    return;
  }
LABEL_24:
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v4 = npc;
    v5 = (Sint32 *)&v8[16 * npc->ani_no - 64];
  }
  else
  {
    v4 = npc;
    v5 = (Sint32 *)&v8[16 * npc->ani_no - 32];
  }
  npc->rect.left = *v5;
  v4->rect.top = v5[1];
  v4->rect.right = v5[2];
  v4->rect.bottom = v5[3];
}


//----- (08062AF5) --------------------------------------------------------
void __cdecl ActNpc339(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;

  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      return;
  }
  else
  {
    npc->act_no = 1;
    npc->act_wait = Random(0, 40);
  }
  if ( npc->act_wait )
  {
    --npc->act_wait;
  }
  else
  {
    npc->act_no = 0;
    v2 = npc->direct;
    v3 = npc->y;
    v4 = Random(-16, 16);
    SetNpChar(338, npc->x, v3 + (v4 << 9), 0, 0, v2, 0, 256);
  }
}

//----- (08062BC8) --------------------------------------------------------
void InitBossLife()
{
  gBL.flag = 0;
}

//----- (08062BD7) --------------------------------------------------------
signed int __cdecl StartBossLife(int code_event)
{
  char v1;
  int i;

  for ( i = 0; ; ++i )
  {
    v1 = i > 511 || gNPC[i].code_event == code_event ? 0 : 1;
    if ( !v1 )
      break;
  }
  if ( i == 512 )
    return 0;
  gBL.flag = 1;
  gBL.max = gNPC[i].life;
  gBL.br = gNPC[i].life;
  gBL.pLife = (int *)(172 * i + 136142240);
  return 1;
}

//----- (08062C76) --------------------------------------------------------
signed int StartBossLife2()
{
  gBL.flag = 1;
  gBL.max = unk_81CD000;
  gBL.br = unk_81CD000;
  gBL.pLife = (_DWORD *)&unk_81CD000;
  return 1;
}

//----- (08062CA8) --------------------------------------------------------
void PutBossLife()
{
  RECT rcBr;
  RECT rcLife;
  RECT rcBox2;
  RECT rcBox1;
  RECT rcText;

  rcText.left = 0;
  rcText.top = 48;
  rcText.right = 32;
  rcText.bottom = 56;
  rcBox1.left = 0;
  rcBox1.top = 0;
  rcBox1.right = 244;
  rcBox1.bottom = 8;
  rcBox2.left = 0;
  rcBox2.top = 16;
  rcBox2.right = 244;
  rcBox2.bottom = 24;
  rcLife.left = 0;
  rcLife.top = 24;
  rcLife.right = 0;
  rcLife.bottom = 32;
  rcBr.left = 0;
  rcBr.top = 32;
  rcBr.right = 232;
  rcBr.bottom = 40;
  if ( gBL.flag )
  {
    if ( *gBL.pLife > 0 )
    {
      rcLife.right = 198 * *gBL.pLife / gBL.max;
      if ( gBL.br <= *gBL.pLife )
      {
        gBL.count = 0;
      }
      else if ( ++gBL.count > 30 )
      {
        --gBL.br;
      }
      rcBr.right = 198 * gBL.br / gBL.max;
      PutBitmap3(&grcGame, 32, 220, &rcBox1, 26);
      PutBitmap3(&grcGame, 32, 228, &rcBox2, 26);
      PutBitmap3(&grcGame, 72, 224, &rcBr, 26);
      PutBitmap3(&grcGame, 72, 224, &rcLife, 26);
      PutBitmap3(&grcGame, 40, 224, &rcText, 26);
    }
    else
    {
      gBL.flag = 0;
    }
  }
}

//----- (08062EC4) --------------------------------------------------------
void InitFlags()
{
  memset(gFlagNPC, 0, 0x3E8u);
}

//----- (08062EE8) --------------------------------------------------------
void InitSkipFlags()
{
  memset(gSkipFlag, 0, 8u);
}

//----- (08062F0C) --------------------------------------------------------
void __cdecl SetNPCFlag(int a)
{
  gFlagNPC[a / 8] |= 1 << a % 8;
}

//----- (08062F5A) --------------------------------------------------------
void __cdecl CutNPCFlag(int a)
{
  gFlagNPC[a / 8] &= ~(1 << a % 8);
}

//----- (08062FAA) --------------------------------------------------------
_BOOL4 __cdecl GetNPCFlag(int a)
{
  return (((signed int)gFlagNPC[a / 8] >> a % 8) & 1) != 0;
}

//----- (08062FF9) --------------------------------------------------------
void __cdecl SetSkipFlag(int a)
{
  gSkipFlag[a / 8] |= 1 << a % 8;
}

//----- (08063047) --------------------------------------------------------
void __cdecl CutSkipFlag(int a)
{
  gSkipFlag[a / 8] &= ~(1 << a % 8);
}

//----- (08063097) --------------------------------------------------------
_BOOL4 __cdecl GetSkipFlag(int a)
{
  return (((signed int)gSkipFlag[a / 8] >> a % 8) & 1) != 0;
}

//----- (080630E8) --------------------------------------------------------
void __cdecl _ActBossChar_Eye(NPCHAR_0 *npc)
{
  int v1;
  unsigned __int16 v2;
  NPCHAR_0 *v3;
  Sint32 *v4;
  RECT rcRight[5];
  RECT rcLeft[5];
  char v7[24];

  qmemcpy(rcLeft, &_ActBossChar_Eye(NPCHAR *)::C.0, sizeof(rcLeft));
  qmemcpy(rcRight, &_ActBossChar_Eye(NPCHAR *)::C.1, sizeof(rcRight));
  v1 = npc->act_no;
  if ( v1 == 102 )
  {
    npc->ani_no = 3;
    goto LABEL_27;
  }
  if ( v1 > 102 )
  {
    if ( v1 != 201 )
    {
      if ( v1 > 201 )
      {
        if ( v1 != 202 && v1 == 300 )
        {
          npc->act_no = 301;
          npc->ani_no = 4;
          if ( npc->direct )
            SetDestroyNpChar(npc->x + 2048, npc->y, 2048, 10);
          else
            SetDestroyNpChar(npc->x - 2048, npc->y, 2048, 10);
        }
        goto LABEL_27;
      }
      if ( v1 != 200 )
        goto LABEL_27;
      npc->act_no = 201;
      npc->ani_no = 3;
      npc->ani_wait = 0;
    }
    if ( ++npc->ani_wait > 2 )
    {
      npc->ani_wait = 0;
      --npc->ani_no;
    }
    if ( npc->ani_no <= 0 )
      npc->act_no = 202;
    goto LABEL_27;
  }
  if ( v1 == 100 )
  {
    npc->act_no = 101;
    npc->ani_no = 0;
    npc->ani_wait = 0;
  }
  else if ( v1 <= 100 )
  {
    goto LABEL_27;
  }
  if ( ++npc->ani_wait > 2 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 2 )
    npc->act_no = 102;
LABEL_27:
  if ( npc->direct )
    npc->x = unk_81CCFC8 + 12288;
  else
    npc->x = unk_81CCFC8 - 12288;
  npc->y = unk_81CCFCC - 18432;
  if ( npc->act_no >= 0 && npc->act_no <= 299 )
  {
    if ( npc->ani_no == 3 )
      v2 = npc->bits | 0x20;
    else
      v2 = npc->bits & 0xFFDF;
    npc->bits = v2;
  }
  if ( npc->direct )
  {
    v3 = npc;
    v4 = (Sint32 *)&v7[16 * npc->ani_no - 160];
  }
  else
  {
    v3 = npc;
    v4 = (Sint32 *)&v7[16 * npc->ani_no - 80];
  }
  npc->rect.left = *v4;
  v3->rect.top = v4[1];
  v3->rect.right = v4[2];
  v3->rect.bottom = v4[3];
}


//----- (080633EF) --------------------------------------------------------
void __cdecl _ActBossChar_Body(NPCHAR_0 *npc)
{
  RECT *v1;
  RECT rc[4];

  rc[0].left = 0;
  rc[0].top = 0;
  rc[0].right = 120;
  rc[0].bottom = 120;
  rc[1].left = 120;
  rc[1].top = 0;
  rc[1].right = 240;
  rc[1].bottom = 120;
  rc[2].left = 0;
  rc[2].top = 120;
  rc[2].right = 120;
  rc[2].bottom = 240;
  rc[3].left = 120;
  rc[3].top = 120;
  rc[3].right = 240;
  rc[3].bottom = 240;
  npc->x = unk_81CCFC8;
  npc->y = unk_81CCFCC;
  v1 = &rc[npc->ani_no];
  npc->rect.left = v1->left;
  npc->rect.top = v1->top;
  npc->rect.right = v1->right;
  npc->rect.bottom = v1->bottom;
}

//----- (080634A9) --------------------------------------------------------
void __cdecl _ActBossChar_HITAI(NPCHAR_0 *npc)
{
  npc->x = unk_81CCFC8;
  npc->y = unk_81CCFCC - 22528;
}

//----- (080634CB) --------------------------------------------------------
void __cdecl _ActBossChar_HARA(NPCHAR_0 *npc)
{
  npc->x = unk_81CCFC8;
  npc->y = unk_81CCFCC;
}

//----- (080634E8) --------------------------------------------------------
void ActBossChar_Ballos()
{
  int v0;
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  int x;
  int v9;
  int v10;
  int v11;
  int v12;
  int v13;
  int v14;
  int v15;
  int v16;
  int v17;
  int v18;
  int v19;
  int v20;
  int v21;
  int v22;
  int v23;
  int v24;
  int v25;
  int v26;
  int i;
  int ia;
  int ib;
  signed int ic;
  signed int id;
  int ie;
  int ig;
  int ih;
  int ii;

  v0 = gBoss[0].act_no;
  if ( v0 == 312 )
  {
    gBoss[0].direct = 1;
    gBoss[0].ym = -938;
    gBoss[0].xm = 0;
    gBoss[0].y += gBoss[0].ym;
    if ( gBoss[0].y <= 56831 )
    {
      gBoss[0].y = 56832;
      gBoss[0].act_no = 313;
    }
    goto LABEL_171;
  }
  if ( v0 > 312 )
  {
    if ( v0 == 422 )
    {
      if ( ++gBoss[0].ani_wait > 200 )
      {
        gBoss[0].ani_wait = 0;
        gBoss[0].act_no = 423;
      }
      goto LABEL_171;
    }
    if ( v0 <= 422 )
    {
      if ( v0 != 401 )
      {
        if ( v0 > 401 )
        {
          if ( v0 == 411 )
          {
            if ( ++gBoss[0].act_wait % 30 == 1 )
              SetNpChar(348, (gBoss[0].act_wait / 30 + 1) << 14, 172032, 0, 0, 0, 0, 384);
            if ( gBoss[0].act_wait / 3 & 1 )
              PlaySoundObject(26, 1);
            if ( gBoss[0].act_wait > 540 )
              gBoss[0].act_no = 420;
          }
          else if ( v0 > 411 )
          {
            if ( v0 == 420 )
            {
              gBoss[0].act_no = 421;
              gBoss[0].act_wait = 0;
              gBoss[0].ani_wait = 0;
              SetQuake2(30);
              PlaySoundObject(35, 1);
              npc.act_no = 102;
              stru_81CD118.act_no = 102;
              for ( ie = 0; ie <= 255; ++ie )
              {
                v7 = gBoss[0].x;
                x = v7 + (Random(-60, 60) << 9);
                v9 = gBoss[0].y;
                v10 = Random(-60, 60);
                SetNpChar(4, x, v9 + (v10 << 9), 0, 0, 0, 0, 0);
              }
            }
            else if ( v0 != 421 )
            {
              goto LABEL_171;
            }
            if ( ++gBoss[0].ani_wait > 500 )
            {
              gBoss[0].ani_wait = 0;
              gBoss[0].act_no = 422;
            }
          }
          else if ( v0 == 410 && ++gBoss[0].act_wait > 50 )
          {
            gBoss[0].act_wait = 0;
            gBoss[0].act_no = 411;
          }
          goto LABEL_171;
        }
        if ( v0 == 314 )
        {
          gBoss[0].direct = 3;
          gBoss[0].ym = 938;
          gBoss[0].xm = 0;
          gBoss[0].y += gBoss[0].ym;
          if ( gBoss[0].y > 115200 )
          {
            gBoss[0].y = 115200;
            gBoss[0].act_no = 311;
          }
          goto LABEL_171;
        }
        if ( v0 < 314 )
        {
          gBoss[0].direct = 2;
          gBoss[0].xm = 938;
          gBoss[0].ym = 0;
          gBoss[0].x += gBoss[0].xm;
          if ( gBoss[0].x > 262656 )
          {
            gBoss[0].x = 262656;
            gBoss[0].act_no = 314;
          }
          if ( gBoss[0].count1 )
            --gBoss[0].count1;
          if ( !gBoss[0].count1 && gBoss[0].x > 155648 && gBoss[0].x <= 172031 )
            gBoss[0].act_no = 400;
          goto LABEL_171;
        }
        if ( v0 != 400 )
          goto LABEL_171;
        gBoss[0].act_no = 401;
        gBoss[0].act_wait = 0;
        gBoss[0].xm = 0;
        gBoss[0].ym = 0;
        DeleteNpCharCode(339, 0);
      }
      gBoss[0].y += (81408 - gBoss[0].y) / 8;
      if ( ++gBoss[0].act_wait > 50 )
      {
        gBoss[0].act_wait = 0;
        gBoss[0].act_no = 410;
        for ( id = 0; id <= 255; id += 32 )
          SetNpChar(346, gBoss[0].x, gBoss[0].y, 0, 0, id, gBoss, 80);
        SetNpChar(343, gBoss[0].x, gBoss[0].y, 0, 0, 0, gBoss, 24);
        SetNpChar(344, gBoss[0].x - 12288, gBoss[0].y - 18432, 0, 0, 0, gBoss, 32);
        SetNpChar(344, gBoss[0].x + 12288, gBoss[0].y - 18432, 0, 0, 2, gBoss, 32);
      }
      goto LABEL_171;
    }
    if ( v0 == 427 )
    {
      if ( ++gBoss[0].ani_wait > 20 )
      {
        gBoss[0].ani_wait = 0;
        gBoss[0].act_no = 428;
      }
    }
    else
    {
      if ( v0 <= 427 )
      {
        if ( v0 == 424 )
        {
          if ( ++gBoss[0].ani_wait > 200 )
          {
            gBoss[0].ani_wait = 0;
            gBoss[0].act_no = 425;
          }
        }
        else if ( v0 < 424 )
        {
          if ( ++gBoss[0].ani_wait > 20 )
          {
            gBoss[0].ani_wait = 0;
            gBoss[0].act_no = 424;
          }
        }
        else if ( v0 == 425 )
        {
          if ( ++gBoss[0].ani_wait > 500 )
          {
            gBoss[0].ani_wait = 0;
            gBoss[0].act_no = 426;
          }
        }
        else if ( v0 == 426 && ++gBoss[0].ani_wait > 200 )
        {
          gBoss[0].ani_wait = 0;
          gBoss[0].act_no = 427;
        }
        goto LABEL_171;
      }
      if ( v0 == 1000 )
      {
        gBoss[0].act_no = 1001;
        gBoss[0].act_wait = 0;
        npc.act_no = 300;
        stru_81CD118.act_no = 300;
        unk_81CD010 &= 0xFFBEu;
        stru_81CD1C4.bits &= 0xFFBEu;
        stru_81CD270.bits &= 0xFFBEu;
        stru_81CD31C.bits &= 0xFFBEu;
      }
      else
      {
        if ( v0 <= 1000 )
        {
          if ( v0 == 428 && ++gBoss[0].ani_wait > 200 )
          {
            gBoss[0].ani_wait = 0;
            gBoss[0].act_no = 421;
          }
          goto LABEL_171;
        }
        if ( v0 != 1001 )
        {
          if ( v0 == 1002 )
          {
            SetQuake2(40);
            if ( ++dword_81CD038 == 50 )
            {
              gBoss[0].cond = 0;
              npc.cond = 0;
              stru_81CD118.cond = 0;
              stru_81CD1C4.cond = 0;
              stru_81CD270.cond = 0;
              stru_81CD31C.cond = 0;
              DeleteNpCharCode(350, 1);
              DeleteNpCharCode(348, 1);
            }
          }
          goto LABEL_171;
        }
      }
      if ( !(++dword_81CD038 % 12) )
        PlaySoundObject(44, 1);
      v11 = unk_81CCFCC;
      v12 = (Random(-60, 60) << 9) + v11;
      v13 = unk_81CCFC8;
      v14 = Random(-60, 60);
      SetDestroyNpChar(v13 + (v14 << 9), v12, 1, 1);
      if ( dword_81CD038 > 150 )
      {
        dword_81CD038 = 0;
        unk_81CD034 = 1002;
        SetFlash(unk_81CCFC8, unk_81CCFCC, 1);
        PlaySoundObject(35, 1);
      }
    }
  }
  else
  {
    if ( v0 == 201 )
    {
LABEL_80:
      gBoss[0].act_no = 203;
      gBoss[0].xm = 0;
      ++gBoss[0].count1;
      gBoss[0].hit.bottom = 24576;
      gBoss[0].damage = 0;
      if ( gBoss[0].count1 % 3 )
        gBoss[0].act_wait = 50;
      else
        gBoss[0].act_wait = 150;
LABEL_83:
      if ( --gBoss[0].act_wait <= 0 )
      {
        gBoss[0].act_no = 204;
        gBoss[0].ym = -3072;
        if ( gBoss[0].x >= ::x )
          gBoss[0].xm = -512;
        else
          gBoss[0].xm = 512;
      }
      goto LABEL_171;
    }
    if ( v0 > 201 )
    {
      if ( v0 == 222 )
        goto LABEL_171;
      if ( v0 > 222 )
      {
        if ( v0 != 301 )
        {
          if ( v0 > 301 )
          {
            if ( v0 != 310 && v0 == 311 )
            {
              gBoss[0].direct = 0;
              gBoss[0].xm = -938;
              gBoss[0].ym = 0;
              gBoss[0].x += gBoss[0].xm;
              if ( gBoss[0].x <= 56831 )
              {
                gBoss[0].x = 56832;
                gBoss[0].act_no = 312;
              }
            }
            goto LABEL_171;
          }
          if ( v0 != 300 )
            goto LABEL_171;
          gBoss[0].act_no = 301;
          gBoss[0].act_wait = 0;
          for ( ic = 0; ic <= 255; ic += 64 )
          {
            SetNpChar(342, gBoss[0].x, gBoss[0].y, 0, 0, ic, gBoss, 90);
            SetNpChar(342, gBoss[0].x, gBoss[0].y, 0, 0, ic + 544, gBoss, 90);
          }
          SetNpChar(343, gBoss[0].x, gBoss[0].y, 0, 0, 0, gBoss, 24);
          SetNpChar(344, gBoss[0].x - 12288, gBoss[0].y - 18432, 0, 0, 0, gBoss, 32);
          SetNpChar(344, gBoss[0].x + 12288, gBoss[0].y - 18432, 0, 0, 2, gBoss, 32);
        }
        gBoss[0].y += (115200 - gBoss[0].y) / 8;
        if ( ++gBoss[0].act_wait > 50 )
        {
          gBoss[0].act_no = 310;
          gBoss[0].act_wait = 0;
        }
        goto LABEL_171;
      }
      if ( v0 == 204 )
      {
        if ( gBoss[0].x <= 40959 )
          gBoss[0].xm = 512;
        if ( gBoss[0].x > 278528 )
          gBoss[0].xm = -512;
        gBoss[0].ym += 85;
        if ( gBoss[0].ym > 3072 )
          gBoss[0].ym = 3072;
        gBoss[0].x += gBoss[0].xm;
        gBoss[0].y += gBoss[0].ym;
        if ( gBoss[0].y > 155648 - gBoss[0].hit.bottom )
        {
          gBoss[0].y = 155648 - gBoss[0].hit.bottom;
          gBoss[0].ym = 0;
          gBoss[0].act_no = 201;
          gBoss[0].act_wait = 0;
          if ( y > gBoss[0].y + 28672 )
            DamageMyChar(16);
          if ( dword_81C8584 & 8 )
            unk_81C85B8 = -512;
          SetQuake2(30);
          PlaySoundObject(26, 1);
          SetNpChar(332, gBoss[0].x - 6144, gBoss[0].y + 26624, 0, 0, 0, 0, 256);
          SetNpChar(332, gBoss[0].x + 6144, gBoss[0].y + 26624, 0, 0, 2, 0, 256);
          PlaySoundObject(44, 1);
          for ( ia = 0; ia <= 15; ++ia )
          {
            v3 = gBoss[0].x;
            v4 = Random(-40, 40);
            SetNpChar(4, v3 + (v4 << 9), gBoss[0].y + 20480, 0, 0, 0, 0, 256);
          }
        }
      }
      else
      {
        if ( v0 <= 204 )
        {
          if ( v0 != 203 )
            goto LABEL_171;
          goto LABEL_83;
        }
        if ( v0 == 220 )
        {
          gBoss[0].act_no = 221;
          gBoss[0].life = 1200;
          npc.act_no = 200;
          stru_81CD118.act_no = 200;
          gBoss[0].xm = 0;
          gBoss[0].ani_no = 0;
          gBoss[0].shock = 0;
          ActBossChar_Ballos(void)::_flash = 0;
        }
        else if ( v0 != 221 )
        {
          goto LABEL_171;
        }
        gBoss[0].ym += 64;
        if ( gBoss[0].ym > 3072 )
          gBoss[0].ym = 3072;
        gBoss[0].y += gBoss[0].ym;
        if ( gBoss[0].y > 155648 - gBoss[0].hit.bottom )
        {
          gBoss[0].y = 155648 - gBoss[0].hit.bottom;
          gBoss[0].ym = 0;
          gBoss[0].act_no = 222;
          gBoss[0].act_wait = 0;
          SetQuake2(30);
          PlaySoundObject(26, 1);
          for ( ib = 0; ib <= 15; ++ib )
          {
            v5 = gBoss[0].x;
            v6 = Random(-40, 40);
            SetNpChar(4, v5 + (v6 << 9), gBoss[0].y + 20480, 0, 0, 0, 0, 256);
          }
          if ( dword_81C8584 & 8 )
            unk_81C85B8 = -512;
        }
      }
    }
    else
    {
      if ( v0 == 101 )
      {
LABEL_63:
        if ( ++gBoss[0].act_wait > 30 )
          gBoss[0].act_no = 102;
        goto LABEL_171;
      }
      if ( v0 <= 101 )
      {
        if ( v0 == 1 )
          goto LABEL_171;
        if ( v0 != 100 )
        {
          if ( !v0 )
          {
            gBoss[0].act_no = 1;
            gBoss[0].cond = -128;
            gBoss[0].exp = 1;
            gBoss[0].direct = 0;
            gBoss[0].x = 163840;
            gBoss[0].y = -32768;
            gBoss[0].hit_voice = 54;
            gBoss[0].hit.front = 0x4000;
            gBoss[0].hit.top = 24576;
            gBoss[0].hit.back = 0x4000;
            gBoss[0].hit.bottom = 24576;
            gBoss[0].bits = -32184;
            gBoss[0].size = 3;
            gBoss[0].damage = 0;
            gBoss[0].code_event = 1000;
            gBoss[0].life = 800;
            npc.cond = -112;
            npc.direct = 0;
            npc.bits = 8;
            npc.life = 10000;
            npc.view.front = 6144;
            npc.view.top = 0;
            npc.view.back = 6144;
            npc.view.bottom = 0x2000;
            npc.hit.front = 6144;
            npc.hit.top = 0;
            npc.hit.back = 6144;
            npc.hit.bottom = 0x2000;
            qmemcpy(&stru_81CD118, &npc, sizeof(stru_81CD118));
            stru_81CD118.direct = 2;
            stru_81CD1C4.cond = -112;
            stru_81CD1C4.bits = 13;
            stru_81CD1C4.view.front = 30720;
            stru_81CD1C4.view.top = 30720;
            stru_81CD1C4.view.back = 30720;
            stru_81CD1C4.view.bottom = 30720;
            stru_81CD1C4.hit.front = 24576;
            stru_81CD1C4.hit.top = 12288;
            stru_81CD1C4.hit.back = 24576;
            stru_81CD1C4.hit.bottom = 0x4000;
            stru_81CD270.cond = -112;
            stru_81CD270.bits = 13;
            stru_81CD270.hit.front = 0x4000;
            stru_81CD270.hit.top = 4096;
            stru_81CD270.hit.back = 0x4000;
            stru_81CD270.hit.bottom = 4096;
            stru_81CD31C.cond = -112;
            stru_81CD31C.bits = 76;
            stru_81CD31C.hit.front = 0x4000;
            stru_81CD31C.hit.top = 0;
            stru_81CD31C.hit.back = 0x4000;
            stru_81CD31C.hit.bottom = 24576;
          }
          goto LABEL_171;
        }
        gBoss[0].act_no = 101;
        gBoss[0].ani_no = 0;
        gBoss[0].x = ::x;
        SetNpChar(333, ::x, 155648, 0, 0, 2, 0, 256);
        gBoss[0].act_wait = 0;
        goto LABEL_63;
      }
      if ( v0 == 103 )
      {
        if ( ++gBoss[0].act_wait == 50 )
        {
          gBoss[0].act_no = 104;
          npc.act_no = 100;
          stru_81CD118.act_no = 100;
        }
      }
      else
      {
        if ( v0 >= 103 )
        {
          if ( v0 == 104 || v0 != 200 )
            goto LABEL_171;
          gBoss[0].act_no = 201;
          gBoss[0].count1 = 0;
          goto LABEL_80;
        }
        gBoss[0].ym += 64;
        if ( gBoss[0].ym > 3072 )
          gBoss[0].ym = 3072;
        gBoss[0].y += gBoss[0].ym;
        if ( gBoss[0].y > 155648 - gBoss[0].hit.bottom )
        {
          gBoss[0].y = 155648 - gBoss[0].hit.bottom;
          gBoss[0].ym = 0;
          gBoss[0].act_no = 103;
          gBoss[0].act_wait = 0;
          SetQuake2(30);
          PlaySoundObject(44, 1);
          if ( y > gBoss[0].y + 24576 && ::x < gBoss[0].x + 12288 && ::x > gBoss[0].x - 12288 )
            DamageMyChar(16);
          for ( i = 0; i <= 15; ++i )
          {
            v1 = gBoss[0].x;
            v2 = Random(-40, 40);
            SetNpChar(4, v1 + (v2 << 9), gBoss[0].y + 20480, 0, 0, 0, 0, 256);
          }
          if ( dword_81C8584 & 8 )
            unk_81C85B8 = -512;
        }
      }
    }
  }
LABEL_171:
  if ( gBoss[0].act_no > 420 && gBoss[0].act_no <= 499 )
  {
    stru_81CD1C4.bits |= 0x20u;
    stru_81CD270.bits |= 0x20u;
    stru_81CD31C.bits |= 0x20u;
    if ( ++gBoss[0].act_wait > 300 )
    {
      gBoss[0].act_wait = 0;
      if ( ::x <= gBoss[0].x )
      {
        for ( ih = 0; ih <= 7; ++ih )
        {
          v17 = (Random(-4, 4) << 13) / 4;
          v18 = Random(8, 68);
          SetNpChar(350, v17, (v18 << 13) / 4, 0, 0, 2, 0, 256);
        }
      }
      else
      {
        for ( ig = 0; ig <= 7; ++ig )
        {
          v15 = ((Random(-4, 4) + 156) << 13) / 4;
          v16 = Random(8, 68);
          SetNpChar(350, v15, (v16 << 13) / 4, 0, 0, 0, 0, 256);
        }
      }
    }
    if ( gBoss[0].act_wait == 270 || gBoss[0].act_wait == 280 || gBoss[0].act_wait == 290 )
    {
      SetNpChar(353, gBoss[0].x, gBoss[0].y - 26624, 0, 0, 1, 0, 256);
      PlaySoundObject(39, 1);
      for ( ii = 0; ii <= 3; ++ii )
        SetNpChar(4, gBoss[0].x, gBoss[0].y - 26624, 0, 0, 0, 0, 256);
    }
    if ( gBoss[0].life <= 500 )
    {
      if ( Random(0, 4) == 2 )
      {
        v23 = gBoss[0].x;
        v24 = v23 + (Random(-40, 40) << 9);
        v25 = gBoss[0].y;
        v26 = Random(0, 40);
        SetNpChar(270, v24, v25 + (v26 << 9), 0, 0, 3, 0, 0);
      }
    }
    else if ( Random(0, 10) == 2 )
    {
      v19 = gBoss[0].x;
      v20 = v19 + (Random(-40, 40) << 9);
      v21 = gBoss[0].y;
      v22 = Random(0, 40);
      SetNpChar(270, v20, v21 + (v22 << 9), 0, 0, 3, 0, 0);
    }
  }
  if ( gBoss[0].shock )
    stru_81CD1C4.ani_no = ((++ActBossChar_Ballos(void)::_flash >> 1) & 1) != 0;
  else
    stru_81CD1C4.ani_no = 0;
  if ( gBoss[0].act_no > 420 )
    stru_81CD1C4.ani_no += 2;
  _ActBossChar_Eye(&npc);
  _ActBossChar_Eye(&stru_81CD118);
  _ActBossChar_Body(&stru_81CD1C4);
  _ActBossChar_HITAI(&stru_81CD270);
  _ActBossChar_HARA(&stru_81CD31C);
}

//----- (080651E8) --------------------------------------------------------
void __cdecl ActNpc280(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  int v4;
  RECT rcRight[2];
  RECT rcLeft[2];
  char v7[8];

  rcLeft[0].left = 112;
  rcLeft[0].top = 32;
  rcLeft[0].right = 128;
  rcLeft[0].bottom = 48;
  rcLeft[1].left = 144;
  rcLeft[1].top = 32;
  rcLeft[1].right = 160;
  rcLeft[1].bottom = 48;
  rcRight[0].left = 112;
  rcRight[0].top = 48;
  rcRight[0].right = 128;
  rcRight[0].bottom = 64;
  rcRight[1].left = 144;
  rcRight[1].top = 48;
  rcRight[1].right = 160;
  rcRight[1].bottom = 64;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    if ( ++npc->act_wait == 64 )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
    }
    goto LABEL_9;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_9;
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->ani_wait = 0;
    npc->x += 3072;
    npc->tgt_x = npc->x;
    PlaySoundObject(29, 1);
    goto LABEL_5;
  }
  npc->ani_no = 0;
  if ( npc->flag & 8 )
  {
    npc->act_no = 4;
    npc->act_wait = 0;
    npc->ani_no = 1;
    PlaySoundObject(23, 1);
  }
LABEL_9:
  if ( npc->act_no > 1 )
  {
    npc->ym += 32;
    if ( npc->ym > 1535 )
      npc->ym = 1535;
    npc->y += npc->ym;
  }
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v7[16 * npc->ani_no - 64];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v7[16 * npc->ani_no - 32];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
  if ( npc->act_no == 1 )
  {
    npc->rect.bottom = npc->act_wait / 4 + npc->rect.top;
    if ( npc->act_wait / 2 & 1 )
      v4 = npc->tgt_x;
    else
      v4 = npc->tgt_x + 512;
    npc->x = v4;
  }
}


//----- (08065455) --------------------------------------------------------
void __cdecl ActNpc281(NPCHAR_0 *npc)
{
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      break;
    case 0xA:
      npc->act_no = 11;
      npc->act_wait = 0;
      goto LABEL_4;
    case 0xB:
LABEL_4:
      ++npc->act_wait;
      SetNpChar(270, npc->x, npc->y + 0x10000, 0, 0, 2, npc, 256);
      if ( npc->act_wait > 150 )
        npc->act_no = 12;
      break;
    case 0x14:
      npc->act_no = 21;
      npc->act_wait = 0;
      goto LABEL_7;
    case 0x15:
LABEL_7:
      if ( ++npc->act_wait > 250 )
      {
        DeleteNpCharCode(270, 0);
        npc->act_no = 22;
      }
      break;
    default:
      break;
  }
  npc->rect.left = 0;
  npc->rect.top = 0;
  npc->rect.right = 0;
  npc->rect.bottom = 0;
}

//----- (08065595) --------------------------------------------------------
void __cdecl ActNpc282(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT tc[3];
  char v4[8];

  tc[0].left = 256;
  tc[0].top = 80;
  tc[0].right = 320;
  tc[0].bottom = 120;
  tc[1].left = 256;
  tc[1].top = 0;
  tc[1].right = 320;
  tc[1].bottom = 40;
  tc[2].left = 256;
  tc[2].top = 120;
  tc[2].right = 320;
  tc[2].bottom = 160;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 20 )
      goto LABEL_48;
  }
  else
  {
    npc->act_no = 20;
    npc->tgt_y = npc->y;
    if ( Random(0, 100) & 1 )
      npc->ym = -256;
    else
      npc->ym = 256;
  }
  npc->xm = -512;
  if ( npc->x < -32768 )
    npc->cond = 0;
  if ( npc->tgt_y < npc->y )
    npc->ym -= 16;
  if ( npc->tgt_y > npc->y )
    npc->ym += 16;
  if ( npc->ym > 256 )
    npc->ym = 256;
  if ( npc->ym < -256 )
    npc->ym = -256;
  if ( dword_81C8584 & 8 && y < npc->y - 2048 && x > npc->x - 12288 && x < npc->x + 12288 )
  {
    npc->tgt_y = 73728;
    npc->ani_no = 2;
  }
  else if ( npc->ani_no != 1 )
  {
    npc->ani_no = 0;
  }
  if ( dword_81C8584 & 1
    && x < npc->x - npc->hit.back
    && x > npc->x - npc->hit.back - 4096
    && y + unk_81C85D0 > npc->y - npc->hit.top
    && y - unk_81C85C8 < npc->y + npc->hit.bottom )
  {
    npc->bits &= 0xFFBFu;
    npc->ani_no = 1;
  }
  else if ( dword_81C8584 & 4
         && x > npc->x + npc->hit.back
         && x < npc->x + npc->hit.back + 4096
         && y + unk_81C85D0 > npc->y - npc->hit.top
         && y - unk_81C85C8 < npc->y + npc->hit.bottom )
  {
    npc->bits &= 0xFFBFu;
    npc->ani_no = 1;
  }
  else if ( dword_81C8584 & 2
         && y < npc->y - npc->hit.top
         && y > npc->y - npc->hit.top - 4096
         && x + unk_81C85C4 > npc->x - npc->hit.back
         && x - unk_81C85CC < npc->x + npc->hit.front )
  {
    npc->bits &= 0xFFBFu;
    npc->ani_no = 1;
  }
  else if ( dword_81C8584 & 8
         && y > npc->y + npc->hit.bottom - 2048
         && y < npc->y + npc->hit.bottom + 6144
         && x + unk_81C85C4 > npc->x - npc->hit.back - 2048
         && x - unk_81C85CC < npc->x + npc->hit.front + 2048 )
  {
    npc->bits &= 0xFFBFu;
    npc->ani_no = 1;
  }
LABEL_48:
  npc->x += npc->xm;
  npc->y += npc->ym;
  v2 = (Sint32 *)&v4[16 * npc->ani_no - 48];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
}


//----- (08065AB0) --------------------------------------------------------
void __cdecl ActNpc283(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  int v8;
  int v9;
  int v10;
  int v11;
  int v12;
  NPCHAR_0 *v13;
  Sint32 *v14;
  RECT rcRight[11];
  RECT rcLeft[11];
  int x;
  int y;
  int direct;
  char v20[24];

  qmemcpy(rcLeft, &ActNpc283(NPCHAR *)::C.1, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc283(NPCHAR *)::C.2, sizeof(rcRight));
  if ( npc->act_no <= 99 && (!gBoss[0].cond || npc->life <= 399) )
    npc->act_no = 100;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->y -= 4096;
      PlaySoundObject(29, 1);
      goto LABEL_7;
    case 1:
LABEL_7:
      if ( ++npc->act_wait / 2 & 1 )
        npc->ani_no = 9;
      else
        npc->ani_no = 0;
      break;
    case 0xA:
      npc->act_no = 11;
      npc->ani_no = 9;
      break;
    case 0x14:
      gSuperXpos = 0;
      npc->act_no = 21;
      npc->act_wait = 0;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      goto LABEL_12;
    case 0x15:
LABEL_12:
      npc->xm = 7 * npc->xm / 8;
      npc->ym = 7 * npc->ym / 8;
      if ( ++npc->ani_wait > 20 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 1 )
        npc->ani_no = 0;
      if ( ++npc->act_wait > 100 )
        npc->act_no = 30;
      if ( npc->x >= ::x )
        npc->direct = 0;
      else
        npc->direct = 2;
      break;
    case 0x1E:
      npc->act_no = 31;
      npc->act_wait = 0;
      npc->ani_no = 2;
      npc->count2 = npc->life;
      goto LABEL_22;
    case 0x1F:
LABEL_22:
      if ( ++npc->ani_wait > 1 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 3 )
        npc->ani_no = 2;
      if ( npc->flag & 8 )
        npc->ym = -512;
      if ( npc->x <= unk_81CCFC8 )
        v1 = npc->xm + 32;
      else
        v1 = npc->xm - 32;
      npc->xm = v1;
      if ( npc->y <= ::y )
        v2 = npc->ym + 16;
      else
        v2 = npc->ym - 16;
      npc->ym = v2;
      if ( npc->xm > 512 )
        npc->xm = 512;
      if ( npc->xm < -512 )
        npc->xm = -512;
      if ( npc->ym > 512 )
        npc->ym = 512;
      if ( npc->ym < -512 )
        npc->ym = -512;
      if ( npc->x <= ::x )
        npc->direct = 2;
      else
        npc->direct = 0;
      if ( ++npc->act_wait > 150 && (npc->life < npc->count2 - 20 || gSuperXpos) )
      {
        gSuperXpos = 0;
        npc->act_no = 40;
      }
      if ( unk_81CD028 && npc->act_wait > 250 )
        npc->act_no = 50;
      break;
    case 0x28:
      npc->act_no = 41;
      npc->act_wait = 0;
      npc->xm = 0;
      npc->ym = 0;
      if ( npc->x <= ::x )
        npc->direct = 2;
      else
        npc->direct = 0;
      PlaySoundObject(103, 1);
      if ( ::y > 81919 )
        npc->count2 = 289;
      else
        npc->count2 = 290;
      goto LABEL_58;
    case 0x29:
LABEL_58:
      if ( ++npc->act_wait / 2 & 1 )
        npc->ani_no = 4;
      else
        npc->ani_no = 5;
      if ( npc->act_wait % 6 == 1 )
      {
        if ( npc->count2 == 289 )
        {
          v3 = npc->x;
          x = v3 + (Random(-64, 64) << 9);
          v4 = npc->y;
          y = v4 + (Random(-32, 32) << 9);
        }
        else
        {
          v5 = npc->x;
          x = v5 + (Random(-32, 32) << 9);
          v6 = npc->y;
          y = v6 + (Random(-64, 64) << 9);
        }
        if ( x <= 0x3FFF )
          x = 0x4000;
        if ( (gMap.width - 2) << 13 < x )
          x = (gMap.width - 2) << 13;
        if ( y <= 0x3FFF )
          y = 0x4000;
        if ( (gMap.length - 2) << 13 < y )
          y = (gMap.length - 2) << 13;
        PlaySoundObject(39, 1);
        SetNpChar(npc->count2, x, y, 0, 0, 0, 0, 256);
      }
      if ( npc->act_wait > 50 )
      {
        npc->act_no = 42;
        npc->act_wait = 0;
        if ( npc->x <= ::x )
          npc->direct = 2;
        else
          npc->direct = 0;
      }
      break;
    case 0x2A:
      ++npc->act_wait;
      npc->ani_no = 6;
      if ( npc->act_wait > 50 )
      {
        npc->ym = -512;
        if ( npc->direct )
          npc->xm = -512;
        else
          npc->xm = 512;
        npc->act_no = 30;
      }
      break;
    case 0x32:
      npc->act_no = 51;
      npc->act_wait = 0;
      npc->xm = 0;
      npc->ym = 0;
      if ( npc->x <= ::x )
        npc->direct = 2;
      else
        npc->direct = 0;
      PlaySoundObject(103, 1);
      goto LABEL_87;
    case 0x33:
LABEL_87:
      if ( ++npc->act_wait / 2 & 1 )
        npc->ani_no = 4;
      else
        npc->ani_no = 5;
      if ( unk_81C8598 & 0x20 )
      {
        if ( npc->act_wait % 10 == 1 )
        {
          if ( npc->direct )
          {
            x = npc->x - 5120;
            y = npc->y;
            v8 = npc->act_wait / 6 % 4;
            if ( v8 == 1 )
            {
              direct = 108;
            }
            else if ( v8 > 1 )
            {
              if ( v8 == 2 )
              {
                direct = 148;
              }
              else if ( v8 == 3 )
              {
                direct = 168;
              }
            }
            else if ( !v8 )
            {
              direct = 88;
            }
          }
          else
          {
            x = npc->x + 5120;
            y = npc->y;
            v7 = npc->act_wait / 6 % 4;
            if ( v7 == 1 )
            {
              direct = 236;
            }
            else if ( v7 > 1 )
            {
              if ( v7 == 2 )
              {
                direct = 20;
              }
              else if ( v7 == 3 )
              {
                direct = 40;
              }
            }
            else if ( !v7 )
            {
              direct = 216;
            }
          }
          PlaySoundObject(39, 1);
          SetNpChar(301, x, y, 0, 0, direct, 0, 256);
        }
      }
      else if ( npc->act_wait % 24 == 1 )
      {
        if ( npc->direct )
        {
          x = npc->x - 5120;
          y = npc->y;
          v10 = npc->act_wait / 6 % 4;
          if ( v10 == 1 )
          {
            direct = 108;
          }
          else if ( v10 > 1 )
          {
            if ( v10 == 2 )
            {
              direct = 148;
            }
            else if ( v10 == 3 )
            {
              direct = 168;
            }
          }
          else if ( !v10 )
          {
            direct = 88;
          }
        }
        else
        {
          x = npc->x + 5120;
          y = npc->y;
          v9 = npc->act_wait / 6 % 4;
          if ( v9 == 1 )
          {
            direct = 236;
          }
          else if ( v9 > 1 )
          {
            if ( v9 == 2 )
            {
              direct = 20;
            }
            else if ( v9 == 3 )
            {
              direct = 40;
            }
          }
          else if ( !v9 )
          {
            direct = 216;
          }
        }
        PlaySoundObject(39, 1);
        SetNpChar(301, x, y, 0, 0, direct, 0, 256);
      }
      if ( npc->act_wait > 50 )
      {
        npc->act_no = 42;
        npc->act_wait = 0;
        if ( npc->x <= ::x )
          npc->direct = 2;
        else
          npc->direct = 0;
      }
      break;
    case 0x63:
      npc->xm = 0;
      npc->ym = 0;
      npc->ani_no = 9;
      npc->bits &= 0xFFDFu;
      break;
    case 0x64:
      npc->act_no = 101;
      npc->ani_no = 9;
      npc->damage = 0;
      npc->bits &= 0xFFDFu;
      npc->bits |= 8u;
      npc->ym = -512;
      npc->shock += 50;
      npc->hit.bottom = 6144;
      ++unk_81CD028;
      goto LABEL_147;
    case 0x65:
LABEL_147:
      npc->ym += 32;
      if ( npc->y > 110592 - npc->hit.bottom )
      {
        npc->y = 110592 - npc->hit.bottom;
        npc->act_no = 102;
        npc->ani_no = 10;
        npc->xm = 0;
        npc->ym = 0;
      }
      break;
    default:
      break;
  }
  npc->y += npc->ym;
  if ( npc->shock )
  {
    v11 = npc->x;
    v12 = npc->xm / 2;
  }
  else
  {
    v11 = npc->x;
    v12 = npc->xm;
  }
  npc->x = v12 + v11;
  if ( npc->direct )
  {
    v13 = npc;
    v14 = (Sint32 *)&v20[16 * npc->ani_no - 364];
  }
  else
  {
    v13 = npc;
    v14 = (Sint32 *)&v20[16 * npc->ani_no - 188];
  }
  npc->rect.left = *v14;
  v13->rect.top = v14[1];
  v13->rect.right = v14[2];
  v13->rect.bottom = v14[3];
}


//----- (080667EF) --------------------------------------------------------
void __cdecl ActNpc284(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  NPCHAR_0 *v4;
  Sint32 *v5;
  RECT rcRight[13];
  RECT rcLeft[13];
  unsigned __int8 deg;
  char v9[24];

  qmemcpy(rcLeft, &ActNpc284(NPCHAR *)::C.4, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc284(NPCHAR *)::C.5, sizeof(rcRight));
  if ( npc->act_no <= 99 && (!gBoss[0].cond || npc->life <= 499) )
    npc->act_no = 100;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->y -= 2048;
      PlaySoundObject(29, 1);
      npc->count2 = npc->life;
      goto LABEL_7;
    case 1:
LABEL_7:
      if ( ++npc->act_wait / 2 & 1 )
      {
        npc->view.top = 0x2000;
        npc->view.back = 0x2000;
        npc->view.front = 0x2000;
        npc->ani_no = 11;
      }
      else
      {
        npc->view.top = 1536;
        npc->view.back = 4096;
        npc->view.front = 4096;
        npc->ani_no = 12;
      }
      if ( npc->act_wait > 50 )
        npc->act_no = 10;
      break;
    case 0xA:
      npc->act_no = 11;
      npc->ani_no = 11;
      npc->view.top = 0x2000;
      npc->view.back = 0x2000;
      npc->view.front = 0x2000;
      DeleteNpCharCode(257, 1);
      break;
    case 0x14:
      npc->act_no = 21;
      npc->act_wait = 0;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      npc->damage = 0;
      npc->bits |= 0x20u;
      npc->bits &= 0xFFF7u;
      goto LABEL_14;
    case 0x15:
LABEL_14:
      npc->xm = 7 * npc->xm / 8;
      npc->ym = 7 * npc->ym / 8;
      if ( ++npc->ani_wait > 20 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 1 )
        npc->ani_no = 0;
      if ( ++npc->act_wait > 80 )
        npc->act_no = 30;
      if ( npc->x >= x )
        npc->direct = 0;
      else
        npc->direct = 2;
      if ( npc->life < npc->count2 - 50 )
      {
        npc->count2 = npc->life;
        gSuperXpos = 10;
      }
      break;
    case 0x1E:
      npc->act_no = 31;
      npc->act_wait = 0;
      npc->ani_no = 2;
      npc->xm = 0;
      npc->ym = 0;
      goto LABEL_26;
    case 0x1F:
LABEL_26:
      if ( ++npc->act_wait <= 16 )
        break;
      ++npc->count1;
      npc->count1 %= 4;
      v1 = npc->count1;
      if ( v1 == 1 )
        goto LABEL_33;
      if ( v1 > 1 )
      {
        if ( v1 == 2 )
        {
          npc->act_no = 32;
        }
        else if ( v1 == 3 )
        {
LABEL_33:
          npc->act_no = 34;
        }
      }
      else if ( !v1 )
      {
        npc->act_no = 32;
      }
      break;
    case 0x20:
      npc->act_no = 33;
      npc->act_wait = 0;
      npc->bits &= 0xFFDFu;
      if ( x >= npc->x )
        npc->tgt_x = x + 81920;
      else
        npc->tgt_x = x - 81920;
      npc->tgt_y = y;
      deg = GetArktan(npc->x - npc->tgt_x, npc->y - npc->tgt_y);
      npc->xm = 3 * GetCos(deg);
      npc->ym = 3 * GetSin(deg);
      npc->bits &= 0xFFF7u;
      if ( npc->x < gMap.width / 0x80000 >> 1 && npc->xm > 0 )
      {
        if ( npc->y < gMap.length / 0x80000 >> 1 && npc->ym > 0 )
          npc->bits |= 8u;
        if ( npc->y > gMap.length / 0x80000 >> 1 && npc->ym < 0 )
          npc->bits |= 8u;
      }
      if ( npc->x > gMap.width / 0x80000 >> 1 && npc->xm < 0 )
      {
        if ( npc->y < gMap.length / 0x80000 >> 1 && npc->ym > 0 )
          npc->bits |= 8u;
        if ( npc->y > gMap.length / 0x80000 >> 1 && npc->ym < 0 )
          npc->bits |= 8u;
      }
      if ( npc->xm <= 0 )
        npc->direct = 0;
      else
        npc->direct = 2;
      goto LABEL_59;
    case 0x21:
LABEL_59:
      if ( ++npc->act_wait / 2 & 1 )
        npc->ani_no = 3;
      else
        npc->ani_no = 8;
      if ( npc->act_wait > 50 || npc->flag & 5 )
        npc->act_no = 20;
      break;
    case 0x22:
      npc->act_no = 35;
      npc->act_wait = 0;
      npc->damage = 4;
      npc->tgt_x = x;
      npc->tgt_y = y;
      deg = GetArktan(npc->x - npc->tgt_x, npc->y - npc->tgt_y);
      npc->ym = 3 * GetSin(deg);
      npc->xm = 3 * GetCos(deg);
      npc->bits &= 0xFFF7u;
      if ( npc->x < gMap.width / 0x80000 >> 1 && npc->xm > 0 )
      {
        if ( npc->y < gMap.length / 0x80000 >> 1 && npc->ym > 0 )
          npc->bits |= 8u;
        if ( npc->y > gMap.length / 0x80000 >> 1 && npc->ym < 0 )
          npc->bits |= 8u;
      }
      if ( npc->x > gMap.width / 0x80000 >> 1 && npc->xm < 0 )
      {
        if ( npc->y < gMap.length / 0x80000 >> 1 && npc->ym > 0 )
          npc->bits |= 8u;
        if ( npc->y > gMap.length / 0x80000 >> 1 && npc->ym < 0 )
          npc->bits |= 8u;
      }
      if ( npc->xm <= 0 )
        npc->direct = 0;
      else
        npc->direct = 2;
      goto LABEL_84;
    case 0x23:
LABEL_84:
      if ( ++npc->act_wait > 20 && npc->shock )
      {
        npc->act_no = 40;
      }
      else if ( npc->act_wait > 50 || npc->flag & 5 )
      {
        npc->act_no = 20;
      }
      if ( ++npc->ani_wait > 1 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 7 )
        npc->ani_no = 4;
      if ( npc->act_wait % 5 == 1 )
        PlaySoundObject(109, 1);
      break;
    case 0x28:
      npc->act_no = 41;
      npc->act_wait = 0;
      npc->ani_no = 2;
      npc->damage = 0;
      npc->bits &= 0xFFF7u;
      goto LABEL_97;
    case 0x29:
LABEL_97:
      npc->xm = 7 * npc->xm / 8;
      npc->ym = 7 * npc->ym / 8;
      if ( ++npc->act_wait > 6 )
      {
        npc->act_no = 42;
        npc->act_wait = 0;
        npc->ym = -512;
        if ( npc->direct )
          npc->xm = -512;
        else
          npc->xm = 512;
      }
      break;
    case 0x2A:
      npc->ani_no = 9;
      if ( npc->flag & 8 )
      {
        npc->act_no = 43;
        npc->act_wait = 0;
        npc->ani_no = 2;
        if ( npc->x >= x )
          npc->direct = 0;
        else
          npc->direct = 2;
      }
      npc->ym += 32;
      if ( npc->ym > 1535 )
        npc->ym = 1535;
      break;
    case 0x2B:
      if ( ++npc->act_wait > 16 )
        npc->act_no = 20;
      break;
    case 0x63:
      npc->xm = 0;
      npc->ym = 0;
      npc->ani_no = 9;
      npc->bits &= 0xFFDFu;
      break;
    case 0x64:
      npc->act_no = 101;
      npc->ani_no = 9;
      npc->damage = 0;
      npc->bits &= 0xFFDFu;
      npc->bits |= 8u;
      npc->ym = -512;
      npc->shock += 50;
      ++unk_81CD028;
      goto LABEL_111;
    case 0x65:
LABEL_111:
      npc->ym += 32;
      if ( npc->y > 110592 - npc->hit.bottom )
      {
        npc->y = 110592 - npc->hit.bottom;
        npc->act_no = 102;
        npc->ani_no = 10;
        npc->xm = 0;
        npc->ym = 0;
      }
      break;
    default:
      break;
  }
  npc->y += npc->ym;
  if ( npc->shock )
  {
    v2 = npc->x;
    v3 = npc->xm / 2;
  }
  else
  {
    v2 = npc->x;
    v3 = npc->xm;
  }
  npc->x = v3 + v2;
  if ( npc->direct )
  {
    v4 = npc;
    v5 = (Sint32 *)&v9[16 * npc->ani_no - 420];
  }
  else
  {
    v4 = npc;
    v5 = (Sint32 *)&v9[16 * npc->ani_no - 212];
  }
  npc->rect.left = *v5;
  v4->rect.top = v5[1];
  v4->rect.right = v5[2];
  v4->rect.bottom = v5[3];
}


//----- (08067532) --------------------------------------------------------
void __cdecl ActNpc285(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  unsigned __int8 deg;

  if ( npc->x < 0 || npc->x > gMap.width << 13 )
  {
    VanishNpChar(npc);
    return;
  }
  v1 = npc->act_no;
  if ( !v1 )
  {
    npc->act_no = 1;
    npc->tgt_x = npc->x;
    npc->tgt_y = npc->y;
    npc->count1 = npc->direct / 8;
    npc->direct %= 8;
    goto LABEL_8;
  }
  if ( v1 == 1 )
  {
LABEL_8:
    npc->count1 += 24;
    npc->count1 = (unsigned __int8)(((unsigned __int64)npc->count1 >> 56) + npc->count1)
                - ((unsigned int)(npc->count1 >> 31) >> 24);
    deg = npc->count1;
    if ( npc->act_wait <= 127 )
      ++npc->act_wait;
    if ( npc->direct )
      v2 = npc->xm + 21;
    else
      v2 = npc->xm - 21;
    npc->xm = v2;
    npc->tgt_x += npc->xm;
    v3 = npc->tgt_x;
    npc->x = v3 + 4 * GetCos(deg);
    v4 = npc->tgt_y;
    npc->y = v4 + 6 * GetSin(deg);
    SetNpChar(286, npc->x, npc->y, 0, 0, 0, 0, 256);
  }
  npc->rect.left = 232;
  npc->rect.top = 104;
  npc->rect.right = 248;
  npc->rect.bottom = 120;
}

//----- (08067730) --------------------------------------------------------
void __cdecl ActNpc286(NPCHAR_0 *npc)
{
  RECT *v1;
  RECT rc[3];

  rc[0].left = 232;
  rc[0].top = 120;
  rc[0].right = 248;
  rc[0].bottom = 136;
  rc[1].left = 232;
  rc[1].top = 136;
  rc[1].right = 248;
  rc[1].bottom = 152;
  rc[2].left = 232;
  rc[2].top = 152;
  rc[2].right = 248;
  rc[2].bottom = 168;
  if ( ++npc->ani_wait > 0 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no <= 2 )
  {
    v1 = &rc[npc->ani_no];
    npc->rect.left = v1->left;
    npc->rect.top = v1->top;
    npc->rect.right = v1->right;
    npc->rect.bottom = v1->bottom;
  }
  else
  {
    npc->cond = 0;
  }
}

//----- (080677FB) --------------------------------------------------------
void __cdecl ActNpc287(NPCHAR_0 *npc)
{
  Sint32 *v1;
  RECT rcLeft[7];
  char v3[24];

  qmemcpy(rcLeft, &ActNpc287(NPCHAR *)::C.8, sizeof(rcLeft));
  if ( npc->act_no )
  {
    npc->xm = 20 * npc->xm / 21;
    npc->ym = 20 * npc->ym / 21;
    npc->x += npc->xm;
    npc->y += npc->ym;
  }
  else
  {
    npc->xm = Random(-4, 4) << 9;
    npc->act_no = 1;
  }
  if ( ++npc->ani_wait > 1 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no <= 6 )
  {
    v1 = (Sint32 *)&v3[16 * npc->ani_no - 112];
    npc->rect.left = *v1;
    npc->rect.top = v1[1];
    npc->rect.right = v1[2];
    npc->rect.bottom = v1[3];
  }
  else
  {
    npc->cond = 0;
  }
}


//----- (0806794F) --------------------------------------------------------
void __cdecl ActNpc288(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT rc[5];
  char v4[24];

  qmemcpy(rc, &ActNpc288(NPCHAR *)::C.9, sizeof(rc));
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_9:
    if ( npc->direct == 1 )
    {
      npc->ym -= 32;
      if ( npc->ym < -1535 )
        npc->ym = -1535;
      if ( npc->flag & 2 )
        npc->act_no = 2;
    }
    else if ( npc->direct == 3 )
    {
      npc->ym += 32;
      if ( npc->ym > 1535 )
        npc->ym = 1535;
      if ( npc->flag & 8 )
        npc->act_no = 2;
    }
    if ( ++npc->ani_wait > 3 )
    {
      npc->ani_wait = 0;
      ++npc->ani_no;
    }
    if ( npc->ani_no > 1 )
      npc->ani_no = 0;
    goto LABEL_36;
  }
  if ( v1 <= 1 )
  {
    if ( v1 )
      goto LABEL_36;
    npc->act_no = 1;
    npc->xm = -512;
    goto LABEL_9;
  }
  if ( v1 == 2 )
  {
    PlaySoundObject(44, 1);
    npc->act_no = 3;
    npc->act_wait = 0;
    npc->bits |= 8u;
    npc->ym = 0;
    if ( npc->x <= x )
      npc->xm = 1024;
    else
      npc->xm = -1024;
    npc->view.back = 6144;
    npc->view.front = 6144;
    npc->view.top = 6144;
    npc->view.bottom = 6144;
  }
  else if ( v1 != 3 )
  {
    goto LABEL_36;
  }
  if ( ++npc->ani_no > 4 )
    npc->ani_no = 2;
  if ( ++npc->act_wait % 4 == 1 )
  {
    if ( npc->direct == 1 )
      SetNpChar(287, npc->x, npc->y, 0, 1024, 0, 0, 256);
    else
      SetNpChar(287, npc->x, npc->y, 0, -1024, 0, 0, 256);
  }
  if ( npc->x <= 0x1FFF || npc->x > (gMap.width - 1) << 13 )
    npc->cond = 0;
LABEL_36:
  npc->x += npc->xm;
  npc->y += npc->ym;
  v2 = (Sint32 *)&v4[16 * npc->ani_no - 80];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
}


//----- (08067CAF) --------------------------------------------------------
void __cdecl ActNpc289(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  Sint32 *v2;
  RECT rcRight[3];
  RECT rcLeft[3];
  char v5[8];

  rcLeft[0].left = 160;
  rcLeft[0].top = 32;
  rcLeft[0].right = 176;
  rcLeft[0].bottom = 48;
  rcLeft[1].left = 176;
  rcLeft[1].top = 32;
  rcLeft[1].right = 192;
  rcLeft[1].bottom = 48;
  rcLeft[2].left = 192;
  rcLeft[2].top = 32;
  rcLeft[2].right = 208;
  rcLeft[2].bottom = 48;
  rcRight[0].left = 160;
  rcRight[0].top = 48;
  rcRight[0].right = 176;
  rcRight[0].bottom = 64;
  rcRight[1].left = 176;
  rcRight[1].top = 48;
  rcRight[1].right = 192;
  rcRight[1].bottom = 64;
  rcRight[2].left = 192;
  rcRight[2].top = 48;
  rcRight[2].right = 208;
  rcRight[2].bottom = 64;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 2;
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
      goto LABEL_5;
    case 1:
LABEL_5:
      if ( ++npc->act_wait > 16 )
      {
        npc->act_no = 10;
        npc->view.top = 4096;
        npc->view.bottom = 4096;
        npc->damage = 2;
        npc->bits |= 0x20u;
      }
      goto LABEL_21;
    case 0xA:
      if ( npc->flag & 8 )
      {
        npc->act_no = 11;
        npc->ani_no = 0;
        npc->act_wait = 0;
        npc->xm = 0;
        if ( npc->x <= x )
          npc->direct = 2;
        else
          npc->direct = 0;
      }
      goto LABEL_21;
    case 0xB:
      if ( ++npc->act_wait > 10 )
      {
        if ( ++npc->count1 <= 4 )
          npc->act_no = 10;
        else
          npc->act_no = 12;
        PlaySoundObject(30, 1);
        npc->ym = -1536;
        if ( npc->direct )
          npc->xm = 512;
        else
          npc->xm = -512;
        npc->ani_no = 2;
      }
      goto LABEL_21;
    case 0xC:
      npc->bits |= 8u;
      if ( npc->y <= gMap.length << 13 )
        goto LABEL_21;
      VanishNpChar(npc);
      break;
    default:
LABEL_21:
      if ( npc->act_no > 9 )
        npc->ym += 64;
      if ( npc->ym > 1535 )
        npc->ym = 1535;
      npc->x += npc->xm;
      npc->y += npc->ym;
      if ( npc->direct )
      {
        v1 = npc;
        v2 = (Sint32 *)&v5[16 * npc->ani_no - 96];
      }
      else
      {
        v1 = npc;
        v2 = (Sint32 *)&v5[16 * npc->ani_no - 48];
      }
      npc->rect.left = *v2;
      v1->rect.top = v2[1];
      v1->rect.right = v2[2];
      v1->rect.bottom = v2[3];
      if ( npc->act_no == 1 )
      {
        npc->rect.top += 8 - npc->act_wait / 2;
        npc->rect.bottom += -8 - npc->act_wait / 2;
        npc->view.top = (npc->act_wait << 9) / 2;
        npc->view.bottom = (npc->act_wait << 9) / 2;
      }
      break;
  }
}


//----- (080680B5) --------------------------------------------------------
void __cdecl ActNpc290(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  NPCHAR_0 *v4;
  Sint32 *v5;
  RECT rcRight[3];
  RECT rcLeft[3];
  char v8[8];

  rcLeft[0].left = 112;
  rcLeft[0].top = 32;
  rcLeft[0].right = 128;
  rcLeft[0].bottom = 48;
  rcLeft[1].left = 128;
  rcLeft[1].top = 32;
  rcLeft[1].right = 144;
  rcLeft[1].bottom = 48;
  rcLeft[2].left = 144;
  rcLeft[2].top = 32;
  rcLeft[2].right = 160;
  rcLeft[2].bottom = 48;
  rcRight[0].left = 112;
  rcRight[0].top = 48;
  rcRight[0].right = 128;
  rcRight[0].bottom = 64;
  rcRight[1].left = 128;
  rcRight[1].top = 48;
  rcRight[1].right = 144;
  rcRight[1].bottom = 64;
  rcRight[2].left = 144;
  rcRight[2].top = 48;
  rcRight[2].right = 160;
  rcRight[2].bottom = 64;
  v1 = npc->act_no;
  switch ( v1 )
  {
    case 1:
LABEL_7:
      if ( ++npc->act_wait > 16 )
      {
        npc->act_no = 10;
        npc->view.top = 4096;
        npc->view.bottom = 4096;
        npc->damage = 2;
        npc->bits |= 0x20u;
        npc->tgt_y = npc->y;
        npc->ym = 1024;
      }
      break;
    case 10:
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 2 )
        npc->ani_no = 0;
      if ( npc->y >= npc->tgt_y )
        v2 = npc->ym - 64;
      else
        v2 = npc->ym + 64;
      npc->ym = v2;
      if ( npc->direct )
        v3 = npc->xm + 16;
      else
        v3 = npc->xm - 16;
      npc->xm = v3;
      if ( npc->x < 0 || npc->y < 0 || npc->x > gMap.width << 13 || npc->y > gMap.length << 13 )
      {
        VanishNpChar(npc);
        return;
      }
      break;
    case 0:
      npc->act_no = 1;
      npc->ani_no = 2;
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
      goto LABEL_7;
  }
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v4 = npc;
    v5 = (Sint32 *)&v8[16 * npc->ani_no - 96];
  }
  else
  {
    v4 = npc;
    v5 = (Sint32 *)&v8[16 * npc->ani_no - 48];
  }
  npc->rect.left = *v5;
  v4->rect.top = v5[1];
  v4->rect.right = v5[2];
  v4->rect.bottom = v5[3];
  if ( npc->act_no == 1 )
  {
    npc->rect.top += 8 - npc->act_wait / 2;
    npc->rect.bottom += -8 - npc->act_wait / 2;
    npc->view.top = (npc->act_wait << 9) / 2;
    npc->view.bottom = (npc->act_wait << 9) / 2;
  }
}


//----- (0806845A) --------------------------------------------------------
void __cdecl ActNpc291(NPCHAR_0 *npc)
{
  RECT *v1;
  RECT tc[2];

  tc[0].left = 256;
  tc[0].top = 80;
  tc[0].right = 320;
  tc[0].bottom = 120;
  tc[1].left = 256;
  tc[1].top = 0;
  tc[1].right = 320;
  tc[1].bottom = 40;
  if ( !npc->act_no )
  {
    npc->act_no = 20;
    if ( npc->direct == 2 )
    {
      npc->bits &= 0xFFBFu;
      npc->ani_no = 1;
    }
  }
  v1 = &tc[npc->ani_no];
  npc->rect.left = v1->left;
  npc->rect.top = v1->top;
  npc->rect.right = v1->right;
  npc->rect.bottom = v1->bottom;
}

//----- (08068500) --------------------------------------------------------
void __cdecl ActNpc292()
{
  SetQuake(10);
}

//----- (08068514) --------------------------------------------------------
void __cdecl ActNpc293(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  Sint32 *v6;
  RECT rect[2];
  char v8[8];

  rect[0].left = 240;
  rect[0].top = 200;
  rect[0].right = 280;
  rect[0].bottom = 240;
  rect[1].left = 280;
  rect[1].top = 200;
  rect[1].right = 320;
  rect[1].bottom = 240;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_9;
  }
  else
  {
    npc->act_no = 1;
  }
  if ( ++npc->ani_no > 1 )
    npc->ani_no = 0;
  v2 = npc->y;
  v3 = (Random(-16, 16) << 9) + v2;
  v4 = npc->x;
  v5 = Random(0, 16);
  SetNpChar(4, v4 + (v5 << 9), v3, 0, 0, 0, 0, 256);
  npc->x -= 4096;
  if ( npc->x < -16384 )
    npc->cond = 0;
LABEL_9:
  v6 = (Sint32 *)&v8[16 * npc->ani_no - 32];
  npc->rect.left = *v6;
  npc->rect.top = v6[1];
  npc->rect.right = v6[2];
  npc->rect.bottom = v6[3];
}


//----- (08068669) --------------------------------------------------------
void __cdecl ActNpc294(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int x;
  int y;

  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 == 1 )
    {
      ++npc->act_wait;
      if ( unk_81C8598 & 0x20 )
      {
        npc->x = ::x + 0x8000;
        if ( npc->x <= 212991 )
          npc->x = 212992;
      }
      else
      {
        npc->x = ::x + 49152;
        if ( npc->x <= 188415 )
          npc->x = 188416;
      }
      if ( npc->x > (gMap.width - 10) << 13 )
        npc->x = (gMap.width - 10) << 13;
      if ( npc->act_wait > 24 )
      {
        if ( unk_81C8598 & 0x20 )
        {
          v2 = npc->x;
          x = v2 + (Random(-14, 14) << 13);
        }
        else
        {
          v3 = npc->x;
          x = v3 + (Random(-11, 11) << 13);
        }
        y = ::y - 114688;
        if ( Random(0, 10) & 1 )
          SetNpChar(279, x, y, 0, 0, 0, 0, 256);
        else
          SetNpChar(279, x, y, 0, 0, 2, 0, 256);
        npc->act_wait = Random(0, 15);
      }
    }
  }
  else if ( ::x < (gMap.width - 6) << 13 )
  {
    npc->act_no = 1;
    npc->act_wait = 0;
  }
}

//----- (08068859) --------------------------------------------------------
void __cdecl ActNpc295(NPCHAR_0 *npc)
{
  int v1;
  RECT *v2;
  RECT rc[4];

  rc[0].left = 0;
  rc[0].top = 0;
  rc[0].right = 208;
  rc[0].bottom = 64;
  rc[1].left = 32;
  rc[1].top = 64;
  rc[1].right = 144;
  rc[1].bottom = 96;
  rc[2].left = 32;
  rc[2].top = 96;
  rc[2].right = 104;
  rc[2].bottom = 128;
  rc[3].left = 104;
  rc[3].top = 96;
  rc[3].right = 144;
  rc[3].bottom = 128;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 == 1 )
    {
      npc->x += npc->xm;
      npc->y += npc->ym;
      if ( npc->x < -32768 )
        npc->cond = 0;
      if ( npc->y < -16384 )
        npc->cond = 0;
    }
  }
  else
  {
    npc->act_no = 1;
    npc->ani_no = npc->direct % 4;
    switch ( npc->direct )
    {
      case 0:
        npc->ym = -4096;
        npc->view.back = 53248;
        npc->view.front = 53248;
        break;
      case 1:
        npc->ym = -2048;
        npc->view.back = 28672;
        npc->view.front = 28672;
        break;
      case 2:
        npc->ym = -1024;
        npc->view.back = 0x4000;
        npc->view.front = 0x4000;
        break;
      case 3:
        npc->ym = -512;
        npc->view.back = 10240;
        npc->view.front = 10240;
        break;
      case 4:
        npc->xm = -1024;
        npc->view.back = 53248;
        npc->view.front = 53248;
        break;
      case 5:
        npc->xm = -512;
        npc->view.back = 28672;
        npc->view.front = 28672;
        break;
      case 6:
        npc->xm = -256;
        npc->view.back = 0x4000;
        npc->view.front = 0x4000;
        break;
      case 7:
        npc->xm = -128;
        npc->view.back = 10240;
        npc->view.front = 10240;
        break;
      default:
        break;
    }
  }
  v2 = &rc[npc->ani_no];
  npc->rect.left = v2->left;
  npc->rect.top = v2->top;
  npc->rect.right = v2->right;
  npc->rect.bottom = v2->bottom;
}

//----- (08068AE1) --------------------------------------------------------
void __cdecl ActNpc296(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int x;
  int v4;
  int v5;
  signed int dir;
  signed int pri;

  if ( ++npc->act_wait > 16 )
  {
    npc->act_wait = Random(0, 16);
    dir = Random(0, 100) % 4;
    if ( npc->direct )
    {
      if ( dir == 1 )
      {
        pri = 85;
      }
      else if ( dir > 1 )
      {
        if ( dir == 2 )
        {
          pri = 64;
        }
        else if ( dir == 3 )
        {
          pri = 0;
        }
      }
      else if ( !dir )
      {
        pri = 128;
      }
      x = npc->x;
      v4 = npc->y;
      v5 = Random(-7, 7);
      SetNpChar(295, x, v4 + (v5 << 13), 0, 0, dir + 4, 0, pri);
    }
    else
    {
      if ( dir == 1 )
      {
        pri = 128;
      }
      else if ( dir > 1 )
      {
        if ( dir == 2 )
        {
          pri = 64;
        }
        else if ( dir == 3 )
        {
          pri = 0;
        }
      }
      else if ( !dir )
      {
        pri = 384;
      }
      v1 = npc->x;
      v2 = Random(-10, 10);
      SetNpChar(295, v1 + (v2 << 13), npc->y, 0, 0, dir, 0, pri);
    }
  }
}

//----- (08068CBC) --------------------------------------------------------
void __cdecl ActNpc297(NPCHAR_0 *npc)
{
  npc->x = npc->pNpc->x + 0x2000;
  npc->y = npc->pNpc->y + 4096;
  npc->rect.left = 112;
  npc->rect.top = 48;
  npc->rect.right = 128;
  npc->rect.bottom = 64;
}

//----- (08068D2B) --------------------------------------------------------
void __cdecl ActNpc298(NPCHAR_0 *npc)
{
  Sint32 *v1;
  RECT rc[8];
  char v3[12];

  qmemcpy(rc, &ActNpc298(NPCHAR *)::C.11, sizeof(rc));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->y -= 4096;
      goto LABEL_3;
    case 1:
LABEL_3:
      npc->ani_no = 0;
      break;
    case 0xA:
      npc->act_no = 11;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      npc->count1 = 0;
      goto LABEL_5;
    case 0xB:
LABEL_5:
      if ( ++npc->ani_wait > 6 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 1 )
      {
        npc->ani_no = 0;
        if ( ++npc->count1 > 7 )
        {
          npc->ani_no = 0;
          npc->act_no = 1;
        }
      }
      break;
    case 0x14:
      npc->act_no = 21;
      npc->ani_no = 2;
      npc->ani_wait = 0;
      goto LABEL_11;
    case 0x15:
LABEL_11:
      if ( ++npc->ani_wait > 10 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 5 )
        npc->ani_no = 2;
      npc->x += 256;
      break;
    case 0x1E:
      npc->ani_no = 6;
      break;
    case 0x28:
      npc->act_no = 41;
      npc->ani_no = 6;
      npc->ani_wait = 0;
      npc->count1 = 0;
      goto LABEL_18;
    case 0x29:
LABEL_18:
      if ( ++npc->ani_wait > 6 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 7 )
      {
        npc->ani_no = 6;
        if ( ++npc->count1 > 7 )
        {
          npc->ani_no = 6;
          npc->act_no = 30;
        }
      }
      break;
    default:
      break;
  }
  v1 = (Sint32 *)&v3[16 * npc->ani_no - 128];
  npc->rect.left = *v1;
  npc->rect.top = v1[1];
  npc->rect.right = v1[2];
  npc->rect.bottom = v1[3];
}


//----- (08068F9E) --------------------------------------------------------
void __cdecl ActNpc299(NPCHAR_0 *npc)
{
  int v1;
  RECT *v2;
  RECT rc[2];

  rc[0].left = 0;
  rc[0].top = 0;
  rc[0].right = 48;
  rc[0].bottom = 48;
  rc[1].left = 48;
  rc[1].top = 0;
  rc[1].right = 96;
  rc[1].bottom = 48;
  if ( !npc->act_no )
  {
    npc->act_no = 1;
    if ( npc->direct )
    {
      npc->ani_no = 0;
      npc->act_wait = 0;
    }
    else
    {
      npc->ani_no = 1;
      npc->act_wait = 25;
      npc->y -= 1600;
    }
  }
  if ( ++npc->act_wait / 50 & 1 )
    v1 = npc->y + 64;
  else
    v1 = npc->y - 64;
  npc->y = v1;
  v2 = &rc[npc->ani_no];
  npc->rect.left = v2->left;
  npc->rect.top = v2->top;
  npc->rect.right = v2->right;
  npc->rect.bottom = v2->bottom;
}

//----- (080690B8) --------------------------------------------------------
$C1127D3748787668AAF0293B2D646CFD *__cdecl loadORG(const char *path)
{
  int v1;
  Sint16 v2;
  $557AD80E8FB350125C3B3CCF0C10D895 *v3;
  Uint32 *v4;
  Uint32 v5;
  int size;
  int i;
  int j;
  $C1127D3748787668AAF0293B2D646CFD *org;
  SDL_RWops_0 *orgfp;
  void *orgmem;

  orgfp = (SDL_RWops_0 *)SDL_AllocRW();
  orgmem = get_resource(path, &size);
  orgfp = SDL_RWFromConstMem(orgmem, size);
  org = ($C1127D3748787668AAF0293B2D646CFD *)malloc(0x25Cu);
  orgfp->read(orgfp, org, 1, 6);
  orgfp->read(orgfp, &org->tempo, 2, 1);
  orgfp->read(orgfp, &org->spb, 1, 1);
  orgfp->read(orgfp, &org->bps, 1, 1);
  orgfp->read(orgfp, &org->loopStart, 4, 1);
  orgfp->read(orgfp, &org->loopEnd, 4, 1);
  org->samples = 0;
  org->pos = 0;
  for ( i = 0; i <= 15; ++i )
  {
    orgfp->read(orgfp, &org->track[i], 2, 1);
    orgfp->read(orgfp, &org->track[i].wave, 1, 1);
    orgfp->read(orgfp, &org->track[i].pi, 1, 1);
    orgfp->read(orgfp, &org->track[i].num_notes, 2, 1);
    org->track[i].note = 0;
    org->track[i].pos = 0;
    org->track[i].playing = 0;
    org->track[i].samples = 0;
  }
  for ( i = 0; i <= 15; ++i )
  {
    if ( org->track[i].num_notes )
    {
      v1 = i;
      org->track[v1].note = ($557AD80E8FB350125C3B3CCF0C10D895 *)calloc(org->track[i].num_notes, 8u);
      for ( j = 0; org->track[i].num_notes > j; ++j )
        orgfp->read(orgfp, &org->track[i].note[j], 4, 1);
      for ( j = 0; org->track[i].num_notes > j; ++j )
        orgfp->read(orgfp, &org->track[i].note[j].note, 1, 1);
      for ( j = 0; org->track[i].num_notes > j; ++j )
        orgfp->read(orgfp, &org->track[i].note[j].length, 1, 1);
      for ( j = 0; org->track[i].num_notes > j; ++j )
        orgfp->read(orgfp, &org->track[i].note[j].volume, 1, 1);
      for ( j = 0; org->track[i].num_notes > j; ++j )
        orgfp->read(orgfp, &org->track[i].note[j].pan, 1, 1);
      if ( !org->track[i].note->start )
      {
        if ( org->track[i].note->note != -1 )
        {
          if ( org->track[i].pi )
            v2 = 1;
          else
            v2 = org->track[i].note->length;
          org->track[i].playing = v2;
        }
        org->track[i].pos = 1;
        v3 = org->track[i].note;
        v4 = &org->loopEnd + 9 * i;
        v5 = *(_DWORD *)&v3->note;
        v4[3] = v3->start;
        v4[4] = v5;
      }
    }
  }
  SDL_FreeRW(orgfp);
  return org;
}



//----- (08069762) --------------------------------------------------------
void __cdecl freeORG($C1127D3748787668AAF0293B2D646CFD *org)
{
  int i;

  if ( org )
  {
    for ( i = 0; i <= 15; ++i )
    {
      if ( org->track[i].note )
        free(org->track[i].note);
    }
    free(org);
  }
}

//----- (080697CF) --------------------------------------------------------
void __cdecl playORG($C1127D3748787668AAF0293B2D646CFD *org)
{
  SDL_LockAudio();
  Player.org = org;
  Player.volume = 100;
  Player.fadeout = 0;
  SDL_UnlockAudio();
}



//----- (080697F9) --------------------------------------------------------
void __cdecl setPlayerFadeout(Uint8 fadeout)
{
  Player.fadeout = fadeout;
}

//----- (08069810) --------------------------------------------------------
void __cdecl setPlayerVolume(Uint16 volume)
{
  Player.volume = volume;
}

//----- (08069829) --------------------------------------------------------
Uint32 __cdecl getORGPosition($C1127D3748787668AAF0293B2D646CFD *org)
{
  Uint32 result;

  if ( org )
    result = org->pos;
  else
    result = 0;
  return result;
}

//----- (08069844) --------------------------------------------------------
void __cdecl setORGPosition($C1127D3748787668AAF0293B2D646CFD *org, Uint32 position)
{
  char v2;
  Sint16 v3;
  $557AD80E8FB350125C3B3CCF0C10D895 *v4;
  Uint32 *v5;
  Uint32 v6;
  int i;

  org->pos = position;
  for ( i = 0; i <= 15; ++i )
  {
    for ( org->track[i].pos = 0; ; ++org->track[i].pos )
    {
      v2 = org->track[i].pos >= org->track[i].num_notes || org->track[i].note[org->track[i].pos].start >= org->pos ? 0 : 1;
      if ( !v2 )
        break;
    }
    org->track[i].playing = 0;
    org->track[i].samples = 0;
    if ( org->track[i].pos < org->track[i].num_notes && org->track[i].note[org->track[i].pos].start == org->pos )
    {
      if ( org->track[i].note[org->track[i].pos].note != -1 )
      {
        if ( org->track[i].pi )
          v3 = 1;
        else
          v3 = org->track[i].note[org->track[i].pos].length;
        org->track[i].playing = v3;
      }
      v4 = &org->track[i].note[org->track[i].pos];
      v5 = &org->loopEnd + 9 * i;
      v6 = *(_DWORD *)&v4->note;
      v5[3] = v4->start;
      v5[4] = v6;
      ++org->track[i].pos;
    }
  }
}

//----- (08069B5C) --------------------------------------------------------
void stopORG()
{
  SDL_LockAudio();
  Player.org = 0;
  SDL_UnlockAudio();
}



//----- (08069B78) --------------------------------------------------------
int __cdecl _interpolate(Sint16 v1, Sint16 v2, Uint16 f)
{
  __int64 v4;

  if ( !f )
    return (unsigned __int16)v1;
  v4 = (v2 - v1) * f;
  return ((signed int)((HIDWORD(v4) >> 20) + v4) >> 12) + (unsigned __int16)v1;
}

//----- (08069BCA) --------------------------------------------------------
void __cdecl _renderDrumWave(Sint32 *buffer, int no, $04553E4401276348CEA0C0E6398A028E *instrument, int len)
{
  int i;
  int s_offset_1;
  __int16 pan;
  Uint32 sample_sf;
  Sint32 val;
  float volume_f;
  float left_f;
  float right_f;
  int noa;
  int nob;

  switch ( instrument->wave )
  {
    case 0u:
      noa = 0;
      goto LABEL_9;
    case 2u:
      noa = 1;
      goto LABEL_9;
    case 4u:
      noa = 4;
      goto LABEL_9;
    case 5u:
      noa = 2;
      goto LABEL_9;
    case 6u:
      noa = 3;
LABEL_9:
      nob = noa + 150;
      sample_sf = (signed __int64)((long double)(800 * instrument->cur_note.note + 100) / 44100.0 * 4096.0);
      volume_f = (long double)instrument->cur_note.volume / 254.0;
      pan = instrument->cur_note.pan;
      left_f = volume_f;
      right_f = volume_f;
      if ( pan > 5 )
      {
        if ( pan > 6 )
          left_f = volume_f * ((long double)(12 - instrument->cur_note.pan) / 6.0);
      }
      else
      {
        right_f = volume_f * ((long double)(6 - instrument->cur_note.pan) / 6.0);
      }
      i = 0;
      break;
    case 9u:
      return;
    default:
      fprintf(stderr, "unknown drum wave: %d\n", instrument->wave);
      __assert_fail(
        "0",
        "/home/simon/Projekte/doukutsu_sdl/src/generic/org.cpp",
        0x12Cu,
        "void _renderDrumWave(Sint32*, int, ORG_Instrument*, int)");
      return;
  }
  while ( i < len )
  {
    instrument->samples += sample_sf;
    s_offset_1 = instrument->samples >> 12;
    if ( (signed int)chunks[nob]->len <= s_offset_1 + 1 )
    {
      if ( (signed int)chunks[nob]->len <= s_offset_1 )
        break;
      val = (chunks[nob]->buf[s_offset_1] - 128) << 7;
    }
    else
    {
      val = (signed __int16)_interpolate(
                              (chunks[nob]->buf[s_offset_1] - 128) << 7,
                              (chunks[nob]->buf[s_offset_1 + 1] - 128) << 7,
                              instrument->samples & 0xFFF);
    }
    buffer[2 * i] = (signed int)((long double)buffer[2 * i] + (long double)val * left_f);
    buffer[2 * i + 1] = (signed int)((long double)buffer[2 * i + 1] + (long double)val * right_f);
    ++i;
  }
  if ( instrument->samples >> 12 >= chunks[nob]->len )
  {
    instrument->samples = 0;
    instrument->playing = 0;
  }
}

//----- (08069EED) --------------------------------------------------------
void __cdecl _renderOrgWave(Sint32 *buffer, $04553E4401276348CEA0C0E6398A028E *instrument, int len)
{
  long double v3;
  int s_offset_1;
  Sint32 val;
  int i;
  __int16 pan;
  float volume_f;
  float left_f;
  float right_f;
  Sint8 *org_wave;

  volume_f = (long double)instrument->cur_note.volume / 254.0;
  pan = instrument->cur_note.pan;
  left_f = volume_f;
  right_f = volume_f;
  if ( pan > 5 )
  {
    if ( pan > 6 )
      left_f = volume_f * ((long double)(12 - instrument->cur_note.pan) / 6.0);
  }
  else
  {
    right_f = volume_f * ((long double)(6 - instrument->cur_note.pan) / 6.0);
  }
  org_wave = (Sint8 *)&org_waves[256 * instrument->wave];
  v3 = ((long double)(octfreq[instrument->cur_note.note / 0xCu] * (signed int)notefreq[instrument->cur_note.note % 0xCu])
      * 32.0
      + (long double)instrument->freq
      - 1000.0)
     / 44100.0
     * 4096.0;
  for ( i = 0; i < len; ++i )
  {
    instrument->samples = ((unsigned __int64)(signed __int64)v3 + instrument->samples) & 0xFFFFF;
    s_offset_1 = instrument->samples >> 12;
    val = (signed __int16)_interpolate(
                            org_wave[s_offset_1] << 7,
                            org_wave[(unsigned __int8)(((unsigned int)((s_offset_1 + 1) >> 31) >> 24) + s_offset_1 + 1)
                                   - ((unsigned int)((s_offset_1 + 1) >> 31) >> 24)] << 7,
                            instrument->samples & 0xFFF);
    buffer[2 * i] += (signed int)((long double)val * left_f);
    buffer[2 * i + 1] += (signed int)((long double)val * right_f);
  }
}

//----- (0806A17C) --------------------------------------------------------
void __cdecl org_mixer(void *param, Uint8 *stream, int len)
{
  Sint16 v3;
  unsigned int samples_per_beat;
  int samples;
  int samples_left;
  signed int render_samples;
  int samples_rendered;
  int i;
  int ia;
  int j;
  int ja;
  int track_pos;
  Sint32 *buffer;
  Uint8 b_notestart;
  float f_volume;

  samples = len / 4;
  if ( Player.org )
  {
    samples_per_beat = 44100 * Player.org->tempo / 1000;
    buffer = (Sint32 *)malloc(8 * samples);
    memset(buffer, 0, 8 * samples);
    samples_left = len / 4;
    samples_rendered = 0;
    while ( samples_left > 0 )
    {
      render_samples = samples_per_beat - Player.org->samples % samples_per_beat;
      if ( render_samples > samples_left )
        render_samples = samples_left;
      for ( i = 0; i <= 15; ++i )
      {
        if ( Player.org->track[i].note && Player.org->track[i].playing > 0 )
        {
          if ( i > 7 )
            _renderDrumWave(&buffer[2 * samples_rendered], i - 8, &Player.org->track[i], render_samples);
          else
            _renderOrgWave(&buffer[2 * samples_rendered], &Player.org->track[i], render_samples);
        }
      }
      samples_left -= render_samples;
      samples_rendered += render_samples;
      Player.org->samples += render_samples;
      if ( !(Player.org->samples % samples_per_beat) )
      {
        if ( Player.fadeout )
          Player.volume -= 2;
        if ( Player.volume < 0 )
          Player.volume = 0;
        if ( ++Player.org->pos >= Player.org->loopEnd )
          setORGPosition(Player.org, Player.org->loopStart);
        for ( ia = 0; ia <= 15; ++ia )
        {
          track_pos = Player.org->track[ia].pos;
          if ( Player.org->track[ia].note )
          {
            b_notestart = 0;
            if ( Player.org->track[ia].num_notes > track_pos
              && Player.org->pos == Player.org->track[ia].note[track_pos].start )
            {
              ++Player.org->track[ia].pos;
              if ( Player.org->track[ia].note[track_pos].note != -1 )
              {
                Player.org->track[ia].samples = 0;
                if ( Player.org->track[ia].pi )
                  v3 = 1;
                else
                  v3 = Player.org->track[ia].note[track_pos].length;
                Player.org->track[ia].playing = v3;
                Player.org->track[ia].cur_note.note = Player.org->track[ia].note[track_pos].note;
                b_notestart = 1;
              }
              if ( Player.org->track[ia].note[track_pos].pan != -1 )
                Player.org->track[ia].cur_note.pan = Player.org->track[ia].note[track_pos].pan;
              if ( Player.org->track[ia].note[track_pos].volume != -1 )
                Player.org->track[ia].cur_note.volume = Player.org->track[ia].note[track_pos].volume;
            }
            if ( !b_notestart && Player.org->track[ia].playing > 0 && ia <= 7 )
              --Player.org->track[ia].playing;
          }
        }
      }
    }
    for ( j = 0; 2 * samples > j; ++j )
    {
      if ( buffer[j] <= 0x7FFF )
      {
        if ( buffer[j] >= -32768 )
        {
          buffer[j] = buffer[j];
        }
        else
        {
          fprintf(stderr, "%d! ", 0x8000 - buffer[j]);
          buffer[j] = -32768;
        }
      }
      else
      {
        fprintf(stderr, "%d! ", buffer[j] - 0x7FFF);
        buffer[j] = 0x7FFF;
      }
    }
    f_volume = (long double)Player.volume / 192.0;
    for ( ja = 0; ja < samples; ++ja )
    {
      *(_WORD *)&stream[4 * ja] = (signed __int16)((long double)*(signed __int16 *)&stream[4 * ja]
                                                 + (long double)buffer[2 * ja] * f_volume);
      *(_WORD *)&stream[2 * (2 * ja + 1)] = (signed __int16)((long double)*(signed __int16 *)&stream[2 * (2 * ja + 1)]
                                                           + (long double)buffer[2 * ja + 1] * f_volume);
    }
    free(buffer);
  }
}

//----- (0806A8F7) --------------------------------------------------------
void initORG()
{
  int dummy;

  Player.org = 0;
  org_waves = (Uint8 *)get_resource("Wave", &dummy);
}

//----- (0806A921) --------------------------------------------------------
void quitORG()
{
  Player.org = 0;
}

//----- (0806A930) --------------------------------------------------------
void InitStar()
{
  memset(_star, 0, 0xCCu);
  _star[0].x = x;
  _star[0].y = y;
  _star[1].x = x;
  _star[1].y = y;
  _star[2].x = x;
  _star[2].y = y;
  _star[0].xm = 1024;
  _star[0].ym = -512;
  _star[1].xm = -512;
  _star[1].ym = 1024;
  _star[2].xm = 512;
  _star[2].ym = 512;
}

//----- (0806A9CC) --------------------------------------------------------
void ActStar()
{
  int v0;
  int v1;
  int v2;
  int v3;
  int i;

  ++ActStar(void)::_a;
  ActStar(void)::_a %= 3;
  for ( i = 0; i <= 2; ++i )
  {
    if ( i )
    {
      if ( _star[i - 1].x >= _star[i].x )
        v0 = _star[i].xm + 128;
      else
        v0 = _star[i].xm - 128;
      _star[i].xm = v0;
      if ( _star[i - 1].y >= _star[i].y )
        v1 = _star[i].ym + 170;
      else
        v1 = _star[i].ym - 170;
      _star[i].ym = v1;
    }
    else
    {
      if ( x >= _star[0].x )
        v2 = _star[0].xm + 128;
      else
        v2 = _star[0].xm - 128;
      _star[0].xm = v2;
      if ( y >= _star[0].y )
        v3 = _star[0].ym + 170;
      else
        v3 = _star[0].ym - 170;
      _star[0].ym = v3;
    }
    if ( _star[i].xm > 2560 )
      _star[i].xm = 2560;
    if ( _star[i].xm < -2560 )
      _star[i].xm = -2560;
    if ( _star[i].ym > 2560 )
      _star[i].ym = 2560;
    if ( _star[i].ym < -2560 )
      _star[i].ym = -2560;
    if ( _star[i].xm > 2560 )
      _star[i].xm = 2560;
    if ( _star[i].xm < -2560 )
      _star[i].xm = -2560;
    if ( _star[i].ym > 2560 )
      _star[i].ym = 2560;
    if ( _star[i].ym < -2560 )
      _star[i].ym = -2560;
    _star[i].x += _star[i].xm;
    _star[i].y += _star[i].ym;
    if ( unk_81C8616 > i && unk_81C8598 & 0x80 && g_GameFlags & 2 && ActStar(void)::_a == i )
      SetBullet(45, _star[ActStar(void)::_a].x, _star[ActStar(void)::_a].y, 0);
  }
}

//----- (0806AEBC) --------------------------------------------------------
void __cdecl PutStar(int fx, int fy)
{
  RECT rc[3];
  int i;

  rc[0].left = 192;
  rc[0].top = 0;
  rc[0].right = 200;
  rc[0].bottom = 8;
  rc[1].left = 192;
  rc[1].top = 8;
  rc[1].right = 200;
  rc[1].bottom = 16;
  rc[2].left = 192;
  rc[2].top = 16;
  rc[2].right = 200;
  rc[2].bottom = 24;
  if ( !(gMC.cond & 2) && unk_81C8598 & 0x80 )
  {
    for ( i = 0; i <= 2; ++i )
    {
      if ( unk_81C8616 > i )
        PutBitmap3(&grcGame, _star[i].x / 512 - fx / 512 - 4, _star[i].y / 512 - fy / 512 - 4, &rc[i], 16);
    }
  }
}

//----- (0806B024) --------------------------------------------------------
bool __cdecl LoadConfigData($88CD5C1514A19B01CE178CB8EAE44D15 *conf)
{
  int v2;
  char path[260];
  SDL_RWops_0 *fp;
  int button;

  memset(conf, 0, 0x94u);
  sprintf(path, "%s/%s", gModulePath, "Config.dat");
  fp = SDL_RWFromFile(path, "rb");
  if ( !fp )
    return 0;
  fp->read(fp, conf, 32, 1);
  fp->read(fp, conf->font_name, 64, 1);
  conf->move_button_mode = SDL_ReadLE32(fp);
  conf->attack_button_mode = SDL_ReadLE32(fp);
  conf->ok_button_mode = SDL_ReadLE32(fp);
  conf->display_mode = SDL_ReadLE32(fp);
  conf->bJoystick = SDL_ReadLE32(fp);
  for ( button = 0; button <= 7; ++button )
  {
    v2 = button;
    *(_DWORD *)&conf->proof[4 * (v2 + 28) + 4] = SDL_ReadLE32(fp);
  }
  fp->close(fp);
  if ( !strcmp(conf->proof, "DOUKUTSU20041206") )
    return 1;
  memset(conf, 0, 0x94u);
  return 0;
}


//----- (0806B1CB) --------------------------------------------------------
void __cdecl map_button($88CD5C1514A19B01CE178CB8EAE44D15 *conf, size_t index, Sint32 action)
{
  *(_DWORD *)&conf->proof[4 * (index + 28) + 4] = action;
}

//----- (0806B1E0) --------------------------------------------------------
void __cdecl DefaultConfigData($88CD5C1514A19B01CE178CB8EAE44D15 *conf)
{
  memset(conf, 0, 0x94u);
  conf->display_mode = 1;
  conf->bJoystick = 1;
  map_button(conf, 0, 2);
  map_button(conf, 1u, 1);
  map_button(conf, 2u, 5);
  map_button(conf, 3u, 6);
  map_button(conf, 4u, 3);
  map_button(conf, 5u, 4);
  map_button(conf, 6u, 6);
  map_button(conf, 7u, 3);
}

//----- (0806B2F0) --------------------------------------------------------
void __cdecl ActNpc100(NPCHAR_0 *npc)
{
  if ( !npc->act_no )
  {
    npc->y += 0x2000;
    npc->act_no = 1;
  }
  npc->rect.left = 272;
  npc->rect.top = 48;
  npc->rect.right = 288;
  npc->rect.bottom = 64;
}

//----- (0806B398) --------------------------------------------------------
void __cdecl ActNpc101(NPCHAR_0 *npc)
{
  RECT *v1;
  RECT rect[3];

  rect[0].left = 240;
  rect[0].top = 136;
  rect[0].right = 256;
  rect[0].bottom = 152;
  rect[1].left = 240;
  rect[1].top = 136;
  rect[1].right = 256;
  rect[1].bottom = 152;
  rect[2].left = 256;
  rect[2].top = 136;
  rect[2].right = 272;
  rect[2].bottom = 152;
  if ( ++npc->ani_wait > 3 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 2 )
    npc->ani_no = 0;
  v1 = &rect[npc->ani_no];
  npc->rect.left = v1->left;
  npc->rect.top = v1->top;
  npc->rect.right = v1->right;
  npc->rect.bottom = v1->bottom;
}

//----- (0806B466) --------------------------------------------------------
void __cdecl ActNpc102(NPCHAR_0 *npc)
{
  RECT *v1;
  RECT rect[4];

  rect[0].left = 208;
  rect[0].top = 120;
  rect[0].right = 224;
  rect[0].bottom = 136;
  rect[1].left = 224;
  rect[1].top = 120;
  rect[1].right = 240;
  rect[1].bottom = 136;
  rect[2].left = 240;
  rect[2].top = 120;
  rect[2].right = 256;
  rect[2].bottom = 136;
  rect[3].left = 256;
  rect[3].top = 120;
  rect[3].right = 272;
  rect[3].bottom = 136;
  if ( !npc->act_no )
  {
    npc->act_no = 1;
    npc->y += 4096;
  }
  if ( ++npc->ani_wait > 0 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 3 )
    npc->ani_no = 0;
  v1 = &rect[npc->ani_no];
  npc->rect.left = v1->left;
  npc->rect.top = v1->top;
  npc->rect.right = v1->right;
  npc->rect.bottom = v1->bottom;
}

//----- (0806B575) --------------------------------------------------------
void __cdecl ActNpc103(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  NPCHAR_0 *v3;
  Sint32 *v4;
  RECT rcRight[3];
  RECT rcLeft[3];
  char v7[8];

  rcLeft[0].left = 192;
  rcLeft[0].top = 96;
  rcLeft[0].right = 208;
  rcLeft[0].bottom = 120;
  rcLeft[1].left = 208;
  rcLeft[1].top = 96;
  rcLeft[1].right = 224;
  rcLeft[1].bottom = 120;
  rcLeft[2].left = 224;
  rcLeft[2].top = 96;
  rcLeft[2].right = 240;
  rcLeft[2].bottom = 120;
  rcRight[0].left = 192;
  rcRight[0].top = 120;
  rcRight[0].right = 208;
  rcRight[0].bottom = 144;
  rcRight[1].left = 208;
  rcRight[1].top = 120;
  rcRight[1].right = 224;
  rcRight[1].bottom = 144;
  rcRight[2].left = 224;
  rcRight[2].top = 120;
  rcRight[2].right = 240;
  rcRight[2].bottom = 144;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_12;
  }
  else
  {
    npc->act_no = 1;
  }
  if ( npc->direct )
    v2 = npc->xm + 32;
  else
    v2 = npc->xm - 32;
  npc->xm = v2;
  if ( ++npc->ani_wait > 0 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 2 )
    npc->ani_no = 0;
LABEL_12:
  npc->x += npc->xm;
  if ( npc->direct )
  {
    v3 = npc;
    v4 = (Sint32 *)&v7[16 * npc->ani_no - 96];
  }
  else
  {
    v3 = npc;
    v4 = (Sint32 *)&v7[16 * npc->ani_no - 48];
  }
  npc->rect.left = *v4;
  v3->rect.top = v4[1];
  v3->rect.right = v4[2];
  v3->rect.bottom = v4[3];
  if ( ++npc->count1 > 100 )
    npc->cond = 0;
  if ( npc->count1 % 4 == 1 )
    PlaySoundObject(46, 1);
}


//----- (0806B777) --------------------------------------------------------
void __cdecl ActNpc104(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  Sint32 *v2;
  RECT rcRight[3];
  RECT rcLeft[3];
  bool bJump;
  char v6[8];

  rcLeft[0].left = 0;
  rcLeft[0].top = 112;
  rcLeft[0].right = 32;
  rcLeft[0].bottom = 144;
  rcLeft[1].left = 32;
  rcLeft[1].top = 112;
  rcLeft[1].right = 64;
  rcLeft[1].bottom = 144;
  rcLeft[2].left = 64;
  rcLeft[2].top = 112;
  rcLeft[2].right = 96;
  rcLeft[2].bottom = 144;
  rcRight[0].left = 0;
  rcRight[0].top = 144;
  rcRight[0].right = 32;
  rcRight[0].bottom = 176;
  rcRight[1].left = 32;
  rcRight[1].top = 144;
  rcRight[1].right = 64;
  rcRight[1].bottom = 176;
  rcRight[2].left = 64;
  rcRight[2].top = 144;
  rcRight[2].right = 96;
  rcRight[2].bottom = 176;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->act_wait = 0;
      npc->xm = 0;
      npc->ym = 0;
      if ( npc->direct != 4 )
      {
        npc->bits &= 0xFFF7u;
        goto LABEL_8;
      }
      if ( Random(0, 1) != 0 )
        npc->direct = 0;
      else
        npc->direct = 2;
      npc->bits |= 8u;
      npc->ani_no = 2;
      npc->act_no = 3;
      break;
    case 1:
LABEL_8:
      ++npc->act_wait;
      if ( Random(0, 50) == 1 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 0;
        npc->ani_wait = 0;
      }
      break;
    case 2:
      ++npc->act_wait;
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 1 )
        npc->ani_no = 0;
      if ( npc->act_wait > 18 )
      {
        npc->act_no = 1;
        npc->act_no = 1;
      }
      break;
    case 3:
      if ( ++npc->act_wait > 40 )
        npc->bits &= 0xFFF7u;
      if ( npc->flag & 8 )
      {
        npc->act_no = 0;
        npc->ani_no = 0;
        npc->act_wait = 0;
      }
      break;
    case 0xA:
      npc->act_no = 11;
      goto LABEL_21;
    case 0xB:
LABEL_21:
      if ( npc->flag & 1 && npc->xm < 0 )
      {
        npc->xm = -npc->xm;
        npc->direct = 2;
      }
      if ( npc->flag & 4 && npc->xm > 0 )
      {
        npc->xm = -npc->xm;
        npc->direct = 0;
      }
      if ( npc->flag & 8 )
      {
        npc->act_no = 0;
        npc->ani_no = 0;
        npc->act_wait = 0;
      }
      break;
    default:
      break;
  }
  bJump = 0;
  if ( npc->act_no <= 9 && npc->act_no != 3 && npc->act_wait > 10 )
  {
    if ( npc->shock )
      bJump = 1;
    if ( npc->x >= x - 81920
      && npc->x <= x + 81920
      && npc->y >= y - 0x8000
      && npc->y <= y + 0x8000
      && Random(0, 50) == 2 )
    {
      bJump = 1;
    }
  }
  if ( bJump )
  {
    if ( npc->x >= x )
      npc->direct = 0;
    else
      npc->direct = 2;
    npc->act_no = 10;
    npc->ani_no = 2;
    npc->ym = -1535;
    if ( !(gMC.cond & 2) )
      PlaySoundObject(30, 1);
    if ( npc->direct )
      npc->xm = 512;
    else
      npc->xm = -512;
  }
  npc->ym += 128;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v1 = npc;
    v2 = (Sint32 *)&v6[16 * npc->ani_no - 100];
  }
  else
  {
    v1 = npc;
    v2 = (Sint32 *)&v6[16 * npc->ani_no - 52];
  }
  npc->rect.left = *v2;
  v1->rect.top = v2[1];
  v1->rect.right = v2[2];
  v1->rect.bottom = v2[3];
}


//----- (0806BCC9) --------------------------------------------------------
void __cdecl ActNpc105(NPCHAR_0 *npc)
{
  RECT *v1;
  RECT rect[2];

  rect[0].left = 128;
  rect[0].top = 32;
  rect[0].right = 144;
  rect[0].bottom = 48;
  rect[1].left = 128;
  rect[1].top = 32;
  rect[1].right = 128;
  rect[1].bottom = 32;
  if ( ++npc->act_wait > 30 )
    npc->cond = 0;
  if ( npc->act_wait <= 4 )
    npc->y -= 512;
  v1 = &rect[npc->ani_no];
  npc->rect.left = v1->left;
  npc->rect.top = v1->top;
  npc->rect.right = v1->right;
  npc->rect.bottom = v1->bottom;
}

//----- (0806BD70) --------------------------------------------------------
void __cdecl ActNpc106(NPCHAR_0 *npc)
{
  if ( !npc->act_no )
  {
    SetNpChar(105, npc->x, npc->y - 4096, 0, 0, 0, 0, 384);
    npc->act_no = 1;
  }
}

//----- (0806BDDA) --------------------------------------------------------
void __cdecl ActNpc107(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  Sint32 *v7;
  RECT rcPoweron[10];
  int i;
  char v10[24];

  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      if ( npc->direct == 2 )
        npc->ani_no = 5;
      break;
    case 0xA:
      npc->act_no = 11;
      npc->act_wait = 0;
      npc->ani_wait = 0;
      for ( i = 0; i <= 3; ++i )
      {
        v1 = Random(-1536, 0);
        v2 = Random(-341, 341);
        SetNpChar(4, npc->x, npc->y, v2, v1, 0, 0, 256);
      }
      goto LABEL_7;
    case 0xB:
LABEL_7:
      if ( ++npc->ani_wait > 1 )
      {
        PlaySoundObject(43, 1);
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 1 )
        npc->ani_no = 0;
      if ( ++npc->act_wait > 100 )
        npc->act_no = 12;
      break;
    case 0xC:
      npc->act_no = 13;
      npc->act_wait = 0;
      npc->ani_no = 1;
      goto LABEL_14;
    case 0xD:
LABEL_14:
      if ( ++npc->act_wait > 50 )
        npc->act_no = 14;
      break;
    case 0xE:
      npc->act_no = 15;
      npc->act_wait = 0;
      goto LABEL_17;
    case 0xF:
LABEL_17:
      if ( npc->act_wait / 2 & 1 )
      {
        npc->x += 512;
        PlaySoundObject(11, 1);
      }
      else
      {
        npc->x -= 512;
      }
      if ( ++npc->act_wait > 50 )
        npc->act_no = 16;
      break;
    case 0x10:
      npc->act_no = 17;
      npc->act_wait = 0;
      npc->ani_no = 2;
      PlaySoundObject(12, 1);
      for ( i = 0; i <= 7; ++i )
      {
        v3 = Random(-1536, 0);
        v4 = Random(-341, 341);
        SetNpChar(4, npc->x, npc->y, v4, v3, 0, 0, 256);
      }
      goto LABEL_25;
    case 0x11:
LABEL_25:
      if ( ++npc->act_wait > 150 )
        npc->act_no = 18;
      break;
    case 0x12:
      npc->act_no = 19;
      npc->act_wait = 0;
      npc->ani_no = 3;
      npc->ani_wait = 0;
      goto LABEL_28;
    case 0x13:
LABEL_28:
      if ( ++npc->ani_wait > 3 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 4 )
      {
        PlaySoundObject(11, 1);
        npc->ani_no = 3;
      }
      if ( ++npc->act_wait > 100 )
      {
        npc->act_no = 20;
        PlaySoundObject(12, 1);
        for ( i = 0; i <= 3; ++i )
        {
          v5 = Random(-1536, 0);
          v6 = Random(-341, 341);
          SetNpChar(4, npc->x, npc->y, v6, v5, 0, 0, 256);
        }
      }
      break;
    case 0x14:
      npc->ani_no = 4;
      break;
    case 0x15:
      npc->act_no = 22;
      npc->ani_no = 5;
      PlaySoundObject(51, 1);
      break;
    case 0x64:
      npc->act_no = 101;
      npc->ani_no = 6;
      npc->ani_wait = 0;
      goto LABEL_40;
    case 0x65:
LABEL_40:
      if ( ++npc->ani_wait > 4 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 9 )
        npc->ani_no = 6;
      break;
    case 0x6E:
      SetDestroyNpChar(npc->x, npc->y, 0x2000, 16);
      npc->cond = 0;
      break;
    default:
      break;
  }
  qmemcpy(rcPoweron, &ActNpc107(NPCHAR *)::C.3, sizeof(rcPoweron));
  v7 = (Sint32 *)&v10[16 * npc->ani_no - 164];
  npc->rect.left = *v7;
  npc->rect.top = v7[1];
  npc->rect.right = v7[2];
  npc->rect.bottom = v7[3];
}


//----- (0806C38F) --------------------------------------------------------
void __cdecl ActNpc108(NPCHAR_0 *npc)
{
  Sint32 *v1;
  RECT rect_left[3];
  char v3[8];

  if ( npc->flag & 0xFF )
  {
    SetCaret(npc->x, npc->y, 2, 0);
    npc->cond = 0;
  }
  npc->y += npc->ym;
  npc->x += npc->xm;
  rect_left[0].left = 96;
  rect_left[0].top = 48;
  rect_left[0].right = 112;
  rect_left[0].bottom = 64;
  rect_left[1].left = 112;
  rect_left[1].top = 48;
  rect_left[1].right = 128;
  rect_left[1].bottom = 64;
  rect_left[2].left = 128;
  rect_left[2].top = 48;
  rect_left[2].right = 144;
  rect_left[2].bottom = 64;
  if ( ++npc->ani_wait > 1 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 2 )
    npc->ani_no = 0;
  v1 = (Sint32 *)&v3[16 * npc->ani_no - 48];
  npc->rect.left = *v1;
  npc->rect.top = v1[1];
  npc->rect.right = v1[2];
  npc->rect.bottom = v1[3];
  if ( ++npc->count1 > 300 )
  {
    SetCaret(npc->x, npc->y, 2, 0);
    npc->cond = 0;
  }
}


//----- (0806C50E) --------------------------------------------------------
void __cdecl ActNpc109(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  NPCHAR_0 *v4;
  Sint32 *v5;
  RECT rcRight[2];
  RECT rcLeft[2];
  int i;
  char v9[8];

  rcLeft[0].left = 240;
  rcLeft[0].top = 0;
  rcLeft[0].right = 256;
  rcLeft[0].bottom = 24;
  rcLeft[1].left = 256;
  rcLeft[1].top = 0;
  rcLeft[1].right = 272;
  rcLeft[1].bottom = 24;
  rcRight[0].left = 240;
  rcRight[0].top = 24;
  rcRight[0].right = 256;
  rcRight[0].bottom = 48;
  rcRight[1].left = 256;
  rcRight[1].top = 24;
  rcRight[1].right = 272;
  rcRight[1].bottom = 48;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_11:
    if ( Random(0, 120) == 10 )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
      npc->ani_no = 1;
    }
    if ( npc->x - 0x4000 < x && npc->x + 0x4000 > x && npc->y - 0x4000 < y && npc->y + 0x2000 > y )
    {
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
    }
    goto LABEL_25;
  }
  if ( v1 <= 1 )
  {
    if ( v1 )
      goto LABEL_25;
    if ( --npc->act_wait )
      npc->act_no = 1;
    npc->ani_no = 0;
    npc->ani_wait = 0;
    goto LABEL_11;
  }
  if ( v1 == 2 )
  {
    if ( ++npc->act_wait > 8 )
    {
      npc->act_no = 1;
      npc->ani_no = 0;
    }
  }
  else if ( v1 == 10 )
  {
    npc->act_no = 0;
    PlaySoundObject(12, 1);
    for ( i = 0; i <= 7; ++i )
    {
      v2 = Random(-1536, 0);
      v3 = Random(-341, 341);
      SetNpChar(4, npc->x, npc->y, v3, v2, 0, 0, 256);
    }
  }
LABEL_25:
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v4 = npc;
    v5 = (Sint32 *)&v9[16 * npc->ani_no - 68];
  }
  else
  {
    v4 = npc;
    v5 = (Sint32 *)&v9[16 * npc->ani_no - 36];
  }
  npc->rect.left = *v5;
  v4->rect.top = v5[1];
  v4->rect.right = v5[2];
  v4->rect.bottom = v5[3];
}


//----- (0806C843) --------------------------------------------------------
void __cdecl ActNpc110(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  Sint32 *v2;
  RECT rcRight[3];
  RECT rcLeft[3];
  bool bJump;
  char v6[8];

  rcLeft[0].left = 96;
  rcLeft[0].top = 128;
  rcLeft[0].right = 112;
  rcLeft[0].bottom = 144;
  rcLeft[1].left = 112;
  rcLeft[1].top = 128;
  rcLeft[1].right = 128;
  rcLeft[1].bottom = 144;
  rcLeft[2].left = 128;
  rcLeft[2].top = 128;
  rcLeft[2].right = 144;
  rcLeft[2].bottom = 144;
  rcRight[0].left = 96;
  rcRight[0].top = 144;
  rcRight[0].right = 112;
  rcRight[0].bottom = 160;
  rcRight[1].left = 112;
  rcRight[1].top = 144;
  rcRight[1].right = 128;
  rcRight[1].bottom = 160;
  rcRight[2].left = 128;
  rcRight[2].top = 144;
  rcRight[2].right = 144;
  rcRight[2].bottom = 160;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->act_wait = 0;
      npc->xm = 0;
      npc->ym = 0;
      if ( npc->direct != 4 )
      {
        npc->bits &= 0xFFF7u;
        goto LABEL_8;
      }
      if ( Random(0, 1) != 0 )
        npc->direct = 0;
      else
        npc->direct = 2;
      npc->bits |= 8u;
      npc->ani_no = 2;
      npc->act_no = 3;
      break;
    case 1:
LABEL_8:
      ++npc->act_wait;
      if ( Random(0, 50) == 1 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 0;
        npc->ani_wait = 0;
      }
      break;
    case 2:
      ++npc->act_wait;
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 1 )
        npc->ani_no = 0;
      if ( npc->act_wait > 18 )
      {
        npc->act_no = 1;
        npc->act_no = 1;
      }
      break;
    case 3:
      if ( ++npc->act_wait > 40 )
        npc->bits &= 0xFFF7u;
      if ( npc->flag & 8 )
      {
        npc->act_no = 0;
        npc->ani_no = 0;
        npc->act_wait = 0;
      }
      break;
    case 0xA:
      npc->act_no = 11;
      goto LABEL_21;
    case 0xB:
LABEL_21:
      if ( npc->flag & 1 && npc->xm < 0 )
      {
        npc->xm = -npc->xm;
        npc->direct = 2;
      }
      if ( npc->flag & 4 && npc->xm > 0 )
      {
        npc->xm = -npc->xm;
        npc->direct = 0;
      }
      if ( npc->flag & 8 )
      {
        npc->act_no = 0;
        npc->ani_no = 0;
        npc->act_wait = 0;
      }
      break;
    default:
      break;
  }
  bJump = 0;
  if ( npc->act_no <= 9 && npc->act_no != 3 && npc->act_wait > 10 )
  {
    if ( npc->shock )
      bJump = 1;
    if ( npc->x >= x - 81920
      && npc->x <= x + 81920
      && npc->y >= y - 0x8000
      && npc->y <= y + 0x8000
      && Random(0, 50) == 2 )
    {
      bJump = 1;
    }
  }
  if ( bJump )
  {
    if ( npc->x >= x )
      npc->direct = 0;
    else
      npc->direct = 2;
    npc->act_no = 10;
    npc->ani_no = 2;
    npc->ym = -767;
    PlaySoundObject(6, 1);
    if ( npc->direct )
      npc->xm = 256;
    else
      npc->xm = -256;
  }
  npc->ym += 128;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v1 = npc;
    v2 = (Sint32 *)&v6[16 * npc->ani_no - 100];
  }
  else
  {
    v1 = npc;
    v2 = (Sint32 *)&v6[16 * npc->ani_no - 52];
  }
  npc->rect.left = *v2;
  v1->rect.top = v2[1];
  v1->rect.right = v2[2];
  v1->rect.bottom = v2[3];
}


//----- (0806CD80) --------------------------------------------------------
void __cdecl ActNpc111(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  Sint32 *v2;
  RECT rcRight[2];
  RECT rcLeft[2];
  char v5[8];

  rcLeft[0].left = 0;
  rcLeft[0].top = 0;
  rcLeft[0].right = 16;
  rcLeft[0].bottom = 16;
  rcLeft[1].left = 16;
  rcLeft[1].top = 0;
  rcLeft[1].right = 32;
  rcLeft[1].bottom = 16;
  rcRight[0].left = 0;
  rcRight[0].top = 16;
  rcRight[0].right = 16;
  rcRight[0].bottom = 32;
  rcRight[1].left = 16;
  rcRight[1].top = 16;
  rcRight[1].right = 32;
  rcRight[1].bottom = 32;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->y -= 0x2000;
      break;
    case 1:
      if ( ++npc->act_wait > 20 )
      {
        npc->act_wait = 0;
        npc->act_no = 2;
        npc->ani_no = 1;
        npc->ym = -767;
      }
      break;
    case 2:
      if ( npc->ym > 0 )
        npc->hit.bottom = 0x2000;
      if ( npc->flag & 8 )
      {
        npc->act_no = 3;
        npc->act_wait = 0;
        npc->ani_no = 0;
      }
      break;
    case 3:
      if ( ++npc->act_wait > 40 )
      {
        npc->act_no = 4;
        npc->act_wait = 64;
        PlaySoundObject(29, 1);
      }
      break;
    case 4:
      --npc->act_wait;
      npc->ani_no = 0;
      if ( !npc->act_wait )
        npc->cond = 0;
      break;
    default:
      break;
  }
  npc->ym += 64;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v1 = npc;
    v2 = (Sint32 *)&v5[16 * npc->ani_no - 64];
  }
  else
  {
    v1 = npc;
    v2 = (Sint32 *)&v5[16 * npc->ani_no - 32];
  }
  npc->rect.left = *v2;
  v1->rect.top = v2[1];
  v1->rect.right = v2[2];
  v1->rect.bottom = v2[3];
  if ( unk_81C8598 & 0x40 )
  {
    npc->rect.top += 32;
    npc->rect.bottom += 32;
  }
  if ( npc->act_no == 4 )
  {
    npc->rect.bottom = npc->act_wait / 4 + npc->rect.top;
    if ( npc->act_wait / 2 & 1 )
      ++npc->rect.left;
  }
}


//----- (0806D048) --------------------------------------------------------
void __cdecl ActNpc112(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[2];
  RECT rcLeft[2];
  char v6[8];

  rcLeft[0].left = 0;
  rcLeft[0].top = 0;
  rcLeft[0].right = 16;
  rcLeft[0].bottom = 16;
  rcLeft[1].left = 16;
  rcLeft[1].top = 0;
  rcLeft[1].right = 32;
  rcLeft[1].bottom = 16;
  rcRight[0].left = 0;
  rcRight[0].top = 16;
  rcRight[0].right = 16;
  rcRight[0].bottom = 32;
  rcRight[1].left = 16;
  rcRight[1].top = 16;
  rcRight[1].right = 32;
  rcRight[1].bottom = 32;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_9:
    if ( ++npc->act_wait == 64 )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
    }
    goto LABEL_15;
  }
  if ( v1 <= 1 )
  {
    if ( v1 )
      goto LABEL_15;
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->ani_wait = 0;
    npc->x += 0x2000;
    npc->y += 4096;
    PlaySoundObject(29, 1);
    goto LABEL_9;
  }
  if ( v1 == 2 )
  {
    if ( ++npc->act_wait > 20 )
    {
      npc->act_no = 3;
      npc->ani_no = 1;
      npc->hit.bottom = 4096;
    }
  }
  else if ( v1 == 3 && npc->flag & 8 )
  {
    npc->act_no = 4;
    npc->act_wait = 0;
    npc->ani_no = 0;
  }
LABEL_15:
  npc->ym += 64;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 64];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 32];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
  if ( unk_81C8598 & 0x40 )
  {
    npc->rect.top += 32;
    npc->rect.bottom += 32;
  }
  if ( npc->act_no == 1 )
  {
    npc->rect.bottom = npc->act_wait / 4 + npc->rect.top;
    if ( npc->act_wait / 2 & 1 )
      ++npc->rect.left;
  }
}


//----- (0806D2EC) --------------------------------------------------------
void __cdecl ActNpc113(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[7];
  RECT rcLeft[7];
  char v6[24];

  qmemcpy(rcLeft, &ActNpc113(NPCHAR *)::C.8, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc113(NPCHAR *)::C.9, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( Random(0, 120) == 10 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      break;
    case 2:
      if ( ++npc->act_wait > 8 )
      {
        npc->act_no = 1;
        npc->ani_no = 0;
      }
      break;
    case 3:
      npc->act_no = 4;
      npc->ani_no = 2;
      npc->ani_wait = 0;
      goto LABEL_8;
    case 4:
LABEL_8:
      if ( ++npc->ani_wait > 4 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 5 )
        npc->ani_no = 2;
      if ( npc->direct )
        v1 = npc->x + 512;
      else
        v1 = npc->x - 512;
      npc->x = v1;
      break;
    case 5:
      npc->ani_no = 6;
      break;
    case 0x1E:
      npc->act_no = 31;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      npc->hit.bottom = 0x2000;
      npc->x -= 0x2000;
      npc->y += 4096;
      PlaySoundObject(29, 1);
      goto LABEL_18;
    case 0x1F:
LABEL_18:
      if ( ++npc->act_wait == 64 )
      {
        npc->act_no = 32;
        npc->act_wait = 0;
      }
      break;
    case 0x20:
      if ( ++npc->act_wait > 20 )
      {
        npc->act_no = 33;
        npc->ani_no = 1;
        npc->hit.bottom = 4096;
      }
      break;
    case 0x21:
      if ( npc->flag & 8 )
      {
        npc->act_no = 34;
        npc->act_wait = 0;
        npc->ani_no = 0;
      }
      break;
    default:
      break;
  }
  npc->ym += 64;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 224];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 112];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
  if ( npc->act_no == 31 )
  {
    npc->rect.bottom = npc->act_wait / 4 + npc->rect.top;
    if ( npc->act_wait / 2 & 1 )
      ++npc->rect.left;
  }
}


//----- (0806D67A) --------------------------------------------------------
void __cdecl ActNpc114(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  Sint32 *v4;
  RECT rcLeft[3];
  int i;
  char v7[8];

  rcLeft[0].left = 144;
  rcLeft[0].top = 112;
  rcLeft[0].right = 160;
  rcLeft[0].bottom = 136;
  rcLeft[1].left = 160;
  rcLeft[1].top = 112;
  rcLeft[1].right = 176;
  rcLeft[1].bottom = 136;
  rcLeft[2].left = 176;
  rcLeft[2].top = 112;
  rcLeft[2].right = 192;
  rcLeft[2].bottom = 136;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    if ( !(npc->flag & 8) )
    {
      npc->act_no = 10;
      npc->ani_wait = 0;
      npc->ani_no = 1;
    }
    goto LABEL_21;
  }
  if ( v1 != 10 )
  {
    if ( v1 )
      goto LABEL_21;
    npc->act_no = 1;
    npc->y -= 2048;
    goto LABEL_5;
  }
  if ( ++npc->ani_wait > 2 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 2 )
    npc->ani_no = 2;
  if ( y <= npc->y )
  {
    npc->bits |= 0x40u;
    npc->damage = 0;
  }
  else
  {
    npc->bits &= 0xFFBFu;
    npc->damage = 127;
  }
  if ( npc->flag & 8 )
  {
    if ( npc->ani_no > 1 )
    {
      for ( i = 0; i <= 3; ++i )
      {
        v2 = Random(-1536, 0);
        v3 = Random(-341, 341);
        SetNpChar(4, npc->x, npc->y, v3, v2, 0, 0, 256);
      }
      PlaySoundObject(26, 1);
      SetQuake(10);
    }
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->damage = 0;
    npc->bits |= 0x40u;
  }
LABEL_21:
  npc->ym += 32;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->y += npc->ym;
  v4 = (Sint32 *)&v7[16 * npc->ani_no - 52];
  npc->rect.left = *v4;
  npc->rect.top = v4[1];
  npc->rect.right = v4[2];
  npc->rect.bottom = v4[3];
}


//----- (0806D93C) --------------------------------------------------------
void __cdecl ActNpc115(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  NPCHAR_0 *v8;
  Sint32 *v9;
  RECT rcRight[6];
  RECT rcLeft[6];
  int i;
  char v13[24];

  qmemcpy(rcLeft, &ActNpc115(NPCHAR *)::C.11, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc115(NPCHAR *)::C.12, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->xm = 0;
      npc->act_no = 1;
      npc->act_wait = 0;
      npc->count1 = 0;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( x < npc->x + 49152 && x > npc->x - 49152 && y < npc->y + 0x4000 && y > npc->y - 49152 )
        npc->act_no = 10;
      if ( npc->shock )
        npc->act_no = 10;
      break;
    case 0xA:
      if ( x >= npc->x )
        npc->direct = 2;
      else
        npc->direct = 0;
      npc->ani_no = 1;
      if ( ++npc->act_wait > 20 )
      {
        npc->act_wait = 0;
        npc->act_no = 20;
      }
      break;
    case 0x14:
      npc->damage = 0;
      npc->xm = 0;
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 2 )
      {
        if ( npc->x <= x )
          npc->direct = 2;
        else
          npc->direct = 0;
        if ( npc->direct )
          npc->xm = 512;
        else
          npc->xm = -512;
        if ( ++npc->count1 <= 2 )
        {
          npc->act_no = 21;
          npc->ym = -1024;
          PlaySoundObject(30, 1);
        }
        else
        {
          npc->count1 = 0;
          npc->ani_no = 4;
          npc->act_no = 21;
          npc->ym = -1024;
          npc->xm *= 2;
          npc->damage = 5;
          PlaySoundObject(102, 1);
        }
      }
      break;
    case 0x15:
      if ( npc->flag & 8 )
      {
        PlaySoundObject(23, 1);
        npc->act_no = 20;
        npc->ani_no = 1;
        npc->ani_wait = 0;
        npc->damage = 0;
        if ( x > npc->x + 73728 || x < npc->x - 73728 || y > npc->y + 24576 || y < npc->y - 73728 )
          npc->act_no = 0;
      }
      break;
    case 0x1E:
      for ( i = 0; i <= 7; ++i )
      {
        v1 = Random(-1536, 0);
        v2 = Random(-341, 341);
        v3 = npc->y;
        v4 = (Random(-12, 12) << 9) + v3;
        v5 = npc->x;
        v6 = Random(-12, 12);
        SetNpChar(4, v5 + (v6 << 9), v4, v2, v1, 0, 0, 256);
      }
      npc->ani_no = 0;
      npc->act_no = 0;
      break;
    case 0x32:
      npc->act_no = 51;
      npc->ani_no = 4;
      npc->damage = 0;
      npc->ym = -512;
      npc->bits &= 0xFFDEu;
      PlaySoundObject(51, 1);
      goto LABEL_38;
    case 0x33:
LABEL_38:
      if ( npc->flag & 8 )
      {
        PlaySoundObject(23, 1);
        npc->act_no = 52;
        npc->ani_no = 5;
        npc->xm = 0;
      }
      break;
    default:
      break;
  }
  if ( npc->act_no <= 50 )
    v7 = npc->ym + 64;
  else
    v7 = npc->ym + 32;
  npc->ym = v7;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v8 = npc;
    v9 = (Sint32 *)&v13[16 * npc->ani_no - 196];
  }
  else
  {
    v8 = npc;
    v9 = (Sint32 *)&v13[16 * npc->ani_no - 100];
  }
  npc->rect.left = *v9;
  v8->rect.top = v9[1];
  v8->rect.right = v9[2];
  v8->rect.bottom = v9[3];
}


//----- (0806DEF0) --------------------------------------------------------
void __cdecl ActNpc116(NPCHAR_0 *npc)
{
  npc->rect.left = 272;
  npc->rect.top = 184;
  npc->rect.right = 320;
  npc->rect.bottom = 200;
}

//----- (0806DF2F) --------------------------------------------------------
void __cdecl ActNpc117(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  bool v4;
  int v5;
  NPCHAR_0 *v6;
  Sint32 *v7;
  RECT rcRight[10];
  RECT rcLeft[10];
  char v10[24];

  qmemcpy(rcLeft, &ActNpc117(NPCHAR *)::C.13, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc117(NPCHAR *)::C.14, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      if ( npc->direct == 4 )
      {
        if ( npc->x <= x )
          npc->direct = 2;
        else
          npc->direct = 0;
      }
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      goto LABEL_7;
    case 1:
LABEL_7:
      npc->xm = 0;
      npc->ym += 64;
      if ( npc->x - 0x4000 < x && npc->x + 0x4000 > x )
        v1 = npc->y - 0x4000;
      break;
    case 3:
      npc->act_no = 4;
      npc->ani_no = 1;
      npc->ani_wait = 0;
      goto LABEL_11;
    case 4:
LABEL_11:
      if ( ++npc->ani_wait > 4 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 4 )
        npc->ani_no = 1;
      npc->ym += 64;
      if ( npc->direct )
        npc->xm = 512;
      else
        npc->xm = -512;
      break;
    case 5:
      npc->act_no = 6;
      npc->ani_no = 5;
      SetDestroyNpChar(npc->x, npc->y, npc->view.back, 8);
      break;
    case 6:
      npc->ani_no = 5;
      break;
    case 0xA:
      npc->act_no = 11;
      npc->ani_no = 1;
      npc->ani_wait = 0;
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
      goto LABEL_23;
    case 0xB:
LABEL_23:
      if ( ++npc->ani_wait > 4 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 4 )
        npc->ani_no = 1;
      if ( npc->direct )
        v2 = npc->x + 512;
      else
        v2 = npc->x - 512;
      npc->x = v2;
      if ( x < npc->x + 10240 && x > npc->x - 10240 )
        npc->act_no = 0;
      break;
    case 0x14:
      npc->xm = 0;
      npc->ani_no = 6;
      break;
    case 0x15:
      npc->xm = 0;
      npc->ani_no = 9;
      break;
    case 0x1E:
      npc->act_no = 31;
      npc->act_wait = 0;
      npc->ym = -1024;
      goto LABEL_36;
    case 0x1F:
LABEL_36:
      npc->ani_no = 7;
      if ( npc->direct )
        npc->xm = -512;
      else
        npc->xm = 512;
      npc->ym += 64;
      v3 = npc->act_wait;
      npc->act_wait = v3 + 1;
      v4 = v3 != 0 && npc->flag & 8;
      if ( v4 )
        npc->act_no = 32;
      break;
    case 0x20:
      npc->ym += 64;
      npc->ani_no = 8;
      npc->xm = 0;
      break;
    case 0x46:
      npc->act_no = 71;
      npc->act_wait = 0;
      npc->ani_no = 1;
      npc->ani_wait = 0;
      goto LABEL_47;
    case 0x47:
LABEL_47:
      if ( npc->direct )
        v5 = npc->x - 256;
      else
        v5 = npc->x + 256;
      npc->x = v5;
      if ( ++npc->ani_wait > 8 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 4 )
        npc->ani_no = 1;
      break;
    default:
      break;
  }
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v6 = npc;
    v7 = (Sint32 *)&v10[16 * npc->ani_no - 320];
  }
  else
  {
    v6 = npc;
    v7 = (Sint32 *)&v10[16 * npc->ani_no - 160];
  }
  npc->rect.left = *v7;
  v6->rect.top = v7[1];
  v6->rect.right = v7[2];
  v6->rect.bottom = v7[3];
}


//----- (0806E47E) --------------------------------------------------------
void __cdecl ActNpc118(NPCHAR_0 *npc)
{
  int v1;
  bool v2;
  NPCHAR_0 *v3;
  Sint32 *v4;
  RECT rcRight[9];
  RECT rcLeft[9];
  bool bUpper;
  char v8[24];

  qmemcpy(rcLeft, &ActNpc118(NPCHAR *)::C.17, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc118(NPCHAR *)::C.18, sizeof(rcRight));
  bUpper = 0;
  if ( !npc->direct && npc->x < x )
    bUpper = 1;
  if ( npc->direct == 2 && npc->x > x )
    bUpper = 1;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      break;
    case 0xA:
      npc->act_no = 11;
      npc->act_wait = Random(50, 100);
      npc->ani_no = 0;
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
      npc->bits |= 0x20u;
      npc->bits &= 0xFFFBu;
      goto LABEL_13;
    case 0xB:
LABEL_13:
      if ( npc->act_wait )
        --npc->act_wait;
      else
        npc->act_no = 13;
      break;
    case 0xD:
      npc->act_no = 14;
      npc->ani_no = 3;
      npc->act_wait = Random(50, 100);
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
      goto LABEL_19;
    case 0xE:
LABEL_19:
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 6 )
        npc->ani_no = 3;
      if ( npc->direct )
        v1 = npc->xm + 64;
      else
        v1 = npc->xm - 64;
      npc->xm = v1;
      if ( npc->act_wait )
      {
        --npc->act_wait;
      }
      else
      {
        npc->bits |= 0x20u;
        npc->act_no = 20;
        npc->act_wait = 0;
        PlaySoundObject(103, 1);
      }
      break;
    case 0x14:
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
      npc->xm = 8 * npc->xm / 9;
      if ( ++npc->ani_no > 1 )
        npc->ani_no = 0;
      if ( ++npc->act_wait > 50 )
      {
        npc->act_no = 21;
        npc->act_wait = 0;
      }
      break;
    case 0x15:
      if ( ++npc->act_wait % 4 == 1 )
      {
        if ( npc->direct )
        {
          if ( bUpper )
          {
            npc->ani_no = 2;
            SetNpChar(123, npc->x, npc->y - 4096, 0, 0, 1, 0, 256);
          }
          else
          {
            npc->ani_no = 0;
            SetNpChar(123, npc->x + 4096, npc->y + 2048, 0, 0, 2, 0, 256);
            npc->x -= 512;
          }
        }
        else if ( bUpper )
        {
          npc->ani_no = 2;
          SetNpChar(123, npc->x, npc->y - 4096, 0, 0, 1, 0, 256);
        }
        else
        {
          npc->ani_no = 0;
          SetNpChar(123, npc->x - 4096, npc->y + 2048, 0, 0, 0, 0, 256);
          npc->x += 512;
        }
      }
      if ( npc->act_wait > 30 )
        npc->act_no = 10;
      break;
    case 0x1E:
      if ( ++npc->ani_no > 8 )
        npc->ani_no = 7;
      if ( ++npc->act_wait > 30 )
      {
        npc->act_no = 10;
        npc->ani_no = 0;
      }
      break;
    default:
      break;
  }
  v2 = npc->act_no > 10 && npc->act_no <= 29 && CountArmsBullet(6);
  if ( v2 )
  {
    npc->act_wait = 0;
    npc->act_no = 30;
    npc->ani_no = 7;
    npc->bits &= 0xFFDFu;
    npc->bits |= 4u;
    npc->xm = 0;
  }
  npc->ym += 32;
  if ( npc->xm > 511 )
    npc->xm = 511;
  if ( npc->xm < -511 )
    npc->xm = -511;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->y += npc->ym;
  npc->x += npc->xm;
  if ( npc->direct )
  {
    v3 = npc;
    v4 = (Sint32 *)&v8[16 * npc->ani_no - 292];
  }
  else
  {
    v3 = npc;
    v4 = (Sint32 *)&v8[16 * npc->ani_no - 148];
  }
  npc->rect.left = *v4;
  v3->rect.top = v4[1];
  v3->rect.right = v4[2];
  v3->rect.bottom = v4[3];
}


//----- (0806EB67) --------------------------------------------------------
void __cdecl ActNpc119(NPCHAR_0 *npc)
{
  npc->rect.left = 248;
  npc->rect.top = 184;
  npc->rect.right = 272;
  npc->rect.bottom = 200;
}

//----- (0806EBA8) --------------------------------------------------------
void ClearPermitStage()
{
  memset(gPermitStage, 0, 0x40u);
}

//----- (0806EBCC) --------------------------------------------------------
signed int __cdecl AddPermitStage(int index, int event)
{
  int i;

  for ( i = 0; i <= 7 && gPermitStage[i].index != index && gPermitStage[i].index; ++i )
    ;
  if ( i == 8 )
    return 0;
  gPermitStage[i].index = index;
  gPermitStage[i].event = event;
  return 1;
}

//----- (0806EC3B) --------------------------------------------------------
signed int __cdecl SubPermitStage(int index)
{
  int v2;
  int v3;
  int i;
  int ia;

  for ( i = 0; i <= 7 && gPermitStage[i].index != index; ++i )
    ;
  if ( i == 32 )
    return 0;
  for ( ia = i + 1; ia <= 7; ++ia )
  {
    v2 = ia - 1;
    v3 = gPermitStage[ia].event;
    gPermitStage[v2].index = gPermitStage[ia].index;
    gPermitStage[v2].event = v3;
  }
  gPermitStage[ia - 1].index = 0;
  gPermitStage[ia - 1].event = 0;
  return 1;
}

//----- (0806ECDB) --------------------------------------------------------
void MoveStageSelectCursor()
{
  int stage_num;

  for ( stage_num = 0; gPermitStage[stage_num].index != 0; ++stage_num )
    ;
  if ( stage_num )
  {
    if ( gKeyTrg & gKeyLeft )
      --gSelectedStage;
    if ( gKeyTrg & gKeyRight )
      ++gSelectedStage;
    if ( gSelectedStage < 0 )
      gSelectedStage = stage_num - 1;
    if ( stage_num - 1 < gSelectedStage )
      gSelectedStage = 0;
    if ( (gKeyRight | gKeyLeft) & gKeyTrg )
      StartTextScript(gPermitStage[gSelectedStage].index + 1000);
    if ( (gKeyRight | gKeyLeft) & gKeyTrg )
      PlaySoundObject(1, 1);
  }
}

//----- (0806EDEE) --------------------------------------------------------
void PutStageSelectObject()
{
  RECT rcCur[2];
  RECT rcTitle1;
  RECT rcView;
  RECT rcStage;
  int i;
  int stage_num;
  int stage_x;

  rcView.left = 0;
  rcView.top = 0;
  rcView.right = 320;
  rcView.bottom = 240;
  rcCur[0].left = 80;
  rcCur[0].top = 88;
  rcCur[0].right = 112;
  rcCur[0].bottom = 104;
  rcCur[1].left = 80;
  rcCur[1].top = 104;
  rcCur[1].right = 112;
  rcCur[1].bottom = 120;
  rcTitle1.left = 80;
  rcTitle1.top = 64;
  rcTitle1.right = 144;
  rcTitle1.bottom = 72;
  if ( gStageSelectTitleY > 46 )
    --gStageSelectTitleY;
  PutBitmap3(&rcView, 128, gStageSelectTitleY, &rcTitle1, 26);
  for ( stage_num = 0; gPermitStage[stage_num].index != 0; ++stage_num )
    ;
  ++PutStageSelectObject(void)::flash;
  if ( stage_num )
  {
    stage_x = (-40 * stage_num + 320) / 2;
    PutBitmap3(&rcView, stage_x + 40 * gSelectedStage, 64, &rcCur[(PutStageSelectObject(void)::flash >> 1) & 1], 26);
    for ( i = 0; i <= 7 && gPermitStage[i].index; ++i )
    {
      rcStage.left = 32 * (gPermitStage[i].index % 8);
      rcStage.right = rcStage.left + 32;
      rcStage.top = 16 * (gPermitStage[i].index / 8);
      rcStage.bottom = rcStage.top + 16;
      PutBitmap3(&rcView, stage_x + 40 * i, 64, &rcStage, 14);
    }
  }
}

//----- (0806EFFE) --------------------------------------------------------
signed int __cdecl StageSelectLoop(int *p_event)
{
  signed int v1;
  signed int v3;
  char old_script_path[260];
  RECT rcView;

  rcView.left = 0;
  rcView.top = 0;
  rcView.right = 320;
  rcView.bottom = 240;
  gSelectedStage = 0;
  BackupSurface(10, &grcFull);
  GetTextScriptPath(old_script_path);
  LoadTextScript2("StageSelect.tsc");
  gStageSelectTitleY = 54;
  StartTextScript(gPermitStage[gSelectedStage].index + 1000);
  do
  {
    GetTrg();
    if ( gKey & 0x8000 )
    {
      v1 = Call_Escape(gscreen);
      if ( !v1 )
        return 0;
      if ( v1 == 2 )
        return 2;
    }
    MoveStageSelectCursor();
    v3 = TextScriptProc();
    if ( !v3 )
      return 0;
    if ( v3 == 2 )
      return 2;
    PutBitmap3(&rcView, 0, 0, &rcView, 10);
    PutStageSelectObject();
    PutTextScript();
    if ( gKeyTrg & gKeyOk )
    {
      StopTextScript();
      LoadTextScript_Stage(old_script_path);
      *p_event = gPermitStage[gSelectedStage].event;
      return 1;
    }
    if ( gKeyTrg & gKeyCancel )
    {
      StopTextScript();
      LoadTextScript_Stage(old_script_path);
      *p_event = 0;
      return 1;
    }
    PutFramePerSecound();
  }
  while ( Flip_SystemTask(gscreen) );
  return 0;
}

//----- (0806F1B4) --------------------------------------------------------
void initWaveTables()
{
  float v0;
  int i;
  int ia;
  int ib;
  int ic;
  int id;
  int ie;
  int ig;
  int ih;

  for ( i = 0; i <= 255; ++i )
  {
    v0 = (long double)i * 6.283185307179586 / 256.0;
    waveModelTable[i] = (signed __int16)(sinf(v0) * 64.0);
  }
  for ( ia = 0; ia <= 63; ++ia )
    *(_BYTE *)(ia + 136088736) = (ia << 8) / 256;
  for ( ib = 0; ib <= 127; ++ib )
    *(_BYTE *)(ib + 136088800) = 64 - (ib << 8) / 256;
  for ( ic = 0; ic <= 63; ++ic )
    *(_BYTE *)(ic + 136088928) = (ic << 8) / 256 - 64;
  for ( id = 0; id <= 255; ++id )
    *(_BYTE *)(id + 136088992) = (id << 7) / 256 - 64;
  for ( ie = 0; ie <= 255; ++ie )
    *(_BYTE *)(ie + 136089248) = 64 - (ie << 7) / 256;
  for ( ig = 0; ig <= 127; ++ig )
    *(_BYTE *)(ig + 136089504) = 64;
  while ( ig <= 255 )
    *(_BYTE *)(ig++ + 136089504) = -64;
  srand(0);
  for ( ih = 0; ih <= 255; ++ih )
    *(_BYTE *)(ih + 136089760) = (char)rand() / 2;
}

//----- (0806F3DB) --------------------------------------------------------
void __cdecl makePTWave(Uint8 **buf, $296577AB1FDEBC0CA4D43AF2DF231431 *param)
{
  long double v2;
  Sint8 envelopeTable[256];
  int i;
  float e;
  int iMain;
  int iPitch;
  int iVolume;
  int iEnvelope;
  float fPitch;
  float fMain;
  float fVolume;
  float fPitchPlus;
  float fMainPlus;
  float fVolumePlus;

  memset(envelopeTable, 0, 0x100u);
  i = 0;
  e = (long double)param->initial;
  while ( param->pointAx > i )
  {
    envelopeTable[i] = (signed __int16)e;
    e = ((long double)param->pointAy - (long double)param->initial) / (long double)param->pointAx + e;
    ++i;
  }
  e = (long double)param->pointAy;
  while ( param->pointBx > i )
  {
    envelopeTable[i] = (signed __int16)e;
    e = ((long double)param->pointBy - (long double)param->pointAy) / (long double)(param->pointBx - param->pointAx) + e;
    ++i;
  }
  e = (long double)param->pointBy;
  while ( param->pointCx > i )
  {
    envelopeTable[i] = (signed __int16)e;
    e = ((long double)param->pointCy - (long double)param->pointBy) / (long double)(param->pointCx - param->pointBx) + e;
    ++i;
  }
  e = (long double)param->pointCy;
  while ( i <= 255 )
  {
    envelopeTable[i] = (signed __int16)e;
    e = e - (long double)param->pointCy / (long double)(256 - param->pointCx);
    ++i;
  }
  fPitch = (long double)param->oPitch.offset;
  fVolume = (long double)param->oVolume.offset;
  fMain = (long double)param->oVolume.offset;
  if ( param->oMain.num == 0.0 )
    fMainPlus = 0.0;
  else
    fMainPlus = 256.0 / ((long double)param->size / param->oMain.num);
  if ( param->oVolume.num == 0.0 )
    fVolumePlus = 0.0;
  else
    fVolumePlus = 256.0 / ((long double)param->size / param->oVolume.num);
  if ( param->oPitch.num == 0.0 )
    fPitchPlus = 0.0;
  else
    fPitchPlus = 256.0 / ((long double)param->size / param->oPitch.num);
  *buf = (Uint8 *)malloc(param->size);
  for ( i = 0; param->size > i; ++i )
  {
    iMain = (unsigned __int8)(((unsigned __int64)(signed int)fMain >> 56) + (signed int)fMain)
          - ((unsigned int)((signed int)fMain >> 31) >> 24);
    iVolume = (unsigned __int8)(((unsigned __int64)(signed int)fVolume >> 56) + (signed int)fVolume)
            - ((unsigned int)((signed int)fVolume >> 31) >> 24);
    iPitch = (unsigned __int8)(((unsigned __int64)(signed int)fPitch >> 56) + (signed int)fPitch)
           - ((unsigned int)((signed int)fPitch >> 31) >> 24);
    iEnvelope = (signed int)((long double)(i << 8) / (long double)param->size);
    (*buf)[i] = waveModelTable[256 * param->oMain.model + iMain]
              * param->oMain.top
              / 64
              * (waveModelTable[256 * param->oVolume.model + iVolume] * param->oVolume.top / 64 + 64)
              / 64
              * envelopeTable[iEnvelope]
              / 64
              + -128;
    if ( *(_BYTE *)((param->oPitch.model << 8) + iPitch + 136088480) >= 0 )
      v2 = (fMainPlus + fMainPlus)
         * (long double)*(char *)((param->oPitch.model << 8) + iPitch + 136088480)
         * (long double)param->oPitch.top
         / 64.0
         / 64.0
         + fMainPlus
         + fMain;
    else
      v2 = fMainPlus
         * 0.5
         * (long double)-*(char *)((param->oPitch.model << 8) + iPitch + 136088480)
         * (long double)param->oPitch.top
         / 64.0
         / -64.0
         + fMainPlus
         + fMain;
    fMain = v2;
    fPitch = fPitch + fPitchPlus;
    fVolume = fVolume + fVolumePlus;
  }
}

//----- (0806FA8C) --------------------------------------------------------
void __cdecl mixPTWaves(Uint8 **buf, $296577AB1FDEBC0CA4D43AF2DF231431 *param, int count)
{
  Uint8 *waveptr;
  Sint16 *mixbuf;
  int i;
  int j;
  int max_size;

  max_size = 0;
  for ( i = 0; i < count; ++i )
  {
    if ( param[i].size > max_size )
      max_size = param[i].size;
  }
  mixbuf = (Sint16 *)malloc(2 * max_size);
  *buf = (Uint8 *)malloc(max_size);
  for ( j = 0; j < max_size; ++j )
    mixbuf[j] = 128;
  for ( i = 0; i < count; ++i )
  {
    makePTWave(&waveptr, &param[i]);
    for ( j = 0; param[i].size > j; ++j )
      mixbuf[j] = mixbuf[j] + waveptr[j] - 128;
    free(waveptr);
  }
  for ( j = 0; j < max_size; ++j )
  {
    if ( mixbuf[j] <= 255 )
    {
      if ( mixbuf[j] >= 0 )
        (*buf)[j] = mixbuf[j];
      else
        (*buf)[j] = 0;
    }
    else
    {
      (*buf)[j] = -1;
    }
  }
  free(mixbuf);
}

//----- (0806FC34) --------------------------------------------------------
signed int LoadGenericData()
{
  char str[64];
  int pt_size;
  bool bError;

  MakeSurface_Resource("pixel", 1);
  bError = 0;
  if ( !MakeSurface_File("MyChar", 16) )
    bError = 1;
  if ( !MakeSurface_File("Title", 0) )
    bError = 1;
  if ( !MakeSurface_File("ArmsImage", 12) )
    bError = 1;
  if ( !MakeSurface_File("Arms", 11) )
    bError = 1;
  if ( !MakeSurface_File("ItemImage", 8) )
    bError = 1;
  if ( !MakeSurface_File("StageImage", 14) )
    bError = 1;
  if ( !MakeSurface_File("Npc/NpcSym", 20) )
    bError = 1;
  if ( !MakeSurface_File("Npc/NpcRegu", 23) )
    bError = 1;
  if ( !MakeSurface_File("TextBox", 26) )
    bError = 1;
  if ( !MakeSurface_File("Caret", 19) )
    bError = 1;
  if ( !MakeSurface_File("Bullet", 17) )
    bError = 1;
  if ( !MakeSurface_File("Face", 27) )
    bError = 1;
  if ( !MakeSurface_File("Fade", 6) )
    bError = 1;
  MakeSurface_Resource("Credit01", 36);
  if ( bError )
    return 0;
  MakeSurface_Generic(320, 240, 10);
  MakeSurface_Generic(320, 240, 28);
  MakeSurface_Generic(320, 240, 9);
  MakeSurface_Generic(320, 240, 37);
  MakeSurface_Generic(256, 256, 2);
  MakeSurface_Generic(160, 16, 13);
  MakeSurface_Generic(40, 240, 29);
  MakeSurface_Generic(320, 240, 21);
  MakeSurface_Generic(320, 240, 22);
  MakeSurface_Generic(320, 240, 35);
  pt_size = MakePixToneObject(gPtpTable, 2, 32);
  pt_size += MakePixToneObject(&ptp, 2, 33);
  pt_size += MakePixToneObject(&stru_81BE310, 2, 34);
  pt_size += MakePixToneObject(&stru_81BE3B8, 1, 15);
  pt_size += MakePixToneObject(&stru_81BE40C, 1, 24);
  pt_size += MakePixToneObject(&stru_81BE460, 1, 23);
  pt_size += MakePixToneObject(&stru_81BE4B4, 2, 50);
  pt_size += MakePixToneObject(&stru_81BE55C, 2, 51);
  pt_size += MakePixToneObject(&stru_81BEC94, 1, 1);
  pt_size += MakePixToneObject(&stru_81BEE38, 1, 2);
  pt_size += MakePixToneObject(&stru_81BF420, 1, 29);
  pt_size += MakePixToneObject(&stru_81BF5C4, 1, 43);
  pt_size += MakePixToneObject(&stru_81BF618, 3, 44);
  pt_size += MakePixToneObject(&stru_81BF714, 1, 45);
  pt_size += MakePixToneObject(&stru_81BF768, 1, 46);
  pt_size += MakePixToneObject(&stru_81BF810, 1, 47);
  pt_size += MakePixToneObject(&stru_81BF1D4, 3, 35);
  pt_size += MakePixToneObject(&stru_81BF2D0, 3, 39);
  pt_size += MakePixToneObject(&stru_81BE604, 2, 52);
  pt_size += MakePixToneObject(&stru_81BEAF0, 2, 53);
  pt_size += MakePixToneObject(&stru_81BE6AC, 2, 70);
  pt_size += MakePixToneObject(&stru_81BE754, 2, 71);
  pt_size += MakePixToneObject(&stru_81BE7FC, 2, 72);
  pt_size += MakePixToneObject(&stru_81BEB98, 1, 5);
  pt_size += MakePixToneObject(&stru_81BEC40, 1, 11);
  pt_size += MakePixToneObject(&stru_81BED3C, 1, 4);
  pt_size += MakePixToneObject(&stru_81BF0D8, 2, 25);
  pt_size += MakePixToneObject(&stru_81BF180, 1, 27);
  pt_size += MakePixToneObject(&stru_81BF378, 2, 28);
  pt_size += MakePixToneObject(&stru_81BEE8C, 1, 14);
  pt_size += MakePixToneObject(&stru_81BE94C, 2, 16);
  pt_size += MakePixToneObject(&stru_81BE9F4, 3, 17);
  pt_size += MakePixToneObject(&stru_81BECE8, 1, 18);
  pt_size += MakePixToneObject(&stru_81BED90, 2, 20);
  pt_size += MakePixToneObject(&stru_81BEBEC, 1, 22);
  pt_size += MakePixToneObject(&stru_81BEF34, 2, 26);
  pt_size += MakePixToneObject(&stru_81BEFDC, 1, 21);
  pt_size += MakePixToneObject(&stru_81BF030, 2, 12);
  pt_size += MakePixToneObject(&stru_81BF474, 2, 38);
  pt_size += MakePixToneObject(&stru_81BF51C, 1, 31);
  pt_size += MakePixToneObject(&stru_81BF570, 1, 42);
  pt_size += MakePixToneObject(&stru_81BF864, 1, 48);
  pt_size += MakePixToneObject(&stru_81BF8B8, 2, 49);
  pt_size += MakePixToneObject(&stru_81BF960, 1, 100);
  pt_size += MakePixToneObject(&stru_81BF9B4, 3, 101);
  pt_size += MakePixToneObject(&stru_81BFAB0, 2, 54);
  pt_size += MakePixToneObject(&stru_81BFB58, 2, 102);
  pt_size += MakePixToneObject(&stru_81BFC00, 2, 103);
  pt_size += MakePixToneObject(&stru_81BFC54, 1, 104);
  pt_size += MakePixToneObject(&stru_81BFCA8, 1, 105);
  pt_size += MakePixToneObject(&stru_81BFCFC, 2, 106);
  pt_size += MakePixToneObject(&stru_81BFDA4, 1, 107);
  pt_size += MakePixToneObject(&stru_81BFDF8, 1, 30);
  pt_size += MakePixToneObject(&stru_81BFE4C, 1, 108);
  pt_size += MakePixToneObject(&stru_81BFEA0, 1, 109);
  pt_size += MakePixToneObject(&stru_81BFEF4, 1, 110);
  pt_size += MakePixToneObject(&stru_81BFF48, 1, 111);
  pt_size += MakePixToneObject(&stru_81BFF9C, 1, 112);
  pt_size += MakePixToneObject(&stru_81BFFF0, 1, 113);
  pt_size += MakePixToneObject(&stru_81C0044, 2, 114);
  pt_size += MakePixToneObject(&stru_81C00EC, 2, 150);
  pt_size += MakePixToneObject(&stru_81C0194, 2, 151);
  pt_size += MakePixToneObject(&stru_81C023C, 1, 152);
  pt_size += MakePixToneObject(&stru_81C0290, 1, 153);
  pt_size += MakePixToneObject(&stru_81C02E4, 2, 154);
  pt_size += MakePixToneObject(&stru_81C062C, 2, 155);
  pt_size += MakePixToneObject(&stru_81C038C, 2, 56);
  pt_size += MakePixToneObject(&stru_81C0434, 2, 40);
  pt_size += MakePixToneObject(&stru_81C0434, 2, 41);
  pt_size += MakePixToneObject(&stru_81C04DC, 2, 37);
  pt_size += MakePixToneObject(&stru_81C0584, 2, 57);
  pt_size += MakePixToneObject(&stru_81C06D4, 3, 115);
  pt_size += MakePixToneObject(&stru_81C07D0, 1, 104);
  pt_size += MakePixToneObject(&stru_81C0824, 3, 116);
  pt_size += MakePixToneObject(&stru_81C0920, 2, 58);
  pt_size += MakePixToneObject(&stru_81C09C8, 2, 55);
  pt_size += MakePixToneObject(&stru_81C0A70, 2, 117);
  pt_size += MakePixToneObject(&stru_81C0B18, 1, 59);
  pt_size += MakePixToneObject(&stru_81C0B6C, 1, 60);
  pt_size += MakePixToneObject(&stru_81C0BC0, 1, 61);
  pt_size += MakePixToneObject(&stru_81C0C14, 2, 62);
  pt_size += MakePixToneObject(&stru_81C0CBC, 2, 63);
  pt_size += MakePixToneObject(&stru_81C0D64, 2, 64);
  pt_size += MakePixToneObject(&stru_81C0E0C, 1, 65);
  pt_size += MakePixToneObject(&stru_81C0E60, 1, 3);
  pt_size += MakePixToneObject(&stru_81C0EB4, 1, 6);
  pt_size += MakePixToneObject(&stru_81C0F08, 1, 7);
  sprintf(str, "PixTone = %ld byte", pt_size, 0);
  return 1;
}

//----- (08070A24) --------------------------------------------------------
void __cdecl ActNpc220(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[2];
  RECT rcLeft[2];
  char v6[8];

  rcLeft[0].left = 0;
  rcLeft[0].top = 64;
  rcLeft[0].right = 16;
  rcLeft[0].bottom = 80;
  rcLeft[1].left = 16;
  rcLeft[1].top = 64;
  rcLeft[1].right = 32;
  rcLeft[1].bottom = 80;
  rcRight[0].left = 0;
  rcRight[0].top = 80;
  rcRight[0].right = 16;
  rcRight[0].bottom = 96;
  rcRight[1].left = 16;
  rcRight[1].top = 80;
  rcRight[1].right = 32;
  rcRight[1].bottom = 96;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    if ( Random(0, 120) == 10 )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
      npc->ani_no = 1;
    }
    goto LABEL_9;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_9;
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->ani_wait = 0;
    goto LABEL_5;
  }
  if ( ++npc->act_wait > 8 )
  {
    npc->act_no = 1;
    npc->ani_no = 0;
  }
LABEL_9:
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 64];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 32];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (08070BA5) --------------------------------------------------------
void __cdecl ActNpc221(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  Sint32 *v2;
  RECT rcRight[6];
  RECT rcLeft[6];
  char v5[24];

  qmemcpy(rcLeft, &ActNpc221(NPCHAR *)::C.1, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc221(NPCHAR *)::C.2, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      npc->xm = 0;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( Random(0, 60) == 1 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      if ( Random(0, 60) == 1 )
      {
        npc->act_no = 10;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      break;
    case 2:
      if ( ++npc->act_wait > 8 )
      {
        npc->act_no = 1;
        npc->ani_no = 0;
      }
      break;
    case 0xA:
      npc->act_no = 11;
      npc->act_wait = Random(0, 16);
      npc->ani_no = 2;
      npc->ani_wait = 0;
      if ( Random(0, 9) & 1 )
        npc->direct = 0;
      else
        npc->direct = 2;
      goto LABEL_12;
    case 0xB:
LABEL_12:
      if ( npc->direct || !(npc->flag & 1) )
      {
        if ( npc->direct == 2 && npc->flag & 4 )
          npc->direct = 0;
      }
      else
      {
        npc->direct = 2;
      }
      if ( npc->direct )
        npc->xm = 512;
      else
        npc->xm = -512;
      if ( ++npc->ani_wait > 4 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 5 )
        npc->ani_no = 2;
      if ( ++npc->act_wait > 32 )
        npc->act_no = 0;
      break;
    default:
      break;
  }
  npc->ym += 32;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v1 = npc;
    v2 = (Sint32 *)&v5[16 * npc->ani_no - 192];
  }
  else
  {
    v1 = npc;
    v2 = (Sint32 *)&v5[16 * npc->ani_no - 96];
  }
  npc->rect.left = *v2;
  v1->rect.top = v2[1];
  v1->rect.right = v2[2];
  v1->rect.bottom = v2[3];
}


//----- (08070ED6) --------------------------------------------------------
void __cdecl ActNpc222(NPCHAR_0 *npc)
{
  if ( !npc->act_no )
  {
    ++npc->act_no;
    npc->y -= 4096;
  }
  npc->rect.left = 96;
  npc->rect.top = 168;
  npc->rect.right = 112;
  npc->rect.bottom = 200;
}

//----- (08070F40) --------------------------------------------------------
void __cdecl ActNpc223(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[3];
  RECT rcLeft[3];
  char v6[8];

  rcLeft[0].left = 80;
  rcLeft[0].top = 192;
  rcLeft[0].right = 96;
  rcLeft[0].bottom = 216;
  rcLeft[1].left = 96;
  rcLeft[1].top = 192;
  rcLeft[1].right = 112;
  rcLeft[1].bottom = 216;
  rcLeft[2].left = 112;
  rcLeft[2].top = 192;
  rcLeft[2].right = 128;
  rcLeft[2].bottom = 216;
  rcRight[0].left = 80;
  rcRight[0].top = 216;
  rcRight[0].right = 96;
  rcRight[0].bottom = 240;
  rcRight[1].left = 96;
  rcRight[1].top = 216;
  rcRight[1].right = 112;
  rcRight[1].bottom = 240;
  rcRight[2].left = 112;
  rcRight[2].top = 216;
  rcRight[2].right = 128;
  rcRight[2].bottom = 240;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_9:
    if ( Random(0, 160) == 1 )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
      npc->ani_no = 1;
    }
    goto LABEL_14;
  }
  if ( v1 <= 1 )
  {
    if ( v1 )
      goto LABEL_14;
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->ani_wait = 0;
    goto LABEL_9;
  }
  if ( v1 == 2 )
  {
    if ( ++npc->act_wait > 12 )
    {
      npc->act_no = 1;
      npc->ani_no = 0;
    }
  }
  else if ( v1 == 3 )
  {
    npc->ani_no = 2;
  }
LABEL_14:
  if ( npc->act_no <= 1 && y < npc->y + 0x2000 && y > npc->y - 0x2000 )
  {
    if ( x >= npc->x )
      npc->direct = 2;
    else
      npc->direct = 0;
  }
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 96];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 48];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (08071177) --------------------------------------------------------
void __cdecl ActNpc224(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[2];
  RECT rcLeft[2];
  char v6[8];

  rcLeft[0].left = 112;
  rcLeft[0].top = 32;
  rcLeft[0].right = 128;
  rcLeft[0].bottom = 48;
  rcLeft[1].left = 128;
  rcLeft[1].top = 32;
  rcLeft[1].right = 144;
  rcLeft[1].bottom = 48;
  rcRight[0].left = 112;
  rcRight[0].top = 48;
  rcRight[0].right = 128;
  rcRight[0].bottom = 64;
  rcRight[1].left = 128;
  rcRight[1].top = 48;
  rcRight[1].right = 144;
  rcRight[1].bottom = 64;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    if ( Random(0, 160) == 1 )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
      npc->ani_no = 1;
    }
    goto LABEL_9;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_9;
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->ani_wait = 0;
    goto LABEL_5;
  }
  if ( ++npc->act_wait > 12 )
  {
    npc->act_no = 1;
    npc->ani_no = 0;
  }
LABEL_9:
  if ( npc->act_no <= 1 && y < npc->y + 0x2000 && y > npc->y - 0x2000 )
  {
    if ( x >= npc->x )
      npc->direct = 2;
    else
      npc->direct = 0;
  }
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 64];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 32];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (08071353) --------------------------------------------------------
void __cdecl ActNpc225(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[2];
  RECT rcLeft[2];
  char v6[8];

  rcLeft[0].left = 64;
  rcLeft[0].top = 64;
  rcLeft[0].right = 80;
  rcLeft[0].bottom = 80;
  rcLeft[1].left = 80;
  rcLeft[1].top = 64;
  rcLeft[1].right = 96;
  rcLeft[1].bottom = 80;
  rcRight[0].left = 64;
  rcRight[0].top = 80;
  rcRight[0].right = 80;
  rcRight[0].bottom = 96;
  rcRight[1].left = 80;
  rcRight[1].top = 80;
  rcRight[1].right = 96;
  rcRight[1].bottom = 96;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    if ( Random(0, 160) == 1 )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
      npc->ani_no = 1;
    }
    goto LABEL_9;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_9;
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->ani_wait = 0;
    goto LABEL_5;
  }
  if ( ++npc->act_wait > 12 )
  {
    npc->act_no = 1;
    npc->ani_no = 0;
  }
LABEL_9:
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 64];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 32];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (080714D4) --------------------------------------------------------
void __cdecl ActNpc226(NPCHAR_0 *npc)
{
  Sint32 *v1;
  RECT rcRight[7];
  char v3[24];

  qmemcpy(rcRight, &ActNpc226(NPCHAR *)::C.9, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      npc->xm = 0;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( Random(0, 60) == 1 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      break;
    case 2:
      if ( ++npc->act_wait > 8 )
      {
        npc->act_no = 1;
        npc->ani_no = 0;
      }
      break;
    case 0xA:
      npc->act_no = 11;
      npc->ani_no = 2;
      npc->ani_wait = 0;
      goto LABEL_8;
    case 0xB:
LABEL_8:
      npc->xm = 512;
      if ( ++npc->ani_wait > 4 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 5 )
        npc->ani_no = 2;
      ++npc->act_wait;
      break;
    case 0x14:
      npc->xm = 0;
      npc->ani_no = 6;
      break;
    default:
      break;
  }
  npc->ym += 32;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  v1 = (Sint32 *)&v3[16 * npc->ani_no - 112];
  npc->rect.left = *v1;
  npc->rect.top = v1[1];
  npc->rect.right = v1[2];
  npc->rect.bottom = v1[3];
}


//----- (080716D4) --------------------------------------------------------
void __cdecl ActNpc227(NPCHAR_0 *npc)
{
  npc->rect.left = 208;
  npc->rect.top = 32;
  npc->rect.right = 224;
  npc->rect.bottom = 48;
}

//----- (08071713) --------------------------------------------------------
void __cdecl ActNpc228(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  RECT *v2;
  RECT rcRight[4];
  RECT rcLeft[4];

  rcLeft[0].left = 0;
  rcLeft[0].top = 0;
  rcLeft[0].right = 32;
  rcLeft[0].bottom = 40;
  rcLeft[1].left = 32;
  rcLeft[1].top = 0;
  rcLeft[1].right = 64;
  rcLeft[1].bottom = 40;
  rcLeft[2].left = 64;
  rcLeft[2].top = 0;
  rcLeft[2].right = 96;
  rcLeft[2].bottom = 40;
  rcLeft[3].left = 96;
  rcLeft[3].top = 0;
  rcLeft[3].right = 128;
  rcLeft[3].bottom = 40;
  rcRight[0].left = 0;
  rcRight[0].top = 40;
  rcRight[0].right = 32;
  rcRight[0].bottom = 80;
  rcRight[1].left = 32;
  rcRight[1].top = 40;
  rcRight[1].right = 64;
  rcRight[1].bottom = 80;
  rcRight[2].left = 64;
  rcRight[2].top = 40;
  rcRight[2].right = 96;
  rcRight[2].bottom = 80;
  rcRight[3].left = 96;
  rcRight[3].top = 40;
  rcRight[3].right = 128;
  rcRight[3].bottom = 80;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->y -= 4096;
      goto LABEL_3;
    case 1:
LABEL_3:
      npc->xm = 0;
      npc->act_no = 2;
      npc->ani_no = 0;
      goto LABEL_4;
    case 2:
LABEL_4:
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
      if ( ++npc->ani_wait > 50 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 1 )
        npc->ani_no = 0;
      break;
    case 0xA:
      npc->act_no = 11;
      npc->ani_no = 2;
      npc->act_wait = 0;
      goto LABEL_12;
    case 0xB:
LABEL_12:
      if ( ++npc->act_wait > 10 )
      {
        npc->act_no = 12;
        npc->ani_no = 3;
        npc->ym = -1536;
        if ( npc->direct )
          npc->xm = 512;
        else
          npc->xm = -512;
      }
      break;
    case 0xC:
      if ( npc->flag & 8 )
      {
        npc->ani_no = 2;
        npc->act_no = 13;
        npc->act_wait = 0;
      }
      break;
    case 0xD:
      npc->xm /= 2;
      if ( ++npc->act_wait > 10 )
        npc->act_no = 1;
      break;
    default:
      break;
  }
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v1 = npc;
    v2 = &rcRight[npc->ani_no];
  }
  else
  {
    v1 = npc;
    v2 = &rcLeft[npc->ani_no];
  }
  npc->rect.left = v2->left;
  v1->rect.top = v2->top;
  v1->rect.right = v2->right;
  v1->rect.bottom = v2->bottom;
}

//----- (08071A5F) --------------------------------------------------------
void __cdecl ActNpc229(NPCHAR_0 *npc)
{
  if ( !npc->act_no )
  {
    npc->act_no = 1;
    npc->y -= 0x2000;
  }
  if ( npc->direct )
  {
    npc->rect.left = 0;
    npc->rect.top = 112;
    npc->rect.right = 48;
    npc->rect.bottom = 128;
  }
  else
  {
    npc->rect.left = 0;
    npc->rect.top = 96;
    npc->rect.right = 48;
    npc->rect.bottom = 112;
  }
}

//----- (08071B07) --------------------------------------------------------
void __cdecl ActNpc230(NPCHAR_0 *npc)
{
  if ( !npc->act_no )
  {
    npc->act_no = 1;
    npc->x -= 0x2000;
    npc->y -= 0x2000;
  }
  if ( npc->direct )
  {
    npc->rect.left = 96;
    npc->rect.top = 96;
    npc->rect.right = 144;
  }
  else
  {
    npc->rect.left = 48;
    npc->rect.top = 96;
    npc->rect.right = 96;
  }
  npc->rect.bottom = 128;
}

//----- (08071BC1) --------------------------------------------------------
void __cdecl ActNpc231(NPCHAR_0 *npc)
{
  unsigned __int16 v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  int v8;
  int v9;
  unsigned __int16 v10;
  Sint32 *v11;
  RECT rc[2];
  int i;
  char v14[8];

  rc[0].left = 176;
  rc[0].top = 32;
  rc[0].right = 208;
  rc[0].bottom = 48;
  rc[1].left = 176;
  rc[1].top = 48;
  rc[1].right = 208;
  rc[1].bottom = 64;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      goto LABEL_3;
    case 1:
LABEL_3:
      npc->ani_no = 0;
      break;
    case 0xA:
      npc->act_no = 11;
      npc->act_wait = 0;
      goto LABEL_5;
    case 0xB:
LABEL_5:
      ++npc->act_wait;
      npc->ym += 8;
      if ( npc->flag & 8 )
      {
        if ( npc->act_wait > 9 )
          npc->act_no = 1;
        else
          npc->act_no = 12;
      }
      break;
    case 0xC:
      v1 = npc->bits;
      HIBYTE(v1) &= 0xDFu;
      npc->bits = v1;
      npc->act_no = 13;
      npc->act_wait = 0;
      npc->ani_no = 1;
      for ( i = 0; i <= 9; ++i )
      {
        v2 = npc->y;
        v3 = (Random(-8, 8) << 9) + v2;
        v4 = npc->x;
        v5 = Random(-16, 16);
        SetNpChar(4, v4 + (v5 << 9), v3, 0, 0, 0, 0, 256);
        PlaySoundObject(12, 1);
      }
      goto LABEL_12;
    case 0xD:
LABEL_12:
      npc->ym -= 8;
      if ( !(++npc->act_wait & 1) )
        SetCaret(npc->x - 5120, npc->y + 4096, 7, 3);
      if ( npc->act_wait % 2 == 1 )
        SetCaret(npc->x + 5120, npc->y + 4096, 7, 3);
      if ( npc->act_wait % 4 == 1 )
        PlaySoundObject(34, 1);
      if ( npc->flag & 2 || dword_81C8584 & 2 || npc->act_wait > 450 )
      {
        if ( npc->flag & 2 || dword_81C8584 & 2 )
          npc->ym = 0;
        npc->act_no = 15;
        for ( i = 0; i <= 5; ++i )
        {
          v6 = npc->y;
          v7 = (Random(-8, 8) << 9) + v6;
          v8 = npc->x;
          v9 = Random(-16, 16);
          SetNpChar(4, v8 + (v9 << 9), v7, 0, 0, 0, 0, 256);
          PlaySoundObject(12, 1);
        }
      }
      break;
    case 0xF:
      npc->ym += 8;
      ++npc->act_wait;
      if ( npc->ym < 0 )
      {
        if ( !(npc->act_wait & 7) )
          SetCaret(npc->x - 5120, npc->y + 4096, 7, 3);
        if ( npc->act_wait % 8 == 4 )
          SetCaret(npc->x + 5120, npc->y + 4096, 7, 3);
        if ( npc->act_wait % 16 == 1 )
          PlaySoundObject(34, 1);
      }
      if ( npc->flag & 8 )
      {
        v10 = npc->bits;
        HIBYTE(v10) |= 0x20u;
        npc->bits = v10;
        npc->act_no = 1;
        npc->ani_no = 0;
      }
      break;
    default:
      break;
  }
  if ( npc->ym < -1535 )
    npc->ym = -1535;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->y += npc->ym;
  v11 = (Sint32 *)&v14[16 * npc->ani_no - 36];
  npc->rect.left = *v11;
  npc->rect.top = v11[1];
  npc->rect.right = v11[2];
  npc->rect.bottom = v11[3];
}


//----- (080720F6) --------------------------------------------------------
void __cdecl ActNpc232(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  NPCHAR_0 *v3;
  Sint32 *v4;
  RECT rcRight[3];
  RECT rcLeft[3];
  int i;
  char v8[8];

  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_27;
  }
  else
  {
    npc->act_no = 1;
    npc->tgt_x = npc->x;
    npc->tgt_y = npc->y;
    npc->ym = 512;
    for ( i = 0; i <= 7; ++i )
      SetNpChar(233, npc->x, npc->y, 0, 0, npc->direct, npc, 256);
  }
  if ( npc->xm < 0 && npc->flag & 1 )
    npc->direct = 2;
  if ( npc->xm > 0 && npc->flag & 4 )
    npc->direct = 0;
  if ( npc->direct )
    npc->xm = 256;
  else
    npc->xm = -256;
  if ( npc->y >= npc->tgt_y )
    v2 = npc->ym - 8;
  else
    v2 = npc->ym + 8;
  npc->ym = v2;
  if ( npc->ym > 512 )
    npc->ym = 512;
  if ( npc->ym < -512 )
    npc->ym = -512;
  if ( ++npc->ani_wait > 5 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 2 )
    npc->ani_no = 0;
LABEL_27:
  npc->y += npc->ym;
  npc->x += npc->xm;
  rcLeft[0].left = 128;
  rcLeft[0].top = 0;
  rcLeft[0].right = 160;
  rcLeft[0].bottom = 32;
  rcLeft[1].left = 160;
  rcLeft[1].top = 0;
  rcLeft[1].right = 192;
  rcLeft[1].bottom = 32;
  rcLeft[2].left = 192;
  rcLeft[2].top = 0;
  rcLeft[2].right = 224;
  rcLeft[2].bottom = 32;
  rcRight[0].left = 128;
  rcRight[0].top = 32;
  rcRight[0].right = 160;
  rcRight[0].bottom = 64;
  rcRight[1].left = 160;
  rcRight[1].top = 32;
  rcRight[1].right = 192;
  rcRight[1].bottom = 64;
  rcRight[2].left = 192;
  rcRight[2].top = 32;
  rcRight[2].right = 224;
  rcRight[2].bottom = 64;
  if ( npc->direct )
  {
    v3 = npc;
    v4 = (Sint32 *)&v8[16 * npc->ani_no - 100];
  }
  else
  {
    v3 = npc;
    v4 = (Sint32 *)&v8[16 * npc->ani_no - 52];
  }
  npc->rect.left = *v4;
  v3->rect.top = v4[1];
  v3->rect.right = v4[2];
  v3->rect.bottom = v4[3];
}


//----- (080723EA) --------------------------------------------------------
void __cdecl ActNpc233(NPCHAR_0 *npc)
{
  int v1;
  unsigned __int8 v2;
  NPCHAR_0 *v3;
  Sint32 *v4;
  RECT rect_right[4];
  RECT rect_left[4];
  unsigned __int8 deg;
  char v8[8];

  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    if ( npc->pNpc->code_char == 232 )
    {
      npc->tgt_x = npc->pNpc->x;
      npc->tgt_y = npc->pNpc->y;
      npc->direct = npc->pNpc->direct;
    }
    if ( npc->tgt_x < npc->x )
      npc->xm -= 8;
    if ( npc->tgt_x > npc->x )
      npc->xm += 8;
    if ( npc->count2 + npc->tgt_y < npc->y )
      npc->ym -= 32;
    if ( npc->count2 + npc->tgt_y > npc->y )
      npc->ym += 32;
    if ( npc->xm > 1024 )
      npc->xm = 1024;
    if ( npc->xm < -1024 )
      npc->xm = -1024;
    if ( npc->ym > 1024 )
      npc->ym = 1024;
    if ( npc->ym < -1024 )
      npc->ym = -1024;
    if ( npc->count1 > 119 )
    {
      if ( npc->x - 4096 < x && npc->x + 4096 > x && npc->y < y && npc->y + 90112 > y )
      {
        npc->xm /= 4;
        npc->ym = 0;
        npc->act_no = 3;
        npc->bits &= 0xFFF7u;
      }
    }
    else
    {
      ++npc->count1;
    }
    goto LABEL_34;
  }
  if ( v1 != 3 )
  {
    if ( v1 )
      goto LABEL_34;
    npc->act_no = 1;
    v2 = Random(0, 255);
    npc->xm = GetCos(v2);
    deg = Random(0, 255);
    npc->ym = GetSin(deg);
    npc->count1 = 120;
    npc->count2 = Random(-32, 32) << 9;
    goto LABEL_5;
  }
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  if ( npc->flag & 8 )
  {
    npc->ym = 0;
    npc->xm *= 2;
    npc->count1 = 0;
    npc->act_no = 1;
    npc->bits |= 8u;
  }
LABEL_34:
  npc->x += npc->xm;
  npc->y += npc->ym;
  rect_left[0].left = 256;
  rect_left[0].top = 0;
  rect_left[0].right = 272;
  rect_left[0].bottom = 16;
  rect_left[1].left = 272;
  rect_left[1].top = 0;
  rect_left[1].right = 288;
  rect_left[1].bottom = 16;
  rect_left[2].left = 288;
  rect_left[2].top = 0;
  rect_left[2].right = 304;
  rect_left[2].bottom = 16;
  rect_left[3].left = 304;
  rect_left[3].top = 0;
  rect_left[3].right = 320;
  rect_left[3].bottom = 16;
  rect_right[0].left = 256;
  rect_right[0].top = 16;
  rect_right[0].right = 272;
  rect_right[0].bottom = 32;
  rect_right[1].left = 272;
  rect_right[1].top = 16;
  rect_right[1].right = 288;
  rect_right[1].bottom = 32;
  rect_right[2].left = 288;
  rect_right[2].top = 16;
  rect_right[2].right = 304;
  rect_right[2].bottom = 32;
  rect_right[3].left = 304;
  rect_right[3].top = 16;
  rect_right[3].right = 320;
  rect_right[3].bottom = 32;
  if ( npc->act_no == 3 )
  {
    npc->ani_no = 3;
  }
  else
  {
    if ( ++npc->ani_wait > 1 )
    {
      npc->ani_wait = 0;
      ++npc->ani_no;
    }
    if ( npc->ani_no > 2 )
      npc->ani_no = 0;
  }
  if ( npc->direct )
  {
    v3 = npc;
    v4 = (Sint32 *)&v8[16 * npc->ani_no - 132];
  }
  else
  {
    v3 = npc;
    v4 = (Sint32 *)&v8[16 * npc->ani_no - 68];
  }
  npc->rect.left = *v4;
  v3->rect.top = v4[1];
  v3->rect.right = v4[2];
  v3->rect.bottom = v4[3];
}


//----- (080728E3) --------------------------------------------------------
void __cdecl ActNpc234(NPCHAR_0 *npc)
{
  if ( !npc->act_no )
  {
    npc->act_no = 1;
    npc->y += 0x2000;
  }
  if ( npc->direct )
  {
    npc->rect.left = 144;
    npc->rect.top = 112;
    npc->rect.right = 192;
    npc->rect.bottom = 128;
  }
  else
  {
    npc->rect.left = 144;
    npc->rect.top = 96;
    npc->rect.right = 192;
    npc->rect.bottom = 112;
  }
}

//----- (0807298B) --------------------------------------------------------
void __cdecl ActNpc235(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  Sint32 *v2;
  RECT rcRight[4];
  RECT rcLeft[4];
  char v5[8];

  rcLeft[0].left = 192;
  rcLeft[0].top = 96;
  rcLeft[0].right = 208;
  rcLeft[0].bottom = 112;
  rcLeft[1].left = 208;
  rcLeft[1].top = 96;
  rcLeft[1].right = 224;
  rcLeft[1].bottom = 112;
  rcLeft[2].left = 224;
  rcLeft[2].top = 96;
  rcLeft[2].right = 240;
  rcLeft[2].bottom = 112;
  rcLeft[3].left = 192;
  rcLeft[3].top = 96;
  rcLeft[3].right = 208;
  rcLeft[3].bottom = 112;
  rcRight[0].left = 192;
  rcRight[0].top = 112;
  rcRight[0].right = 208;
  rcRight[0].bottom = 128;
  rcRight[1].left = 208;
  rcRight[1].top = 112;
  rcRight[1].right = 224;
  rcRight[1].bottom = 128;
  rcRight[2].left = 224;
  rcRight[2].top = 112;
  rcRight[2].right = 240;
  rcRight[2].bottom = 128;
  rcRight[3].left = 192;
  rcRight[3].top = 112;
  rcRight[3].right = 208;
  rcRight[3].bottom = 128;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      npc->xm = 0;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( Random(0, 30) == 1 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      if ( Random(0, 30) == 1 )
      {
        npc->act_no = 10;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      break;
    case 2:
      if ( ++npc->act_wait > 8 )
      {
        npc->act_no = 1;
        npc->ani_no = 0;
      }
      break;
    case 0xA:
      npc->act_no = 11;
      npc->act_wait = Random(0, 16);
      npc->ani_no = 2;
      npc->ani_wait = 0;
      if ( Random(0, 9) & 1 )
        npc->direct = 0;
      else
        npc->direct = 2;
      goto LABEL_12;
    case 0xB:
LABEL_12:
      if ( npc->direct || !(npc->flag & 1) )
      {
        if ( npc->direct == 2 && npc->flag & 4 )
          npc->direct = 0;
      }
      else
      {
        npc->direct = 2;
      }
      if ( npc->direct )
        npc->xm = 1024;
      else
        npc->xm = -1024;
      if ( ++npc->ani_wait > 1 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 3 )
        npc->ani_no = 2;
      if ( ++npc->act_wait > 64 )
        npc->act_no = 0;
      break;
    default:
      break;
  }
  npc->ym += 32;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->ani_no == 2 )
    npc->hit.top = 2560;
  else
    npc->hit.top = 2048;
  if ( npc->direct )
  {
    v1 = npc;
    v2 = (Sint32 *)&v5[16 * npc->ani_no - 128];
  }
  else
  {
    v1 = npc;
    v2 = (Sint32 *)&v5[16 * npc->ani_no - 64];
  }
  npc->rect.left = *v2;
  v1->rect.top = v2[1];
  v1->rect.right = v2[2];
  v1->rect.bottom = v2[3];
}


//----- (08072D8D) --------------------------------------------------------
void __cdecl ActNpc236(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[6];
  RECT rcLeft[6];
  char v6[24];

  qmemcpy(rcLeft, &ActNpc236(NPCHAR *)::C.14, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc236(NPCHAR *)::C.15, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->act_wait = Random(0, 50);
      npc->tgt_x = npc->x;
      npc->tgt_y = npc->y;
      npc->ym = 0;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( npc->act_wait )
      {
        --npc->act_wait;
      }
      else
      {
        npc->ym = 512;
        npc->act_no = 2;
      }
      break;
    case 2:
      if ( npc->x >= x )
        npc->direct = 0;
      else
        npc->direct = 2;
      if ( x < npc->x + 0x10000 && x > npc->x - 0x10000 && y < npc->y + 0x4000 && y > npc->y - 81920 )
        ++npc->act_wait;
      if ( npc->act_wait > 80 )
      {
        npc->act_no = 10;
        npc->act_wait = 0;
      }
      if ( ++npc->ani_wait > 1 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 1 )
        npc->ani_no = 0;
      break;
    case 0xA:
      if ( ++npc->act_wait > 20 )
      {
        npc->act_wait = 0;
        npc->act_no = 20;
      }
      if ( ++npc->ani_wait > 1 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 3 )
        npc->ani_no = 2;
      break;
    case 0x14:
      if ( ++npc->act_wait > 60 )
      {
        npc->act_wait = 0;
        npc->act_no = 2;
      }
      if ( npc->act_wait % 10 == 3 )
      {
        PlaySoundObject(39, 1);
        if ( npc->direct )
          SetNpChar(237, npc->x + 4096, npc->y - 4096, 1024, -1024, 0, 0, 256);
        else
          SetNpChar(237, npc->x - 4096, npc->y - 4096, -1024, -1024, 0, 0, 256);
      }
      if ( ++npc->ani_wait > 1 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 5 )
        npc->ani_no = 4;
      break;
    default:
      break;
  }
  if ( npc->y >= npc->tgt_y )
    v1 = npc->ym - 16;
  else
    v1 = npc->ym + 16;
  npc->ym = v1;
  if ( npc->ym > 256 )
    npc->ym = 256;
  if ( npc->ym < -256 )
    npc->ym = -256;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 192];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 96];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (08073227) --------------------------------------------------------
void __cdecl ActNpc237(NPCHAR_0 *npc)
{
  int v1;
  int i;
  bool bHit;

  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_15;
  }
  else
  {
    npc->act_no = 1;
  }
  bHit = 0;
  ++npc->act_wait;
  if ( npc->flag & 0xFF )
    bHit = 1;
  if ( npc->act_wait > 10 && npc->flag & 0x100 )
    bHit = 1;
  if ( bHit )
  {
    for ( i = 0; i <= 4; ++i )
      SetCaret(npc->x, npc->y, 1, 0);
    PlaySoundObject(21, 1);
    npc->cond = 0;
    return;
  }
LABEL_15:
  npc->ym += 32;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  npc->rect.left = 312;
  npc->rect.top = 32;
  npc->rect.right = 320;
  npc->rect.bottom = 40;
}

//----- (08073378) --------------------------------------------------------
void __cdecl ActNpc238(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  Sint32 *v7;
  RECT rc[3];
  int i;
  char v10[8];

  rc[0].left = 184;
  rc[0].top = 200;
  rc[0].right = 208;
  rc[0].bottom = 216;
  rc[1].left = 208;
  rc[1].top = 200;
  rc[1].right = 232;
  rc[1].bottom = 216;
  rc[2].left = 232;
  rc[2].top = 200;
  rc[2].right = 256;
  rc[2].bottom = 216;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->tgt_x = npc->x;
      npc->tgt_y = npc->y;
      npc->view.front = 0x2000;
      npc->view.back = 4096;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( !npc->direct && x < npc->x && x > npc->x - 98304 && y > npc->y - 2048 && y < npc->y + 4096 )
      {
        npc->act_no = 10;
        npc->act_wait = 0;
        npc->ani_no = 2;
      }
      if ( npc->direct == 2 && x > npc->x && x < npc->x + 98304 && y > npc->y - 2048 && y < npc->y + 4096 )
      {
        npc->act_no = 10;
        npc->act_wait = 0;
        npc->ani_no = 2;
      }
      break;
    case 0xA:
      npc->damage = 127;
      if ( npc->direct )
        v1 = npc->x + 3072;
      else
        v1 = npc->x - 3072;
      npc->x = v1;
      if ( ++npc->act_wait == 8 )
      {
        npc->act_no = 20;
        npc->act_wait = 0;
        for ( i = 0; i <= 3; ++i )
        {
          v2 = npc->y;
          v3 = (Random(-8, 8) << 9) + v2;
          v4 = npc->x;
          v5 = Random(-16, 16);
          SetNpChar(4, v4 + (v5 << 9), v3, 0, 0, 0, 0, 256);
          PlaySoundObject(12, 1);
        }
      }
      break;
    case 0x14:
      npc->damage = 0;
      if ( ++npc->act_wait > 50 )
      {
        npc->act_wait = 0;
        npc->act_no = 30;
      }
      break;
    case 0x1E:
      npc->damage = 0;
      npc->ani_no = 1;
      if ( ++npc->act_wait == 12 )
      {
        npc->act_no = 1;
        npc->act_wait = 0;
        npc->ani_no = 0;
      }
      if ( npc->direct )
        v6 = npc->x - 2048;
      else
        v6 = npc->x + 2048;
      npc->x = v6;
      break;
    default:
      break;
  }
  if ( npc->direct || x >= npc->x )
  {
    if ( npc->direct != 2 || x <= npc->x )
      npc->hit.back = 4096;
    else
      npc->hit.back = 0x2000;
  }
  else
  {
    npc->hit.back = 0x2000;
  }
  v7 = (Sint32 *)&v10[16 * npc->ani_no - 52];
  npc->rect.left = *v7;
  npc->rect.top = v7[1];
  npc->rect.right = v7[2];
  npc->rect.bottom = v7[3];
}


//----- (080737BD) --------------------------------------------------------
void __cdecl ActNpc239(NPCHAR_0 *npc)
{
  if ( !npc->act_no )
  {
    npc->act_no = 1;
    if ( npc->direct )
    {
      npc->view.front = 12288;
      npc->view.back = 12288;
      npc->view.top = 4096;
      npc->view.back = 12288;
    }
    else
    {
      npc->x += 4096;
      npc->y += 0x2000;
    }
  }
  if ( npc->direct )
  {
    npc->rect.left = 96;
    npc->rect.top = 112;
    npc->rect.right = 144;
    npc->rect.bottom = 144;
  }
  else
  {
    npc->rect.left = 192;
    npc->rect.top = 48;
    npc->rect.right = 256;
    npc->rect.bottom = 80;
  }
}

//----- (080738B8) --------------------------------------------------------
void InitBullet()
{
  int i;

  for ( i = 0; i <= 63; ++i )
    gBul[i].cond = 0;
}

//----- (080738E8) --------------------------------------------------------
int __cdecl CountArmsBullet(int arms_code)
{
  int i;
  int count;

  count = 0;
  for ( i = 0; i <= 63; ++i )
  {
    if ( gBul[i].cond & 0x80 && (gBul[i].code_bullet + 2) / 3 == arms_code )
      ++count;
  }
  return count;
}

//----- (08073953) --------------------------------------------------------
int __cdecl CountBulletNum(int bullet_code)
{
  int i;
  int count;

  count = 0;
  for ( i = 0; i <= 63; ++i )
  {
    if ( gBul[i].cond & 0x80 && gBul[i].code_bullet == bullet_code )
      ++count;
  }
  return count;
}

//----- (080739A7) --------------------------------------------------------
void __cdecl DeleteBullet(int code)
{
  int i;

  for ( i = 0; i <= 63; ++i )
  {
    if ( gBul[i].cond & 0x80 )
    {
      if ( (gBul[i].code_bullet + 2) / 3 == code )
        gBul[i].cond = 0;
    }
  }
}

//----- (08073A14) --------------------------------------------------------
void ClearBullet()
{
  int i;

  for ( i = 0; i <= 63; ++i )
    gBul[i].cond = 0;
}

//----- (08073A44) --------------------------------------------------------
void __cdecl PutBullet(int fx, int fy)
{
  signed int v2;
  int i;
  int x;
  int y;

  for ( i = 0; i <= 63; ++i )
  {
    if ( gBul[i].cond & 0x80 )
    {
      v2 = gBul[i].direct;
      if ( v2 == 1 )
      {
        x = *(&gBul[0].flag + 4 * (8 * i + 1)) - gBul[i].view.top;
        y = *(&gBul[0].code_bullet + 4 * (8 * i + 1)) - gBul[i].view.front;
      }
      else if ( v2 > 1 )
      {
        if ( v2 == 2 )
        {
          x = *(&gBul[0].flag + 4 * (8 * i + 1)) - gBul[i].view.back;
          y = *(&gBul[0].code_bullet + 4 * (8 * i + 1)) - gBul[i].view.top;
        }
        else if ( v2 == 3 )
        {
          x = *(&gBul[0].flag + 4 * (8 * i + 1)) - gBul[i].view.top;
          y = *(&gBul[0].code_bullet + 4 * (8 * i + 1)) - gBul[i].view.back;
        }
      }
      else if ( !gBul[i].direct )
      {
        x = *(&gBul[0].flag + 4 * (8 * i + 1)) - gBul[i].view.front;
        y = *(&gBul[0].code_bullet + 4 * (8 * i + 1)) - gBul[i].view.top;
      }
      PutBitmap3(&grcGame, x / 512 - fx / 512, y / 512 - fy / 512, (RECT *)((i << 7) + 136090076), 17);
    }
  }
}

//----- (08073C8A) --------------------------------------------------------
void __cdecl SetBullet(int no, int x, int y, int dir)
{
  char v4;
  int i;

  for ( i = 0; ; ++i )
  {
    v4 = i <= 63 && gBul[i].cond & 0x80 ? 1 : 0;
    if ( !v4 )
      break;
  }
  if ( i <= 63 )
  {
    memset((void *)((i << 7) + 136090016), 0, 0x80u);
    gBul[i].code_bullet = no;
    gBul[i].cond = 128;
    gBul[i].direct = dir;
    gBul[i].damage = gBulTbl[no].damage;
    gBul[i].life = gBulTbl[no].life;
    gBul[i].life_count = gBulTbl[no].life_count;
    gBul[i].bbits = gBulTbl[no].bbits;
    gBul[i].enemyXL = gBulTbl[no].enemyXL << 9;
    gBul[i].enemyYL = gBulTbl[no].enemyYL << 9;
    gBul[i].blockXL = gBulTbl[no].blockXL << 9;
    gBul[i].blockYL = gBulTbl[no].blockYL << 9;
    gBul[i].view.back = gBulTbl[no].view.back << 9;
    gBul[i].view.front = gBulTbl[no].view.front << 9;
    gBul[i].view.top = gBulTbl[no].view.top << 9;
    gBul[i].view.bottom = gBulTbl[no].view.bottom << 9;
    *(&gBul[0].flag + 4 * (8 * i + 1)) = x;
    *(&gBul[0].code_bullet + 4 * (8 * i + 1)) = y;
  }
}

//----- (08073EB8) --------------------------------------------------------
void __cdecl ActBullet_Frontia1($96A7816609F59F56E43A9A5E8F547E1B *bul)
{
  signed int v1;
  $96A7816609F59F56E43A9A5E8F547E1B *v2;
  Sint32 *v3;
  RECT rcRight[4];
  RECT rcLeft[4];
  char v6[8];

  if ( ++bul->count1 <= bul->life_count )
  {
    if ( bul->act_no )
    {
      bul->x += bul->xm;
      bul->y += bul->ym;
    }
    else
    {
      bul->ani_no = Random(0, 2);
      bul->act_no = 1;
      v1 = bul->direct;
      if ( v1 == 1 )
      {
        bul->ym = -1536;
      }
      else if ( v1 > 1 )
      {
        if ( v1 == 2 )
        {
          bul->xm = 1536;
        }
        else if ( v1 == 3 )
        {
          bul->ym = 1536;
        }
      }
      else if ( !bul->direct )
      {
        bul->xm = -1536;
      }
    }
    if ( ++bul->ani_wait > 0 )
    {
      bul->ani_wait = 0;
      ++bul->ani_no;
    }
    if ( bul->ani_no > 3 )
      bul->ani_no = 0;
    rcLeft[0].left = 136;
    rcLeft[0].top = 80;
    rcLeft[0].right = 152;
    rcLeft[0].bottom = 80;
    rcLeft[1].left = 120;
    rcLeft[1].top = 80;
    rcLeft[1].right = 136;
    rcLeft[1].bottom = 96;
    rcLeft[2].left = 136;
    rcLeft[2].top = 64;
    rcLeft[2].right = 152;
    rcLeft[2].bottom = 80;
    rcLeft[3].left = 120;
    rcLeft[3].top = 64;
    rcLeft[3].right = 136;
    rcLeft[3].bottom = 80;
    rcRight[0].left = 120;
    rcRight[0].top = 64;
    rcRight[0].right = 136;
    rcRight[0].bottom = 80;
    rcRight[1].left = 136;
    rcRight[1].top = 64;
    rcRight[1].right = 152;
    rcRight[1].bottom = 80;
    rcRight[2].left = 120;
    rcRight[2].top = 80;
    rcRight[2].right = 136;
    rcRight[2].bottom = 96;
    rcRight[3].left = 136;
    rcRight[3].top = 80;
    rcRight[3].right = 152;
    rcRight[3].bottom = 80;
    if ( bul->direct )
    {
      v2 = bul;
      v3 = (Sint32 *)&v6[16 * bul->ani_no - 128];
    }
    else
    {
      v2 = bul;
      v3 = (Sint32 *)&v6[16 * bul->ani_no - 64];
    }
    bul->rect.left = *v3;
    v2->rect.top = v3[1];
    v2->rect.right = v3[2];
    v2->rect.bottom = v3[3];
  }
  else
  {
    bul->cond = 0;
    SetCaret(bul->x, bul->y, 3, 0);
  }
}


//----- (08074158) --------------------------------------------------------
void __cdecl ActBullet_Frontia2($96A7816609F59F56E43A9A5E8F547E1B *bul, int level)
{
  signed int v2;
  signed int v3;
  signed int v4;
  signed int v5;
  Sint32 *v6;
  RECT rect[3];
  char v8[8];

  if ( ++bul->count1 > bul->life_count )
  {
    bul->cond = 0;
    SetCaret(bul->x, bul->y, 3, 0);
    return;
  }
  if ( !bul->act_no )
  {
    bul->ani_no = Random(0, 2);
    bul->act_no = 1;
    v2 = bul->direct;
    if ( v2 == 1 )
    {
      bul->ym = -512;
    }
    else if ( v2 > 1 )
    {
      if ( v2 == 2 )
      {
        bul->xm = 512;
      }
      else if ( v2 == 3 )
      {
        bul->ym = 512;
      }
    }
    else if ( !bul->direct )
    {
      bul->xm = -512;
    }
    ++ActBullet_Frontia2(BULLET *,long)::inc;
    v3 = bul->direct;
    if ( v3 != 1 )
    {
      if ( v3 <= 1 )
      {
        if ( bul->direct )
          goto LABEL_55;
LABEL_22:
        if ( ActBullet_Frontia2(BULLET *,long)::inc & 1 )
          bul->ym = 1024;
        else
          bul->ym = -1024;
        goto LABEL_55;
      }
      if ( v3 == 2 )
        goto LABEL_22;
      if ( v3 != 3 )
        goto LABEL_55;
    }
    if ( ActBullet_Frontia2(BULLET *,long)::inc & 1 )
      bul->xm = 1024;
    else
      bul->xm = -1024;
    goto LABEL_55;
  }
  v4 = bul->direct;
  if ( v4 == 1 )
  {
    bul->ym -= 128;
  }
  else if ( v4 > 1 )
  {
    if ( v4 == 2 )
    {
      bul->xm += 128;
    }
    else if ( v4 == 3 )
    {
      bul->ym += 128;
    }
  }
  else if ( !bul->direct )
  {
    bul->xm -= 128;
  }
  v5 = bul->direct;
  if ( v5 == 1 )
    goto LABEL_50;
  if ( v5 > 1 )
  {
    if ( v5 == 2 )
    {
LABEL_46:
      if ( bul->count1 % 5 == 2 )
      {
        if ( bul->ym >= 0 )
          bul->ym = -1024;
        else
          bul->ym = 1024;
      }
      goto LABEL_54;
    }
    if ( v5 != 3 )
      goto LABEL_54;
LABEL_50:
    if ( bul->count1 % 5 == 2 )
    {
      if ( bul->xm >= 0 )
        bul->xm = -1024;
      else
        bul->xm = 1024;
    }
    goto LABEL_54;
  }
  if ( !bul->direct )
    goto LABEL_46;
LABEL_54:
  bul->x += bul->xm;
  bul->y += bul->ym;
LABEL_55:
  if ( ++bul->ani_wait > 0 )
  {
    bul->ani_wait = 0;
    ++bul->ani_no;
  }
  if ( bul->ani_no > 2 )
    bul->ani_no = 0;
  rect[0].left = 192;
  rect[0].top = 16;
  rect[0].right = 208;
  rect[0].bottom = 32;
  rect[1].left = 208;
  rect[1].top = 16;
  rect[1].right = 224;
  rect[1].bottom = 32;
  rect[2].left = 224;
  rect[2].top = 16;
  rect[2].right = 240;
  rect[2].bottom = 32;
  v6 = (Sint32 *)&v8[16 * bul->ani_no - 48];
  bul->rect.left = *v6;
  bul->rect.top = v6[1];
  bul->rect.right = v6[2];
  bul->rect.bottom = v6[3];
  if ( level == 2 )
    SetNpChar(129, bul->x, bul->y, 0, -512, bul->ani_no, 0, 256);
  else
    SetNpChar(129, bul->x, bul->y, 0, -512, bul->ani_no + 3, 0, 256);
}


//----- (08074586) --------------------------------------------------------
void __cdecl ActBullet_PoleStar($96A7816609F59F56E43A9A5E8F547E1B *bul, int level)
{
  signed int v2;
  signed int v3;
  signed int v4;

  if ( ++bul->count1 <= bul->life_count )
  {
    if ( bul->act_no )
    {
      bul->x += bul->xm;
      bul->y += bul->ym;
    }
    else
    {
      bul->act_no = 1;
      v2 = bul->direct;
      if ( v2 == 1 )
      {
        bul->ym = -4096;
      }
      else if ( v2 > 1 )
      {
        if ( v2 == 2 )
        {
          bul->xm = 4096;
        }
        else if ( v2 == 3 )
        {
          bul->ym = 4096;
        }
      }
      else if ( !bul->direct )
      {
        bul->xm = -4096;
      }
      if ( level == 1 )
      {
        v3 = bul->direct;
        if ( v3 == 1 )
        {
          bul->enemyXL = 1024;
        }
        else if ( v3 > 1 )
        {
          if ( v3 == 2 )
          {
            bul->enemyYL = 1024;
          }
          else if ( v3 == 3 )
          {
            bul->enemyXL = 1024;
          }
        }
        else if ( !bul->direct )
        {
          bul->enemyYL = 1024;
        }
      }
      else if ( level == 2 )
      {
        v4 = bul->direct;
        if ( v4 == 1 )
        {
          bul->enemyXL = 2048;
        }
        else if ( v4 > 1 )
        {
          if ( v4 == 2 )
          {
            bul->enemyYL = 2048;
          }
          else if ( v4 == 3 )
          {
            bul->enemyXL = 2048;
          }
        }
        else if ( !bul->direct )
        {
          bul->enemyYL = 2048;
        }
      }
    }
    switch ( level )
    {
      case 2:
        if ( bul->direct != 1 && bul->direct != 3 )
        {
          bul->rect.left = 160;
          bul->rect.top = 32;
          bul->rect.right = 176;
          bul->rect.bottom = 48;
        }
        else
        {
          bul->rect.left = 176;
          bul->rect.top = 32;
          bul->rect.right = 192;
          bul->rect.bottom = 48;
        }
        break;
      case 3:
        if ( bul->direct != 1 && bul->direct != 3 )
        {
          bul->rect.left = 128;
          bul->rect.top = 48;
          bul->rect.right = 144;
          bul->rect.bottom = 64;
        }
        else
        {
          bul->rect.left = 144;
          bul->rect.top = 48;
          bul->rect.right = 160;
          bul->rect.bottom = 64;
        }
        break;
      case 1:
        if ( bul->direct != 1 && bul->direct != 3 )
        {
          bul->rect.left = 128;
          bul->rect.top = 32;
          bul->rect.right = 144;
          bul->rect.bottom = 48;
        }
        else
        {
          bul->rect.left = 144;
          bul->rect.top = 32;
          bul->rect.right = 160;
          bul->rect.bottom = 48;
        }
        break;
    }
  }
  else
  {
    bul->cond = 0;
    SetCaret(bul->x, bul->y, 3, 0);
  }
}

//----- (080748FA) --------------------------------------------------------
void __cdecl ActBullet_FireBall($96A7816609F59F56E43A9A5E8F547E1B *bul, int level)
{
  signed int v2;
  int v3;
  $96A7816609F59F56E43A9A5E8F547E1B *v4;
  Sint32 *v5;
  $96A7816609F59F56E43A9A5E8F547E1B *v6;
  Sint32 *v7;
  RECT rect_right1[4];
  RECT rect_left1[4];
  RECT rect_right2[3];
  RECT rect_left2[3];
  bool bBreak;
  char v13[8];

  if ( ++bul->count1 <= bul->life_count )
  {
    bBreak = 0;
    if ( bul->flag & 2 && bul->flag & 8 )
      bBreak = 1;
    if ( bul->flag & 1 && bul->flag & 4 )
      bBreak = 1;
    if ( !bul->direct && bul->flag & 1 )
      bul->direct = 2;
    if ( bul->direct == 2 && bul->flag & 4 )
      bul->direct = 0;
    if ( bBreak )
    {
      bul->cond = 0;
      SetCaret(bul->x, bul->y, 2, 0);
      PlaySoundObject(28, 1);
    }
    else
    {
      if ( bul->act_no )
      {
        if ( bul->flag & 8 )
        {
          bul->ym = -1024;
        }
        else if ( bul->flag & 1 )
        {
          bul->xm = 1024;
        }
        else if ( bul->flag & 4 )
        {
          bul->xm = -1024;
        }
        bul->ym += 85;
        if ( bul->ym > 1023 )
          bul->ym = 1023;
        bul->x += bul->xm;
        bul->y += bul->ym;
        if ( bul->flag & 0xD )
          PlaySoundObject(34, 1);
      }
      else
      {
        bul->act_no = 1;
        v2 = bul->direct;
        if ( v2 == 1 )
        {
          bul->xm = unk_81C85B4;
          if ( unk_81C85B4 >= 0 )
            bul->direct = 2;
          else
            bul->direct = 0;
          if ( dir )
            v3 = bul->xm + 128;
          else
            v3 = bul->xm - 128;
          bul->xm = v3;
          bul->ym = -1535;
        }
        else if ( v2 > 1 )
        {
          if ( v2 == 2 )
          {
            bul->xm = 1024;
          }
          else if ( v2 == 3 )
          {
            bul->xm = unk_81C85B4;
            if ( unk_81C85B4 >= 0 )
              bul->direct = 2;
            else
              bul->direct = 0;
            bul->ym = 1535;
          }
        }
        else if ( !bul->direct )
        {
          bul->xm = -1024;
        }
      }
      rect_left1[0].left = 128;
      rect_left1[0].top = 0;
      rect_left1[0].right = 144;
      rect_left1[0].bottom = 16;
      rect_left1[1].left = 144;
      rect_left1[1].top = 0;
      rect_left1[1].right = 160;
      rect_left1[1].bottom = 16;
      rect_left1[2].left = 160;
      rect_left1[2].top = 0;
      rect_left1[2].right = 176;
      rect_left1[2].bottom = 16;
      rect_left1[3].left = 176;
      rect_left1[3].top = 0;
      rect_left1[3].right = 192;
      rect_left1[3].bottom = 16;
      rect_right1[0].left = 128;
      rect_right1[0].top = 16;
      rect_right1[0].right = 144;
      rect_right1[0].bottom = 32;
      rect_right1[1].left = 144;
      rect_right1[1].top = 16;
      rect_right1[1].right = 160;
      rect_right1[1].bottom = 32;
      rect_right1[2].left = 160;
      rect_right1[2].top = 16;
      rect_right1[2].right = 176;
      rect_right1[2].bottom = 32;
      rect_right1[3].left = 176;
      rect_right1[3].top = 16;
      rect_right1[3].right = 192;
      rect_right1[3].bottom = 32;
      rect_left2[0].left = 192;
      rect_left2[0].top = 16;
      rect_left2[0].right = 208;
      rect_left2[0].bottom = 32;
      rect_left2[1].left = 208;
      rect_left2[1].top = 16;
      rect_left2[1].right = 224;
      rect_left2[1].bottom = 32;
      rect_left2[2].left = 224;
      rect_left2[2].top = 16;
      rect_left2[2].right = 240;
      rect_left2[2].bottom = 32;
      rect_right2[0].left = 224;
      rect_right2[0].top = 16;
      rect_right2[0].right = 240;
      rect_right2[0].bottom = 32;
      rect_right2[1].left = 208;
      rect_right2[1].top = 16;
      rect_right2[1].right = 224;
      rect_right2[1].bottom = 32;
      rect_right2[2].left = 192;
      rect_right2[2].top = 16;
      rect_right2[2].right = 208;
      rect_right2[2].bottom = 32;
      ++bul->ani_no;
      if ( level == 1 )
      {
        if ( bul->ani_no > 3 )
          bul->ani_no = 0;
        if ( bul->direct )
        {
          v4 = bul;
          v5 = (Sint32 *)&v13[16 * bul->ani_no - 228];
        }
        else
        {
          v4 = bul;
          v5 = (Sint32 *)&v13[16 * bul->ani_no - 164];
        }
        bul->rect.left = *v5;
        v4->rect.top = v5[1];
        v4->rect.right = v5[2];
        v4->rect.bottom = v5[3];
      }
      else
      {
        if ( bul->ani_no > 2 )
          bul->ani_no = 0;
        if ( bul->direct )
        {
          v6 = bul;
          v7 = (Sint32 *)&v13[16 * bul->ani_no - 100];
        }
        else
        {
          v6 = bul;
          v7 = (Sint32 *)&v13[16 * bul->ani_no - 52];
        }
        bul->rect.left = *v7;
        v6->rect.top = v7[1];
        v6->rect.right = v7[2];
        v6->rect.bottom = v7[3];
        if ( level == 2 )
          SetNpChar(129, bul->x, bul->y, 0, -512, bul->ani_no, 0, 256);
        else
          SetNpChar(129, bul->x, bul->y, 0, -512, bul->ani_no + 3, 0, 256);
      }
    }
  }
  else
  {
    bul->cond = 0;
    SetCaret(bul->x, bul->y, 3, 0);
  }
}


//----- (08074F66) --------------------------------------------------------
void __cdecl ActBullet_MachineGun($96A7816609F59F56E43A9A5E8F547E1B *bul, int level)
{
  signed int v2;
  Sint32 *v3;
  Sint32 *v4;
  Sint32 *v5;
  RECT rect3[4];
  RECT rect2[4];
  RECT rect1[4];
  int move;
  char v10[8];

  rect1[0].left = 64;
  rect1[0].top = 0;
  rect1[0].right = 80;
  rect1[0].bottom = 16;
  rect1[1].left = 80;
  rect1[1].top = 0;
  rect1[1].right = 96;
  rect1[1].bottom = 16;
  rect1[2].left = 96;
  rect1[2].top = 0;
  rect1[2].right = 112;
  rect1[2].bottom = 16;
  rect1[3].left = 112;
  rect1[3].top = 0;
  rect1[3].right = 128;
  rect1[3].bottom = 16;
  rect2[0].left = 64;
  rect2[0].top = 16;
  rect2[0].right = 80;
  rect2[0].bottom = 32;
  rect2[1].left = 80;
  rect2[1].top = 16;
  rect2[1].right = 96;
  rect2[1].bottom = 32;
  rect2[2].left = 96;
  rect2[2].top = 16;
  rect2[2].right = 112;
  rect2[2].bottom = 32;
  rect2[3].left = 112;
  rect2[3].top = 16;
  rect2[3].right = 128;
  rect2[3].bottom = 32;
  rect3[0].left = 64;
  rect3[0].top = 32;
  rect3[0].right = 80;
  rect3[0].bottom = 48;
  rect3[1].left = 80;
  rect3[1].top = 32;
  rect3[1].right = 96;
  rect3[1].bottom = 48;
  rect3[2].left = 96;
  rect3[2].top = 32;
  rect3[2].right = 112;
  rect3[2].bottom = 48;
  rect3[3].left = 112;
  rect3[3].top = 32;
  rect3[3].right = 128;
  rect3[3].bottom = 48;
  if ( ++bul->count1 <= bul->life_count )
  {
    if ( bul->act_no )
    {
      bul->x += bul->xm;
      bul->y += bul->ym;
      switch ( level )
      {
        case 2:
          v4 = (Sint32 *)&v10[16 * bul->direct - 132];
          bul->rect.left = *v4;
          bul->rect.top = v4[1];
          bul->rect.right = v4[2];
          bul->rect.bottom = v4[3];
          if ( bul->direct != 1 && bul->direct != 3 )
            SetNpChar(127, bul->x, bul->y, 0, 0, 0, 0, 256);
          else
            SetNpChar(127, bul->x, bul->y, 0, 0, 1, 0, 256);
          break;
        case 3:
          v5 = (Sint32 *)&v10[16 * bul->direct - 196];
          bul->rect.left = *v5;
          bul->rect.top = v5[1];
          bul->rect.right = v5[2];
          bul->rect.bottom = v5[3];
          SetNpChar(128, bul->x, bul->y, 0, 0, bul->direct, 0, 256);
          break;
        case 1:
          v3 = (Sint32 *)&v10[16 * bul->direct - 68];
          bul->rect.left = *v3;
          bul->rect.top = v3[1];
          bul->rect.right = v3[2];
          bul->rect.bottom = v3[3];
          break;
      }
    }
    else
    {
      switch ( level )
      {
        case 2:
          move = 4096;
          break;
        case 3:
          move = 4096;
          break;
        case 1:
          move = 4096;
          break;
      }
      bul->act_no = 1;
      v2 = bul->direct;
      if ( v2 == 1 )
      {
        bul->ym = -move;
        bul->xm = Random(-170, 170);
      }
      else if ( v2 > 1 )
      {
        if ( v2 == 2 )
        {
          bul->xm = move;
          bul->ym = Random(-170, 170);
        }
        else if ( v2 == 3 )
        {
          bul->ym = move;
          bul->xm = Random(-170, 170);
        }
      }
      else if ( !bul->direct )
      {
        bul->xm = -move;
        bul->ym = Random(-170, 170);
      }
    }
  }
  else
  {
    bul->cond = 0;
    SetCaret(bul->x, bul->y, 3, 0);
  }
}


//----- (08075448) --------------------------------------------------------
void __cdecl ActBullet_Missile($96A7816609F59F56E43A9A5E8F547E1B *bul, int level)
{
  int v2;
  signed int v3;
  signed int v4;
  unsigned int v5;
  signed int v6;
  signed int v7;
  int v8;
  int v9;
  signed int v10;
  Sint32 *v11;
  Sint32 *v12;
  Sint32 *v13;
  RECT rect3[4];
  RECT rect2[4];
  RECT rect1[4];
  bool bHit;
  char v18[8];

  if ( ++bul->count1 > bul->life_count )
  {
    bul->cond = 0;
    SetCaret(bul->x, bul->y, 3, 0);
    return;
  }
  bHit = 0;
  if ( bul->life != 10 )
    bHit = 1;
  if ( !bul->direct && bul->flag & 1 )
    bHit = 1;
  if ( bul->direct == 2 && bul->flag & 4 )
    bHit = 1;
  if ( bul->direct == 1 && bul->flag & 2 )
    bHit = 1;
  if ( bul->direct == 3 && bul->flag & 8 )
    bHit = 1;
  if ( !bul->direct && bul->flag & 0x80 )
    bHit = 1;
  if ( !bul->direct && bul->flag & 0x20 )
    bHit = 1;
  if ( bul->direct == 2 && bul->flag & 0x40 )
    bHit = 1;
  if ( bul->direct == 2 && bul->flag & 0x10 )
    bHit = 1;
  if ( bHit )
  {
    SetBullet(level + 15, bul->x, bul->y, 0);
    bul->cond = 0;
  }
  v2 = bul->act_no;
  if ( !v2 )
  {
    bul->act_no = 1;
    v3 = bul->direct;
    if ( v3 != 1 )
    {
      if ( v3 <= 1 )
      {
        if ( bul->direct )
          goto LABEL_43;
LABEL_41:
        bul->tgt_y = bul->y;
        goto LABEL_43;
      }
      if ( v3 == 2 )
        goto LABEL_41;
      if ( v3 != 3 )
      {
LABEL_43:
        if ( level != 3 )
        {
          bul->ani_no = 128;
          goto LABEL_67;
        }
        v4 = bul->direct;
        if ( v4 != 1 )
        {
          if ( v4 <= 1 )
          {
            if ( bul->direct )
              goto LABEL_59;
            goto LABEL_51;
          }
          if ( v4 == 2 )
          {
LABEL_51:
            if ( bul->y <= y )
              bul->ym = -256;
            else
              bul->ym = 256;
            bul->xm = Random(-512, 512);
            goto LABEL_59;
          }
          if ( v4 != 3 )
            goto LABEL_59;
        }
        if ( bul->x <= x )
          bul->xm = -256;
        else
          bul->xm = 256;
        bul->ym = Random(-512, 512);
LABEL_59:
        v5 = ++ActBullet_Missile(BULLET *,long)::inc % 3;
        if ( ActBullet_Missile(BULLET *,long)::inc % 3 == 1 )
        {
          bul->ani_no = 64;
        }
        else if ( v5 < 1 )
        {
          bul->ani_no = 128;
        }
        else if ( v5 == 2 )
        {
          bul->ani_no = 51;
        }
LABEL_67:
        v6 = bul->direct;
        if ( v6 == 1 )
        {
          bul->ym -= bul->ani_no;
        }
        else if ( v6 > 1 )
        {
          if ( v6 == 2 )
          {
            bul->xm += bul->ani_no;
          }
          else if ( v6 == 3 )
          {
            bul->ym += bul->ani_no;
          }
        }
        else if ( !bul->direct )
        {
          bul->xm -= bul->ani_no;
        }
        if ( level != 3 )
          goto LABEL_94;
        v7 = bul->direct;
        if ( v7 != 1 )
        {
          if ( v7 <= 1 )
          {
            if ( bul->direct )
            {
LABEL_94:
              if ( bul->xm < -2560 )
                bul->xm = -2560;
              if ( bul->xm > 2560 )
                bul->xm = 2560;
              if ( bul->ym < -2560 )
                bul->ym = -2560;
              if ( bul->ym > 2560 )
                bul->ym = 2560;
              bul->x += bul->xm;
              bul->y += bul->ym;
              goto LABEL_103;
            }
LABEL_86:
            if ( bul->y >= bul->tgt_y )
              v8 = bul->ym - 32;
            else
              v8 = bul->ym + 32;
            bul->ym = v8;
            goto LABEL_94;
          }
          if ( v7 == 2 )
            goto LABEL_86;
          if ( v7 != 3 )
            goto LABEL_94;
        }
        if ( bul->x >= bul->tgt_x )
          v9 = bul->xm - 32;
        else
          v9 = bul->xm + 32;
        bul->xm = v9;
        goto LABEL_94;
      }
    }
    bul->tgt_x = bul->x;
    goto LABEL_43;
  }
  if ( v2 == 1 )
    goto LABEL_67;
LABEL_103:
  if ( ++bul->count2 > 2 )
  {
    bul->count2 = 0;
    v10 = bul->direct;
    if ( v10 == 1 )
    {
      SetCaret(bul->x, bul->y + 4096, 7, 3);
    }
    else if ( v10 > 1 )
    {
      if ( v10 == 2 )
      {
        SetCaret(bul->x - 4096, bul->y, 7, 0);
      }
      else if ( v10 == 3 )
      {
        SetCaret(bul->x, bul->y - 4096, 7, 1);
      }
    }
    else if ( !bul->direct )
    {
      SetCaret(bul->x + 4096, bul->y, 7, 2);
    }
  }
  rect1[0].left = 0;
  rect1[0].top = 0;
  rect1[0].right = 16;
  rect1[0].bottom = 16;
  rect1[1].left = 16;
  rect1[1].top = 0;
  rect1[1].right = 32;
  rect1[1].bottom = 16;
  rect1[2].left = 32;
  rect1[2].top = 0;
  rect1[2].right = 48;
  rect1[2].bottom = 16;
  rect1[3].left = 48;
  rect1[3].top = 0;
  rect1[3].right = 64;
  rect1[3].bottom = 16;
  rect2[0].left = 0;
  rect2[0].top = 16;
  rect2[0].right = 16;
  rect2[0].bottom = 32;
  rect2[1].left = 16;
  rect2[1].top = 16;
  rect2[1].right = 32;
  rect2[1].bottom = 32;
  rect2[2].left = 32;
  rect2[2].top = 16;
  rect2[2].right = 48;
  rect2[2].bottom = 32;
  rect2[3].left = 48;
  rect2[3].top = 16;
  rect2[3].right = 64;
  rect2[3].bottom = 32;
  rect3[0].left = 0;
  rect3[0].top = 32;
  rect3[0].right = 16;
  rect3[0].bottom = 48;
  rect3[1].left = 16;
  rect3[1].top = 32;
  rect3[1].right = 32;
  rect3[1].bottom = 48;
  rect3[2].left = 32;
  rect3[2].top = 32;
  rect3[2].right = 48;
  rect3[2].bottom = 48;
  rect3[3].left = 48;
  rect3[3].top = 32;
  rect3[3].right = 64;
  rect3[3].bottom = 48;
  switch ( level )
  {
    case 2:
      v12 = (Sint32 *)&v18[16 * bul->direct - 132];
      bul->rect.left = *v12;
      bul->rect.top = v12[1];
      bul->rect.right = v12[2];
      bul->rect.bottom = v12[3];
      break;
    case 3:
      v13 = (Sint32 *)&v18[16 * bul->direct - 196];
      bul->rect.left = *v13;
      bul->rect.top = v13[1];
      bul->rect.right = v13[2];
      bul->rect.bottom = v13[3];
      break;
    case 1:
      v11 = (Sint32 *)&v18[16 * bul->direct - 68];
      bul->rect.left = *v11;
      bul->rect.top = v11[1];
      bul->rect.right = v11[2];
      bul->rect.bottom = v11[3];
      break;
  }
}


//----- (08075C36) --------------------------------------------------------
void __cdecl ActBullet_Bom($96A7816609F59F56E43A9A5E8F547E1B *bul, int level)
{
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  int v8;
  int v9;
  int v10;
  int v11;
  int v12;
  int v13;
  int v14;
  int v15;
  int v16;
  int v17;

  v2 = bul->act_no;
  if ( v2 )
  {
    if ( v2 != 1 )
      return;
  }
  else
  {
    bul->act_no = 1;
    switch ( level )
    {
      case 2:
        bul->act_wait = 15;
        break;
      case 3:
        bul->act_wait = 5;
        break;
      case 1:
        bul->act_wait = 10;
        break;
    }
    PlaySoundObject(44, 1);
  }
  if ( level == 2 )
  {
    if ( !(bul->act_wait % 3) )
    {
      v8 = bul->enemyXL;
      v9 = bul->y;
      v10 = (Random(-32, 32) << 9) + v9;
      v11 = bul->x;
      v12 = Random(-32, 32);
      SetDestroyNpCharUp(v11 + (v12 << 9), v10, v8, 2);
    }
  }
  else if ( level == 3 )
  {
    if ( !(bul->act_wait % 3) )
    {
      v13 = bul->enemyXL;
      v14 = bul->y;
      v15 = (Random(-40, 40) << 9) + v14;
      v16 = bul->x;
      v17 = Random(-40, 40);
      SetDestroyNpCharUp(v16 + (v17 << 9), v15, v13, 2);
    }
  }
  else if ( level == 1 && !(bul->act_wait % 3) )
  {
    v3 = bul->enemyXL;
    v4 = bul->y;
    v5 = (Random(-16, 16) << 9) + v4;
    v6 = bul->x;
    v7 = Random(-16, 16);
    SetDestroyNpCharUp(v6 + (v7 << 9), v5, v3, 2);
  }
  if ( --bul->act_wait < 0 )
    bul->cond = 0;
}

//----- (08075E89) --------------------------------------------------------
void __cdecl ActBullet_Bubblin1($96A7816609F59F56E43A9A5E8F547E1B *bul)
{
  signed int v1;
  signed int v2;
  Sint32 *v3;
  RECT rect[4];
  char v5[8];

  if ( bul->flag & 0x2FF )
  {
    bul->cond = 0;
    SetCaret(bul->x, bul->y, 2, 0);
  }
  else
  {
    if ( !bul->act_no )
    {
      bul->act_no = 1;
      v1 = bul->direct;
      if ( v1 == 1 )
      {
        bul->ym = -1536;
      }
      else if ( v1 > 1 )
      {
        if ( v1 == 2 )
        {
          bul->xm = 1536;
        }
        else if ( v1 == 3 )
        {
          bul->ym = 1536;
        }
      }
      else if ( !bul->direct )
      {
        bul->xm = -1536;
      }
    }
    v2 = bul->direct;
    if ( v2 == 1 )
    {
      bul->ym += 42;
    }
    else if ( v2 > 1 )
    {
      if ( v2 == 2 )
      {
        bul->xm -= 42;
      }
      else if ( v2 == 3 )
      {
        bul->ym -= 42;
      }
    }
    else if ( !bul->direct )
    {
      bul->xm += 42;
    }
    bul->x += bul->xm;
    bul->y += bul->ym;
    if ( ++bul->act_wait > 40 )
    {
      bul->cond = 0;
      SetCaret(bul->x, bul->y, 15, 0);
    }
    rect[0].left = 192;
    rect[0].top = 0;
    rect[0].right = 200;
    rect[0].bottom = 8;
    rect[1].left = 200;
    rect[1].top = 0;
    rect[1].right = 208;
    rect[1].bottom = 8;
    rect[2].left = 208;
    rect[2].top = 0;
    rect[2].right = 216;
    rect[2].bottom = 8;
    rect[3].left = 216;
    rect[3].top = 0;
    rect[3].right = 224;
    rect[3].bottom = 8;
    if ( ++bul->ani_wait > 3 )
    {
      bul->ani_wait = 0;
      ++bul->ani_no;
    }
    if ( bul->ani_no > 3 )
      bul->ani_no = 3;
    v3 = (Sint32 *)&v5[16 * bul->ani_no - 64];
    bul->rect.left = *v3;
    bul->rect.top = v3[1];
    bul->rect.right = v3[2];
    bul->rect.bottom = v3[3];
  }
}


//----- (080760FE) --------------------------------------------------------
void __cdecl ActBullet_Bubblin2($96A7816609F59F56E43A9A5E8F547E1B *bul)
{
  signed int v1;
  signed int v2;
  Sint32 *v3;
  RECT rect[4];
  bool bDelete;
  char v6[8];

  bDelete = 0;
  if ( !bul->direct && bul->flag & 1 )
    bDelete = 1;
  if ( bul->direct == 2 && bul->flag & 4 )
    bDelete = 1;
  if ( bul->direct == 1 && bul->flag & 2 )
    bDelete = 1;
  if ( bul->direct == 3 && bul->flag & 8 )
    bDelete = 1;
  if ( bDelete )
  {
    bul->cond = 0;
    SetCaret(bul->x, bul->y, 2, 0);
  }
  else
  {
    if ( !bul->act_no )
    {
      bul->act_no = 1;
      v1 = bul->direct;
      if ( v1 == 1 )
      {
        bul->ym = -1536;
        bul->xm = Random(-256, 256);
      }
      else if ( v1 > 1 )
      {
        if ( v1 == 2 )
        {
          bul->xm = 1536;
          bul->ym = Random(-256, 256);
        }
        else if ( v1 == 3 )
        {
          bul->ym = 1536;
          bul->xm = Random(-256, 256);
        }
      }
      else if ( !bul->direct )
      {
        bul->xm = -1536;
        bul->ym = Random(-256, 256);
      }
    }
    v2 = bul->direct;
    if ( v2 == 1 )
    {
      bul->ym += 16;
    }
    else if ( v2 > 1 )
    {
      if ( v2 == 2 )
      {
        bul->xm -= 16;
      }
      else if ( v2 == 3 )
      {
        bul->ym -= 16;
      }
    }
    else if ( !bul->direct )
    {
      bul->xm += 16;
    }
    bul->x += bul->xm;
    bul->y += bul->ym;
    if ( ++bul->act_wait > 60 )
    {
      bul->cond = 0;
      SetCaret(bul->x, bul->y, 15, 0);
    }
    rect[0].left = 192;
    rect[0].top = 8;
    rect[0].right = 200;
    rect[0].bottom = 16;
    rect[1].left = 200;
    rect[1].top = 8;
    rect[1].right = 208;
    rect[1].bottom = 16;
    rect[2].left = 208;
    rect[2].top = 8;
    rect[2].right = 216;
    rect[2].bottom = 16;
    rect[3].left = 216;
    rect[3].top = 8;
    rect[3].right = 224;
    rect[3].bottom = 16;
    if ( ++bul->ani_wait > 3 )
    {
      bul->ani_wait = 0;
      ++bul->ani_no;
    }
    if ( bul->ani_no > 3 )
      bul->ani_no = 3;
    v3 = (Sint32 *)&v6[16 * bul->ani_no - 68];
    bul->rect.left = *v3;
    bul->rect.top = v3[1];
    bul->rect.right = v3[2];
    bul->rect.bottom = v3[3];
  }
}


//----- (0807644D) --------------------------------------------------------
void __cdecl ActBullet_Bubblin3($96A7816609F59F56E43A9A5E8F547E1B *bul)
{
  signed int v1;
  Sint32 *v2;
  RECT rect[4];
  char v4[8];

  if ( ++bul->act_wait <= 100 && gKey & gKeyShot )
  {
    if ( !bul->act_no )
    {
      bul->act_no = 1;
      v1 = bul->direct;
      if ( v1 == 1 )
      {
        bul->ym = Random(-1024, -512);
        bul->xm = (Random(-4, 4) << 9) / 2;
      }
      else if ( v1 > 1 )
      {
        if ( v1 == 2 )
        {
          bul->xm = Random(512, 1024);
          bul->ym = (Random(-4, 4) << 9) / 2;
        }
        else if ( v1 == 3 )
        {
          bul->ym = Random(128, 256);
          bul->xm = (Random(-4, 4) << 9) / 2;
        }
      }
      else if ( !bul->direct )
      {
        bul->xm = Random(-1024, -512);
        bul->ym = (Random(-4, 4) << 9) / 2;
      }
    }
    if ( bul->x < x )
      bul->xm += 32;
    if ( bul->x > x )
      bul->xm -= 32;
    if ( bul->y < y )
      bul->ym += 32;
    if ( bul->y > y )
      bul->ym -= 32;
    if ( bul->xm < 0 && bul->flag & 1 )
      bul->xm = 1024;
    if ( bul->xm > 0 && bul->flag & 4 )
      bul->xm = -1024;
    if ( bul->ym < 0 && bul->flag & 2 )
      bul->ym = 1024;
    if ( bul->ym > 0 && bul->flag & 8 )
      bul->ym = -1024;
    bul->x += bul->xm;
    bul->y += bul->ym;
    rect[0].left = 240;
    rect[0].top = 16;
    rect[0].right = 248;
    rect[0].bottom = 24;
    rect[1].left = 248;
    rect[1].top = 16;
    rect[1].right = 256;
    rect[1].bottom = 24;
    rect[2].left = 240;
    rect[2].top = 24;
    rect[2].right = 248;
    rect[2].bottom = 32;
    rect[3].left = 248;
    rect[3].top = 24;
    rect[3].right = 256;
    rect[3].bottom = 32;
    if ( ++bul->ani_wait > 3 )
    {
      bul->ani_wait = 0;
      ++bul->ani_no;
    }
    if ( bul->ani_no > 3 )
      bul->ani_no = 3;
    v2 = (Sint32 *)&v4[16 * bul->ani_no - 64];
    bul->rect.left = *v2;
    bul->rect.top = v2[1];
    bul->rect.right = v2[2];
    bul->rect.bottom = v2[3];
  }
  else
  {
    bul->cond = 0;
    SetCaret(bul->x, bul->y, 2, 0);
    PlaySoundObject(100, 1);
    if ( unk_81C858C )
    {
      SetBullet(22, bul->x, bul->y, 1);
    }
    else if ( unk_81C8590 )
    {
      SetBullet(22, bul->x, bul->y, 3);
    }
    else
    {
      SetBullet(22, bul->x, bul->y, dir);
    }
  }
}


//----- (080768CD) --------------------------------------------------------
void __cdecl ActBullet_Spine($96A7816609F59F56E43A9A5E8F547E1B *bul)
{
  signed int v1;
  int v2;
  int v3;
  signed int v4;
  Sint32 *v5;
  Sint32 *v6;
  Sint32 *v7;
  Sint32 *v8;
  RECT rcDown[2];
  RECT rcRight[2];
  RECT rcLeft[2];
  char v12[8];

  if ( ++bul->count1 > bul->life_count || bul->flag & 8 )
  {
    bul->cond = 0;
    SetCaret(bul->x, bul->y, 3, 0);
  }
  else
  {
    if ( bul->act_no )
    {
      bul->x += bul->xm;
      bul->y += bul->ym;
    }
    else
    {
      bul->act_no = 1;
      v1 = bul->direct;
      if ( v1 == 1 )
      {
        v3 = Random(10, 16);
        bul->ym = (signed int)(((unsigned int)(-512 * v3) >> 31) - (v3 << 9)) >> 1;
      }
      else if ( v1 > 1 )
      {
        if ( v1 == 2 )
        {
          bul->xm = (Random(10, 16) << 9) / 2;
        }
        else if ( v1 == 3 )
        {
          bul->ym = (Random(10, 16) << 9) / 2;
        }
      }
      else if ( !bul->direct )
      {
        v2 = Random(10, 16);
        bul->xm = (signed int)(((unsigned int)(-512 * v2) >> 31) - (v2 << 9)) >> 1;
      }
    }
    if ( ++bul->ani_wait > 1 )
    {
      bul->ani_wait = 0;
      ++bul->ani_no;
    }
    if ( bul->ani_no > 1 )
      bul->ani_no = 0;
    rcLeft[0].left = 224;
    rcLeft[0].top = 0;
    rcLeft[0].right = 232;
    rcLeft[0].bottom = 8;
    rcLeft[1].left = 232;
    rcLeft[1].top = 0;
    rcLeft[1].right = 240;
    rcLeft[1].bottom = 8;
    rcRight[0].left = 224;
    rcRight[0].top = 0;
    rcRight[0].right = 232;
    rcRight[0].bottom = 8;
    rcRight[1].left = 232;
    rcRight[1].top = 0;
    rcRight[1].right = 240;
    rcRight[1].bottom = 8;
    rcDown[0].left = 224;
    rcDown[0].top = 8;
    rcDown[0].right = 232;
    rcDown[0].bottom = 16;
    rcDown[1].left = 232;
    rcDown[1].top = 8;
    rcDown[1].right = 240;
    rcDown[1].bottom = 16;
    v4 = bul->direct;
    if ( v4 == 1 )
    {
      v6 = (Sint32 *)&v12[16 * bul->ani_no - 96];
      bul->rect.left = *v6;
      bul->rect.top = v6[1];
      bul->rect.right = v6[2];
      bul->rect.bottom = v6[3];
    }
    else if ( v4 > 1 )
    {
      if ( v4 == 2 )
      {
        v7 = (Sint32 *)&v12[16 * bul->ani_no - 64];
        bul->rect.left = *v7;
        bul->rect.top = v7[1];
        bul->rect.right = v7[2];
        bul->rect.bottom = v7[3];
      }
      else if ( v4 == 3 )
      {
        v8 = (Sint32 *)&v12[16 * bul->ani_no - 96];
        bul->rect.left = *v8;
        bul->rect.top = v8[1];
        bul->rect.right = v8[2];
        bul->rect.bottom = v8[3];
      }
    }
    else if ( !bul->direct )
    {
      v5 = (Sint32 *)&v12[16 * bul->ani_no - 32];
      bul->rect.left = *v5;
      bul->rect.top = v5[1];
      bul->rect.right = v5[2];
      bul->rect.bottom = v5[3];
    }
  }
}


//----- (08076C34) --------------------------------------------------------
void __cdecl ActBullet_Sword1($96A7816609F59F56E43A9A5E8F547E1B *bul)
{
  signed int v1;
  $96A7816609F59F56E43A9A5E8F547E1B *v2;
  Sint32 *v3;
  RECT rcRight[4];
  RECT rcLeft[4];
  char v6[8];

  if ( ++bul->count1 <= bul->life_count )
  {
    if ( bul->count1 == 3 )
      bul->bbits &= 0xFFFFFFFB;
    if ( bul->count1 % 5 == 1 )
      PlaySoundObject(34, 1);
    if ( bul->act_no )
    {
      bul->x += bul->xm;
      bul->y += bul->ym;
    }
    else
    {
      bul->act_no = 1;
      v1 = bul->direct;
      if ( v1 == 1 )
      {
        bul->ym = -2048;
      }
      else if ( v1 > 1 )
      {
        if ( v1 == 2 )
        {
          bul->xm = 2048;
        }
        else if ( v1 == 3 )
        {
          bul->ym = 2048;
        }
      }
      else if ( !bul->direct )
      {
        bul->xm = -2048;
      }
    }
    rcLeft[0].left = 0;
    rcLeft[0].top = 48;
    rcLeft[0].right = 16;
    rcLeft[0].bottom = 64;
    rcLeft[1].left = 16;
    rcLeft[1].top = 48;
    rcLeft[1].right = 32;
    rcLeft[1].bottom = 64;
    rcLeft[2].left = 32;
    rcLeft[2].top = 48;
    rcLeft[2].right = 48;
    rcLeft[2].bottom = 64;
    rcLeft[3].left = 48;
    rcLeft[3].top = 48;
    rcLeft[3].right = 64;
    rcLeft[3].bottom = 64;
    rcRight[0].left = 64;
    rcRight[0].top = 48;
    rcRight[0].right = 80;
    rcRight[0].bottom = 64;
    rcRight[1].left = 80;
    rcRight[1].top = 48;
    rcRight[1].right = 96;
    rcRight[1].bottom = 64;
    rcRight[2].left = 96;
    rcRight[2].top = 48;
    rcRight[2].right = 112;
    rcRight[2].bottom = 64;
    rcRight[3].left = 112;
    rcRight[3].top = 48;
    rcRight[3].right = 128;
    rcRight[3].bottom = 64;
    if ( ++bul->ani_wait > 1 )
    {
      bul->ani_wait = 0;
      ++bul->ani_no;
    }
    if ( bul->ani_no > 3 )
      bul->ani_no = 0;
    if ( bul->direct )
    {
      v2 = bul;
      v3 = (Sint32 *)&v6[16 * bul->ani_no - 128];
    }
    else
    {
      v2 = bul;
      v3 = (Sint32 *)&v6[16 * bul->ani_no - 64];
    }
    bul->rect.left = *v3;
    v2->rect.top = v3[1];
    v2->rect.right = v3[2];
    v2->rect.bottom = v3[3];
  }
  else
  {
    bul->cond = 0;
    SetCaret(bul->x, bul->y, 3, 0);
  }
}


//----- (08076F13) --------------------------------------------------------
void __cdecl ActBullet_Sword2($96A7816609F59F56E43A9A5E8F547E1B *bul)
{
  signed int v1;
  $96A7816609F59F56E43A9A5E8F547E1B *v2;
  Sint32 *v3;
  RECT rcRight[4];
  RECT rcLeft[4];
  char v6[8];

  if ( ++bul->count1 <= bul->life_count )
  {
    if ( bul->count1 == 3 )
      bul->bbits &= 0xFFFFFFFB;
    if ( bul->count1 % 7 == 1 )
      PlaySoundObject(106, 1);
    if ( bul->act_no )
    {
      bul->x += bul->xm;
      bul->y += bul->ym;
    }
    else
    {
      bul->act_no = 1;
      v1 = bul->direct;
      if ( v1 == 1 )
      {
        bul->ym = -2048;
      }
      else if ( v1 > 1 )
      {
        if ( v1 == 2 )
        {
          bul->xm = 2048;
        }
        else if ( v1 == 3 )
        {
          bul->ym = 2048;
        }
      }
      else if ( !bul->direct )
      {
        bul->xm = -2048;
      }
    }
    rcLeft[0].left = 160;
    rcLeft[0].top = 48;
    rcLeft[0].right = 184;
    rcLeft[0].bottom = 72;
    rcLeft[1].left = 184;
    rcLeft[1].top = 48;
    rcLeft[1].right = 208;
    rcLeft[1].bottom = 72;
    rcLeft[2].left = 208;
    rcLeft[2].top = 48;
    rcLeft[2].right = 232;
    rcLeft[2].bottom = 72;
    rcLeft[3].left = 232;
    rcLeft[3].top = 48;
    rcLeft[3].right = 256;
    rcLeft[3].bottom = 72;
    rcRight[0].left = 160;
    rcRight[0].top = 72;
    rcRight[0].right = 184;
    rcRight[0].bottom = 96;
    rcRight[1].left = 184;
    rcRight[1].top = 72;
    rcRight[1].right = 208;
    rcRight[1].bottom = 96;
    rcRight[2].left = 208;
    rcRight[2].top = 72;
    rcRight[2].right = 232;
    rcRight[2].bottom = 96;
    rcRight[3].left = 232;
    rcRight[3].top = 72;
    rcRight[3].right = 256;
    rcRight[3].bottom = 96;
    if ( ++bul->ani_wait > 1 )
    {
      bul->ani_wait = 0;
      ++bul->ani_no;
    }
    if ( bul->ani_no > 3 )
      bul->ani_no = 0;
    if ( bul->direct )
    {
      v2 = bul;
      v3 = (Sint32 *)&v6[16 * bul->ani_no - 128];
    }
    else
    {
      v2 = bul;
      v3 = (Sint32 *)&v6[16 * bul->ani_no - 64];
    }
    bul->rect.left = *v3;
    v2->rect.top = v3[1];
    v2->rect.right = v3[2];
    v2->rect.bottom = v3[3];
  }
  else
  {
    bul->cond = 0;
    SetCaret(bul->x, bul->y, 3, 0);
  }
}


//----- (08077204) --------------------------------------------------------
void __cdecl ActBullet_Sword3($96A7816609F59F56E43A9A5E8F547E1B *bul)
{
  int v1;
  signed int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  int v8;
  int v9;
  int v10;
  signed int v11;
  Sint32 *v12;
  Sint32 *v13;
  Sint32 *v14;
  Sint32 *v15;
  RECT rcDown[2];
  RECT rcRight[2];
  RECT rcUp[2];
  RECT rcLeft[2];
  char v20[8];

  rcLeft[0].left = 272;
  rcLeft[0].top = 0;
  rcLeft[0].right = 296;
  rcLeft[0].bottom = 24;
  rcLeft[1].left = 296;
  rcLeft[1].top = 0;
  rcLeft[1].right = 320;
  rcLeft[1].bottom = 24;
  rcUp[0].left = 272;
  rcUp[0].top = 48;
  rcUp[0].right = 296;
  rcUp[0].bottom = 72;
  rcUp[1].left = 296;
  rcUp[1].top = 0;
  rcUp[1].right = 320;
  rcUp[1].bottom = 24;
  rcRight[0].left = 272;
  rcRight[0].top = 24;
  rcRight[0].right = 296;
  rcRight[0].bottom = 48;
  rcRight[1].left = 296;
  rcRight[1].top = 24;
  rcRight[1].right = 320;
  rcRight[1].bottom = 48;
  rcDown[0].left = 296;
  rcDown[0].top = 48;
  rcDown[0].right = 320;
  rcDown[0].bottom = 72;
  rcDown[1].left = 296;
  rcDown[1].top = 24;
  rcDown[1].right = 320;
  rcDown[1].bottom = 48;
  v1 = bul->act_no;
  switch ( v1 )
  {
    case 1:
LABEL_5:
      v2 = bul->direct;
      if ( v2 == 1 )
      {
        bul->ym = -2048;
      }
      else if ( v2 > 1 )
      {
        if ( v2 == 2 )
        {
          bul->xm = 2048;
        }
        else if ( v2 == 3 )
        {
          bul->ym = 2048;
        }
      }
      else if ( !bul->direct )
      {
        bul->xm = -2048;
      }
      if ( bul->life != 100 )
      {
        bul->act_no = 2;
        bul->ani_no = 1;
        bul->damage = -1;
        bul->act_wait = 0;
      }
      if ( ++bul->act_wait % 4 == 1 )
      {
        PlaySoundObject(106, 1);
        ++bul->count1;
        if ( bul->count1 & 1 )
          SetBullet(23, bul->x, bul->y, 0);
        else
          SetBullet(23, bul->x, bul->y, 2);
      }
      if ( ++bul->count1 == 5 )
        bul->bbits &= 0xFFFFFFFB;
      if ( bul->count1 > bul->life_count )
      {
        bul->cond = 0;
        SetCaret(bul->x, bul->y, 3, 0);
        return;
      }
      break;
    case 2:
      bul->xm = 0;
      bul->ym = 0;
      ++bul->act_wait;
      if ( Random(-1, 1) == 0 )
      {
        PlaySoundObject(106, 1);
        if ( Random(0, 1) & 1 )
        {
          v3 = bul->y;
          v4 = (Random(-64, 64) << 9) + v3;
          v5 = bul->x;
          v6 = Random(-64, 64);
          SetBullet(23, v5 + (v6 << 9), v4, 0);
        }
        else
        {
          v7 = bul->y;
          v8 = (Random(-64, 64) << 9) + v7;
          v9 = bul->x;
          v10 = Random(-64, 64);
          SetBullet(23, v9 + (v10 << 9), v8, 2);
        }
      }
      if ( bul->act_wait > 50 )
        bul->cond = 0;
      break;
    case 0:
      bul->act_no = 1;
      bul->xm = 0;
      bul->ym = 0;
      goto LABEL_5;
  }
  bul->x += bul->xm;
  bul->y += bul->ym;
  v11 = bul->direct;
  if ( v11 == 1 )
  {
    v13 = (Sint32 *)&v20[16 * bul->ani_no - 64];
    bul->rect.left = *v13;
    bul->rect.top = v13[1];
    bul->rect.right = v13[2];
    bul->rect.bottom = v13[3];
  }
  else if ( v11 > 1 )
  {
    if ( v11 == 2 )
    {
      v14 = (Sint32 *)&v20[16 * bul->ani_no - 96];
      bul->rect.left = *v14;
      bul->rect.top = v14[1];
      bul->rect.right = v14[2];
      bul->rect.bottom = v14[3];
    }
    else if ( v11 == 3 )
    {
      v15 = (Sint32 *)&v20[16 * bul->ani_no - 128];
      bul->rect.left = *v15;
      bul->rect.top = v15[1];
      bul->rect.right = v15[2];
      bul->rect.bottom = v15[3];
    }
  }
  else if ( !bul->direct )
  {
    v12 = (Sint32 *)&v20[16 * bul->ani_no - 32];
    bul->rect.left = *v12;
    bul->rect.top = v12[1];
    bul->rect.right = v12[2];
    bul->rect.bottom = v12[3];
  }
  if ( bul->act_wait & 1 )
    bul->rect.right = 0;
}


//----- (08077750) --------------------------------------------------------
void __cdecl ActBullet_Edge($96A7816609F59F56E43A9A5E8F547E1B *bul)
{
  int v1;
  int v2;
  int v3;
  $96A7816609F59F56E43A9A5E8F547E1B *v4;
  Sint32 *v5;
  RECT rcRight[5];
  RECT rcLeft[5];
  char v8[12];

  v1 = bul->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_18;
  }
  else
  {
    bul->act_no = 1;
    bul->y -= 6144;
    if ( bul->direct )
      v2 = bul->x - 0x2000;
    else
      v2 = bul->x + 0x2000;
    bul->x = v2;
  }
  if ( ++bul->ani_wait > 2 )
  {
    bul->ani_wait = 0;
    ++bul->ani_no;
  }
  if ( bul->direct )
    v3 = bul->x + 1024;
  else
    v3 = bul->x - 1024;
  bul->x = v3;
  bul->y += 1024;
  if ( bul->ani_no == 1 )
    bul->damage = 2;
  else
    bul->damage = 1;
  if ( bul->ani_no > 4 )
    bul->cond = 0;
LABEL_18:
  qmemcpy(rcLeft, &ActBullet_Edge(BULLET *)::C.71, sizeof(rcLeft));
  qmemcpy(rcRight, &ActBullet_Edge(BULLET *)::C.72, sizeof(rcRight));
  if ( bul->direct )
  {
    v4 = bul;
    v5 = (Sint32 *)&v8[16 * bul->ani_no - 160];
  }
  else
  {
    v4 = bul;
    v5 = (Sint32 *)&v8[16 * bul->ani_no - 80];
  }
  bul->rect.left = *v5;
  v4->rect.top = v5[1];
  v4->rect.right = v5[2];
  v4->rect.bottom = v5[3];
}


//----- (08077909) --------------------------------------------------------
void __cdecl ActBullet_Drop($96A7816609F59F56E43A9A5E8F547E1B *bul)
{
  if ( ++bul->act_wait > 2 )
    bul->cond = 0;
  bul->rect.left = 0;
  bul->rect.top = 0;
  bul->rect.right = 0;
  bul->rect.bottom = 0;
}

//----- (0807796C) --------------------------------------------------------
void __cdecl ActBullet_SuperMissile($96A7816609F59F56E43A9A5E8F547E1B *bul, int level)
{
  int v2;
  signed int v3;
  signed int v4;
  unsigned int v5;
  signed int v6;
  signed int v7;
  int v8;
  int v9;
  signed int v10;
  Sint32 *v11;
  Sint32 *v12;
  Sint32 *v13;
  RECT rect2[4];
  RECT rect1[4];
  bool bHit;
  char v17[8];

  if ( ++bul->count1 > bul->life_count )
  {
    bul->cond = 0;
    SetCaret(bul->x, bul->y, 3, 0);
    return;
  }
  bHit = 0;
  if ( bul->life != 10 )
    bHit = 1;
  if ( !bul->direct && bul->flag & 1 )
    bHit = 1;
  if ( bul->direct == 2 && bul->flag & 4 )
    bHit = 1;
  if ( bul->direct == 1 && bul->flag & 2 )
    bHit = 1;
  if ( bul->direct == 3 && bul->flag & 8 )
    bHit = 1;
  if ( !bul->direct && bul->flag & 0x80 )
    bHit = 1;
  if ( !bul->direct && bul->flag & 0x20 )
    bHit = 1;
  if ( bul->direct == 2 && bul->flag & 0x40 )
    bHit = 1;
  if ( bul->direct == 2 && bul->flag & 0x10 )
    bHit = 1;
  if ( bHit )
  {
    SetBullet(level + 30, bul->x, bul->y, 0);
    bul->cond = 0;
  }
  v2 = bul->act_no;
  if ( !v2 )
  {
    bul->act_no = 1;
    v3 = bul->direct;
    if ( v3 != 1 )
    {
      if ( v3 <= 1 )
      {
        if ( bul->direct )
          goto LABEL_43;
LABEL_41:
        bul->tgt_y = bul->y;
        bul->enemyXL = 4096;
        bul->blockXL = 4096;
        goto LABEL_43;
      }
      if ( v3 == 2 )
        goto LABEL_41;
      if ( v3 != 3 )
      {
LABEL_43:
        if ( level != 3 )
        {
          bul->ani_no = 512;
          goto LABEL_67;
        }
        v4 = bul->direct;
        if ( v4 != 1 )
        {
          if ( v4 <= 1 )
          {
            if ( bul->direct )
              goto LABEL_59;
            goto LABEL_51;
          }
          if ( v4 == 2 )
          {
LABEL_51:
            if ( bul->y <= y )
              bul->ym = -256;
            else
              bul->ym = 256;
            bul->xm = Random(-512, 512);
            goto LABEL_59;
          }
          if ( v4 != 3 )
            goto LABEL_59;
        }
        if ( bul->x <= x )
          bul->xm = -256;
        else
          bul->xm = 256;
        bul->ym = Random(-512, 512);
LABEL_59:
        v5 = ++ActBullet_SuperMissile(BULLET *,long)::inc % 3;
        if ( ActBullet_SuperMissile(BULLET *,long)::inc % 3 == 1 )
        {
          bul->ani_no = 256;
        }
        else if ( v5 < 1 )
        {
          bul->ani_no = 512;
        }
        else if ( v5 == 2 )
        {
          bul->ani_no = 170;
        }
LABEL_67:
        v6 = bul->direct;
        if ( v6 == 1 )
        {
          bul->ym -= bul->ani_no;
        }
        else if ( v6 > 1 )
        {
          if ( v6 == 2 )
          {
            bul->xm += bul->ani_no;
          }
          else if ( v6 == 3 )
          {
            bul->ym += bul->ani_no;
          }
        }
        else if ( !bul->direct )
        {
          bul->xm -= bul->ani_no;
        }
        if ( level != 3 )
          goto LABEL_94;
        v7 = bul->direct;
        if ( v7 != 1 )
        {
          if ( v7 <= 1 )
          {
            if ( bul->direct )
            {
LABEL_94:
              if ( bul->xm < -5120 )
                bul->xm = -5120;
              if ( bul->xm > 5120 )
                bul->xm = 5120;
              if ( bul->ym < -5120 )
                bul->ym = -5120;
              if ( bul->ym > 5120 )
                bul->ym = 5120;
              bul->x += bul->xm;
              bul->y += bul->ym;
              goto LABEL_103;
            }
LABEL_86:
            if ( bul->y >= bul->tgt_y )
              v8 = bul->ym - 64;
            else
              v8 = bul->ym + 64;
            bul->ym = v8;
            goto LABEL_94;
          }
          if ( v7 == 2 )
            goto LABEL_86;
          if ( v7 != 3 )
            goto LABEL_94;
        }
        if ( bul->x >= bul->tgt_x )
          v9 = bul->xm - 64;
        else
          v9 = bul->xm + 64;
        bul->xm = v9;
        goto LABEL_94;
      }
    }
    bul->tgt_x = bul->x;
    bul->enemyYL = 4096;
    bul->blockYL = 4096;
    goto LABEL_43;
  }
  if ( v2 == 1 )
    goto LABEL_67;
LABEL_103:
  if ( ++bul->count2 > 2 )
  {
    bul->count2 = 0;
    v10 = bul->direct;
    if ( v10 == 1 )
    {
      SetCaret(bul->x, bul->y + 4096, 7, 3);
    }
    else if ( v10 > 1 )
    {
      if ( v10 == 2 )
      {
        SetCaret(bul->x - 4096, bul->y, 7, 0);
      }
      else if ( v10 == 3 )
      {
        SetCaret(bul->x, bul->y - 4096, 7, 1);
      }
    }
    else if ( !bul->direct )
    {
      SetCaret(bul->x + 4096, bul->y, 7, 2);
    }
  }
  rect1[0].left = 120;
  rect1[0].top = 96;
  rect1[0].right = 136;
  rect1[0].bottom = 112;
  rect1[1].left = 136;
  rect1[1].top = 96;
  rect1[1].right = 152;
  rect1[1].bottom = 112;
  rect1[2].left = 152;
  rect1[2].top = 96;
  rect1[2].right = 168;
  rect1[2].bottom = 112;
  rect1[3].left = 168;
  rect1[3].top = 96;
  rect1[3].right = 184;
  rect1[3].bottom = 112;
  rect2[0].left = 184;
  rect2[0].top = 96;
  rect2[0].right = 200;
  rect2[0].bottom = 112;
  rect2[1].left = 200;
  rect2[1].top = 96;
  rect2[1].right = 216;
  rect2[1].bottom = 112;
  rect2[2].left = 216;
  rect2[2].top = 96;
  rect2[2].right = 232;
  rect2[2].bottom = 112;
  rect2[3].left = 232;
  rect2[3].top = 96;
  rect2[3].right = 248;
  rect2[3].bottom = 112;
  switch ( level )
  {
    case 2:
      v12 = (Sint32 *)&v17[16 * bul->direct - 132];
      bul->rect.left = *v12;
      bul->rect.top = v12[1];
      bul->rect.right = v12[2];
      bul->rect.bottom = v12[3];
      break;
    case 3:
      v13 = (Sint32 *)&v17[16 * bul->direct - 68];
      bul->rect.left = *v13;
      bul->rect.top = v13[1];
      bul->rect.right = v13[2];
      bul->rect.bottom = v13[3];
      break;
    case 1:
      v11 = (Sint32 *)&v17[16 * bul->direct - 68];
      bul->rect.left = *v11;
      bul->rect.top = v11[1];
      bul->rect.right = v11[2];
      bul->rect.bottom = v11[3];
      break;
  }
}


//----- (080780DF) --------------------------------------------------------
void __cdecl ActBullet_SuperBom($96A7816609F59F56E43A9A5E8F547E1B *bul, int level)
{
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  int v8;
  int v9;
  int v10;
  int v11;
  int v12;
  int v13;
  int v14;
  int v15;
  int v16;
  int v17;

  v2 = bul->act_no;
  if ( v2 )
  {
    if ( v2 != 1 )
      return;
  }
  else
  {
    bul->act_no = 1;
    switch ( level )
    {
      case 2:
        bul->act_wait = 14;
        break;
      case 3:
        bul->act_wait = 6;
        break;
      case 1:
        bul->act_wait = 10;
        break;
    }
    PlaySoundObject(44, 1);
  }
  if ( level == 2 )
  {
    if ( !(bul->act_wait % 3) )
    {
      v8 = bul->enemyXL;
      v9 = bul->y;
      v10 = (Random(-32, 32) << 9) + v9;
      v11 = bul->x;
      v12 = Random(-32, 32);
      SetDestroyNpCharUp(v11 + (v12 << 9), v10, v8, 2);
    }
  }
  else if ( level == 3 )
  {
    if ( !(bul->act_wait % 3) )
    {
      v13 = bul->enemyXL;
      v14 = bul->y;
      v15 = (Random(-40, 40) << 9) + v14;
      v16 = bul->x;
      v17 = Random(-40, 40);
      SetDestroyNpCharUp(v16 + (v17 << 9), v15, v13, 2);
    }
  }
  else if ( level == 1 && !(bul->act_wait % 3) )
  {
    v3 = bul->enemyXL;
    v4 = bul->y;
    v5 = (Random(-16, 16) << 9) + v4;
    v6 = bul->x;
    v7 = Random(-16, 16);
    SetDestroyNpCharUp(v6 + (v7 << 9), v5, v3, 2);
  }
  if ( --bul->act_wait < 0 )
    bul->cond = 0;
}

//----- (08078332) --------------------------------------------------------
void __cdecl ActBullet_Nemesis($96A7816609F59F56E43A9A5E8F547E1B *bul, int level)
{
  signed int v2;
  signed int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  signed int v8;
  Sint32 *v9;
  Sint32 *v10;
  Sint32 *v11;
  Sint32 *v12;
  RECT rcD[2];
  RECT rcR[2];
  RECT rcU[2];
  RECT rcL[2];
  char v17[8];

  if ( ++bul->count1 <= bul->life_count )
  {
    if ( bul->act_no )
    {
      if ( level == 1 && bul->count1 % 4 == 1 )
      {
        v3 = bul->direct;
        if ( v3 == 1 )
        {
          v5 = Random(-512, 512);
          SetNpChar(4, bul->x, bul->y, v5, -512, 2, 0, 256);
        }
        else if ( v3 > 1 )
        {
          if ( v3 == 2 )
          {
            v6 = Random(-512, 512);
            SetNpChar(4, bul->x, bul->y, 512, v6, 2, 0, 256);
          }
          else if ( v3 == 3 )
          {
            v7 = Random(-512, 512);
            SetNpChar(4, bul->x, bul->y, v7, 512, 2, 0, 256);
          }
        }
        else if ( !bul->direct )
        {
          v4 = Random(-512, 512);
          SetNpChar(4, bul->x, bul->y, -512, v4, 2, 0, 256);
        }
      }
      bul->x += bul->xm;
      bul->y += bul->ym;
    }
    else
    {
      bul->act_no = 1;
      bul->count1 = 0;
      v2 = bul->direct;
      if ( v2 == 1 )
      {
        bul->ym = -4096;
      }
      else if ( v2 > 1 )
      {
        if ( v2 == 2 )
        {
          bul->xm = 4096;
        }
        else if ( v2 == 3 )
        {
          bul->ym = 4096;
        }
      }
      else if ( !bul->direct )
      {
        bul->xm = -4096;
      }
      if ( level != 2 && level == 3 )
      {
        bul->xm /= 3;
        bul->ym /= 3;
      }
    }
    if ( ++bul->ani_no > 1 )
      bul->ani_no = 0;
    rcL[0].left = 0;
    rcL[0].top = 112;
    rcL[0].right = 32;
    rcL[0].bottom = 128;
    rcL[1].left = 0;
    rcL[1].top = 128;
    rcL[1].right = 32;
    rcL[1].bottom = 144;
    rcU[0].left = 32;
    rcU[0].top = 112;
    rcU[0].right = 48;
    rcU[0].bottom = 144;
    rcU[1].left = 48;
    rcU[1].top = 112;
    rcU[1].right = 64;
    rcU[1].bottom = 144;
    rcR[0].left = 64;
    rcR[0].top = 112;
    rcR[0].right = 96;
    rcR[0].bottom = 128;
    rcR[1].left = 64;
    rcR[1].top = 128;
    rcR[1].right = 96;
    rcR[1].bottom = 144;
    rcD[0].left = 96;
    rcD[0].top = 112;
    rcD[0].right = 112;
    rcD[0].bottom = 144;
    rcD[1].left = 112;
    rcD[1].top = 112;
    rcD[1].right = 128;
    rcD[1].bottom = 144;
    v8 = bul->direct;
    if ( v8 == 1 )
    {
      v10 = (Sint32 *)&v17[16 * bul->ani_no - 64];
      bul->rect.left = *v10;
      bul->rect.top = v10[1];
      bul->rect.right = v10[2];
      bul->rect.bottom = v10[3];
    }
    else if ( v8 > 1 )
    {
      if ( v8 == 2 )
      {
        v11 = (Sint32 *)&v17[16 * bul->ani_no - 96];
        bul->rect.left = *v11;
        bul->rect.top = v11[1];
        bul->rect.right = v11[2];
        bul->rect.bottom = v11[3];
      }
      else if ( v8 == 3 )
      {
        v12 = (Sint32 *)&v17[16 * bul->ani_no - 128];
        bul->rect.left = *v12;
        bul->rect.top = v12[1];
        bul->rect.right = v12[2];
        bul->rect.bottom = v12[3];
      }
    }
    else if ( !bul->direct )
    {
      v9 = (Sint32 *)&v17[16 * bul->ani_no - 32];
      bul->rect.left = *v9;
      bul->rect.top = v9[1];
      bul->rect.right = v9[2];
      bul->rect.bottom = v9[3];
    }
    bul->rect.top += 32 * ((level - 1) / 2);
    bul->rect.bottom += 32 * ((level - 1) / 2);
    bul->rect.left += (level - 1) % 2 << 7;
    bul->rect.right += (level - 1) % 2 << 7;
  }
  else
  {
    bul->cond = 0;
    SetCaret(bul->x, bul->y, 3, 0);
  }
}


//----- (080788E9) --------------------------------------------------------
void __cdecl ActBullet_Spur($96A7816609F59F56E43A9A5E8F547E1B *bul, int level)
{
  signed int v2;
  signed int v3;
  signed int v4;

  if ( ++bul->count1 <= bul->life_count )
  {
    if ( bul->damage && bul->life != 100 )
      bul->damage = 0;
    if ( bul->act_no )
    {
      bul->x += bul->xm;
      bul->y += bul->ym;
    }
    else
    {
      bul->act_no = 1;
      v2 = bul->direct;
      if ( v2 == 1 )
      {
        bul->ym = -4096;
      }
      else if ( v2 > 1 )
      {
        if ( v2 == 2 )
        {
          bul->xm = 4096;
        }
        else if ( v2 == 3 )
        {
          bul->ym = 4096;
        }
      }
      else if ( !bul->direct )
      {
        bul->xm = -4096;
      }
      if ( level == 1 )
      {
        v3 = bul->direct;
        if ( v3 == 1 )
        {
          bul->enemyXL = 1024;
        }
        else if ( v3 > 1 )
        {
          if ( v3 == 2 )
          {
            bul->enemyYL = 1024;
          }
          else if ( v3 == 3 )
          {
            bul->enemyXL = 1024;
          }
        }
        else if ( !bul->direct )
        {
          bul->enemyYL = 1024;
        }
      }
      else if ( level == 2 )
      {
        v4 = bul->direct;
        if ( v4 == 1 )
        {
          bul->enemyXL = 2048;
        }
        else if ( v4 > 1 )
        {
          if ( v4 == 2 )
          {
            bul->enemyYL = 2048;
          }
          else if ( v4 == 3 )
          {
            bul->enemyXL = 2048;
          }
        }
        else if ( !bul->direct )
        {
          bul->enemyYL = 2048;
        }
      }
    }
    bul->damage = bul->life;
    switch ( level )
    {
      case 2:
        if ( bul->direct != 1 && bul->direct != 3 )
        {
          bul->rect.left = 160;
          bul->rect.top = 32;
          bul->rect.right = 176;
          bul->rect.bottom = 48;
        }
        else
        {
          bul->rect.left = 176;
          bul->rect.top = 32;
          bul->rect.right = 192;
          bul->rect.bottom = 48;
        }
        break;
      case 3:
        if ( bul->direct != 1 && bul->direct != 3 )
        {
          bul->rect.left = 128;
          bul->rect.top = 48;
          bul->rect.right = 144;
          bul->rect.bottom = 64;
        }
        else
        {
          bul->rect.left = 144;
          bul->rect.top = 48;
          bul->rect.right = 160;
          bul->rect.bottom = 64;
        }
        break;
      case 1:
        if ( bul->direct != 1 && bul->direct != 3 )
        {
          bul->rect.left = 128;
          bul->rect.top = 32;
          bul->rect.right = 144;
          bul->rect.bottom = 48;
        }
        else
        {
          bul->rect.left = 144;
          bul->rect.top = 32;
          bul->rect.right = 160;
          bul->rect.bottom = 48;
        }
        break;
    }
    SetBullet(level + 39, bul->x, bul->y, bul->direct);
  }
  else
  {
    bul->cond = 0;
    SetCaret(bul->x, bul->y, 3, 0);
  }
}

//----- (08078CBD) --------------------------------------------------------
void __cdecl ActBullet_SpurTail($96A7816609F59F56E43A9A5E8F547E1B *bul, int level)
{
  RECT *v2;
  RECT *v3;
  RECT *v4;
  RECT *v5;
  RECT *v6;
  RECT *v7;
  RECT rc_v_lv3[3];
  RECT rc_h_lv3[3];
  RECT rc_v_lv2[3];
  RECT rc_h_lv2[3];
  RECT rc_v_lv1[3];
  RECT rc_h_lv1[3];

  if ( ++bul->count1 > 20 )
    bul->ani_no = bul->count1 - 20;
  if ( bul->ani_no > 2 )
    bul->cond = 0;
  if ( bul->damage && bul->life != 100 )
    bul->damage = 0;
  rc_h_lv1[0].left = 192;
  rc_h_lv1[0].top = 32;
  rc_h_lv1[0].right = 200;
  rc_h_lv1[0].bottom = 40;
  rc_h_lv1[1].left = 200;
  rc_h_lv1[1].top = 32;
  rc_h_lv1[1].right = 208;
  rc_h_lv1[1].bottom = 40;
  rc_h_lv1[2].left = 208;
  rc_h_lv1[2].top = 32;
  rc_h_lv1[2].right = 216;
  rc_h_lv1[2].bottom = 40;
  rc_v_lv1[0].left = 192;
  rc_v_lv1[0].top = 40;
  rc_v_lv1[0].right = 200;
  rc_v_lv1[0].bottom = 48;
  rc_v_lv1[1].left = 200;
  rc_v_lv1[1].top = 40;
  rc_v_lv1[1].right = 208;
  rc_v_lv1[1].bottom = 48;
  rc_v_lv1[2].left = 208;
  rc_v_lv1[2].top = 40;
  rc_v_lv1[2].right = 216;
  rc_v_lv1[2].bottom = 48;
  rc_h_lv2[0].left = 216;
  rc_h_lv2[0].top = 32;
  rc_h_lv2[0].right = 224;
  rc_h_lv2[0].bottom = 40;
  rc_h_lv2[1].left = 224;
  rc_h_lv2[1].top = 32;
  rc_h_lv2[1].right = 232;
  rc_h_lv2[1].bottom = 40;
  rc_h_lv2[2].left = 232;
  rc_h_lv2[2].top = 32;
  rc_h_lv2[2].right = 240;
  rc_h_lv2[2].bottom = 40;
  rc_v_lv2[0].left = 216;
  rc_v_lv2[0].top = 40;
  rc_v_lv2[0].right = 224;
  rc_v_lv2[0].bottom = 48;
  rc_v_lv2[1].left = 224;
  rc_v_lv2[1].top = 40;
  rc_v_lv2[1].right = 232;
  rc_v_lv2[1].bottom = 48;
  rc_v_lv2[2].left = 232;
  rc_v_lv2[2].top = 40;
  rc_v_lv2[2].right = 240;
  rc_v_lv2[2].bottom = 48;
  rc_h_lv3[0].left = 240;
  rc_h_lv3[0].top = 32;
  rc_h_lv3[0].right = 248;
  rc_h_lv3[0].bottom = 40;
  rc_h_lv3[1].left = 248;
  rc_h_lv3[1].top = 32;
  rc_h_lv3[1].right = 256;
  rc_h_lv3[1].bottom = 40;
  rc_h_lv3[2].left = 256;
  rc_h_lv3[2].top = 32;
  rc_h_lv3[2].right = 264;
  rc_h_lv3[2].bottom = 40;
  rc_v_lv3[0].left = 240;
  rc_v_lv3[0].top = 32;
  rc_v_lv3[0].right = 248;
  rc_v_lv3[0].bottom = 40;
  rc_v_lv3[1].left = 248;
  rc_v_lv3[1].top = 32;
  rc_v_lv3[1].right = 256;
  rc_v_lv3[1].bottom = 40;
  rc_v_lv3[2].left = 256;
  rc_v_lv3[2].top = 32;
  rc_v_lv3[2].right = 264;
  rc_v_lv3[2].bottom = 40;
  switch ( level )
  {
    case 2:
      if ( bul->direct && bul->direct != 2 )
      {
        v5 = &rc_v_lv2[bul->ani_no];
        bul->rect.left = v5->left;
        bul->rect.top = v5->top;
        bul->rect.right = v5->right;
        bul->rect.bottom = v5->bottom;
      }
      else
      {
        v4 = &rc_h_lv2[bul->ani_no];
        bul->rect.left = v4->left;
        bul->rect.top = v4->top;
        bul->rect.right = v4->right;
        bul->rect.bottom = v4->bottom;
      }
      break;
    case 3:
      if ( bul->direct && bul->direct != 2 )
      {
        v7 = &rc_v_lv3[bul->ani_no];
        bul->rect.left = v7->left;
        bul->rect.top = v7->top;
        bul->rect.right = v7->right;
        bul->rect.bottom = v7->bottom;
      }
      else
      {
        v6 = &rc_h_lv3[bul->ani_no];
        bul->rect.left = v6->left;
        bul->rect.top = v6->top;
        bul->rect.right = v6->right;
        bul->rect.bottom = v6->bottom;
      }
      break;
    case 1:
      if ( bul->direct && bul->direct != 2 )
      {
        v3 = &rc_v_lv1[bul->ani_no];
        bul->rect.left = v3->left;
        bul->rect.top = v3->top;
        bul->rect.right = v3->right;
        bul->rect.bottom = v3->bottom;
      }
      else
      {
        v2 = &rc_h_lv1[bul->ani_no];
        bul->rect.left = v2->left;
        bul->rect.top = v2->top;
        bul->rect.right = v2->right;
        bul->rect.bottom = v2->bottom;
      }
      break;
  }
}

//----- (08079112) --------------------------------------------------------
void __cdecl ActBullet_EnemyClear($96A7816609F59F56E43A9A5E8F547E1B *bul)
{
  if ( ++bul->count1 <= bul->life_count )
  {
    bul->damage = 10000;
    bul->enemyXL = 819200;
    bul->enemyYL = 819200;
  }
  else
  {
    bul->cond = 0;
  }
}

//----- (08079160) --------------------------------------------------------
void __cdecl ActBullet_Star($96A7816609F59F56E43A9A5E8F547E1B *bul)
{
  if ( ++bul->count1 > bul->life_count )
    bul->cond = 0;
}

//----- (0807918E) --------------------------------------------------------
void ActBullet()
{
  int i;

  for ( i = 0; i <= 63; ++i )
  {
    if ( gBul[i].cond & 0x80 )
    {
      if ( gBul[i].life > 0 )
      {
        switch ( gBul[i].code_bullet )
        {
          case 1:
            ActBullet_Frontia1(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016));
            break;
          case 2:
            ActBullet_Frontia2(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 2);
            break;
          case 3:
            ActBullet_Frontia2(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 3);
            break;
          case 4:
            ActBullet_PoleStar(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 1);
            break;
          case 5:
            ActBullet_PoleStar(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 2);
            break;
          case 6:
            ActBullet_PoleStar(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 3);
            break;
          case 7:
            ActBullet_FireBall(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 1);
            break;
          case 8:
            ActBullet_FireBall(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 2);
            break;
          case 9:
            ActBullet_FireBall(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 3);
            break;
          case 0xA:
            ActBullet_MachineGun(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 1);
            break;
          case 0xB:
            ActBullet_MachineGun(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 2);
            break;
          case 0xC:
            ActBullet_MachineGun(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 3);
            break;
          case 0xD:
            ActBullet_Missile(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 1);
            break;
          case 0xE:
            ActBullet_Missile(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 2);
            break;
          case 0xF:
            ActBullet_Missile(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 3);
            break;
          case 0x10:
            ActBullet_Bom(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 1);
            break;
          case 0x11:
            ActBullet_Bom(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 2);
            break;
          case 0x12:
            ActBullet_Bom(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 3);
            break;
          case 0x13:
            ActBullet_Bubblin1(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016));
            break;
          case 0x14:
            ActBullet_Bubblin2(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016));
            break;
          case 0x15:
            ActBullet_Bubblin3(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016));
            break;
          case 0x16:
            ActBullet_Spine(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016));
            break;
          case 0x17:
            ActBullet_Edge(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016));
            break;
          case 0x18:
            ActBullet_Drop(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016));
            break;
          case 0x19:
            ActBullet_Sword1(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016));
            break;
          case 0x1A:
            ActBullet_Sword2(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016));
            break;
          case 0x1B:
            ActBullet_Sword3(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016));
            break;
          case 0x1C:
            ActBullet_SuperMissile(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 1);
            break;
          case 0x1D:
            ActBullet_SuperMissile(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 2);
            break;
          case 0x1E:
            ActBullet_SuperMissile(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 3);
            break;
          case 0x1F:
            ActBullet_SuperBom(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 1);
            break;
          case 0x20:
            ActBullet_SuperBom(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 2);
            break;
          case 0x21:
            ActBullet_SuperBom(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 3);
            break;
          case 0x22:
            ActBullet_Nemesis(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 1);
            break;
          case 0x23:
            ActBullet_Nemesis(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 2);
            break;
          case 0x24:
            ActBullet_Nemesis(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 3);
            break;
          case 0x25:
            ActBullet_Spur(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 1);
            break;
          case 0x26:
            ActBullet_Spur(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 2);
            break;
          case 0x27:
            ActBullet_Spur(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 3);
            break;
          case 0x28:
            ActBullet_SpurTail(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 1);
            break;
          case 0x29:
            ActBullet_SpurTail(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 2);
            break;
          case 0x2A:
            ActBullet_SpurTail(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 3);
            break;
          case 0x2B:
            ActBullet_Nemesis(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016), 1);
            break;
          case 0x2C:
            ActBullet_EnemyClear(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016));
            break;
          case 0x2D:
            ActBullet_Star(($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016));
            break;
          default:
            continue;
        }
      }
      else
      {
        gBul[i].cond = 0;
      }
    }
  }
}

//----- (0807973D) --------------------------------------------------------
signed int IsActiveSomeBullet()
{
  unsigned int v0;
  int i;

  for ( i = 0; i <= 63; ++i )
  {
    if ( gBul[i].cond & 0x80 )
    {
      v0 = gBul[i].code_bullet - 13;
      if ( v0 <= 0x14 )
      {
        if ( (1 << v0) & 0x1FF43F )
          return 1;
      }
    }
  }
  return 0;
}

//----- (080797B0) --------------------------------------------------------
int __userpurge RGB@<eax>(int r, Uint8 g, Uint8 b, char a4)
{
  int result;

  result = r;
  *(_DWORD *)r = 0;
  *(_BYTE *)(r + 3) = -1;
  *(_BYTE *)r = g;
  *(_BYTE *)(r + 1) = b;
  *(_BYTE *)(r + 2) = a4;
  return result;
}

//----- (080797F2) --------------------------------------------------------
signed int __cdecl InitBack(char *fName, int type)
{
  SDL_RWops_0 *v2;
  char path[260];
  Uint8 r;
  SDL_Surface_0 *temp;

  RGB((int)&r, 0, 0, 16);
  _color_black = GetCortBoxColor((const SDL_Color_0 *const )&r);
  sprintf(path, "%s/%s.pbm", gDataPath, fName);
  v2 = SDL_RWFromFile(path, "rb");
  temp = SDL_LoadBMP_RW(v2, 1);
  if ( !temp )
    return 0;
  gBack.partsW = temp->w;
  gBack.partsH = temp->h;
  SDL_FreeSurface(temp);
  temp = 0;
  gBack.flag = 1;
  if ( !ReloadBitmap_File(fName, 28) )
    return 0;
  gBack.type = type;
  gWaterY = 1966080;
  return 1;
}


//----- (080798F8) --------------------------------------------------------
void ActBack()
{
  if ( gBack.type == 5 )
  {
    gBack._fx += 3072;
  }
  else if ( gBack.type >= 5 && gBack.type <= 7 )
  {
    ++gBack._fx;
    gBack._fx %= 640;
  }
}

//----- (0807995E) --------------------------------------------------------
void __cdecl PutBack(int fx, int fy)
{
  RECT rect;
  int x;
  int y;

  rect.left = 0;
  rect.top = 0;
  rect.right = gBack.partsW;
  rect.bottom = gBack.partsH;
  switch ( gBack.type )
  {
    case 0:
      for ( y = 0; y <= 239; y += gBack.partsH )
      {
        for ( x = 0; x <= 319; x += gBack.partsW )
          PutBitmap4(&grcGame, x, y, &rect, 28);
      }
      break;
    case 1:
      for ( y = -(fy / 1024 % gBack.partsH); y <= 239; y += gBack.partsH )
      {
        for ( x = -(fx / 1024 % gBack.partsW); x <= 319; x += gBack.partsW )
          PutBitmap4(&grcGame, x, y, &rect, 28);
      }
      break;
    case 2:
      for ( y = -(fy / 512 % gBack.partsH); y <= 239; y += gBack.partsH )
      {
        for ( x = -(fx / 512 % gBack.partsW); x <= 319; x += gBack.partsW )
          PutBitmap4(&grcGame, x, y, &rect, 28);
      }
      break;
    case 5:
      for ( y = -gBack.partsH; y <= 239; y += gBack.partsH )
      {
        for ( x = -(gBack._fx / 512 % gBack.partsW); x <= 319; x += gBack.partsW )
          PutBitmap4(&grcGame, x, y, &rect, 28);
      }
      break;
    case 6:
    case 7:
      rect.top = 0;
      rect.bottom = 88;
      rect.left = 0;
      rect.right = 320;
      PutBitmap4(&grcGame, 0, 0, &rect, 28);
      rect.top = 88;
      rect.bottom = 123;
      rect.left = gBack._fx / 2;
      rect.right = 320;
      PutBitmap4(&grcGame, 0, 88, &rect, 28);
      rect.left = 0;
      PutBitmap4(&grcGame, 320 - gBack._fx / 2 % 320, 88, &rect, 28);
      rect.top = 123;
      rect.bottom = 146;
      rect.left = gBack._fx % 320;
      rect.right = 320;
      PutBitmap4(&grcGame, 0, 123, &rect, 28);
      rect.left = 0;
      PutBitmap4(&grcGame, 320 - gBack._fx % 320, 123, &rect, 28);
      rect.top = 146;
      rect.bottom = 176;
      rect.left = 2 * gBack._fx % 320;
      rect.right = 320;
      PutBitmap4(&grcGame, 0, 146, &rect, 28);
      rect.left = 0;
      PutBitmap4(&grcGame, 320 - 2 * gBack._fx % 320, 146, &rect, 28);
      rect.top = 176;
      rect.bottom = 240;
      rect.left = 4 * gBack._fx % 320;
      rect.right = 320;
      PutBitmap4(&grcGame, 0, 176, &rect, 28);
      rect.left = 0;
      PutBitmap4(&grcGame, 320 - 4 * gBack._fx % 320, 176, &rect, 28);
      break;
    default:
      return;
  }
}

//----- (08079F58) --------------------------------------------------------
void __cdecl PutFront(int fx, int fy)
{
  RECT rcWater[2];
  int xpos;
  int ypos;
  int x;
  int y;
  int x_1;
  int x_2;
  int y_1;
  int y_2;

  rcWater[0].left = 0;
  rcWater[0].top = 0;
  rcWater[0].right = 32;
  rcWater[0].bottom = 16;
  rcWater[1].left = 0;
  rcWater[1].top = 16;
  rcWater[1].right = 32;
  rcWater[1].bottom = 48;
  if ( gBack.type == 3 )
  {
    x_1 = fx / 0x4000;
    x_2 = fx / 0x4000 + 11;
    y_1 = 0;
    y_2 = 32;
    for ( y = 0; y < y_2; ++y )
    {
      ypos = (y << 14) / 512 - fy / 512 + gWaterY / 512;
      if ( ypos >= -32 )
      {
        if ( ypos > 240 )
          return;
        for ( x = x_1; x < x_2; ++x )
        {
          xpos = (x << 14) / 512 - fx / 512;
          PutBitmap3(&grcGame, xpos, ypos, &rcWater[1], 28);
          if ( !y )
            PutBitmap3(&grcGame, xpos, ypos, rcWater, 28);
        }
      }
    }
  }
}

//----- (0807A100) --------------------------------------------------------
void __cdecl ActNpc020(NPCHAR_0 *npc)
{
  RECT *v1;
  RECT rcRight[3];
  RECT rcLeft;

  rcLeft.left = 288;
  rcLeft.top = 16;
  rcLeft.right = 320;
  rcLeft.bottom = 40;
  rcRight[0].left = 288;
  rcRight[0].top = 40;
  rcRight[0].right = 320;
  rcRight[0].bottom = 64;
  rcRight[1].left = 288;
  rcRight[1].top = 40;
  rcRight[1].right = 320;
  rcRight[1].bottom = 64;
  rcRight[2].left = 288;
  rcRight[2].top = 64;
  rcRight[2].right = 320;
  rcRight[2].bottom = 88;
  if ( ++npc->ani_wait > 3 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 2 )
    npc->ani_no = 0;
  if ( npc->direct )
  {
    v1 = &rcRight[npc->ani_no];
    npc->rect.left = v1->left;
    npc->rect.top = v1->top;
    npc->rect.right = v1->right;
    npc->rect.bottom = v1->bottom;
  }
  else
  {
    npc->rect = rcLeft;
  }
}

//----- (0807A211) --------------------------------------------------------
void __cdecl ActNpc021(NPCHAR_0 *npc)
{
  if ( !npc->act_no )
  {
    npc->act_no = 1;
    if ( npc->direct == 2 )
      npc->y += 0x2000;
  }
  npc->rect.left = 224;
  npc->rect.top = 40;
  npc->rect.right = 240;
  npc->rect.bottom = 48;
}

//----- (0807A281) --------------------------------------------------------
void __cdecl ActNpc022(NPCHAR_0 *npc)
{
  int v1;
  RECT *v2;
  RECT rect[2];

  rect[0].left = 240;
  rect[0].top = 16;
  rect[0].right = 264;
  rect[0].bottom = 48;
  rect[1].left = 248;
  rect[1].top = 152;
  rect[1].right = 272;
  rect[1].bottom = 184;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 == 1 && ++npc->ani_no > 1 )
      npc->ani_no = 0;
  }
  else
  {
    npc->ani_no = 0;
  }
  v2 = &rect[npc->ani_no];
  npc->rect.left = v2->left;
  npc->rect.top = v2->top;
  npc->rect.right = v2->right;
  npc->rect.bottom = v2->bottom;
}

//----- (0807A32C) --------------------------------------------------------
void __cdecl ActNpc023(NPCHAR_0 *npc)
{
  Sint32 *v1;
  RECT rect[8];
  char v3[12];

  qmemcpy(rect, &ActNpc023(NPCHAR *)::C.0, sizeof(rect));
  if ( ++npc->ani_wait > 1 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 7 )
    npc->ani_no = 0;
  v1 = (Sint32 *)&v3[16 * npc->ani_no - 128];
  npc->rect.left = *v1;
  npc->rect.top = v1[1];
  npc->rect.right = v1[2];
  npc->rect.bottom = v1[3];
}


//----- (0807A3C9) --------------------------------------------------------
void __cdecl ActNpc024(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  NPCHAR_0 *v3;
  Sint32 *v4;
  RECT rcRight[6];
  RECT rcLeft[6];
  char v7[24];

  qmemcpy(rcLeft, &ActNpc024(NPCHAR *)::C.1, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc024(NPCHAR *)::C.2, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->y += 1536;
      npc->act_no = 1;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( npc->act_wait <= 7
        || npc->x - 0x10000 >= x
        || npc->x + 0x10000 <= x
        || npc->y - 0x10000 >= y
        || npc->y + 24576 <= y )
      {
        if ( npc->act_wait <= 7 )
          ++npc->act_wait;
        npc->ani_no = 0;
      }
      else
      {
        if ( npc->x <= x )
          npc->direct = 2;
        else
          npc->direct = 0;
        npc->ani_no = 1;
      }
      if ( npc->shock )
      {
        npc->act_no = 2;
        npc->ani_no = 0;
        npc->act_wait = 0;
      }
      if ( npc->act_wait > 7 && npc->x - 49152 < x && npc->x + 49152 > x && npc->y - 49152 < y && npc->y + 24576 > y )
      {
        npc->act_no = 2;
        npc->ani_no = 0;
        npc->act_wait = 0;
      }
      break;
    case 2:
      if ( ++npc->act_wait > 8 )
      {
        npc->act_no = 3;
        npc->ani_no = 2;
        npc->ym = -1535;
        PlaySoundObject(108, 1);
        if ( npc->x <= x )
          npc->direct = 2;
        else
          npc->direct = 0;
        if ( npc->direct )
          npc->xm = 256;
        else
          npc->xm = -256;
      }
      break;
    case 3:
      if ( npc->ym > 512 )
      {
        npc->tgt_y = npc->y;
        npc->act_no = 4;
        npc->ani_no = 3;
        npc->act_wait = 0;
        npc->act_wait = 0;
      }
      break;
    case 4:
      if ( npc->x >= x )
        npc->direct = 0;
      else
        npc->direct = 2;
      ++npc->act_wait;
      if ( npc->flag & 7 || npc->act_wait > 100 )
      {
        npc->damage = 12;
        npc->act_no = 5;
        npc->ani_no = 2;
        npc->xm /= 2;
      }
      else
      {
        if ( npc->act_wait % 4 == 1 )
          PlaySoundObject(110, 1);
        if ( ++npc->ani_wait > 0 )
        {
          npc->ani_wait = 0;
          ++npc->ani_no;
        }
        if ( npc->ani_no > 5 )
          npc->ani_no = 3;
      }
      break;
    case 5:
      if ( npc->flag & 8 )
      {
        npc->damage = 2;
        npc->xm = 0;
        npc->act_wait = 0;
        npc->ani_no = 0;
        npc->act_no = 1;
        PlaySoundObject(26, 1);
        SetQuake(30);
      }
      break;
    default:
      break;
  }
  if ( npc->act_no == 4 )
  {
    if ( npc->x >= x )
      v1 = npc->xm - 32;
    else
      v1 = npc->xm + 32;
    npc->xm = v1;
    if ( npc->y <= npc->tgt_y )
      v2 = npc->ym + 16;
    else
      v2 = npc->ym - 16;
    npc->ym = v2;
    if ( npc->ym > 512 )
      npc->ym = 512;
    if ( npc->ym < -512 )
      npc->ym = -512;
    if ( npc->xm > 512 )
      npc->xm = 512;
    if ( npc->xm < -512 )
      npc->xm = -512;
  }
  else
  {
    npc->ym += 32;
    if ( npc->ym > 1535 )
      npc->ym = 1535;
  }
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v3 = npc;
    v4 = (Sint32 *)&v7[16 * npc->ani_no - 192];
  }
  else
  {
    v3 = npc;
    v4 = (Sint32 *)&v7[16 * npc->ani_no - 96];
  }
  npc->rect.left = *v4;
  v3->rect.top = v4[1];
  v3->rect.right = v4[2];
  v3->rect.bottom = v4[3];
}


//----- (0807A9A8) --------------------------------------------------------
void __cdecl ActNpc025(NPCHAR_0 *npc)
{
  unsigned int v1;
  Sint32 *v2;
  RECT rcLeft[2];
  char v4[4];

  rcLeft[0].left = 256;
  rcLeft[0].top = 64;
  rcLeft[0].right = 288;
  rcLeft[0].bottom = 80;
  rcLeft[1].left = 256;
  rcLeft[1].top = 80;
  rcLeft[1].right = 288;
  rcLeft[1].bottom = 96;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      npc->x += 4096;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( ++npc->act_wait > 150 )
      {
        npc->act_wait = 0;
        ++npc->act_no;
      }
      break;
    case 2:
      if ( ++npc->act_wait > 64 )
      {
        npc->act_wait = 0;
        ++npc->act_no;
      }
      else
      {
        npc->y -= 512;
      }
      break;
    case 3:
      if ( ++npc->act_wait > 150 )
      {
        npc->act_wait = 0;
        ++npc->act_no;
      }
      break;
    case 4:
      if ( ++npc->act_wait > 64 )
      {
        npc->act_wait = 0;
        ++npc->act_no;
      }
      else
      {
        npc->y -= 512;
      }
      break;
    case 5:
      if ( ++npc->act_wait > 150 )
      {
        npc->act_wait = 0;
        ++npc->act_no;
      }
      break;
    case 6:
      if ( ++npc->act_wait > 64 )
      {
        npc->act_wait = 0;
        ++npc->act_no;
      }
      else
      {
        npc->y += 512;
      }
      break;
    case 7:
      if ( ++npc->act_wait > 150 )
      {
        npc->act_wait = 0;
        ++npc->act_no;
      }
      break;
    case 8:
      if ( ++npc->act_wait > 64 )
      {
        npc->act_wait = 0;
        npc->act_no = 1;
      }
      else
      {
        npc->y += 512;
      }
      break;
    default:
      break;
  }
  v1 = npc->act_no;
  if ( v1 <= 8 && (1 << v1) & 0x154 )
  {
    if ( ++npc->ani_wait > 1 )
    {
      npc->ani_wait = 0;
      ++npc->ani_no;
    }
    if ( npc->ani_no > 1 )
      npc->ani_no = 0;
  }
  v2 = (Sint32 *)&v4[16 * npc->ani_no - 32];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
}


//----- (0807ACF6) --------------------------------------------------------
void __cdecl ActNpc026(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  NPCHAR_0 *v4;
  Sint32 *v5;
  RECT rect_right[4];
  RECT rect_left[4];
  unsigned __int8 deg;
  char v9[8];

  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    if ( x >= npc->x )
      npc->direct = 2;
    else
      npc->direct = 0;
    if ( npc->tgt_x < npc->x )
      npc->xm -= 16;
    if ( npc->tgt_x > npc->x )
      npc->xm += 16;
    if ( npc->tgt_y < npc->y )
      npc->ym -= 16;
    if ( npc->tgt_y > npc->y )
      npc->ym += 16;
    if ( npc->xm > 512 )
      npc->xm = 512;
    if ( npc->xm < -512 )
      npc->xm = -512;
    if ( npc->ym > 512 )
      npc->ym = 512;
    if ( npc->ym < -512 )
      npc->ym = -512;
    if ( npc->count1 > 119 )
    {
      if ( npc->x - 4096 < x && npc->x + 4096 > x && npc->y < y && npc->y + 49152 > y )
      {
        npc->xm /= 2;
        npc->ym = 0;
        npc->act_no = 3;
        npc->bits &= 0xFFF7u;
      }
    }
    else
    {
      ++npc->count1;
    }
    goto LABEL_35;
  }
  if ( v1 != 3 )
  {
    if ( v1 )
      goto LABEL_35;
    deg = Random(0, 255);
    npc->xm = GetCos(deg);
    deg += 64;
    v2 = npc->x;
    npc->tgt_x = v2 + 8 * GetCos(deg);
    deg = Random(0, 255);
    npc->ym = GetSin(deg);
    deg += 64;
    v3 = npc->y;
    npc->tgt_y = v3 + 8 * GetSin(deg);
    npc->act_no = 1;
    npc->count1 = 120;
    goto LABEL_5;
  }
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  if ( npc->flag & 8 )
  {
    npc->ym = 0;
    npc->xm *= 2;
    npc->count1 = 0;
    npc->act_no = 1;
    npc->bits |= 8u;
  }
LABEL_35:
  npc->x += npc->xm;
  npc->y += npc->ym;
  rect_left[0].left = 32;
  rect_left[0].top = 80;
  rect_left[0].right = 48;
  rect_left[0].bottom = 96;
  rect_left[1].left = 48;
  rect_left[1].top = 80;
  rect_left[1].right = 64;
  rect_left[1].bottom = 96;
  rect_left[2].left = 64;
  rect_left[2].top = 80;
  rect_left[2].right = 80;
  rect_left[2].bottom = 96;
  rect_left[3].left = 80;
  rect_left[3].top = 80;
  rect_left[3].right = 96;
  rect_left[3].bottom = 96;
  rect_right[0].left = 32;
  rect_right[0].top = 96;
  rect_right[0].right = 48;
  rect_right[0].bottom = 112;
  rect_right[1].left = 48;
  rect_right[1].top = 96;
  rect_right[1].right = 64;
  rect_right[1].bottom = 112;
  rect_right[2].left = 64;
  rect_right[2].top = 96;
  rect_right[2].right = 80;
  rect_right[2].bottom = 112;
  rect_right[3].left = 80;
  rect_right[3].top = 96;
  rect_right[3].right = 96;
  rect_right[3].bottom = 112;
  if ( npc->act_no == 3 )
  {
    npc->ani_no = 3;
  }
  else
  {
    if ( ++npc->ani_wait > 1 )
    {
      npc->ani_wait = 0;
      ++npc->ani_no;
    }
    if ( npc->ani_no > 2 )
      npc->ani_no = 0;
  }
  if ( npc->direct )
  {
    v4 = npc;
    v5 = (Sint32 *)&v9[16 * npc->ani_no - 132];
  }
  else
  {
    v4 = npc;
    v5 = (Sint32 *)&v9[16 * npc->ani_no - 68];
  }
  npc->rect.left = *v5;
  v4->rect.top = v5[1];
  v4->rect.right = v5[2];
  v4->rect.bottom = v5[3];
}


//----- (0807B1E5) --------------------------------------------------------
void __cdecl ActNpc027(NPCHAR_0 *npc)
{
  RECT *v1;
  RECT rcLeft[1];

  rcLeft[0].left = 96;
  rcLeft[0].top = 64;
  rcLeft[0].right = 128;
  rcLeft[0].bottom = 88;
  v1 = &rcLeft[npc->ani_no];
  npc->rect.left = v1->left;
  npc->rect.top = v1->top;
  npc->rect.right = v1->right;
  npc->rect.bottom = v1->bottom;
}

//----- (0807B233) --------------------------------------------------------
void __cdecl ActNpc028(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  NPCHAR_0 *v3;
  Sint32 *v4;
  RECT rcRight[6];
  RECT rcLeft[6];
  char v7[24];

  qmemcpy(rcLeft, &ActNpc028(NPCHAR *)::C.3, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc028(NPCHAR *)::C.4, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->y += 1536;
      npc->act_no = 1;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( npc->act_wait <= 7
        || npc->x - 0x10000 >= x
        || npc->x + 0x10000 <= x
        || npc->y - 0x10000 >= y
        || npc->y + 24576 <= y )
      {
        if ( npc->act_wait <= 7 )
          ++npc->act_wait;
        npc->ani_no = 0;
      }
      else
      {
        if ( npc->x <= x )
          npc->direct = 2;
        else
          npc->direct = 0;
        npc->ani_no = 1;
      }
      if ( npc->shock )
      {
        npc->act_no = 2;
        npc->ani_no = 0;
        npc->act_wait = 0;
      }
      if ( npc->act_wait > 7 && npc->x - 49152 < x && npc->x + 49152 > x && npc->y - 49152 < y && npc->y + 24576 > y )
      {
        npc->act_no = 2;
        npc->ani_no = 0;
        npc->act_wait = 0;
      }
      break;
    case 2:
      if ( ++npc->act_wait > 8 )
      {
        npc->act_no = 3;
        npc->ani_no = 2;
        npc->ym = -1228;
        PlaySoundObject(30, 1);
        if ( npc->x <= x )
          npc->direct = 2;
        else
          npc->direct = 0;
        if ( npc->direct )
          npc->xm = 256;
        else
          npc->xm = -256;
      }
      break;
    case 3:
      if ( npc->ym > 256 )
      {
        npc->tgt_y = npc->y;
        npc->act_no = 4;
        npc->ani_no = 3;
        npc->act_wait = 0;
        npc->act_wait = 0;
      }
      break;
    case 4:
      if ( npc->x >= x )
        npc->direct = 0;
      else
        npc->direct = 2;
      ++npc->act_wait;
      if ( npc->flag & 7 || npc->act_wait > 100 )
      {
        npc->damage = 3;
        npc->act_no = 5;
        npc->ani_no = 2;
        npc->xm /= 2;
      }
      else
      {
        if ( npc->act_wait % 4 == 1 )
          PlaySoundObject(109, 1);
        if ( npc->flag & 8 )
          npc->ym = -512;
        if ( ++npc->ani_wait > 0 )
        {
          npc->ani_wait = 0;
          ++npc->ani_no;
        }
        if ( npc->ani_no > 5 )
          npc->ani_no = 3;
      }
      break;
    case 5:
      if ( npc->flag & 8 )
      {
        npc->damage = 2;
        npc->xm = 0;
        npc->act_wait = 0;
        npc->ani_no = 0;
        npc->act_no = 1;
        PlaySoundObject(23, 1);
      }
      break;
    default:
      break;
  }
  if ( npc->act_no == 4 )
  {
    if ( npc->x >= x )
      v1 = npc->xm - 32;
    else
      v1 = npc->xm + 32;
    npc->xm = v1;
    if ( npc->y <= npc->tgt_y )
      v2 = npc->ym + 16;
    else
      v2 = npc->ym - 16;
    npc->ym = v2;
    if ( npc->ym > 512 )
      npc->ym = 512;
    if ( npc->ym < -512 )
      npc->ym = -512;
    if ( npc->xm > 512 )
      npc->xm = 512;
    if ( npc->xm < -512 )
      npc->xm = -512;
  }
  else
  {
    npc->ym += 64;
    if ( npc->ym > 1535 )
      npc->ym = 1535;
  }
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v3 = npc;
    v4 = (Sint32 *)&v7[16 * npc->ani_no - 192];
  }
  else
  {
    v3 = npc;
    v4 = (Sint32 *)&v7[16 * npc->ani_no - 96];
  }
  npc->rect.left = *v4;
  v3->rect.top = v4[1];
  v3->rect.right = v4[2];
  v3->rect.bottom = v4[3];
}


//----- (0807B819) --------------------------------------------------------
void __cdecl ActNpc029(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  RECT *v3;
  RECT rcRight[2];
  RECT rcLeft[2];

  rcLeft[0].left = 0;
  rcLeft[0].top = 192;
  rcLeft[0].right = 16;
  rcLeft[0].bottom = 216;
  rcLeft[1].left = 16;
  rcLeft[1].top = 192;
  rcLeft[1].right = 32;
  rcLeft[1].bottom = 216;
  rcRight[0].left = 0;
  rcRight[0].top = 216;
  rcRight[0].right = 16;
  rcRight[0].bottom = 240;
  rcRight[1].left = 16;
  rcRight[1].top = 216;
  rcRight[1].right = 32;
  rcRight[1].bottom = 240;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_11;
  }
  else
  {
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->ani_wait = 0;
  }
  npc->ani_no = npc->x - 24576 < x && npc->x + 24576 > x && npc->y - 24576 < y && npc->y + 0x2000 > y;
LABEL_11:
  if ( npc->direct )
  {
    v2 = npc;
    v3 = &rcRight[npc->ani_no];
  }
  else
  {
    v2 = npc;
    v3 = &rcLeft[npc->ani_no];
  }
  npc->rect.left = v3->left;
  v2->rect.top = v3->top;
  v2->rect.right = v3->right;
  v2->rect.bottom = v3->bottom;
}

//----- (0807B98D) --------------------------------------------------------
void __cdecl ActNpc030(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT rc[3];
  char v4[8];

  rc[0].left = 48;
  rc[0].top = 0;
  rc[0].right = 64;
  rc[0].bottom = 16;
  rc[1].left = 48;
  rc[1].top = 16;
  rc[1].right = 64;
  rc[1].bottom = 32;
  rc[2].left = 0;
  rc[2].top = 32;
  rc[2].right = 16;
  rc[2].bottom = 48;
  if ( npc->direct )
  {
    if ( !npc->act_no )
    {
      npc->act_no = 1;
      npc->y += 0x2000;
      npc->ani_no = 2;
    }
    if ( ++npc->act_wait > 100 )
    {
      npc->act_wait = 0;
      SetCaret(npc->x, npc->y - 1024, 5, 0);
    }
  }
  else
  {
    v1 = npc->act_no;
    if ( v1 == 1 )
    {
LABEL_6:
      if ( Random(0, 120) == 10 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      goto LABEL_14;
    }
    if ( v1 != 2 )
    {
      if ( v1 )
        goto LABEL_14;
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      goto LABEL_6;
    }
    if ( ++npc->act_wait > 8 )
    {
      npc->act_no = 1;
      npc->ani_no = 0;
    }
  }
LABEL_14:
  v2 = (Sint32 *)&v4[16 * npc->ani_no - 48];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
}


//----- (0807BB60) --------------------------------------------------------
void __cdecl ActNpc031(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  Sint32 *v2;
  RECT rcRight[5];
  RECT rcLeft[5];
  char v5[24];

  qmemcpy(rcLeft, &ActNpc031(NPCHAR *)::C.6, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc031(NPCHAR *)::C.7, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( Random(0, 120) == 10 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      if ( npc->x - 4096 < x && npc->x + 4096 > x && npc->y - 4096 < y && npc->y + 49152 > y )
      {
        npc->ani_no = 0;
        npc->act_no = 3;
      }
      break;
    case 2:
      if ( ++npc->act_wait > 8 )
      {
        npc->act_no = 1;
        npc->ani_no = 0;
      }
      break;
    case 3:
      npc->ani_no = 0;
      if ( npc->shock || npc->x - 10240 > x || npc->x + 10240 < x )
      {
        npc->ani_no = 1;
        npc->ani_wait = 0;
        npc->act_no = 4;
        npc->act_wait = 0;
      }
      break;
    case 4:
      npc->ym += 32;
      if ( npc->ym > 1535 )
        npc->ym = 1535;
      if ( (++npc->act_wait > 19 || npc->flag & 8) && (npc->flag & 8 || npc->y > y - 0x2000) )
      {
        npc->ani_wait = 0;
        npc->ani_no = 2;
        npc->act_no = 5;
        npc->tgt_y = npc->y;
        if ( npc->flag & 8 )
          npc->ym = -512;
      }
      break;
    case 5:
      if ( ++npc->ani_wait > 1 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 4 )
        npc->ani_no = 2;
      if ( x >= npc->x )
        npc->direct = 2;
      else
        npc->direct = 0;
      if ( x < npc->x )
        npc->xm -= 16;
      if ( x > npc->x )
        npc->xm += 16;
      if ( npc->tgt_y < npc->y )
        npc->ym -= 16;
      if ( npc->tgt_y > npc->y )
        npc->ym += 16;
      if ( npc->xm > 512 )
        npc->xm = 512;
      if ( npc->xm < -512 )
        npc->xm = -512;
      if ( npc->ym > 512 )
        npc->ym = 512;
      if ( npc->ym < -512 )
        npc->ym = -512;
      if ( npc->flag & 8 )
        npc->ym = -512;
      if ( npc->flag & 2 )
        npc->ym = 512;
      break;
    default:
      break;
  }
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v1 = npc;
    v2 = (Sint32 *)&v5[16 * npc->ani_no - 160];
  }
  else
  {
    v1 = npc;
    v2 = (Sint32 *)&v5[16 * npc->ani_no - 80];
  }
  npc->rect.left = *v2;
  v1->rect.top = v2[1];
  v1->rect.right = v2[2];
  v1->rect.bottom = v2[3];
}


//----- (0807C009) --------------------------------------------------------
void __cdecl ActNpc032(NPCHAR_0 *npc)
{
  RECT *v1;
  RECT rect[2];

  rect[0].left = 32;
  rect[0].top = 96;
  rect[0].right = 48;
  rect[0].bottom = 112;
  rect[1].left = 48;
  rect[1].top = 96;
  rect[1].right = 64;
  rect[1].bottom = 112;
  if ( ++npc->ani_wait > 2 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 1 )
    npc->ani_no = 0;
  v1 = &rect[npc->ani_no];
  npc->rect.left = v1->left;
  npc->rect.top = v1->top;
  npc->rect.right = v1->right;
  npc->rect.bottom = v1->bottom;
}

//----- (0807C0BB) --------------------------------------------------------
void __cdecl ActNpc033(NPCHAR_0 *npc)
{
  Sint32 *v1;
  RECT rect_left[2];
  char v3[8];

  if ( npc->flag & 5 )
  {
    SetCaret(npc->x, npc->y, 2, 0);
    npc->cond = 0;
  }
  else if ( npc->flag & 8 )
  {
    npc->ym = -1024;
  }
  npc->ym += 42;
  npc->y += npc->ym;
  npc->x += npc->xm;
  rect_left[0].left = 240;
  rect_left[0].top = 64;
  rect_left[0].right = 256;
  rect_left[0].bottom = 80;
  rect_left[1].left = 240;
  rect_left[1].top = 80;
  rect_left[1].right = 256;
  rect_left[1].bottom = 96;
  if ( ++npc->ani_wait > 2 )
  {
    npc->ani_wait = 0;
    if ( ++npc->ani_no > 1 )
      npc->ani_no = 0;
  }
  v1 = (Sint32 *)&v3[16 * npc->ani_no - 32];
  npc->rect.left = *v1;
  npc->rect.top = v1[1];
  npc->rect.right = v1[2];
  npc->rect.bottom = v1[3];
  if ( ++npc->act_wait > 250 )
  {
    SetCaret(npc->x, npc->y, 2, 0);
    npc->cond = 0;
  }
}


//----- (0807C244) --------------------------------------------------------
void __cdecl ActNpc034(NPCHAR_0 *npc)
{
  if ( npc->direct )
  {
    npc->rect.left = 192;
    npc->rect.top = 184;
    npc->rect.right = 224;
    npc->rect.bottom = 200;
  }
  else
  {
    npc->rect.left = 192;
    npc->rect.top = 48;
    npc->rect.right = 224;
    npc->rect.bottom = 64;
  }
}

//----- (0807C2C6) --------------------------------------------------------
void __cdecl ActNpc035(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[4];
  RECT rcLeft[4];
  char v6[8];

  if ( npc->act_no <= 2 && npc->life <= 89 )
  {
    PlaySoundObject(71, 1);
    SetDestroyNpChar(npc->x, npc->y, npc->view.back, 8);
    SetExpObjects(npc->x, npc->y, npc->exp);
    npc->act_no = 3;
    npc->act_wait = 0;
    npc->ani_no = 2;
    npc->bits &= 0xFFDFu;
    npc->damage = 0;
  }
  v1 = npc->act_no;
  if ( v1 == 2 )
  {
    if ( ++npc->act_wait > 20 )
    {
      npc->act_wait = 0;
      npc->act_no = 1;
      npc->ani_no = 0;
    }
  }
  else if ( v1 > 2 )
  {
    if ( v1 == 3 )
    {
      if ( ++npc->act_wait == 50 || npc->act_wait == 60 )
        npc->ani_no = 3;
      if ( npc->act_wait == 53 || npc->act_wait == 63 )
        npc->ani_no = 2;
      if ( npc->act_wait > 100 )
        npc->act_no = 4;
    }
  }
  else if ( v1 >= 0 && npc->shock )
  {
    if ( npc->direct )
      SetNpChar(103, npc->x + 4096, npc->y + 4096, 0, 0, npc->direct, 0, 256);
    else
      SetNpChar(103, npc->x - 4096, npc->y + 4096, 0, 0, npc->direct, 0, 256);
    npc->ani_no = 1;
    npc->act_no = 2;
    npc->act_wait = 0;
  }
  rcLeft[0].left = 96;
  rcLeft[0].top = 64;
  rcLeft[0].right = 120;
  rcLeft[0].bottom = 96;
  rcLeft[1].left = 120;
  rcLeft[1].top = 64;
  rcLeft[1].right = 144;
  rcLeft[1].bottom = 96;
  rcLeft[2].left = 144;
  rcLeft[2].top = 64;
  rcLeft[2].right = 168;
  rcLeft[2].bottom = 96;
  rcLeft[3].left = 168;
  rcLeft[3].top = 64;
  rcLeft[3].right = 192;
  rcLeft[3].bottom = 96;
  rcRight[0].left = 96;
  rcRight[0].top = 96;
  rcRight[0].right = 120;
  rcRight[0].bottom = 128;
  rcRight[1].left = 120;
  rcRight[1].top = 96;
  rcRight[1].right = 144;
  rcRight[1].bottom = 128;
  rcRight[2].left = 144;
  rcRight[2].top = 96;
  rcRight[2].right = 168;
  rcRight[2].bottom = 128;
  rcRight[3].left = 168;
  rcRight[3].top = 96;
  rcRight[3].right = 192;
  rcRight[3].bottom = 128;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 128];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 64];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (0807C69B) --------------------------------------------------------
void __cdecl ActNpc036(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  int v8;
  int v9;
  int v10;
  int v11;
  int v12;
  int v13;
  NPCHAR_0 *v14;
  Sint32 *v15;
  RECT rect_right[6];
  RECT rect_left[6];
  int i;
  unsigned __int8 deg;
  int xm;
  int ym;
  char v22[24];

  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( ++npc->act_wait > 12 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->count1 = 3;
        npc->ani_no = 1;
      }
      break;
    case 2:
      if ( ++npc->act_wait > 16 )
      {
        --npc->count1;
        npc->act_wait = 0;
        deg = GetArktan(npc->x - x, npc->y + 2048 - y);
        deg += Random(-16, 16);
        ym = GetSin(deg);
        xm = GetCos(deg);
        SetNpChar(11, npc->x, npc->y + 2048, xm, ym, 0, 0, 256);
        PlaySoundObject(39, 1);
        if ( !npc->count1 )
        {
          npc->act_no = 3;
          npc->act_wait = 0;
        }
      }
      break;
    case 3:
      if ( ++npc->act_wait > 3 )
      {
        npc->act_no = 4;
        npc->act_wait = 0;
        npc->xm = (x - npc->x) / 100;
        npc->ym = -1536;
        npc->ani_no = 3;
      }
      break;
    case 4:
      if ( npc->ym >= -511 )
      {
        if ( npc->life <= 60 )
        {
          npc->act_no = 6;
        }
        else
        {
          npc->act_no = 5;
          npc->ani_no = 4;
          npc->ani_wait = 0;
          npc->act_wait = 0;
          npc->tgt_y = npc->y;
        }
      }
      break;
    case 5:
      if ( ++npc->ani_wait > 1 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 5 )
      {
        npc->ani_no = 4;
        PlaySoundObject(47, 1);
      }
      if ( ++npc->act_wait > 100 )
      {
        npc->act_no = 6;
        npc->ani_no = 3;
      }
      if ( npc->y >= npc->tgt_y )
        v1 = npc->ym - 64;
      else
        v1 = npc->ym + 64;
      npc->ym = v1;
      if ( npc->ym < -512 )
        npc->ym = -512;
      if ( npc->ym > 512 )
        npc->ym = 512;
      break;
    case 6:
      if ( npc->y + 0x2000 >= y )
        npc->damage = 0;
      else
        npc->damage = 10;
      if ( npc->flag & 8 )
      {
        npc->act_no = 7;
        npc->act_wait = 0;
        npc->ani_no = 2;
        PlaySoundObject(26, 1);
        PlaySoundObject(25, 1);
        SetQuake(30);
        npc->damage = 0;
        for ( i = 0; i <= 7; ++i )
        {
          v2 = Random(-1536, 0);
          v3 = Random(-341, 341);
          v4 = npc->y;
          v5 = (Random(-12, 12) << 9) + v4;
          v6 = npc->x;
          v7 = Random(-12, 12);
          SetNpChar(4, v6 + (v7 << 9), v5, v3, v2, 0, 0, 256);
        }
        for ( i = 0; i <= 7; ++i )
        {
          v8 = Random(-1024, 0);
          v9 = Random(-1024, 1024);
          v10 = npc->y;
          v11 = (Random(-12, 12) << 9) + v10;
          v12 = npc->x;
          v13 = Random(-12, 12);
          SetNpChar(33, v12 + (v13 << 9), v11, v9, v8, 0, 0, 256);
        }
      }
      break;
    case 7:
      npc->xm = 0;
      if ( ++npc->act_wait > 3 )
      {
        npc->act_no = 1;
        npc->act_wait = 0;
      }
      break;
    default:
      break;
  }
  if ( npc->act_no != 5 )
  {
    npc->ym += 51;
    if ( npc->x >= x )
      npc->direct = 0;
    else
      npc->direct = 2;
  }
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  qmemcpy(rect_left, &ActNpc036(NPCHAR *)::C.12, sizeof(rect_left));
  qmemcpy(rect_right, &ActNpc036(NPCHAR *)::C.13, sizeof(rect_right));
  if ( npc->direct )
  {
    v14 = npc;
    v15 = (Sint32 *)&v22[16 * npc->ani_no - 208];
  }
  else
  {
    v14 = npc;
    v15 = (Sint32 *)&v22[16 * npc->ani_no - 112];
  }
  npc->rect.left = *v15;
  v14->rect.top = v15[1];
  v14->rect.right = v15[2];
  v14->rect.bottom = v15[3];
}


//----- (0807CDA1) --------------------------------------------------------
void __cdecl ActNpc037(NPCHAR_0 *npc)
{
  RECT *v1;
  RECT rect[2];

  rect[0].left = 192;
  rect[0].top = 64;
  rect[0].right = 208;
  rect[0].bottom = 80;
  rect[1].left = 208;
  rect[1].top = 64;
  rect[1].right = 224;
  rect[1].bottom = 80;
  if ( ++npc->ani_wait > 1 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 1 )
    npc->ani_no = 0;
  v1 = &rect[npc->ani_no];
  npc->rect.left = v1->left;
  npc->rect.top = v1->top;
  npc->rect.right = v1->right;
  npc->rect.bottom = v1->bottom;
}

//----- (0807CE53) --------------------------------------------------------
void __cdecl ActNpc038(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT rect[4];
  char v4[8];

  rect[0].left = 128;
  rect[0].top = 64;
  rect[0].right = 144;
  rect[0].bottom = 80;
  rect[1].left = 144;
  rect[1].top = 64;
  rect[1].right = 160;
  rect[1].bottom = 80;
  rect[2].left = 160;
  rect[2].top = 64;
  rect[2].right = 176;
  rect[2].bottom = 80;
  rect[3].left = 176;
  rect[3].top = 64;
  rect[3].right = 192;
  rect[3].bottom = 80;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 < 0 )
      return;
    if ( v1 == 10 )
    {
      npc->act_no = 11;
      SetDestroyNpChar(npc->x, npc->y, npc->view.back, 8);
    }
    else if ( v1 != 11 )
    {
      return;
    }
    npc->rect.left = 0;
    npc->rect.right = 0;
    return;
  }
  if ( ++npc->ani_wait > 3 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 3 )
    npc->ani_no = 0;
  v2 = (Sint32 *)&v4[16 * npc->ani_no - 64];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
}


//----- (0807CFB5) --------------------------------------------------------
void __cdecl ActNpc039(NPCHAR_0 *npc)
{
  RECT *v1;
  RECT rect[2];

  rect[0].left = 224;
  rect[0].top = 64;
  rect[0].right = 240;
  rect[0].bottom = 80;
  rect[1].left = 240;
  rect[1].top = 64;
  rect[1].right = 256;
  rect[1].bottom = 80;
  if ( npc->direct )
    npc->ani_no = 1;
  else
    npc->ani_no = 0;
  v1 = &rect[npc->ani_no];
  npc->rect.left = v1->left;
  npc->rect.top = v1->top;
  npc->rect.right = v1->right;
  npc->rect.bottom = v1->bottom;
}

//----- (0807D040) --------------------------------------------------------
void __cdecl ActNpc040(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[7];
  RECT rcLeft[7];
  char v6[24];

  qmemcpy(rcLeft, &ActNpc040(NPCHAR *)::C.0, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc040(NPCHAR *)::C.1, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( Random(0, 120) == 10 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      if ( npc->x - 0x4000 < x && npc->x + 0x4000 > x && npc->y - 0x4000 < y && npc->y + 0x2000 > y )
      {
        if ( npc->x <= x )
          npc->direct = 2;
        else
          npc->direct = 0;
      }
      break;
    case 2:
      if ( ++npc->act_wait > 8 )
      {
        npc->act_no = 1;
        npc->ani_no = 0;
      }
      break;
    case 3:
      npc->act_no = 4;
      npc->ani_no = 2;
      npc->ani_wait = 0;
      goto LABEL_15;
    case 4:
LABEL_15:
      if ( ++npc->ani_wait > 4 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 5 )
        npc->ani_no = 2;
      if ( npc->direct )
        v1 = npc->x + 512;
      else
        v1 = npc->x - 512;
      npc->x = v1;
      break;
    case 5:
      npc->ani_no = 6;
      break;
    default:
      break;
  }
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 224];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 112];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (0807D2D9) --------------------------------------------------------
void __cdecl ActNpc041(NPCHAR_0 *npc)
{
  if ( !npc->act_no )
  {
    ++npc->act_no;
    npc->y -= 0x2000;
  }
  npc->rect.left = 0;
  npc->rect.top = 80;
  npc->rect.right = 48;
  npc->rect.bottom = 112;
}

//----- (0807D343) --------------------------------------------------------
void __cdecl ActNpc042(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[13];
  RECT rcLeft[13];
  int n;
  char v7[24];

  qmemcpy(rcLeft, &ActNpc042(NPCHAR *)::C.3, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc042(NPCHAR *)::C.4, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      npc->xm = 0;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( Random(0, 120) == 10 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      break;
    case 2:
      if ( ++npc->act_wait > 8 )
      {
        npc->act_no = 1;
        npc->ani_no = 0;
      }
      break;
    case 3:
      npc->act_no = 4;
      npc->ani_no = 2;
      npc->ani_wait = 0;
      goto LABEL_8;
    case 4:
LABEL_8:
      if ( ++npc->ani_wait > 4 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 5 )
        npc->ani_no = 2;
      if ( npc->direct )
        npc->xm = 512;
      else
        npc->xm = -512;
      break;
    case 5:
      npc->ani_no = 6;
      npc->xm = 0;
      break;
    case 6:
      PlaySoundObject(50, 1);
      npc->act_wait = 0;
      npc->act_no = 7;
      npc->ani_no = 7;
      goto LABEL_17;
    case 7:
LABEL_17:
      if ( ++npc->act_wait > 10 )
        npc->act_no = 0;
      break;
    case 8:
      PlaySoundObject(50, 1);
      npc->act_wait = 0;
      npc->act_no = 9;
      npc->ani_no = 7;
      npc->ym = -512;
      if ( npc->direct )
        npc->xm = -1024;
      else
        npc->xm = 1024;
      goto LABEL_22;
    case 9:
LABEL_22:
      if ( ++npc->act_wait > 3 && npc->flag & 8 )
      {
        npc->act_no = 10;
        if ( npc->direct )
          npc->direct = 0;
        else
          npc->direct = 2;
      }
      break;
    case 0xA:
      npc->xm = 0;
      npc->ani_no = 8;
      break;
    case 0xB:
      npc->act_no = 12;
      npc->act_wait = 0;
      npc->ani_no = 9;
      npc->ani_wait = 0;
      npc->xm = 0;
      goto LABEL_29;
    case 0xC:
LABEL_29:
      if ( ++npc->ani_wait > 8 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 10 )
        npc->ani_no = 9;
      break;
    case 0xD:
      npc->ani_no = 11;
      npc->xm = 0;
      npc->ym = 0;
      npc->act_no = 14;
      for ( n = 0; n <= 511 && gNPC[n].code_event != 501; ++n )
        ;
      if ( n == 512 )
      {
        npc->act_no = 0;
      }
      else
      {
        npc->pNpc = &gNPC[n];
LABEL_40:
        if ( npc->pNpc->direct )
          npc->direct = 0;
        else
          npc->direct = 2;
        if ( npc->pNpc->direct )
          v1 = npc->pNpc->x + 3072;
        else
          v1 = npc->pNpc->x - 3072;
        npc->x = v1;
        npc->y = npc->pNpc->y + 2048;
        if ( npc->pNpc->ani_no == 2 || npc->pNpc->ani_no == 4 )
          npc->y -= 512;
      }
      break;
    case 0xE:
      goto LABEL_40;
    case 0xF:
      npc->act_no = 16;
      SetNpChar(257, npc->x + 0x10000, npc->y, 0, 0, 0, 0, 0);
      SetNpChar(257, npc->x + 0x10000, npc->y, 0, 0, 2, 0, 128);
      npc->xm = 0;
      npc->ani_no = 0;
      goto LABEL_50;
    case 0x10:
LABEL_50:
      gSuperXpos = npc->x - 12288;
      gSuperYpos = npc->y - 4096;
      break;
    case 0x11:
      npc->xm = 0;
      npc->ani_no = 12;
      gSuperXpos = npc->x;
      gSuperYpos = npc->y - 4096;
      break;
    case 0x14:
      npc->act_no = 21;
      npc->ani_no = 2;
      npc->ani_wait = 0;
      goto LABEL_53;
    case 0x15:
LABEL_53:
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 5 )
        npc->ani_no = 2;
      if ( npc->direct )
        npc->xm = 1024;
      else
        npc->xm = -1024;
      if ( npc->x < x - 4096 )
      {
        npc->direct = 2;
        npc->act_no = 0;
      }
      break;
    case 0x1E:
      npc->act_no = 31;
      npc->ani_no = 2;
      npc->ani_wait = 0;
      goto LABEL_63;
    case 0x1F:
LABEL_63:
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 5 )
        npc->ani_no = 2;
      if ( npc->direct )
        npc->xm = 1024;
      else
        npc->xm = -1024;
      break;
    case 0x28:
      npc->act_no = 41;
      npc->ani_no = 9;
      npc->ym = -1024;
      break;
    default:
      break;
  }
  if ( npc->act_no != 14 )
  {
    npc->ym += 64;
    if ( npc->xm > 1024 )
      npc->xm = 1024;
    if ( npc->xm < -1024 )
      npc->xm = -1024;
    if ( npc->ym > 1535 )
      npc->ym = 1535;
    npc->x += npc->xm;
    npc->y += npc->ym;
  }
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v7[16 * npc->ani_no - 420];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v7[16 * npc->ani_no - 212];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (0807DB69) --------------------------------------------------------
void __cdecl ActNpc043(NPCHAR_0 *npc)
{
  if ( !npc->act_no )
  {
    npc->act_no = 1;
    npc->y -= 0x2000;
  }
  if ( npc->direct )
  {
    npc->rect.left = 168;
    npc->rect.top = 80;
    npc->rect.right = 208;
  }
  else
  {
    npc->rect.left = 128;
    npc->rect.top = 80;
    npc->rect.right = 168;
  }
  npc->rect.bottom = 112;
}

//----- (0807DC11) --------------------------------------------------------
void __cdecl ActNpc044(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  NPCHAR_0 *v3;
  Sint32 *v4;
  RECT rcLeft[3];
  RECT rcRight[3];
  int i;
  char v8[8];

  rcRight[0].left = 0;
  rcRight[0].top = 0;
  rcRight[0].right = 32;
  rcRight[0].bottom = 32;
  rcRight[1].left = 32;
  rcRight[1].top = 0;
  rcRight[1].right = 64;
  rcRight[1].bottom = 32;
  rcRight[2].left = 64;
  rcRight[2].top = 0;
  rcRight[2].right = 96;
  rcRight[2].bottom = 32;
  rcLeft[0].left = 0;
  rcLeft[0].top = 0;
  rcLeft[0].right = 32;
  rcLeft[0].bottom = 32;
  rcLeft[1].left = 96;
  rcLeft[1].top = 0;
  rcLeft[1].right = 128;
  rcLeft[1].bottom = 32;
  rcLeft[2].left = 128;
  rcLeft[2].top = 0;
  rcLeft[2].right = 160;
  rcLeft[2].bottom = 32;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      goto LABEL_3;
    case 1:
LABEL_3:
      npc->ani_no = 0;
      if ( npc->direct )
        npc->act_no = 2;
      else
        npc->act_no = 8;
      goto LABEL_6;
    case 2:
LABEL_6:
      npc->ym += 32;
      if ( npc->ym > 0 && npc->flag & 8 )
      {
        npc->ym = -256;
        npc->xm += 256;
      }
      if ( npc->flag & 4 )
        npc->act_no = 3;
      break;
    case 3:
      npc->xm += 32;
      if ( npc->xm > 0 && npc->flag & 4 )
      {
        npc->xm = -256;
        npc->ym -= 256;
      }
      if ( npc->flag & 2 )
        npc->act_no = 4;
      break;
    case 4:
      npc->ym -= 32;
      if ( npc->ym < 0 && npc->flag & 2 )
      {
        npc->ym = 256;
        npc->xm -= 256;
      }
      if ( npc->flag & 1 )
        npc->act_no = 5;
      break;
    case 5:
      npc->xm -= 32;
      if ( npc->xm < 0 && npc->flag & 1 )
      {
        npc->xm = 256;
        npc->ym += 256;
      }
      if ( npc->flag & 8 )
        npc->act_no = 2;
      break;
    case 6:
      npc->ym += 32;
      if ( npc->ym > 0 && npc->flag & 8 )
      {
        npc->ym = -256;
        npc->xm -= 256;
      }
      if ( npc->flag & 1 )
        npc->act_no = 7;
      break;
    case 7:
      npc->xm -= 32;
      if ( npc->xm < 0 && npc->flag & 1 )
      {
        npc->xm = 256;
        npc->ym -= 256;
      }
      if ( npc->flag & 2 )
        npc->act_no = 8;
      break;
    case 8:
      npc->ym -= 32;
      if ( npc->ym < 0 && npc->flag & 2 )
      {
        npc->ym = 256;
        npc->xm += 256;
      }
      if ( npc->flag & 4 )
        npc->act_no = 9;
      break;
    case 9:
      npc->xm += 32;
      if ( npc->xm > 0 && npc->flag & 4 )
      {
        npc->xm = -256;
        npc->ym += 256;
      }
      if ( npc->flag & 8 )
        npc->act_no = 6;
      break;
    default:
      break;
  }
  if ( npc->life <= 100 )
  {
    for ( i = 0; i <= 9; ++i )
      SetNpChar(45, npc->x, npc->y, 0, 0, 0, 0, 256);
    SetDestroyNpChar(npc->x, npc->y, npc->view.back, 8);
    PlaySoundObject(25, 1);
    npc->cond = 0;
  }
  if ( npc->xm > 512 )
    npc->xm = 512;
  if ( npc->xm < -512 )
    npc->xm = -512;
  if ( npc->ym > 512 )
    npc->ym = 512;
  if ( npc->ym < -512 )
    npc->ym = -512;
  if ( npc->shock )
  {
    npc->x += npc->xm / 2;
    v1 = npc->y;
    v2 = npc->ym / 2;
  }
  else
  {
    npc->x += npc->xm;
    v1 = npc->y;
    v2 = npc->ym;
  }
  npc->y = v2 + v1;
  if ( npc->act_no > 1 && npc->act_no <= 9 && ++npc->ani_no > 2 )
    npc->ani_no = 1;
  if ( npc->direct )
  {
    v3 = npc;
    v4 = (Sint32 *)&v8[16 * npc->ani_no - 52];
  }
  else
  {
    v3 = npc;
    v4 = (Sint32 *)&v8[16 * npc->ani_no - 100];
  }
  npc->rect.left = *v4;
  v3->rect.top = v4[1];
  v3->rect.right = v4[2];
  v3->rect.bottom = v4[3];
}


//----- (0807E249) --------------------------------------------------------
void __cdecl ActNpc045(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  Sint32 *v6;
  RECT rect[3];
  char v8[8];

  rect[0].left = 0;
  rect[0].top = 32;
  rect[0].right = 16;
  rect[0].bottom = 48;
  rect[1].left = 16;
  rect[1].top = 32;
  rect[1].right = 32;
  rect[1].bottom = 48;
  rect[2].left = 32;
  rect[2].top = 32;
  rect[2].right = 48;
  rect[2].bottom = 48;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 < 0 || v1 > 2 )
      goto LABEL_14;
  }
  else
  {
    npc->act_no = 2;
    if ( Random(0, 1) != 0 )
      v2 = Random(-512, -256);
    else
      v2 = Random(256, 512);
    npc->xm = v2;
    if ( Random(0, 1) != 0 )
      v3 = Random(-512, -256);
    else
      v3 = Random(256, 512);
    npc->ym = v3;
    npc->xm2 = npc->xm;
    npc->ym2 = npc->ym;
  }
  if ( ++npc->ani_no > 2 )
    npc->ani_no = 1;
LABEL_14:
  if ( npc->xm2 < 0 && npc->flag & 1 )
    npc->xm2 = -npc->xm2;
  if ( npc->xm2 > 0 && npc->flag & 4 )
    npc->xm2 = -npc->xm2;
  if ( npc->ym2 < 0 && npc->flag & 2 )
    npc->ym2 = -npc->ym2;
  if ( npc->ym2 > 0 && npc->flag & 8 )
    npc->ym2 = -npc->ym2;
  if ( npc->xm2 > 512 )
    npc->xm2 = 512;
  if ( npc->xm2 < -512 )
    npc->xm2 = -512;
  if ( npc->ym2 > 512 )
    npc->ym2 = 512;
  if ( npc->ym2 < -512 )
    npc->ym2 = -512;
  if ( npc->shock )
  {
    npc->x += npc->xm2 / 2;
    v4 = npc->y;
    v5 = npc->ym2 / 2;
  }
  else
  {
    npc->x += npc->xm2;
    v4 = npc->y;
    v5 = npc->ym2;
  }
  npc->y = v5 + v4;
  v6 = (Sint32 *)&v8[16 * npc->ani_no - 48];
  npc->rect.left = *v6;
  npc->rect.top = v6[1];
  npc->rect.right = v6[2];
  npc->rect.bottom = v6[3];
}


//----- (0807E549) --------------------------------------------------------
void __cdecl ActNpc046(NPCHAR_0 *npc)
{
  unsigned __int16 v1;
  int v2;
  int v3;

  v1 = npc->bits;
  HIBYTE(v1) |= 1u;
  npc->bits = v1;
  if ( npc->direct )
  {
    if ( npc->y >= y )
      v3 = npc->y - 1535;
    else
      v3 = npc->y + 1535;
    npc->y = v3;
  }
  else
  {
    if ( npc->x >= x )
      v2 = npc->x - 1535;
    else
      v2 = npc->x + 1535;
    npc->x = v2;
  }
  npc->rect.left = 0;
  npc->rect.top = 0;
  npc->rect.right = 16;
  npc->rect.bottom = 16;
}

//----- (0807E611) --------------------------------------------------------
void __cdecl ActNpc047(NPCHAR_0 *npc)
{
  Sint32 *v1;
  RECT rect[5];
  char v3[24];

  switch ( npc->act_no )
  {
    case 0:
      npc->ani_no = 0;
      npc->act_no = 1;
      npc->act_wait = 0;
      npc->tgt_y = npc->y;
      npc->bits &= 0xFFDFu;
      npc->bits &= 0xFFFBu;
      npc->bits &= 0xFFFEu;
      npc->bits &= 0xFFF7u;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( x > npc->x - 4096 && x < npc->x + 4096 && y > npc->y && y < npc->y + 4096 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        PlaySoundObject(102, 1);
      }
      if ( npc->x < x )
        npc->x += 1024;
      if ( npc->x > x )
        npc->x -= 1024;
      break;
    case 2:
      if ( ++npc->ani_wait > 3 )
      {
        ++npc->ani_no;
        npc->ani_wait = 0;
      }
      if ( npc->ani_no == 3 )
        npc->damage = 10;
      if ( npc->ani_no == 4 )
      {
        npc->bits |= 0x20u;
        npc->act_no = 3;
        npc->act_wait = 0;
      }
      break;
    case 3:
      npc->bits |= 1u;
      npc->damage = 0;
      ++npc->act_wait;
      if ( npc->shock )
      {
        npc->act_no = 4;
        npc->act_wait = 0;
      }
      break;
    case 4:
      npc->bits |= 8u;
      npc->y += 512;
      if ( ++npc->act_wait == 32 )
      {
        npc->bits &= 0xFFFEu;
        npc->bits &= 0xFFDFu;
        npc->act_no = 5;
        npc->act_wait = 0;
      }
      break;
    case 5:
      if ( npc->act_wait > 99 )
      {
        npc->y = npc->tgt_y;
        npc->ani_no = 0;
        npc->act_no = 0;
      }
      else
      {
        ++npc->act_wait;
      }
      break;
    default:
      break;
  }
  qmemcpy(rect, &ActNpc047(NPCHAR *)::C.14, sizeof(rect));
  v1 = (Sint32 *)&v3[16 * npc->ani_no - 80];
  npc->rect.left = *v1;
  npc->rect.top = v1[1];
  npc->rect.right = v1[2];
  npc->rect.bottom = v1[3];
}


//----- (0807E95A) --------------------------------------------------------
void __cdecl ActNpc048(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  Sint32 *v2;
  RECT rcRight[2];
  RECT rcLeft[2];
  char v5[8];

  if ( npc->flag & 1 && npc->xm < 0 )
  {
    npc->xm = -npc->xm;
  }
  else if ( npc->flag & 4 && npc->xm > 0 )
  {
    npc->xm = -npc->xm;
  }
  else if ( npc->flag & 8 )
  {
    if ( ++npc->count1 <= 2 && npc->direct != 2 )
    {
      npc->ym = -256;
    }
    else
    {
      VanishNpChar(npc);
      SetCaret(npc->x, npc->y, 2, 0);
    }
  }
  if ( npc->direct == 2 )
  {
    npc->bits &= 0xFFDFu;
    npc->bits |= 4u;
  }
  npc->ym += 5;
  npc->y += npc->ym;
  npc->x += npc->xm;
  rcLeft[0].left = 288;
  rcLeft[0].top = 88;
  rcLeft[0].right = 304;
  rcLeft[0].bottom = 104;
  rcLeft[1].left = 304;
  rcLeft[1].top = 88;
  rcLeft[1].right = 320;
  rcLeft[1].bottom = 104;
  rcRight[0].left = 288;
  rcRight[0].top = 104;
  rcRight[0].right = 304;
  rcRight[0].bottom = 120;
  rcRight[1].left = 304;
  rcRight[1].top = 104;
  rcRight[1].right = 320;
  rcRight[1].bottom = 120;
  if ( ++npc->ani_wait > 2 )
  {
    npc->ani_wait = 0;
    if ( ++npc->ani_no > 1 )
      npc->ani_no = 0;
  }
  if ( ++npc->act_wait > 750 )
  {
    SetCaret(npc->x, npc->y, 2, 0);
    npc->cond = 0;
  }
  if ( npc->direct )
  {
    v1 = npc;
    v2 = (Sint32 *)&v5[16 * npc->ani_no - 64];
  }
  else
  {
    v1 = npc;
    v2 = (Sint32 *)&v5[16 * npc->ani_no - 32];
  }
  npc->rect.left = *v2;
  v1->rect.top = v2[1];
  v1->rect.right = v2[2];
  v1->rect.bottom = v2[3];
}


//----- (0807EBF6) --------------------------------------------------------
void __cdecl ActNpc049(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  Sint32 *v2;
  RECT rcRight[3];
  RECT rcLeft[3];
  unsigned __int8 deg;
  int xm;
  int ym;
  char v8[8];

  if ( npc->act_no > 9 && npc->pNpc->code_char == 3 )
  {
    npc->act_no = 3;
    npc->xm = 0;
    npc->ym = 0;
    npc->count2 = 1;
  }
  if ( npc->flag & 1 )
  {
    npc->direct = 2;
    npc->xm = 256;
  }
  if ( npc->flag & 4 )
  {
    npc->direct = 0;
    npc->xm = -256;
  }
  switch ( npc->act_no )
  {
    case 0:
      if ( npc->pNpc )
        npc->act_no = 10;
      else
        npc->act_no = 1;
      goto LABEL_12;
    case 1:
LABEL_12:
      if ( ++npc->act_wait > 3 )
      {
        npc->ym = -1024;
        npc->act_no = 3;
        npc->ani_no = 2;
        if ( npc->count2 )
        {
          if ( npc->direct )
            npc->xm = 512;
          else
            npc->xm = -512;
        }
        else if ( npc->direct )
        {
          npc->xm = 256;
        }
        else
        {
          npc->xm = -256;
        }
      }
      npc->ani_no = 1;
      break;
    case 3:
      if ( npc->flag & 8 )
      {
        npc->act_no = 1;
        npc->act_wait = 0;
        npc->xm = 0;
      }
      if ( npc->flag & 8 || npc->ym > 0 )
        npc->ani_no = 1;
      else
        npc->ani_no = 2;
      break;
    case 0xA:
      if ( npc->count1 > 49 )
      {
        if ( npc->x - 0x10000 < x && npc->x + 0x10000 > x && npc->y - 49152 < y && npc->y + 49152 > y )
        {
          npc->act_no = 11;
          npc->act_wait = 0;
          npc->ani_no = 2;
        }
      }
      else
      {
        ++npc->count1;
      }
      break;
    case 0xB:
      if ( ++npc->act_wait == 30 || npc->act_wait == 35 )
      {
        deg = GetArktan(npc->x - x, npc->y + 2048 - y);
        ym = 2 * GetSin(deg);
        xm = 2 * GetCos(deg);
        SetNpChar(50, npc->x, npc->y, xm, ym, 0, 0, 256);
        PlaySoundObject(39, 1);
      }
      if ( npc->act_wait > 50 )
      {
        npc->count1 = 0;
        npc->act_no = 10;
        npc->ani_no = 1;
      }
      break;
    default:
      break;
  }
  if ( npc->act_no > 9 )
  {
    npc->x = npc->pNpc->x;
    npc->y = npc->pNpc->y + 0x2000;
    npc->direct = npc->pNpc->direct;
    --npc->pNpc->count1;
  }
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  rcLeft[0].left = 0;
  rcLeft[0].top = 80;
  rcLeft[0].right = 32;
  rcLeft[0].bottom = 104;
  rcLeft[1].left = 32;
  rcLeft[1].top = 80;
  rcLeft[1].right = 64;
  rcLeft[1].bottom = 104;
  rcLeft[2].left = 64;
  rcLeft[2].top = 80;
  rcLeft[2].right = 96;
  rcLeft[2].bottom = 104;
  rcRight[0].left = 0;
  rcRight[0].top = 104;
  rcRight[0].right = 32;
  rcRight[0].bottom = 128;
  rcRight[1].left = 32;
  rcRight[1].top = 104;
  rcRight[1].right = 64;
  rcRight[1].bottom = 128;
  rcRight[2].left = 64;
  rcRight[2].top = 104;
  rcRight[2].right = 96;
  rcRight[2].bottom = 128;
  if ( npc->direct )
  {
    v1 = npc;
    v2 = (Sint32 *)&v8[16 * npc->ani_no - 108];
  }
  else
  {
    v1 = npc;
    v2 = (Sint32 *)&v8[16 * npc->ani_no - 60];
  }
  npc->rect.left = *v2;
  v1->rect.top = v2[1];
  v1->rect.right = v2[2];
  v1->rect.bottom = v2[3];
}


//----- (0807F124) --------------------------------------------------------
void __cdecl ActNpc050(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT rect[4];
  char v4[8];

  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_6:
    npc->x += npc->xm;
    npc->y += npc->ym;
    if ( npc->flag & 1 )
    {
      npc->act_no = 2;
      npc->xm = 512;
      ++npc->count1;
    }
    if ( npc->flag & 4 )
    {
      npc->act_no = 2;
      npc->xm = -512;
      ++npc->count1;
    }
    if ( npc->flag & 2 )
    {
      npc->act_no = 2;
      npc->ym = 512;
      ++npc->count1;
    }
    if ( npc->flag & 8 )
    {
      npc->act_no = 2;
      npc->ym = -512;
      ++npc->count1;
    }
    goto LABEL_17;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_17;
    if ( npc->direct == 2 )
      npc->act_no = 2;
    goto LABEL_6;
  }
  npc->ym += 64;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->flag & 8 )
  {
    if ( ++npc->count1 > 1 )
    {
      SetCaret(npc->x, npc->y, 2, 0);
      npc->cond = 0;
    }
  }
LABEL_17:
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  if ( npc->ym < -1535 )
    npc->ym = -1535;
  rect[0].left = 48;
  rect[0].top = 32;
  rect[0].right = 64;
  rect[0].bottom = 48;
  rect[1].left = 64;
  rect[1].top = 32;
  rect[1].right = 80;
  rect[1].bottom = 48;
  rect[2].left = 80;
  rect[2].top = 32;
  rect[2].right = 96;
  rect[2].bottom = 48;
  rect[3].left = 96;
  rect[3].top = 32;
  rect[3].right = 112;
  rect[3].bottom = 48;
  if ( npc->direct )
  {
    if ( ++npc->ani_wait > 1 )
    {
      npc->ani_wait = 0;
      --npc->ani_no;
    }
    if ( npc->ani_no < 0 )
      npc->ani_no = 3;
  }
  else
  {
    if ( ++npc->ani_wait > 1 )
    {
      npc->ani_wait = 0;
      ++npc->ani_no;
    }
    if ( npc->ani_no > 3 )
      npc->ani_no = 0;
  }
  v2 = (Sint32 *)&v4[16 * npc->ani_no - 64];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
}


//----- (0807F445) --------------------------------------------------------
void __cdecl ActNpc051(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  NPCHAR_0 *v3;
  Sint32 *v4;
  RECT rect_right[5];
  RECT rect_left[5];
  char v7[24];

  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_9:
    if ( x >= npc->x )
      npc->direct = 2;
    else
      npc->direct = 0;
    if ( npc->tgt_y < npc->y )
      npc->ym -= 10;
    if ( npc->tgt_y > npc->y )
      npc->ym += 10;
    if ( npc->ym > 512 )
      npc->ym = 512;
    if ( npc->ym < -512 )
      npc->ym = -512;
    if ( npc->count1 > 9 )
      npc->act_no = 2;
    else
      ++npc->count1;
    goto LABEL_41;
  }
  if ( v1 != 2 )
  {
    if ( v1 || npc->x - 163840 >= x || npc->x + 163840 <= x || npc->y - 163840 >= y || npc->y + 163840 <= y )
      goto LABEL_41;
    npc->tgt_x = npc->x;
    npc->tgt_y = npc->y;
    v2 = npc->direct;
    npc->ym = 1024;
    npc->act_no = 1;
    SetNpChar(49, 0, 0, 0, 0, 0, npc, 0);
    goto LABEL_9;
  }
  if ( x >= npc->x )
    npc->direct = 2;
  else
    npc->direct = 0;
  if ( npc->y <= y + 0x4000 )
  {
    if ( x < npc->x )
      npc->xm -= 16;
    if ( x > npc->x )
      npc->xm += 16;
  }
  else
  {
    if ( x < npc->x )
      npc->xm += 16;
    if ( x > npc->x )
      npc->xm -= 16;
  }
  if ( y < npc->y )
    npc->ym -= 16;
  if ( y > npc->y )
    npc->ym += 16;
  if ( npc->shock )
  {
    npc->ym += 32;
    npc->xm = 0;
  }
LABEL_41:
  if ( npc->xm < 0 && npc->flag & 1 )
    npc->xm = 256;
  if ( npc->xm > 0 && npc->flag & 4 )
    npc->xm = -256;
  if ( npc->ym < 0 && npc->flag & 2 )
    npc->ym = 256;
  if ( npc->ym > 0 && npc->flag & 8 )
    npc->ym = -256;
  if ( npc->xm > 1024 )
    npc->xm = 1024;
  if ( npc->xm < -1024 )
    npc->xm = -1024;
  if ( npc->ym > 512 )
    npc->ym = 512;
  if ( npc->ym < -512 )
    npc->ym = -512;
  npc->x += npc->xm;
  npc->y += npc->ym;
  qmemcpy(rect_left, &ActNpc051(NPCHAR *)::C.16, sizeof(rect_left));
  qmemcpy(rect_right, &ActNpc051(NPCHAR *)::C.17, sizeof(rect_right));
  if ( npc->shock )
  {
    npc->ani_no = 4;
  }
  else if ( npc->act_no != 2 || npc->y >= y - 0x4000 )
  {
    if ( npc->act_no )
    {
      if ( ++npc->ani_wait > 1 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 1 )
        npc->ani_no = 0;
    }
  }
  else
  {
    npc->ani_no = 0;
  }
  if ( npc->direct )
  {
    v3 = npc;
    v4 = (Sint32 *)&v7[16 * npc->ani_no - 160];
  }
  else
  {
    v3 = npc;
    v4 = (Sint32 *)&v7[16 * npc->ani_no - 80];
  }
  npc->rect.left = *v4;
  v3->rect.top = v4[1];
  v3->rect.right = v4[2];
  v3->rect.bottom = v4[3];
}


//----- (0807F989) --------------------------------------------------------
void __cdecl ActNpc052(NPCHAR_0 *npc)
{
  npc->rect.left = 240;
  npc->rect.top = 96;
  npc->rect.right = 256;
  npc->rect.bottom = 112;
}

//----- (0807F9C8) --------------------------------------------------------
void __cdecl ActNpc053(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR *v2;
  int v3;
  int v4;
  int v5;
  NPCHAR_0 *v6;
  Sint32 *v7;
  RECT rcRight[2];
  RECT rcLeft[2];
  unsigned __int8 deg;
  char v11[8];

  rcLeft[0].left = 0;
  rcLeft[0].top = 128;
  rcLeft[0].right = 24;
  rcLeft[0].bottom = 144;
  rcLeft[1].left = 24;
  rcLeft[1].top = 128;
  rcLeft[1].right = 48;
  rcLeft[1].bottom = 144;
  rcRight[0].left = 48;
  rcRight[0].top = 128;
  rcRight[0].right = 72;
  rcRight[0].bottom = 144;
  rcRight[1].left = 72;
  rcRight[1].top = 128;
  rcRight[1].right = 96;
  rcRight[1].bottom = 144;
  if ( npc->pNpc->code_char == 3 )
  {
    VanishNpChar(npc);
    SetDestroyNpChar(npc->x, npc->y, npc->view.back, 4);
    return;
  }
  v1 = npc->act_no;
  if ( !v1 )
  {
    npc->act_no = 1;
    npc->count1 = 10;
LABEL_7:
    if ( !npc->direct && npc->flag & 0x20 )
    {
      npc->pNpc->y -= 1024;
      npc->pNpc->ym -= 256;
    }
    if ( npc->direct == 2 && npc->flag & 0x10 )
    {
      npc->pNpc->y -= 1024;
      npc->pNpc->ym -= 256;
    }
    if ( npc->flag & 8 )
    {
      npc->pNpc->y -= 1024;
      npc->pNpc->ym -= 256;
      if ( npc->pNpc->direct )
      {
        v2 = npc->pNpc;
        v3 = npc->pNpc->xm + 128;
      }
      else
      {
        v2 = npc->pNpc;
        v3 = npc->pNpc->xm - 128;
      }
      v2->xm = v3;
    }
    deg = npc->xm + npc->pNpc->count2;
    v4 = npc->pNpc->x;
    npc->x = v4 + npc->count1 * GetCos(deg);
    v5 = npc->pNpc->y;
    npc->y = v5 + npc->count1 * GetSin(deg);
    npc->direct = npc->pNpc->direct;
    goto LABEL_19;
  }
  if ( v1 == 1 )
    goto LABEL_7;
LABEL_19:
  npc->direct = npc->pNpc->direct;
  npc->ani_no = deg <= 0x13u || deg > 0x6Cu;
  if ( npc->direct )
  {
    v6 = npc;
    v7 = (Sint32 *)&v11[16 * npc->ani_no - 68];
  }
  else
  {
    v6 = npc;
    v7 = (Sint32 *)&v11[16 * npc->ani_no - 36];
  }
  npc->rect.left = *v7;
  v6->rect.top = v7[1];
  v6->rect.right = v7[2];
  v6->rect.bottom = v7[3];
}


//----- (0807FD0F) --------------------------------------------------------
void __cdecl ActNpc054(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[3];
  RECT rcLeft[3];
  unsigned __int8 deg;
  char v7[8];

  rcLeft[0].left = 0;
  rcLeft[0].top = 80;
  rcLeft[0].right = 32;
  rcLeft[0].bottom = 104;
  rcLeft[1].left = 32;
  rcLeft[1].top = 80;
  rcLeft[1].right = 64;
  rcLeft[1].bottom = 104;
  rcLeft[2].left = 64;
  rcLeft[2].top = 80;
  rcLeft[2].right = 96;
  rcLeft[2].bottom = 104;
  rcRight[0].left = 0;
  rcRight[0].top = 104;
  rcRight[0].right = 32;
  rcRight[0].bottom = 128;
  rcRight[1].left = 32;
  rcRight[1].top = 104;
  rcRight[1].right = 64;
  rcRight[1].bottom = 128;
  rcRight[2].left = 64;
  rcRight[2].top = 104;
  rcRight[2].right = 96;
  rcRight[2].bottom = 128;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    deg = npc->count2;
    if ( npc->direct )
      deg += 6;
    else
      deg -= 6;
    npc->count2 = deg;
    if ( npc->flag & 8 )
    {
      npc->xm = 3 * npc->xm / 4;
      if ( ++npc->act_wait > 60 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
      }
    }
    else
    {
      npc->act_wait = 0;
    }
    if ( npc->direct || !(npc->flag & 1) )
    {
      if ( npc->direct == 2 && npc->flag & 4 )
      {
        if ( ++npc->count1 > 8 )
        {
          npc->direct = 0;
          npc->xm = -npc->xm;
        }
      }
      else
      {
        npc->count1 = 0;
      }
    }
    else if ( ++npc->count1 > 8 )
    {
      npc->direct = 2;
      npc->xm = -npc->xm;
    }
    goto LABEL_26;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_26;
    SetNpChar(53, 0, 0, 0, 0, npc->direct, npc, 256);
    SetNpChar(53, 0, 0, 128, 0, npc->direct, npc, 0);
    npc->act_no = 1;
    npc->ani_no = 1;
    goto LABEL_5;
  }
  ++npc->act_wait;
  npc->shock += LOBYTE(npc->act_wait);
  if ( npc->act_wait > 50 )
  {
    VanishNpChar(npc);
    SetDestroyNpChar(npc->x, npc->y, npc->view.back, 8);
    PlaySoundObject(25, 1);
  }
LABEL_26:
  npc->ym += 128;
  if ( npc->xm > 767 )
    npc->xm = 767;
  if ( npc->xm < -767 )
    npc->xm = -767;
  if ( npc->ym > 767 )
    npc->ym = 767;
  if ( npc->ym < -767 )
    npc->ym = -767;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v7[16 * npc->ani_no - 100];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v7[16 * npc->ani_no - 52];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (0808013D) --------------------------------------------------------
void __cdecl ActNpc055(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[6];
  RECT rcLeft[6];
  char v6[12];

  qmemcpy(rcLeft, &ActNpc055(NPCHAR *)::C.18, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc055(NPCHAR *)::C.19, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      break;
    case 3:
      npc->act_no = 4;
      npc->ani_no = 1;
      npc->ani_wait = 0;
      goto LABEL_4;
    case 4:
LABEL_4:
      if ( ++npc->ani_wait > 4 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 4 )
        npc->ani_no = 1;
      if ( npc->direct )
        v1 = npc->x + 512;
      else
        v1 = npc->x - 512;
      npc->x = v1;
      break;
    case 5:
      npc->ani_no = 5;
      break;
    default:
      break;
  }
  npc->ym += 32;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 192];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 96];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (080802FF) --------------------------------------------------------
void __cdecl ActNpc056(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  NPCHAR_0 *v5;
  RECT *v6;
  RECT rcRight[3];
  RECT rcLeft[3];

  rcLeft[0].left = 0;
  rcLeft[0].top = 144;
  rcLeft[0].right = 16;
  rcLeft[0].bottom = 160;
  rcLeft[1].left = 16;
  rcLeft[1].top = 144;
  rcLeft[1].right = 32;
  rcLeft[1].bottom = 160;
  rcLeft[2].left = 32;
  rcLeft[2].top = 144;
  rcLeft[2].right = 48;
  rcLeft[2].bottom = 160;
  rcRight[0].left = 0;
  rcRight[0].top = 160;
  rcRight[0].right = 16;
  rcRight[0].bottom = 176;
  rcRight[1].left = 16;
  rcRight[1].top = 160;
  rcRight[1].right = 32;
  rcRight[1].bottom = 176;
  rcRight[2].left = 32;
  rcRight[2].top = 160;
  rcRight[2].right = 48;
  rcRight[2].bottom = 176;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      if ( npc->direct )
        npc->act_no = 3;
      else
        npc->act_no = 1;
      break;
    case 1:
      npc->xm -= 16;
      if ( npc->xm < -1024 )
        npc->xm = -1024;
      if ( npc->shock )
      {
        v1 = npc->x;
        v2 = npc->xm / 2;
      }
      else
      {
        v1 = npc->x;
        v2 = npc->xm;
      }
      npc->x = v2 + v1;
      if ( ++npc->ani_wait > 1 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 2 )
        npc->ani_no = 1;
      if ( npc->flag & 1 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 0;
        npc->xm = 0;
        npc->direct = 2;
      }
      break;
    case 2:
      if ( npc->x < x && npc->x > x - 0x20000 && npc->y < y + 4096 && npc->y > y - 4096 )
      {
        npc->act_no = 3;
        npc->ani_wait = 0;
        npc->ani_no = 1;
      }
      break;
    case 3:
      npc->xm += 16;
      if ( npc->xm > 1024 )
        npc->xm = 1024;
      if ( npc->shock )
      {
        v3 = npc->x;
        v4 = npc->xm / 2;
      }
      else
      {
        v3 = npc->x;
        v4 = npc->xm;
      }
      npc->x = v4 + v3;
      if ( ++npc->ani_wait > 1 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 2 )
        npc->ani_no = 1;
      if ( npc->flag & 4 )
      {
        npc->act_no = 4;
        npc->act_wait = 0;
        npc->ani_no = 0;
        npc->xm = 0;
        npc->direct = 0;
      }
      break;
    case 4:
      if ( npc->x < x + 0x20000 && npc->x > x && npc->y < y + 4096 && npc->y > y - 4096 )
      {
        npc->act_no = 1;
        npc->ani_wait = 0;
        npc->ani_no = 1;
      }
      break;
    default:
      break;
  }
  if ( npc->direct )
  {
    v5 = npc;
    v6 = &rcRight[npc->ani_no];
  }
  else
  {
    v5 = npc;
    v6 = &rcLeft[npc->ani_no];
  }
  npc->rect.left = v6->left;
  v5->rect.top = v6->top;
  v5->rect.right = v6->right;
  v5->rect.bottom = v6->bottom;
}

//----- (0808074E) --------------------------------------------------------
void __cdecl ActNpc057(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  NPCHAR_0 *v4;
  Sint32 *v5;
  RECT rect_right[5];
  RECT rect_left[5];
  unsigned __int8 deg;
  char v9[24];

  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    if ( x >= npc->x )
      npc->direct = 2;
    else
      npc->direct = 0;
    if ( npc->tgt_x < npc->x )
      npc->xm -= 16;
    if ( npc->tgt_x > npc->x )
      npc->xm += 16;
    if ( npc->tgt_y < npc->y )
      npc->ym -= 16;
    if ( npc->tgt_y > npc->y )
      npc->ym += 16;
    if ( npc->xm > 512 )
      npc->xm = 512;
    if ( npc->xm < -512 )
      npc->xm = -512;
    if ( npc->ym > 512 )
      npc->ym = 512;
    if ( npc->ym < -512 )
      npc->ym = -512;
    if ( npc->shock )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
      if ( npc->direct == 2 )
        npc->xm = -512;
      else
        npc->xm = 512;
      npc->ym = 0;
    }
    goto LABEL_67;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_67;
    deg = Random(0, 255);
    npc->xm = GetCos(deg);
    deg += 64;
    v2 = npc->x;
    npc->tgt_x = v2 + 8 * GetCos(deg);
    deg = Random(0, 255);
    npc->ym = GetSin(deg);
    deg += 64;
    v3 = npc->y;
    npc->tgt_y = v3 + 8 * GetSin(deg);
    npc->act_no = 1;
    npc->count1 = 120;
    npc->ani_no = Random(0, 1);
    npc->ani_wait = Random(0, 4);
    goto LABEL_5;
  }
  if ( x >= npc->x )
    npc->direct = 2;
  else
    npc->direct = 0;
  if ( npc->y <= y + 24576 )
  {
    if ( x < npc->x )
      npc->xm -= 16;
    if ( x > npc->x )
      npc->xm += 16;
  }
  else
  {
    if ( x < npc->x )
      npc->xm += 16;
    if ( x > npc->x )
      npc->xm -= 16;
  }
  if ( y < npc->y )
    npc->ym -= 16;
  if ( y > npc->y )
    npc->ym += 16;
  if ( npc->shock )
  {
    npc->ym += 32;
    npc->xm = 0;
  }
  if ( npc->xm < 0 && npc->flag & 1 )
    npc->xm = 512;
  if ( npc->xm > 0 && npc->flag & 4 )
    npc->xm = -512;
  if ( npc->ym < 0 && npc->flag & 2 )
    npc->ym = 512;
  if ( npc->ym > 0 && npc->flag & 8 )
    npc->ym = -512;
  if ( npc->xm > 1535 )
    npc->xm = 1535;
  if ( npc->xm < -1535 )
    npc->xm = -1535;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  if ( npc->ym < -1535 )
    npc->ym = -1535;
LABEL_67:
  npc->x += npc->xm;
  npc->y += npc->ym;
  qmemcpy(rect_left, &ActNpc057(NPCHAR *)::C.20, sizeof(rect_left));
  qmemcpy(rect_right, &ActNpc057(NPCHAR *)::C.21, sizeof(rect_right));
  if ( npc->shock )
  {
    npc->ani_no = 4;
  }
  else
  {
    if ( ++npc->ani_wait > 1 )
    {
      npc->ani_wait = 0;
      ++npc->ani_no;
    }
    if ( npc->ani_no > 1 )
      npc->ani_no = 0;
  }
  if ( npc->direct )
  {
    v4 = npc;
    v5 = (Sint32 *)&v9[16 * npc->ani_no - 164];
  }
  else
  {
    v4 = npc;
    v5 = (Sint32 *)&v9[16 * npc->ani_no - 84];
  }
  npc->rect.left = *v5;
  v4->rect.top = v5[1];
  v4->rect.right = v5[2];
  v4->rect.bottom = v5[3];
}


//----- (08080CDA) --------------------------------------------------------
void __cdecl ActNpc058(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  NPCHAR_0 *v6;
  Sint32 *v7;
  RECT rcRight[3];
  RECT rcLeft[3];
  unsigned __int8 deg;
  int xm;
  int ym;
  char v13[8];

  rcLeft[0].left = 192;
  rcLeft[0].top = 0;
  rcLeft[0].right = 216;
  rcLeft[0].bottom = 24;
  rcLeft[1].left = 216;
  rcLeft[1].top = 0;
  rcLeft[1].right = 240;
  rcLeft[1].bottom = 24;
  rcLeft[2].left = 240;
  rcLeft[2].top = 0;
  rcLeft[2].right = 264;
  rcLeft[2].bottom = 24;
  rcRight[0].left = 192;
  rcRight[0].top = 24;
  rcRight[0].right = 216;
  rcRight[0].bottom = 48;
  rcRight[1].left = 216;
  rcRight[1].top = 24;
  rcRight[1].right = 240;
  rcRight[1].bottom = 48;
  rcRight[2].left = 240;
  rcRight[2].top = 24;
  rcRight[2].right = 264;
  rcRight[2].bottom = 48;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_58;
    if ( npc->x <= x )
    {
      npc->direct = 2;
      v2 = npc->xm + 16;
    }
    else
    {
      npc->direct = 0;
      v2 = npc->xm - 16;
    }
    npc->xm = v2;
    if ( npc->flag & 1 )
      npc->xm = 512;
    if ( npc->flag & 4 )
      npc->xm = -512;
    if ( npc->y >= npc->tgt_y )
      v3 = npc->ym - 8;
    else
      v3 = npc->ym + 8;
    npc->ym = v3;
    if ( npc->xm > 767 )
      npc->xm = 767;
    if ( npc->xm < -767 )
      npc->xm = -767;
    if ( npc->ym > 256 )
      npc->ym = 256;
    if ( npc->ym < -256 )
      npc->ym = -256;
    if ( npc->shock )
    {
      npc->x += npc->xm / 2;
      v4 = npc->y;
      v5 = npc->ym / 2;
    }
    else
    {
      npc->x += npc->xm;
      v4 = npc->y;
      v5 = npc->ym;
    }
    npc->y = v5 + v4;
    if ( x <= npc->x + 204800 && x >= npc->x - 204800 )
    {
LABEL_58:
      if ( npc->act_no )
      {
        if ( npc->act_wait <= 149 )
          ++npc->act_wait;
        if ( npc->act_wait == 150 )
        {
          if ( !(++npc->count2 & 7) && npc->x < x + 81920 && npc->x > x - 81920 )
          {
            deg = GetArktan(npc->x - x, npc->y - y);
            deg += Random(-6, 6);
            ym = 2 * GetSin(deg);
            xm = 2 * GetCos(deg);
            SetNpChar(84, npc->x, npc->y, xm, ym, 0, 0, 256);
            PlaySoundObject(39, 1);
          }
          if ( npc->count2 > 8 )
          {
            npc->act_wait = 0;
            npc->count2 = 0;
          }
        }
      }
      if ( ++npc->ani_wait > 1 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 1 )
        npc->ani_no = 0;
      if ( npc->act_wait > 120 && npc->act_wait / 2 % 2 == 1 && npc->ani_no == 1 )
        npc->ani_no = 2;
      if ( npc->direct )
      {
        v6 = npc;
        v7 = (Sint32 *)&v13[16 * npc->ani_no - 108];
      }
      else
      {
        v6 = npc;
        v7 = (Sint32 *)&v13[16 * npc->ani_no - 60];
      }
      npc->rect.left = *v7;
      v6->rect.top = v7[1];
      v6->rect.right = v7[2];
      v6->rect.bottom = v7[3];
    }
    else
    {
      npc->act_no = 0;
      npc->xm = 0;
      npc->direct = npc->count1;
      npc->x = npc->tgt_x;
      npc->rect.right = 0;
      npc->damage = 0;
    }
  }
  else if ( x >= npc->x + 0x2000 || x <= npc->x - 0x2000 )
  {
    npc->rect.right = 0;
    npc->damage = 0;
    npc->xm = 0;
    npc->ym = 0;
    npc->bits &= 0xFFDFu;
  }
  else
  {
    npc->bits |= 0x20u;
    npc->ym = -256;
    npc->tgt_x = npc->x;
    npc->tgt_y = npc->y;
    npc->act_no = 1;
    npc->act_wait = 0;
    npc->count1 = npc->direct;
    npc->count2 = 0;
    npc->damage = 6;
    if ( npc->direct )
    {
      npc->x = x - 0x20000;
      npc->xm = 767;
    }
    else
    {
      npc->x = x + 0x20000;
      npc->xm = -767;
    }
  }
}


//----- (08081319) --------------------------------------------------------
void __cdecl ActNpc059(NPCHAR_0 *npc)
{
  RECT *v1;
  RECT rcLeft[4];

  rcLeft[0].left = 224;
  rcLeft[0].top = 16;
  rcLeft[0].right = 240;
  rcLeft[0].bottom = 40;
  rcLeft[1].left = 208;
  rcLeft[1].top = 80;
  rcLeft[1].right = 224;
  rcLeft[1].bottom = 104;
  rcLeft[2].left = 224;
  rcLeft[2].top = 80;
  rcLeft[2].right = 240;
  rcLeft[2].bottom = 104;
  rcLeft[3].left = 240;
  rcLeft[3].top = 80;
  rcLeft[3].right = 256;
  rcLeft[3].bottom = 104;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( npc->x - 0x8000 < x && npc->x + 0x8000 > x && npc->y - 0x8000 < y && npc->y + 0x8000 > y )
      {
        npc->act_no = 2;
        npc->ani_wait = 0;
      }
      break;
    case 2:
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no == 2 )
        npc->act_no = 3;
      break;
    case 3:
      if ( npc->x - 0x8000 >= x || npc->x + 0x8000 <= x || npc->y - 0x8000 >= y || npc->y + 0x8000 <= y )
      {
        npc->act_no = 4;
        npc->ani_wait = 0;
      }
      break;
    case 4:
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        --npc->ani_no;
      }
      if ( !npc->ani_no )
        npc->act_no = 1;
      break;
    default:
      break;
  }
  if ( npc->shock )
  {
    npc->rect.left = rcLeft[3].left;
    npc->rect.top = rcLeft[3].top;
    npc->rect.right = rcLeft[3].right;
    npc->rect.bottom = rcLeft[3].bottom;
  }
  else
  {
    v1 = &rcLeft[npc->ani_no];
    npc->rect.left = v1->left;
    npc->rect.top = v1->top;
    npc->rect.right = v1->right;
    npc->rect.bottom = v1->bottom;
  }
}

//----- (0808159C) --------------------------------------------------------
void __cdecl JadgeHitNpCharBlock(NPCHAR_0 *npc, int x, int y)
{
  int hit;

  hit = 0;
  if ( npc->y - npc->hit.top < ((2 * y + 1) << 12) - 1536
    && npc->hit.bottom + npc->y > ((2 * y - 1) << 12) + 1536
    && npc->x - npc->hit.back < (2 * x + 1) << 12
    && npc->x - npc->hit.back > x << 13 )
  {
    npc->x = npc->hit.back + ((2 * x + 1) << 12);
    hit = 1;
  }
  if ( npc->y - npc->hit.top < ((2 * y + 1) << 12) - 1536
    && npc->hit.bottom + npc->y > ((2 * y - 1) << 12) + 1536
    && npc->hit.back + npc->x > (2 * x - 1) << 12
    && npc->hit.back + npc->x < x << 13 )
  {
    npc->x = ((2 * x - 1) << 12) - npc->hit.back;
    hit |= 4u;
  }
  if ( npc->x - npc->hit.back < ((2 * x + 1) << 12) - 1536
    && npc->hit.back + npc->x > ((2 * x - 1) << 12) + 1536
    && npc->y - npc->hit.top < (2 * y + 1) << 12
    && npc->y - npc->hit.top > y << 13 )
  {
    npc->y = npc->hit.top + ((2 * y + 1) << 12);
    npc->ym = 0;
    hit |= 2u;
  }
  if ( npc->x - npc->hit.back < ((2 * x + 1) << 12) - 1536
    && npc->hit.back + npc->x > ((2 * x - 1) << 12) + 1536
    && npc->hit.bottom + npc->y > (2 * y - 1) << 12
    && npc->hit.bottom + npc->y < y << 13 )
  {
    npc->y = ((2 * y - 1) << 12) - npc->hit.bottom;
    npc->ym = 0;
    hit |= 8u;
  }
  npc->flag |= hit;
}

//----- (0808187C) --------------------------------------------------------
void __cdecl JudgeHitNpCharTriangleA(NPCHAR_0 *npc, int x, int y)
{
  int hit;

  hit = 0;
  if ( npc->x < (2 * x + 1) << 12
    && npc->x > (2 * x - 1) << 12
    && npc->y - npc->hit.top < (y << 13) - (-8192 * x + npc->x) / 2 + 2048
    && npc->hit.bottom + npc->y > (2 * y - 1) << 12 )
  {
    npc->y = npc->hit.top + (y << 13) - (-8192 * x + npc->x) / 2 + 2048;
    if ( npc->ym < 0 )
      npc->ym = 0;
    hit = 2;
  }
  npc->flag |= hit;
}

//----- (0808198E) --------------------------------------------------------
void __cdecl JudgeHitNpCharTriangleB(NPCHAR_0 *npc, int x, int y)
{
  int hit;

  hit = 0;
  if ( npc->x < (2 * x + 1) << 12
    && npc->x > (2 * x - 1) << 12
    && npc->y - npc->hit.top < (y << 13) - (-8192 * x + npc->x) / 2 - 2048
    && npc->hit.bottom + npc->y > (2 * y - 1) << 12 )
  {
    npc->y = npc->hit.top + (y << 13) - (-8192 * x + npc->x) / 2 - 2048;
    if ( npc->ym < 0 )
      npc->ym = 0;
    hit = 2;
  }
  npc->flag |= hit;
}

//----- (08081AA0) --------------------------------------------------------
void __cdecl JudgeHitNpCharTriangleC(NPCHAR_0 *npc, int x, int y)
{
  int hit;

  hit = 0;
  if ( npc->x < (2 * x + 1) << 12
    && npc->x > (2 * x - 1) << 12
    && npc->y - npc->hit.top < (y << 13) + (-8192 * x + npc->x) / 2 - 2048
    && npc->hit.bottom + npc->y > (2 * y - 1) << 12 )
  {
    npc->y = npc->hit.top + (y << 13) + (-8192 * x + npc->x) / 2 - 2048;
    if ( npc->ym < 0 )
      npc->ym = 0;
    hit = 2;
  }
  npc->flag |= hit;
}

//----- (08081BAC) --------------------------------------------------------
void __cdecl JudgeHitNpCharTriangleD(NPCHAR_0 *npc, int x, int y)
{
  int hit;

  hit = 0;
  if ( npc->x < (2 * x + 1) << 12
    && npc->x > (2 * x - 1) << 12
    && npc->y - npc->hit.top < (y << 13) + (-8192 * x + npc->x) / 2 + 2048
    && npc->hit.bottom + npc->y > (2 * y - 1) << 12 )
  {
    npc->y = npc->hit.top + (y << 13) + (-8192 * x + npc->x) / 2 + 2048;
    if ( npc->ym < 0 )
      npc->ym = 0;
    hit = 2;
  }
  npc->flag |= hit;
}

//----- (08081CB8) --------------------------------------------------------
void __cdecl JudgeHitNpCharTriangleE(NPCHAR_0 *npc, int x, int y)
{
  int hit;

  hit = 0x10000;
  if ( npc->x < (2 * x + 1) << 12
    && npc->x > (2 * x - 1) << 12
    && npc->y + npc->hit.bottom > (y << 13) + (-8192 * x + npc->x) / 2 - 2048
    && npc->y - npc->hit.top < (2 * y + 1) << 12 )
  {
    npc->y = (y << 13) + (-8192 * x + npc->x) / 2 - 2048 - npc->hit.bottom;
    if ( npc->ym > 0 )
      npc->ym = 0;
    hit = 65576;
  }
  npc->flag |= hit;
}

//----- (08081DCA) --------------------------------------------------------
void __cdecl JudgeHitNpCharTriangleF(NPCHAR_0 *npc, int x, int y)
{
  int hit;

  hit = 0x20000;
  if ( npc->x < (2 * x + 1) << 12
    && npc->x >= (2 * x - 1) << 12
    && npc->y + npc->hit.bottom > (y << 13) + (-8192 * x + npc->x) / 2 + 2048
    && npc->y - npc->hit.top < (2 * y + 1) << 12 )
  {
    npc->y = (y << 13) + (-8192 * x + npc->x) / 2 + 2048 - npc->hit.bottom;
    if ( npc->ym > 0 )
      npc->ym = 0;
    hit = 131112;
  }
  npc->flag |= hit;
}

//----- (08081EDC) --------------------------------------------------------
void __cdecl JudgeHitNpCharTriangleG(NPCHAR_0 *npc, int x, int y)
{
  int hit;

  hit = 0x40000;
  if ( npc->x < (2 * x + 1) << 12
    && npc->x > (2 * x - 1) << 12
    && npc->y + npc->hit.bottom > (y << 13) - (-8192 * x + npc->x) / 2 + 2048
    && npc->y - npc->hit.top < (2 * y + 1) << 12 )
  {
    npc->y = (y << 13) - (-8192 * x + npc->x) / 2 + 2048 - npc->hit.bottom;
    if ( npc->ym > 0 )
      npc->ym = 0;
    hit = 262168;
  }
  npc->flag |= hit;
}

//----- (08081FF4) --------------------------------------------------------
void __cdecl JudgeHitNpCharTriangleH(NPCHAR_0 *npc, int x, int y)
{
  int hit;

  hit = 0x80000;
  if ( npc->x < (2 * x + 1) << 12
    && npc->x > (2 * x - 1) << 12
    && npc->y + npc->hit.bottom > (y << 13) - (-8192 * x + npc->x) / 2 - 2048
    && npc->y - npc->hit.top < (2 * y + 1) << 12 )
  {
    npc->y = (y << 13) - (-8192 * x + npc->x) / 2 - 2048 - npc->hit.bottom;
    if ( npc->ym > 0 )
      npc->ym = 0;
    hit = 524312;
  }
  npc->flag |= hit;
}

//----- (0808210C) --------------------------------------------------------
void __cdecl JudgeHitNpCharWater(NPCHAR_0 *npc, int x, int y)
{
  int hit;

  hit = 0;
  if ( npc->x - npc->hit.back < (4 * (2 * x + 1) - 1) << 10
    && npc->hit.back + npc->x > (4 * (2 * x - 1) + 1) << 10
    && npc->y - npc->hit.top < (4 * (2 * y + 1) - 1) << 10
    && npc->hit.bottom + npc->y > (4 * (2 * y - 1) + 1) << 10 )
  {
    hit = 256;
  }
  npc->flag |= hit;
}

//----- (080821CB) --------------------------------------------------------
void HitNpCharMap()
{
  __int64 v0;
  __int64 v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  int v8;
  int v9;
  int v10;
  int offy[9];
  int offx[9];
  int x;
  int y;
  int judg;
  int i;
  int j;

  offx[0] = 0;
  offx[1] = 1;
  offx[2] = 0;
  offx[3] = 1;
  offx[4] = 2;
  offx[5] = 2;
  offx[6] = 2;
  offx[7] = 0;
  offx[8] = 1;
  offy[0] = 0;
  offy[1] = 0;
  offy[2] = 1;
  offy[3] = 1;
  offy[4] = 0;
  offy[5] = 1;
  offy[6] = 2;
  offy[7] = 2;
  offy[8] = 2;
  for ( i = 0; i <= 511; ++i )
  {
    if ( (gNPC[i].cond & 0x80u) != 0 && !(gNPC[i].bits & 8) )
    {
      if ( gNPC[i].size <= 2 )
      {
        judg = 4;
        x = gNPC[i].x / 0x2000;
        v1 = gNPC[i].y;
      }
      else
      {
        judg = 9;
        v0 = gNPC[i].x - 4096;
        x = (signed int)((HIDWORD(v0) >> 19) + v0) >> 13;
        v1 = gNPC[i].y - 4096;
      }
      y = (signed int)((HIDWORD(v1) >> 19) + v1) >> 13;
      gNPC[i].flag = 0;
      for ( j = 0; j < judg; ++j )
      {
        switch ( (unsigned __int8)GetAttribute(x + offx[j], y + offy[j]) )
        {
          case 2u:
          case 0x60u:
          case 0x62u:
            JudgeHitNpCharWater((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            break;
          case 3u:
          case 5u:
          case 0x41u:
          case 0x43u:
            goto LABEL_10;
          case 4u:
          case 0x61u:
          case 0x64u:
            JadgeHitNpCharBlock((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            JudgeHitNpCharWater((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            break;
          case 0x44u:
            if ( !(gNPC[i].bits & 2) )
LABEL_10:
              JadgeHitNpCharBlock((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            break;
          case 0x50u:
            JudgeHitNpCharTriangleA((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            break;
          case 0x51u:
            JudgeHitNpCharTriangleB((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            break;
          case 0x52u:
            JudgeHitNpCharTriangleC((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            break;
          case 0x53u:
            JudgeHitNpCharTriangleD((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            break;
          case 0x54u:
            JudgeHitNpCharTriangleE((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            break;
          case 0x55u:
            JudgeHitNpCharTriangleF((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            break;
          case 0x56u:
            JudgeHitNpCharTriangleG((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            break;
          case 0x57u:
            JudgeHitNpCharTriangleH((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            break;
          case 0x70u:
            JudgeHitNpCharTriangleA((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            JudgeHitNpCharWater((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            break;
          case 0x71u:
            JudgeHitNpCharTriangleB((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            JudgeHitNpCharWater((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            break;
          case 0x72u:
            JudgeHitNpCharTriangleC((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            JudgeHitNpCharWater((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            break;
          case 0x73u:
            JudgeHitNpCharTriangleD((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            JudgeHitNpCharWater((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            break;
          case 0x74u:
            JudgeHitNpCharTriangleE((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            JudgeHitNpCharWater((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            break;
          case 0x75u:
            JudgeHitNpCharTriangleF((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            JudgeHitNpCharWater((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            break;
          case 0x76u:
            JudgeHitNpCharTriangleG((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            JudgeHitNpCharWater((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            break;
          case 0x77u:
            JudgeHitNpCharTriangleH((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            JudgeHitNpCharWater((NPCHAR_0 *)(172 * i + 136142176), x + offx[j], y + offy[j]);
            break;
          case 0x80u:
            goto LABEL_30;
          case 0x81u:
            goto LABEL_32;
          case 0x82u:
            goto LABEL_34;
          case 0x83u:
            goto LABEL_36;
          case 0xA0u:
            v2 = gNPC[i].flag;
            BYTE1(v2) |= 1u;
            gNPC[i].flag = v2;
LABEL_30:
            v3 = gNPC[i].flag;
            BYTE1(v3) |= 0x10u;
            gNPC[i].flag = v3;
            break;
          case 0xA1u:
            v4 = gNPC[i].flag;
            BYTE1(v4) |= 1u;
            gNPC[i].flag = v4;
LABEL_32:
            v5 = gNPC[i].flag;
            BYTE1(v5) |= 0x20u;
            gNPC[i].flag = v5;
            break;
          case 0xA2u:
            v6 = gNPC[i].flag;
            BYTE1(v6) |= 1u;
            gNPC[i].flag = v6;
LABEL_34:
            v7 = gNPC[i].flag;
            BYTE1(v7) |= 0x40u;
            gNPC[i].flag = v7;
            break;
          case 0xA3u:
            v8 = gNPC[i].flag;
            BYTE1(v8) |= 1u;
            gNPC[i].flag = v8;
LABEL_36:
            v9 = gNPC[i].flag;
            BYTE1(v9) |= 0x80u;
            gNPC[i].flag = v9;
            break;
          default:
            break;
        }
        if ( gNPC[i].y > gWaterY + 2048 )
        {
          v10 = gNPC[i].flag;
          BYTE1(v10) |= 1u;
          gNPC[i].flag = v10;
        }
      }
    }
  }
}

//----- (08082B7C) --------------------------------------------------------
void __cdecl LoseNpChar(NPCHAR_0 *npc, bool bVanish)
{
  int v2;
  int v3;
  char v4;

  PlaySoundObject(npc->destroy_voice, 1);
  v2 = npc->size;
  switch ( v2 )
  {
    case 2:
      SetDestroyNpChar(npc->x, npc->y, npc->view.back, 7);
      break;
    case 3:
      SetDestroyNpChar(npc->x, npc->y, npc->view.back, 12);
      break;
    case 1:
      SetDestroyNpChar(npc->x, npc->y, npc->view.back, 3);
      break;
  }
  if ( npc->exp )
  {
    v3 = Random(1, 5);
    if ( v3 == 1 )
    {
      if ( npc->exp <= 6 )
        SetLifeObject(npc->x, npc->y, 2);
      else
        SetLifeObject(npc->x, npc->y, 6);
    }
    else if ( v3 != 2
           || (npc->exp <= 6 ? (v4 = SetBulletObject(npc->x, npc->y, 1)) : (v4 = SetBulletObject(npc->x, npc->y, 3)), !v4) )
    {
      SetExpObjects(npc->x, npc->y, npc->exp);
    }
  }
  SetNPCFlag(npc->code_flag);
  if ( (npc->bits & 0x8000u) == 0 )
  {
    npc->cond = 0;
  }
  else
  {
    if ( (npc->bits & 0x8000u) != 0 && npc->damage_view )
      SetValueView(&npc->x, &npc->y, npc->damage_view);
    if ( bVanish )
      VanishNpChar(npc);
  }
}

//----- (08082D85) --------------------------------------------------------
void HitNpCharBullet()
{
  int n;
  int b;
  bool bHit;

  for ( n = 0; n <= 511; ++n )
  {
    if ( (gNPC[n].cond & 0x80u) != 0 && (!(gNPC[n].bits & 0x20) || !(gNPC[n].bits & 0x2000)) )
    {
      for ( b = 0; ; ++b )
      {
        if ( b > 63 )
        {
          if ( gNPC[n].cond & 8 )
            LoseNpChar((NPCHAR_0 *)(172 * n + 136142176), 1);
          break;
        }
        if ( gBul[b].cond & 0x80 && gBul[b].damage != -1 )
        {
          bHit = 0;
          if ( gNPC[n].bits & 0x20
            && gNPC[n].x - gNPC[n].hit.back < *(&gBul[0].flag + 4 * (8 * b + 1)) + gBul[b].enemyXL
            && gNPC[n].x + gNPC[n].hit.back > *(&gBul[0].flag + 4 * (8 * b + 1)) - gBul[b].enemyXL
            && gNPC[n].y - gNPC[n].hit.top < *(&gBul[0].code_bullet + 4 * (8 * b + 1)) + gBul[b].enemyYL
            && gNPC[n].y + gNPC[n].hit.bottom > *(&gBul[0].code_bullet + 4 * (8 * b + 1)) - gBul[b].enemyYL )
          {
            bHit = 1;
          }
          else if ( gNPC[n].bits & 4
                 && gNPC[n].x - gNPC[n].hit.back < *(&gBul[0].flag + 4 * (8 * b + 1)) + gBul[b].blockXL
                 && gNPC[n].x + gNPC[n].hit.back > *(&gBul[0].flag + 4 * (8 * b + 1)) - gBul[b].blockXL
                 && gNPC[n].y - gNPC[n].hit.top < *(&gBul[0].code_bullet + 4 * (8 * b + 1)) + gBul[b].blockYL
                 && gNPC[n].y + gNPC[n].hit.bottom > *(&gBul[0].code_bullet + 4 * (8 * b + 1)) - gBul[b].blockYL )
          {
            bHit = 1;
          }
          if ( bHit )
          {
            if ( gNPC[n].bits & 0x20 )
            {
              gNPC[n].life -= gBul[b].damage;
              if ( gNPC[n].life > 0 )
              {
                if ( gNPC[n].shock <= 0xDu )
                {
                  SetCaret(
                    (*(&gBul[0].flag + 4 * (8 * b + 1)) + gNPC[n].x) / 2,
                    (*(&gBul[0].code_bullet + 4 * (8 * b + 1)) + gNPC[n].y) / 2,
                    11,
                    0);
                  SetCaret(
                    (*(&gBul[0].flag + 4 * (8 * b + 1)) + gNPC[n].x) / 2,
                    (*(&gBul[0].code_bullet + 4 * (8 * b + 1)) + gNPC[n].y) / 2,
                    11,
                    0);
                  SetCaret(
                    (*(&gBul[0].flag + 4 * (8 * b + 1)) + gNPC[n].x) / 2,
                    (*(&gBul[0].code_bullet + 4 * (8 * b + 1)) + gNPC[n].y) / 2,
                    11,
                    0);
                  PlaySoundObject(gNPC[n].hit_voice, 1);
                  gNPC[n].shock = 16;
                }
                if ( (gNPC[n].bits & 0x8000u) != 0 )
                  gNPC[n].damage_view -= gBul[b].damage;
              }
              else
              {
                gNPC[n].life = 0;
                if ( (gNPC[n].bits & 0x8000u) != 0 )
                  gNPC[n].damage_view -= gBul[b].damage;
                if ( (gMC.cond & 0x80u) != 0 && gNPC[n].bits & 0x200 )
                  StartTextScript(gNPC[n].code_event);
                else
                  gNPC[n].cond |= 8u;
              }
            }
            else if ( gBul[b].code_bullet != 13
                   && gBul[b].code_bullet != 14
                   && gBul[b].code_bullet != 15
                   && gBul[b].code_bullet != 28
                   && gBul[b].code_bullet != 29
                   && gBul[b].code_bullet != 30
                   && !(gBul[b].bbits & 0x10) )
            {
              SetCaret(
                (*(&gBul[0].flag + 4 * (8 * b + 1)) + gNPC[n].x) / 2,
                (*(&gBul[0].code_bullet + 4 * (8 * b + 1)) + gNPC[n].y) / 2,
                2,
                2);
              PlaySoundObject(31, 1);
              gBul[b].life = 0;
              continue;
            }
            --gBul[b].life;
          }
        }
      }
    }
  }
}

//----- (080835B0) --------------------------------------------------------
void __cdecl ActNpc240(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  Sint32 *v2;
  RECT rcRight[6];
  RECT rcLeft[6];
  char v5[24];

  qmemcpy(rcLeft, &ActNpc240(NPCHAR *)::C.0, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc240(NPCHAR *)::C.1, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      npc->xm = 0;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( Random(0, 60) == 1 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      if ( Random(0, 60) == 1 )
      {
        npc->act_no = 10;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      break;
    case 2:
      if ( ++npc->act_wait > 8 )
      {
        npc->act_no = 1;
        npc->ani_no = 0;
      }
      break;
    case 0xA:
      npc->act_no = 11;
      npc->act_wait = Random(0, 16);
      npc->ani_no = 2;
      npc->ani_wait = 0;
      if ( Random(0, 9) & 1 )
        npc->direct = 0;
      else
        npc->direct = 2;
      goto LABEL_12;
    case 0xB:
LABEL_12:
      if ( npc->direct || !(npc->flag & 1) )
      {
        if ( npc->direct == 2 && npc->flag & 4 )
          npc->direct = 0;
      }
      else
      {
        npc->direct = 2;
      }
      if ( npc->direct )
        npc->xm = 512;
      else
        npc->xm = -512;
      if ( ++npc->ani_wait > 4 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 5 )
        npc->ani_no = 2;
      if ( ++npc->act_wait > 32 )
        npc->act_no = 0;
      break;
    default:
      break;
  }
  npc->ym += 32;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v1 = npc;
    v2 = (Sint32 *)&v5[16 * npc->ani_no - 192];
  }
  else
  {
    v1 = npc;
    v2 = (Sint32 *)&v5[16 * npc->ani_no - 96];
  }
  npc->rect.left = *v2;
  v1->rect.top = v2[1];
  v1->rect.right = v2[2];
  v1->rect.bottom = v2[3];
}


//----- (080838E1) --------------------------------------------------------
void __cdecl ActNpc241(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[3];
  RECT rcLeft[3];
  char v6[8];

  rcLeft[0].left = 0;
  rcLeft[0].top = 0;
  rcLeft[0].right = 16;
  rcLeft[0].bottom = 16;
  rcLeft[1].left = 16;
  rcLeft[1].top = 0;
  rcLeft[1].right = 32;
  rcLeft[1].bottom = 16;
  rcLeft[2].left = 32;
  rcLeft[2].top = 0;
  rcLeft[2].right = 48;
  rcLeft[2].bottom = 16;
  rcRight[0].left = 0;
  rcRight[0].top = 16;
  rcRight[0].right = 16;
  rcRight[0].bottom = 32;
  rcRight[1].left = 16;
  rcRight[1].top = 16;
  rcRight[1].right = 32;
  rcRight[1].bottom = 32;
  rcRight[2].left = 32;
  rcRight[2].top = 16;
  rcRight[2].right = 48;
  rcRight[2].bottom = 32;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_9:
    if ( npc->x <= x )
      npc->direct = 2;
    else
      npc->direct = 0;
    if ( npc->act_wait <= 7 || npc->x - 73728 >= x || npc->x + 73728 <= x || npc->y - 40960 >= y || npc->y + 40960 <= y )
    {
      if ( npc->act_wait <= 7 )
        ++npc->act_wait;
      npc->ani_no = 0;
    }
    else
    {
      npc->ani_no = 1;
    }
    if ( npc->shock )
    {
      npc->act_no = 2;
      npc->ani_no = 0;
      npc->act_wait = 0;
    }
    if ( npc->act_wait > 7 && npc->x - 49152 < x && npc->x + 49152 > x && npc->y - 40960 < y && npc->y + 49152 > y )
    {
      npc->act_no = 2;
      npc->ani_no = 0;
      npc->act_wait = 0;
    }
    goto LABEL_35;
  }
  if ( v1 <= 1 )
  {
    if ( v1 )
      goto LABEL_35;
    npc->y += 1536;
    npc->act_no = 1;
    goto LABEL_9;
  }
  if ( v1 == 2 )
  {
    if ( ++npc->act_wait > 8 )
    {
      npc->act_no = 3;
      npc->ani_no = 2;
      npc->ym = -1535;
      PlaySoundObject(30, 1);
      if ( npc->direct )
        npc->xm = 512;
      else
        npc->xm = -512;
    }
  }
  else if ( v1 == 3 && npc->flag & 8 )
  {
    npc->xm = 0;
    npc->act_wait = 0;
    npc->ani_no = 0;
    npc->act_no = 1;
    PlaySoundObject(23, 1);
  }
LABEL_35:
  npc->ym += 85;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 96];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 48];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (08083CD2) --------------------------------------------------------
void __cdecl ActNpc242(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rect_right[4];
  RECT rect_left[4];
  char v6[8];

  if ( npc->x < 0 || npc->x > gMap.width << 13 )
  {
    VanishNpChar(npc);
    return;
  }
  v1 = npc->act_no;
  switch ( v1 )
  {
    case 1:
      goto LABEL_8;
    case 2:
      goto LABEL_11;
    case 0:
      npc->act_no = 1;
      npc->tgt_x = npc->x;
      npc->tgt_y = npc->y;
      npc->act_wait = Random(0, 50);
LABEL_8:
      if ( npc->act_wait )
      {
        --npc->act_wait;
        break;
      }
      npc->act_no = 2;
      npc->ym = 1024;
LABEL_11:
      if ( npc->direct )
        npc->xm = 256;
      else
        npc->xm = -256;
      if ( npc->tgt_y < npc->y )
        npc->ym -= 16;
      if ( npc->tgt_y > npc->y )
        npc->ym += 16;
      if ( npc->ym > 768 )
        npc->ym = 768;
      if ( npc->ym < -768 )
        npc->ym = -768;
      break;
  }
  npc->x += npc->xm;
  npc->y += npc->ym;
  rect_left[0].left = 32;
  rect_left[0].top = 32;
  rect_left[0].right = 48;
  rect_left[0].bottom = 48;
  rect_left[1].left = 48;
  rect_left[1].top = 32;
  rect_left[1].right = 64;
  rect_left[1].bottom = 48;
  rect_left[2].left = 64;
  rect_left[2].top = 32;
  rect_left[2].right = 80;
  rect_left[2].bottom = 48;
  rect_left[3].left = 80;
  rect_left[3].top = 32;
  rect_left[3].right = 96;
  rect_left[3].bottom = 48;
  rect_right[0].left = 32;
  rect_right[0].top = 48;
  rect_right[0].right = 48;
  rect_right[0].bottom = 64;
  rect_right[1].left = 48;
  rect_right[1].top = 48;
  rect_right[1].right = 64;
  rect_right[1].bottom = 64;
  rect_right[2].left = 64;
  rect_right[2].top = 48;
  rect_right[2].right = 80;
  rect_right[2].bottom = 64;
  rect_right[3].left = 80;
  rect_right[3].top = 48;
  rect_right[3].right = 96;
  rect_right[3].bottom = 64;
  if ( ++npc->ani_wait > 1 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 2 )
    npc->ani_no = 0;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 128];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 64];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (08083FDA) --------------------------------------------------------
void __cdecl ActNpc243(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;

  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      return;
  }
  else
  {
    npc->act_no = 1;
    npc->act_wait = Random(0, 500);
  }
  if ( npc->act_wait )
  {
    --npc->act_wait;
  }
  else
  {
    npc->act_no = 0;
    v2 = npc->direct;
    v3 = npc->y;
    v4 = Random(-32, 32);
    SetNpChar(242, npc->x, v3 + (v4 << 9), 0, 0, v2, 0, 256);
  }
}

//----- (080840AA) --------------------------------------------------------
void __cdecl ActNpc244(NPCHAR_0 *npc)
{
  bool bHit;
  int i;

  npc->ym += 64;
  bHit = 0;
  if ( npc->flag & 0xFF )
    bHit = 1;
  if ( npc->act_wait > 10 && npc->flag & 0x100 )
    bHit = 1;
  if ( bHit )
  {
    for ( i = 0; i <= 2; ++i )
      SetCaret(npc->x, npc->y + 2048, 1, 2);
    if ( npc->x > x - 0x20000 && npc->x < x + 0x20000 && npc->y > y - 81920 && npc->y < y + 81920 )
      PlaySoundObject(21, 1);
    npc->cond = 0;
  }
  else
  {
    if ( npc->ym > 1535 )
      npc->ym = 1535;
    npc->y += npc->ym;
    npc->rect.left = 96;
    npc->rect.top = 0;
    npc->rect.right = 104;
    npc->rect.bottom = 16;
  }
}

//----- (0808421C) --------------------------------------------------------
void __cdecl ActNpc245(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  Sint32 *v3;
  RECT rc[4];
  char v5[8];

  rc[0].left = 0;
  rc[0].top = 0;
  rc[0].right = 0;
  rc[0].bottom = 0;
  rc[1].left = 104;
  rc[1].top = 0;
  rc[1].right = 112;
  rc[1].bottom = 16;
  rc[2].left = 112;
  rc[2].top = 0;
  rc[2].right = 120;
  rc[2].bottom = 16;
  rc[3].left = 120;
  rc[3].top = 0;
  rc[3].right = 128;
  rc[3].bottom = 16;
  v1 = npc->act_no;
  switch ( v1 )
  {
    case 1:
      goto LABEL_5;
    case 10:
      if ( ++npc->ani_wait > 10 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 3 )
      {
        SetNpChar(244, npc->x, npc->y, 0, 0, 0, 0, 256);
        npc->act_no = 1;
        npc->act_wait = npc->code_flag;
      }
      break;
    case 0:
      npc->act_no = 1;
      npc->tgt_x = npc->x;
      npc->act_wait = npc->code_event;
LABEL_5:
      npc->ani_no = 0;
      if ( npc->act_wait )
      {
        --npc->act_wait;
        return;
      }
      npc->act_no = 10;
      npc->ani_wait = 0;
      break;
  }
  if ( npc->ani_wait / 2 & 1 )
    v2 = npc->tgt_x;
  else
    v2 = npc->tgt_x + 512;
  npc->x = v2;
  v3 = (Sint32 *)&v5[16 * npc->ani_no - 64];
  npc->rect.left = *v3;
  npc->rect.top = v3[1];
  npc->rect.right = v3[2];
  npc->rect.bottom = v3[3];
}


//----- (0808440E) --------------------------------------------------------
void __cdecl ActNpc246(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  Sint32 *v4;
  RECT rcLeft[3];
  int i;
  char v7[8];

  rcLeft[0].left = 144;
  rcLeft[0].top = 112;
  rcLeft[0].right = 160;
  rcLeft[0].bottom = 136;
  rcLeft[1].left = 160;
  rcLeft[1].top = 112;
  rcLeft[1].right = 176;
  rcLeft[1].bottom = 136;
  rcLeft[2].left = 176;
  rcLeft[2].top = 112;
  rcLeft[2].right = 192;
  rcLeft[2].bottom = 136;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_9:
    if ( x < npc->x + 4096 && x > npc->x - 4096 && y > npc->y + 4096 && y < npc->y + 0x10000 )
      npc->act_no = 5;
    goto LABEL_30;
  }
  if ( v1 <= 1 )
  {
    if ( v1 )
      goto LABEL_30;
    npc->act_no = 1;
    npc->y -= 2048;
    goto LABEL_9;
  }
  if ( v1 == 5 )
  {
    if ( !(npc->flag & 8) )
    {
      npc->act_no = 10;
      npc->ani_wait = 0;
      npc->ani_no = 1;
    }
  }
  else if ( v1 == 10 )
  {
    if ( ++npc->ani_wait > 2 )
    {
      npc->ani_wait = 0;
      ++npc->ani_no;
    }
    if ( npc->ani_no > 2 )
      npc->ani_no = 2;
    if ( y <= npc->y )
    {
      npc->bits |= 0x40u;
      npc->damage = 0;
    }
    else
    {
      npc->bits &= 0xFFBFu;
      npc->damage = 127;
    }
    if ( npc->flag & 8 )
    {
      if ( npc->ani_no > 1 )
      {
        for ( i = 0; i <= 3; ++i )
        {
          v2 = Random(-1536, 0);
          v3 = Random(-341, 341);
          SetNpChar(4, npc->x, npc->y, v3, v2, 0, 0, 256);
        }
        PlaySoundObject(26, 1);
        SetQuake(10);
      }
      npc->act_no = 20;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      npc->bits |= 0x40u;
      npc->damage = 0;
    }
  }
LABEL_30:
  if ( npc->act_no > 4 )
  {
    npc->ym += 128;
    if ( npc->ym > 1535 )
      npc->ym = 1535;
    npc->y += npc->ym;
  }
  v4 = (Sint32 *)&v7[16 * npc->ani_no - 52];
  npc->rect.left = *v4;
  npc->rect.top = v4[1];
  npc->rect.right = v4[2];
  npc->rect.bottom = v4[3];
}


//----- (0808477F) --------------------------------------------------------
void __cdecl ActNpc247(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  char v3;
  int v4;
  int v5;
  NPCHAR_0 *v6;
  Sint32 *v7;
  RECT rcRight[9];
  RECT rcLeft[9];
  unsigned __int8 deg;
  int xm;
  int ym;
  char v13[24];

  qmemcpy(rcLeft, &ActNpc247(NPCHAR *)::C.5, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc247(NPCHAR *)::C.6, sizeof(rcRight));
  v1 = npc->act_no;
  if ( v1 == 111 )
  {
LABEL_60:
    ++npc->act_wait;
    if ( npc->act_wait & 1 )
      npc->ani_no = 5;
    else
      npc->ani_no = 6;
    if ( npc->act_wait > 30 )
    {
      npc->act_wait = 0;
      if ( ++npc->count1 % 3 )
        npc->act_no = 112;
      else
        npc->act_no = 113;
      npc->ani_no = 4;
    }
    goto LABEL_109;
  }
  if ( v1 > 111 )
  {
    if ( v1 != 151 )
    {
      if ( v1 > 151 )
      {
        if ( v1 == 1000 )
        {
          npc->bits &= 0xFFDFu;
          npc->act_no = 1001;
          npc->act_wait = 0;
          npc->ani_no = 4;
          npc->tgt_x = npc->x;
          npc->tgt_y = npc->y;
          npc->xm = 0;
          npc->ym = 0;
          DeleteNpCharCode(252, 1);
          SetNpChar(4, npc->x, npc->y, 0, 0, 0, 0, 256);
          SetNpChar(4, npc->x, npc->y, 0, 0, 0, 0, 256);
          SetNpChar(4, npc->x, npc->y, 0, 0, 0, 0, 256);
        }
        else
        {
          if ( v1 <= 1000 )
          {
            if ( v1 == 160 )
            {
              npc->act_no = 161;
              npc->act_wait = 0;
              npc->ani_no = 4;
              if ( x >= npc->x )
                npc->direct = 2;
              else
                npc->direct = 0;
            }
            else if ( v1 != 161 )
            {
              goto LABEL_109;
            }
            if ( npc->y >= npc->tgt_y )
              v4 = npc->ym - 32;
            else
              v4 = npc->ym + 32;
            npc->ym = v4;
            if ( npc->ym < -512 )
              npc->ym = -512;
            if ( npc->ym > 512 )
              npc->ym = 512;
            if ( !(++npc->act_wait % 24) )
            {
              SetNpChar(250, npc->x, npc->y + 2048, 0, 0, 0, 0, 256);
              PlaySoundObject(34, 1);
            }
            if ( npc->act_wait > 72 )
            {
              npc->act_wait = 0;
              npc->act_no = 100;
            }
            goto LABEL_109;
          }
          if ( v1 != 1001 )
          {
            if ( v1 == 1010 )
            {
              npc->ym += 16;
              if ( npc->flag & 8 )
              {
                npc->act_no = 1020;
                npc->ani_no = 8;
              }
            }
            goto LABEL_109;
          }
        }
        if ( ++npc->act_wait / 2 & 1 )
          v5 = npc->tgt_x + 512;
        else
          v5 = npc->tgt_x;
        npc->x = v5;
        goto LABEL_109;
      }
      if ( v1 == 113 )
      {
        if ( ++npc->act_wait == 10 )
        {
          ym = y - 0x8000;
          SetNpChar(279, x, y - 0x8000, 0, 0, 1, 0, 256);
        }
        if ( npc->act_wait > 30 )
        {
          npc->act_wait = 0;
          npc->act_no = 150;
        }
        goto LABEL_109;
      }
      if ( v1 < 113 )
      {
        if ( !(++npc->act_wait % 6) )
        {
          deg = GetArktan(npc->x - x, npc->y - y);
          v3 = Random(-4, 4);
          deg += v3;
          ym = 4 * GetSin(deg);
          xm = 4 * GetCos(deg);
          SetNpChar(248, npc->x, npc->y + 2048, xm, ym, 0, 0, 256);
          PlaySoundObject(34, 1);
        }
        if ( npc->act_wait > 30 )
        {
          npc->act_wait = 0;
          npc->act_no = 150;
        }
        goto LABEL_109;
      }
      if ( v1 == 120 || v1 != 150 )
        goto LABEL_109;
      npc->act_no = 151;
      npc->act_wait = 0;
      npc->ani_no = 7;
      SetNpChar(249, npc->x, npc->y, 0, 0, 0, 0, 256);
      SetNpChar(249, npc->x, npc->y, 0, 0, 2, 0, 256);
      npc->tgt_x = Random(9, 31) << 13;
      npc->tgt_y = Random(5, 7) << 13;
      PlaySoundObject(29, 1);
    }
    if ( ++npc->act_wait == 42 )
    {
      SetNpChar(249, npc->tgt_x + 0x2000, npc->tgt_y, 0, 0, 0, 0, 256);
      SetNpChar(249, npc->tgt_x - 0x2000, npc->tgt_y, 0, 0, 2, 0, 256);
    }
    if ( npc->act_wait > 50 )
    {
      npc->act_wait = 0;
      npc->ym = -512;
      npc->bits |= 0x20u;
      npc->x = npc->tgt_x;
      npc->y = npc->tgt_y;
      if ( npc->life <= 339 )
      {
        SetNpChar(252, 0, 0, 0, 0, 0, npc, 256);
        SetNpChar(252, 0, 0, 0, 0, 128, npc, 256);
      }
      if ( npc->life <= 179 )
      {
        SetNpChar(252, 0, 0, 0, 0, 64, npc, 256);
        SetNpChar(252, 0, 0, 0, 0, 192, npc, 256);
      }
      if ( x >= npc->x - 57344 && x <= npc->x + 57344 )
        npc->act_no = 100;
      else
        npc->act_no = 160;
    }
    goto LABEL_109;
  }
  if ( v1 == 21 )
  {
    if ( Random(0, 120) == 10 )
    {
      npc->act_no = 22;
      npc->act_wait = 0;
      npc->ani_no = 3;
    }
    goto LABEL_109;
  }
  if ( v1 > 21 )
  {
    if ( v1 == 100 )
    {
      npc->act_no = 101;
      npc->act_wait = 0;
      npc->ani_no = 0;
      npc->xm = 0;
      npc->bits |= 0x20u;
      npc->count2 = npc->life;
    }
    else
    {
      if ( v1 <= 100 )
      {
        if ( v1 == 22 && ++npc->act_wait > 8 )
        {
          npc->act_no = 21;
          npc->ani_no = 2;
        }
        goto LABEL_109;
      }
      if ( v1 != 101 )
      {
        if ( v1 != 110 )
          goto LABEL_109;
        npc->act_no = 111;
        npc->act_wait = 0;
        npc->xm = 0;
        npc->ym = 0;
        npc->bits &= 0xFFDFu;
        goto LABEL_60;
      }
    }
    if ( x >= npc->x )
      npc->direct = 2;
    else
      npc->direct = 0;
    if ( npc->y >= npc->tgt_y )
      v2 = npc->ym - 32;
    else
      v2 = npc->ym + 32;
    npc->ym = v2;
    if ( npc->ym < -512 )
      npc->ym = -512;
    if ( npc->ym > 512 )
      npc->ym = 512;
    if ( ++npc->act_wait > 200 || npc->life <= npc->count2 - 80 )
    {
      npc->act_wait = 0;
      npc->act_no = 110;
    }
    goto LABEL_109;
  }
  if ( v1 == 1 )
  {
LABEL_35:
    if ( Random(0, 120) == 10 )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
      npc->ani_no = 1;
    }
    goto LABEL_109;
  }
  if ( v1 <= 1 )
  {
    if ( v1 )
      goto LABEL_109;
    npc->act_no = 1;
    npc->y += 3072;
    npc->tgt_y = 0x8000;
    goto LABEL_35;
  }
  if ( v1 == 2 )
  {
    if ( ++npc->act_wait > 8 )
    {
      npc->act_no = 1;
      npc->ani_no = 0;
    }
  }
  else if ( v1 == 20 )
  {
    npc->xm = 0;
    npc->ym += 64;
    if ( npc->flag & 8 )
    {
      npc->act_no = 21;
      npc->ani_no = 2;
    }
  }
LABEL_109:
  if ( npc->xm < -512 )
    npc->xm = -512;
  if ( npc->xm > 512 )
    npc->xm = 512;
  if ( npc->ym < -1024 )
    npc->ym = -1024;
  if ( npc->ym > 1024 )
    npc->ym = 1024;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v6 = npc;
    v7 = (Sint32 *)&v13[16 * npc->ani_no - 300];
  }
  else
  {
    v6 = npc;
    v7 = (Sint32 *)&v13[16 * npc->ani_no - 156];
  }
  npc->rect.left = *v7;
  v6->rect.top = v7[1];
  v6->rect.right = v7[2];
  v6->rect.bottom = v7[3];
}


//----- (0808559B) --------------------------------------------------------
void __cdecl ActNpc248(NPCHAR_0 *npc)
{
  Sint32 *v1;
  RECT rect_left[3];
  char v3[8];

  if ( npc->flag & 0xFF )
  {
    npc->cond = 0;
    SetCaret(npc->x, npc->y, 2, 0);
  }
  npc->y += npc->ym;
  npc->x += npc->xm;
  rect_left[0].left = 0;
  rect_left[0].top = 48;
  rect_left[0].right = 16;
  rect_left[0].bottom = 64;
  rect_left[1].left = 16;
  rect_left[1].top = 48;
  rect_left[1].right = 32;
  rect_left[1].bottom = 64;
  rect_left[2].left = 32;
  rect_left[2].top = 48;
  rect_left[2].right = 48;
  rect_left[2].bottom = 64;
  if ( ++npc->ani_wait > 1 )
  {
    npc->ani_wait = 0;
    if ( ++npc->ani_no > 2 )
      npc->ani_no = 0;
  }
  v1 = (Sint32 *)&v3[16 * npc->ani_no - 48];
  npc->rect.left = *v1;
  npc->rect.top = v1[1];
  npc->rect.right = v1[2];
  npc->rect.bottom = v1[3];
  if ( ++npc->count1 > 300 )
  {
    npc->cond = 0;
    SetCaret(npc->x, npc->y, 2, 0);
  }
}


//----- (0808571A) --------------------------------------------------------
void __cdecl ActNpc249(NPCHAR_0 *npc)
{
  int v1;

  if ( ++npc->act_wait > 8 )
    npc->cond = 0;
  if ( npc->direct )
  {
    npc->rect.left = 64;
    npc->rect.top = 48;
    npc->rect.right = 80;
    npc->rect.bottom = 64;
    v1 = npc->x + 1024;
  }
  else
  {
    npc->rect.left = 48;
    npc->rect.top = 48;
    npc->rect.right = 64;
    npc->rect.bottom = 64;
    v1 = npc->x - 1024;
  }
  npc->x = v1;
}

//----- (080857E0) --------------------------------------------------------
void __cdecl ActNpc250(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  Sint32 *v4;
  RECT rc[3];
  char v6[8];

  rc[0].left = 0;
  rc[0].top = 32;
  rc[0].right = 16;
  rc[0].bottom = 48;
  rc[1].left = 16;
  rc[1].top = 32;
  rc[1].right = 32;
  rc[1].bottom = 48;
  rc[2].left = 32;
  rc[2].top = 32;
  rc[2].right = 48;
  rc[2].bottom = 48;
  v1 = npc->act_no;
  if ( v1 == 1 )
    goto LABEL_9;
  if ( v1 <= 1 )
  {
    if ( v1 )
      goto LABEL_37;
    npc->act_no = 1;
    npc->tgt_y = npc->y;
    npc->xm = 0;
    npc->ym = -512;
LABEL_9:
    if ( npc->x >= x )
      v2 = npc->xm - 16;
    else
      v2 = npc->xm + 16;
    npc->xm = v2;
    if ( npc->y >= npc->tgt_y )
      v3 = npc->ym - 32;
    else
      v3 = npc->ym + 32;
    npc->ym = v3;
    if ( npc->xm > 512 )
      npc->xm = 512;
    if ( npc->xm < -512 )
      npc->xm = -512;
    if ( npc->ym > 512 )
      npc->ym = 512;
    if ( npc->ym < -512 )
      npc->ym = -512;
    npc->x += npc->xm;
    npc->y += npc->ym;
    if ( ++npc->ani_wait > 2 )
    {
      npc->ani_wait = 0;
      ++npc->ani_no;
    }
    if ( npc->ani_no > 1 )
      npc->ani_no = 0;
    if ( x > npc->x - 4096 && x < npc->x + 4096 && y > npc->y )
      npc->act_no = 10;
    goto LABEL_37;
  }
  if ( v1 == 10 )
  {
    npc->act_no = 11;
    npc->act_wait = 0;
  }
  else if ( v1 != 11 )
  {
    goto LABEL_37;
  }
  if ( ++npc->act_wait > 10 )
  {
    SetNpChar(251, npc->x, npc->y, 0, 0, 0, 0, 256);
    PlaySoundObject(101, 1);
    npc->cond = 0;
    return;
  }
  if ( npc->act_wait / 2 & 1 )
    npc->ani_no = 2;
  else
    npc->ani_no = 1;
LABEL_37:
  v4 = (Sint32 *)&v6[16 * npc->ani_no - 48];
  npc->rect.left = *v4;
  npc->rect.top = v4[1];
  npc->rect.right = v4[2];
  npc->rect.bottom = v4[3];
}


//----- (08085B0A) --------------------------------------------------------
void __cdecl ActNpc251(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT rc[2];
  char v4[8];

  rc[0].left = 80;
  rc[0].top = 32;
  rc[0].right = 96;
  rc[0].bottom = 64;
  rc[1].left = 96;
  rc[1].top = 32;
  rc[1].right = 112;
  rc[1].bottom = 64;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_9;
  }
  else
  {
    npc->act_no = 1;
  }
  if ( ++npc->ani_no > 1 )
    npc->ani_no = 0;
  npc->y += 4096;
  if ( npc->flag & 0xFF )
  {
    SetDestroyNpChar(npc->x, npc->y, npc->view.back, 3);
    npc->cond = 0;
  }
LABEL_9:
  v2 = (Sint32 *)&v4[16 * npc->ani_no - 32];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
}


//----- (08085C0C) --------------------------------------------------------
void __cdecl ActNpc252(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  NPCHAR_0 *v4;
  Sint32 *v5;
  RECT rcRight[4];
  RECT rcLeft[4];
  unsigned __int8 deg;
  char v9[8];

  rcLeft[0].left = 48;
  rcLeft[0].top = 32;
  rcLeft[0].right = 64;
  rcLeft[0].bottom = 48;
  rcLeft[1].left = 112;
  rcLeft[1].top = 32;
  rcLeft[1].right = 128;
  rcLeft[1].bottom = 48;
  rcLeft[2].left = 128;
  rcLeft[2].top = 32;
  rcLeft[2].right = 144;
  rcLeft[2].bottom = 48;
  rcLeft[3].left = 144;
  rcLeft[3].top = 32;
  rcLeft[3].right = 160;
  rcLeft[3].bottom = 48;
  rcRight[0].left = 48;
  rcRight[0].top = 32;
  rcRight[0].right = 64;
  rcRight[0].bottom = 48;
  rcRight[1].left = 112;
  rcRight[1].top = 48;
  rcRight[1].right = 128;
  rcRight[1].bottom = 64;
  rcRight[2].left = 128;
  rcRight[2].top = 48;
  rcRight[2].right = 144;
  rcRight[2].bottom = 64;
  rcRight[3].left = 144;
  rcRight[3].top = 48;
  rcRight[3].right = 160;
  rcRight[3].bottom = 64;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_9:
    npc->count1 += 2;
    npc->count1 = (unsigned __int8)(((unsigned __int64)npc->count1 >> 56) + npc->count1)
                - ((unsigned int)(npc->count1 >> 31) >> 24);
    deg = npc->count1;
    if ( npc->act_wait <= 191 )
      ++npc->act_wait;
    v2 = npc->pNpc->x;
    npc->x = v2 + npc->act_wait * GetCos(deg) / 4;
    v3 = npc->pNpc->y;
    npc->y = v3 + npc->act_wait * GetSin(deg) / 4;
    if ( npc->pNpc->act_no == 151 )
    {
      npc->act_no = 10;
      npc->ani_no = 0;
    }
    goto LABEL_22;
  }
  if ( v1 <= 1 )
  {
    if ( v1 )
      goto LABEL_22;
    npc->act_no = 1;
    npc->act_wait = 0;
    npc->count1 = npc->direct;
    goto LABEL_9;
  }
  if ( v1 == 10 )
  {
    npc->act_no = 11;
    npc->bits |= 0x20u;
    npc->bits &= 0xFFFBu;
    npc->bits &= 0xFFF7u;
    deg = GetArktan(npc->x - x, npc->y - y);
    deg += Random(-3, 3);
    npc->xm = GetCos(deg);
    npc->ym = GetSin(deg);
    npc->ani_no = 1;
    npc->ani_wait = 0;
    if ( npc->x <= x )
      npc->direct = 2;
    else
      npc->direct = 0;
  }
  else if ( v1 != 11 )
  {
    goto LABEL_22;
  }
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->flag & 0xFF )
  {
    SetNpChar(4, npc->x, npc->y, 0, 0, 0, 0, 256);
    SetNpChar(4, npc->x, npc->y, 0, 0, 0, 0, 256);
    SetNpChar(4, npc->x, npc->y, 0, 0, 0, 0, 256);
    npc->cond = 0;
  }
  if ( ++npc->ani_wait > 4 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 3 )
    npc->ani_no = 1;
LABEL_22:
  if ( npc->direct )
  {
    v4 = npc;
    v5 = (Sint32 *)&v9[16 * npc->ani_no - 132];
  }
  else
  {
    v4 = npc;
    v5 = (Sint32 *)&v9[16 * npc->ani_no - 68];
  }
  npc->rect.left = *v5;
  v4->rect.top = v5[1];
  v4->rect.right = v5[2];
  v4->rect.bottom = v5[3];
}


//----- (080860FA) --------------------------------------------------------
void __cdecl ActNpc253(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT rc[2];
  char v4[8];

  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_9;
  }
  else
  {
    npc->act_no = 1;
  }
  if ( ++npc->ani_wait > 4 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 1 )
    npc->ani_no = 0;
LABEL_9:
  if ( npc->life <= 100 )
  {
    SetExpObjects(npc->x, npc->y, npc->code_flag);
    SetDestroyNpChar(npc->x, npc->y, npc->view.back, 8);
    PlaySoundObject(25, 1);
    npc->cond = 0;
  }
  rc[0].left = 0;
  rc[0].top = 64;
  rc[0].right = 16;
  rc[0].bottom = 80;
  rc[1].left = 16;
  rc[1].top = 64;
  rc[1].right = 32;
  rc[1].bottom = 80;
  v2 = (Sint32 *)&v4[16 * npc->ani_no - 32];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
}


//----- (0808623D) --------------------------------------------------------
void __cdecl ActNpc254(NPCHAR_0 *npc)
{
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      SetNpChar(255, npc->x + 9216, npc->y - 29184, 0, 0, 0, npc, 256);
      SetNpChar(255, npc->x - 0x4000, npc->y - 26624, 0, 0, 2, npc, 256);
      break;
    case 0x14:
      npc->act_wait = 0;
      npc->count1 = 60;
      npc->act_no = 21;
      break;
    case 0x1E:
      npc->act_no = 21;
      SetNpChar(223, npc->x - 5632, npc->y - 7168, 0, 0, 0, 0, 256);
      break;
    case 0x28:
      npc->act_no = 21;
      SetNpChar(223, npc->x - 4608, npc->y - 7168, 0, 0, 0, 0, 256);
      SetNpChar(40, npc->x - 11264, npc->y - 7168, 0, 0, 0, 0, 256);
      SetNpChar(93, npc->x - 17920, npc->y - 7168, 0, 0, 0, 0, 256);
      break;
    default:
      break;
  }
  if ( npc->direct )
  {
    npc->rect.left = 0;
    npc->rect.top = 64;
    npc->rect.right = 128;
    npc->rect.bottom = 128;
  }
  else
  {
    npc->rect.left = 0;
    npc->rect.top = 0;
    npc->rect.right = 128;
    npc->rect.bottom = 64;
  }
}

//----- (08086514) --------------------------------------------------------
void __cdecl ActNpc255(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  NPCHAR_0 *v3;
  RECT *v4;
  RECT rcRight[4];
  RECT rcLeft[4];

  rcLeft[0].left = 128;
  rcLeft[0].top = 0;
  rcLeft[0].right = 240;
  rcLeft[0].bottom = 16;
  rcLeft[1].left = 128;
  rcLeft[1].top = 16;
  rcLeft[1].right = 240;
  rcLeft[1].bottom = 32;
  rcLeft[2].left = 128;
  rcLeft[2].top = 32;
  rcLeft[2].right = 240;
  rcLeft[2].bottom = 48;
  rcLeft[3].left = 128;
  rcLeft[3].top = 16;
  rcLeft[3].right = 240;
  rcLeft[3].bottom = 32;
  rcRight[0].left = 240;
  rcRight[0].top = 0;
  rcRight[0].right = 320;
  rcRight[0].bottom = 16;
  rcRight[1].left = 240;
  rcRight[1].top = 16;
  rcRight[1].right = 320;
  rcRight[1].bottom = 32;
  rcRight[2].left = 240;
  rcRight[2].top = 32;
  rcRight[2].right = 320;
  rcRight[2].bottom = 48;
  rcRight[3].left = 240;
  rcRight[3].top = 16;
  rcRight[3].right = 320;
  rcRight[3].bottom = 32;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_11:
    if ( npc->pNpc->act_no > 19 )
      npc->act_no = 10;
    goto LABEL_16;
  }
  if ( v1 <= 1 )
  {
    if ( v1 )
      goto LABEL_16;
    npc->act_no = 1;
    if ( npc->direct )
    {
      npc->view.front = 20480;
      npc->view.back = 20480;
    }
    else
    {
      npc->view.front = 28672;
      npc->view.back = 28672;
    }
    goto LABEL_11;
  }
  if ( v1 == 10 )
  {
    npc->act_no = 11;
  }
  else if ( v1 != 11 )
  {
    goto LABEL_16;
  }
  if ( ++npc->ani_no > 3 )
    npc->ani_no = 0;
LABEL_16:
  if ( npc->direct )
  {
    npc->x = npc->pNpc->x - 0x4000;
    v2 = npc->pNpc->y - 26624;
  }
  else
  {
    npc->x = npc->pNpc->x + 9216;
    v2 = npc->pNpc->y - 29184;
  }
  npc->y = v2;
  if ( npc->direct )
  {
    v3 = npc;
    v4 = &rcRight[npc->ani_no];
  }
  else
  {
    v3 = npc;
    v4 = &rcLeft[npc->ani_no];
  }
  npc->rect.left = v4->left;
  v3->rect.top = v4->top;
  v3->rect.right = v4->right;
  v3->rect.bottom = v4->bottom;
}

//----- (08086788) --------------------------------------------------------
void __cdecl ActNpc256(NPCHAR_0 *npc)
{
  Sint32 *v1;
  RECT rcLeft[6];
  char v3[24];

  qmemcpy(rcLeft, &ActNpc256(NPCHAR *)::C.11, sizeof(rcLeft));
  switch ( npc->act_no )
  {
    case 0:
      gSuperXpos = 0;
      npc->act_no = 1;
      npc->y -= 4096;
      goto LABEL_3;
    case 1:
LABEL_3:
      npc->ani_no = 0;
      break;
    case 0xA:
      npc->act_no = 11;
      npc->ani_wait = 0;
      npc->ani_no = 0;
      npc->count1 = 0;
      goto LABEL_5;
    case 0xB:
LABEL_5:
      if ( ++npc->ani_wait > 5 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 1 )
      {
        npc->ani_no = 0;
        ++npc->count1;
      }
      if ( npc->count1 > 5 )
        npc->act_no = 1;
      break;
    case 0x14:
      npc->act_no = 21;
      goto LABEL_12;
    case 0x15:
LABEL_12:
      npc->ani_no = 2;
      break;
    case 0x28:
      npc->act_no = 41;
      SetNpChar(257, npc->x - 7168, npc->y - 0x2000, 0, 0, 0, 0, 256);
      SetNpChar(257, npc->x - 7168, npc->y - 0x2000, 0, 0, 2, 0, 170);
      goto LABEL_14;
    case 0x29:
LABEL_14:
      npc->ani_no = 4;
      break;
    case 0x32:
      npc->act_no = 51;
      npc->ani_wait = 0;
      npc->ani_no = 4;
      npc->count1 = 0;
      goto LABEL_16;
    case 0x33:
LABEL_16:
      if ( ++npc->ani_wait > 5 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 5 )
      {
        npc->ani_no = 4;
        ++npc->count1;
      }
      if ( npc->count1 > 5 )
        npc->act_no = 41;
      break;
    default:
      break;
  }
  v1 = (Sint32 *)&v3[16 * npc->ani_no - 96];
  npc->rect.left = *v1;
  npc->rect.top = v1[1];
  npc->rect.right = v1[2];
  npc->rect.bottom = v1[3];
}


//----- (08086A39) --------------------------------------------------------
void __cdecl ActNpc257(NPCHAR_0 *npc)
{
  int v1;
  RECT *v2;
  RECT rc[3];

  rc[0].left = 176;
  rc[0].top = 32;
  rc[0].right = 184;
  rc[0].bottom = 48;
  rc[1].left = 184;
  rc[1].top = 32;
  rc[1].right = 192;
  rc[1].bottom = 48;
  rc[2].left = 0;
  rc[2].top = 0;
  rc[2].right = 0;
  rc[2].bottom = 0;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    if ( gSuperXpos )
      npc->act_no = 10;
    goto LABEL_24;
  }
  if ( v1 != 10 )
  {
    if ( v1 )
      goto LABEL_24;
    npc->act_no = 1;
    goto LABEL_5;
  }
  if ( npc->x < gSuperXpos )
    npc->xm += 85;
  if ( npc->x > gSuperXpos )
    npc->xm -= 85;
  if ( npc->y < gSuperYpos )
    npc->ym += 85;
  if ( npc->y > gSuperYpos )
    npc->ym -= 85;
  if ( npc->xm > 1024 )
    npc->xm = 1024;
  if ( npc->xm < -1024 )
    npc->xm = -1024;
  if ( npc->ym > 1024 )
    npc->ym = 1024;
  if ( npc->ym < -1024 )
    npc->ym = -1024;
  npc->x += npc->xm;
  npc->y += npc->ym;
LABEL_24:
  if ( ++npc->ani_wait > 3 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 1 )
    npc->ani_no = 0;
  if ( !npc->direct && npc->xm > 0 )
    npc->ani_no = 2;
  if ( npc->direct == 2 && npc->xm < 0 )
    npc->ani_no = 2;
  v2 = &rc[npc->ani_no];
  npc->rect.left = v2->left;
  npc->rect.top = v2->top;
  npc->rect.right = v2->right;
  npc->rect.bottom = v2->bottom;
}

//----- (08086C81) --------------------------------------------------------
void __cdecl ActNpc258(NPCHAR_0 *npc)
{
  npc->rect.left = 48;
  npc->rect.top = 32;
  npc->rect.right = 64;
  npc->rect.bottom = 48;
}

//----- (08086CC0) --------------------------------------------------------
void __cdecl ActNpc259(NPCHAR_0 *npc)
{
  unsigned __int16 v1;

  switch ( npc->act_no )
  {
    case 0:
      v1 = npc->bits;
      HIBYTE(v1) &= 0xDFu;
      npc->bits = v1;
      npc->act_no = 1;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( dir )
        npc->direct = 2;
      else
        npc->direct = 0;
      npc->y = y - 2048;
      if ( npc->direct )
      {
        npc->x = x - 1536;
        npc->rect.left = 224;
        npc->rect.top = 112;
        npc->rect.right = 240;
        npc->rect.bottom = 128;
      }
      else
      {
        npc->x = x + 1536;
        npc->rect.left = 224;
        npc->rect.top = 96;
        npc->rect.right = 240;
        npc->rect.bottom = 112;
      }
      if ( unk_81C85C0 & 1 )
        ++npc->rect.top;
      break;
    case 0xA:
      npc->act_no = 11;
      npc->xm = 64;
      npc->ym = -32;
      npc->rect.left = 224;
      npc->rect.top = 96;
      npc->rect.right = 240;
      npc->rect.bottom = 112;
      break;
    case 0xB:
      if ( npc->y <= 0x7FFF )
        npc->ym = 32;
      npc->x += npc->xm;
      npc->y += npc->ym;
      break;
    case 0x14:
      VanishNpChar(npc);
      SetDestroyNpCharUp(npc->x, npc->y, 0x2000, 64);
      break;
    default:
      return;
  }
}

//----- (08086EA0) --------------------------------------------------------
void __cdecl ShootBullet_Frontia1(int level)
{
  signed int bul_no;

  switch ( level )
  {
    case 2:
      bul_no = 2;
      break;
    case 3:
      bul_no = 3;
      break;
    case 1:
      bul_no = 1;
      break;
  }
  if ( CountArmsBullet(1) <= 3 && gKeyTrg & gKeyShot )
  {
    if ( (unsigned __int8)UseArmsEnergy(1) ^ 1 )
    {
      ChangeToFirstArms();
    }
    else
    {
      if ( unk_81C858C )
      {
        if ( dir )
        {
          SetBullet(bul_no, x + 1536, y - 5120, 1);
          SetCaret(x + 1536, y - 5120, 3, 0);
        }
        else
        {
          SetBullet(bul_no, x - 1536, y - 5120, 1);
          SetCaret(x - 1536, y - 5120, 3, 0);
        }
      }
      else if ( unk_81C8590 )
      {
        if ( dir )
        {
          SetBullet(bul_no, x + 1536, y + 5120, 3);
          SetCaret(x + 1536, y + 5120, 3, 0);
        }
        else
        {
          SetBullet(bul_no, x - 1536, y + 5120, 3);
          SetCaret(x - 1536, y + 5120, 3, 0);
        }
      }
      else if ( dir )
      {
        SetBullet(bul_no, x + 3072, y + 1024, 2);
        SetCaret(x + 6144, y + 1024, 3, 0);
      }
      else
      {
        SetBullet(bul_no, x - 3072, y + 1024, 0);
        SetCaret(x - 6144, y + 1024, 3, 0);
      }
      PlaySoundObject(33, 1);
    }
  }
}

//----- (080871C7) --------------------------------------------------------
void __cdecl ShootBullet_PoleStar(int level)
{
  signed int bul_no;

  switch ( level )
  {
    case 2:
      bul_no = 5;
      break;
    case 3:
      bul_no = 6;
      break;
    case 1:
      bul_no = 4;
      break;
  }
  if ( CountArmsBullet(2) <= 1 && gKeyTrg & gKeyShot )
  {
    if ( (unsigned __int8)UseArmsEnergy(1) ^ 1 )
    {
      PlaySoundObject(37, 1);
    }
    else
    {
      if ( unk_81C858C )
      {
        if ( dir )
        {
          SetBullet(bul_no, x + 512, y - 4096, 1);
          SetCaret(x + 512, y - 4096, 3, 0);
        }
        else
        {
          SetBullet(bul_no, x - 512, y - 4096, 1);
          SetCaret(x - 512, y - 4096, 3, 0);
        }
      }
      else if ( unk_81C8590 )
      {
        if ( dir )
        {
          SetBullet(bul_no, x + 512, y + 4096, 3);
          SetCaret(x + 512, y + 4096, 3, 0);
        }
        else
        {
          SetBullet(bul_no, x - 512, y + 4096, 3);
          SetCaret(x - 512, y + 4096, 3, 0);
        }
      }
      else if ( dir )
      {
        SetBullet(bul_no, x + 3072, y + 1536, 2);
        SetCaret(x + 6144, y + 1536, 3, 0);
      }
      else
      {
        SetBullet(bul_no, x - 3072, y + 1536, 0);
        SetCaret(x - 6144, y + 1536, 3, 0);
      }
      if ( level == 3 )
        PlaySoundObject(49, 1);
      else
        PlaySoundObject(32, 1);
    }
  }
}

//----- (08087519) --------------------------------------------------------
void __cdecl ShootBullet_FireBall(int level)
{
  signed int bul_no;

  switch ( level )
  {
    case 2:
      if ( CountArmsBullet(3) > 2 )
        return;
      bul_no = 8;
      break;
    case 3:
      if ( CountArmsBullet(3) > 3 )
        return;
      bul_no = 9;
      break;
    case 1:
      if ( CountArmsBullet(3) > 1 )
        return;
      bul_no = 7;
      break;
  }
  if ( gKeyTrg & gKeyShot )
  {
    if ( (unsigned __int8)UseArmsEnergy(1) ^ 1 )
    {
      ChangeToFirstArms();
    }
    else
    {
      if ( unk_81C858C )
      {
        if ( dir )
        {
          SetBullet(bul_no, x + 2048, y - 4096, 1);
          SetCaret(x + 2048, y - 4096, 3, 0);
        }
        else
        {
          SetBullet(bul_no, x - 2048, y - 4096, 1);
          SetCaret(x - 2048, y - 4096, 3, 0);
        }
      }
      else if ( unk_81C8590 )
      {
        if ( dir )
        {
          SetBullet(bul_no, x + 2048, y + 4096, 3);
          SetCaret(x + 2048, y + 4096, 3, 0);
        }
        else
        {
          SetBullet(bul_no, x - 2048, y + 4096, 3);
          SetCaret(x - 2048, y + 4096, 3, 0);
        }
      }
      else if ( dir )
      {
        SetBullet(bul_no, x + 3072, y + 1024, 2);
        SetCaret(x + 6144, y + 1024, 3, 0);
      }
      else
      {
        SetBullet(bul_no, x - 3072, y + 1024, 0);
        SetCaret(x - 6144, y + 1024, 3, 0);
      }
      PlaySoundObject(34, 1);
    }
  }
}

//----- (0808787A) --------------------------------------------------------
void __cdecl ShootBullet_Machinegun1(int level)
{
  signed int bul_no;

  if ( CountArmsBullet(4) <= 4 )
  {
    switch ( level )
    {
      case 2:
        bul_no = 11;
        break;
      case 3:
        bul_no = 12;
        break;
      case 1:
        bul_no = 10;
        break;
    }
    if ( !(gKey & gKeyShot) )
      unk_81C8612 = 6;
    if ( gKey & gKeyShot )
    {
      if ( ++unk_81C8612 > 5u )
      {
        unk_81C8612 = 0;
        if ( (unsigned __int8)UseArmsEnergy(1) ^ 1 )
        {
          PlaySoundObject(37, 1);
          if ( !_empty )
          {
            SetCaret(x, y, 16, 0);
            _empty = 50;
          }
        }
        else
        {
          if ( unk_81C858C )
          {
            if ( level == 3 )
              unk_81C85B8 += 256;
            if ( dir )
            {
              SetBullet(bul_no, x + 1536, y - 4096, 1);
              SetCaret(x + 1536, y - 4096, 3, 0);
            }
            else
            {
              SetBullet(bul_no, x - 1536, y - 4096, 1);
              SetCaret(x - 1536, y - 4096, 3, 0);
            }
          }
          else if ( unk_81C8590 )
          {
            if ( level == 3 )
            {
              if ( unk_81C85B8 > 0 )
                unk_81C85B8 /= 2;
              if ( unk_81C85B8 >= -1023 )
              {
                unk_81C85B8 -= 512;
                if ( unk_81C85B8 < -1024 )
                  unk_81C85B8 = -1024;
              }
            }
            if ( dir )
            {
              SetBullet(bul_no, x + 1536, y + 4096, 3);
              SetCaret(x + 1536, y + 4096, 3, 0);
            }
            else
            {
              SetBullet(bul_no, x - 1536, y + 4096, 3);
              SetCaret(x - 1536, y + 4096, 3, 0);
            }
          }
          else if ( dir )
          {
            SetBullet(bul_no, x + 6144, y + 1536, 2);
            SetCaret(x + 6144, y + 1536, 3, 0);
          }
          else
          {
            SetBullet(bul_no, x - 6144, y + 1536, 0);
            SetCaret(x - 6144, y + 1536, 3, 0);
          }
          if ( level == 3 )
            PlaySoundObject(49, 1);
          else
            PlaySoundObject(32, 1);
        }
      }
    }
    else
    {
      ++ShootBullet_Machinegun1(long)::wait;
      if ( unk_81C8598 & 8 )
      {
        if ( ShootBullet_Machinegun1(long)::wait > 1 )
        {
          ShootBullet_Machinegun1(long)::wait = 0;
          ChargeArmsEnergy(1);
        }
      }
      else if ( ShootBullet_Machinegun1(long)::wait > 4 )
      {
        ShootBullet_Machinegun1(long)::wait = 0;
        ChargeArmsEnergy(1);
      }
    }
  }
}

//----- (08087D16) --------------------------------------------------------
void __cdecl ShootBullet_Missile(int level, bool bSuper)
{
  signed int bul_no;

  if ( bSuper )
  {
    switch ( level )
    {
      case 2:
        bul_no = 29;
        break;
      case 3:
        bul_no = 30;
        break;
      case 1:
        bul_no = 28;
        break;
    }
    if ( level == 2 )
    {
      if ( CountArmsBullet(10) > 1 || CountArmsBullet(11) > 1 )
        return;
    }
    else if ( level == 3 )
    {
      if ( CountArmsBullet(10) > 3 || CountArmsBullet(11) > 3 )
        return;
    }
    else if ( level == 1 && (CountArmsBullet(10) > 0 || CountArmsBullet(11) > 0) )
    {
      return;
    }
  }
  else
  {
    switch ( level )
    {
      case 2:
        bul_no = 14;
        break;
      case 3:
        bul_no = 15;
        break;
      case 1:
        bul_no = 13;
        break;
    }
    if ( level == 2 )
    {
      if ( CountArmsBullet(5) > 1 || CountArmsBullet(6) > 1 )
        return;
    }
    else if ( level == 3 )
    {
      if ( CountArmsBullet(5) > 3 || CountArmsBullet(6) > 3 )
        return;
    }
    else if ( level == 1 && (CountArmsBullet(5) > 0 || CountArmsBullet(6) > 0) )
    {
      return;
    }
  }
  if ( !(gKeyTrg & gKeyShot) )
    return;
  if ( level <= 2 )
  {
    if ( (unsigned __int8)UseArmsEnergy(1) ^ 1 )
    {
      PlaySoundObject(37, 1);
      if ( !_empty )
      {
        SetCaret(x, y, 16, 0);
        _empty = 50;
      }
      return;
    }
    if ( unk_81C858C )
    {
      if ( dir )
      {
        SetBullet(bul_no, x + 512, y - 4096, 1);
        SetCaret(x + 512, y - 4096, 3, 0);
      }
      else
      {
        SetBullet(bul_no, x - 512, y - 4096, 1);
        SetCaret(x - 512, y - 4096, 3, 0);
      }
    }
    else if ( unk_81C8590 )
    {
      if ( dir )
      {
        SetBullet(bul_no, x + 512, y + 4096, 3);
        SetCaret(x + 512, y + 4096, 3, 0);
      }
      else
      {
        SetBullet(bul_no, x - 512, y + 4096, 3);
        SetCaret(x - 512, y + 4096, 3, 0);
      }
    }
    else if ( dir )
    {
      SetBullet(bul_no, x + 3072, y, 2);
      SetCaret(x + 6144, y, 3, 0);
    }
    else
    {
      SetBullet(bul_no, x - 3072, y, 0);
      SetCaret(x - 6144, y, 3, 0);
    }
LABEL_68:
    PlaySoundObject(32, 1);
    return;
  }
  if ( !((unsigned __int8)UseArmsEnergy(1) ^ 1) )
  {
    if ( unk_81C858C )
    {
      if ( dir )
      {
        SetBullet(bul_no, x + 512, y - 4096, 1);
        SetCaret(x + 512, y - 4096, 3, 0);
      }
      else
      {
        SetBullet(bul_no, x - 512, y - 4096, 1);
        SetCaret(x - 512, y - 4096, 3, 0);
      }
      SetBullet(bul_no, x + 1536, y, 1);
      SetBullet(bul_no, x - 1536, y, 1);
    }
    else if ( unk_81C8590 )
    {
      if ( dir )
      {
        SetBullet(bul_no, x + 512, y + 4096, 3);
        SetCaret(x + 512, y + 4096, 3, 0);
        SetBullet(bul_no, x - 1536, y, 3);
        SetBullet(bul_no, x + 1536, y, 3);
      }
      else
      {
        SetBullet(bul_no, x - 512, y + 4096, 3);
        SetCaret(x - 512, y + 4096, 3, 0);
        SetBullet(bul_no, x + 1536, y, 3);
        SetBullet(bul_no, x - 1536, y, 3);
      }
    }
    else if ( dir )
    {
      SetBullet(bul_no, x + 3072, y + 512, 2);
      SetCaret(x + 6144, y + 512, 3, 0);
      SetBullet(bul_no, x, y - 4096, 2);
      SetBullet(bul_no, x - 2048, y - 512, 2);
    }
    else
    {
      SetBullet(bul_no, x - 3072, y + 512, 0);
      SetCaret(x - 6144, y + 512, 3, 0);
      SetBullet(bul_no, x, y - 4096, 0);
      SetBullet(bul_no, x + 2048, y - 512, 0);
    }
    goto LABEL_68;
  }
  PlaySoundObject(37, 1);
  if ( !_empty )
  {
    SetCaret(x, y, 16, 0);
    _empty = 50;
  }
}

//----- (08088768) --------------------------------------------------------
void ShootBullet_Bubblin1()
{
  if ( CountArmsBullet(7) <= 3 )
  {
    if ( gKeyTrg & gKeyShot )
    {
      if ( (unsigned __int8)UseArmsEnergy(1) ^ 1 )
      {
        PlaySoundObject(37, 1);
        if ( !_empty )
        {
          SetCaret(x, y, 16, 0);
          _empty = 50;
        }
      }
      else
      {
        if ( unk_81C858C )
        {
          if ( dir )
          {
            SetBullet(19, x + 512, y - 1024, 1);
            SetCaret(x + 512, y - 1024, 3, 0);
          }
          else
          {
            SetBullet(19, x - 512, y - 1024, 1);
            SetCaret(x - 512, y - 1024, 3, 0);
          }
        }
        else if ( unk_81C8590 )
        {
          if ( dir )
          {
            SetBullet(19, x + 512, y + 1024, 3);
            SetCaret(x + 512, y + 1024, 3, 0);
          }
          else
          {
            SetBullet(19, x - 512, y + 1024, 3);
            SetCaret(x - 512, y + 1024, 3, 0);
          }
        }
        else if ( dir )
        {
          SetBullet(19, x + 3072, y + 1536, 2);
          SetCaret(x + 6144, y + 1536, 3, 0);
        }
        else
        {
          SetBullet(19, x - 3072, y + 1536, 0);
          SetCaret(x - 6144, y + 1536, 3, 0);
        }
        PlaySoundObject(48, 1);
      }
    }
    else if ( ++ShootBullet_Bubblin1(void)::wait > 20 )
    {
      ShootBullet_Bubblin1(void)::wait = 0;
      ChargeArmsEnergy(1);
    }
  }
}

//----- (08088AE9) --------------------------------------------------------
void __cdecl ShootBullet_Bubblin2(int level)
{
  int levela;

  if ( CountArmsBullet(7) <= 15 )
  {
    levela = level + 18;
    if ( !(gKey & gKeyShot) )
      unk_81C8612 = 6;
    if ( gKey & gKeyShot )
    {
      if ( ++unk_81C8612 > 6u )
      {
        unk_81C8612 = 0;
        if ( (unsigned __int8)UseArmsEnergy(1) ^ 1 )
        {
          PlaySoundObject(37, 1);
          if ( !_empty )
          {
            SetCaret(x, y, 16, 0);
            _empty = 50;
          }
        }
        else
        {
          if ( unk_81C858C )
          {
            if ( dir )
            {
              SetBullet(levela, x + 1536, y - 4096, 1);
              SetCaret(x + 1536, y - 0x2000, 3, 0);
            }
            else
            {
              SetBullet(levela, x - 1536, y - 4096, 1);
              SetCaret(x - 1536, y - 0x2000, 3, 0);
            }
          }
          else if ( unk_81C8590 )
          {
            if ( dir )
            {
              SetBullet(levela, x + 1536, y + 4096, 3);
              SetCaret(x + 1536, y + 0x2000, 3, 0);
            }
            else
            {
              SetBullet(levela, x - 1536, y + 4096, 3);
              SetCaret(x - 1536, y + 0x2000, 3, 0);
            }
          }
          else if ( dir )
          {
            SetBullet(levela, x + 3072, y + 1536, 2);
            SetCaret(x + 6144, y + 1536, 3, 0);
          }
          else
          {
            SetBullet(levela, x - 3072, y + 1536, 0);
            SetCaret(x - 6144, y + 1536, 3, 0);
          }
          PlaySoundObject(48, 1);
        }
      }
    }
    else if ( ++ShootBullet_Bubblin2(long)::wait > 1 )
    {
      ShootBullet_Bubblin2(long)::wait = 0;
      ChargeArmsEnergy(1);
    }
  }
}

//----- (08088EA8) --------------------------------------------------------
void __cdecl ShootBullet_Sword(int level)
{
  signed int bul_no;

  if ( CountArmsBullet(9) <= 0 )
  {
    switch ( level )
    {
      case 2:
        bul_no = 26;
        break;
      case 3:
        bul_no = 27;
        break;
      case 1:
        bul_no = 25;
        break;
    }
    if ( gKeyTrg & gKeyShot )
    {
      if ( unk_81C858C )
      {
        if ( dir )
          SetBullet(bul_no, x + 512, y + 2048, 1);
        else
          SetBullet(bul_no, x - 512, y + 2048, 1);
      }
      else if ( unk_81C8590 )
      {
        if ( dir )
          SetBullet(bul_no, x + 512, y - 3072, 3);
        else
          SetBullet(bul_no, x - 512, y - 3072, 3);
      }
      else if ( dir )
      {
        SetBullet(bul_no, x - 3072, y - 1536, 2);
      }
      else
      {
        SetBullet(bul_no, x + 3072, y - 1536, 0);
      }
      PlaySoundObject(34, 1);
    }
  }
}

//----- (08089080) --------------------------------------------------------
void __cdecl ShootBullet_Nemesis(int level)
{
  signed int bul_no;

  switch ( level )
  {
    case 2:
      bul_no = 35;
      break;
    case 3:
      bul_no = 36;
      break;
    case 1:
      bul_no = 34;
      break;
  }
  if ( CountArmsBullet(12) <= 1 && gKeyTrg & gKeyShot )
  {
    if ( (unsigned __int8)UseArmsEnergy(1) ^ 1 )
    {
      PlaySoundObject(37, 1);
    }
    else
    {
      if ( unk_81C858C )
      {
        if ( dir )
        {
          SetBullet(bul_no, x + 512, y - 6144, 1);
          SetCaret(x + 512, y - 6144, 3, 0);
        }
        else
        {
          SetBullet(bul_no, x - 512, y - 6144, 1);
          SetCaret(x - 512, y - 6144, 3, 0);
        }
      }
      else if ( unk_81C8590 )
      {
        if ( dir )
        {
          SetBullet(bul_no, x + 512, y + 6144, 3);
          SetCaret(x + 512, y + 6144, 3, 0);
        }
        else
        {
          SetBullet(bul_no, x - 512, y + 6144, 3);
          SetCaret(x - 512, y + 6144, 3, 0);
        }
      }
      else if ( dir )
      {
        SetBullet(bul_no, x + 11264, y + 1536, 2);
        SetCaret(x + 0x2000, y + 1536, 3, 0);
      }
      else
      {
        SetBullet(bul_no, x - 11264, y + 1536, 0);
        SetCaret(x - 0x2000, y + 1536, 3, 0);
      }
      switch ( level )
      {
        case 2:
          PlaySoundObject(49, 1);
          break;
        case 3:
          PlaySoundObject(60, 1);
          break;
        case 1:
          PlaySoundObject(117, 1);
          break;
      }
    }
  }
}

//----- (080893F4) --------------------------------------------------------
void ResetSpurCharge()
{
  _spur_charge = 0;
  if ( gArmsData[gSelectedArms].code == 13 )
    ZeroExpMyChar();
}

//----- (08089426) --------------------------------------------------------
void __cdecl ShootBullet_Spur(int level)
{
  bool v1;
  signed int bul_no;
  bool bShot;

  bShot = 0;
  if ( gKey & gKeyShot )
  {
    if ( unk_81C8598 & 8 )
      AddExpMyChar(3);
    else
      AddExpMyChar(2);
    if ( ++_spur_charge / 2 & 1 )
    {
      switch ( level )
      {
        case 2:
          PlaySoundObject(60, 1);
          break;
        case 3:
          if ( (unsigned __int8)IsMaxExpMyChar() ^ 1 )
            PlaySoundObject(61, 1);
          break;
        case 1:
          PlaySoundObject(59, 1);
          break;
      }
    }
  }
  else
  {
    if ( _spur_charge )
      bShot = 1;
    _spur_charge = 0;
  }
  if ( (unsigned __int8)IsMaxExpMyChar() )
  {
    if ( ShootBullet_Spur(long)::_bMax != 1 )
    {
      ShootBullet_Spur(long)::_bMax = 1;
      PlaySoundObject(65, 1);
    }
  }
  else
  {
    ShootBullet_Spur(long)::_bMax = 0;
  }
  if ( !(gKey & gKeyShot) )
    ZeroExpMyChar();
  switch ( level )
  {
    case 2:
      bul_no = 37;
      break;
    case 3:
      if ( ShootBullet_Spur(long)::_bMax )
        bul_no = 39;
      else
        bul_no = 38;
      break;
    case 1:
      bul_no = 6;
      bShot = 0;
      break;
  }
  v1 = CountArmsBullet(13) > 0 || CountArmsBullet(14) > 0;
  if ( !v1 && (gKeyTrg & gKeyShot || bShot) )
  {
    if ( (unsigned __int8)UseArmsEnergy(1) ^ 1 )
    {
      PlaySoundObject(37, 1);
    }
    else
    {
      if ( unk_81C858C )
      {
        if ( dir )
        {
          SetBullet(bul_no, x + 512, y - 4096, 1);
          SetCaret(x + 512, y - 4096, 3, 0);
        }
        else
        {
          SetBullet(bul_no, x - 512, y - 4096, 1);
          SetCaret(x - 512, y - 4096, 3, 0);
        }
      }
      else if ( unk_81C8590 )
      {
        if ( dir )
        {
          SetBullet(bul_no, x + 512, y + 4096, 3);
          SetCaret(x + 512, y + 4096, 3, 0);
        }
        else
        {
          SetBullet(bul_no, x - 512, y + 4096, 3);
          SetCaret(x - 512, y + 4096, 3, 0);
        }
      }
      else if ( dir )
      {
        SetBullet(bul_no, x + 3072, y + 1536, 2);
        SetCaret(x + 6144, y + 1536, 3, 0);
      }
      else
      {
        SetBullet(bul_no, x - 3072, y + 1536, 0);
        SetCaret(x - 6144, y + 1536, 3, 0);
      }
      if ( bul_no == 37 )
      {
        PlaySoundObject(62, 1);
      }
      else if ( bul_no > 37 )
      {
        if ( bul_no == 38 )
        {
          PlaySoundObject(63, 1);
        }
        else if ( bul_no == 39 )
        {
          PlaySoundObject(64, 1);
        }
      }
      else if ( bul_no == 6 )
      {
        PlaySoundObject(49, 1);
      }
    }
  }
}

//----- (0808992D) --------------------------------------------------------
void ShootBullet()
{
  int v0;
  int v1;

  if ( _empty )
    --_empty;
  if ( ShootBullet(void)::soft_rensha )
    --ShootBullet(void)::soft_rensha;
  if ( gKeyTrg & gKeyShot )
  {
    if ( ShootBullet(void)::soft_rensha )
      return;
    ShootBullet(void)::soft_rensha = 4;
  }
  if ( !(gMC.cond & 2) )
  {
    switch ( gArmsData[gSelectedArms].code )
    {
      case 1:
        ShootBullet_Frontia1(gArmsData[gSelectedArms].level);
        break;
      case 2:
        ShootBullet_PoleStar(gArmsData[gSelectedArms].level);
        break;
      case 3:
        ShootBullet_FireBall(gArmsData[gSelectedArms].level);
        break;
      case 4:
        ShootBullet_Machinegun1(gArmsData[gSelectedArms].level);
        break;
      case 5:
        ShootBullet_Missile(gArmsData[gSelectedArms].level, 0);
        break;
      case 7:
        v0 = gArmsData[gSelectedArms].level;
        switch ( v0 )
        {
          case 2:
            ShootBullet_Bubblin2(2);
            break;
          case 3:
            ShootBullet_Bubblin2(3);
            break;
          case 1:
            ShootBullet_Bubblin1();
            break;
        }
        break;
      case 9:
        v1 = gArmsData[gSelectedArms].level;
        switch ( v1 )
        {
          case 2:
            ShootBullet_Sword(2);
            break;
          case 3:
            ShootBullet_Sword(3);
            break;
          case 1:
            ShootBullet_Sword(1);
            break;
        }
        break;
      case 0xA:
        ShootBullet_Missile(gArmsData[gSelectedArms].level, 1);
        break;
      case 0xC:
        ShootBullet_Nemesis(gArmsData[gSelectedArms].level);
        break;
      case 0xD:
        ShootBullet_Spur(gArmsData[gSelectedArms].level);
        break;
      default:
        return;
    }
  }
}

//----- (08089B98) --------------------------------------------------------
void MakeWaveTables()
{
  float v0;
  int v1;
  int i;
  int ia;
  int ib;
  int ic;
  int id;
  int ie;
  int a;
  int aa;
  int ab;

  for ( i = 0; i <= 255; ++i )
  {
    v0 = (long double)i * 6.2831841 / 256.0;
    gWaveModelTable[i] = (signed __int16)(sinf(v0) * 64.0);
    v1 = gWaveModelTable[i];
  }
  a = 0;
  for ( ia = 0; ia <= 63; ++ia )
    *(_BYTE *)(ia + 136098560) = (a++ << 6) / 64;
  aa = 0;
  while ( ia <= 191 )
    *(_BYTE *)(ia++ + 136098560) = 64 - (aa++ << 6) / 64;
  ab = 0;
  while ( ia <= 255 )
    *(_BYTE *)(ia++ + 136098560) = (ab++ << 6) / 64 - 64;
  for ( ib = 0; ib <= 255; ++ib )
    *(_BYTE *)(ib + 136098816) = ib / 2 - 64;
  for ( ic = 0; ic <= 255; ++ic )
    *(_BYTE *)(ic + 136099072) = 64 - ic / 2;
  for ( id = 0; id <= 127; ++id )
    *(_BYTE *)(id + 136099328) = 64;
  while ( id <= 255 )
    *(_BYTE *)(id++ + 136099328) = -64;
  srand(0);
  for ( ie = 0; ie <= 255; ++ie )
    *(_BYTE *)(ie + 136099584) = (char)rand() / 2;
}

//----- (08089DCB) --------------------------------------------------------
signed int __cdecl MakePixelWaveData($296577AB1FDEBC0CA4D43AF2DF231431 *ptp, unsigned __int8 *pData)
{
  long double v2;
  char envelopeTable[256];
  int i;
  int a;
  int b;
  int c;
  int d;
  float dPitch;
  float dMain;
  float dVolume;
  float dEnvelope;
  float d1;
  float d2;
  float d3;

  if ( wave_tables_made != 1 )
  {
    MakeWaveTables();
    wave_tables_made = 1;
  }
  memset(envelopeTable, 0, 0x100u);
  i = 0;
  dEnvelope = (long double)ptp->initial;
  while ( ptp->pointAx > i )
  {
    envelopeTable[i] = (signed __int16)dEnvelope;
    dEnvelope = ((long double)ptp->pointAy - (long double)ptp->initial) / (long double)ptp->pointAx + dEnvelope;
    ++i;
  }
  dEnvelope = (long double)ptp->pointAy;
  while ( ptp->pointBx > i )
  {
    envelopeTable[i] = (signed __int16)dEnvelope;
    dEnvelope = ((long double)ptp->pointBy - (long double)ptp->pointAy) / (long double)(ptp->pointBx - ptp->pointAx)
              + dEnvelope;
    ++i;
  }
  dEnvelope = (long double)ptp->pointBy;
  while ( ptp->pointCx > i )
  {
    envelopeTable[i] = (signed __int16)dEnvelope;
    dEnvelope = ((long double)ptp->pointCy - (long double)ptp->pointBy) / (long double)(ptp->pointCx - ptp->pointBx)
              + dEnvelope;
    ++i;
  }
  dEnvelope = (long double)ptp->pointCy;
  while ( i <= 255 )
  {
    envelopeTable[i] = (signed __int16)dEnvelope;
    dEnvelope = dEnvelope - (long double)ptp->pointCy / (long double)(256 - ptp->pointCx);
    ++i;
  }
  dPitch = (long double)ptp->oPitch.offset;
  dMain = (long double)ptp->oMain.offset;
  dVolume = (long double)ptp->oVolume.offset;
  if ( ptp->oMain.num == 0.0 )
    d1 = 0.0;
  else
    d1 = 256.0 / ((long double)ptp->size / ptp->oMain.num);
  if ( ptp->oPitch.num == 0.0 )
    d2 = 0.0;
  else
    d2 = 256.0 / ((long double)ptp->size / ptp->oPitch.num);
  if ( ptp->oVolume.num == 0.0 )
    d3 = 0.0;
  else
    d3 = 256.0 / ((long double)ptp->size / ptp->oVolume.num);
  for ( i = 0; ptp->size > i; ++i )
  {
    a = (unsigned __int8)(((unsigned __int64)(signed int)dMain >> 56) + (signed int)dMain)
      - ((unsigned int)((signed int)dMain >> 31) >> 24);
    b = (unsigned __int8)(((unsigned __int64)(signed int)dPitch >> 56) + (signed int)dPitch)
      - ((unsigned int)((signed int)dPitch >> 31) >> 24);
    c = (unsigned __int8)(((unsigned __int64)(signed int)dVolume >> 56) + (signed int)dVolume)
      - ((unsigned int)((signed int)dVolume >> 31) >> 24);
    d = (signed int)((long double)(i << 8) / (long double)ptp->size);
    pData[i] = gWaveModelTable[256 * ptp->oMain.model + a]
             * ptp->oMain.top
             / 64
             * (gWaveModelTable[256 * ptp->oVolume.model + c] * ptp->oVolume.top / 64 + 64)
             / 64
             * envelopeTable[d]
             / 64
             + -128;
    if ( *(_BYTE *)((ptp->oPitch.model << 8) + b + 136098304) >= 0 )
      v2 = (d1 + d1)
         * (long double)*(char *)((ptp->oPitch.model << 8) + b + 136098304)
         * (long double)ptp->oPitch.top
         / 64.0
         / 64.0
         + d1
         + dMain;
    else
      v2 = d1
         * 0.5
         * (long double)-*(char *)((ptp->oPitch.model << 8) + b + 136098304)
         * (long double)ptp->oPitch.top
         / 64.0
         / -64.0
         + d1
         + dMain;
    dMain = v2;
    dPitch = dPitch + d2;
    dVolume = dVolume + d3;
  }
  return 1;
}

//----- (0808A484) --------------------------------------------------------
void __cdecl ActNpc200(NPCHAR_0 *npc)
{
  int v1;
  char v2;
  NPCHAR_0 *v3;
  Sint32 *v4;
  RECT rcRight[6];
  RECT rcLeft[6];
  unsigned __int8 deg;
  int xm;
  int ym;
  char v10[24];

  qmemcpy(rcLeft, &ActNpc200(NPCHAR *)::C.0, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc200(NPCHAR *)::C.1, sizeof(rcRight));
  if ( npc->act_no <= 99 && npc->life <= 949 )
  {
    PlaySoundObject(72, 1);
    SetDestroyNpChar(npc->x, npc->y, npc->view.back, 8);
    SetExpObjects(npc->x, npc->y, npc->exp);
    npc->act_no = 100;
    npc->bits &= 0xFFDFu;
    npc->damage = 0;
  }
  v1 = npc->act_no;
  if ( v1 == 21 )
  {
LABEL_26:
    if ( ++npc->act_wait / 2 & 1 )
      npc->ani_no = 2;
    else
      npc->ani_no = 3;
    if ( npc->act_wait > 30 )
      npc->act_no = 30;
    if ( x >= npc->x )
      npc->direct = 2;
    else
      npc->direct = 0;
    goto LABEL_48;
  }
  if ( v1 <= 21 )
  {
    if ( v1 == 10 )
    {
LABEL_15:
      if ( ++npc->ani_wait > 30 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 1 )
        npc->ani_no = 0;
      if ( npc->count1 )
        --npc->count1;
      if ( !npc->count1 && x > npc->x - 57344 && x < npc->x + 57344 )
        npc->act_no = 20;
      goto LABEL_48;
    }
    if ( v1 != 20 )
    {
      if ( v1 )
        goto LABEL_48;
      npc->act_no = 10;
      npc->count1 = 0;
      goto LABEL_15;
    }
    npc->act_no = 21;
    npc->act_wait = 0;
    goto LABEL_26;
  }
  switch ( v1 )
  {
    case 31:
      goto LABEL_35;
    case 100:
      npc->ani_no = 5;
      break;
    case 30:
      npc->act_no = 31;
      npc->act_wait = 0;
      npc->ani_no = 4;
      npc->tgt_x = x;
      npc->tgt_y = y;
LABEL_35:
      if ( ++npc->act_wait <= 39 && npc->act_wait % 8 == 1 )
      {
        deg = npc->direct ? (unsigned __int8)GetArktan(npc->x + 7168 - npc->tgt_x, npc->y - npc->tgt_y) : (unsigned __int8)GetArktan(npc->x - 7168 - npc->tgt_x, npc->y - npc->tgt_y);
        v2 = Random(-6, 6);
        deg += v2;
        ym = 3 * GetSin(deg);
        xm = 3 * GetCos(deg);
        if ( npc->direct )
          SetNpChar(202, npc->x + 7168, npc->y, xm, ym, 0, 0, 256);
        else
          SetNpChar(202, npc->x - 7168, npc->y, xm, ym, 0, 0, 256);
        if ( !(gMC.cond & 2) )
          PlaySoundObject(33, 1);
      }
      if ( npc->act_wait > 60 )
      {
        npc->act_no = 10;
        npc->count1 = Random(100, 200);
        npc->ani_wait = 0;
      }
      break;
  }
LABEL_48:
  if ( npc->direct )
  {
    v3 = npc;
    v4 = (Sint32 *)&v10[16 * npc->ani_no - 204];
  }
  else
  {
    v3 = npc;
    v4 = (Sint32 *)&v10[16 * npc->ani_no - 108];
  }
  npc->rect.left = *v4;
  v3->rect.top = v4[1];
  v3->rect.right = v4[2];
  v3->rect.bottom = v4[3];
}


//----- (0808A9C8) --------------------------------------------------------
void __cdecl ActNpc201(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  RECT *v2;
  RECT rcRight[1];
  RECT rcLeft[1];

  rcLeft[0].left = 200;
  rcLeft[0].top = 0;
  rcLeft[0].right = 240;
  rcLeft[0].bottom = 40;
  rcRight[0].left = 200;
  rcRight[0].top = 40;
  rcRight[0].right = 240;
  rcRight[0].bottom = 80;
  if ( npc->direct )
  {
    v1 = npc;
    v2 = &rcRight[npc->ani_no];
  }
  else
  {
    v1 = npc;
    v2 = &rcLeft[npc->ani_no];
  }
  npc->rect.left = v2->left;
  v1->rect.top = v2->top;
  v1->rect.right = v2->right;
  v1->rect.bottom = v2->bottom;
}

//----- (0808AA68) --------------------------------------------------------
void __cdecl ActNpc202(NPCHAR_0 *npc)
{
  Sint32 *v1;
  RECT rect_left[3];
  char v3[8];

  if ( npc->flag & 0xFF )
  {
    npc->cond = 0;
    SetCaret(npc->x, npc->y, 2, 0);
  }
  npc->y += npc->ym;
  npc->x += npc->xm;
  rect_left[0].left = 184;
  rect_left[0].top = 216;
  rect_left[0].right = 200;
  rect_left[0].bottom = 240;
  rect_left[1].left = 200;
  rect_left[1].top = 216;
  rect_left[1].right = 216;
  rect_left[1].bottom = 240;
  rect_left[2].left = 216;
  rect_left[2].top = 216;
  rect_left[2].right = 232;
  rect_left[2].bottom = 240;
  if ( ++npc->ani_wait > 1 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 2 )
    npc->ani_no = 0;
  v1 = (Sint32 *)&v3[16 * npc->ani_no - 48];
  npc->rect.left = *v1;
  npc->rect.top = v1[1];
  npc->rect.right = v1[2];
  npc->rect.bottom = v1[3];
  if ( ++npc->count1 > 300 )
  {
    npc->cond = 0;
    SetCaret(npc->x, npc->y, 2, 0);
  }
}


//----- (0808ABE7) --------------------------------------------------------
void __cdecl ActNpc203(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[3];
  RECT rcLeft[3];
  char v6[8];

  rcLeft[0].left = 0;
  rcLeft[0].top = 80;
  rcLeft[0].right = 16;
  rcLeft[0].bottom = 96;
  rcLeft[1].left = 16;
  rcLeft[1].top = 80;
  rcLeft[1].right = 32;
  rcLeft[1].bottom = 96;
  rcLeft[2].left = 32;
  rcLeft[2].top = 80;
  rcLeft[2].right = 48;
  rcLeft[2].bottom = 96;
  rcRight[0].left = 0;
  rcRight[0].top = 96;
  rcRight[0].right = 16;
  rcRight[0].bottom = 112;
  rcRight[1].left = 16;
  rcRight[1].top = 96;
  rcRight[1].right = 32;
  rcRight[1].bottom = 112;
  rcRight[2].left = 32;
  rcRight[2].top = 96;
  rcRight[2].right = 48;
  rcRight[2].bottom = 112;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_9:
    if ( npc->x <= x )
      npc->direct = 2;
    else
      npc->direct = 0;
    if ( npc->act_wait <= 7 || npc->x - 57344 >= x || npc->x + 57344 <= x || npc->y - 40960 >= y || npc->y + 40960 <= y )
    {
      if ( npc->act_wait <= 7 )
        ++npc->act_wait;
      npc->ani_no = 0;
    }
    else
    {
      npc->ani_no = 1;
    }
    if ( npc->shock )
    {
      npc->act_no = 2;
      npc->ani_no = 0;
      npc->act_wait = 0;
    }
    if ( npc->act_wait > 7 && npc->x - 24576 < x && npc->x + 24576 > x && npc->y - 40960 < y && npc->y + 24576 > y )
    {
      npc->act_no = 2;
      npc->ani_no = 0;
      npc->act_wait = 0;
    }
    goto LABEL_38;
  }
  if ( v1 <= 1 )
  {
    if ( v1 )
      goto LABEL_38;
    npc->y += 1536;
    npc->act_no = 1;
    goto LABEL_9;
  }
  if ( v1 == 2 )
  {
    if ( ++npc->act_wait > 8 )
    {
      npc->act_no = 3;
      npc->ani_no = 2;
      npc->ym = -1535;
      if ( !(gMC.cond & 2) )
        PlaySoundObject(30, 1);
      if ( npc->direct )
        npc->xm = 256;
      else
        npc->xm = -256;
    }
  }
  else if ( v1 == 3 )
  {
    if ( npc->flag & 8 )
    {
      npc->xm = 0;
      npc->act_wait = 0;
      npc->ani_no = 0;
      npc->act_no = 1;
      if ( !(gMC.cond & 2) )
        PlaySoundObject(23, 1);
    }
  }
LABEL_38:
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 96];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 48];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (0808AFFA) --------------------------------------------------------
void __cdecl ActNpc204(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  Sint32 *v3;
  RECT rc[2];
  char v5[8];

  rc[0].left = 240;
  rc[0].top = 80;
  rc[0].right = 256;
  rc[0].bottom = 96;
  rc[1].left = 240;
  rc[1].top = 144;
  rc[1].right = 256;
  rc[1].bottom = 160;
  v1 = npc->act_no;
  if ( v1 == 1 )
    goto LABEL_9;
  if ( v1 <= 1 )
  {
    if ( v1 )
      goto LABEL_22;
    npc->act_no = 1;
    npc->tgt_x = npc->x;
LABEL_9:
    if ( x > npc->x - 6144 && x < npc->x + 6144 && y > npc->y )
      npc->act_no = 2;
    goto LABEL_22;
  }
  if ( v1 == 2 )
  {
    if ( ++npc->act_wait / 6 & 1 )
      v2 = npc->tgt_x - 512;
    else
      v2 = npc->tgt_x;
    npc->x = v2;
    if ( npc->act_wait > 30 )
    {
      npc->act_no = 3;
      npc->ani_no = 1;
    }
    goto LABEL_22;
  }
  if ( v1 != 3 || (npc->ym += 32, !(npc->flag & 0xFF)) )
  {
LABEL_22:
    if ( npc->ym > 3072 )
      npc->ym = 3072;
    npc->y += npc->ym;
    v3 = (Sint32 *)&v5[16 * npc->ani_no - 32];
    npc->rect.left = *v3;
    npc->rect.top = v3[1];
    npc->rect.right = v3[2];
    npc->rect.bottom = v3[3];
    return;
  }
  if ( !(gMC.cond & 2) )
    PlaySoundObject(12, 1);
  SetDestroyNpChar(npc->x, npc->y, npc->view.back, 4);
  npc->cond = 0;
}


//----- (0808B222) --------------------------------------------------------
void __cdecl ActNpc205(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT rc[2];
  char v4[8];

  rc[0].left = 112;
  rc[0].top = 80;
  rc[0].right = 128;
  rc[0].bottom = 112;
  rc[1].left = 128;
  rc[1].top = 80;
  rc[1].right = 144;
  rc[1].bottom = 112;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->tgt_x = npc->x;
      npc->y += 2048;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( x > npc->x - 6144 && x < npc->x + 6144 && y > npc->y )
        npc->act_no = 2;
      break;
    case 2:
      if ( ++npc->act_wait / 6 & 1 )
        v1 = npc->tgt_x - 512;
      else
        v1 = npc->tgt_x;
      npc->x = v1;
      if ( npc->act_wait > 30 )
      {
        npc->act_no = 3;
        npc->ani_no = 1;
        npc->act_wait = 0;
      }
      break;
    case 3:
      npc->ym += 32;
      if ( y <= npc->y )
      {
        npc->bits |= 0x40u;
        npc->damage = 0;
      }
      else
      {
        npc->bits &= 0xFFBFu;
        npc->damage = 127;
      }
      if ( ++npc->act_wait <= 8 || !(npc->flag & 0xFF) )
        break;
      npc->bits |= 0x40u;
      npc->act_no = 4;
      npc->act_wait = 0;
      npc->ym = 0;
      npc->damage = 0;
      PlaySoundObject(12, 1);
      SetDestroyNpChar(npc->x, npc->y, npc->view.back, 4);
      SetBullet(24, npc->x, npc->y, 0);
      return;
    case 4:
      if ( ++npc->act_wait > 4 )
      {
        npc->act_no = 5;
        npc->bits |= 0x20u;
      }
      break;
    default:
      break;
  }
  if ( npc->ym > 3072 )
    npc->ym = 3072;
  npc->y += npc->ym;
  v2 = (Sint32 *)&v4[16 * npc->ani_no - 32];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
}


//----- (0808B557) --------------------------------------------------------
void __cdecl ActNpc206(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  Sint32 *v3;
  RECT rect_left[3];
  char v5[8];

  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_9:
    if ( ++npc->act_wait > 49 )
    {
      npc->act_wait = 0;
      npc->act_no = 2;
      npc->ym = 768;
    }
    goto LABEL_32;
  }
  if ( v1 <= 1 )
  {
    if ( v1 )
      goto LABEL_32;
    npc->act_no = 1;
    npc->tgt_x = npc->x;
    npc->tgt_y = npc->y;
    npc->count1 = 120;
    npc->act_wait = Random(0, 50);
    goto LABEL_9;
  }
  if ( v1 == 2 )
  {
    if ( x > npc->x - 40960 && x < npc->x + 40960 )
    {
      npc->act_wait = 0;
      npc->act_no = 3;
    }
    if ( npc->shock )
    {
      npc->act_wait = 0;
      npc->act_no = 3;
    }
  }
  else if ( v1 == 3 )
  {
    v2 = npc->act_wait;
    if ( v2 == 120 )
    {
      SetNpChar(207, npc->x + 0x2000, npc->y + 2048, 0, 0, 2, 0, 256);
    }
    else if ( v2 > 120 )
    {
      switch ( v2 )
      {
        case 240:
          SetNpChar(207, npc->x + 0x2000, npc->y + 2048, 0, 0, 4, 0, 256);
          break;
        case 300:
          npc->hit.back = 0x10000;
          npc->hit.front = 0x10000;
          npc->hit.top = 51200;
          npc->hit.bottom = 51200;
          npc->damage = 30;
          PlaySoundObject(35, 1);
          SetDestroyNpChar(npc->x, npc->y, 0x10000, 100);
          SetQuake(20);
          npc->cond |= 8u;
          break;
        case 180:
          SetNpChar(207, npc->x + 0x2000, npc->y + 2048, 0, 0, 3, 0, 256);
          break;
      }
    }
    else if ( v2 )
    {
      if ( v2 == 60 )
        SetNpChar(207, npc->x + 0x2000, npc->y + 2048, 0, 0, 1, 0, 256);
    }
    else
    {
      SetNpChar(207, npc->x + 0x2000, npc->y + 2048, 0, 0, 0, 0, 256);
    }
    ++npc->act_wait;
  }
LABEL_32:
  if ( npc->act_no > 1 )
  {
    if ( npc->tgt_y < npc->y )
      npc->ym -= 16;
    if ( npc->tgt_y > npc->y )
      npc->ym += 16;
    if ( npc->ym > 256 )
      npc->ym = 256;
    if ( npc->ym < -256 )
      npc->ym = -256;
  }
  npc->x += npc->xm;
  npc->y += npc->ym;
  rect_left[0].left = 80;
  rect_left[0].top = 80;
  rect_left[0].right = 120;
  rect_left[0].bottom = 120;
  rect_left[1].left = 120;
  rect_left[1].top = 80;
  rect_left[1].right = 160;
  rect_left[1].bottom = 120;
  rect_left[2].left = 160;
  rect_left[2].top = 80;
  rect_left[2].right = 200;
  rect_left[2].bottom = 120;
  if ( ++npc->ani_wait > 4 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 2 )
    npc->ani_no = 0;
  v3 = (Sint32 *)&v5[16 * npc->ani_no - 48];
  npc->rect.left = *v3;
  npc->rect.top = v3[1];
  npc->rect.right = v3[2];
  npc->rect.bottom = v3[3];
}


//----- (0808BA95) --------------------------------------------------------
void __cdecl ActNpc207(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT rc[5];
  char v4[24];

  qmemcpy(rc, &ActNpc207(NPCHAR *)::C.4, sizeof(rc));
  v1 = npc->act_no;
  switch ( v1 )
  {
    case 1:
      goto LABEL_5;
    case 2:
      if ( ++npc->act_wait > 30 )
      {
        npc->cond = 0;
        return;
      }
      break;
    case 0:
      npc->act_no = 1;
      npc->ani_no = npc->direct;
      PlaySoundObject(43, 1);
LABEL_5:
      npc->x += 512;
      if ( ++npc->act_wait > 8 )
      {
        npc->act_wait = 0;
        npc->act_no = 2;
      }
      break;
  }
  v2 = (Sint32 *)&v4[16 * npc->ani_no - 80];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
}


//----- (0808BB8E) --------------------------------------------------------
void __cdecl ActNpc208(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  NPCHAR_0 *v6;
  Sint32 *v7;
  RECT rcRight[3];
  RECT rcLeft[3];
  unsigned __int8 deg;
  int xm;
  int ym;
  char v13[8];

  rcLeft[0].left = 248;
  rcLeft[0].top = 80;
  rcLeft[0].right = 272;
  rcLeft[0].bottom = 104;
  rcLeft[1].left = 272;
  rcLeft[1].top = 80;
  rcLeft[1].right = 296;
  rcLeft[1].bottom = 104;
  rcLeft[2].left = 296;
  rcLeft[2].top = 80;
  rcLeft[2].right = 320;
  rcLeft[2].bottom = 104;
  rcRight[0].left = 248;
  rcRight[0].top = 104;
  rcRight[0].right = 272;
  rcRight[0].bottom = 128;
  rcRight[1].left = 272;
  rcRight[1].top = 104;
  rcRight[1].right = 296;
  rcRight[1].bottom = 128;
  rcRight[2].left = 296;
  rcRight[2].top = 104;
  rcRight[2].right = 320;
  rcRight[2].bottom = 128;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_58;
    if ( npc->x <= x )
    {
      npc->direct = 2;
      v2 = npc->xm + 16;
    }
    else
    {
      npc->direct = 0;
      v2 = npc->xm - 16;
    }
    npc->xm = v2;
    if ( npc->flag & 1 )
      npc->xm = 512;
    if ( npc->flag & 4 )
      npc->xm = -512;
    if ( npc->y >= npc->tgt_y )
      v3 = npc->ym - 8;
    else
      v3 = npc->ym + 8;
    npc->ym = v3;
    if ( npc->xm > 767 )
      npc->xm = 767;
    if ( npc->xm < -767 )
      npc->xm = -767;
    if ( npc->ym > 512 )
      npc->ym = 512;
    if ( npc->ym < -512 )
      npc->ym = -512;
    if ( npc->shock )
    {
      npc->x += npc->xm / 2;
      v4 = npc->y;
      v5 = npc->ym / 2;
    }
    else
    {
      npc->x += npc->xm;
      v4 = npc->y;
      v5 = npc->ym;
    }
    npc->y = v5 + v4;
    if ( x <= npc->x + 204800 && x >= npc->x - 204800 )
    {
LABEL_58:
      if ( npc->act_no )
      {
        if ( npc->act_wait <= 149 )
          ++npc->act_wait;
        if ( npc->act_wait == 150 )
        {
          if ( !(++npc->count2 & 7) && npc->x < x + 81920 && npc->x > x - 81920 )
          {
            deg = GetArktan(npc->x - x, npc->y - y);
            deg += Random(-6, 6);
            ym = 3 * GetSin(deg);
            xm = 3 * GetCos(deg);
            SetNpChar(209, npc->x, npc->y, xm, ym, 0, 0, 256);
            PlaySoundObject(39, 1);
          }
          if ( npc->count2 > 16 )
          {
            npc->act_wait = 0;
            npc->count2 = 0;
          }
        }
      }
      if ( ++npc->ani_wait > 1 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 1 )
        npc->ani_no = 0;
      if ( npc->act_wait > 120 && npc->act_wait / 2 % 2 == 1 && npc->ani_no == 1 )
        npc->ani_no = 2;
      if ( npc->direct )
      {
        v6 = npc;
        v7 = (Sint32 *)&v13[16 * npc->ani_no - 108];
      }
      else
      {
        v6 = npc;
        v7 = (Sint32 *)&v13[16 * npc->ani_no - 60];
      }
      npc->rect.left = *v7;
      v6->rect.top = v7[1];
      v6->rect.right = v7[2];
      v6->rect.bottom = v7[3];
    }
    else
    {
      npc->act_no = 0;
      npc->xm = 0;
      npc->direct = npc->count1;
      npc->x = npc->tgt_x;
      npc->rect.right = 0;
      npc->damage = 0;
    }
  }
  else if ( x >= npc->x + 0x2000 || x <= npc->x - 0x2000 )
  {
    npc->rect.right = 0;
    npc->damage = 0;
    npc->xm = 0;
    npc->ym = 0;
    npc->bits &= 0xFFDFu;
  }
  else
  {
    npc->bits |= 0x20u;
    npc->ym = -512;
    npc->tgt_x = npc->x;
    npc->tgt_y = npc->y;
    npc->act_no = 1;
    npc->act_wait = 0;
    npc->count1 = npc->direct;
    npc->count2 = 0;
    npc->damage = 6;
    if ( npc->direct )
    {
      npc->x = x - 0x20000;
      npc->xm = 767;
    }
    else
    {
      npc->x = x + 0x20000;
      npc->xm = -767;
    }
  }
}


//----- (0808C1D9) --------------------------------------------------------
void __cdecl ActNpc209(NPCHAR_0 *npc)
{
  Sint32 *v1;
  RECT rect_left[4];
  char v3[8];

  if ( npc->flag & 0xFF )
  {
    npc->cond = 0;
    SetCaret(npc->x, npc->y, 2, 0);
  }
  npc->y += npc->ym;
  npc->x += npc->xm;
  rect_left[0].left = 232;
  rect_left[0].top = 96;
  rect_left[0].right = 248;
  rect_left[0].bottom = 112;
  rect_left[1].left = 200;
  rect_left[1].top = 112;
  rect_left[1].right = 216;
  rect_left[1].bottom = 128;
  rect_left[2].left = 216;
  rect_left[2].top = 112;
  rect_left[2].right = 232;
  rect_left[2].bottom = 128;
  rect_left[3].left = 232;
  rect_left[3].top = 112;
  rect_left[3].right = 248;
  rect_left[3].bottom = 128;
  if ( ++npc->ani_wait > 2 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 3 )
    npc->ani_no = 0;
  v1 = (Sint32 *)&v3[16 * npc->ani_no - 64];
  npc->rect.left = *v1;
  npc->rect.top = v1[1];
  npc->rect.right = v1[2];
  npc->rect.bottom = v1[3];
  if ( ++npc->count1 > 300 )
  {
    npc->cond = 0;
    SetCaret(npc->x, npc->y, 2, 0);
  }
}


//----- (0808C374) --------------------------------------------------------
void __cdecl ActNpc210(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  NPCHAR_0 *v6;
  RECT *v7;
  RECT rcRight[2];
  RECT rcLeft[2];

  rcLeft[0].left = 0;
  rcLeft[0].top = 112;
  rcLeft[0].right = 16;
  rcLeft[0].bottom = 128;
  rcLeft[1].left = 16;
  rcLeft[1].top = 112;
  rcLeft[1].right = 32;
  rcLeft[1].bottom = 128;
  rcRight[0].left = 32;
  rcRight[0].top = 112;
  rcRight[0].right = 48;
  rcRight[0].bottom = 128;
  rcRight[1].left = 48;
  rcRight[1].top = 112;
  rcRight[1].right = 64;
  rcRight[1].bottom = 128;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 == 1 )
    {
      if ( npc->x <= x )
      {
        npc->direct = 2;
        v2 = npc->xm + 16;
      }
      else
      {
        npc->direct = 0;
        v2 = npc->xm - 16;
      }
      npc->xm = v2;
      if ( npc->xm > 767 )
        npc->xm = 767;
      if ( npc->xm < -767 )
        npc->xm = -767;
      if ( npc->y >= npc->tgt_y )
        v3 = npc->ym - 8;
      else
        v3 = npc->ym + 8;
      npc->ym = v3;
      if ( npc->ym > 512 )
        npc->ym = 512;
      if ( npc->ym < -512 )
        npc->ym = -512;
      if ( npc->shock )
      {
        npc->x += npc->xm / 2;
        v4 = npc->y;
        v5 = npc->ym / 2;
      }
      else
      {
        npc->x += npc->xm;
        v4 = npc->y;
        v5 = npc->ym;
      }
      npc->y = v5 + v4;
    }
  }
  else
  {
    if ( x >= npc->x + 0x2000 || x <= npc->x - 0x2000 )
    {
      npc->bits &= 0xFFDFu;
      npc->rect.right = 0;
      npc->damage = 0;
      npc->xm = 0;
      npc->ym = 0;
      return;
    }
    npc->bits |= 0x20u;
    npc->ym = -512;
    npc->tgt_y = npc->y;
    npc->act_no = 1;
    npc->damage = 2;
    if ( npc->direct )
    {
      npc->x = x - 0x20000;
      npc->xm = 767;
    }
    else
    {
      npc->x = x + 0x20000;
      npc->xm = -767;
    }
  }
  if ( ++npc->ani_wait > 1 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 1 )
    npc->ani_no = 0;
  if ( npc->direct )
  {
    v6 = npc;
    v7 = &rcRight[npc->ani_no];
  }
  else
  {
    v6 = npc;
    v7 = &rcLeft[npc->ani_no];
  }
  npc->rect.left = v7->left;
  v6->rect.top = v7->top;
  v6->rect.right = v7->right;
  v6->rect.bottom = v7->bottom;
}

//----- (0808C6EE) --------------------------------------------------------
void __cdecl ActNpc211(NPCHAR_0 *npc)
{
  RECT *v1;
  RECT rect[4];

  rect[0].left = 256;
  rect[0].top = 200;
  rect[0].right = 272;
  rect[0].bottom = 216;
  rect[1].left = 272;
  rect[1].top = 200;
  rect[1].right = 288;
  rect[1].bottom = 216;
  rect[2].left = 288;
  rect[2].top = 200;
  rect[2].right = 304;
  rect[2].bottom = 216;
  rect[3].left = 304;
  rect[3].top = 200;
  rect[3].right = 320;
  rect[3].bottom = 216;
  v1 = &rect[npc->code_event];
  npc->rect.left = v1->left;
  npc->rect.top = v1->top;
  npc->rect.right = v1->right;
  npc->rect.bottom = v1->bottom;
}

//----- (0808C790) --------------------------------------------------------
void __cdecl ActNpc212(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  Sint32 *v4;
  RECT rcRight[4];
  char v6[8];

  rcRight[0].left = 160;
  rcRight[0].top = 152;
  rcRight[0].right = 200;
  rcRight[0].bottom = 192;
  rcRight[1].left = 200;
  rcRight[1].top = 152;
  rcRight[1].right = 240;
  rcRight[1].bottom = 192;
  rcRight[2].left = 240;
  rcRight[2].top = 112;
  rcRight[2].right = 280;
  rcRight[2].bottom = 152;
  rcRight[3].left = 280;
  rcRight[3].top = 112;
  rcRight[3].right = 320;
  rcRight[3].bottom = 152;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->y -= 2048;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( ++npc->ani_wait > 30 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 1 )
        npc->ani_no = 0;
      break;
    case 0xA:
      npc->act_no = 11;
      npc->ani_no = 2;
      npc->ani_wait = 0;
      npc->tgt_y = npc->y - 0x2000;
      npc->tgt_x = npc->x - 3072;
      npc->ym = 0;
      npc->bits |= 8u;
      goto LABEL_8;
    case 0xB:
LABEL_8:
      if ( npc->x >= npc->tgt_x )
        v1 = npc->xm - 8;
      else
        v1 = npc->xm + 8;
      npc->xm = v1;
      if ( npc->y >= npc->tgt_y )
        v2 = npc->ym - 8;
      else
        v2 = npc->ym + 8;
      npc->ym = v2;
      npc->x += npc->xm;
      npc->y += npc->ym;
      if ( ++npc->ani_wait > 5 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 3 )
        npc->ani_no = 2;
      break;
    case 0x14:
      npc->act_no = 21;
      npc->bits |= 8u;
      goto LABEL_19;
    case 0x15:
LABEL_19:
      if ( npc->y >= npc->tgt_y )
        v3 = npc->ym - 16;
      else
        v3 = npc->ym + 16;
      npc->ym = v3;
      npc->xm += 32;
      if ( npc->xm > 1536 )
        npc->xm = 1536;
      if ( npc->xm < -1536 )
        npc->xm = -1536;
      npc->x += npc->xm;
      npc->y += npc->ym;
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 3 )
        npc->ani_no = 2;
      break;
    case 0x1E:
      npc->act_no = 31;
      SetNpChar(297, 0, 0, 0, 0, 0, npc, 256);
      break;
    default:
      break;
  }
  v4 = (Sint32 *)&v6[16 * npc->ani_no - 64];
  npc->rect.left = *v4;
  npc->rect.top = v4[1];
  npc->rect.right = v4[2];
  npc->rect.bottom = v4[3];
  if ( unk_81C8598 & 0x40 )
  {
    if ( npc->ani_no > 1 )
    {
      npc->rect.top += 40;
      npc->rect.bottom += 40;
    }
  }
}


//----- (0808CB78) --------------------------------------------------------
void __cdecl ActNpc213(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  int v8;
  int v9;
  Sint32 *v10;
  RECT rect[10];
  char v12[24];

  qmemcpy(rect, &ActNpc213(NPCHAR *)::C.6, sizeof(rect));
  switch ( npc->act_no )
  {
    case 0:
      npc->ani_no = 0;
      npc->tgt_x = npc->x;
      npc->tgt_y = npc->y;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( y > npc->y - 4096 && y < npc->y + 4096 )
      {
        if ( npc->direct )
          v1 = npc->y + 122880;
        else
          v1 = npc->y - 122880;
        npc->y = v1;
        npc->act_no = 10;
        npc->act_wait = 0;
        npc->ani_no = 1;
        npc->ym = 0;
        npc->bits |= 0x20u;
      }
      break;
    case 0xA:
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 3 )
        npc->ani_no = 1;
      if ( ++npc->act_wait > 200 )
      {
        npc->act_no = 20;
        npc->act_wait = 0;
        npc->ani_no = 4;
      }
      break;
    case 0x14:
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 6 )
        npc->ani_no = 4;
      if ( ++npc->act_wait > 50 )
      {
        npc->act_no = 30;
        npc->act_wait = 0;
        npc->ani_no = 7;
      }
      break;
    case 0x1E:
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 9 )
        npc->ani_no = 7;
      if ( ++npc->act_wait % 5 == 1 )
      {
        v2 = Random(-512, 512);
        v3 = Random(2, 12);
        SetNpChar(214, npc->x, npc->y, (v3 << 9) / 4, v2, 0, 0, 256);
        PlaySoundObject(21, 1);
      }
      if ( npc->act_wait > 50 )
      {
        npc->act_no = 10;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      break;
    case 0x28:
      if ( npc->y >= npc->tgt_y )
        v4 = npc->ym - 64;
      else
        v4 = npc->ym + 64;
      npc->ym = v4;
      if ( npc->ym < -1024 )
        npc->ym = -1024;
      if ( npc->ym > 1024 )
        npc->ym = 1024;
      if ( npc->shock )
      {
        v5 = npc->y;
        v6 = npc->ym / 2;
      }
      else
      {
        v5 = npc->y;
        v6 = npc->ym;
      }
      npc->y = v6 + v5;
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 6 )
        npc->ani_no = 4;
      if ( y < npc->tgt_y + 122880 && y > npc->tgt_y - 122880 )
      {
        npc->act_no = 20;
        npc->act_wait = 0;
        npc->ani_no = 4;
      }
      break;
    default:
      break;
  }
  if ( npc->act_no > 9 && npc->act_no <= 30 )
  {
    if ( npc->y >= y )
      v7 = npc->ym - 25;
    else
      v7 = npc->ym + 25;
    npc->ym = v7;
    if ( npc->ym < -1024 )
      npc->ym = -1024;
    if ( npc->ym > 1024 )
      npc->ym = 1024;
    if ( npc->flag & 2 )
      npc->ym = 512;
    if ( npc->flag & 8 )
      npc->ym = -512;
    if ( npc->shock )
    {
      v8 = npc->y;
      v9 = npc->ym / 2;
    }
    else
    {
      v8 = npc->y;
      v9 = npc->ym;
    }
    npc->y = v9 + v8;
    if ( y > npc->tgt_y + 122880 || y < npc->tgt_y - 122880 )
      npc->act_no = 40;
  }
  v10 = (Sint32 *)&v12[16 * npc->ani_no - 160];
  npc->rect.left = *v10;
  npc->rect.top = v10[1];
  npc->rect.right = v10[2];
  npc->rect.bottom = v10[3];
}


//----- (0808D16A) --------------------------------------------------------
void __cdecl ActNpc214(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT rect[3];
  char v4[8];

  rect[0].left = 144;
  rect[0].top = 48;
  rect[0].right = 176;
  rect[0].bottom = 64;
  rect[1].left = 176;
  rect[1].top = 48;
  rect[1].right = 208;
  rect[1].bottom = 64;
  rect[2].left = 208;
  rect[2].top = 48;
  rect[2].right = 240;
  rect[2].bottom = 64;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_13;
  }
  else
  {
    npc->act_no = 1;
    npc->bits |= 8u;
  }
  if ( ++npc->ani_wait > 2 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 2 )
    npc->ani_no = 0;
  npc->xm -= 25;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->xm < 0 )
    npc->bits &= 0xFFF7u;
  if ( npc->flag & 0xFF )
  {
    SetDestroyNpChar(npc->x, npc->y, npc->view.back, 4);
    PlaySoundObject(28, 1);
    npc->cond = 0;
  }
LABEL_13:
  v2 = (Sint32 *)&v4[16 * npc->ani_no - 48];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
}


//----- (0808D315) --------------------------------------------------------
void __cdecl ActNpc215(NPCHAR_0 *npc)
{
  Sint32 *v1;
  RECT rect[5];
  char v3[24];

  switch ( npc->act_no )
  {
    case 0:
      npc->ani_no = 0;
      npc->act_no = 1;
      npc->act_wait = 0;
      npc->tgt_y = npc->y;
      npc->bits &= 0xFFDFu;
      npc->bits &= 0xFFFBu;
      npc->bits &= 0xFFFEu;
      npc->bits &= 0xFFF7u;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( x > npc->x - 6144 && x < npc->x + 6144 && y > npc->y && y < npc->y + 4096 )
      {
        npc->act_no = 15;
        npc->act_wait = 0;
      }
      break;
    case 0xF:
      if ( ++npc->act_wait > 10 )
      {
        PlaySoundObject(102, 1);
        npc->act_no = 20;
      }
      break;
    case 0x14:
      if ( ++npc->ani_wait > 3 )
      {
        ++npc->ani_no;
        npc->ani_wait = 0;
      }
      if ( npc->ani_no == 3 )
        npc->damage = 15;
      if ( npc->ani_no == 4 )
      {
        npc->bits |= 0x20u;
        npc->act_no = 30;
        npc->act_wait = 0;
      }
      break;
    case 0x1E:
      npc->bits |= 1u;
      npc->damage = 0;
      ++npc->act_wait;
      if ( npc->shock )
      {
        npc->act_no = 40;
        npc->act_wait = 0;
      }
      break;
    case 0x28:
      npc->bits |= 8u;
      npc->y += 512;
      if ( ++npc->act_wait == 32 )
      {
        npc->bits &= 0xFFFEu;
        npc->bits &= 0xFFDFu;
        npc->act_no = 50;
        npc->act_wait = 0;
      }
      break;
    case 0x32:
      if ( npc->act_wait > 99 )
      {
        npc->y = npc->tgt_y;
        npc->ani_no = 0;
        npc->act_no = 0;
      }
      else
      {
        ++npc->act_wait;
      }
      break;
    default:
      break;
  }
  qmemcpy(rect, &ActNpc215(NPCHAR *)::C.7, sizeof(rect));
  v1 = (Sint32 *)&v3[16 * npc->ani_no - 80];
  npc->rect.left = *v1;
  npc->rect.top = v1[1];
  npc->rect.right = v1[2];
  npc->rect.bottom = v1[3];
}


//----- (0808D661) --------------------------------------------------------
void __cdecl ActNpc216(NPCHAR_0 *npc)
{
  npc->rect.left = 256;
  npc->rect.top = 192;
  npc->rect.right = 272;
  npc->rect.bottom = 216;
}

//----- (0808D6A0) --------------------------------------------------------
void __cdecl ActNpc217(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT rect[8];
  char v4[24];

  qmemcpy(rect, &ActNpc217(NPCHAR *)::C.8, sizeof(rect));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      npc->xm = 0;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( Random(0, 120) == 10 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      break;
    case 2:
      if ( ++npc->act_wait > 8 )
      {
        npc->act_no = 1;
        npc->ani_no = 0;
      }
      break;
    case 0xA:
      npc->ani_no = 2;
      npc->xm = 0;
      break;
    case 0x14:
      npc->act_no = 21;
      npc->ani_no = 2;
      npc->xm += 512;
      npc->ym -= 1024;
      break;
    case 0x15:
      if ( npc->flag & 8 )
      {
        npc->ani_no = 3;
        npc->act_no = 30;
        npc->act_wait = 0;
        npc->xm = 0;
        npc->tgt_x = npc->x;
      }
      break;
    case 0x1E:
      npc->ani_no = 3;
      if ( ++npc->act_wait / 2 & 1 )
        v1 = npc->tgt_x + 512;
      else
        v1 = npc->tgt_x;
      npc->x = v1;
      break;
    case 0x28:
      npc->act_no = 41;
      npc->ym = -512;
      npc->ani_no = 2;
      goto LABEL_16;
    case 0x29:
LABEL_16:
      if ( npc->flag & 8 )
      {
        npc->act_no = 42;
        npc->ani_no = 4;
      }
      break;
    case 0x2A:
      npc->xm = 0;
      npc->ani_no = 4;
      break;
    case 0x32:
      npc->act_no = 51;
      npc->act_wait = 0;
      goto LABEL_20;
    case 0x33:
LABEL_20:
      if ( ++npc->act_wait > 32 )
        npc->act_no = 42;
      npc->xm = 512;
      if ( ++npc->ani_wait > 3 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 7 )
        npc->ani_no = 4;
      break;
    default:
      break;
  }
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  v2 = (Sint32 *)&v4[16 * npc->ani_no - 128];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
}


//----- (0808D9F4) --------------------------------------------------------
void __cdecl ActNpc218(NPCHAR_0 *npc)
{
  RECT *v1;
  RECT rc[2];

  rc[0].left = 256;
  rc[0].top = 120;
  rc[0].right = 288;
  rc[0].bottom = 152;
  rc[1].left = 288;
  rc[1].top = 120;
  rc[1].right = 320;
  rc[1].bottom = 152;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( ++npc->act_wait > 200 )
    npc->cond = 0;
  if ( ++npc->ani_wait > 2 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 1 )
    npc->ani_no = 0;
  v1 = &rc[npc->ani_no];
  npc->rect.left = v1->left;
  npc->rect.top = v1->top;
  npc->rect.right = v1->right;
  npc->rect.bottom = v1->bottom;
}

//----- (0808DAF0) --------------------------------------------------------
void __cdecl ActNpc219(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;

  if ( npc->direct )
  {
    v3 = npc->y;
    v4 = (Random(-128, 128) << 9) + v3;
    v5 = npc->x;
    v6 = Random(-160, 160);
    SetNpChar(199, v5 + (v6 << 9), v4, 0, 0, 2, 0, 256);
  }
  else if ( Random(0, 40) == 1 )
  {
    v1 = npc->y;
    v2 = Random(-20, 20);
    SetNpChar(4, (v2 << 9) + npc->x, v1, 0, -512, 0, 0, 256);
  }
  npc->rect.left = 0;
  npc->rect.top = 0;
  npc->rect.right = 0;
  npc->rect.bottom = 0;
}

//----- (0808DC4C) --------------------------------------------------------
void __cdecl AddExpMyChar(int x)
{
  int lv;
  int arms_code;

  lv = gArmsData[gSelectedArms].level - 1;
  arms_code = gArmsData[gSelectedArms].code;
  gArmsData[gSelectedArms].exp += x;
  if ( lv == 2 )
  {
    if ( gArmsData[gSelectedArms].exp >= gArmsLevelTable[0].exp[3 * arms_code + 2] )
    {
      gArmsData[gSelectedArms].exp = gArmsLevelTable[0].exp[3 * arms_code + 2];
      if ( unk_81C8598 & 0x80 )
      {
        if ( unk_81C8616 <= 2 )
          ++unk_81C8616;
      }
    }
  }
  else
  {
    while ( lv <= 1 )
    {
      if ( gArmsData[gSelectedArms].exp >= gArmsLevelTable[0].exp[lv + 3 * arms_code] )
      {
        ++gArmsData[gSelectedArms].level;
        gArmsData[gSelectedArms].exp = 0;
        if ( gArmsData[gSelectedArms].code != 13 )
        {
          PlaySoundObject(27, 1);
          SetCaret(::x, y, 10, 0);
        }
      }
      ++lv;
    }
  }
  if ( gArmsData[gSelectedArms].code == 13 )
  {
    unk_81C8608 = 10;
  }
  else
  {
    value += x;
    unk_81C8608 = 30;
  }
}

//----- (0808DE85) --------------------------------------------------------
void ZeroExpMyChar()
{
  gArmsData[gSelectedArms].level = 1;
  gArmsData[gSelectedArms].exp = 0;
}

//----- (0808DEBE) --------------------------------------------------------
_BOOL4 IsMaxExpMyChar()
{
  return gArmsData[gSelectedArms].level == 3
      && gArmsData[gSelectedArms].exp >= gArmsLevelTable[gArmsData[gSelectedArms].code].exp[2];
}

//----- (0808DF32) --------------------------------------------------------
void __cdecl DamageMyChar(int damage)
{
  int v1;

  if ( !unk_81C8610 )
  {
    PlaySoundObject(16, 1);
    gMC.cond &= 0xFEu;
    unk_81C8610 = -128;
    if ( unk_81C8594 != 1 )
      unk_81C85B8 = -1024;
    word_81C8614 -= damage;
    if ( unk_81C8598 & 0x80 && unk_81C8616 > 0 )
      --unk_81C8616;
    if ( unk_81C8598 & 4 )
      v1 = gArmsData[gSelectedArms].exp - damage;
    else
      v1 = gArmsData[gSelectedArms].exp - 2 * damage;
    gArmsData[gSelectedArms].exp = v1;
    while ( gArmsData[gSelectedArms].exp < 0 )
    {
      if ( gArmsData[gSelectedArms].level <= 1 )
      {
        gArmsData[gSelectedArms].exp = 0;
      }
      else
      {
        gArmsData[gSelectedArms].exp += gArmsLevelTable[0].exp[--gArmsData[gSelectedArms].level
                                                             - 1
                                                             + 3 * gArmsData[gSelectedArms].code];
        if ( word_81C8614 > 0 && gArmsData[gSelectedArms].code != 13 )
          SetCaret(x, y, 10, 2);
      }
    }
    SetValueView(&x, &y, -damage);
    if ( word_81C8614 <= 0 )
    {
      PlaySoundObject(17, 1);
      gMC.cond = 0;
      SetDestroyNpChar(x, y, 5120, 64);
      StartTextScript(40);
    }
  }
}

//----- (0808E218) --------------------------------------------------------
void ZeroArmsEnergy_All()
{
  int a;

  for ( a = 0; a <= 7; ++a )
  {
    gArmsData[a].level = 1;
    gArmsData[a].exp = 0;
  }
}

//----- (0808E266) --------------------------------------------------------
void __cdecl AddBulletMyChar(int no, int val)
{
  char v2;
  char v3;
  int a;

  for ( a = 0; ; ++a )
  {
    v2 = a > 7 || gArmsData[a].code == 5 ? 0 : 1;
    if ( !v2 )
      break;
  }
  if ( a != 8 )
    goto LABEL_21;
  for ( a = 0; ; ++a )
  {
    v3 = a > 7 || gArmsData[a].code == 10 ? 0 : 1;
    if ( !v3 )
      break;
  }
  if ( a != 8 )
  {
LABEL_21:
    gArmsData[a].num += val;
    if ( gArmsData[a].num > gArmsData[a].max_num )
      gArmsData[a].num = gArmsData[a].max_num;
  }
}

//----- (0808E36E) --------------------------------------------------------
void __cdecl AddLifeMyChar(int x)
{
  word_81C8614 += x;
  if ( word_81C8614 > unk_81C8618 )
    word_81C8614 = unk_81C8618;
  dword_81C861C = word_81C8614;
}

//----- (0808E3B5) --------------------------------------------------------
void __cdecl AddMaxLifeMyChar(int val)
{
  unk_81C8618 += val;
  if ( unk_81C8618 > 232 )
    unk_81C8618 = 232;
  word_81C8614 += val;
  dword_81C861C = word_81C8614;
}

//----- (0808E407) --------------------------------------------------------
void __cdecl PutArmsEnergy(bool flash)
{
  char v1;
  bool v2;
  RECT rcExpFlash;
  RECT rcExpMax;
  RECT rcExpVal;
  RECT rcExpBox;
  RECT rcNone;
  RECT rcView;
  RECT rcLv;
  RECT rcPer;
  int lv;
  int arms_code;
  int exp_now;
  int exp_next;

  rcPer.left = 72;
  rcPer.top = 48;
  rcPer.right = 80;
  rcPer.bottom = 56;
  rcLv.left = 80;
  rcLv.top = 80;
  rcLv.right = 96;
  rcLv.bottom = 88;
  rcView.left = 0;
  rcView.top = 0;
  rcView.right = 320;
  rcView.bottom = 240;
  rcNone.left = 80;
  rcNone.top = 48;
  rcNone.right = 96;
  rcNone.bottom = 56;
  if ( gArmsEnergyX > 16 )
    gArmsEnergyX -= 2;
  if ( gArmsEnergyX <= 15 )
    gArmsEnergyX += 2;
  if ( gArmsData[gSelectedArms].max_num )
  {
    PutNumber4(gArmsEnergyX + 32, 16, gArmsData[gSelectedArms].num, 0);
    PutNumber4(gArmsEnergyX + 32, 24, gArmsData[gSelectedArms].max_num, 0);
  }
  else
  {
    PutBitmap3(&rcView, gArmsEnergyX + 48, 16, &rcNone, 26);
    PutBitmap3(&rcView, gArmsEnergyX + 48, 24, &rcNone, 26);
  }
  if ( !flash || !((unk_81C8610 >> 1) & 1) )
  {
    PutBitmap3(&rcView, gArmsEnergyX + 32, 24, &rcPer, 26);
    PutBitmap3(&rcView, gArmsEnergyX, 32, &rcLv, 26);
    PutNumber4(gArmsEnergyX - 8, 32, gArmsData[gSelectedArms].level, 0);
    rcExpBox.left = 0;
    rcExpBox.top = 72;
    rcExpBox.right = 40;
    rcExpBox.bottom = 80;
    rcExpVal.left = 0;
    rcExpVal.top = 80;
    rcExpVal.right = 0;
    rcExpVal.bottom = 88;
    rcExpMax.left = 40;
    rcExpMax.top = 72;
    rcExpMax.right = 80;
    rcExpMax.bottom = 80;
    rcExpFlash.left = 40;
    rcExpFlash.top = 80;
    rcExpFlash.right = 80;
    rcExpFlash.bottom = 88;
    lv = gArmsData[gSelectedArms].level - 1;
    arms_code = gArmsData[gSelectedArms].code;
    exp_now = gArmsData[gSelectedArms].exp;
    exp_next = gArmsLevelTable[0].exp[lv + 3 * arms_code];
    PutBitmap3(&rcView, gArmsEnergyX + 24, 32, &rcExpBox, 26);
    if ( lv != 2 || gArmsData[gSelectedArms].exp != gArmsLevelTable[0].exp[3 * arms_code + 2] )
    {
      if ( exp_next )
        rcExpVal.right += 40 * exp_now / exp_next;
      else
        rcExpVal.right = 0;
      PutBitmap3(&rcView, gArmsEnergyX + 24, 32, &rcExpVal, 26);
    }
    else
    {
      PutBitmap3(&rcView, gArmsEnergyX + 24, 32, &rcExpMax, 26);
    }
    v2 = 0;
    if ( unk_81C8608 )
    {
      v1 = (PutArmsEnergy(bool)::add_flash++ >> 1) & 1;
      if ( v1 )
        v2 = 1;
    }
    if ( v2 )
      PutBitmap3(&rcView, gArmsEnergyX + 24, 32, &rcExpFlash, 26);
  }
}

//----- (0808E8A6) --------------------------------------------------------
void PutActiveArmsList()
{
  RECT rect;
  int x;
  int a;
  int arms_num;

  rect.left = 0;
  rect.top = 0;
  rect.right = 0;
  rect.bottom = 16;
  for ( arms_num = 0; gArmsData[arms_num].code != 0; ++arms_num )
    ;
  if ( arms_num )
  {
    for ( a = 0; a < arms_num; ++a )
    {
      x = 16 * (a - gSelectedArms) + gArmsEnergyX;
      if ( x > 7 )
      {
        if ( x > 23 )
          x += 48;
      }
      else
      {
        x += 16 * (arms_num + 3);
      }
      if ( 8 * (2 * (arms_num + 3) + 1) <= x )
        x += 16 * (-3 - arms_num);
      if ( x <= 71 && x > 23 )
        x -= 48;
      rect.left = 16 * gArmsData[a].code;
      rect.right = rect.left + 16;
      PutBitmap3(&grcGame, x, 16, &rect, 12);
    }
  }
}

//----- (0808E9DA) --------------------------------------------------------
void __cdecl PutMyLife(bool flash)
{
  RECT rcBr;
  RECT rcLife;
  RECT rcCase;

  rcCase.left = 0;
  rcCase.top = 40;
  rcCase.right = 232;
  rcCase.bottom = 48;
  rcLife.left = 0;
  rcLife.top = 24;
  rcLife.right = 232;
  rcLife.bottom = 32;
  rcBr.left = 0;
  rcBr.top = 32;
  rcBr.right = 232;
  rcBr.bottom = 40;
  if ( !flash || !((unk_81C8610 >> 1) & 1) )
  {
    if ( dword_81C861C < word_81C8614 )
      dword_81C861C = word_81C8614;
    if ( dword_81C861C <= word_81C8614 )
    {
      unk_81C8620 = 0;
    }
    else if ( ++unk_81C8620 > 30 )
    {
      --dword_81C861C;
    }
    rcCase.right = 64;
    rcLife.right = 40 * word_81C8614 / unk_81C8618 - 1;
    rcBr.right = 40 * dword_81C861C / unk_81C8618 - 1;
    PutBitmap3(&grcGame, 16, 40, &rcCase, 26);
    PutBitmap3(&grcGame, 40, 40, &rcBr, 26);
    PutBitmap3(&grcGame, 40, 40, &rcLife, 26);
    PutNumber4(8, 40, dword_81C861C, 0);
  }
}

//----- (0808EBC7) --------------------------------------------------------
void __cdecl PutMyAir(int x, int y)
{
  RECT rcAir[2];

  rcAir[0].left = 112;
  rcAir[0].top = 72;
  rcAir[0].right = 144;
  rcAir[0].bottom = 80;
  rcAir[1].left = 112;
  rcAir[1].top = 80;
  rcAir[1].right = 144;
  rcAir[1].bottom = 88;
  if ( !(unk_81C8598 & 0x10) && unk_81C8628 )
  {
    if ( unk_81C8628 % 6 <= 3 )
      PutNumber4(x + 32, y, unk_81C8624 / 10, 0);
    if ( unk_81C8624 % 30 <= 10 )
      PutBitmap3(&grcGame, x, y, &rcAir[1], 26);
    else
      PutBitmap3(&grcGame, x, y, rcAir, 26);
  }
}

//----- (0808ED1F) --------------------------------------------------------
void __cdecl PutTimeCounter(int x, int y)
{
  RECT rcTime[3];

  rcTime[0].left = 112;
  rcTime[0].top = 104;
  rcTime[0].right = 120;
  rcTime[0].bottom = 112;
  rcTime[1].left = 120;
  rcTime[1].top = 104;
  rcTime[1].right = 128;
  rcTime[1].bottom = 112;
  rcTime[2].left = 128;
  rcTime[2].top = 104;
  rcTime[2].right = 160;
  rcTime[2].bottom = 112;
  if ( unk_81C8598 & 0x100 )
  {
    if ( g_GameFlags & 2 )
    {
      if ( _time_count <= 299999 )
        ++_time_count;
      if ( _time_count % 30 <= 10 )
        PutBitmap3(&grcGame, x, y, &rcTime[1], 26);
      else
        PutBitmap3(&grcGame, x, y, rcTime, 26);
    }
    else
    {
      PutBitmap3(&grcGame, x, y, rcTime, 26);
    }
    PutNumber4(x, y, _time_count / 3000, 0);
    PutNumber4(x + 20, y, _time_count / 50 % 60, 1);
    PutNumber4(x + 32, y, _time_count / 5 % 10, 0);
    PutBitmap3(&grcGame, x + 30, y, &rcTime[2], 26);
  }
  else
  {
    _time_count = 0;
  }
}

//----- (0808EFB1) --------------------------------------------------------
signed int SaveTimeCounter()
{
  int v1;
  char path[260];
  $B3FC422DA37A539D80A9413BC091BB99 rec;
  int i;
  unsigned __int8 *p;
  SDL_RWops_0 *fp;

  if ( !(unk_81C8598 & 0x100) )
    return 1;
  sprintf(path, "%s/290.rec", gModulePath);
  fp = SDL_RWFromFile(path, "rb");
  if ( fp )
  {
    fp->read(fp, &rec, 20, 1);
    fp->close(fp);
    p = (unsigned __int8 *)&rec;
    LOBYTE(rec.counter[0]) -= rec.random[0];
    BYTE1(rec.counter[0]) -= rec.random[0];
    BYTE2(rec.counter[0]) -= rec.random[0];
    HIBYTE(rec.counter[0]) -= rec.random[0] >> 1;
    if ( rec.counter[0] < _time_count )
      return 1;
  }
  for ( i = 0; i <= 3; ++i )
  {
    rec.counter[i] = _time_count;
    v1 = i;
    rec.random[v1] = Random(0, 250) + i;
    p = (unsigned __int8 *)&rec.counter[i];
    *p += rec.random[i];
    p[1] += rec.random[i];
    p[2] += rec.random[i];
    p[3] += rec.random[i] >> 1;
  }
  fp = SDL_RWFromFile(path, "wb");
  if ( !fp )
    return 0;
  fp->write(fp, &rec, 20, 1);
  fp->close(fp);
  return 1;
}

//----- (0808F1F2) --------------------------------------------------------
int LoadTimeCounter()
{
  int result;
  char path[260];
  $B3FC422DA37A539D80A9413BC091BB99 rec;
  int i;
  unsigned __int8 *p;
  SDL_RWops_0 *fp;

  sprintf(path, "%s/290.rec", gModulePath);
  fp = SDL_RWFromFile(path, "rb");
  if ( !fp )
    return 0;
  fp->read(fp, &rec, 20, 1);
  fp->close(fp);
  for ( i = 0; i <= 3; ++i )
  {
    p = (unsigned __int8 *)&rec.counter[i];
    *p -= rec.random[i];
    p[1] -= rec.random[i];
    p[2] -= rec.random[i];
    p[3] -= rec.random[i] >> 1;
  }
  if ( rec.counter[0] == rec.counter[1] && rec.counter[0] == rec.counter[2] )
  {
    _time_count = rec.counter[0];
    result = rec.counter[0];
  }
  else
  {
    _time_count = 0;
    result = 0;
  }
  return result;
}

//----- (0808F354) --------------------------------------------------------
void ResetMyCharFlag()
{
  dword_81C8584 = 0;
}

//----- (0808F363) --------------------------------------------------------
void _PutlittleStar()
{
  if ( !(gMC.cond & 2) && unk_81C85B8 < -512 )
  {
    PlaySoundObject(3, 1);
    SetCaret(x, y - unk_81C85C8, 13, 0);
    SetCaret(x, y - unk_81C85C8, 13, 0);
  }
}

//----- (0808F3F8) --------------------------------------------------------
int __cdecl JudgeHitMyCharBlock(int x, int y)
{
  int hit;

  hit = 0;
  if ( ::y - unk_81C85C8 < (2 * (2 * y + 1) - 1) << 11
    && unk_81C85D0 + ::y > (2 * (2 * y - 1) + 1) << 11
    && ::x - unk_81C85CC < (2 * x + 1) << 12
    && ::x - unk_81C85CC > x << 13 )
  {
    ::x = ((2 * x + 1) << 12) + unk_81C85CC;
    if ( unk_81C85B4 < -384 )
      unk_81C85B4 = -384;
    if ( !(gKey & gKeyLeft) && unk_81C85B4 < 0 )
      unk_81C85B4 = 0;
    hit = 1;
  }
  if ( ::y - unk_81C85C8 < (2 * (2 * y + 1) - 1) << 11
    && unk_81C85D0 + ::y > (2 * (2 * y - 1) + 1) << 11
    && unk_81C85CC + ::x > (2 * x - 1) << 12
    && unk_81C85CC + ::x < x << 13 )
  {
    ::x = ((2 * x - 1) << 12) - unk_81C85CC;
    if ( unk_81C85B4 > 384 )
      unk_81C85B4 = 384;
    if ( !(gKey & gKeyRight) && unk_81C85B4 > 0 )
      unk_81C85B4 = 0;
    hit |= 4u;
  }
  if ( ::x - unk_81C85CC < ((2 * x + 1) << 12) - 1536
    && unk_81C85CC + ::x > ((2 * x - 1) << 12) + 1536
    && ::y - unk_81C85C8 < (2 * y + 1) << 12
    && ::y - unk_81C85C8 > y << 13 )
  {
    ::y = ((2 * y + 1) << 12) + unk_81C85C8;
    if ( !(gMC.cond & 2) && unk_81C85B8 < -512 )
      _PutlittleStar();
    if ( unk_81C85B8 < 0 )
      unk_81C85B8 = 0;
    hit |= 2u;
  }
  if ( ::x - unk_81C85CC < ((2 * x + 1) << 12) - 1536
    && unk_81C85CC + ::x > ((2 * x - 1) << 12) + 1536
    && unk_81C85D0 + ::y > (2 * y - 1) << 12
    && unk_81C85D0 + ::y < y << 13 )
  {
    ::y = ((2 * y - 1) << 12) - unk_81C85D0;
    if ( unk_81C85B8 > 1024 )
      PlaySoundObject(23, 1);
    if ( unk_81C85B8 > 0 )
      unk_81C85B8 = 0;
    hit |= 8u;
  }
  return hit;
}

//----- (0808F758) --------------------------------------------------------
int __cdecl JudgeHitMyCharTriangleA(int x, int y)
{
  int hit;

  hit = 0;
  if ( ::x < (2 * x + 1) << 12
    && ::x > (2 * x - 1) << 12
    && ::y - unk_81C85C8 < (y << 13) - (-8192 * x + ::x) / 2 + 2048
    && unk_81C85D0 + ::y > (2 * y - 1) << 12 )
  {
    ::y = (y << 13) - (-8192 * x + ::x) / 2 + 2048 + unk_81C85C8;
    if ( !(gMC.cond & 2) && unk_81C85B8 < -512 )
      _PutlittleStar();
    if ( unk_81C85B8 < 0 )
      unk_81C85B8 = 0;
    hit = 2;
  }
  return hit;
}

//----- (0808F871) --------------------------------------------------------
int __cdecl JudgeHitMyCharTriangleB(int x, int y)
{
  int hit;

  hit = 0;
  if ( ::x < (2 * x + 1) << 12
    && ::x > (2 * x - 1) << 12
    && ::y - unk_81C85C8 < (y << 13) - (-8192 * x + ::x) / 2 - 2048
    && unk_81C85D0 + ::y > (2 * y - 1) << 12 )
  {
    ::y = (y << 13) - (-8192 * x + ::x) / 2 - 2048 + unk_81C85C8;
    if ( !(gMC.cond & 2) && unk_81C85B8 < -512 )
      _PutlittleStar();
    if ( unk_81C85B8 < 0 )
      unk_81C85B8 = 0;
    hit = 2;
  }
  return hit;
}

//----- (0808F98A) --------------------------------------------------------
int __cdecl JudgeHitMyCharTriangleC(int x, int y)
{
  int hit;

  hit = 0;
  if ( ::x < (2 * x + 1) << 12
    && ::x > (2 * x - 1) << 12
    && ::y - unk_81C85C8 < (y << 13) + (-8192 * x + ::x) / 2 - 2048
    && unk_81C85D0 + ::y > (2 * y - 1) << 12 )
  {
    ::y = (y << 13) + (-8192 * x + ::x) / 2 - 2048 + unk_81C85C8;
    if ( !(gMC.cond & 2) && unk_81C85B8 < -512 )
      _PutlittleStar();
    if ( unk_81C85B8 < 0 )
      unk_81C85B8 = 0;
    hit = 2;
  }
  return hit;
}

//----- (0808FA9D) --------------------------------------------------------
int __cdecl JudgeHitMyCharTriangleD(int x, int y)
{
  int hit;

  hit = 0;
  if ( ::x < (2 * x + 1) << 12
    && ::x > (2 * x - 1) << 12
    && ::y - unk_81C85C8 < (y << 13) + (-8192 * x + ::x) / 2 + 2048
    && unk_81C85D0 + ::y > (2 * y - 1) << 12 )
  {
    ::y = (y << 13) + (-8192 * x + ::x) / 2 + 2048 + unk_81C85C8;
    if ( !(gMC.cond & 2) && unk_81C85B8 < -512 )
      _PutlittleStar();
    if ( unk_81C85B8 < 0 )
      unk_81C85B8 = 0;
    hit = 2;
  }
  return hit;
}

//----- (0808FBB0) --------------------------------------------------------
int __cdecl JudgeHitMyCharTriangleE(int x, int y)
{
  int hit;

  hit = 0x10000;
  if ( ::x < (2 * x + 1) << 12
    && ::x > (2 * x - 1) << 12
    && ::y + unk_81C85D0 > (y << 13) + (-8192 * x + ::x) / 2 - 2048
    && ::y - unk_81C85C8 < (2 * y + 1) << 12 )
  {
    ::y = (y << 13) + (-8192 * x + ::x) / 2 - 2048 - unk_81C85D0;
    if ( unk_81C85B8 > 1024 )
      PlaySoundObject(23, 1);
    if ( unk_81C85B8 > 0 )
      unk_81C85B8 = 0;
    hit = 65576;
  }
  return hit;
}

//----- (0808FCCA) --------------------------------------------------------
int __cdecl JudgeHitMyCharTriangleF(int x, int y)
{
  int hit;

  hit = 0x20000;
  if ( ::x < (2 * x + 1) << 12
    && ::x > (2 * x - 1) << 12
    && ::y + unk_81C85D0 > (y << 13) + (-8192 * x + ::x) / 2 + 2048
    && ::y - unk_81C85C8 < (2 * y + 1) << 12 )
  {
    ::y = (y << 13) + (-8192 * x + ::x) / 2 + 2048 - unk_81C85D0;
    if ( unk_81C85B8 > 1024 )
      PlaySoundObject(23, 1);
    if ( unk_81C85B8 > 0 )
      unk_81C85B8 = 0;
    hit = 131112;
  }
  return hit;
}

//----- (0808FDE4) --------------------------------------------------------
int __cdecl JudgeHitMyCharTriangleG(int x, int y)
{
  int hit;

  hit = 0x40000;
  if ( ::x < (2 * x + 1) << 12
    && ::x > (2 * x - 1) << 12
    && ::y + unk_81C85D0 > (y << 13) - (-8192 * x + ::x) / 2 + 2048
    && ::y - unk_81C85C8 < (2 * y + 1) << 12 )
  {
    ::y = (y << 13) - (-8192 * x + ::x) / 2 + 2048 - unk_81C85D0;
    if ( unk_81C85B8 > 1024 )
      PlaySoundObject(23, 1);
    if ( unk_81C85B8 > 0 )
      unk_81C85B8 = 0;
    hit = 262168;
  }
  return hit;
}

//----- (0808FF04) --------------------------------------------------------
int __cdecl JudgeHitMyCharTriangleH(int x, int y)
{
  int hit;

  hit = 0x80000;
  if ( ::x < (2 * x + 1) << 12
    && ::x > (2 * x - 1) << 12
    && ::y + unk_81C85D0 > (y << 13) - (-8192 * x + ::x) / 2 - 2048
    && ::y - unk_81C85C8 < (2 * y + 1) << 12 )
  {
    ::y = (y << 13) - (-8192 * x + ::x) / 2 - 2048 - unk_81C85D0;
    if ( unk_81C85B8 > 1024 )
      PlaySoundObject(23, 1);
    if ( unk_81C85B8 > 0 )
      unk_81C85B8 = 0;
    hit = 524312;
  }
  return hit;
}

//----- (08090024) --------------------------------------------------------
int __cdecl JudgeHitMyCharWater(int x, int y)
{
  int hit;

  hit = 0;
  if ( ::x - unk_81C85CC < ((2 * x + 1) << 12) - 1536
    && unk_81C85CC + ::x > ((2 * x - 1) << 12) + 1536
    && ::y - unk_81C85C8 < ((2 * y + 1) << 12) - 1536
    && unk_81C85D0 + ::y > y << 13 )
  {
    hit = 256;
  }
  return hit;
}

//----- (080900B7) --------------------------------------------------------
int __cdecl JudgeHitMyCharDamage(int x, int y)
{
  int hit;

  hit = 0;
  if ( ::x - 2048 < (4 * x + 1) << 11
    && ::x + 2048 > (4 * x - 1) << 11
    && ::y - 2048 < (y << 13) + 1536
    && ::y + 2048 > (y << 13) - 1536 )
  {
    hit = 1024;
  }
  return hit;
}

//----- (0809013A) --------------------------------------------------------
int __cdecl JudgeHitMyCharDamageW(int x, int y)
{
  int hit;

  hit = 0;
  if ( ::x - 2048 < (4 * x + 1) << 11
    && ::x + 2048 > (4 * x - 1) << 11
    && ::y - 2048 < (y << 13) + 1536
    && ::y + 2048 > (y << 13) - 1536 )
  {
    hit = 3328;
  }
  return hit;
}

//----- (080901BD) --------------------------------------------------------
int __cdecl JudgeHitMyCharVectLeft(int x, int y)
{
  int hit;

  hit = 0;
  if ( ::x - unk_81C85CC < (4 * (2 * x + 1) - 1) << 10
    && unk_81C85CC + ::x > (4 * (2 * x - 1) + 1) << 10
    && ::y - unk_81C85C8 < (4 * (2 * y + 1) - 1) << 10
    && unk_81C85D0 + ::y > (4 * (2 * y - 1) + 1) << 10 )
  {
    hit = 4096;
  }
  return hit;
}

//----- (0809025E) --------------------------------------------------------
int __cdecl JudgeHitMyCharVectUp(int x, int y)
{
  int hit;

  hit = 0;
  if ( ::x - unk_81C85CC < (4 * (2 * x + 1) - 1) << 10
    && unk_81C85CC + ::x > (4 * (2 * x - 1) + 1) << 10
    && ::y - unk_81C85C8 < (4 * (2 * y + 1) - 1) << 10
    && unk_81C85D0 + ::y > (4 * (2 * y - 1) + 1) << 10 )
  {
    hit = 0x2000;
  }
  return hit;
}

//----- (080902FF) --------------------------------------------------------
int __cdecl JudgeHitMyCharVectRight(int x, int y)
{
  int hit;

  hit = 0;
  if ( ::x - unk_81C85CC < (4 * (2 * x + 1) - 1) << 10
    && unk_81C85CC + ::x > (4 * (2 * x - 1) + 1) << 10
    && ::y - unk_81C85C8 < (4 * (2 * y + 1) - 1) << 10
    && unk_81C85D0 + ::y > (4 * (2 * y - 1) + 1) << 10 )
  {
    hit = 0x4000;
  }
  return hit;
}

//----- (080903A0) --------------------------------------------------------
int __cdecl JudgeHitMyCharVectDown(int x, int y)
{
  int hit;

  hit = 0;
  if ( ::x - unk_81C85CC < (4 * (2 * x + 1) - 1) << 10
    && unk_81C85CC + ::x > (4 * (2 * x - 1) + 1) << 10
    && ::y - unk_81C85C8 < (4 * (2 * y + 1) - 1) << 10
    && unk_81C85D0 + ::y > (4 * (2 * y - 1) + 1) << 10 )
  {
    hit = 0x8000;
  }
  return hit;
}

//----- (08090441) --------------------------------------------------------
void HitMyCharMap()
{
  int v0;
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  int v8;
  int v9;
  int v10;
  int v11;
  int v12;
  int v13;
  int v14;
  int v15;
  int v16;
  int v17;
  int v18;
  int v19;
  int v20;
  int v21;
  int v22;
  int v23;
  int v24;
  int v25;
  int v26;
  int v27;
  int v28;
  int v29;
  int v30;
  int v31;
  int offy[4];
  int offx[4];
  unsigned __int8 atrb[4];
  int x;
  int y;
  int i;

  x = ::x / 0x2000;
  y = ::y / 0x2000;
  offx[0] = 0;
  offx[1] = 1;
  offx[2] = 0;
  offx[3] = 1;
  offy[0] = 0;
  offy[1] = 0;
  offy[2] = 1;
  offy[3] = 1;
  for ( i = 0; i <= 3; ++i )
  {
    v0 = i;
    atrb[v0] = GetAttribute(x + offx[i], y + offy[i]);
    switch ( atrb[i] )
    {
      case 2u:
        v16 = dword_81C8584;
        dword_81C8584 = v16 | JudgeHitMyCharWater(x + offx[i], y + offy[i]);
        break;
      case 5u:
      case 0x41u:
      case 0x43u:
      case 0x46u:
        v1 = dword_81C8584;
        dword_81C8584 = v1 | JudgeHitMyCharBlock(x + offx[i], y + offy[i]);
        break;
      case 0x42u:
        v10 = dword_81C8584;
        dword_81C8584 = v10 | JudgeHitMyCharDamage(x + offx[i], y + offy[i]);
        break;
      case 0x50u:
        v2 = dword_81C8584;
        dword_81C8584 = v2 | JudgeHitMyCharTriangleA(x + offx[i], y + offy[i]);
        break;
      case 0x51u:
        v3 = dword_81C8584;
        dword_81C8584 = v3 | JudgeHitMyCharTriangleB(x + offx[i], y + offy[i]);
        break;
      case 0x52u:
        v4 = dword_81C8584;
        dword_81C8584 = v4 | JudgeHitMyCharTriangleC(x + offx[i], y + offy[i]);
        break;
      case 0x53u:
        v5 = dword_81C8584;
        dword_81C8584 = v5 | JudgeHitMyCharTriangleD(x + offx[i], y + offy[i]);
        break;
      case 0x54u:
        v6 = dword_81C8584;
        dword_81C8584 = v6 | JudgeHitMyCharTriangleE(x + offx[i], y + offy[i]);
        break;
      case 0x55u:
        v7 = dword_81C8584;
        dword_81C8584 = v7 | JudgeHitMyCharTriangleF(x + offx[i], y + offy[i]);
        break;
      case 0x56u:
        v8 = dword_81C8584;
        dword_81C8584 = v8 | JudgeHitMyCharTriangleG(x + offx[i], y + offy[i]);
        break;
      case 0x57u:
        v9 = dword_81C8584;
        dword_81C8584 = v9 | JudgeHitMyCharTriangleH(x + offx[i], y + offy[i]);
        break;
      case 0x60u:
        v17 = dword_81C8584;
        dword_81C8584 = v17 | JudgeHitMyCharWater(x + offx[i], y + offy[i]);
        break;
      case 0x61u:
        v18 = dword_81C8584;
        dword_81C8584 = v18 | JudgeHitMyCharBlock(x + offx[i], y + offy[i]);
        dword_81C8584 |= JudgeHitMyCharWater(x + offx[i], y + offy[i]);
        break;
      case 0x62u:
        v11 = dword_81C8584;
        dword_81C8584 = v11 | JudgeHitMyCharDamageW(x + offx[i], y + offy[i]);
        break;
      case 0x70u:
        v19 = dword_81C8584;
        dword_81C8584 = v19 | JudgeHitMyCharTriangleA(x + offx[i], y + offy[i]);
        dword_81C8584 |= JudgeHitMyCharWater(x + offx[i], y + offy[i]);
        break;
      case 0x71u:
        v20 = dword_81C8584;
        dword_81C8584 = v20 | JudgeHitMyCharTriangleB(x + offx[i], y + offy[i]);
        dword_81C8584 |= JudgeHitMyCharWater(x + offx[i], y + offy[i]);
        break;
      case 0x72u:
        v21 = dword_81C8584;
        dword_81C8584 = v21 | JudgeHitMyCharTriangleC(x + offx[i], y + offy[i]);
        dword_81C8584 |= JudgeHitMyCharWater(x + offx[i], y + offy[i]);
        break;
      case 0x73u:
        v22 = dword_81C8584;
        dword_81C8584 = v22 | JudgeHitMyCharTriangleD(x + offx[i], y + offy[i]);
        dword_81C8584 |= JudgeHitMyCharWater(x + offx[i], y + offy[i]);
        break;
      case 0x74u:
        v23 = dword_81C8584;
        dword_81C8584 = v23 | JudgeHitMyCharTriangleE(x + offx[i], y + offy[i]);
        dword_81C8584 |= JudgeHitMyCharWater(x + offx[i], y + offy[i]);
        break;
      case 0x75u:
        v24 = dword_81C8584;
        dword_81C8584 = v24 | JudgeHitMyCharTriangleF(x + offx[i], y + offy[i]);
        dword_81C8584 |= JudgeHitMyCharWater(x + offx[i], y + offy[i]);
        break;
      case 0x76u:
        v25 = dword_81C8584;
        dword_81C8584 = v25 | JudgeHitMyCharTriangleG(x + offx[i], y + offy[i]);
        dword_81C8584 |= JudgeHitMyCharWater(x + offx[i], y + offy[i]);
        break;
      case 0x77u:
        v26 = dword_81C8584;
        dword_81C8584 = v26 | JudgeHitMyCharTriangleH(x + offx[i], y + offy[i]);
        dword_81C8584 |= JudgeHitMyCharWater(x + offx[i], y + offy[i]);
        break;
      case 0x80u:
        v12 = dword_81C8584;
        dword_81C8584 = v12 | JudgeHitMyCharVectLeft(x + offx[i], y + offy[i]);
        break;
      case 0x81u:
        v13 = dword_81C8584;
        dword_81C8584 = v13 | JudgeHitMyCharVectUp(x + offx[i], y + offy[i]);
        break;
      case 0x82u:
        v14 = dword_81C8584;
        dword_81C8584 = v14 | JudgeHitMyCharVectRight(x + offx[i], y + offy[i]);
        break;
      case 0x83u:
        v15 = dword_81C8584;
        dword_81C8584 = v15 | JudgeHitMyCharVectDown(x + offx[i], y + offy[i]);
        break;
      case 0xA0u:
        v27 = dword_81C8584;
        dword_81C8584 = v27 | JudgeHitMyCharVectLeft(x + offx[i], y + offy[i]);
        dword_81C8584 |= JudgeHitMyCharWater(x + offx[i], y + offy[i]);
        break;
      case 0xA1u:
        v28 = dword_81C8584;
        dword_81C8584 = v28 | JudgeHitMyCharVectUp(x + offx[i], y + offy[i]);
        dword_81C8584 |= JudgeHitMyCharWater(x + offx[i], y + offy[i]);
        break;
      case 0xA2u:
        v29 = dword_81C8584;
        dword_81C8584 = v29 | JudgeHitMyCharVectRight(x + offx[i], y + offy[i]);
        dword_81C8584 |= JudgeHitMyCharWater(x + offx[i], y + offy[i]);
        break;
      case 0xA3u:
        v30 = dword_81C8584;
        dword_81C8584 = v30 | JudgeHitMyCharVectDown(x + offx[i], y + offy[i]);
        dword_81C8584 |= JudgeHitMyCharWater(x + offx[i], y + offy[i]);
        break;
      default:
        continue;
    }
  }
  if ( ::y > gWaterY + 2048 )
  {
    v31 = dword_81C8584;
    BYTE1(v31) |= 1u;
    dword_81C8584 = v31;
  }
}

//----- (08090DAE) --------------------------------------------------------
int __cdecl JudgeHitMyCharNPC(NPCHAR_0 *npc)
{
  int hit;

  hit = 0;
  if ( y - unk_81C85C8 < npc->y + npc->hit.bottom - 1536
    && y + unk_81C85D0 > npc->y - npc->hit.top + 1536
    && x - unk_81C85CC < npc->x + npc->hit.back
    && x - unk_81C85CC > npc->x )
  {
    if ( unk_81C85B4 <= 511 )
      unk_81C85B4 += 512;
    hit = 1;
  }
  if ( y - unk_81C85C8 < npc->y + npc->hit.bottom - 1536
    && y + unk_81C85D0 > npc->y - npc->hit.top + 1536
    && x + unk_81C85CC - 512 > npc->x - npc->hit.back
    && x + unk_81C85CC - 512 < npc->x )
  {
    if ( unk_81C85B4 >= -511 )
      unk_81C85B4 -= 512;
    hit |= 4u;
  }
  if ( x - unk_81C85CC < npc->x + npc->hit.back - 1536
    && x + unk_81C85CC > npc->x - npc->hit.back + 1536
    && y - unk_81C85C8 < npc->y + npc->hit.bottom
    && y - unk_81C85C8 > npc->y )
  {
    if ( unk_81C85B8 < 0 )
      unk_81C85B8 = 0;
    hit |= 2u;
  }
  if ( x - unk_81C85CC < npc->x + npc->hit.back - 1536
    && x + unk_81C85CC > npc->x - npc->hit.back + 1536
    && y + unk_81C85D0 > npc->y - npc->hit.top
    && unk_81C85D0 + y < npc->y + 1536 )
  {
    if ( npc->bits & 0x10 )
    {
      unk_81C85B8 = npc->ym - 512;
      hit |= 8u;
    }
    else if ( !(dword_81C8584 & 8) && unk_81C85B8 > npc->ym )
    {
      y = npc->y - npc->hit.top - unk_81C85D0 + 512;
      unk_81C85B8 = npc->ym;
      x += npc->xm;
      hit |= 8u;
    }
  }
  return hit;
}

//----- (0809111C) --------------------------------------------------------
signed int __cdecl JudgeHitMyCharNPC3(NPCHAR_0 *npc)
{
  if ( npc->direct )
  {
    if ( x + 1024 > npc->x - npc->hit.back
      && x - 1024 < npc->x + npc->hit.front
      && y + 1024 > npc->y - npc->hit.top
      && y - 1024 < npc->y + npc->hit.bottom )
    {
      return 1;
    }
  }
  else if ( x + 1024 > npc->x - npc->hit.front
         && x - 1024 < npc->x + npc->hit.back
         && y + 1024 > npc->y - npc->hit.top
         && y - 1024 < npc->y + npc->hit.bottom )
  {
    return 1;
  }
  return 0;
}

//----- (0809126F) --------------------------------------------------------
int __cdecl JudgeHitMyCharNPC4(NPCHAR_0 *npc)
{
  long double v1;
  long double v2;
  float fy1;
  float fy2;
  int hit;
  float fx1;
  float fx2;

  hit = 0;
  if ( npc->x <= x )
    v1 = (long double)(x - npc->x);
  else
    v1 = (long double)(npc->x - x);
  fx1 = v1;
  if ( npc->y <= y )
    v2 = (long double)(y - npc->y);
  else
    v2 = (long double)(npc->y - y);
  fx2 = (long double)npc->hit.back;
  if ( 0.0 == fx1 )
    fx1 = 1.0;
  if ( 0.0 == fx2 )
    fx2 = 1.0;
  fy1 = v2;
  fy2 = (long double)npc->hit.top;
  if ( fy1 / fx1 <= fy2 / fx2 )
  {
    if ( y - unk_81C85C8 < npc->y + npc->hit.bottom && y + unk_81C85D0 > npc->y - npc->hit.top )
    {
      if ( x - unk_81C85CC < npc->x + npc->hit.back && x - unk_81C85CC > npc->x )
      {
        if ( unk_81C85B4 < npc->xm )
          unk_81C85B4 = npc->xm;
        x = npc->hit.back + npc->x + unk_81C85CC;
        hit = 1;
      }
      if ( x + unk_81C85CC > npc->x - npc->hit.back && unk_81C85CC + x < npc->x )
      {
        if ( unk_81C85B4 > npc->xm )
          unk_81C85B4 = npc->xm;
        x = npc->x - npc->hit.back - unk_81C85CC;
        hit |= 4u;
      }
    }
  }
  else if ( x - unk_81C85CC < npc->x + npc->hit.back && x + unk_81C85CC > npc->x - npc->hit.back )
  {
    if ( y - unk_81C85C8 < npc->y + npc->hit.bottom && y - unk_81C85C8 > npc->y )
    {
      if ( unk_81C85B8 >= npc->ym )
      {
        if ( unk_81C85B8 < 0 )
          unk_81C85B8 = 0;
      }
      else
      {
        y = npc->hit.bottom + npc->y + unk_81C85C8 + 512;
        unk_81C85B8 = npc->ym;
      }
      hit = 2;
    }
    if ( y + unk_81C85D0 > npc->y - npc->hit.top && unk_81C85D0 + y < npc->y + 1536 )
    {
      if ( unk_81C85B8 - npc->ym > 1024 )
        PlaySoundObject(23, 1);
      if ( unk_81C8594 == 1 )
      {
        y = npc->y - npc->hit.top - unk_81C85D0 + 512;
        hit |= 8u;
      }
      else if ( npc->bits & 0x10 )
      {
        unk_81C85B8 = npc->ym - 512;
        hit |= 8u;
      }
      else if ( !(dword_81C8584 & 8) && unk_81C85B8 > npc->ym )
      {
        y = npc->y - npc->hit.top - unk_81C85D0 + 512;
        unk_81C85B8 = npc->ym;
        x += npc->xm;
        hit |= 8u;
      }
    }
  }
  return hit;
}

//----- (08091727) --------------------------------------------------------
void HitMyCharNpChar()
{
  int i;
  int hit;

  if ( (gMC.cond & 0x80u) != 0 && !(gMC.cond & 2) )
  {
    for ( i = 0; i <= 511; ++i )
    {
      if ( (gNPC[i].cond & 0x80u) != 0 )
      {
        if ( gNPC[i].bits & 1 )
        {
          hit = JudgeHitMyCharNPC((NPCHAR_0 *)(172 * i + 136142176));
          dword_81C8584 |= hit;
        }
        else if ( gNPC[i].bits & 0x40 )
        {
          hit = JudgeHitMyCharNPC4((NPCHAR_0 *)(172 * i + 136142176));
          dword_81C8584 |= hit;
        }
        else
        {
          hit = (unsigned __int8)JudgeHitMyCharNPC3((NPCHAR_0 *)(172 * i + 136142176));
        }
        if ( hit && gNPC[i].code_char == 1 )
        {
          PlaySoundObject(14, 1);
          AddExpMyChar(gNPC[i].exp);
          gNPC[i].cond = 0;
        }
        if ( hit && gNPC[i].code_char == 86 )
        {
          PlaySoundObject(42, 1);
          AddBulletMyChar(gNPC[i].code_event, gNPC[i].exp);
          gNPC[i].cond = 0;
        }
        if ( hit && gNPC[i].code_char == 87 )
        {
          PlaySoundObject(20, 1);
          AddLifeMyChar(gNPC[i].exp);
          gNPC[i].cond = 0;
        }
        if ( !(g_GameFlags & 4) && hit && gNPC[i].bits & 0x100 )
          StartTextScript(gNPC[i].code_event);
        if ( g_GameFlags & 2 && !(gNPC[i].bits & 0x2000) )
        {
          if ( gNPC[i].bits & 0x80 )
          {
            if ( hit & 4 && gNPC[i].xm < 0 )
              DamageMyChar(gNPC[i].damage);
            if ( hit & 1 && gNPC[i].xm > 0 )
              DamageMyChar(gNPC[i].damage);
            if ( hit & 8 && gNPC[i].ym < 0 )
              DamageMyChar(gNPC[i].damage);
            if ( hit & 2 && gNPC[i].ym > 0 )
              DamageMyChar(gNPC[i].damage);
          }
          else if ( hit && gNPC[i].damage && !(g_GameFlags & 4) )
          {
            DamageMyChar(gNPC[i].damage);
          }
        }
        if ( !(g_GameFlags & 4) && hit && gMC.cond & 1 && gNPC[i].bits & 0x2000 )
        {
          StartTextScript(gNPC[i].code_event);
          unk_81C85B4 = 0;
          unk_81C862D = 0;
        }
      }
    }
    if ( unk_81C862D )
      SetCaret(x, y, 9, 0);
  }
}

//----- (08091B9E) --------------------------------------------------------
void HitMyCharBoss()
{
  int b;
  int hit;

  if ( (gMC.cond & 0x80u) != 0 && !(gMC.cond & 2) )
  {
    for ( b = 0; b <= 19; ++b )
    {
      if ( (gBoss[b].cond & 0x80u) != 0 )
      {
        if ( *((_BYTE *)&unk_81CD010 + 172 * b) & 1 )
        {
          hit = JudgeHitMyCharNPC((NPCHAR_0 *)(172 * b + 136105920));
          dword_81C8584 |= hit;
        }
        else if ( *((_WORD *)&unk_81CD010 + 86 * b) & 0x40 )
        {
          hit = JudgeHitMyCharNPC4((NPCHAR_0 *)(172 * b + 136105920));
          dword_81C8584 |= hit;
        }
        else
        {
          hit = (unsigned __int8)JudgeHitMyCharNPC3((NPCHAR_0 *)(172 * b + 136105920));
        }
        if ( !(g_GameFlags & 4) && hit && *((_WORD *)&unk_81CD010 + 86 * b) & 0x100 )
        {
          StartTextScript(*((_DWORD *)&unk_81CCFF0 + 43 * b));
          unk_81C862D = 0;
        }
        if ( *((_WORD *)&unk_81CD010 + 86 * b) & 0x80 )
        {
          if ( hit & 4 && *((_DWORD *)&unk_81CCFD0 + 43 * b) < 0 )
            DamageMyChar(*((_DWORD *)&unk_81CD064 + 43 * b));
          if ( hit & 1 && *((_DWORD *)&unk_81CCFD0 + 43 * b) > 0 )
            DamageMyChar(*((_DWORD *)&unk_81CD064 + 43 * b));
        }
        else if ( hit && *((_DWORD *)&unk_81CD064 + 43 * b) && !(g_GameFlags & 4) )
        {
          DamageMyChar(*((_DWORD *)&unk_81CD064 + 43 * b));
        }
        if ( !(g_GameFlags & 4) && hit && gMC.cond & 1 && *((_WORD *)&unk_81CD010 + 86 * b) & 0x2000 )
        {
          StartTextScript(*((_DWORD *)&unk_81CCFF0 + 43 * b));
          unk_81C85B4 = 0;
          unk_81C862D = 0;
        }
      }
    }
    if ( unk_81C862D )
      SetCaret(x, y, 9, 0);
  }
}

//----- (08091E6C) --------------------------------------------------------
void __cdecl WriteMiniMapLine(int line)
{
  RECT rcLevel[4];
  int x;
  unsigned __int8 a;

  rcLevel[0].left = 240;
  rcLevel[0].top = 24;
  rcLevel[0].right = 241;
  rcLevel[0].bottom = 25;
  rcLevel[1].left = 241;
  rcLevel[1].top = 24;
  rcLevel[1].right = 242;
  rcLevel[1].bottom = 25;
  rcLevel[2].left = 242;
  rcLevel[2].top = 24;
  rcLevel[2].right = 243;
  rcLevel[2].bottom = 25;
  rcLevel[3].left = 243;
  rcLevel[3].top = 24;
  rcLevel[3].right = 244;
  rcLevel[3].bottom = 25;
  for ( x = 0; gMap.width > x; ++x )
  {
    a = GetAttribute(x, line);
    if ( a )
    {
      if ( a != 68
        && a != 1
        && a != 64
        && a != -128
        && a != -127
        && a != -126
        && a != -125
        && a != 81
        && a != 82
        && a != 85
        && a != 86
        && a != 2
        && a != 96
        && a != 113
        && a != 114
        && a != 117
        && a != 118
        && a != -96
        && a != -95
        && a != -94
        && a != -93 )
      {
        if ( a != 67
          && a != 99
          && a != 80
          && a != 83
          && a != 84
          && a != 87
          && a != 96
          && a != 112
          && a != 115
          && a != 116
          && a != 119 )
        {
          Surface2Surface(x, line, &rcLevel[3], 9, 26);
        }
        else
        {
          Surface2Surface(x, line, &rcLevel[2], 9, 26);
        }
      }
      else
      {
        Surface2Surface(x, line, &rcLevel[1], 9, 26);
      }
    }
    else
    {
      Surface2Surface(x, line, rcLevel, 9, 26);
    }
  }
}

//----- (0809209E) --------------------------------------------------------
signed int MiniMapLoop()
{
  signed int v0;
  signed int v2;
  signed int v3;
  RECT my_rect;
  RECT rcMiniMap;
  RECT rcView;
  int f;
  int line;
  int my_x;
  int my_y;
  unsigned __int8 my_wait;

  my_rect.left = 0;
  my_rect.top = 57;
  my_rect.right = 1;
  my_rect.bottom = 58;
  my_x = (x / 512 + 8) / 16;
  my_y = (y / 512 + 8) / 16;
  for ( f = 0; f <= 8; ++f )
  {
    GetTrg();
    if ( gKey & 0x8000 )
    {
      v0 = Call_Escape(gscreen);
      if ( !v0 )
        return 0;
      if ( v0 == 2 )
        return 2;
    }
    PutBitmap4(&grcGame, 0, 0, &grcGame, 10);
    rcView.left = 160 - f * gMap.width / 16;
    rcView.right = f * gMap.width / 16 + 160;
    rcView.top = 120 - f * gMap.length / 16;
    rcView.bottom = f * gMap.length / 16 + 120;
    PutMapName(1);
    CortBox(&rcView, 0);
    PutFramePerSecound();
    if ( !Flip_SystemTask(gscreen) )
      return 0;
  }
  rcMiniMap.left = 0;
  rcMiniMap.right = gMap.width;
  rcMiniMap.top = 0;
  rcMiniMap.bottom = gMap.length;
  rcView.right = --rcView.left + gMap.width + 2;
  rcView.bottom = --rcView.top + gMap.length + 2;
  CortBox2(&rcMiniMap, 0, 9);
  line = 0;
  my_wait = 0;
  while ( 1 )
  {
    GetTrg();
    if ( (gKeyCancel | gKeyOk) & gKeyTrg )
      break;
    if ( gKey & 0x8000 )
    {
      v2 = Call_Escape(gscreen);
      if ( !v2 )
        return 0;
      if ( v2 == 2 )
        return 2;
    }
    PutBitmap4(&grcGame, 0, 0, &grcGame, 10);
    CortBox(&rcView, 0);
    if ( gMap.length > line )
      WriteMiniMapLine(line++);
    if ( gMap.length > line )
      WriteMiniMapLine(line++);
    PutBitmap3(&grcGame, rcView.left + 1, rcView.top + 1, &rcMiniMap, 9);
    PutMapName(1);
    if ( (++my_wait >> 3) & 1 )
      PutBitmap3(&grcGame, my_x + rcView.left + 1, my_y + rcView.top + 1, &my_rect, 26);
    PutFramePerSecound();
    if ( !Flip_SystemTask(gscreen) )
      return 0;
  }
  for ( f = 8; f >= -1; --f )
  {
    GetTrg();
    if ( gKey & 0x8000 )
    {
      v3 = Call_Escape(gscreen);
      if ( !v3 )
        return 0;
      if ( v3 == 2 )
        return 2;
    }
    PutBitmap4(&grcGame, 0, 0, &grcGame, 10);
    rcView.left = 160 - f * gMap.width / 16;
    rcView.right = f * gMap.width / 16 + 160;
    rcView.top = 120 - f * gMap.length / 16;
    rcView.bottom = f * gMap.length / 16 + 120;
    PutMapName(1);
    CortBox(&rcView, 0);
    PutFramePerSecound();
    if ( !Flip_SystemTask(gscreen) )
      return 0;
  }
  return 1;
}

//----- (080925CF) --------------------------------------------------------
_BOOL4 IsMapping()
{
  return gMapping[gStageNo] != 0;
}

//----- (080925F0) --------------------------------------------------------
void StartMapping()
{
  memset(gMapping, 0, 0x80u);
}

//----- (08092614) --------------------------------------------------------
void __cdecl SetMapping(int a)
{
  gMapping[a] = 1;
}

//----- (08092624) --------------------------------------------------------
void InitTriangleTable()
{
  float v0;
  float a;
  float v2;
  float b;
  int i;
  int ia;

  for ( i = 0; i <= 255; ++i )
  {
    v0 = (long double)i * 6.2831998 / 256.0;
    gSin[i] = (signed int)(sinf(v0) * 512.0);
  }
  for ( ia = 0; ia <= 32; ++ia )
  {
    a = (long double)ia * 6.2831855 / 256.0;
    v2 = sinf(a);
    b = v2 / cosf(a);
    gTan[ia] = (signed __int16)(b * 8192.0);
  }
}

//----- (0809270F) --------------------------------------------------------
int __cdecl GetSin(unsigned __int8 deg)
{
  return gSin[deg];
}

//----- (08092728) --------------------------------------------------------
int __cdecl GetCos(unsigned __int8 deg)
{
  return gSin[(unsigned __int8)(deg + 64)];
}

//----- (08092745) --------------------------------------------------------
int __cdecl GetArktan(int x, int y)
{
  unsigned __int8 a;
  int xa;
  int ya;

  xa = -x;
  ya = -y;
  a = 0;
  if ( xa <= 0 )
  {
    if ( ya <= 0 )
    {
      if ( -xa <= -ya )
      {
        while ( gTan[a] < (signed __int16)(-8192 * xa / -ya) )
          ++a;
        a = -64 - a;
      }
      else
      {
        while ( gTan[a] < (signed __int16)(-8192 * ya / -xa) )
          ++a;
        a += -128;
      }
    }
    else if ( -xa <= ya )
    {
      while ( gTan[a] < (signed __int16)(-8192 * xa / ya) )
        ++a;
      a += 64;
    }
    else
    {
      while ( gTan[a] < (signed __int16)((ya << 13) / -xa) )
        ++a;
      a = -128 - a;
    }
  }
  else if ( ya <= 0 )
  {
    if ( -ya >= xa )
    {
      while ( gTan[a] < (signed __int16)((xa << 13) / -ya) )
        ++a;
      a -= 64;
    }
    else
    {
      while ( gTan[a] < (signed __int16)(-8192 * ya / xa) )
        ++a;
      a = -a;
    }
  }
  else if ( xa <= ya )
  {
    while ( gTan[a] < (signed __int16)((xa << 13) / ya) )
      ++a;
    a = 64 - a;
  }
  else
  {
    while ( gTan[a] < (signed __int16)((ya << 13) / xa) )
      ++a;
  }
  return a;
}

//----- (0809299C) --------------------------------------------------------
void ActBossChar_Press()
{
  int v0;
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  int v8;
  int v9;
  NPCHAR_0 *v10;
  Sint32 *v11;
  NPCHAR_0 *v12;
  Sint32 *v13;
  RECT rcDamage[3];
  RECT rc[3];
  NPCHAR_0 *npc;
  int i;
  int x;
  char v19[24];

  npc = gBoss;
  v0 = gBoss[0].act_no;
  if ( v0 == 21 )
  {
LABEL_27:
    if ( !(++npc->act_wait & 0xF) )
    {
      v1 = npc->y;
      v2 = (Random(-60, 60) << 9) + v1;
      v3 = npc->x;
      v4 = Random(-40, 40);
      SetDestroyNpChar(v3 + (v4 << 9), v2, 1, 1);
    }
    goto LABEL_65;
  }
  if ( v0 <= 21 )
  {
    if ( v0 == 6 )
      goto LABEL_65;
    if ( v0 <= 6 )
    {
      if ( v0 != 1 )
      {
        if ( v0 == 5 )
        {
          npc->act_no = 6;
          npc->x = 0;
          npc->y = 0;
          ::npc.cond = 0;
          stru_81CD118.cond = 0;
        }
        else if ( !v0 )
        {
          npc->act_no = 10;
          npc->cond = -128;
          npc->exp = 1;
          npc->direct = 2;
          npc->x = 0;
          npc->y = 0;
          npc->view.front = 20480;
          npc->view.top = 30720;
          npc->view.back = 20480;
          npc->view.bottom = 30720;
          npc->hit_voice = 54;
          npc->hit.front = 25088;
          npc->hit.top = 30720;
          npc->hit.back = 20480;
          npc->hit.bottom = 24576;
          npc->bits = -32184;
          npc->size = 3;
          npc->damage = 10;
          npc->code_event = 1000;
          npc->life = 700;
        }
      }
      goto LABEL_65;
    }
    if ( v0 == 11 )
      goto LABEL_65;
    if ( v0 != 20 )
    {
      if ( v0 == 10 )
      {
        npc->act_no = 11;
        npc->x = 81920;
        npc->y = 37888;
      }
      goto LABEL_65;
    }
    npc->damage = 0;
    npc->act_no = 21;
    npc->x = 81920;
    npc->y = 211456;
    npc->bits &= 0xFFBFu;
    ::npc.cond = 0;
    stru_81CD118.cond = 0;
    goto LABEL_27;
  }
  if ( v0 == 101 )
  {
LABEL_36:
    if ( npc->count2 > 1 && npc->life < 70 * npc->count2 )
    {
      --npc->count2;
      for ( i = 0; i <= 4; ++i )
      {
        ChangeMapParts(i + 8, npc->count2, 0);
        SetDestroyNpChar((i + 8) << 13, npc->count2 << 13, 0, 4);
        PlaySoundObject(12, 1);
      }
    }
    if ( ++npc->act_wait == 81 || npc->act_wait == 241 )
      SetNpChar(323, 24576, 122880, 0, 0, 1, 0, 256);
    if ( npc->act_wait == 1 || npc->act_wait == 161 )
      SetNpChar(323, 139264, 122880, 0, 0, 1, 0, 256);
    if ( npc->act_wait > 299 )
    {
      npc->act_wait = 0;
      SetNpChar(325, npc->x, npc->y + 30720, 0, 0, 0, 0, 256);
    }
    goto LABEL_65;
  }
  if ( v0 <= 101 )
  {
    if ( v0 == 31 )
    {
LABEL_30:
      npc->y += 2048;
      if ( npc->y > 211455 )
      {
        npc->y = 211456;
        npc->ani_no = 0;
        npc->act_no = 20;
        PlaySoundObject(44, 1);
        for ( i = 0; i <= 4; ++i )
        {
          v5 = npc->x;
          x = v5 + (Random(-40, 40) << 9);
          SetNpChar(4, x, npc->y + 30720, 0, 0, 0, 0, 256);
        }
      }
      goto LABEL_65;
    }
    if ( v0 != 100 )
    {
      if ( v0 != 30 )
        goto LABEL_65;
      npc->act_no = 31;
      npc->ani_no = 2;
      npc->x = 81920;
      npc->y = 0x8000;
      goto LABEL_30;
    }
    npc->act_no = 101;
    npc->count2 = 9;
    npc->act_wait = -100;
    ::npc.cond = -128;
    ::npc.hit.front = 7168;
    ::npc.hit.back = 7168;
    ::npc.hit.top = 4096;
    ::npc.hit.bottom = 4096;
    ::npc.bits = 12;
    qmemcpy(&stru_81CD118, &::npc, sizeof(stru_81CD118));
    stru_81CD1C4.cond = -112;
    stru_81CD1C4.bits |= 0x20u;
    stru_81CD1C4.hit.front = 3072;
    stru_81CD1C4.hit.back = 3072;
    stru_81CD1C4.hit.top = 4096;
    stru_81CD1C4.hit.bottom = 4096;
    SetNpChar(325, npc->x, npc->y + 30720, 0, 0, 0, 0, 256);
    goto LABEL_36;
  }
  if ( v0 == 501 )
    goto LABEL_50;
  if ( v0 != 510 )
  {
    if ( v0 != 500 )
      goto LABEL_65;
    stru_81CD1C4.bits &= 0xFFDFu;
    npc->act_no = 501;
    npc->act_wait = 0;
    npc->count1 = 0;
    DeleteNpCharCode(325, 1);
    DeleteNpCharCode(330, 1);
LABEL_50:
    if ( !(++npc->act_wait & 0xF) )
    {
      PlaySoundObject(12, 1);
      v6 = npc->y;
      v7 = (Random(-60, 60) << 9) + v6;
      v8 = npc->x;
      v9 = Random(-40, 40);
      SetDestroyNpChar(v8 + (v9 << 9), v7, 1, 1);
    }
    if ( npc->act_wait == 95 )
      npc->ani_no = 1;
    if ( npc->act_wait == 98 )
      npc->ani_no = 2;
    if ( npc->act_wait > 100 )
      npc->act_no = 510;
    goto LABEL_65;
  }
  npc->ym += 64;
  npc->damage = 127;
  npc->y += npc->ym;
  if ( !npc->count1 && npc->y > 81920 )
  {
    npc->count1 = 1;
    npc->ym = -512;
    npc->damage = 0;
    for ( i = 0; i <= 6; ++i )
    {
      ChangeMapParts(i + 7, 14, 0);
      SetDestroyNpChar((i + 7) << 13, 114688, 0, 0);
      PlaySoundObject(12, 1);
    }
  }
  if ( npc->y > 245760 )
    npc->act_no = 520;
LABEL_65:
  ::npc.x = npc->x - 12288;
  ::npc.y = npc->y + 26624;
  stru_81CD118.x = npc->x + 12288;
  stru_81CD118.y = npc->y + 26624;
  stru_81CD1C4.x = npc->x;
  stru_81CD1C4.y = npc->y + 20480;
  rc[0].left = 0;
  rc[0].top = 0;
  rc[0].right = 80;
  rc[0].bottom = 120;
  rc[1].left = 80;
  rc[1].top = 0;
  rc[1].right = 160;
  rc[1].bottom = 120;
  rc[2].left = 160;
  rc[2].top = 0;
  rc[2].right = 240;
  rc[2].bottom = 120;
  rcDamage[0].left = 0;
  rcDamage[0].top = 120;
  rcDamage[0].right = 80;
  rcDamage[0].bottom = 240;
  rcDamage[1].left = 80;
  rcDamage[1].top = 120;
  rcDamage[1].right = 160;
  rcDamage[1].bottom = 240;
  rcDamage[2].left = 160;
  rcDamage[2].top = 120;
  rcDamage[2].right = 240;
  rcDamage[2].bottom = 240;
  if ( npc->shock )
  {
    if ( (++ActBossChar_Press(void)::_flash >> 1) & 1 )
    {
      v10 = npc;
      v11 = (Sint32 *)&v19[16 * npc->ani_no - 60];
    }
    else
    {
      v10 = npc;
      v11 = (Sint32 *)&v19[16 * npc->ani_no - 108];
    }
    npc->rect.left = *v11;
    v10->rect.top = v11[1];
    v10->rect.right = v11[2];
    v10->rect.bottom = v11[3];
  }
  else
  {
    v12 = npc;
    v13 = (Sint32 *)&v19[16 * npc->ani_no - 60];
    npc->rect.left = *v13;
    v12->rect.top = v13[1];
    v12->rect.right = v13[2];
    v12->rect.bottom = v13[3];
  }
}


//----- (08093448) --------------------------------------------------------
int __userpurge RGB@<eax>(int r, Uint8 g, Uint8 b, char a4)
{
  int result;

  result = r;
  *(_DWORD *)r = 0;
  *(_BYTE *)(r + 3) = -1;
  *(_BYTE *)r = g;
  *(_BYTE *)(r + 1) = b;
  *(_BYTE *)(r + 2) = a4;
  return result;
}

//----- (0809348A) --------------------------------------------------------
void __cdecl ReadyMapName(unsigned __int8 *str)
{
  unsigned __int8 name_en[22];
  unsigned __int8 name_jp[24];
  Uint8 r;
  Uint8 v4;
  int a;

  gMapName.flag = 0;
  gMapName.wait = 0;
  if ( !strcmp((const char *)str, "u") )
  {
    if ( get_language() == 0 )
    {
      name_jp[0] = -119;
      name_jp[1] = 73;
      name_jp[2] = -109;
      name_jp[3] = -84;
      name_jp[4] = -115;
      name_jp[5] = -71;
      name_jp[6] = 79;
      name_jp[7] = 104;
      name_jp[8] = 119;
      name_jp[9] = 100;
      name_jp[10] = 107;
      name_jp[11] = 31;
      name_jp[12] = 111;
      name_jp[13] = 113;
      name_jp[14] = 100;
      name_jp[15] = 114;
      name_jp[16] = 100;
      name_jp[17] = 109;
      name_jp[18] = 115;
      name_jp[19] = 114;
      name_jp[20] = -1;
      name_jp[21] = 0;
      name_jp[22] = 0;
      name_jp[23] = 0;
      for ( a = 0; a <= 23; ++a )
        ++name_jp[a];
      str = name_jp;
    }
    else
    {
      strcpy((char *)name_en, "Studio Pixel presents");
      str = name_en;
    }
  }
  strcpy(gMapName.name, (const char *)str);
  a = strlen(gMapName.name);
  CortBox2(&_rc, 0, 13);
  RGB((int)&r, 0x11u, 0, 34);
  PutText2((-6 * a + 160) / 2 + 6, 1, gMapName.name, (const SDL_Color_0 *const )&r, 13);
  RGB((int)&v4, 0xFFu, 0xFFu, 254);
  PutText2((-6 * a + 160) / 2 + 6, 0, gMapName.name, (const SDL_Color_0 *const )&v4, 13);
}

//----- (0809369C) --------------------------------------------------------
void __cdecl PutMapName(bool bMini)
{
  RECT rcBack;

  if ( bMini )
  {
    rcBack.left = 0;
    rcBack.right = 320;
    rcBack.top = 7;
    rcBack.bottom = 24;
    CortBox(&rcBack, 0);
    PutBitmap3(&grcGame, 74, 10, &_rc, 13);
  }
  else if ( gMapName.flag )
  {
    PutBitmap3(&grcGame, 74, 80, &_rc, 13);
    if ( ++gMapName.wait > 160 )
      gMapName.flag = 0;
  }
}

//----- (08093765) --------------------------------------------------------
void StartMapName()
{
  gMapName.flag = 1;
  gMapName.wait = 0;
}

//----- (0809377E) --------------------------------------------------------
void RestoreMapName()
{
  Uint8 r;
  Uint8 v1;
  int a;

  a = strlen(gMapName.name);
  CortBox2(&_rc, 0, 13);
  RGB((int)&r, 0x11u, 0, 34);
  PutText2((-6 * a + 160) / 2 + 6, 1, gMapName.name, (const SDL_Color_0 *const )&r, 13);
  RGB((int)&v1, 0xFFu, 0xFFu, 254);
  PutText2((-6 * a + 160) / 2 + 6, 0, gMapName.name, (const SDL_Color_0 *const )&v1, 13);
}

//----- (0809387C) --------------------------------------------------------
void __cdecl InitBossChar(int code)
{
  memset(gBoss, 0, 0xD70u);
  gBoss[0].cond = -128;
  unk_81CCFE8 = code;
}

//----- (080938AF) --------------------------------------------------------
void __cdecl PutBossChar(int fx, int fy)
{
  __int64 v2;
  Sint8 a;
  int b;
  int side;

  for ( b = 19; b >= 0; --b )
  {
    if ( (gBoss[b].cond & 0x80u) != 0 )
    {
      if ( *((_BYTE *)&unk_81CD05C + 172 * b) )
      {
        a = 2 * ((*((_BYTE *)&unk_81CD05C + 172 * b) >> 1) & 1) - 1;
      }
      else
      {
        a = 0;
        if ( *((_WORD *)&unk_81CD010 + 86 * b) < 0 && *((_DWORD *)&unk_81CD060 + 43 * b) )
        {
          SetValueView((int *)(172 * b + 136105928), (int *)(172 * b + 136105932), *((_DWORD *)&unk_81CD060 + 43 * b));
          *((_DWORD *)&unk_81CD060 + 43 * b) = 0;
        }
      }
      if ( *((_DWORD *)&unk_81CD00C + 43 * b) )
        side = *((_DWORD *)&unk_81CD054 + 43 * b);
      else
        side = *((_DWORD *)&unk_81CD04C + 43 * b);
      v2 = *(&unk_81CCFCC + 43 * b) - *((_DWORD *)&unk_81CD050 + 43 * b);
      PutBitmap3(
        &grcGame,
        (*(&unk_81CCFC8 + 43 * b) - side) / 512 - fx / 512 + a,
        ((signed int)((HIDWORD(v2) >> 23) + v2) >> 9) - fy / 512,
        (RECT *)(172 * b + 136106004),
        22);
    }
  }
}

//----- (08093AA2) --------------------------------------------------------
void __cdecl SetBossCharActNo(int a)
{
  unk_81CD034 = a;
}

//----- (08093AAF) --------------------------------------------------------
void HitBossBullet()
{
  int v0;
  bool bHit;
  int bul;
  int bos;
  int bos_;

  for ( bos = 0; bos <= 19; ++bos )
  {
    if ( (gBoss[bos].cond & 0x80u) != 0 )
    {
      for ( bul = 0; bul <= 63; ++bul )
      {
        if ( gBul[bul].cond & 0x80 && gBul[bul].damage != -1 )
        {
          bHit = 0;
          if ( *((_WORD *)&unk_81CD010 + 86 * bos) & 0x20
            && *(&unk_81CCFC8 + 43 * bos) - *((_DWORD *)&unk_81CD044 + 43 * bos) < *(&gBul[0].flag + 4 * (8 * bul + 1))
                                                                                 + gBul[bul].enemyXL
            && *(&unk_81CCFC8 + 43 * bos) + *((_DWORD *)&unk_81CD044 + 43 * bos) > *(&gBul[0].flag + 4 * (8 * bul + 1))
                                                                                 - gBul[bul].enemyXL
            && *(&unk_81CCFCC + 43 * bos) - *((_DWORD *)&unk_81CD040 + 43 * bos) < *(&gBul[0].code_bullet
                                                                                   + 4 * (8 * bul + 1))
                                                                                 + gBul[bul].enemyYL
            && *(&unk_81CCFCC + 43 * bos) + *((_DWORD *)&unk_81CD048 + 43 * bos) > *(&gBul[0].code_bullet
                                                                                   + 4 * (8 * bul + 1))
                                                                                 - gBul[bul].enemyYL )
          {
            bHit = 1;
          }
          else if ( *((_WORD *)&unk_81CD010 + 86 * bos) & 4
                 && *(&unk_81CCFC8 + 43 * bos) - *((_DWORD *)&unk_81CD044 + 43 * bos) < *(&gBul[0].flag
                                                                                        + 4 * (8 * bul + 1))
                                                                                      + gBul[bul].blockXL
                 && *(&unk_81CCFC8 + 43 * bos) + *((_DWORD *)&unk_81CD044 + 43 * bos) > *(&gBul[0].flag
                                                                                        + 4 * (8 * bul + 1))
                                                                                      - gBul[bul].blockXL
                 && *(&unk_81CCFCC + 43 * bos) - *((_DWORD *)&unk_81CD040 + 43 * bos) < *(&gBul[0].code_bullet
                                                                                        + 4 * (8 * bul + 1))
                                                                                      + gBul[bul].blockYL
                 && *(&unk_81CCFCC + 43 * bos) + *((_DWORD *)&unk_81CD048 + 43 * bos) > *(&gBul[0].code_bullet
                                                                                        + 4 * (8 * bul + 1))
                                                                                      - gBul[bul].blockYL )
          {
            bHit = 1;
          }
          if ( bHit )
          {
            if ( *((_WORD *)&unk_81CD010 + 86 * bos) & 0x20 )
            {
              if ( gBoss[bos].cond & 0x10 )
                bos_ = 0;
              else
                bos_ = bos;
              *((_DWORD *)&unk_81CD000 + 43 * bos_) -= gBul[bul].damage;
              if ( *((_DWORD *)&unk_81CD000 + 43 * bos_) > 0 )
              {
                if ( *((_BYTE *)&unk_81CD05C + 172 * bos) <= 0xDu )
                {
                  SetCaret(*(&gBul[0].flag + 4 * (8 * bul + 1)), *(&gBul[0].code_bullet + 4 * (8 * bul + 1)), 11, 0);
                  SetCaret(*(&gBul[0].flag + 4 * (8 * bul + 1)), *(&gBul[0].code_bullet + 4 * (8 * bul + 1)), 11, 0);
                  SetCaret(*(&gBul[0].flag + 4 * (8 * bul + 1)), *(&gBul[0].code_bullet + 4 * (8 * bul + 1)), 11, 0);
                  PlaySoundObject(*((_DWORD *)&unk_81CCFF8 + 43 * bos_), 1);
                }
                *((_BYTE *)&unk_81CD05C + 172 * bos) = 8;
                *((_BYTE *)&unk_81CD05C + 172 * bos_) = 8;
                *((_DWORD *)&unk_81CD060 + 43 * bos_) -= gBul[bul].damage;
              }
              else
              {
                *((_DWORD *)&unk_81CD000 + 43 * bos_) = bos_;
                if ( (gMC.cond & 0x80u) != 0 && *((_WORD *)&unk_81CD010 + 86 * bos_) & 0x200 )
                {
                  StartTextScript(*((_DWORD *)&unk_81CCFF0 + 43 * bos_));
                }
                else
                {
                  PlaySoundObject(*((_DWORD *)&unk_81CCFFC + 43 * bos_), 1);
                  v0 = *((_DWORD *)&unk_81CD008 + 43 * bos_);
                  switch ( v0 )
                  {
                    case 2:
                      SetDestroyNpChar(
                        *(&unk_81CCFC8 + 43 * bos_),
                        *(&unk_81CCFCC + 43 * bos_),
                        *((_DWORD *)&unk_81CD054 + 43 * bos_),
                        8);
                      break;
                    case 3:
                      SetDestroyNpChar(
                        *(&unk_81CCFC8 + 43 * bos_),
                        *(&unk_81CCFCC + 43 * bos_),
                        *((_DWORD *)&unk_81CD054 + 43 * bos_),
                        16);
                      break;
                    case 1:
                      SetDestroyNpChar(
                        *(&unk_81CCFC8 + 43 * bos_),
                        *(&unk_81CCFCC + 43 * bos_),
                        *((_DWORD *)&unk_81CD054 + 43 * bos_),
                        4);
                      break;
                  }
                  gBoss[bos_].cond = 0;
                }
              }
              if ( --gBul[bul].life <= 0 )
                gBul[bul].cond = 0;
            }
            else if ( gBul[bul].code_bullet != 13
                   && gBul[bul].code_bullet != 14
                   && gBul[bul].code_bullet != 15
                   && gBul[bul].code_bullet != 28
                   && gBul[bul].code_bullet != 29
                   && gBul[bul].code_bullet != 30 )
            {
              if ( !(gBul[bul].bbits & 0x10) )
              {
                SetCaret(*(&gBul[0].flag + 4 * (8 * bul + 1)), *(&gBul[0].code_bullet + 4 * (8 * bul + 1)), 2, 2);
                PlaySoundObject(31, 1);
                gBul[bul].cond = 0;
              }
            }
            else
            {
              --gBul[bul].life;
            }
          }
        }
      }
    }
  }
}

//----- (08094285) --------------------------------------------------------
void ActBossChar_0()
{
  ;
}

//----- (0809428A) --------------------------------------------------------
void ActBossChar()
{
  int bos;

  if ( (gBoss[0].cond & 0x80u) != 0 )
  {
    gpBossFuncTbl[unk_81CCFE8]();
    for ( bos = 0; bos <= 19; ++bos )
    {
      if ( *((_BYTE *)&unk_81CD05C + 172 * bos) )
        --*((_BYTE *)&unk_81CD05C + 172 * bos);
    }
  }
}

//----- (080942FF) --------------------------------------------------------
void HitBossMap()
{
  int v0;
  int offy[16];
  int offx[16];
  unsigned __int8 atrb[16];
  int x;
  int y;
  int judg;
  int b;
  int j;

  offx[0] = 0;
  offx[1] = 1;
  offx[2] = 0;
  offx[3] = 1;
  offx[4] = 2;
  offx[5] = 2;
  offx[6] = 2;
  offx[7] = 0;
  offx[8] = 1;
  offx[9] = -1;
  offx[10] = -1;
  offx[11] = -1;
  offx[12] = -1;
  offx[13] = 0;
  offx[14] = 1;
  offx[15] = 2;
  offy[0] = 0;
  offy[1] = 0;
  offy[2] = 1;
  offy[3] = 1;
  offy[4] = 0;
  offy[5] = 1;
  offy[6] = 2;
  offy[7] = 2;
  offy[8] = 2;
  offy[9] = -1;
  offy[10] = 0;
  offy[11] = 1;
  offy[12] = 2;
  offy[13] = -1;
  offy[14] = -1;
  offy[15] = -1;
  for ( b = 0; b <= 19; ++b )
  {
    if ( (gBoss[b].cond & 0x80u) != 0 && !(*((_WORD *)&unk_81CD010 + 86 * b) & 8) )
    {
      if ( *((_DWORD *)&unk_81CD008 + 43 * b) <= 2 )
        judg = 4;
      else
        judg = 16;
      x = *(&unk_81CCFC8 + 43 * b) / 0x2000;
      y = *(&unk_81CCFCC + 43 * b) / 0x2000;
      *((_DWORD *)&unk_81CCFC4 + 43 * b) = 0;
      for ( j = 0; j < judg; ++j )
      {
        v0 = j;
        atrb[v0] = GetAttribute(x + offx[j], y + offy[j]);
        switch ( atrb[j] )
        {
          case 2u:
          case 0x60u:
          case 0x61u:
          case 0x64u:
            JadgeHitNpCharBlock((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            JudgeHitNpCharWater((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            break;
          case 5u:
          case 0x41u:
          case 0x43u:
            goto LABEL_10;
          case 0x44u:
            if ( !(*((_WORD *)&unk_81CD010 + 86 * b) & 2) )
LABEL_10:
              JadgeHitNpCharBlock((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            break;
          case 0x50u:
            JudgeHitNpCharTriangleA((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            break;
          case 0x51u:
            JudgeHitNpCharTriangleB((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            break;
          case 0x52u:
            JudgeHitNpCharTriangleC((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            break;
          case 0x53u:
            JudgeHitNpCharTriangleD((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            break;
          case 0x54u:
            JudgeHitNpCharTriangleE((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            break;
          case 0x55u:
            JudgeHitNpCharTriangleF((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            break;
          case 0x56u:
            JudgeHitNpCharTriangleG((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            break;
          case 0x57u:
            JudgeHitNpCharTriangleH((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            break;
          case 0x70u:
            JudgeHitNpCharTriangleA((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            JudgeHitNpCharWater((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            break;
          case 0x71u:
            JudgeHitNpCharTriangleB((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            JudgeHitNpCharWater((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            break;
          case 0x72u:
            JudgeHitNpCharTriangleC((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            JudgeHitNpCharWater((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            break;
          case 0x73u:
            JudgeHitNpCharTriangleD((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            JudgeHitNpCharWater((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            break;
          case 0x74u:
            JudgeHitNpCharTriangleE((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            JudgeHitNpCharWater((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            break;
          case 0x75u:
            JudgeHitNpCharTriangleF((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            JudgeHitNpCharWater((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            break;
          case 0x76u:
            JudgeHitNpCharTriangleG((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            JudgeHitNpCharWater((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            break;
          case 0x77u:
            JudgeHitNpCharTriangleH((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            JudgeHitNpCharWater((NPCHAR_0 *)(172 * b + 136105920), x + offx[j], y + offy[j]);
            break;
          default:
            continue;
        }
      }
    }
  }
}

//----- (08094BEC) --------------------------------------------------------
signed int __cdecl TransferStage(int no, int w, int x, int y)
{
  signed int result;
  char path[260];
  char path_dir[20];
  bool bError;
  char *map_name;

  SetMyCharPosition(x << 13, y << 13);
  bError = 0;
  memcpy(path_dir, "Stage", 6u);
  sprintf(path, "%s/Prt%s", path_dir, 232 * no + 136058976);
  if ( !ReloadBitmap_File(path, 2) )
    bError = 1;
  sprintf(path, "%s/%s.pxa", path_dir, 232 * no + 136058976);
  if ( (unsigned __int8)LoadAttributeData(path) ^ 1 )
    bError = 1;
  sprintf(path, "%s/%s.pxm", path_dir, 232 * no + 136059008);
  if ( (unsigned __int8)LoadMapData2(path) ^ 1 )
    bError = 1;
  sprintf(path, "%s/%s.pxe", path_dir, 232 * no + 136059008);
  if ( (unsigned __int8)LoadEvent(path) ^ 1 )
    bError = 1;
  sprintf(path, "%s/%s.tsc", path_dir, 232 * no + 136059008);
  if ( (unsigned __int8)LoadTextScript_Stage(path) ^ 1 )
    bError = 1;
  strcpy(path, (const char *)(232 * no + 136059044));
  if ( (unsigned __int8)InitBack(path, gTMT[no].bkType) ^ 1 )
    bError = 1;
  memcpy(path_dir, "Npc", 4u);
  sprintf(path, "%s/Npc%s", path_dir, 232 * no + 136059076);
  if ( !ReloadBitmap_File(path, 21) )
    bError = 1;
  sprintf(path, "%s/Npc%s", path_dir, 232 * no + 136059108);
  if ( !ReloadBitmap_File(path, 22) )
    bError = 1;
  if ( bError )
  {
    fprintf(stderr, "There was an ERROR loading Stage %ld!", no);
    result = 0;
  }
  else
  {
    map_name = 0;
    if ( get_language() == 0 )
      map_name = (char *)(232 * no + 136059141);
    else
      map_name = (char *)(232 * no + 136059173);
    ReadyMapName((unsigned __int8 *)map_name);
    StartTextScript(w);
    SetFrameMyChar();
    ClearBullet();
    InitCaret();
    ClearValueView();
    ResetQuake();
    InitBossChar(gTMT[no].boss_no);
    ResetFlash();
    gStageNo = no;
    result = 1;
  }
  return result;
}

//----- (08094F93) --------------------------------------------------------
void __cdecl ChangeMusic(int no)
{
  if ( !no || no != gMusicNo )
  {
    gOldPos = GetOrganyaPosition();
    gOldNo = gMusicNo;
    StopOrganyaMusic();
    LoadOrganya(gMusicTable[no]);
    ChangeOrganyaVolume(100);
    SetOrganyaPosition(0);
    PlayOrganyaMusic();
    gMusicNo = no;
  }
}

//----- (08094FFE) --------------------------------------------------------
void ReCallMusic()
{
  StopOrganyaMusic();
  LoadOrganya(gMusicTable[gOldNo]);
  SetOrganyaPosition(gOldPos);
  ChangeOrganyaVolume(100);
  PlayOrganyaMusic();
  gMusicNo = gOldNo;
}

//----- (08095048) --------------------------------------------------------
void __cdecl _ActBossCharA_Head(NPCHAR_0 *npc)
{
  int v1;
  RECT *v2;
  RECT rect[4];

  rect[0].left = 0;
  rect[0].top = 0;
  rect[0].right = 72;
  rect[0].bottom = 112;
  rect[1].left = 0;
  rect[1].top = 112;
  rect[1].right = 72;
  rect[1].bottom = 224;
  rect[2].left = 160;
  rect[2].top = 0;
  rect[2].right = 232;
  rect[2].bottom = 112;
  rect[3].left = 0;
  rect[3].top = 0;
  rect[3].right = 0;
  rect[3].bottom = 0;
  v1 = npc->act_no;
  if ( v1 == 51 )
  {
LABEL_12:
    if ( !--npc->act_wait )
    {
      npc->act_no = 100;
      npc->ani_no = 3;
    }
    goto LABEL_15;
  }
  if ( v1 <= 51 )
  {
    if ( v1 != 50 )
    {
      if ( v1 == 10 )
      {
        npc->act_no = 11;
        npc->ani_no = 2;
        npc->bits = 8;
        npc->view.front = 18432;
        npc->view.top = 28672;
      }
      else if ( v1 != 11 )
      {
        goto LABEL_15;
      }
      npc->x = unk_81CCFC8 - 18432;
      npc->y = unk_81CCFCC;
      goto LABEL_15;
    }
    npc->act_no = 51;
    npc->act_wait = 112;
    goto LABEL_12;
  }
  if ( v1 == 100 )
    npc->ani_no = 3;
LABEL_15:
  v2 = &rect[npc->ani_no];
  npc->rect.left = v2->left;
  npc->rect.top = v2->top;
  npc->rect.right = v2->right;
  npc->rect.bottom = v2->bottom;
  if ( npc->act_no == 51 )
    npc->rect.bottom = npc->act_wait + npc->rect.top;
}

//----- (080951E5) --------------------------------------------------------
void __cdecl _ActBossCharA_Tail(NPCHAR_0 *npc)
{
  int v1;
  RECT *v2;
  RECT rect[3];

  rect[0].left = 72;
  rect[0].top = 0;
  rect[0].right = 160;
  rect[0].bottom = 112;
  rect[1].left = 72;
  rect[1].top = 112;
  rect[1].right = 160;
  rect[1].bottom = 224;
  rect[2].left = 0;
  rect[2].top = 0;
  rect[2].right = 0;
  rect[2].bottom = 0;
  v1 = npc->act_no;
  if ( v1 == 51 )
  {
LABEL_12:
    if ( !--npc->act_wait )
    {
      npc->act_no = 100;
      npc->ani_no = 2;
    }
    goto LABEL_15;
  }
  if ( v1 <= 51 )
  {
    if ( v1 != 50 )
    {
      if ( v1 == 10 )
      {
        npc->act_no = 11;
        npc->ani_no = 0;
        npc->bits = 8;
        npc->view.front = 22528;
        npc->view.top = 28672;
      }
      else if ( v1 != 11 )
      {
        goto LABEL_15;
      }
      npc->x = unk_81CCFC8 + 22528;
      npc->y = unk_81CCFCC;
      goto LABEL_15;
    }
    npc->act_no = 51;
    npc->act_wait = 112;
    goto LABEL_12;
  }
  if ( v1 == 100 )
    npc->ani_no = 2;
LABEL_15:
  v2 = &rect[npc->ani_no];
  npc->rect.left = v2->left;
  npc->rect.top = v2->top;
  npc->rect.right = v2->right;
  npc->rect.bottom = v2->bottom;
  if ( npc->act_no == 51 )
    npc->rect.bottom = npc->act_wait + npc->rect.top;
}

//----- (08095366) --------------------------------------------------------
void __cdecl _ActBossCharA_Face(NPCHAR_0 *npc)
{
  Sint32 *v1;
  RECT rect[5];
  char v3[24];

  qmemcpy(rect, &_ActBossCharA_Face(NPCHAR *)::C.0, sizeof(rect));
  switch ( npc->act_no )
  {
    case 0:
      npc->ani_no = 0;
      break;
    case 0xA:
      npc->ani_no = 1;
      break;
    case 0x14:
      npc->ani_no = 2;
      break;
    case 0x1E:
      npc->act_no = 31;
      npc->ani_no = 3;
      npc->act_wait = 100;
      goto LABEL_6;
    case 0x1F:
LABEL_6:
      if ( ++npc->act_wait > 300 )
        npc->act_wait = 0;
      if ( npc->act_wait > 250 && npc->act_wait % 16 == 1 )
        PlaySoundObject(26, 1);
      if ( npc->act_wait > 250 && npc->act_wait % 16 == 7 )
      {
        SetNpChar(293, npc->x, npc->y, 0, 0, 0, 0, 128);
        PlaySoundObject(101, 1);
      }
      if ( npc->act_wait == 200 )
        PlaySoundObject(116, 1);
      if ( npc->act_wait > 200 && npc->act_wait & 1 )
        npc->ani_no = 4;
      else
        npc->ani_no = 3;
      break;
    default:
      break;
  }
  npc->view.back = 18432;
  npc->view.front = 18432;
  npc->view.top = 10240;
  npc->x = unk_81CCFC8 - 18432;
  npc->y = unk_81CCFCC + 2048;
  npc->bits = 8;
  v1 = (Sint32 *)&v3[16 * npc->ani_no - 80];
  npc->rect.left = *v1;
  npc->rect.top = v1[1];
  npc->rect.right = v1[2];
  npc->rect.bottom = v1[3];
}


//----- (080955A2) --------------------------------------------------------
void __cdecl _ActBossCharA_Mini(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  Sint32 *v5;
  RECT rect[3];
  int deg;
  char v8[8];

  rect[0].left = 256;
  rect[0].top = 0;
  rect[0].right = 320;
  rect[0].bottom = 40;
  rect[1].left = 256;
  rect[1].top = 40;
  rect[1].right = 320;
  rect[1].bottom = 80;
  rect[2].left = 256;
  rect[2].top = 80;
  rect[2].right = 320;
  rect[2].bottom = 120;
  if ( !npc->cond )
    return;
  npc->life = 1000;
  v1 = npc->act_no;
  if ( v1 == 20 )
  {
    npc->ani_no = 1;
    npc->bits &= 0xFFDFu;
    npc->count2 += 2;
    npc->count2 = (unsigned __int8)(((unsigned __int64)npc->count2 >> 56) + npc->count2)
                - ((unsigned int)(npc->count2 >> 31) >> 24);
  }
  else
  {
    if ( v1 > 20 )
    {
      if ( v1 == 200 )
      {
        npc->act_no = 201;
        npc->ani_no = 2;
        npc->xm = 0;
        npc->ym = 0;
      }
      else if ( v1 != 201 )
      {
        if ( v1 == 30 )
        {
          npc->ani_no = 0;
          npc->bits &= 0xFFDFu;
          npc->count2 += 4;
          npc->count2 = (unsigned __int8)(((unsigned __int64)npc->count2 >> 56) + npc->count2)
                      - ((unsigned int)(npc->count2 >> 31) >> 24);
        }
        goto LABEL_20;
      }
      npc->xm += 32;
      npc->x += npc->xm;
      if ( npc->x > (gMap.width + 2) << 13 )
        npc->cond = 0;
      goto LABEL_20;
    }
    switch ( v1 )
    {
      case 5:
        npc->ani_no = 0;
        npc->bits &= 0xFFDFu;
        ++npc->count2;
        npc->count2 = (unsigned __int8)(((unsigned __int64)npc->count2 >> 56) + npc->count2)
                    - ((unsigned int)(npc->count2 >> 31) >> 24);
        break;
      case 10:
        npc->ani_no = 0;
        npc->bits &= 0xFFDFu;
        npc->count2 += 2;
        npc->count2 = (unsigned __int8)(((unsigned __int64)npc->count2 >> 56) + npc->count2)
                    - ((unsigned int)(npc->count2 >> 31) >> 24);
        break;
      case 0:
        npc->bits &= 0xFFDFu;
        break;
    }
  }
LABEL_20:
  if ( npc->act_no <= 49 )
  {
    if ( npc->count1 )
      v2 = npc->count2 + 128;
    else
      v2 = npc->count2 + 384;
    deg = v2;
    v3 = npc->pNpc->x - 4096;
    npc->x = v3 + 48 * GetCos(v2 / 2);
    v4 = npc->pNpc->y;
    npc->y = v4 + 80 * GetSin(deg / 2);
  }
  v5 = (Sint32 *)&v8[16 * npc->ani_no - 52];
  npc->rect.left = *v5;
  npc->rect.top = v5[1];
  npc->rect.right = v5[2];
  npc->rect.bottom = v5[3];
}


//----- (08095905) --------------------------------------------------------
void __cdecl _ActBossCharA_Hit(NPCHAR_0 *npc)
{
  int v1;

  v1 = npc->count1;
  if ( v1 == 1 )
  {
    npc->x = unk_81CCFC8 + 14336;
    npc->y = unk_81CCFCC;
  }
  else if ( v1 > 1 )
  {
    if ( v1 == 2 )
    {
      npc->x = unk_81CCFC8 + 2048;
      npc->y = unk_81CCFCC + 0x4000;
    }
    else if ( v1 == 3 )
    {
      npc->x = unk_81CCFC8 - 14336;
      npc->y = unk_81CCFCC + 2048;
    }
  }
  else if ( !v1 )
  {
    npc->x = unk_81CCFC8;
    npc->y = unk_81CCFCC - 0x4000;
  }
}

//----- (080959B6) --------------------------------------------------------
void ActBossChar_Undead()
{
  int v0;
  unsigned __int16 v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  int v8;
  int v9;
  int v10;
  int v11;
  int v12;
  int v13;
  int v14;
  int v15;
  int v16;
  int v17;
  int v18;
  int v19;
  int v20;
  int v21;
  int v22;
  int v23;
  int v24;
  int v25;
  int v26;
  bool bShock;
  int i;
  int ia;
  int ib;
  int ic;
  int x;
  int y;

  bShock = 0;
  v0 = gBoss[0].act_no;
  if ( v0 == 210 )
  {
    gBoss[0].act_no = 211;
    gBoss[0].act_wait = 0;
    stru_81CD1C4.act_no = 10;
    stru_81CD520.bits |= 4u;
    stru_81CD5CC.bits |= 4u;
    stru_81CD678.bits |= 4u;
    stru_81CD724.bits |= 0x20u;
    ActBossChar_Undead(void)::_life = gBoss[0].life;
    bShock = 1;
LABEL_42:
    ++ActBossChar_Undead(void)::_flash;
    if ( gBoss[0].shock && (ActBossChar_Undead(void)::_flash >> 1) & 1 )
    {
      stru_81CD270.ani_no = 1;
      stru_81CD31C.ani_no = 1;
    }
    else
    {
      stru_81CD270.ani_no = 0;
      stru_81CD31C.ani_no = 0;
    }
    if ( ++gBoss[0].act_wait % 100 == 1 )
    {
      gCurlyShoot_wait = Random(80, 100);
      gCurlyShoot_x = stru_81CD724.x;
      gCurlyShoot_y = stru_81CD724.y;
    }
    if ( gBoss[0].act_wait <= 299 )
    {
      if ( gBoss[0].act_wait % 120 == 1 )
        SetNpChar(288, gBoss[0].x - 0x4000, gBoss[0].y - 0x2000, 0, 0, 1, 0, 32);
      if ( gBoss[0].act_wait % 120 == 61 )
        SetNpChar(288, gBoss[0].x - 0x4000, gBoss[0].y + 0x2000, 0, 0, 3, 0, 32);
    }
    if ( gBoss[0].life < ActBossChar_Undead(void)::_life - 50 || gBoss[0].act_wait > 400 )
      gBoss[0].act_no = 200;
    goto LABEL_108;
  }
  if ( v0 > 210 )
  {
    if ( v0 != 231 )
    {
      if ( v0 > 231 )
      {
        if ( v0 != 501 )
        {
          if ( v0 > 501 )
          {
            if ( v0 == 1000 )
            {
              SetQuake(100);
              if ( !(++dword_81CD038 & 7) )
                PlaySoundObject(44, 1);
              v15 = unk_81CCFCC;
              v16 = (Random(-64, 64) << 9) + v15;
              v17 = unk_81CCFC8;
              v18 = Random(-72, 72);
              SetDestroyNpChar(v17 + (v18 << 9), v16, 1, 1);
              if ( dword_81CD038 > 100 )
              {
                dword_81CD038 = 0;
                unk_81CD034 = 1001;
                SetFlash(unk_81CCFC8, unk_81CCFCC, 1);
                PlaySoundObject(35, 1);
              }
            }
            else if ( v0 == 1001 )
            {
              SetQuake(40);
              if ( ++dword_81CD038 > 50 )
              {
                for ( ib = 0; ib <= 19; ++ib )
                  gBoss[ib].cond = 0;
                DeleteNpCharCode(158, 1);
                DeleteNpCharCode(301, 1);
              }
            }
            goto LABEL_108;
          }
          if ( v0 != 500 )
            goto LABEL_108;
          CutNoise();
          gBoss[0].act_no = 501;
          gBoss[0].act_wait = 0;
          gBoss[0].xm = 0;
          gBoss[0].ym = 0;
          stru_81CD1C4.act_no = 0;
          stru_81CD270.ani_no = 2;
          stru_81CD31C.ani_no = 0;
          npc.act_no = 5;
          stru_81CD118.act_no = 5;
          stru_81CD3C8.act_no = 5;
          stru_81CD474.act_no = 5;
          SetQuake(20);
          for ( i = 0; i <= 99; ++i )
          {
            v3 = Random(-128, 128) << 9;
            v4 = Random(-128, 128) << 9;
            v5 = gBoss[0].y;
            v6 = (Random(-64, 64) << 9) + v5;
            v7 = gBoss[0].x;
            v8 = Random(-128, 128);
            SetNpChar(4, v7 + (v8 << 9), v6, v4, v3, 0, 0, 0);
          }
          DeleteNpCharCode(282, 1);
          stru_81CD724.bits &= 0xFFDFu;
          for ( ia = 0; ia <= 11; ++ia )
            *((_WORD *)&unk_81CD010 + 86 * ia) &= 0xFFFBu;
        }
        if ( ++gBoss[0].act_wait & 0xF )
        {
          v9 = Random(-128, 128) << 9;
          v10 = Random(-128, 128) << 9;
          v11 = gBoss[0].y;
          v12 = (Random(-32, 32) << 9) + v11;
          v13 = gBoss[0].x;
          v14 = Random(-64, 64);
          SetNpChar(4, v13 + (v14 << 9), v12, v10, v9, 0, 0, 256);
        }
        gBoss[0].x += 64;
        gBoss[0].y += 128;
        if ( gBoss[0].act_wait > 200 )
        {
          gBoss[0].act_wait = 0;
          gBoss[0].act_no = 1000;
        }
        goto LABEL_108;
      }
      if ( v0 == 220 )
      {
        gBoss[0].act_no = 221;
        gBoss[0].act_wait = 0;
        gBoss[0].count1 = 0;
        gSuperYpos = 1;
        stru_81CD1C4.act_no = 20;
        stru_81CD520.bits |= 4u;
        stru_81CD5CC.bits |= 4u;
        stru_81CD678.bits |= 4u;
        stru_81CD724.bits |= 0x20u;
        SetQuake(100);
        ActBossChar_Undead(void)::_life = gBoss[0].life;
        bShock = 1;
      }
      else
      {
        if ( v0 <= 220 )
        {
          if ( v0 != 211 )
            goto LABEL_108;
          goto LABEL_42;
        }
        if ( v0 != 221 )
        {
          if ( v0 != 230 )
            goto LABEL_108;
          gBoss[0].act_no = 231;
          gBoss[0].act_wait = 0;
          stru_81CD1C4.act_no = 30;
          stru_81CD520.bits |= 4u;
          stru_81CD5CC.bits |= 4u;
          stru_81CD678.bits |= 4u;
          stru_81CD724.bits |= 0x20u;
          PlaySoundObject(25, 1);
          SetNpChar(285, stru_81CD1C4.x - 0x2000, stru_81CD1C4.y, 0, 0, 0, 0, 256);
          SetNpChar(285, stru_81CD1C4.x - 0x2000, stru_81CD1C4.y, 0, 0, 1024, 0, 256);
          SetNpChar(285, stru_81CD1C4.x, stru_81CD1C4.y - 0x2000, 0, 0, 0, 0, 256);
          SetNpChar(285, stru_81CD1C4.x, stru_81CD1C4.y - 0x2000, 0, 0, 1024, 0, 256);
          SetNpChar(285, stru_81CD1C4.x, stru_81CD1C4.y + 0x2000, 0, 0, 0, 0, 256);
          SetNpChar(285, stru_81CD1C4.x, stru_81CD1C4.y + 0x2000, 0, 0, 1024, 0, 256);
          ActBossChar_Undead(void)::_life = gBoss[0].life;
          bShock = 1;
          goto LABEL_79;
        }
      }
      if ( ++gBoss[0].act_wait % 40 == 1 )
      {
        v2 = Random(0, 3);
        if ( v2 == 1 )
        {
          x = stru_81CD118.x;
          y = stru_81CD118.y;
        }
        else if ( v2 > 1 )
        {
          if ( v2 == 2 )
          {
            x = stru_81CD3C8.x;
            y = stru_81CD3C8.y;
          }
          else if ( v2 == 3 )
          {
            x = stru_81CD474.x;
            y = stru_81CD474.y;
          }
        }
        else if ( !v2 )
        {
          x = npc.x;
          y = npc.y;
        }
        PlaySoundObject(25, 1);
        SetNpChar(285, x - 0x2000, y, 0, 0, 0, 0, 256);
        SetNpChar(285, x - 0x2000, y, 0, 0, 1024, 0, 256);
      }
      ++ActBossChar_Undead(void)::_flash;
      if ( gBoss[0].shock && (ActBossChar_Undead(void)::_flash >> 1) & 1 )
      {
        stru_81CD270.ani_no = 1;
        stru_81CD31C.ani_no = 1;
      }
      else
      {
        stru_81CD270.ani_no = 0;
        stru_81CD31C.ani_no = 0;
      }
      if ( gBoss[0].life < ActBossChar_Undead(void)::_life - 150 || gBoss[0].act_wait > 400 || gBoss[0].life <= 199 )
        gBoss[0].act_no = 200;
      goto LABEL_108;
    }
LABEL_79:
    ++ActBossChar_Undead(void)::_flash;
    if ( gBoss[0].shock && (ActBossChar_Undead(void)::_flash >> 1) & 1 )
    {
      stru_81CD270.ani_no = 1;
      stru_81CD31C.ani_no = 1;
    }
    else
    {
      stru_81CD270.ani_no = 0;
      stru_81CD31C.ani_no = 0;
    }
    if ( ++gBoss[0].act_wait % 100 == 1 )
    {
      gCurlyShoot_wait = Random(80, 100);
      gCurlyShoot_x = stru_81CD724.x;
      gCurlyShoot_y = stru_81CD724.y;
    }
    if ( gBoss[0].act_wait % 120 == 1 )
      SetNpChar(288, gBoss[0].x - 0x4000, gBoss[0].y - 0x2000, 0, 0, 1, 0, 32);
    if ( gBoss[0].act_wait % 120 == 61 )
      SetNpChar(288, gBoss[0].x - 0x4000, gBoss[0].y + 0x2000, 0, 0, 3, 0, 32);
    goto LABEL_108;
  }
  if ( v0 == 15 )
  {
    gBoss[0].act_no = 16;
    bShock = 1;
    gBoss[0].direct = 0;
    stru_81CD1C4.act_no = 10;
    stru_81CD270.ani_no = 0;
    goto LABEL_108;
  }
  if ( v0 > 15 )
  {
    if ( v0 == 20 )
    {
      gBoss[0].act_no = 210;
      bShock = 1;
      gBoss[0].direct = 0;
      npc.act_no = 5;
      stru_81CD118.act_no = 5;
      stru_81CD3C8.act_no = 5;
      stru_81CD474.act_no = 5;
      goto LABEL_108;
    }
    if ( v0 <= 20 )
      goto LABEL_108;
    if ( v0 == 200 )
    {
      gBoss[0].act_no = 201;
      gBoss[0].act_wait = 0;
      stru_81CD1C4.act_no = 0;
      stru_81CD270.ani_no = 2;
      stru_81CD31C.ani_no = 0;
      stru_81CD520.bits &= 0xFFFBu;
      stru_81CD5CC.bits &= 0xFFFBu;
      stru_81CD678.bits &= 0xFFFBu;
      stru_81CD724.bits &= 0xFFDFu;
      gSuperYpos = 0;
      CutNoise();
      bShock = 1;
    }
    else if ( v0 != 201 )
    {
      goto LABEL_108;
    }
    ++gBoss[0].act_wait;
    if ( (gBoss[0].direct == 2 || gBoss[0].ani_no > 0 || gBoss[0].life <= 199) && gBoss[0].act_wait > 200 )
    {
      ++gBoss[0].count1;
      PlaySoundObject(115, 1);
      if ( gBoss[0].life > 199 )
      {
        if ( gBoss[0].count1 <= 2 )
          gBoss[0].act_no = 210;
        else
          gBoss[0].act_no = 220;
      }
      else
      {
        gBoss[0].act_no = 230;
      }
    }
  }
  else if ( v0 == 1 )
  {
    gBoss[0].act_no = 10;
    gBoss[0].exp = 1;
    gBoss[0].cond = -128;
    gBoss[0].bits = -32756;
    gBoss[0].life = 700;
    gBoss[0].hit_voice = 114;
    gBoss[0].x = 303104;
    gBoss[0].y = 61440;
    gBoss[0].xm = 0;
    gBoss[0].ym = 0;
    gBoss[0].code_event = 1000;
    v1 = gBoss[0].bits;
    HIBYTE(v1) |= 2u;
    gBoss[0].bits = v1;
    stru_81CD1C4.cond = -128;
    stru_81CD1C4.act_no = 0;
    stru_81CD270.cond = -128;
    stru_81CD270.act_no = 10;
    stru_81CD31C.cond = -128;
    stru_81CD31C.act_no = 10;
    stru_81CD520.cond = -128;
    stru_81CD520.bits = 8;
    stru_81CD520.view.front = 0;
    stru_81CD520.view.top = 0;
    stru_81CD520.hit.back = 20480;
    stru_81CD520.hit.top = 0x2000;
    stru_81CD520.hit.bottom = 0x2000;
    stru_81CD520.count1 = 0;
    qmemcpy(&stru_81CD5CC, &stru_81CD520, sizeof(stru_81CD5CC));
    stru_81CD5CC.hit.back = 18432;
    stru_81CD5CC.hit.top = 12288;
    stru_81CD5CC.hit.bottom = 12288;
    stru_81CD5CC.count1 = 1;
    qmemcpy(&stru_81CD678, &stru_81CD520, sizeof(stru_81CD678));
    stru_81CD678.hit.back = 22528;
    stru_81CD678.hit.top = 4096;
    stru_81CD678.hit.bottom = 4096;
    stru_81CD678.count1 = 2;
    qmemcpy(&stru_81CD724, &stru_81CD520, sizeof(stru_81CD724));
    stru_81CD724.cond |= 0x10u;
    stru_81CD724.hit.back = 10240;
    stru_81CD724.hit.top = 10240;
    stru_81CD724.hit.bottom = 10240;
    stru_81CD724.count1 = 3;
    npc.cond = -128;
    npc.act_no = 0;
    npc.bits = 40;
    npc.life = 1000;
    npc.hit_voice = 54;
    npc.hit.back = 12288;
    npc.hit.top = 0x2000;
    npc.hit.bottom = 0x2000;
    npc.view.front = 0x4000;
    npc.view.top = 10240;
    npc.pNpc = gBoss;
    qmemcpy(&stru_81CD118, &npc, sizeof(stru_81CD118));
    stru_81CD118.count2 = 128;
    qmemcpy(&stru_81CD3C8, &npc, sizeof(stru_81CD3C8));
    stru_81CD3C8.count1 = 1;
    qmemcpy(&stru_81CD474, &npc, sizeof(stru_81CD474));
    stru_81CD474.count1 = 1;
    stru_81CD474.count2 = 128;
    ActBossChar_Undead(void)::_life = gBoss[0].life;
  }
LABEL_108:
  if ( bShock )
  {
    SetQuake(20);
    if ( gBoss[0].act_no == 201 )
    {
      stru_81CD474.act_no = 10;
      stru_81CD3C8.act_no = 10;
      stru_81CD118.act_no = 10;
      npc.act_no = 10;
    }
    if ( gBoss[0].act_no == 221 )
    {
      stru_81CD474.act_no = 20;
      stru_81CD3C8.act_no = 20;
      stru_81CD118.act_no = 20;
      npc.act_no = 20;
    }
    if ( gBoss[0].act_no == 231 )
    {
      stru_81CD474.act_no = 30;
      stru_81CD3C8.act_no = 30;
      stru_81CD118.act_no = 30;
      npc.act_no = 30;
    }
    PlaySoundObject(26, 1);
    for ( ic = 0; ic <= 7; ++ic )
    {
      v19 = Random(-256, 256);
      v20 = Random(-512, 512);
      v21 = stru_81CD270.y;
      v22 = stru_81CD270.x;
      v23 = Random(-32, 16);
      SetNpChar(4, v22 + (v23 << 9), v21, v20, v19, 0, 0, 256);
    }
  }
  if ( gBoss[0].act_no > 199 && gBoss[0].act_no <= 299 )
  {
    if ( gBoss[0].x <= 98303 )
      gBoss[0].direct = 2;
    if ( gBoss[0].x > (gMap.width - 4) << 13 )
      gBoss[0].direct = 0;
    if ( gBoss[0].direct )
      v24 = gBoss[0].xm + 4;
    else
      v24 = gBoss[0].xm - 4;
    gBoss[0].xm = v24;
  }
  if ( (unsigned int)(gBoss[0].act_no - 201) <= 0x1E && (1 << (LOBYTE(gBoss[0].act_no) + 55)) & 0x40100401 )
  {
    if ( ++gBoss[0].count2 == 150 )
    {
      gBoss[0].count2 = 0;
      v25 = Random(-1, 3);
      SetNpChar(282, ((gMap.width << 7) + 1) << 6, (v25 + 10) << 13, 0, 0, 0, 0, 48);
    }
    else if ( gBoss[0].count2 == 75 )
    {
      v26 = Random(-3, 0);
      SetNpChar(282, ((gMap.width << 7) + 1) << 6, (v26 + 3) << 13, 0, 0, 0, 0, 48);
    }
  }
  if ( gBoss[0].xm > 128 )
    gBoss[0].xm = 128;
  if ( gBoss[0].xm < -128 )
    gBoss[0].xm = -128;
  if ( gBoss[0].ym > 128 )
    gBoss[0].ym = 128;
  if ( gBoss[0].ym < -128 )
    gBoss[0].ym = -128;
  gBoss[0].x += gBoss[0].xm;
  gBoss[0].y += gBoss[0].ym;
  _ActBossCharA_Face(&stru_81CD1C4);
  _ActBossCharA_Head(&stru_81CD270);
  _ActBossCharA_Tail(&stru_81CD31C);
  _ActBossCharA_Mini(&npc);
  _ActBossCharA_Mini(&stru_81CD118);
  _ActBossCharA_Mini(&stru_81CD3C8);
  _ActBossCharA_Mini(&stru_81CD474);
  _ActBossCharA_Hit(&stru_81CD520);
  _ActBossCharA_Hit(&stru_81CD5CC);
  _ActBossCharA_Hit(&stru_81CD678);
  _ActBossCharA_Hit(&stru_81CD724);
}

//----- (080970C0) --------------------------------------------------------
void __cdecl ActBossChar_Core_Face(NPCHAR_0 *npc)
{
  int v1;
  RECT *v2;
  RECT rect[4];

  rect[0].left = 0;
  rect[0].top = 0;
  rect[0].right = 72;
  rect[0].bottom = 112;
  rect[1].left = 0;
  rect[1].top = 112;
  rect[1].right = 72;
  rect[1].bottom = 224;
  rect[2].left = 160;
  rect[2].top = 0;
  rect[2].right = 232;
  rect[2].bottom = 112;
  rect[3].left = 0;
  rect[3].top = 0;
  rect[3].right = 0;
  rect[3].bottom = 0;
  v1 = npc->act_no;
  if ( v1 == 51 )
  {
LABEL_12:
    if ( !--npc->act_wait )
    {
      npc->act_no = 100;
      npc->ani_no = 3;
    }
    npc->x = unk_81CCFC8 - 18432;
    npc->y = unk_81CCFCC;
    goto LABEL_16;
  }
  if ( v1 <= 51 )
  {
    if ( v1 != 50 )
    {
      if ( v1 == 10 )
      {
        npc->act_no = 11;
        npc->ani_no = 2;
        npc->bits = 8;
        npc->view.front = 18432;
        npc->view.top = 28672;
      }
      else if ( v1 != 11 )
      {
        goto LABEL_16;
      }
      npc->x = unk_81CCFC8 - 18432;
      npc->y = unk_81CCFCC;
      goto LABEL_16;
    }
    npc->act_no = 51;
    npc->act_wait = 112;
    goto LABEL_12;
  }
  if ( v1 == 100 )
    npc->ani_no = 3;
LABEL_16:
  v2 = &rect[npc->ani_no];
  npc->rect.left = v2->left;
  npc->rect.top = v2->top;
  npc->rect.right = v2->right;
  npc->rect.bottom = v2->bottom;
  if ( npc->act_no == 51 )
    npc->rect.bottom = npc->act_wait + npc->rect.top;
}

//----- (08097277) --------------------------------------------------------
void __cdecl ActBossChar_Core_Tail(NPCHAR_0 *npc)
{
  int v1;
  RECT *v2;
  RECT rect[3];

  rect[0].left = 72;
  rect[0].top = 0;
  rect[0].right = 160;
  rect[0].bottom = 112;
  rect[1].left = 72;
  rect[1].top = 112;
  rect[1].right = 160;
  rect[1].bottom = 224;
  rect[2].left = 0;
  rect[2].top = 0;
  rect[2].right = 0;
  rect[2].bottom = 0;
  v1 = npc->act_no;
  if ( v1 == 51 )
  {
LABEL_12:
    if ( !--npc->act_wait )
    {
      npc->act_no = 100;
      npc->ani_no = 2;
    }
    npc->x = unk_81CCFC8 + 22528;
    npc->y = unk_81CCFCC;
    goto LABEL_16;
  }
  if ( v1 <= 51 )
  {
    if ( v1 != 50 )
    {
      if ( v1 == 10 )
      {
        npc->act_no = 11;
        npc->ani_no = 0;
        npc->bits = 8;
        npc->view.front = 22528;
        npc->view.top = 28672;
      }
      else if ( v1 != 11 )
      {
        goto LABEL_16;
      }
      npc->x = unk_81CCFC8 + 22528;
      npc->y = unk_81CCFCC;
      goto LABEL_16;
    }
    npc->act_no = 51;
    npc->act_wait = 112;
    goto LABEL_12;
  }
  if ( v1 == 100 )
    npc->ani_no = 2;
LABEL_16:
  v2 = &rect[npc->ani_no];
  npc->rect.left = v2->left;
  npc->rect.top = v2->top;
  npc->rect.right = v2->right;
  npc->rect.bottom = v2->bottom;
  if ( npc->act_no == 51 )
    npc->rect.bottom = npc->act_wait + npc->rect.top;
}

//----- (08097412) --------------------------------------------------------
void __cdecl ActBossChar_Core_Mini(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  Sint32 *v6;
  RECT rect[3];
  int xm;
  int ym;
  unsigned __int8 deg;
  char v11[8];

  rect[0].left = 256;
  rect[0].top = 0;
  rect[0].right = 320;
  rect[0].bottom = 40;
  rect[1].left = 256;
  rect[1].top = 40;
  rect[1].right = 320;
  rect[1].bottom = 80;
  rect[2].left = 256;
  rect[2].top = 80;
  rect[2].right = 320;
  rect[2].bottom = 120;
  npc->life = 1000;
  v1 = npc->act_no;
  if ( v1 == 121 )
  {
LABEL_24:
    if ( ++npc->act_wait / 2 & 1 )
      npc->ani_no = 0;
    else
      npc->ani_no = 1;
    if ( npc->act_wait > 20 )
      npc->act_no = 130;
    goto LABEL_39;
  }
  if ( v1 > 121 )
  {
    if ( v1 == 140 )
    {
      npc->x += (npc->tgt_x - npc->x) / 16;
      npc->y += (npc->tgt_y - npc->y) / 16;
      goto LABEL_39;
    }
    if ( v1 > 140 )
    {
      if ( v1 == 200 )
      {
        npc->act_no = 201;
        npc->ani_no = 2;
        npc->xm = 0;
        npc->ym = 0;
      }
      else if ( v1 != 201 )
      {
        goto LABEL_39;
      }
      npc->xm += 32;
      npc->x += npc->xm;
      if ( npc->x > (gMap.width + 2) << 13 )
        npc->cond = 0;
    }
    else
    {
      if ( v1 == 130 )
      {
        npc->act_no = 131;
        npc->ani_no = 2;
        npc->act_wait = 0;
        v4 = npc->x;
        npc->tgt_x = v4 + (Random(24, 48) << 9);
        v5 = npc->y;
        npc->tgt_y = v5 + (Random(-4, 4) << 9);
      }
      else if ( v1 != 131 )
      {
        goto LABEL_39;
      }
      npc->x += (npc->tgt_x - npc->x) / 16;
      npc->y += (npc->tgt_y - npc->y) / 16;
      if ( ++npc->act_wait > 50 )
      {
        npc->act_no = 140;
        npc->ani_no = 0;
      }
      if ( npc->act_wait == 1 || npc->act_wait == 3 )
      {
        deg = GetArktan(npc->x - x, npc->y - y);
        deg += Random(-2, 2);
        ym = 2 * GetSin(deg);
        xm = 2 * GetCos(deg);
        SetNpChar(178, npc->x, npc->y, xm, ym, 0, 0, 256);
        PlaySoundObject(39, 1);
      }
    }
  }
  else
  {
    if ( v1 == 100 )
    {
      npc->act_no = 101;
      npc->ani_no = 2;
      npc->act_wait = 0;
      v2 = unk_81CCFC8;
      npc->tgt_x = v2 + (Random(-128, 32) << 9);
      v3 = unk_81CCFCC;
      npc->tgt_y = v3 + (Random(-64, 64) << 9);
      npc->bits |= 0x20u;
    }
    else
    {
      if ( v1 <= 100 )
      {
        if ( v1 && v1 == 10 )
        {
          npc->ani_no = 2;
          npc->bits &= 0xFFDFu;
        }
        goto LABEL_39;
      }
      if ( v1 != 101 )
      {
        if ( v1 != 120 )
          goto LABEL_39;
        npc->act_no = 121;
        npc->act_wait = 0;
        goto LABEL_24;
      }
    }
    npc->x += (npc->tgt_x - npc->x) / 16;
    npc->y += (npc->tgt_y - npc->y) / 16;
    if ( ++npc->act_wait > 50 )
      npc->ani_no = 0;
  }
LABEL_39:
  if ( npc->shock )
    npc->tgt_x += 1024;
  v6 = (Sint32 *)&v11[16 * npc->ani_no - 60];
  npc->rect.left = *v6;
  npc->rect.top = v6[1];
  npc->rect.right = v6[2];
  npc->rect.bottom = v6[3];
}


//----- (0809799A) --------------------------------------------------------
void __cdecl ActBossChar_Core_Hit(NPCHAR_0 *npc)
{
  int v1;

  v1 = npc->count1;
  if ( v1 == 1 )
  {
    npc->x = unk_81CCFC8 + 14336;
    npc->y = unk_81CCFCC;
  }
  else if ( v1 > 1 )
  {
    if ( v1 == 2 )
    {
      npc->x = unk_81CCFC8 + 2048;
      npc->y = unk_81CCFCC + 0x4000;
    }
    else if ( v1 == 3 )
    {
      npc->x = unk_81CCFC8 - 14336;
      npc->y = unk_81CCFCC + 2048;
    }
  }
  else if ( !v1 )
  {
    npc->x = unk_81CCFC8;
    npc->y = unk_81CCFCC - 0x4000;
  }
}

//----- (08097A4B) --------------------------------------------------------
void ActBossChar_Core()
{
  int v0;
  unsigned __int16 v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  int v8;
  int v9;
  unsigned __int8 deg;
  int ym;
  int v12;
  int v13;
  int v14;
  int v15;
  int v16;
  int v17;
  int v18;
  int v19;
  int v20;
  int v21;
  int v22;
  int v23;
  int v24;
  int v25;
  int v26;
  int v27;
  int v28;
  int v29;
  int v30;
  int v31;
  int v32;
  int v33;
  int v34;
  bool bShock;
  int i;
  int ia;
  int ib;

  bShock = 0;
  v0 = gBoss[0].act_no;
  if ( v0 == 211 )
  {
LABEL_27:
    gBoss[0].tgt_x = x;
    gBoss[0].tgt_y = y;
    if ( gBoss[0].shock )
    {
      if ( (++ActBossChar_Core(void)::_flash >> 1) & 1 )
      {
        stru_81CD270.ani_no = 0;
        stru_81CD31C.ani_no = 0;
      }
      else
      {
        stru_81CD270.ani_no = 1;
        stru_81CD31C.ani_no = 1;
      }
    }
    else
    {
      stru_81CD270.ani_no = 0;
      stru_81CD31C.ani_no = 0;
    }
    if ( ++gBoss[0].act_wait % 100 == 1 )
    {
      gCurlyShoot_wait = Random(80, 100);
      gCurlyShoot_x = stru_81CD724.x;
      gCurlyShoot_y = stru_81CD724.y;
    }
    if ( gBoss[0].act_wait <= 199 && gBoss[0].act_wait % 20 == 1 )
    {
      v2 = gBoss[0].y;
      v3 = (Random(-64, 64) << 9) + v2;
      v4 = gBoss[0].x;
      v5 = Random(-48, -16);
      SetNpChar(179, v4 + (v5 << 9), v3, 0, 0, 0, 0, 256);
    }
    if ( gBoss[0].act_wait > 400 || gBoss[0].life < gBoss[0].count2 - 200 )
    {
      gBoss[0].act_no = 200;
      stru_81CD270.ani_no = 2;
      stru_81CD31C.ani_no = 0;
      bShock = 1;
    }
    goto LABEL_75;
  }
  if ( v0 > 211 )
  {
    if ( v0 != 500 )
    {
      if ( v0 <= 500 )
      {
        if ( v0 == 220 )
        {
          gBoss[0].act_no = 221;
          gBoss[0].act_wait = 0;
          gSuperYpos = 1;
          stru_81CD724.bits |= 0x20u;
          SetQuake(100);
          SetNoise(1, 1000);
        }
        else if ( v0 != 221 )
        {
          goto LABEL_75;
        }
        ++gBoss[0].act_wait;
        v6 = y;
        v7 = (Random(-160, 160) << 9) + v6;
        v8 = x;
        v9 = Random(-50, 150);
        SetNpChar(199, v8 + (v9 << 10), v7, 0, 0, 0, 0, 256);
        unk_81C85B4 -= 32;
        gMC.cond |= 0x20u;
        if ( gBoss[0].shock )
        {
          if ( (++ActBossChar_Core(void)::_flash >> 1) & 1 )
          {
            stru_81CD270.ani_no = 0;
            stru_81CD31C.ani_no = 0;
          }
          else
          {
            stru_81CD270.ani_no = 1;
            stru_81CD31C.ani_no = 1;
          }
        }
        else
        {
          stru_81CD270.ani_no = 0;
          stru_81CD31C.ani_no = 0;
        }
        if ( gBoss[0].act_wait == 300 || gBoss[0].act_wait == 350 || gBoss[0].act_wait == 400 )
        {
          deg = GetArktan(gBoss[0].x - x, gBoss[0].y - y);
          ym = 3 * GetSin(deg);
          v12 = GetCos(deg);
          SetNpChar(218, gBoss[0].x - 20480, gBoss[0].y, 3 * v12, ym, 0, 0, 256);
          PlaySoundObject(101, 1);
        }
        if ( gBoss[0].act_wait > 400 )
        {
          gBoss[0].act_no = 200;
          stru_81CD270.ani_no = 2;
          stru_81CD31C.ani_no = 0;
          bShock = 1;
        }
        goto LABEL_75;
      }
      switch ( v0 )
      {
        case 600:
          gBoss[0].act_no = 601;
          stru_81CD270.act_no = 50;
          stru_81CD31C.act_no = 50;
          stru_81CD520.bits &= 0xFFFBu;
          stru_81CD5CC.bits &= 0xFFFBu;
          stru_81CD678.bits &= 0xFFFBu;
          stru_81CD724.bits &= 0xFFFBu;
          break;
        case 601:
          break;
        case 501:
          goto LABEL_58;
        default:
          goto LABEL_75;
      }
      if ( ++gBoss[0].act_wait / 2 & 1 )
        v28 = gBoss[0].x - 2048;
      else
        v28 = gBoss[0].x + 2048;
      gBoss[0].x = v28;
      goto LABEL_75;
    }
    CutNoise();
    gBoss[0].act_no = 501;
    gBoss[0].act_wait = 0;
    gBoss[0].xm = 0;
    gBoss[0].ym = 0;
    stru_81CD270.ani_no = 2;
    stru_81CD31C.ani_no = 0;
    npc.act_no = 200;
    stru_81CD118.act_no = 200;
    stru_81CD1C4.act_no = 200;
    stru_81CD3C8.act_no = 200;
    stru_81CD474.act_no = 200;
    SetQuake(20);
    for ( i = 0; i <= 31; ++i )
    {
      v13 = Random(-128, 128) << 9;
      v14 = Random(-128, 128) << 9;
      v15 = gBoss[0].y;
      v16 = (Random(-64, 64) << 9) + v15;
      v17 = gBoss[0].x;
      v18 = Random(-128, 128);
      SetNpChar(4, v17 + (v18 << 9), v16, v14, v13, 0, 0, 256);
    }
    for ( ia = 0; ia <= 11; ++ia )
      *((_WORD *)&unk_81CD010 + 86 * ia) &= 0xFFDBu;
LABEL_58:
    if ( ++gBoss[0].act_wait & 0xF )
    {
      v19 = Random(-128, 128) << 9;
      v20 = Random(-128, 128) << 9;
      v21 = gBoss[0].y;
      v22 = (Random(-32, 32) << 9) + v21;
      v23 = gBoss[0].x;
      v24 = Random(-64, 64);
      SetNpChar(4, v23 + (v24 << 9), v22, v20, v19, 0, 0, 256);
    }
    if ( gBoss[0].act_wait / 2 & 1 )
      v25 = gBoss[0].x - 512;
    else
      v25 = gBoss[0].x + 512;
    gBoss[0].x = v25;
    if ( gBoss[0].x > 516095 )
      v26 = gBoss[0].x - 128;
    else
      v26 = gBoss[0].x + 128;
    gBoss[0].x = v26;
    if ( gBoss[0].y > 90111 )
      v27 = gBoss[0].y - 128;
    else
      v27 = gBoss[0].y + 128;
    gBoss[0].y = v27;
    goto LABEL_75;
  }
  if ( v0 == 200 )
  {
    gBoss[0].act_no = 201;
    gBoss[0].act_wait = 0;
    stru_81CD724.bits &= 0xFFDFu;
    gSuperYpos = 0;
    CutNoise();
  }
  else
  {
    if ( v0 <= 200 )
    {
      if ( !v0 )
      {
        gBoss[0].act_no = 10;
        gBoss[0].exp = 1;
        gBoss[0].cond = -128;
        gBoss[0].bits = -32756;
        gBoss[0].life = 650;
        gBoss[0].hit_voice = 114;
        gBoss[0].x = 630784;
        gBoss[0].y = 114688;
        gBoss[0].xm = 0;
        gBoss[0].ym = 0;
        gBoss[0].code_event = 1000;
        v1 = gBoss[0].bits;
        HIBYTE(v1) |= 2u;
        gBoss[0].bits = v1;
        stru_81CD270.cond = -128;
        stru_81CD270.act_no = 10;
        stru_81CD31C.cond = -128;
        stru_81CD31C.act_no = 10;
        stru_81CD520.cond = -128;
        stru_81CD520.bits = 12;
        stru_81CD520.view.front = 0;
        stru_81CD520.view.top = 0;
        stru_81CD520.hit.back = 20480;
        stru_81CD520.hit.top = 0x2000;
        stru_81CD520.hit.bottom = 0x2000;
        stru_81CD520.count1 = 0;
        qmemcpy(&stru_81CD5CC, &stru_81CD520, sizeof(stru_81CD5CC));
        stru_81CD5CC.hit.back = 18432;
        stru_81CD5CC.hit.top = 12288;
        stru_81CD5CC.hit.bottom = 12288;
        stru_81CD5CC.count1 = 1;
        qmemcpy(&stru_81CD678, &stru_81CD520, sizeof(stru_81CD678));
        stru_81CD678.hit.back = 22528;
        stru_81CD678.hit.top = 4096;
        stru_81CD678.hit.bottom = 4096;
        stru_81CD678.count1 = 2;
        qmemcpy(&stru_81CD724, &stru_81CD520, sizeof(stru_81CD724));
        stru_81CD724.cond |= 0x10u;
        stru_81CD724.hit.back = 10240;
        stru_81CD724.hit.top = 10240;
        stru_81CD724.hit.bottom = 10240;
        stru_81CD724.count1 = 3;
        npc.cond = -128;
        npc.act_no = 10;
        npc.bits = 44;
        npc.life = 1000;
        npc.hit_voice = 54;
        npc.hit.back = 12288;
        npc.hit.top = 0x2000;
        npc.hit.bottom = 0x2000;
        npc.view.front = 0x4000;
        npc.view.top = 10240;
        npc.x = gBoss[0].x - 4096;
        npc.y = gBoss[0].y - 0x8000;
        qmemcpy(&stru_81CD118, &npc, sizeof(stru_81CD118));
        stru_81CD118.x = gBoss[0].x + 0x2000;
        stru_81CD118.y = gBoss[0].y;
        qmemcpy(&stru_81CD1C4, &npc, sizeof(stru_81CD1C4));
        stru_81CD1C4.x = gBoss[0].x - 4096;
        stru_81CD1C4.y = gBoss[0].y + 0x8000;
        qmemcpy(&stru_81CD3C8, &npc, sizeof(stru_81CD3C8));
        stru_81CD3C8.x = gBoss[0].x - 24576;
        stru_81CD3C8.y = gBoss[0].y - 0x4000;
        qmemcpy(&stru_81CD474, &npc, sizeof(stru_81CD474));
        stru_81CD474.x = gBoss[0].x - 24576;
        stru_81CD474.y = gBoss[0].y + 0x4000;
      }
      goto LABEL_75;
    }
    if ( v0 != 201 )
    {
      if ( v0 != 210 )
        goto LABEL_75;
      gBoss[0].act_no = 211;
      gBoss[0].act_wait = 0;
      gBoss[0].count2 = gBoss[0].life;
      stru_81CD724.bits |= 0x20u;
      goto LABEL_27;
    }
  }
  gBoss[0].tgt_x = x;
  gBoss[0].tgt_y = y;
  if ( ++gBoss[0].act_wait > 400 )
  {
    ++gBoss[0].count1;
    PlaySoundObject(115, 1);
    if ( gBoss[0].count1 <= 3 )
    {
      gBoss[0].act_no = 210;
    }
    else
    {
      gBoss[0].count1 = 0;
      gBoss[0].act_no = 220;
    }
    stru_81CD270.ani_no = 0;
    stru_81CD31C.ani_no = 0;
    bShock = 1;
  }
LABEL_75:
  if ( bShock )
  {
    SetQuake(20);
    npc.act_no = 100;
    stru_81CD118.act_no = 100;
    stru_81CD1C4.act_no = 100;
    stru_81CD3C8.act_no = 100;
    stru_81CD474.act_no = 100;
    PlaySoundObject(26, 1);
    for ( ib = 0; ib <= 7; ++ib )
    {
      v29 = Random(-256, 256);
      v30 = Random(-512, 512);
      v31 = stru_81CD270.y;
      v32 = stru_81CD270.x;
      v33 = Random(-32, 16);
      SetNpChar(4, v32 + (v33 << 9), v31, v30, v29, 0, 0, 256);
    }
  }
  if ( gBoss[0].act_no > 199 && gBoss[0].act_no <= 299 )
  {
    v34 = gBoss[0].act_wait;
    if ( v34 == 140 )
    {
      stru_81CD1C4.act_no = 120;
    }
    else if ( v34 > 140 )
    {
      if ( v34 == 170 )
      {
        stru_81CD3C8.act_no = 120;
      }
      else if ( v34 == 200 )
      {
        stru_81CD474.act_no = 120;
      }
    }
    else if ( v34 == 80 )
    {
      npc.act_no = 120;
    }
    else if ( v34 == 110 )
    {
      stru_81CD118.act_no = 120;
    }
    if ( gBoss[0].x < gBoss[0].tgt_x + 81920 )
      gBoss[0].xm += 4;
    if ( gBoss[0].x > gBoss[0].tgt_x + 81920 )
      gBoss[0].xm -= 4;
    if ( gBoss[0].y < gBoss[0].tgt_y )
      gBoss[0].ym += 4;
    if ( gBoss[0].y > gBoss[0].tgt_y )
      gBoss[0].ym -= 4;
  }
  if ( gBoss[0].xm > 128 )
    gBoss[0].xm = 128;
  if ( gBoss[0].xm < -128 )
    gBoss[0].xm = -128;
  if ( gBoss[0].ym > 128 )
    gBoss[0].ym = 128;
  if ( gBoss[0].ym < -128 )
    gBoss[0].ym = -128;
  gBoss[0].x += gBoss[0].xm;
  gBoss[0].y += gBoss[0].ym;
  ActBossChar_Core_Face(&stru_81CD270);
  ActBossChar_Core_Tail(&stru_81CD31C);
  ActBossChar_Core_Mini(&npc);
  ActBossChar_Core_Mini(&stru_81CD118);
  ActBossChar_Core_Mini(&stru_81CD1C4);
  ActBossChar_Core_Mini(&stru_81CD3C8);
  ActBossChar_Core_Mini(&stru_81CD474);
  ActBossChar_Core_Hit(&stru_81CD520);
  ActBossChar_Core_Hit(&stru_81CD5CC);
  ActBossChar_Core_Hit(&stru_81CD678);
  ActBossChar_Core_Hit(&stru_81CD724);
}

//----- (08098A70) --------------------------------------------------------
void InitCaret()
{
  memset(gCrt, 0, 0x1100u);
}

//----- (08098A94) --------------------------------------------------------
void __cdecl ActCaret00()
{
  ;
}

//----- (08098A99) --------------------------------------------------------
void __cdecl ActCaret01($4AB8D1A8A7198C298836BEA20F02E4D8 *crt)
{
  $4AB8D1A8A7198C298836BEA20F02E4D8 *v1;
  Sint32 *v2;
  RECT rcRight[4];
  RECT rcLeft[4];
  char v5[8];

  rcLeft[0].left = 0;
  rcLeft[0].top = 64;
  rcLeft[0].right = 8;
  rcLeft[0].bottom = 72;
  rcLeft[1].left = 8;
  rcLeft[1].top = 64;
  rcLeft[1].right = 16;
  rcLeft[1].bottom = 72;
  rcLeft[2].left = 16;
  rcLeft[2].top = 64;
  rcLeft[2].right = 24;
  rcLeft[2].bottom = 72;
  rcLeft[3].left = 24;
  rcLeft[3].top = 64;
  rcLeft[3].right = 32;
  rcLeft[3].bottom = 72;
  rcRight[0].left = 64;
  rcRight[0].top = 24;
  rcRight[0].right = 72;
  rcRight[0].bottom = 32;
  rcRight[1].left = 72;
  rcRight[1].top = 24;
  rcRight[1].right = 80;
  rcRight[1].bottom = 32;
  rcRight[2].left = 80;
  rcRight[2].top = 24;
  rcRight[2].right = 88;
  rcRight[2].bottom = 32;
  rcRight[3].left = 88;
  rcRight[3].top = 24;
  rcRight[3].right = 96;
  rcRight[3].bottom = 32;
  if ( !crt->act_no )
  {
    crt->act_no = 1;
    crt->xm = Random(-1024, 1024);
    crt->ym = Random(-1024, 0);
  }
  crt->ym += 64;
  crt->x += crt->xm;
  crt->y += crt->ym;
  if ( ++crt->ani_wait > 5 )
  {
    crt->ani_wait = 0;
    if ( ++crt->ani_no > 3 )
      crt->cond = 0;
  }
  if ( crt->direct )
  {
    v1 = crt;
    v2 = (Sint32 *)&v5[16 * crt->ani_no - 128];
  }
  else
  {
    v1 = crt;
    v2 = (Sint32 *)&v5[16 * crt->ani_no - 64];
  }
  crt->rect.left = *v2;
  v1->rect.top = v2[1];
  v1->rect.right = v2[2];
  v1->rect.bottom = v2[3];
}


//----- (08098CB4) --------------------------------------------------------
void __cdecl ActCaret02($4AB8D1A8A7198C298836BEA20F02E4D8 *crt)
{
  int v1;
  RECT *v2;
  RECT *v3;
  RECT *v4;
  RECT rect_right[4];
  RECT rect_left[4];
  RECT rect_up[3];

  rect_left[0].left = 0;
  rect_left[0].top = 32;
  rect_left[0].right = 16;
  rect_left[0].bottom = 48;
  rect_left[1].left = 16;
  rect_left[1].top = 32;
  rect_left[1].right = 32;
  rect_left[1].bottom = 48;
  rect_left[2].left = 32;
  rect_left[2].top = 32;
  rect_left[2].right = 48;
  rect_left[2].bottom = 48;
  rect_left[3].left = 48;
  rect_left[3].top = 32;
  rect_left[3].right = 64;
  rect_left[3].bottom = 48;
  rect_right[0].left = 176;
  rect_right[0].top = 0;
  rect_right[0].right = 192;
  rect_right[0].bottom = 16;
  rect_right[1].left = 192;
  rect_right[1].top = 0;
  rect_right[1].right = 208;
  rect_right[1].bottom = 16;
  rect_right[2].left = 208;
  rect_right[2].top = 0;
  rect_right[2].right = 224;
  rect_right[2].bottom = 16;
  rect_right[3].left = 224;
  rect_right[3].top = 0;
  rect_right[3].right = 240;
  rect_right[3].bottom = 16;
  rect_up[0].left = 0;
  rect_up[0].top = 32;
  rect_up[0].right = 16;
  rect_up[0].bottom = 48;
  rect_up[1].left = 32;
  rect_up[1].top = 32;
  rect_up[1].right = 48;
  rect_up[1].bottom = 48;
  rect_up[2].left = 16;
  rect_up[2].top = 32;
  rect_up[2].right = 32;
  rect_up[2].bottom = 48;
  v1 = crt->direct;
  switch ( v1 )
  {
    case 1:
      v4 = &rect_up[++crt->ani_wait / 2 % 3];
      crt->rect.left = v4->left;
      crt->rect.top = v4->top;
      crt->rect.right = v4->right;
      crt->rect.bottom = v4->bottom;
      if ( crt->ani_wait > 24 )
        crt->cond = 0;
      break;
    case 2:
      if ( ++crt->ani_wait > 2 )
      {
        crt->ani_wait = 0;
        ++crt->ani_no;
      }
      if ( crt->ani_no > 3 )
        crt->cond = 0;
      v3 = &rect_right[crt->ani_no];
      crt->rect.left = v3->left;
      crt->rect.top = v3->top;
      crt->rect.right = v3->right;
      crt->rect.bottom = v3->bottom;
      break;
    case 0:
      crt->ym -= 16;
      crt->y += crt->ym;
      if ( ++crt->ani_wait > 5 )
      {
        crt->ani_wait = 0;
        ++crt->ani_no;
      }
      if ( crt->ani_no > 3 )
        crt->cond = 0;
      v2 = &rect_left[crt->ani_no];
      crt->rect.left = v2->left;
      crt->rect.top = v2->top;
      crt->rect.right = v2->right;
      crt->rect.bottom = v2->bottom;
      break;
  }
}

//----- (08098FB9) --------------------------------------------------------
void __cdecl ActCaret03($4AB8D1A8A7198C298836BEA20F02E4D8 *crt)
{
  RECT *v1;
  RECT rect[4];

  rect[0].left = 0;
  rect[0].top = 48;
  rect[0].right = 16;
  rect[0].bottom = 64;
  rect[1].left = 16;
  rect[1].top = 48;
  rect[1].right = 32;
  rect[1].bottom = 64;
  rect[2].left = 32;
  rect[2].top = 48;
  rect[2].right = 48;
  rect[2].bottom = 64;
  rect[3].left = 48;
  rect[3].top = 48;
  rect[3].right = 64;
  rect[3].bottom = 64;
  if ( ++crt->ani_wait > 2 )
  {
    crt->ani_wait = 0;
    if ( ++crt->ani_no > 3 )
      crt->cond = 0;
  }
  v1 = &rect[crt->ani_no];
  crt->rect.left = v1->left;
  crt->rect.top = v1->top;
  crt->rect.right = v1->right;
  crt->rect.bottom = v1->bottom;
}

//----- (080990A2) --------------------------------------------------------
void __cdecl ActCaret04($4AB8D1A8A7198C298836BEA20F02E4D8 *crt)
{
  Sint32 *v1;
  RECT rect[9];
  char v3[12];

  qmemcpy(rect, &ActCaret04(CARET *)::C.0, sizeof(rect));
  if ( ++crt->ani_wait > 1 )
  {
    crt->ani_wait = 0;
    if ( ++crt->ani_no > 2 )
      crt->cond = 0;
  }
  v1 = (Sint32 *)&v3[16 * (crt->ani_no + 3 * crt->direct) - 144];
  crt->rect.left = *v1;
  crt->rect.top = v1[1];
  crt->rect.right = v1[2];
  crt->rect.bottom = v1[3];
}


//----- (08099156) --------------------------------------------------------
void __cdecl ActCaret05($4AB8D1A8A7198C298836BEA20F02E4D8 *crt)
{
  Sint32 *v1;
  RECT rect[7];
  char v3[12];

  qmemcpy(rect, &ActCaret05(CARET *)::C.1, sizeof(rect));
  if ( ++crt->ani_wait > 4 )
  {
    crt->ani_wait = 0;
    ++crt->ani_no;
  }
  if ( crt->ani_no > 6 )
    crt->cond = 0;
  crt->x += 128;
  crt->y -= 128;
  v1 = (Sint32 *)&v3[16 * crt->ani_no - 112];
  crt->rect.left = *v1;
  crt->rect.top = v1[1];
  crt->rect.right = v1[2];
  crt->rect.bottom = v1[3];
}


//----- (08099210) --------------------------------------------------------
void __cdecl ActCaret07($4AB8D1A8A7198C298836BEA20F02E4D8 *crt)
{
  Sint32 *v1;
  int v2;
  RECT rcLeft[7];
  char v4[12];

  qmemcpy(rcLeft, &ActCaret07(CARET *)::C.2, sizeof(rcLeft));
  if ( ++crt->ani_wait > 1 )
  {
    crt->ani_wait = 0;
    if ( ++crt->ani_no > 6 )
      crt->cond = 0;
  }
  v1 = (Sint32 *)&v4[16 * crt->ani_no - 112];
  crt->rect.left = *v1;
  crt->rect.top = v1[1];
  crt->rect.right = v1[2];
  crt->rect.bottom = v1[3];
  v2 = crt->direct;
  if ( v2 == 1 )
  {
    crt->y -= 1024;
  }
  else if ( v2 > 1 )
  {
    if ( v2 == 2 )
    {
      crt->x += 1024;
    }
    else if ( v2 == 3 )
    {
      crt->y += 1024;
    }
  }
  else if ( !v2 )
  {
    crt->x -= 1024;
  }
}


//----- (08099319) --------------------------------------------------------
void __cdecl ActCaret08($4AB8D1A8A7198C298836BEA20F02E4D8 *crt)
{
  if ( crt->direct )
  {
    crt->rect.left = 32;
    crt->rect.top = 80;
    crt->rect.right = 48;
  }
  else
  {
    crt->rect.left = 16;
    crt->rect.top = 80;
    crt->rect.right = 32;
  }
  crt->rect.bottom = 96;
}

//----- (0809939B) --------------------------------------------------------
void __cdecl ActCaret09($4AB8D1A8A7198C298836BEA20F02E4D8 *crt)
{
  if ( ++crt->ani_wait <= 4 )
    crt->y -= 2048;
  if ( crt->ani_wait == 32 )
    crt->cond = 0;
  if ( crt->direct )
  {
    crt->rect.left = 48;
    crt->rect.top = 64;
    crt->rect.right = 64;
    crt->rect.bottom = 80;
  }
  else
  {
    crt->rect.left = 0;
    crt->rect.top = 80;
    crt->rect.right = 16;
    crt->rect.bottom = 96;
  }
}

//----- (0809945D) --------------------------------------------------------
void __cdecl ActCaret10($4AB8D1A8A7198C298836BEA20F02E4D8 *crt)
{
  $4AB8D1A8A7198C298836BEA20F02E4D8 *v1;
  RECT *v2;
  RECT rcRight[2];
  RECT rcLeft[2];

  rcLeft[0].left = 0;
  rcLeft[0].top = 0;
  rcLeft[0].right = 56;
  rcLeft[0].bottom = 16;
  rcLeft[1].left = 0;
  rcLeft[1].top = 16;
  rcLeft[1].right = 56;
  rcLeft[1].bottom = 32;
  rcRight[0].left = 0;
  rcRight[0].top = 96;
  rcRight[0].right = 56;
  rcRight[0].bottom = 112;
  rcRight[1].left = 0;
  rcRight[1].top = 112;
  rcRight[1].right = 56;
  rcRight[1].bottom = 128;
  ++crt->ani_wait;
  if ( crt->direct )
  {
    if ( crt->ani_wait <= 19 )
      crt->y -= 512;
    if ( crt->ani_wait == 80 )
      crt->cond = 0;
  }
  else
  {
    if ( crt->ani_wait <= 19 )
      crt->y -= 1024;
    if ( crt->ani_wait == 80 )
      crt->cond = 0;
  }
  if ( crt->direct )
  {
    v1 = crt;
    v2 = &rcRight[crt->ani_wait / 2 % 2];
  }
  else
  {
    v1 = crt;
    v2 = &rcLeft[crt->ani_wait / 2 % 2];
  }
  crt->rect.left = v2->left;
  v1->rect.top = v2->top;
  v1->rect.right = v2->right;
  v1->rect.bottom = v2->bottom;
}

//----- (080995EB) --------------------------------------------------------
void __cdecl ActCaret11($4AB8D1A8A7198C298836BEA20F02E4D8 *crt)
{
  Sint32 *v1;
  RECT rcRight[7];
  unsigned __int8 deg;
  char v4[24];

  if ( !crt->act_no )
  {
    crt->act_no = 1;
    deg = Random(0, 255);
    crt->xm = 2 * GetCos(deg);
    crt->ym = 2 * GetSin(deg);
  }
  crt->x += crt->xm;
  crt->y += crt->ym;
  qmemcpy(rcRight, &ActCaret11(CARET *)::C.3, sizeof(rcRight));
  if ( ++crt->ani_wait > 2 )
  {
    crt->ani_wait = 0;
    if ( ++crt->ani_no > 6 )
      crt->cond = 0;
  }
  v1 = (Sint32 *)&v4[16 * crt->ani_no - 116];
  crt->rect.left = *v1;
  crt->rect.top = v1[1];
  crt->rect.right = v1[2];
  crt->rect.bottom = v1[3];
}


//----- (0809970A) --------------------------------------------------------
void __cdecl ActCaret12($4AB8D1A8A7198C298836BEA20F02E4D8 *crt)
{
  RECT *v1;
  RECT rcLeft[2];

  rcLeft[0].left = 112;
  rcLeft[0].top = 0;
  rcLeft[0].right = 144;
  rcLeft[0].bottom = 32;
  rcLeft[1].left = 144;
  rcLeft[1].top = 0;
  rcLeft[1].right = 176;
  rcLeft[1].bottom = 32;
  if ( ++crt->ani_wait > 2 )
  {
    crt->ani_wait = 0;
    if ( ++crt->ani_no > 1 )
      crt->cond = 0;
  }
  v1 = &rcLeft[crt->ani_no];
  crt->rect.left = v1->left;
  crt->rect.top = v1->top;
  crt->rect.right = v1->right;
  crt->rect.bottom = v1->bottom;
}

//----- (080997BB) --------------------------------------------------------
void __cdecl ActCaret13($4AB8D1A8A7198C298836BEA20F02E4D8 *crt)
{
  int v1;
  Sint32 *v2;
  RECT rcLeft[2];
  char v4[8];

  rcLeft[0].left = 56;
  rcLeft[0].top = 24;
  rcLeft[0].right = 64;
  rcLeft[0].bottom = 32;
  rcLeft[1].left = 0;
  rcLeft[1].top = 0;
  rcLeft[1].right = 0;
  rcLeft[1].bottom = 0;
  if ( !crt->act_no )
  {
    crt->act_no = 1;
    v1 = crt->direct;
    if ( v1 )
    {
      if ( v1 == 1 )
        crt->ym = -512 * Random(1, 3);
    }
    else
    {
      crt->xm = Random(-1536, 1536);
      crt->ym = Random(-512, 512);
    }
  }
  if ( !crt->direct )
  {
    crt->xm = 4 * crt->xm / 5;
    crt->ym = 4 * crt->ym / 5;
  }
  crt->x += crt->xm;
  crt->y += crt->ym;
  if ( ++crt->ani_wait > 20 )
    crt->cond = 0;
  v2 = (Sint32 *)&v4[16 * (crt->ani_wait / 2 % 2) - 32];
  crt->rect.left = *v2;
  crt->rect.top = v2[1];
  crt->rect.right = v2[2];
  crt->rect.bottom = v2[3];
  if ( crt->direct == 5 )
    crt->x -= 2048;
}


//----- (0809997A) --------------------------------------------------------
void __cdecl ActCaret14($4AB8D1A8A7198C298836BEA20F02E4D8 *crt)
{
  Sint32 *v1;
  RECT rect[5];
  char v3[12];

  qmemcpy(rect, &ActCaret14(CARET *)::C.4, sizeof(rect));
  if ( ++crt->ani_wait > 1 )
  {
    crt->ani_wait = 0;
    if ( ++crt->ani_no > 4 )
      crt->cond = 0;
  }
  v1 = (Sint32 *)&v3[16 * crt->ani_no - 80];
  crt->rect.left = *v1;
  crt->rect.top = v1[1];
  crt->rect.right = v1[2];
  crt->rect.bottom = v1[3];
}


//----- (08099A13) --------------------------------------------------------
void __cdecl ActCaret15($4AB8D1A8A7198C298836BEA20F02E4D8 *crt)
{
  RECT *v1;
  RECT rcLeft[4];

  rcLeft[0].left = 0;
  rcLeft[0].top = 72;
  rcLeft[0].right = 8;
  rcLeft[0].bottom = 80;
  rcLeft[1].left = 8;
  rcLeft[1].top = 72;
  rcLeft[1].right = 16;
  rcLeft[1].bottom = 80;
  rcLeft[2].left = 16;
  rcLeft[2].top = 72;
  rcLeft[2].right = 24;
  rcLeft[2].bottom = 80;
  rcLeft[3].left = 24;
  rcLeft[3].top = 72;
  rcLeft[3].right = 32;
  rcLeft[3].bottom = 80;
  if ( ++crt->ani_wait > 2 )
  {
    crt->ani_wait = 0;
    if ( ++crt->ani_no > 3 )
      crt->cond = 0;
  }
  v1 = &rcLeft[crt->ani_no];
  crt->rect.left = v1->left;
  crt->rect.top = v1->top;
  crt->rect.right = v1->right;
  crt->rect.bottom = v1->bottom;
}

//----- (08099AFC) --------------------------------------------------------
void __cdecl ActCaret16($4AB8D1A8A7198C298836BEA20F02E4D8 *crt)
{
  RECT *v1;
  RECT rcLeft[2];

  rcLeft[0].left = 104;
  rcLeft[0].top = 96;
  rcLeft[0].right = 144;
  rcLeft[0].bottom = 104;
  rcLeft[1].left = 104;
  rcLeft[1].top = 104;
  rcLeft[1].right = 144;
  rcLeft[1].bottom = 112;
  if ( ++crt->ani_wait <= 9 )
    crt->y -= 1024;
  if ( crt->ani_wait == 40 )
    crt->cond = 0;
  v1 = &rcLeft[crt->ani_wait / 2 % 2];
  crt->rect.left = v1->left;
  crt->rect.top = v1->top;
  crt->rect.right = v1->right;
  crt->rect.bottom = v1->bottom;
}

//----- (08099BC1) --------------------------------------------------------
void __cdecl ActCaret17($4AB8D1A8A7198C298836BEA20F02E4D8 *crt)
{
  if ( ++crt->ani_wait > 39 )
    crt->ani_wait = 0;
  if ( crt->ani_wait > 29 )
  {
    crt->rect.left = 0;
    crt->rect.top = 0;
    crt->rect.right = 0;
    crt->rect.bottom = 0;
  }
  else
  {
    crt->rect.left = 0;
    crt->rect.top = 144;
    crt->rect.right = 144;
    crt->rect.bottom = 152;
  }
}

//----- (08099C68) --------------------------------------------------------
void ActCaret()
{
  int i;

  for ( i = 0; i <= 63; ++i )
  {
    if ( gCrt[i].cond & 0x80 )
      ((void (__cdecl *)())gpCaretFuncTbl[gCrt[i].code])();
  }
}

//----- (08099CDB) --------------------------------------------------------
void __cdecl PutCaret(int fx, int fy)
{
  __int64 v2;
  int i;

  for ( i = 0; i <= 63; ++i )
  {
    if ( gCrt[i].cond & 0x80 )
    {
      v2 = gCrt[i].y - gCrt[i].view_top;
      PutBitmap3(
        &grcGame,
        (gCrt[i].x - gCrt[i].view_left) / 512 - fx / 512,
        ((signed int)((HIDWORD(v2) >> 23) + v2) >> 9) - fy / 512,
        (RECT *)(68 * i + 136101268),
        19);
    }
  }
}

//----- (08099E03) --------------------------------------------------------
void __cdecl SetCaret(int x, int y, int code, int dir)
{
  int c;

  for ( c = 0; c <= 63 && gCrt[c].cond; ++c )
    ;
  if ( c != 64 )
  {
    memset((void *)(68 * c + 136101216), 0, 0x44u);
    gCrt[c].cond = 128;
    gCrt[c].code = code;
    gCrt[c].x = x;
    gCrt[c].y = y;
    gCrt[c].view_left = gCaretTable[code].view_left;
    gCrt[c].view_top = gCaretTable[code].view_top;
    gCrt[c].direct = dir;
  }
}

//----- (08099F24) --------------------------------------------------------
signed int InitDirectSound()
{
  SMixer_Init();
  initWaveTables();
  StartOrganya();
  SMixer_Start();
  return 1;
}

//----- (08099F4C) --------------------------------------------------------
void EndDirectSound()
{
  EndOrganya();
  SMixer_FreeChunks();
  SMixer_Quit();
}

//----- (08099F63) --------------------------------------------------------
void __cdecl PlaySoundObject(int no, int mode)
{
  if ( chunks[no] )
  {
    if ( mode )
    {
      if ( mode == 1 )
      {
        SMixer_PlayChunk(chunks[no], 0);
      }
      else if ( mode == -1 )
      {
        SMixer_StopChunk(chunks[no]);
        SMixer_PlayChunk(chunks[no], -1);
      }
    }
    else
    {
      SMixer_StopChunk(chunks[no]);
    }
  }
}

//----- (08099FE8) --------------------------------------------------------
void __cdecl ChangeSoundFrequency(int no, Uint32 rate)
{
  if ( chunks[no] )
    SMixer_SetFrequency(chunks[no], 10 * rate + 100);
}

//----- (0809A023) --------------------------------------------------------
int __cdecl MakePixToneObject($296577AB1FDEBC0CA4D43AF2DF231431 *ptp, int ptp_num, int no)
{
  SDL_AudioCVT_0 cvt;
  Uint8 *mixbuf;
  int sample_count;
  $FE85C58A60403E3389C96E96D80030A8 **const chunk;
  int i;

  sample_count = 0;
  for ( i = 0; i < ptp_num; ++i )
  {
    if ( ptp[i].size > sample_count )
      sample_count = ptp[i].size;
  }
  memset(&cvt, 0, 0x54u);
  mixPTWaves(&mixbuf, ptp, ptp_num);
  SDL_LockAudio();
  chunk = &chunks[no];
  if ( chunks[no] )
  {
    SMixer_StopChunk(*chunk);
    if ( (*chunk)->buf )
      free((*chunk)->buf);
    free(*chunk);
    *chunk = 0;
  }
  *chunk = ($FE85C58A60403E3389C96E96D80030A8 *)malloc(0x14u);
  (*chunk)->buf = mixbuf;
  (*chunk)->len = sample_count;
  SMixer_InitChunk(*chunk);
  SDL_UnlockAudio();
  return sample_count;
}



//----- (0809A13C) --------------------------------------------------------
void ReleaseDirectInput()
{
  if ( joystick )
  {
    SDL_JoystickClose(joystick);
    joystick = 0;
  }
}


//----- (0809A164) --------------------------------------------------------
bool __cdecl InitDirectInput()
{
  if ( SDL_NumJoysticks() > 0 )
    joystick = (SDL_Joystick *)SDL_JoystickOpen(0);
  return 1;
}



//----- (0809A190) --------------------------------------------------------
signed int __cdecl GetJoystickStatus($CC5B0FEB395DC4593A946B3182F5E0FD *pStatus)
{
  Sint16 x;
  __int16 v2;
  int v3;
  int button_count;
  int button;

  memset(pStatus, 0, 0x24u);
  if ( joystick )
  {
    x = SDL_JoystickGetAxis(joystick, 0);
    v2 = SDL_JoystickGetAxis(joystick, 1);
    pStatus->bLeft = x < -8191;
    pStatus->bRight = x > 0x1FFF;
    pStatus->bUp = v2 < -8191;
    pStatus->bDown = v2 > 0x1FFF;
    v3 = SDL_JoystickNumButtons(joystick);
    if ( v3 > 32 )
      v3 = 32;
    button_count = v3;
    for ( button = 0; button < button_count; ++button )
      pStatus->bButton[button] = (unsigned __int8)SDL_JoystickGetButton(joystick, button) != 0;
  }
  return 1;
}




//----- (0809A294) --------------------------------------------------------
signed int ResetJoystickStatus()
{
  return 1;
}

//----- (0809A2A0) --------------------------------------------------------
void ClearArmsData()
{
  gArmsEnergyX = 32;
  memset(gArmsData, 0, 0xA0u);
}

//----- (0809A2CE) --------------------------------------------------------
void ClearItemData()
{
  memset(gItemData, 0, 0x80u);
}

//----- (0809A2F2) --------------------------------------------------------
signed int __cdecl AddArmsData(int code, int max_num)
{
  int i;

  for ( i = 0; i <= 7 && gArmsData[i].code != code && gArmsData[i].code; ++i )
    ;
  if ( i == 8 )
    return 0;
  if ( !gArmsData[i].code )
  {
    memset((void *)(20 * i + 136105600), 0, 0x14u);
    gArmsData[i].level = 1;
  }
  gArmsData[i].code = code;
  gArmsData[i].max_num += max_num;
  gArmsData[i].num += max_num;
  if ( gArmsData[i].num > gArmsData[i].max_num )
    gArmsData[i].num = gArmsData[i].max_num;
  return 1;
}

//----- (0809A474) --------------------------------------------------------
signed int __cdecl SubArmsData(int code)
{
  unsigned int v2;
  int i;
  int ia;

  for ( i = 0; i <= 7 && gArmsData[i].code != code; ++i )
    ;
  if ( i == 32 )
    return 0;
  for ( ia = i + 1; ia <= 7; ++ia )
  {
    v2 = 20 * (ia - 1);
    gArmsData[v2 / 0x14].code = gArmsData[ia].code;
    *(_DWORD *)(v2 + 136105604) = gArmsData[ia].level;
    *(_DWORD *)(v2 + 136105608) = gArmsData[ia].exp;
    *(_DWORD *)(v2 + 136105612) = gArmsData[ia].max_num;
    *(_DWORD *)(v2 + 136105616) = gArmsData[ia].num;
  }
  gArmsData[ia - 1].code = 0;
  gSelectedArms = 0;
  return 1;
}

//----- (0809A556) --------------------------------------------------------
signed int __cdecl TradeArms(int code1, int code2, int max_num)
{
  int i;

  for ( i = 0; i <= 7 && gArmsData[i].code != code1; ++i )
    ;
  if ( i == 8 )
    return 0;
  gArmsData[i].level = 1;
  gArmsData[i].code = code2;
  gArmsData[i].max_num += max_num;
  gArmsData[i].num += max_num;
  gArmsData[i].exp = 0;
  return 1;
}

//----- (0809A644) --------------------------------------------------------
signed int __cdecl AddItemData(int code)
{
  int i;

  for ( i = 0; i <= 31 && gItemData[i].code != code && gItemData[i].code; ++i )
    ;
  if ( i == 32 )
    return 0;
  gItemData[i].code = code;
  return 1;
}

//----- (0809A6A6) --------------------------------------------------------
signed int __cdecl SubItemData(int code)
{
  int i;
  int ia;

  for ( i = 0; i <= 31 && gItemData[i].code != code; ++i )
    ;
  if ( i == 32 )
    return 0;
  for ( ia = i + 1; ia <= 31; ++ia )
    gItemData[ia - 1] = gItemData[ia];
  gItemData[ia - 1].code = 0;
  gSelectedItem = 0;
  return 1;
}

//----- (0809A731) --------------------------------------------------------
void MoveCampCursor()
{
  bool bChange;
  int arms_num;
  int item_num;

  arms_num = 0;
  item_num = 0;
  while ( gArmsData[arms_num].code != 0 )
    ++arms_num;
  while ( gItemData[item_num].code != 0 )
    ++item_num;
  if ( arms_num || item_num )
  {
    bChange = 0;
    if ( gCampActive )
    {
      if ( gKeyTrg & gKeyLeft )
      {
        if ( gSelectedItem % 6 )
          --gSelectedItem;
        else
          gSelectedItem += 5;
        bChange = 1;
      }
      if ( gKeyTrg & gKeyRight )
      {
        if ( item_num - 1 == gSelectedItem )
        {
          gSelectedItem = 6 * (gSelectedItem / 6);
        }
        else if ( gSelectedItem % 6 == 5 )
        {
          gSelectedItem -= 5;
        }
        else
        {
          ++gSelectedItem;
        }
        bChange = 1;
      }
      if ( gKeyTrg & gKeyUp )
      {
        if ( (unsigned int)(gSelectedItem + 5) > 0xA )
          gSelectedItem -= 6;
        else
          gCampActive = 0;
        bChange = 1;
      }
      if ( gKeyTrg & gKeyDown )
      {
        if ( gSelectedItem / 6 == (item_num - 1) / 6 )
          gCampActive = 0;
        else
          gSelectedItem += 6;
        bChange = 1;
      }
      if ( gSelectedItem >= item_num )
        gSelectedItem = item_num - 1;
      if ( gCampActive && gKeyTrg & gKeyOk )
        StartTextScript(gItemData[gSelectedItem].code + 6000);
    }
    else
    {
      if ( gKeyTrg & gKeyLeft )
      {
        --gSelectedArms;
        bChange = 1;
      }
      if ( gKeyTrg & gKeyRight )
      {
        ++gSelectedArms;
        bChange = 1;
      }
      if ( (gKeyDown | gKeyUp) & gKeyTrg )
      {
        if ( item_num )
          gCampActive = 1;
        bChange = 1;
      }
      if ( gSelectedArms < 0 )
        gSelectedArms = arms_num - 1;
      if ( arms_num - 1 < gSelectedArms )
        gSelectedArms = 0;
    }
    if ( bChange )
    {
      if ( gCampActive )
      {
        PlaySoundObject(1, 1);
        if ( item_num )
          StartTextScript(gItemData[gSelectedItem].code + 5000);
        else
          StartTextScript(5000);
      }
      else
      {
        PlaySoundObject(4, 1);
        if ( arms_num )
          StartTextScript(gArmsData[gSelectedArms].code + 1000);
        else
          StartTextScript(1000);
      }
    }
  }
}

//----- (0809AABF) --------------------------------------------------------
void PutCampObject()
{
  RECT rcCur2[2];
  RECT rcCur1[2];
  RECT rcBoxBottom;
  RECT rcBoxBody;
  RECT rcBoxTop;
  RECT rcTitle2;
  RECT rcTitle1;
  RECT rcView;
  RECT rcLv;
  RECT rcNone;
  RECT rcPer;
  RECT rcItem;
  RECT rcArms;
  int i;

  rcPer.left = 72;
  rcPer.top = 48;
  rcPer.right = 80;
  rcPer.bottom = 56;
  rcNone.left = 80;
  rcNone.top = 48;
  rcNone.right = 96;
  rcNone.bottom = 56;
  rcLv.left = 80;
  rcLv.top = 80;
  rcLv.right = 96;
  rcLv.bottom = 88;
  rcView.left = 0;
  rcView.top = 0;
  rcView.right = 320;
  rcView.bottom = 240;
  rcCur1[0].left = 0;
  rcCur1[0].top = 88;
  rcCur1[0].right = 40;
  rcCur1[0].bottom = 128;
  rcCur1[1].left = 40;
  rcCur1[1].top = 88;
  rcCur1[1].right = 80;
  rcCur1[1].bottom = 128;
  rcCur2[0].left = 80;
  rcCur2[0].top = 88;
  rcCur2[0].right = 112;
  rcCur2[0].bottom = 104;
  rcCur2[1].left = 80;
  rcCur2[1].top = 104;
  rcCur2[1].right = 112;
  rcCur2[1].bottom = 120;
  rcTitle1.left = 80;
  rcTitle1.top = 48;
  rcTitle1.right = 144;
  rcTitle1.bottom = 56;
  rcTitle2.left = 80;
  rcTitle2.top = 56;
  rcTitle2.right = 144;
  rcTitle2.bottom = 64;
  rcBoxTop.left = 0;
  rcBoxTop.top = 0;
  rcBoxTop.right = 244;
  rcBoxTop.bottom = 8;
  rcBoxBody.left = 0;
  rcBoxBody.top = 8;
  rcBoxBody.right = 244;
  rcBoxBody.bottom = 16;
  rcBoxBottom.left = 0;
  rcBoxBottom.top = 16;
  rcBoxBottom.right = 244;
  rcBoxBottom.bottom = 24;
  PutBitmap3(&rcView, 38, 8, &rcBoxTop, 26);
  for ( i = 1; i <= 17; ++i )
    PutBitmap3(&rcView, 38, 8 * (i + 1), &rcBoxBody, 26);
  PutBitmap3(&rcView, 38, 8 * (i + 1), &rcBoxBottom, 26);
  if ( gCampTitleY > 16 )
    --gCampTitleY;
  PutBitmap3(&rcView, 48, gCampTitleY, &rcTitle1, 26);
  PutBitmap3(&rcView, 48, gCampTitleY + 52, &rcTitle2, 26);
  ++PutCampObject(void)::flash;
  if ( gCampActive )
    PutBitmap3(&rcView, 40 * gSelectedArms + 48, 24, &rcCur1[1], 26);
  else
    PutBitmap3(&rcView, 40 * gSelectedArms + 48, 24, &rcCur1[(PutCampObject(void)::flash >> 1) & 1], 26);
  for ( i = 0; i <= 7 && gArmsData[i].code; ++i )
  {
    rcArms.left = 16 * (gArmsData[i].code % 16);
    rcArms.right = rcArms.left + 16;
    rcArms.top = 16 * (gArmsData[i].code / 16);
    rcArms.bottom = rcArms.top + 16;
    PutBitmap3(&rcView, 40 * i + 48, 24, &rcArms, 12);
    PutBitmap3(&rcView, 40 * i + 48, 56, &rcPer, 26);
    PutBitmap3(&rcView, 40 * i + 48, 40, &rcLv, 26);
    PutNumber4(40 * i + 48, 40, gArmsData[i].level, 0);
    if ( gArmsData[i].max_num )
    {
      PutNumber4(40 * i + 48, 48, gArmsData[i].num, 0);
      PutNumber4(40 * i + 48, 56, gArmsData[i].max_num, 0);
    }
    else
    {
      PutBitmap3(&rcView, 40 * i + 64, 48, &rcNone, 26);
      PutBitmap3(&rcView, 40 * i + 64, 56, &rcNone, 26);
    }
  }
  if ( gCampActive == 1 )
    PutBitmap3(
      &rcView,
      32 * (gSelectedItem % 6) + 48,
      16 * (gSelectedItem / 6) + 76,
      &rcCur2[(PutCampObject(void)::flash >> 1) & 1],
      26);
  else
    PutBitmap3(&rcView, 32 * (gSelectedItem % 6) + 48, 16 * (gSelectedItem / 6) + 76, &rcCur2[1], 26);
  for ( i = 0; i <= 31 && gItemData[i].code; ++i )
  {
    rcItem.left = 32 * (gItemData[i].code % 8);
    rcItem.right = rcItem.left + 32;
    rcItem.top = 16 * (gItemData[i].code / 8);
    rcItem.bottom = rcItem.top + 16;
    PutBitmap3(&rcView, 32 * (i % 6) + 48, 16 * (i / 6) + 76, &rcItem, 8);
  }
}

//----- (0809B2D8) --------------------------------------------------------
signed int CampLoop()
{
  signed int v0;
  signed int v2;
  char old_script_path[260];
  RECT rcView;
  int arms_num;

  rcView.left = 0;
  rcView.top = 0;
  rcView.right = 320;
  rcView.bottom = 240;
  GetTextScriptPath(old_script_path);
  LoadTextScript2("ArmsItem.tsc");
  gCampTitleY = 24;
  gCampActive = 0;
  gSelectedItem = 0;
  for ( arms_num = 0; gArmsData[arms_num].code != 0; ++arms_num )
    ;
  if ( arms_num )
    StartTextScript(gArmsData[gSelectedArms].code + 1000);
  else
    StartTextScript(gItemData[gSelectedItem].code + 5000);
  while ( 1 )
  {
    GetTrg();
    if ( gKeyTrg & 0x8000 )
    {
      v0 = Call_Escape(gscreen);
      if ( !v0 )
        return 0;
      if ( v0 == 2 )
        return 2;
    }
    if ( g_GameFlags & 2 )
      MoveCampCursor();
    v2 = TextScriptProc();
    if ( !v2 )
      return 0;
    if ( v2 == 2 )
      return 2;
    PutBitmap4(&rcView, 0, 0, &rcView, 10);
    PutCampObject();
    PutTextScript();
    PutFramePerSecound();
    if ( !gCampActive )
      break;
    if ( g_GameFlags & 2 && (gKeyItem | gKeyCancel) & gKeyTrg )
    {
      StopTextScript();
      goto LABEL_28;
    }
LABEL_26:
    if ( !Flip_SystemTask(gscreen) )
      return 0;
  }
  if ( !((gKeyItem | gKeyCancel | gKeyOk) & gKeyTrg) )
    goto LABEL_26;
  StopTextScript();
LABEL_28:
  LoadTextScript_Stage(old_script_path);
  gArmsEnergyX = 32;
  return 1;
}

//----- (0809B4EE) --------------------------------------------------------
signed int __cdecl CheckItem(int a)
{
  int i;

  for ( i = 0; i <= 31; ++i )
  {
    if ( gItemData[i].code == a )
      return 1;
  }
  return 0;
}

//----- (0809B529) --------------------------------------------------------
signed int __cdecl CheckArms(int a)
{
  int i;

  for ( i = 0; i <= 7; ++i )
  {
    if ( gArmsData[i].code == a )
      return 1;
  }
  return 0;
}

//----- (0809B56D) --------------------------------------------------------
signed int __cdecl UseArmsEnergy(int num)
{
  if ( !gArmsData[gSelectedArms].max_num )
    return 1;
  if ( !gArmsData[gSelectedArms].num )
    return 0;
  gArmsData[gSelectedArms].num -= num;
  if ( gArmsData[gSelectedArms].num < 0 )
    gArmsData[gSelectedArms].num = 0;
  return 1;
}

//----- (0809B621) --------------------------------------------------------
signed int __cdecl ChargeArmsEnergy(int num)
{
  gArmsData[gSelectedArms].num += num;
  if ( gArmsData[gSelectedArms].num > gArmsData[gSelectedArms].max_num )
    gArmsData[gSelectedArms].num = gArmsData[gSelectedArms].max_num;
  return 1;
}

//----- (0809B6B8) --------------------------------------------------------
void FullArmsEnergy()
{
  int a;

  for ( a = 0; a <= 7; ++a )
  {
    if ( gArmsData[a].code )
      gArmsData[a].num = gArmsData[a].max_num;
  }
}

//----- (0809B718) --------------------------------------------------------
int RotationArms()
{
  int arms_num;

  for ( arms_num = 0; gArmsData[arms_num].code != 0; ++arms_num )
    ;
  if ( !arms_num )
    return 0;
  ResetSpurCharge();
  ++gSelectedArms;
  while ( gSelectedArms < arms_num && !gArmsData[gSelectedArms].code )
    ++gSelectedArms;
  if ( gSelectedArms == arms_num )
    gSelectedArms = 0;
  gArmsEnergyX = 32;
  PlaySoundObject(4, 1);
  return gArmsData[gSelectedArms].code;
}

//----- (0809B7EE) --------------------------------------------------------
int RotationArmsRev()
{
  int arms_num;

  for ( arms_num = 0; gArmsData[arms_num].code != 0; ++arms_num )
    ;
  if ( !arms_num )
    return 0;
  ResetSpurCharge();
  if ( --gSelectedArms < 0 )
    gSelectedArms = arms_num - 1;
  while ( gSelectedArms < arms_num && !gArmsData[gSelectedArms].code )
    --gSelectedArms;
  gArmsEnergyX = 0;
  PlaySoundObject(4, 1);
  return gArmsData[gSelectedArms].code;
}

//----- (0809B8C4) --------------------------------------------------------
void ChangeToFirstArms()
{
  gSelectedArms = 0;
  gArmsEnergyX = 32;
  PlaySoundObject(4, 1);
}

//----- (0809B8F4) --------------------------------------------------------
void ActBossChar_Ironhead()
{
  int v0;
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  int v8;
  int v9;
  int v10;
  int v11;
  int v12;
  int v13;
  int v14;
  int v15;
  int v16;
  int v17;
  int v18;
  int v19;
  int v20;
  int v21;
  NPCHAR_0 *v22;
  Sint32 *v23;
  NPCHAR_0 *v24;
  Sint32 *v25;
  RECT rcDamage[9];
  RECT rc[9];
  int i;
  NPCHAR_0 *npc;
  char v30[24];

  npc = gBoss;
  v0 = gBoss[0].act_no;
  if ( v0 == 101 )
  {
LABEL_16:
    if ( ++npc->act_wait > 50 )
    {
      npc->act_no = 250;
      npc->act_wait = 0;
    }
    if ( !(npc->act_wait & 3) )
    {
      v1 = Random(2, 13) << 13;
      v2 = Random(15, 18);
      SetNpChar(197, v2 << 13, v1, 0, 0, 0, 0, 256);
    }
    goto LABEL_60;
  }
  if ( v0 <= 101 )
  {
    if ( v0 == 1 )
      goto LABEL_60;
    if ( v0 != 100 )
    {
      if ( !v0 )
      {
        npc->cond = -128;
        npc->exp = 1;
        npc->direct = 2;
        npc->act_no = 100;
        npc->x = 81920;
        npc->y = 0x10000;
        npc->view.front = 20480;
        npc->view.top = 6144;
        npc->view.back = 12288;
        npc->view.bottom = 6144;
        npc->hit_voice = 54;
        npc->hit.front = 0x2000;
        npc->hit.top = 5120;
        npc->hit.back = 0x2000;
        npc->hit.bottom = 5120;
        npc->bits = -32216;
        npc->size = 3;
        npc->damage = 10;
        npc->code_event = 1000;
        npc->life = 400;
      }
      goto LABEL_60;
    }
    npc->act_no = 101;
    npc->bits &= 0xFFDFu;
    npc->act_wait = 0;
    goto LABEL_16;
  }
  if ( v0 == 251 )
    goto LABEL_24;
  if ( v0 <= 251 )
  {
    if ( v0 != 250 )
      goto LABEL_60;
    npc->act_no = 251;
    if ( npc->direct == 2 )
    {
      npc->x = 122880;
      npc->y = y;
    }
    else
    {
      npc->x = 368640;
      npc->y = Random(2, 13) << 13;
    }
    npc->tgt_x = npc->x;
    npc->tgt_y = npc->y;
    npc->ym = Random(-512, 512);
    npc->xm = Random(-512, 512);
    npc->bits |= 0x20u;
LABEL_24:
    if ( npc->direct == 2 )
    {
      npc->tgt_x += 1024;
    }
    else
    {
      npc->tgt_x -= 512;
      if ( npc->tgt_y >= y )
        v3 = npc->tgt_y - 512;
      else
        v3 = npc->tgt_y + 512;
      npc->tgt_y = v3;
    }
    if ( npc->x >= npc->tgt_x )
      v4 = npc->xm - 8;
    else
      v4 = npc->xm + 8;
    npc->xm = v4;
    if ( npc->y >= npc->tgt_y )
      v5 = npc->ym - 8;
    else
      v5 = npc->ym + 8;
    npc->ym = v5;
    if ( npc->ym > 512 )
      npc->ym = 512;
    if ( npc->ym < -512 )
      npc->ym = -512;
    npc->x += npc->xm;
    npc->y += npc->ym;
    if ( npc->direct == 2 )
    {
      if ( npc->x > 368640 )
      {
        npc->direct = 0;
        npc->act_no = 100;
      }
    }
    else if ( npc->x <= 139263 )
    {
      npc->direct = 2;
      npc->act_no = 100;
    }
    if ( !npc->direct && (++npc->act_wait == 300 || npc->act_wait == 310 || npc->act_wait == 320) )
    {
      PlaySoundObject(39, 1);
      v6 = Random(-3, 3) << 9;
      v7 = Random(-3, 0);
      SetNpChar(198, npc->x + 5120, npc->y + 512, v7 << 9, v6, 2, 0, 256);
    }
    if ( ++npc->ani_wait > 2 )
    {
      npc->ani_wait = 0;
      ++npc->ani_no;
    }
    if ( npc->ani_no > 7 )
      npc->ani_no = 0;
    goto LABEL_60;
  }
  if ( v0 == 1000 )
  {
    npc->bits &= 0xFFDFu;
    npc->ani_no = 8;
    npc->damage = 0;
    npc->act_no = 1001;
    npc->tgt_x = npc->x;
    npc->tgt_y = npc->y;
    SetQuake(20);
    for ( i = 0; i <= 31; ++i )
    {
      v8 = Random(-128, 128) << 9;
      v9 = Random(-128, 128) << 9;
      v10 = npc->y;
      v11 = (Random(-64, 64) << 9) + v10;
      v12 = npc->x;
      v13 = Random(-128, 128);
      SetNpChar(4, v12 + (v13 << 9), v11, v9, v8, 0, 0, 256);
    }
    DeleteNpCharCode(197, 1);
    DeleteNpCharCode(271, 1);
    DeleteNpCharCode(272, 1);
  }
  else if ( v0 != 1001 )
  {
    goto LABEL_60;
  }
  npc->tgt_x -= 512;
  v14 = npc->tgt_x;
  npc->x = v14 + (Random(-1, 1) << 9);
  v15 = npc->tgt_y;
  npc->y = v15 + (Random(-1, 1) << 9);
  if ( !(++npc->act_wait & 3) )
  {
    v16 = Random(-128, 128) << 9;
    v17 = Random(-128, 128) << 9;
    v18 = npc->y;
    v19 = (Random(-64, 64) << 9) + v18;
    v20 = npc->x;
    v21 = Random(-128, 128);
    SetNpChar(4, v20 + (v21 << 9), v19, v17, v16, 0, 0, 256);
  }
LABEL_60:
  qmemcpy(rc, &ActBossChar_Ironhead(void)::C.0, sizeof(rc));
  qmemcpy(rcDamage, &ActBossChar_Ironhead(void)::C.1, sizeof(rcDamage));
  if ( npc->shock )
  {
    if ( (++ActBossChar_Ironhead(void)::_flash >> 1) & 1 )
    {
      v22 = npc;
      v23 = (Sint32 *)&v30[16 * npc->ani_no - 152];
    }
    else
    {
      v22 = npc;
      v23 = (Sint32 *)&v30[16 * npc->ani_no - 296];
    }
    npc->rect.left = *v23;
    v22->rect.top = v23[1];
    v22->rect.right = v23[2];
    v22->rect.bottom = v23[3];
  }
  else
  {
    v24 = npc;
    v25 = (Sint32 *)&v30[16 * npc->ani_no - 152];
    npc->rect.left = *v25;
    v24->rect.top = v25[1];
    v24->rect.right = v25[2];
    v24->rect.bottom = v25[3];
  }
}


//----- (0809C210) --------------------------------------------------------
void __cdecl _Vanish($96A7816609F59F56E43A9A5E8F547E1B *bul)
{
  if ( bul->code_bullet != 37 && bul->code_bullet != 38 && bul->code_bullet != 39 )
    PlaySoundObject(28, 1);
  else
    SetCaret(bul->x, bul->y, 2, 1);
  bul->cond = 0;
  SetCaret(bul->x, bul->y, 2, 2);
}

//----- (0809C2A9) --------------------------------------------------------
int __cdecl JudgeHitBulletBlock(int x, int y, $96A7816609F59F56E43A9A5E8F547E1B *bul)
{
  bool v3;
  int v4;
  int v5;
  int i;
  int hit;

  hit = 0;
  if ( bul->x - bul->blockXL < (2 * x + 1) << 12
    && bul->blockXL + bul->x > (2 * x - 1) << 12
    && bul->y - bul->blockYL < (2 * y + 1) << 12
    && bul->blockYL + bul->y > (2 * y - 1) << 12 )
  {
    hit = 512;
  }
  v3 = hit && bul->bbits & 0x60 && (unsigned __int8)GetAttribute(x, y) == 67;
  if ( v3 )
  {
    if ( !(bul->bbits & 0x40) )
      bul->cond = 0;
    SetCaret(bul->x, bul->y, 2, 0);
    PlaySoundObject(12, 1);
    for ( i = 0; i <= 3; ++i )
    {
      v4 = Random(-512, 512);
      v5 = Random(-512, 512);
      SetNpChar(4, x << 13, y << 13, v5, v4, 0, 0, 256);
    }
    ShiftMapParts(x, y);
  }
  return hit;
}

//----- (0809C461) --------------------------------------------------------
int __cdecl JudgeHitBulletBlock2(int x, int y, unsigned __int8 *atrb, $96A7816609F59F56E43A9A5E8F547E1B *bul)
{
  int block[4];
  int workX;
  int workY;
  int hit;
  int i;

  hit = 0;
  if ( bul->bbits & 0x40 )
  {
    for ( i = 0; i <= 3; ++i )
    {
      block[i] = *atrb == 65 || *atrb == 97;
      ++atrb;
    }
  }
  else
  {
    for ( i = 0; i <= 3; ++i )
    {
      block[i] = *atrb == 65 || *atrb == 67 || *atrb == 97;
      ++atrb;
    }
  }
  workX = (2 * x + 1) << 12;
  workY = (2 * y + 1) << 12;
  if ( block[0] && block[2] )
  {
    if ( bul->x - bul->blockXL < workX )
      hit |= 1u;
  }
  else if ( !block[0] || block[2] )
  {
    if ( !block[0] && block[2] && bul->x - bul->blockXL < workX && bul->blockYL + bul->y > workY + 1536 )
      hit |= 1u;
  }
  else if ( bul->x - bul->blockXL < workX && bul->y - bul->blockYL < workY - 1536 )
  {
    hit |= 1u;
  }
  if ( block[1] && block[3] )
  {
    if ( bul->x + bul->blockXL > workX )
      hit |= 4u;
  }
  else if ( !block[1] || block[3] )
  {
    if ( !block[1] && block[3] && bul->x + bul->blockXL > workX && bul->blockYL + bul->y > workY + 1536 )
      hit |= 4u;
  }
  else if ( bul->x + bul->blockXL > workX && bul->y - bul->blockYL < workY - 1536 )
  {
    hit |= 4u;
  }
  if ( block[0] && block[1] )
  {
    if ( bul->y - bul->blockYL < workY )
      hit |= 2u;
  }
  else if ( !block[0] || block[1] )
  {
    if ( !block[0] && block[1] && bul->y - bul->blockYL < workY && bul->blockXL + bul->x > workX + 1536 )
      hit |= 2u;
  }
  else if ( bul->y - bul->blockYL < workY && bul->x - bul->blockXL < workX - 1536 )
  {
    hit |= 2u;
  }
  if ( block[2] && block[3] )
  {
    if ( bul->y + bul->blockYL > workY )
      hit |= 8u;
  }
  else if ( !block[2] || block[3] )
  {
    if ( !block[2] && block[3] && bul->y + bul->blockYL > workY && bul->blockXL + bul->x > workX + 1536 )
      hit |= 8u;
  }
  else if ( bul->y + bul->blockYL > workY && bul->x - bul->blockXL < workX - 1536 )
  {
    hit |= 8u;
  }
  if ( bul->bbits & 8 )
  {
    if ( hit & 1 )
    {
      bul->x = workX + bul->blockXL;
    }
    else if ( hit & 4 )
    {
      bul->x = workX - bul->blockXL;
    }
    else if ( hit & 2 )
    {
      bul->y = workY + bul->blockYL;
    }
    else if ( hit & 8 )
    {
      bul->y = workY - bul->blockYL;
    }
  }
  else if ( hit & 0xF )
  {
    _Vanish(bul);
  }
  return hit;
}

//----- (0809C8CB) --------------------------------------------------------
int __cdecl JudgeHitBulletTriangleA(int x, int y, $96A7816609F59F56E43A9A5E8F547E1B *bul)
{
  int hit;

  hit = 0;
  if ( bul->x < (2 * x + 1) << 12
    && bul->x > (2 * x - 1) << 12
    && bul->y - 1024 < (y << 13) - (-8192 * x + bul->x) / 2 + 2048
    && bul->y + 1024 > (2 * y - 1) << 12 )
  {
    if ( bul->bbits & 8 )
      bul->y = (y << 13) - (-8192 * x + bul->x) / 2 + 3072;
    else
      _Vanish(bul);
    hit = 130;
  }
  return hit;
}

//----- (0809C9C1) --------------------------------------------------------
int __cdecl JudgeHitBulletTriangleB(int x, int y, $96A7816609F59F56E43A9A5E8F547E1B *bul)
{
  int hit;

  hit = 0;
  if ( bul->x < (2 * x + 1) << 12
    && bul->x > (2 * x - 1) << 12
    && bul->y - 1024 < (y << 13) - (-8192 * x + bul->x) / 2 - 2048
    && bul->y + 1024 > (2 * y - 1) << 12 )
  {
    if ( bul->bbits & 8 )
      bul->y = (y << 13) - (-8192 * x + bul->x) / 2 - 1024;
    else
      _Vanish(bul);
    hit = 130;
  }
  return hit;
}

//----- (0809CAB7) --------------------------------------------------------
int __cdecl JudgeHitBulletTriangleC(int x, int y, $96A7816609F59F56E43A9A5E8F547E1B *bul)
{
  int hit;

  hit = 0;
  if ( bul->x < (2 * x + 1) << 12
    && bul->x > (2 * x - 1) << 12
    && bul->y - 1024 < (y << 13) + (-8192 * x + bul->x) / 2 - 2048
    && bul->y + 1024 > (2 * y - 1) << 12 )
  {
    if ( bul->bbits & 8 )
      bul->y = (y << 13) + (-8192 * x + bul->x) / 2 - 1024;
    else
      _Vanish(bul);
    hit = 66;
  }
  return hit;
}

//----- (0809CBA4) --------------------------------------------------------
int __cdecl JudgeHitBulletTriangleD(int x, int y, $96A7816609F59F56E43A9A5E8F547E1B *bul)
{
  int hit;

  hit = 0;
  if ( bul->x < (2 * x + 1) << 12
    && bul->x > (2 * x - 1) << 12
    && bul->y - 1024 < (y << 13) + (-8192 * x + bul->x) / 2 + 2048
    && bul->y + 1024 > (2 * y - 1) << 12 )
  {
    if ( bul->bbits & 8 )
      bul->y = (y << 13) + (-8192 * x + bul->x) / 2 + 3072;
    else
      _Vanish(bul);
    hit = 66;
  }
  return hit;
}

//----- (0809CC91) --------------------------------------------------------
int __cdecl JudgeHitBulletTriangleE(int x, int y, $96A7816609F59F56E43A9A5E8F547E1B *bul)
{
  int hit;

  hit = 0;
  if ( bul->x < (2 * x + 1) << 12
    && bul->x - 512 > (2 * x - 1) << 12
    && bul->y + 1024 > (y << 13) + (-8192 * x + bul->x) / 2 - 2048
    && bul->y - 1024 < (2 * y + 1) << 12 )
  {
    if ( bul->bbits & 8 )
      bul->y = (y << 13) + (-8192 * x + bul->x) / 2 - 3072;
    else
      _Vanish(bul);
    hit = 40;
  }
  return hit;
}

//----- (0809CD84) --------------------------------------------------------
int __cdecl JudgeHitBulletTriangleF(int x, int y, $96A7816609F59F56E43A9A5E8F547E1B *bul)
{
  int hit;

  hit = 0;
  if ( bul->x < (2 * x + 1) << 12
    && bul->x > (2 * x - 1) << 12
    && bul->y + 1024 > (y << 13) + (-8192 * x + bul->x) / 2 + 2048
    && bul->y - 1024 < (2 * y + 1) << 12 )
  {
    if ( bul->bbits & 8 )
      bul->y = (y << 13) + (-8192 * x + bul->x) / 2 + 1024;
    else
      _Vanish(bul);
    hit = 40;
  }
  return hit;
}

//----- (0809CE71) --------------------------------------------------------
int __cdecl JudgeHitBulletTriangleG(int x, int y, $96A7816609F59F56E43A9A5E8F547E1B *bul)
{
  int hit;

  hit = 0;
  if ( bul->x < (2 * x + 1) << 12
    && bul->x > (2 * x - 1) << 12
    && bul->y + 1024 > (y << 13) - (-8192 * x + bul->x) / 2 + 2048
    && bul->y - 1024 < (2 * y + 1) << 12 )
  {
    if ( bul->bbits & 8 )
      bul->y = (y << 13) - (-8192 * x + bul->x) / 2 + 1024;
    else
      _Vanish(bul);
    hit = 24;
  }
  return hit;
}

//----- (0809CF64) --------------------------------------------------------
int __cdecl JudgeHitBulletTriangleH(int x, int y, $96A7816609F59F56E43A9A5E8F547E1B *bul)
{
  int hit;

  hit = 0;
  if ( bul->x < (2 * x + 1) << 12
    && bul->x > (2 * x - 1) << 12
    && bul->y + 1024 > (y << 13) - (-8192 * x + bul->x) / 2 - 2048
    && bul->y - 1024 < (2 * y + 1) << 12 )
  {
    if ( bul->bbits & 8 )
      bul->y = (y << 13) - (-8192 * x + bul->x) / 2 - 3072;
    else
      _Vanish(bul);
    hit = 24;
  }
  return hit;
}

//----- (0809D057) --------------------------------------------------------
void HitBulletMap()
{
  __int64 v0;
  __int64 v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  int v8;
  int v9;
  int v10;
  int v11;
  int v12;
  int v13;
  int v14;
  int v15;
  int v16;
  int v17;
  int v18;
  int v19;
  int v20;
  int v21;
  int offy[4];
  int offx[4];
  unsigned __int8 atrb[4];
  int x;
  int y;
  int i;
  int j;

  for ( i = 0; i <= 63; ++i )
  {
    if ( gBul[i].cond & 0x80 )
    {
      v0 = *(&gBul[0].flag + 4 * (8 * i + 1));
      x = (signed int)((HIDWORD(v0) >> 19) + v0) >> 13;
      v1 = *(&gBul[0].code_bullet + 4 * (8 * i + 1));
      y = (signed int)((HIDWORD(v1) >> 19) + v1) >> 13;
      offx[0] = 0;
      offx[1] = 1;
      offx[2] = 0;
      offx[3] = 1;
      offy[0] = 0;
      offy[1] = 0;
      offy[2] = 1;
      offy[3] = 1;
      atrb[0] = GetAttribute(x, y);
      atrb[1] = GetAttribute(x + 1, y);
      atrb[2] = GetAttribute(x, y + 1);
      atrb[3] = GetAttribute(x + 1, y + 1);
      gBul[i].flag = 0;
      if ( !(gBul[i].bbits & 4) )
      {
        for ( j = 0; j <= 3; ++j )
        {
          if ( gBul[i].cond & 0x80 )
          {
            switch ( atrb[j] )
            {
              case 0x41u:
              case 0x43u:
              case 0x44u:
              case 0x61u:
              case 0x64u:
                v2 = i;
                v3 = gBul[i].flag;
                gBul[v2].flag = JudgeHitBulletBlock(x + offx[j], y + offy[j], &gBul[i]) | v3;
                break;
              case 0x50u:
              case 0x70u:
                v4 = i;
                v5 = gBul[i].flag;
                gBul[v4].flag = JudgeHitBulletTriangleA(x + offx[j], y + offy[j], &gBul[i]) | v5;
                break;
              case 0x51u:
              case 0x71u:
                v6 = i;
                v7 = gBul[i].flag;
                gBul[v6].flag = JudgeHitBulletTriangleB(x + offx[j], y + offy[j], &gBul[i]) | v7;
                break;
              case 0x52u:
              case 0x72u:
                v8 = i;
                v9 = gBul[i].flag;
                gBul[v8].flag = JudgeHitBulletTriangleC(x + offx[j], y + offy[j], &gBul[i]) | v9;
                break;
              case 0x53u:
              case 0x73u:
                v10 = i;
                v11 = gBul[i].flag;
                gBul[v10].flag = JudgeHitBulletTriangleD(x + offx[j], y + offy[j], &gBul[i]) | v11;
                break;
              case 0x54u:
              case 0x74u:
                v12 = i;
                v13 = gBul[i].flag;
                gBul[v12].flag = JudgeHitBulletTriangleE(x + offx[j], y + offy[j], &gBul[i]) | v13;
                break;
              case 0x55u:
              case 0x75u:
                v14 = i;
                v15 = gBul[i].flag;
                gBul[v14].flag = JudgeHitBulletTriangleF(x + offx[j], y + offy[j], &gBul[i]) | v15;
                break;
              case 0x56u:
              case 0x76u:
                v16 = i;
                v17 = gBul[i].flag;
                gBul[v16].flag = JudgeHitBulletTriangleG(x + offx[j], y + offy[j], &gBul[i]) | v17;
                break;
              case 0x57u:
              case 0x77u:
                v18 = i;
                v19 = gBul[i].flag;
                gBul[v18].flag = JudgeHitBulletTriangleH(x + offx[j], y + offy[j], &gBul[i]) | v19;
                break;
              default:
                continue;
            }
          }
        }
        v20 = i;
        v21 = gBul[i].flag;
        gBul[v20].flag = JudgeHitBulletBlock2(x, y, atrb, ($96A7816609F59F56E43A9A5E8F547E1B *)((i << 7) + 136090016)) | v21;
      }
    }
  }
}

//----- (0809D53C) --------------------------------------------------------
signed int get_language()
{
  return 1;
}

//----- (0809D548) --------------------------------------------------------
void __cdecl ActNpc260(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[3];
  RECT rcLeft[3];
  char v6[8];

  rcLeft[0].left = 128;
  rcLeft[0].top = 64;
  rcLeft[0].right = 144;
  rcLeft[0].bottom = 80;
  rcLeft[1].left = 144;
  rcLeft[1].top = 64;
  rcLeft[1].right = 160;
  rcLeft[1].bottom = 80;
  rcLeft[2].left = 224;
  rcLeft[2].top = 64;
  rcLeft[2].right = 240;
  rcLeft[2].bottom = 80;
  rcRight[0].left = 128;
  rcRight[0].top = 80;
  rcRight[0].right = 144;
  rcRight[0].bottom = 96;
  rcRight[1].left = 144;
  rcRight[1].top = 80;
  rcRight[1].right = 160;
  rcRight[1].bottom = 96;
  rcRight[2].left = 224;
  rcRight[2].top = 80;
  rcRight[2].right = 240;
  rcRight[2].bottom = 96;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_9:
    if ( Random(0, 160) == 1 )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
      npc->ani_no = 1;
    }
    goto LABEL_14;
  }
  if ( v1 <= 1 )
  {
    if ( v1 )
      goto LABEL_14;
    npc->x += 512;
    npc->y -= 1024;
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->ani_wait = 0;
    goto LABEL_9;
  }
  if ( v1 == 2 )
  {
    if ( ++npc->act_wait > 12 )
    {
      npc->act_no = 1;
      npc->ani_no = 0;
    }
  }
  else if ( v1 == 10 )
  {
    npc->act_no = 11;
    npc->ani_no = 2;
    SetNpChar(87, npc->x, npc->y - 0x2000, 0, 0, 0, 0, 256);
  }
LABEL_14:
  if ( x >= npc->x )
    npc->direct = 2;
  else
    npc->direct = 0;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 96];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 48];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (0809D7D4) --------------------------------------------------------
void __cdecl ActNpc261(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[2];
  RECT rcLeft[2];
  char v6[8];

  rcLeft[0].left = 112;
  rcLeft[0].top = 32;
  rcLeft[0].right = 128;
  rcLeft[0].bottom = 48;
  rcLeft[1].left = 128;
  rcLeft[1].top = 32;
  rcLeft[1].right = 144;
  rcLeft[1].bottom = 48;
  rcRight[0].left = 112;
  rcRight[0].top = 48;
  rcRight[0].right = 128;
  rcRight[0].bottom = 64;
  rcRight[1].left = 128;
  rcRight[1].top = 48;
  rcRight[1].right = 144;
  rcRight[1].bottom = 64;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    if ( Random(0, 160) == 1 )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
      npc->ani_no = 1;
    }
    goto LABEL_9;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_9;
    npc->x -= 512;
    npc->y -= 1024;
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->ani_wait = 0;
    goto LABEL_5;
  }
  if ( ++npc->act_wait > 12 )
  {
    npc->act_no = 1;
    npc->ani_no = 0;
  }
LABEL_9:
  if ( x >= npc->x )
    npc->direct = 2;
  else
    npc->direct = 0;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 64];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 32];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (0809D9A3) --------------------------------------------------------
void __cdecl ActNpc262(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[2];
  RECT rcLeft[2];
  char v6[8];

  rcLeft[0].left = 128;
  rcLeft[0].top = 0;
  rcLeft[0].right = 144;
  rcLeft[0].bottom = 16;
  rcLeft[1].left = 144;
  rcLeft[1].top = 0;
  rcLeft[1].right = 160;
  rcLeft[1].bottom = 16;
  rcRight[0].left = 128;
  rcRight[0].top = 16;
  rcRight[0].right = 144;
  rcRight[0].bottom = 32;
  rcRight[1].left = 144;
  rcRight[1].top = 16;
  rcRight[1].right = 160;
  rcRight[1].bottom = 32;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    if ( Random(0, 160) == 1 )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
      npc->ani_no = 1;
    }
    goto LABEL_9;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_9;
    npc->x -= 512;
    npc->y -= 1024;
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->ani_wait = 0;
    goto LABEL_5;
  }
  if ( ++npc->act_wait > 12 )
  {
    npc->act_no = 1;
    npc->ani_no = 0;
  }
LABEL_9:
  if ( x >= npc->x )
    npc->direct = 2;
  else
    npc->direct = 0;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 64];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 32];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (0809DB72) --------------------------------------------------------
void __cdecl ActNpc263(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  NPCHAR_0 *v4;
  Sint32 *v5;
  RECT rcRight[9];
  RECT rcLeft[9];
  int deg;
  int xm;
  int ym;
  char v11[24];

  qmemcpy(rcLeft, &ActNpc263(NPCHAR *)::C.3, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc263(NPCHAR *)::C.4, sizeof(rcRight));
  v1 = npc->act_no;
  if ( v1 == 31 )
  {
LABEL_51:
    if ( ++npc->act_wait / 2 & 1 )
      v2 = npc->tgt_x;
    else
      v2 = npc->tgt_x + 512;
    npc->x = v2;
    if ( npc->act_wait > 50 )
    {
      npc->act_no = 32;
      npc->act_wait = 0;
      npc->ani_no = 7;
      PlaySoundObject(101, 1);
      for ( deg = 8; deg <= 255; deg += 16 )
      {
        xm = 2 * GetCos(deg);
        ym = 2 * GetSin(deg);
        SetNpChar(266, npc->x, npc->y, xm, ym, 0, 0, 256);
      }
    }
    goto LABEL_83;
  }
  if ( v1 > 31 )
  {
    if ( v1 == 102 )
    {
      if ( ++npc->act_wait > 40 )
      {
        npc->act_no = 103;
        npc->act_wait = 16;
        npc->ani_no = 2;
        npc->ym = 0;
        npc->x = npc->tgt_x;
        npc->y = npc->tgt_y;
        if ( npc->x <= x )
          npc->direct = 2;
        else
          npc->direct = 0;
      }
    }
    else if ( v1 > 102 )
    {
      switch ( v1 )
      {
        case 500:
          npc->bits &= 0xFFDFu;
          npc->ani_no = 6;
          npc->ym += 16;
          if ( npc->flag & 8 )
          {
            npc->act_no = 501;
            npc->act_wait = 0;
            npc->tgt_x = npc->x;
            if ( npc->x <= x )
              npc->direct = 2;
            else
              npc->direct = 0;
          }
          break;
        case 501:
          if ( npc->x <= x )
            npc->direct = 2;
          else
            npc->direct = 0;
          npc->ani_no = 8;
          if ( ++npc->act_wait / 2 & 1 )
            v3 = npc->tgt_x;
          else
            v3 = npc->tgt_x + 512;
          npc->x = v3;
          break;
        case 103:
          npc->act_wait -= 2;
          if ( npc->act_wait <= 0 )
          {
            npc->bits |= 0x20u;
            npc->damage = 3;
            if ( npc->count1 > 2 )
            {
              npc->count1 = 0;
              npc->act_no = 30;
            }
            else
            {
              ++npc->count1;
              npc->act_no = 10;
            }
          }
          break;
      }
    }
    else
    {
      if ( v1 == 100 )
      {
        npc->act_no = 101;
        npc->bits &= 0xFFDFu;
        npc->damage = 0;
        npc->act_wait = 0;
        PlaySoundObject(29, 1);
      }
      else if ( v1 <= 100 )
      {
        if ( v1 == 32 && ++npc->act_wait > 50 )
          npc->act_no = 100;
        goto LABEL_83;
      }
      npc->act_wait += 2;
      if ( npc->act_wait > 16 )
      {
        npc->act_no = 102;
        npc->act_wait = 0;
        npc->ani_no = 3;
        npc->tgt_x = Random(5, 35) << 13;
        npc->tgt_y = Random(5, 7) << 13;
      }
    }
  }
  else if ( v1 == 2 )
  {
    if ( ++npc->act_wait / 2 & 1 )
      npc->ani_no = 0;
    else
      npc->ani_no = 3;
    if ( npc->act_wait > 50 )
      npc->act_no = 10;
  }
  else
  {
    if ( v1 <= 2 )
    {
      if ( !v1 )
      {
        npc->act_no = 1;
        npc->y += 4096;
        npc->ani_no = 3;
      }
      goto LABEL_83;
    }
    if ( v1 != 20 )
    {
      if ( v1 != 30 )
      {
        if ( v1 == 10 )
        {
          npc->ym += 128;
          npc->bits |= 0x20u;
          npc->damage = 3;
          if ( npc->flag & 8 )
          {
            npc->act_no = 20;
            npc->act_wait = 0;
            npc->ani_no = 0;
            npc->count2 = npc->life;
            if ( npc->x <= x )
              npc->direct = 2;
            else
              npc->direct = 0;
          }
        }
        goto LABEL_83;
      }
      npc->act_no = 31;
      npc->act_wait = 0;
      npc->ani_no = 6;
      npc->tgt_x = npc->x;
      npc->bits |= 0x20u;
      goto LABEL_51;
    }
    if ( ++npc->act_wait <= 49 && npc->life < npc->count2 - 20 )
      npc->act_wait = 50;
    if ( npc->act_wait == 50 )
    {
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
      npc->ani_no = 4;
    }
    if ( npc->act_wait == 80 )
    {
      npc->ani_no = 5;
      PlaySoundObject(25, 1);
      if ( npc->direct )
      {
        SetNpChar(264, npc->x + 0x2000, npc->y, 0, 0, 2, 0, 256);
        SetNpChar(264, npc->x + 0x2000, npc->y, 0, 0, 1026, 0, 256);
      }
      else
      {
        SetNpChar(264, npc->x - 0x2000, npc->y, 0, 0, 0, 0, 256);
        SetNpChar(264, npc->x - 0x2000, npc->y, 0, 0, 1024, 0, 256);
      }
    }
    if ( npc->act_wait == 120 )
      npc->ani_no = 0;
    if ( npc->act_wait > 130 && npc->life < npc->count2 - 50 )
      npc->act_wait = 161;
    if ( npc->act_wait > 160 )
    {
      npc->act_no = 100;
      npc->ani_no = 0;
    }
  }
LABEL_83:
  if ( npc->act_no > 9 )
  {
    if ( npc->act_no == 102 )
    {
      gSuperXpos = npc->tgt_x;
      gSuperYpos = npc->tgt_y;
    }
    else
    {
      gSuperXpos = npc->x;
      gSuperYpos = npc->y;
    }
  }
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v4 = npc;
    v5 = (Sint32 *)&v11[16 * npc->ani_no - 300];
  }
  else
  {
    v4 = npc;
    v5 = (Sint32 *)&v11[16 * npc->ani_no - 156];
  }
  npc->rect.left = *v5;
  v4->rect.top = v5[1];
  v4->rect.right = v5[2];
  v4->rect.bottom = v5[3];
  if ( npc->act_no != 101 && npc->act_no != 103 )
  {
    npc->view.top = 0x2000;
  }
  else
  {
    npc->rect.top += npc->act_wait;
    npc->rect.bottom -= npc->act_wait;
    npc->view.top = (16 - npc->act_wait) << 9;
  }
}


//----- (0809E58B) --------------------------------------------------------
void __cdecl ActNpc264(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  unsigned __int8 deg;

  if ( npc->x < 0 || npc->x > gMap.width << 13 )
  {
    VanishNpChar(npc);
    return;
  }
  v1 = npc->act_no;
  if ( !v1 )
  {
    npc->act_no = 1;
    npc->tgt_x = npc->x;
    npc->tgt_y = npc->y;
    npc->count1 = npc->direct / 8;
    npc->direct %= 8;
    goto LABEL_8;
  }
  if ( v1 == 1 )
  {
LABEL_8:
    npc->count1 += 6;
    npc->count1 = (unsigned __int8)(((unsigned __int64)npc->count1 >> 56) + npc->count1)
                - ((unsigned int)(npc->count1 >> 31) >> 24);
    deg = npc->count1;
    if ( npc->act_wait <= 127 )
      ++npc->act_wait;
    if ( npc->direct )
      v2 = npc->xm + 21;
    else
      v2 = npc->xm - 21;
    npc->xm = v2;
    npc->tgt_x += npc->xm;
    v3 = npc->tgt_x;
    npc->x = v3 + npc->act_wait * GetCos(deg) / 8;
    v4 = npc->tgt_y;
    npc->y = v4 + npc->act_wait * GetSin(deg) / 2;
    SetNpChar(265, npc->x, npc->y, 0, 0, 0, 0, 256);
  }
  npc->rect.left = 288;
  npc->rect.top = 0;
  npc->rect.right = 304;
  npc->rect.bottom = 16;
}

//----- (0809E7A6) --------------------------------------------------------
void __cdecl ActNpc265(NPCHAR_0 *npc)
{
  RECT *v1;
  RECT rc[3];

  rc[0].left = 288;
  rc[0].top = 16;
  rc[0].right = 304;
  rc[0].bottom = 32;
  rc[1].left = 288;
  rc[1].top = 32;
  rc[1].right = 304;
  rc[1].bottom = 48;
  rc[2].left = 288;
  rc[2].top = 48;
  rc[2].right = 304;
  rc[2].bottom = 64;
  if ( ++npc->ani_wait > 3 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no <= 2 )
  {
    v1 = &rc[npc->ani_no];
    npc->rect.left = v1->left;
    npc->rect.top = v1->top;
    npc->rect.right = v1->right;
    npc->rect.bottom = v1->bottom;
  }
  else
  {
    npc->cond = 0;
  }
}

//----- (0809E872) --------------------------------------------------------
void __cdecl ActNpc266(NPCHAR_0 *npc)
{
  Sint32 *v1;
  RECT rc[2];
  char v3[8];

  rc[0].left = 304;
  rc[0].top = 16;
  rc[0].right = 320;
  rc[0].bottom = 32;
  rc[1].left = 304;
  rc[1].top = 32;
  rc[1].right = 320;
  rc[1].bottom = 48;
  if ( npc->flag & 1 )
    npc->xm = -npc->xm;
  if ( npc->flag & 4 )
    npc->xm = -npc->xm;
  if ( npc->flag & 2 )
    npc->ym = 512;
  if ( npc->flag & 8 )
    npc->ym = -512;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( ++npc->ani_no > 1 )
    npc->ani_no = 0;
  v1 = (Sint32 *)&v3[16 * npc->ani_no - 32];
  npc->rect.left = *v1;
  npc->rect.top = v1[1];
  npc->rect.right = v1[2];
  npc->rect.bottom = v1[3];
  if ( ++npc->act_wait % 4 == 1 )
    SetNpChar(265, npc->x, npc->y, 0, 0, 0, 0, 256);
  if ( npc->act_wait > 250 )
    VanishNpChar(npc);
}


//----- (0809EA1B) --------------------------------------------------------
void __cdecl ActNpc267(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  unsigned __int16 v8;
  unsigned __int16 v9;
  unsigned __int16 v10;
  int v11;
  int v12;
  bool v13;
  int v14;
  int v15;
  int v16;
  int v17;
  int v18;
  int v19;
  int v20;
  int v21;
  int v22;
  int v23;
  int v24;
  int v25;
  int v26;
  int v27;
  int v28;
  int v29;
  int v30;
  int v31;
  int v32;
  int v33;
  int v34;
  int v35;
  int v36;
  NPCHAR_0 *v37;
  Sint32 *v38;
  RECT rcRight[10];
  RECT rcLeft[10];
  int xm;
  int ym;
  int i;
  char v44[24];

  qmemcpy(rcLeft, &ActNpc267(NPCHAR *)::C.9, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc267(NPCHAR *)::C.10, sizeof(rcRight));
  v1 = npc->act_no;
  if ( v1 == 21 )
  {
LABEL_118:
    ++npc->act_wait;
    npc->ani_no = 6;
    if ( npc->act_wait > 20 && npc->act_wait % 3 == 1 )
    {
      ym = Random(-512, 512);
      xm = 4 * Random(256, 512);
      if ( npc->direct )
        SetNpChar(269, npc->x + 4096, npc->y - 2048, xm, ym, 2, 0, 256);
      else
        SetNpChar(269, npc->x - 4096, npc->y - 2048, -xm, ym, 0, 0, 256);
      PlaySoundObject(39, 1);
    }
    if ( npc->act_wait > 90 )
      npc->act_no = 10;
    goto LABEL_188;
  }
  if ( v1 <= 21 )
  {
    if ( v1 == 8 )
    {
LABEL_63:
      npc->ym += 64;
      if ( ++npc->act_wait > 40 )
        npc->act_no = 10;
      goto LABEL_188;
    }
    if ( v1 <= 8 )
    {
      if ( v1 == 2 )
      {
LABEL_54:
        npc->ym += 128;
        if ( ++npc->act_wait / 2 & 1 )
          npc->ani_no = 0;
        else
          npc->ani_no = 3;
        goto LABEL_188;
      }
      if ( v1 <= 2 )
      {
        if ( v1 )
        {
          if ( v1 != 1 )
            goto LABEL_188;
        }
        else
        {
          if ( x >= gSuperXpos )
            npc->direct = 2;
          else
            npc->direct = 0;
          if ( npc->direct )
            npc->x = gSuperXpos + 3072;
          else
            npc->x = gSuperXpos - 3072;
          npc->y = gSuperYpos;
        }
        npc->act_no = 2;
        goto LABEL_54;
      }
      if ( v1 == 6 )
        goto LABEL_58;
      if ( v1 <= 6 )
      {
        if ( v1 != 5 )
          goto LABEL_188;
        npc->act_no = 6;
        npc->ani_no = 1;
        npc->ani_wait = 0;
LABEL_58:
        npc->ym += 128;
        if ( ++npc->ani_wait > 40 )
        {
          npc->ani_wait = 0;
          ++npc->ani_no;
        }
        if ( npc->ani_no > 2 )
          npc->ani_no = 1;
        goto LABEL_188;
      }
      npc->act_no = 8;
      npc->act_wait = 0;
      npc->ani_no = 3;
      goto LABEL_63;
    }
    if ( v1 == 16 )
    {
      npc->ym += 64;
      if ( ++npc->ani_wait > 1 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 5 )
        npc->ani_no = 4;
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
      if ( npc->ym > 0 && npc->flag & 8 )
        npc->act_no = 17;
      goto LABEL_188;
    }
    if ( v1 <= 16 )
    {
      if ( v1 == 11 )
      {
LABEL_66:
        npc->ym += 128;
        if ( npc->x <= x )
          npc->direct = 2;
        else
          npc->direct = 0;
        if ( npc->flag & 8 )
        {
          if ( npc->life >= npc->count2 - 20 )
          {
            if ( ++npc->ani_wait > 10 )
            {
              npc->ani_wait = 0;
              if ( ++npc->ani_no > 2 )
                npc->ani_no = 1;
            }
          }
          else if ( dword_81C8584 & 8 && x > npc->x - 24576 && x < npc->x + 24576 && npc->ani_no != 6 )
          {
            npc->ani_no = 6;
            DamageMyChar(5);
            SetQuake(10);
            PlaySoundObject(26, 1);
            unk_81C85B8 = -1024;
            if ( npc->x <= x )
              unk_81C85B4 = 1535;
            else
              unk_81C85B4 = -1535;
            for ( i = 0; i <= 99; ++i )
            {
              v2 = 3 * Random(-512, 512);
              v3 = 3 * Random(-512, 512);
              v4 = npc->y;
              v5 = (Random(-16, 16) << 9) + v4;
              v6 = npc->x;
              v7 = Random(-16, 16);
              SetNpChar(270, v6 + (v7 << 9), v5, v3, v2, 3, 0, 170);
            }
          }
        }
        else
        {
          npc->ani_no = 4;
        }
        if ( ++npc->act_wait > 30 || npc->life < npc->count2 - 20 )
        {
          if ( ++npc->count1 > 10 )
            npc->count1 = 0;
          switch ( npc->count1 )
          {
            case 1:
            case 9:
              npc->act_no = 40;
              break;
            case 2:
            case 7:
              npc->act_no = 100;
              break;
            case 3:
            case 6:
              npc->act_no = 30;
              break;
            case 8:
              npc->act_no = 20;
              break;
            default:
              npc->act_no = 15;
              npc->act_wait = 0;
              break;
          }
        }
        goto LABEL_188;
      }
      if ( v1 != 15 )
      {
        if ( v1 != 10 )
          goto LABEL_188;
        npc->bits |= 4u;
        npc->xm = 0;
        npc->act_no = 11;
        npc->act_wait = 0;
        npc->ani_no = 1;
        npc->ani_wait = 0;
        npc->count2 = npc->life;
        goto LABEL_66;
      }
      npc->ani_no = 3;
      ++npc->act_wait;
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
      if ( npc->act_wait > 20 )
      {
        npc->act_no = 16;
        npc->ani_no = 4;
        npc->ani_wait = 0;
        npc->ym = -1536;
        if ( npc->direct )
          npc->xm = 1024;
        else
          npc->xm = -1024;
      }
      goto LABEL_188;
    }
    if ( v1 != 18 )
    {
      if ( v1 >= 18 )
      {
        if ( v1 != 20 )
          goto LABEL_188;
        npc->act_no = 21;
        npc->act_wait = 0;
        goto LABEL_118;
      }
      npc->act_no = 18;
      npc->act_wait = 0;
      SetQuake(10);
      PlaySoundObject(26, 1);
    }
    npc->ani_no = 3;
    ++npc->act_wait;
    npc->xm = 7 * npc->xm / 8;
    npc->ym += 128;
    if ( npc->act_wait > 10 )
      npc->act_no = 10;
    goto LABEL_188;
  }
  if ( v1 == 102 )
  {
    if ( ++npc->act_wait > 40 )
    {
      npc->act_no = 103;
      npc->act_wait = 28;
      npc->ani_no = 4;
      npc->ym = 0;
      npc->x = npc->tgt_x;
      npc->y = npc->tgt_y;
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
    }
  }
  else if ( v1 > 102 )
  {
    if ( v1 == 510 )
    {
      npc->act_no = 511;
      npc->act_wait = 0;
      npc->ani_no = 9;
      npc->tgt_x = npc->x;
      npc->y += 0x2000;
      npc->bits |= 8u;
    }
    else
    {
      if ( v1 <= 510 )
      {
        switch ( v1 )
        {
          case 500:
            DeleteNpCharCode(269, 1);
            npc->bits &= 0xFFDFu;
            npc->ani_no = 4;
            npc->ym += 32;
            npc->xm = 0;
            if ( npc->flag & 8 )
            {
              npc->act_no = 501;
              npc->act_wait = 0;
              npc->tgt_x = npc->x;
              if ( npc->x <= x )
                npc->direct = 2;
              else
                npc->direct = 0;
            }
            break;
          case 501:
            npc->ani_no = 9;
            if ( ++npc->act_wait / 2 & 1 )
              v11 = npc->tgt_x;
            else
              v11 = npc->tgt_x + 512;
            npc->x = v11;
            break;
          case 103:
            npc->act_wait -= 2;
            if ( npc->act_wait <= 0 )
            {
              npc->bits |= 0x24u;
              npc->damage = 5;
              npc->act_no = 16;
              npc->ym = -512;
              npc->xm = 0;
            }
            break;
        }
        goto LABEL_188;
      }
      if ( v1 == 512 )
        goto LABEL_188;
      if ( v1 >= 512 )
      {
        if ( v1 == 520 )
        {
          npc->damage = 0;
          gSuperYpos = -16384;
        }
        goto LABEL_188;
      }
    }
    SetQuake(2);
    if ( ++npc->act_wait % 6 == 3 )
      PlaySoundObject(25, 1);
    if ( npc->act_wait / 2 & 1 )
      v12 = npc->tgt_x;
    else
      v12 = npc->tgt_x + 512;
    npc->x = v12;
    if ( npc->act_wait > 352 )
    {
      npc->ani_no = 0;
      npc->act_no = 512;
    }
  }
  else if ( v1 == 40 )
  {
    npc->ani_no = 3;
    ++npc->act_wait;
    if ( npc->x <= x )
      npc->direct = 2;
    else
      npc->direct = 0;
    if ( npc->act_wait > 20 )
    {
      npc->act_no = 41;
      npc->ani_no = 4;
      npc->ani_wait = 0;
      npc->ym = -2048;
      if ( npc->direct )
        npc->xm = 1024;
      else
        npc->xm = -1024;
    }
  }
  else
  {
    if ( v1 <= 40 )
    {
      if ( v1 != 31 )
      {
        if ( v1 == 32 )
        {
          ++npc->act_wait;
          npc->ym = 0;
          if ( npc->act_wait / 2 & 1 )
            npc->ani_no = 7;
          else
            npc->ani_no = 8;
          if ( npc->act_wait > 30 )
          {
            npc->act_wait = 0;
            npc->act_no = 18;
            npc->damage = 5;
            v9 = npc->bits;
            LOBYTE(v9) = v9 & 0x7E;
            npc->bits = v9;
            npc->bits |= 0x20u;
          }
          if ( npc->flag & 1 || npc->flag & 4 )
          {
            npc->act_no = 15;
            npc->act_wait = 0;
            npc->damage = 5;
            v10 = npc->bits;
            LOBYTE(v10) = v10 & 0x7E;
            npc->bits = v10;
            npc->bits |= 0x20u;
          }
          goto LABEL_188;
        }
        if ( v1 != 30 )
          goto LABEL_188;
        npc->act_no = 31;
        npc->act_wait = 0;
        npc->bits |= 1u;
        npc->bits &= 0xFFDFu;
      }
      npc->ani_no = 3;
      if ( ++npc->act_wait > 20 )
      {
        npc->act_no = 32;
        npc->act_wait = 0;
        npc->ani_no = 7;
        v8 = npc->bits;
        LOBYTE(v8) = v8 | 0x80;
        npc->bits = v8;
        npc->damage = 10;
        PlaySoundObject(25, 1);
        if ( npc->direct )
          npc->xm = 1535;
        else
          npc->xm = -1535;
      }
      goto LABEL_188;
    }
    if ( v1 == 100 )
    {
      npc->act_no = 101;
      npc->act_wait = 0;
      npc->bits &= 0xFFDBu;
      npc->damage = 0;
      PlaySoundObject(29, 1);
    }
    else if ( v1 <= 100 )
    {
      if ( v1 == 41 )
      {
        npc->ym += 64;
        if ( ++npc->ani_wait > 1 )
        {
          npc->ani_wait = 0;
          ++npc->ani_no;
        }
        if ( npc->ani_no > 5 )
          npc->ani_no = 4;
        if ( y > npc->y && x > npc->x - 4096 && x < npc->x + 4096 )
        {
          npc->act_no = 16;
          npc->ym = 1535;
          npc->xm = 0;
        }
        if ( npc->ym > 0 && npc->flag & 8 )
          npc->act_no = 17;
      }
      goto LABEL_188;
    }
    npc->act_wait += 2;
    if ( npc->act_wait > 28 )
    {
      npc->act_no = 102;
      npc->act_wait = 0;
      npc->ani_no = 0;
      npc->tgt_x = x;
      npc->tgt_y = y - 0x4000;
      if ( npc->tgt_y <= 0x7FFF )
        npc->tgt_y = 0x8000;
      if ( npc->tgt_x <= 0x7FFF )
        npc->tgt_x = 0x8000;
      if ( npc->tgt_x > 294912 )
        npc->tgt_x = 294912;
    }
  }
LABEL_188:
  if ( npc->act_no > 10 && npc->act_no <= 500 )
  {
    if ( npc->act_no == 102 )
    {
      gSuperXpos = npc->tgt_x;
      gSuperYpos = npc->tgt_y;
    }
    else
    {
      gSuperXpos = npc->x;
      gSuperYpos = npc->y;
    }
  }
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->act_no <= 511 )
  {
    if ( npc->act_no > 509 )
    {
      v19 = 2 * Random(-512, 0);
      v20 = Random(-512, 512);
      v21 = npc->y - ((336 - npc->act_wait) / 8 << 9);
      v22 = npc->x;
      v23 = Random(-16, 16);
      SetNpChar(270, v22 + (v23 << 9), v21, v20, v19, 3, 0, 170);
      v24 = 2 * Random(-512, 0);
      v25 = Random(-512, 512);
      v26 = npc->y - ((336 - npc->act_wait) / 8 << 9);
      v27 = npc->x;
      v28 = Random(-16, 16);
      SetNpChar(270, v27 + (v28 << 9), v26, v25, v24, 3, 0, 170);
      v29 = 2 * Random(-512, 0);
      v30 = npc->y - ((336 - npc->act_wait) / 8 << 9);
      v31 = npc->x;
      v32 = Random(-16, 16);
      SetNpChar(270, v31 + (v32 << 9), v30, 0, v29, 3, 0, 170);
      v33 = 2 * Random(-512, 0);
      v34 = npc->y - ((336 - npc->act_wait) / 8 << 9);
      v35 = npc->x;
      v36 = Random(-16, 16);
      SetNpChar(270, v35 + (v36 << 9), v34, 0, v33, 3, 0, 170);
    }
    else
    {
      v13 = npc->act_no != 102 && npc->act_no != 103 && Random(0, 3) == 2;
      if ( v13 )
      {
        v14 = npc->xm;
        v15 = npc->y;
        v16 = (Random(-8, 4) << 9) + v15;
        v17 = npc->x;
        v18 = Random(-16, 16);
        SetNpChar(270, v17 + (v18 << 9), v16, v14, 0, 3, 0, 256);
      }
    }
  }
  if ( npc->direct )
  {
    v37 = npc;
    v38 = (Sint32 *)&v44[16 * npc->ani_no - 332];
  }
  else
  {
    v37 = npc;
    v38 = (Sint32 *)&v44[16 * npc->ani_no - 172];
  }
  npc->rect.left = *v38;
  v37->rect.top = v38[1];
  v37->rect.right = v38[2];
  v37->rect.bottom = v38[3];
  if ( npc->act_no == 511 )
  {
    npc->rect.top += npc->act_wait / 8;
    npc->view.top = (44 - npc->act_wait / 8) << 9;
    npc->view.bottom = 2048;
  }
  else if ( npc->act_no != 101 && npc->act_no != 103 )
  {
    npc->view.top = 14336;
  }
  else
  {
    npc->rect.top += npc->act_wait;
    npc->rect.bottom -= npc->act_wait;
    npc->view.top = (28 - npc->act_wait) << 9;
  }
}


//----- (080A0112) --------------------------------------------------------
void __cdecl ActNpc268(NPCHAR_0 *npc)
{
  char v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[10];
  RECT rcLeft[10];
  unsigned __int8 deg;
  int xm;
  int ym;
  char v9[24];

  qmemcpy(rcLeft, &ActNpc268(NPCHAR *)::C.22, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc268(NPCHAR *)::C.23, sizeof(rcRight));
  if ( npc->x < x - 163840 || npc->x > x + 163840 || npc->y < y - 122880 || npc->y > y + 122880 )
    npc->act_no = 1;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->y += 4096;
      goto LABEL_8;
    case 1:
LABEL_8:
      if ( ++npc->ani_wait > 20 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 1 )
        npc->ani_no = 0;
      if ( npc->x < x + 57344 && npc->x > x - 57344 && npc->x < x + 24576 && npc->x > x - 57344 )
        npc->act_no = 10;
      if ( npc->shock )
        npc->act_no = 10;
      break;
    case 0xA:
      npc->act_no = 11;
      npc->act_wait = 0;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      if ( x >= npc->x )
        npc->direct = 2;
      else
        npc->direct = 0;
      goto LABEL_22;
    case 0xB:
LABEL_22:
      if ( npc->direct )
        npc->xm = 512;
      else
        npc->xm = -512;
      if ( npc->x < x + 0x8000 && npc->x > x - 0x8000 )
      {
        npc->act_no = 20;
        npc->act_wait = 0;
      }
      if ( npc->xm < 0 && npc->flag & 1 )
      {
        npc->act_no = 20;
        npc->act_wait = 0;
      }
      if ( npc->xm > 0 && npc->flag & 4 )
      {
        npc->act_no = 20;
        npc->act_wait = 0;
      }
      if ( ++npc->ani_wait > 4 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 5 )
        npc->ani_no = 2;
      break;
    case 0x14:
      npc->xm = 0;
      npc->ani_no = 6;
      if ( ++npc->act_wait > 10 )
      {
        npc->act_no = 30;
        npc->ym = -1535;
        if ( npc->direct )
          npc->xm = 512;
        else
          npc->xm = -512;
        PlaySoundObject(108, 1);
      }
      break;
    case 0x1E:
      npc->ani_no = 7;
      if ( npc->flag & 8 )
      {
        npc->act_no = 40;
        npc->act_wait = 0;
        SetQuake(20);
        PlaySoundObject(26, 1);
      }
      break;
    case 0x28:
      npc->xm = 0;
      npc->ani_no = 6;
      if ( ++npc->act_wait > 30 )
        npc->act_no = 50;
      break;
    case 0x32:
      npc->act_no = 51;
      npc->act_wait = 0;
      if ( x >= npc->x )
        npc->direct = 2;
      else
        npc->direct = 0;
      goto LABEL_50;
    case 0x33:
LABEL_50:
      if ( ++npc->act_wait > 30 && npc->act_wait % 4 == 1 )
      {
        if ( npc->direct )
          deg = -8;
        else
          deg = -120;
        v1 = Random(-16, 16);
        deg += v1;
        ym = 5 * GetSin(deg);
        xm = 5 * GetCos(deg);
        SetNpChar(11, npc->x, npc->y + 2048, xm, ym, 0, 0, 256);
        PlaySoundObject(12, 1);
      }
      if ( npc->act_wait <= 49 && npc->act_wait / 2 & 1 )
        npc->ani_no = 9;
      else
        npc->ani_no = 8;
      if ( npc->act_wait > 82 )
      {
        npc->act_no = 10;
        if ( x >= npc->x )
          npc->direct = 2;
        else
          npc->direct = 0;
      }
      break;
    default:
      break;
  }
  npc->ym += 51;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v9[16 * npc->ani_no - 332];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v9[16 * npc->ani_no - 172];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (080A078E) --------------------------------------------------------
void __cdecl ActNpc269(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  RECT *v3;
  RECT rcRight[3];
  RECT rcLeft[3];

  rcLeft[0].left = 232;
  rcLeft[0].top = 0;
  rcLeft[0].right = 248;
  rcLeft[0].bottom = 16;
  rcLeft[1].left = 248;
  rcLeft[1].top = 0;
  rcLeft[1].right = 264;
  rcLeft[1].bottom = 16;
  rcLeft[2].left = 248;
  rcLeft[2].top = 16;
  rcLeft[2].right = 264;
  rcLeft[2].bottom = 32;
  rcRight[0].left = 232;
  rcRight[0].top = 32;
  rcRight[0].right = 248;
  rcRight[0].bottom = 48;
  rcRight[1].left = 248;
  rcRight[1].top = 32;
  rcRight[1].right = 264;
  rcRight[1].bottom = 48;
  rcRight[2].left = 248;
  rcRight[2].top = 48;
  rcRight[2].right = 264;
  rcRight[2].bottom = 64;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_21;
  }
  else
  {
    npc->act_no = 1;
    npc->xm2 = npc->xm;
    npc->ym2 = npc->ym;
  }
  if ( npc->xm2 < 0 && npc->flag & 1 )
  {
    npc->direct = 2;
    npc->xm2 = -npc->xm2;
  }
  else if ( npc->xm2 > 0 && npc->flag & 4 )
  {
    npc->direct = 0;
    npc->xm2 = -npc->xm2;
  }
  else if ( npc->ym2 < 0 && npc->flag & 2 )
  {
    npc->ym2 = -npc->ym2;
  }
  else if ( npc->ym2 > 0 && npc->flag & 8 )
  {
    npc->ym2 = -npc->ym2;
  }
  npc->x += npc->xm2;
  npc->y += npc->ym2;
  if ( ++npc->ani_wait > 2 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 2 )
    npc->ani_no = 0;
LABEL_21:
  if ( npc->direct )
  {
    v2 = npc;
    v3 = &rcRight[npc->ani_no];
  }
  else
  {
    v2 = npc;
    v3 = &rcLeft[npc->ani_no];
  }
  npc->rect.left = v3->left;
  v2->rect.top = v3->top;
  v2->rect.right = v3->right;
  v2->rect.bottom = v3->bottom;
}

//----- (080A09FD) --------------------------------------------------------
void __cdecl ActNpc270(NPCHAR_0 *npc)
{
  Sint32 *v1;
  RECT rc[2];
  char v3[8];

  rc[0].left = 170;
  rc[0].top = 34;
  rc[0].right = 174;
  rc[0].bottom = 38;
  rc[1].left = 170;
  rc[1].top = 42;
  rc[1].right = 174;
  rc[1].bottom = 46;
  if ( npc->direct != 3 && npc->direct != 1 )
  {
    if ( npc->direct == 2 )
    {
      if ( !npc->act_no )
      {
        npc->act_no = 1;
        npc->bits |= 8u;
        npc->xm = 3 * Random(-512, 512);
        npc->ym = 3 * Random(-512, 512);
        npc->count1 = Random(16, 51);
        npc->count2 = Random(128, 256);
      }
      if ( npc->x < npc->pNpc->x )
        npc->xm += 512 / npc->count1;
      if ( npc->x > npc->pNpc->x )
        npc->xm -= 512 / npc->count1;
      if ( npc->y < npc->pNpc->y )
        npc->ym += 512 / npc->count1;
      if ( npc->y > npc->pNpc->y )
        npc->ym -= 512 / npc->count1;
      if ( npc->xm > 2 * npc->count2 )
        npc->xm = 2 * npc->count2;
      if ( npc->xm < -2 * npc->count2 )
        npc->xm = -2 * npc->count2;
      if ( npc->ym > 3 * npc->count2 )
        npc->ym = 3 * npc->count2;
      if ( npc->ym < -3 * npc->count2 )
        npc->ym = -3 * npc->count2;
      npc->x += npc->xm;
      npc->y += npc->ym;
    }
  }
  else
  {
    if ( npc->direct == 3 )
      npc->ym += 64;
    if ( npc->direct == 1 )
      npc->ym -= 64;
    ++npc->act_wait;
    if ( npc->ym > 1535 )
      npc->ym = 1535;
    npc->x += npc->xm;
    npc->y += npc->ym;
    if ( npc->act_wait > 50 )
      npc->cond = 0;
    if ( npc->flag & 0xFF )
      npc->cond = 0;
  }
  v1 = (Sint32 *)&v3[16 * Random(0, 1) - 32];
  npc->rect.left = *v1;
  npc->rect.top = v1[1];
  npc->rect.right = v1[2];
  npc->rect.bottom = v1[3];
}


//----- (080A0DB2) --------------------------------------------------------
void __cdecl ActNpc271(NPCHAR_0 *npc)
{
  int v1;
  int a;

  if ( npc->xm >= 0 || npc->x >= -8192 )
  {
    if ( npc->xm <= 0 || npc->x <= (gMap.width + 1) << 13 )
    {
      if ( !npc->act_no )
      {
        npc->act_no = 1;
        a = Random(0, 9);
        if ( a == 9 )
        {
          npc->rect.left = 0;
          npc->rect.right = 32;
          npc->rect.top = 64;
          npc->rect.bottom = 96;
          npc->view.front = 0x2000;
          npc->view.back = 0x2000;
          npc->view.top = 0x2000;
          npc->view.bottom = 0x2000;
          npc->hit.front = 6144;
          npc->hit.back = 6144;
          npc->hit.top = 6144;
          npc->hit.bottom = 6144;
        }
        else
        {
          npc->rect.left = 16 * (a % 3 + 7);
          npc->rect.top = 16 * (a / 3);
          npc->rect.right = npc->rect.left + 16;
          npc->rect.bottom = npc->rect.top + 16;
        }
        if ( npc->direct )
          v1 = 2 * Random(256, 512);
        else
          v1 = -2 * Random(256, 512);
        npc->xm = v1;
        npc->ym = Random(-512, 512);
      }
      if ( npc->ym < 0 && npc->y - npc->hit.top <= 4095 )
      {
        npc->ym = -npc->ym;
        SetCaret(npc->x, npc->y - 4096, 13, 0);
        SetCaret(npc->x, npc->y - 4096, 13, 0);
      }
      if ( npc->ym > 0 && npc->y + npc->hit.bottom > 118784 )
      {
        npc->ym = -npc->ym;
        SetCaret(npc->x, npc->y + 4096, 13, 0);
        SetCaret(npc->x, npc->y + 4096, 13, 0);
      }
      npc->x += npc->xm;
      npc->y += npc->ym;
    }
    else
    {
      VanishNpChar(npc);
    }
  }
  else
  {
    VanishNpChar(npc);
  }
}

//----- (080A10FC) --------------------------------------------------------
void __cdecl ActNpc272(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;

  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      return;
  }
  else
  {
    npc->act_no = 1;
    npc->act_wait = Random(0, 200);
  }
  if ( npc->act_wait )
  {
    --npc->act_wait;
  }
  else
  {
    npc->act_no = 0;
    v2 = npc->direct;
    v3 = npc->y;
    v4 = Random(-32, 32);
    SetNpChar(271, npc->x, v3 + (v4 << 9), 0, 0, v2, 0, 256);
  }
}

//----- (080A11CC) --------------------------------------------------------
void __cdecl ActNpc273(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT rc[3];
  char v4[8];

  rc[0].left = 248;
  rc[0].top = 40;
  rc[0].right = 272;
  rc[0].bottom = 64;
  rc[1].left = 272;
  rc[1].top = 40;
  rc[1].right = 296;
  rc[1].bottom = 64;
  rc[2].left = 296;
  rc[2].top = 40;
  rc[2].right = 320;
  rc[2].bottom = 64;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_11;
  }
  else
  {
    npc->act_no = 1;
  }
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->flag & 0xFF )
  {
    SetNpChar(4, npc->x, npc->y, 0, 0, 0, 0, 256);
    SetNpChar(4, npc->x, npc->y, 0, 0, 0, 0, 256);
    SetNpChar(4, npc->x, npc->y, 0, 0, 0, 0, 256);
    VanishNpChar(npc);
    return;
  }
  if ( !(++npc->act_wait % 5) )
    PlaySoundObject(110, 1);
  if ( ++npc->ani_no > 2 )
    npc->ani_no = 0;
LABEL_11:
  v2 = (Sint32 *)&v4[16 * npc->ani_no - 48];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
}


//----- (080A1403) --------------------------------------------------------
void __cdecl ActNpc274(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  Sint32 *v2;
  RECT rcRight[6];
  RECT rcLeft[6];
  unsigned __int8 deg;
  int xm;
  int ym;
  char v8[24];

  qmemcpy(rcLeft, &ActNpc274(NPCHAR *)::C.25, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc274(NPCHAR *)::C.26, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->y -= 4096;
      npc->tgt_x = npc->x;
      goto LABEL_3;
    case 1:
LABEL_3:
      npc->xm = 0;
      npc->act_no = 2;
      npc->ani_no = 0;
      goto LABEL_4;
    case 2:
LABEL_4:
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
      if ( ++npc->ani_wait > 40 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 1 )
        npc->ani_no = 0;
      if ( npc->shock )
        npc->act_no = 10;
      break;
    case 0xA:
      npc->act_no = 11;
      npc->ani_no = 2;
      npc->act_wait = 0;
      goto LABEL_14;
    case 0xB:
LABEL_14:
      if ( ++npc->act_wait > 10 )
      {
        npc->act_no = 12;
        npc->ani_no = 3;
        npc->ym = -1536;
        npc->count1 = 0;
        if ( npc->tgt_x <= npc->x )
          npc->xm = -512;
        else
          npc->xm = 512;
      }
      break;
    case 0xC:
      if ( npc->ym > 0 )
      {
        npc->ani_no = 4;
        if ( !npc->count1 )
        {
          ++npc->count1;
          deg = GetArktan(npc->x - x, npc->y - 5120 - y);
          ym = 4 * GetSin(deg);
          xm = 4 * GetCos(deg);
          SetNpChar(273, npc->x, npc->y - 5120, xm, ym, 0, 0, 256);
          PlaySoundObject(39, 1);
        }
      }
      if ( npc->ym > 512 )
        npc->ani_no = 5;
      if ( npc->flag & 8 )
      {
        npc->ani_no = 2;
        npc->act_no = 13;
        npc->act_wait = 0;
        npc->xm = 0;
      }
      break;
    case 0xD:
      npc->xm /= 2;
      if ( ++npc->act_wait > 10 )
        npc->act_no = 1;
      break;
    default:
      break;
  }
  npc->ym += 85;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v1 = npc;
    v2 = (Sint32 *)&v8[16 * npc->ani_no - 204];
  }
  else
  {
    v1 = npc;
    v2 = (Sint32 *)&v8[16 * npc->ani_no - 108];
  }
  npc->rect.left = *v2;
  v1->rect.top = v2[1];
  v1->rect.right = v2[2];
  v1->rect.bottom = v2[3];
}


//----- (080A17FC) --------------------------------------------------------
void __cdecl ActNpc275(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT rcRight[4];
  char v4[8];

  rcRight[0].left = 272;
  rcRight[0].top = 80;
  rcRight[0].right = 288;
  rcRight[0].bottom = 96;
  rcRight[1].left = 288;
  rcRight[1].top = 80;
  rcRight[1].right = 304;
  rcRight[1].bottom = 96;
  rcRight[2].left = 272;
  rcRight[2].top = 80;
  rcRight[2].right = 288;
  rcRight[2].bottom = 96;
  rcRight[3].left = 304;
  rcRight[3].top = 80;
  rcRight[3].right = 320;
  rcRight[3].bottom = 96;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    if ( Random(0, 120) == 10 )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
      npc->ani_no = 1;
    }
    if ( npc->x - 0x8000 < x && npc->x + 0x8000 > x && npc->y - 0x4000 < y && npc->y + 0x2000 > y )
    {
      if ( ++npc->ani_wait > 3 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 3 )
        npc->ani_no = 2;
    }
    goto LABEL_17;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_17;
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->ani_wait = 0;
    goto LABEL_5;
  }
  if ( ++npc->act_wait > 8 )
  {
    npc->act_no = 1;
    npc->ani_no = 0;
  }
LABEL_17:
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  v2 = (Sint32 *)&v4[16 * npc->ani_no - 64];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
}


//----- (080A1A4F) --------------------------------------------------------
void __cdecl ActNpc276(NPCHAR_0 *npc)
{
  unsigned int v1;
  signed int v2;
  unsigned int v3;
  signed int v4;
  NPCHAR_0 *v5;
  Sint32 *v6;
  RECT rcRight[9];
  RECT rcLeft[9];
  unsigned __int8 deg;
  int xm;
  int ym;
  char v12[24];

  qmemcpy(rcLeft, &ActNpc276(NPCHAR *)::C.29, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc276(NPCHAR *)::C.30, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->y -= 4096;
      goto LABEL_3;
    case 1:
LABEL_3:
      npc->xm = 0;
      npc->act_no = 2;
      npc->ani_no = 0;
      goto LABEL_4;
    case 2:
LABEL_4:
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
      if ( ++npc->ani_wait > 20 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 1 )
        npc->ani_no = 0;
      if ( npc->shock )
        npc->act_no = 10;
      break;
    case 0xA:
      npc->act_no = 11;
      npc->act_wait = 0;
      npc->ani_no = 3;
      npc->bits |= 0x20u;
      goto LABEL_14;
    case 0xB:
LABEL_14:
      v1 = ++npc->act_wait - 30;
      if ( v1 <= 0x18 )
      {
        v2 = 1 << v1;
        if ( v2 & 0x1004010 )
        {
          npc->ani_no = 3;
        }
        else if ( v2 & 0x100401 )
        {
          npc->ani_no = 4;
          deg = GetArktan(npc->x - x, npc->y - y);
          ym = 4 * GetSin(deg);
          xm = 4 * GetCos(deg);
          SetNpChar(277, npc->x, npc->y, xm, ym, 0, 0, 256);
          PlaySoundObject(39, 1);
        }
      }
      if ( npc->act_wait > 60 )
      {
        npc->act_no = 20;
        npc->act_wait = 0;
        npc->ani_no = 2;
      }
      break;
    case 0x14:
      if ( ++npc->act_wait > 20 )
      {
        npc->act_no = 21;
        npc->act_wait = 0;
        npc->ani_no = 5;
        npc->ym = -1535;
        if ( npc->x >= x )
          npc->xm = -256;
        else
          npc->xm = 256;
      }
      break;
    case 0x15:
      v3 = ++npc->act_wait - 30;
      if ( v3 <= 0x14 )
      {
        v4 = 1 << v3;
        if ( v4 & 0x100401 )
        {
          npc->ani_no = 6;
          deg = GetArktan(npc->x - x, npc->y - 5120 - y);
          ym = 4 * GetSin(deg);
          xm = 4 * GetCos(deg);
          SetNpChar(277, npc->x, npc->y - 5120, xm, ym, 0, 0, 256);
          PlaySoundObject(39, 1);
        }
        else if ( v4 & 0x4010 )
        {
          npc->ani_no = 5;
        }
      }
      if ( npc->act_wait > 53 )
        npc->ani_no = 7;
      if ( npc->flag & 8 )
      {
        npc->act_no = 22;
        npc->act_wait = 0;
        npc->ani_no = 2;
        SetQuake(10);
        PlaySoundObject(26, 1);
      }
      break;
    case 0x16:
      npc->xm /= 2;
      if ( ++npc->act_wait > 22 )
        npc->act_no = 10;
      break;
    case 0x32:
      npc->bits &= 0xFFDFu;
      npc->damage = 0;
      if ( npc->flag & 8 )
      {
        npc->act_no = 51;
        npc->ani_no = 2;
        SetQuake(10);
        SetExpObjects(npc->x, npc->y, 19);
        SetDestroyNpChar(npc->x, npc->y, npc->view.back, 8);
        PlaySoundObject(72, 1);
      }
      break;
    case 0x33:
      npc->xm = 7 * npc->xm / 8;
      npc->ani_no = 8;
      break;
    default:
      break;
  }
  npc->ym += 32;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->act_no <= 49 )
  {
    if ( npc->x >= x )
      npc->direct = 0;
    else
      npc->direct = 2;
  }
  if ( npc->direct )
  {
    v5 = npc;
    v6 = (Sint32 *)&v12[16 * npc->ani_no - 300];
  }
  else
  {
    v5 = npc;
    v6 = (Sint32 *)&v12[16 * npc->ani_no - 156];
  }
  npc->rect.left = *v6;
  v5->rect.top = v6[1];
  v5->rect.right = v6[2];
  v5->rect.bottom = v6[3];
}


//----- (080A20FE) --------------------------------------------------------
void __cdecl ActNpc277(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT rc[3];
  char v4[8];

  rc[0].left = 128;
  rc[0].top = 0;
  rc[0].right = 152;
  rc[0].bottom = 24;
  rc[1].left = 152;
  rc[1].top = 0;
  rc[1].right = 176;
  rc[1].bottom = 24;
  rc[2].left = 176;
  rc[2].top = 0;
  rc[2].right = 200;
  rc[2].bottom = 24;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_11;
  }
  else
  {
    npc->act_no = 1;
  }
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->flag & 0xFF )
  {
    SetNpChar(4, npc->x, npc->y, 0, 0, 0, 0, 256);
    SetNpChar(4, npc->x, npc->y, 0, 0, 0, 0, 256);
    SetNpChar(4, npc->x, npc->y, 0, 0, 0, 0, 256);
    VanishNpChar(npc);
    return;
  }
  if ( !(++npc->act_wait % 5) )
    PlaySoundObject(110, 1);
  if ( ++npc->ani_no > 2 )
    npc->ani_no = 0;
LABEL_11:
  v2 = (Sint32 *)&v4[16 * npc->ani_no - 48];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
}


//----- (080A2335) --------------------------------------------------------
void __cdecl ActNpc278(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  Sint32 *v3;
  RECT rcKodomo[2];
  RECT rcMama[2];
  RECT rcPapa[2];
  char v7[8];

  rcPapa[0].left = 0;
  rcPapa[0].top = 120;
  rcPapa[0].right = 8;
  rcPapa[0].bottom = 128;
  rcPapa[1].left = 8;
  rcPapa[1].top = 120;
  rcPapa[1].right = 16;
  rcPapa[1].bottom = 128;
  rcMama[0].left = 16;
  rcMama[0].top = 120;
  rcMama[0].right = 24;
  rcMama[0].bottom = 128;
  rcMama[1].left = 24;
  rcMama[1].top = 120;
  rcMama[1].right = 32;
  rcMama[1].bottom = 128;
  rcKodomo[0].left = 32;
  rcKodomo[0].top = 120;
  rcKodomo[0].right = 40;
  rcKodomo[0].bottom = 128;
  rcKodomo[1].left = 40;
  rcKodomo[1].top = 120;
  rcKodomo[1].right = 48;
  rcKodomo[1].bottom = 128;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      npc->xm = 0;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( Random(0, 60) == 1 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      if ( Random(0, 60) == 1 )
      {
        npc->act_no = 10;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      break;
    case 2:
      if ( ++npc->act_wait > 8 )
      {
        npc->act_no = 1;
        npc->ani_no = 0;
      }
      break;
    case 0xA:
      npc->act_no = 11;
      npc->act_wait = Random(0, 16);
      npc->ani_no = 0;
      npc->ani_wait = 0;
      if ( Random(0, 9) & 1 )
        npc->direct = 0;
      else
        npc->direct = 2;
      goto LABEL_12;
    case 0xB:
LABEL_12:
      if ( npc->direct || !(npc->flag & 1) )
      {
        if ( npc->direct == 2 && npc->flag & 4 )
          npc->direct = 0;
      }
      else
      {
        npc->direct = 2;
      }
      if ( npc->direct )
        npc->xm = 256;
      else
        npc->xm = -256;
      if ( ++npc->ani_wait > 4 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 1 )
        npc->ani_no = 0;
      if ( ++npc->act_wait > 32 )
        npc->act_no = 0;
      break;
    default:
      break;
  }
  npc->ym += 32;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  v1 = npc->code_event;
  if ( v1 == 200 )
  {
    v2 = (Sint32 *)&v7[16 * npc->ani_no - 32];
    npc->rect.left = *v2;
    npc->rect.top = v2[1];
    npc->rect.right = v2[2];
    npc->rect.bottom = v2[3];
  }
  else
  {
    if ( v1 == 210 )
      v3 = (Sint32 *)&v7[16 * npc->ani_no - 64];
    else
      v3 = (Sint32 *)&v7[16 * npc->ani_no - 96];
    npc->rect.left = *v3;
    npc->rect.top = v3[1];
    npc->rect.right = v3[2];
    npc->rect.bottom = v3[3];
  }
}


//----- (080A2709) --------------------------------------------------------
void __cdecl ActNpc279(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  Sint32 *v8;
  RECT rc[2];
  int i;
  char v11[24];

  rc[0].left = 0;
  rc[0].top = 16;
  rc[0].right = 32;
  rc[0].bottom = 48;
  rc[1].left = 16;
  rc[1].top = 0;
  rc[1].right = 32;
  rc[1].bottom = 16;
  v1 = npc->act_no;
  if ( v1 == 100 )
  {
    npc->ym += 64;
    if ( npc->ym > 1792 )
      npc->ym = 1792;
    if ( npc->y > 0x10000 )
      npc->bits &= 0xFFF7u;
    if ( npc->flag & 8 )
    {
      npc->ym = -512;
      npc->act_no = 110;
      npc->bits |= 8u;
      PlaySoundObject(26, 1);
      SetQuake(10);
      for ( i = 0; i <= 3; ++i )
      {
        v3 = Random(-1536, 0);
        v4 = Random(-341, 341);
        v5 = npc->y + 0x2000;
        v6 = npc->x;
        v7 = Random(-12, 12);
        SetNpChar(4, v6 + (v7 << 9), v5, v4, v3, 0, 0, 256);
      }
    }
    goto LABEL_31;
  }
  if ( v1 > 100 )
  {
    if ( v1 == 110 )
    {
      npc->ym += 64;
      if ( npc->y > (gMap.length + 2) << 13 )
      {
        npc->cond = 0;
        return;
      }
    }
  }
  else
  {
    if ( !v1 )
    {
      v2 = npc->direct;
      switch ( v2 )
      {
        case 1:
          npc->ani_no = 0;
          npc->act_no = 10;
          break;
        case 2:
          npc->act_no = 100;
          npc->bits |= 4u;
          npc->ani_no = 1;
          npc->view.back = 4096;
          npc->view.front = 4096;
          npc->view.top = 4096;
          npc->view.bottom = 4096;
          npc->hit.back = 4096;
          npc->hit.front = 4096;
          npc->hit.top = 4096;
          npc->hit.bottom = 4096;
          break;
        case 0:
          npc->act_no = 100;
          npc->bits |= 4u;
          npc->ani_no = 0;
          break;
      }
      if ( npc->direct != 1 )
        goto LABEL_31;
      goto LABEL_17;
    }
    if ( v1 >= 0 )
    {
      if ( v1 != 10 )
      {
        if ( v1 != 11 )
          goto LABEL_31;
LABEL_18:
        npc->act_wait -= 2;
        if ( npc->act_wait <= 0 )
        {
          npc->act_no = 100;
          npc->bits |= 4u;
        }
        goto LABEL_31;
      }
LABEL_17:
      npc->act_no = 11;
      npc->act_wait = 16;
      goto LABEL_18;
    }
  }
LABEL_31:
  if ( y <= npc->y )
    npc->damage = 0;
  else
    npc->damage = 10;
  npc->y += npc->ym;
  v8 = (Sint32 *)&v11[16 * npc->ani_no - 36];
  npc->rect.left = *v8;
  npc->rect.top = v8[1];
  npc->rect.right = v8[2];
  npc->rect.bottom = v8[3];
  if ( npc->act_no == 11 )
  {
    npc->rect.top += npc->act_wait;
    npc->rect.bottom -= npc->act_wait;
    npc->view.top = (16 - npc->act_wait) << 9;
  }
}


//----- (080A2B2C) --------------------------------------------------------
void ActBossChar02_01()
{
  int minus;

  if ( unk_81CD00C )
    minus = -1;
  else
    minus = 1;
  switch ( unk_81CD028 )
  {
    case 0:
      npc.hit_voice = 52;
      npc.hit.front = 0x2000;
      npc.hit.top = 0x2000;
      npc.hit.back = 0x2000;
      npc.hit.bottom = 0x2000;
      npc.size = 3;
      npc.bits = 4;
      break;
    case 1:
      npc.x = unk_81CCFC8 - 12288 * minus;
      npc.y = unk_81CCFCC - 12288;
      break;
    case 2:
      npc.x = unk_81CCFC8 - 12288 * minus;
      npc.y = unk_81CCFCC - 10240;
      break;
    case 3:
    case 4:
      npc.x = unk_81CCFC8 - 12288 * minus;
      npc.y = unk_81CCFCC - 0x2000;
      break;
    case 5:
      npc.x = unk_81CCFC8 - 12288 * minus;
      npc.y = unk_81CCFCC - 22016;
      break;
    default:
      return;
  }
}

//----- (080A2C60) --------------------------------------------------------
void ActBossChar02_02()
{
  if ( unk_81CD028 )
  {
    if ( unk_81CD028 >= 0 && unk_81CD028 <= 5 )
    {
      stru_81CD118.x = unk_81CCFC8;
      stru_81CD118.y = unk_81CCFCC;
    }
  }
  else
  {
    stru_81CD118.hit_voice = 52;
    stru_81CD118.hit.front = 12288;
    stru_81CD118.hit.top = 0x2000;
    stru_81CD118.hit.back = 12288;
    stru_81CD118.hit.bottom = 0x2000;
    stru_81CD118.size = 3;
    stru_81CD118.bits = 4;
  }
}

//----- (080A2CEB) --------------------------------------------------------
void ActBossChar_Frog()
{
  NPCHAR_0 *v0;
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  int v8;
  int v9;
  int v10;
  int v11;
  int v12;
  int v13;
  int v14;
  char v15;
  int v16;
  int v17;
  int v18;
  int v19;
  int v20;
  int v21;
  int v22;
  int v23;
  int v24;
  int v25;
  int v26;
  int v27;
  int v28;
  int v29;
  int v30;
  int v31;
  int v32;
  int v33;
  int v34;
  int v35;
  int v36;
  int v37;
  int v38;
  int v39;
  int v40;
  int v41;
  int v42;
  int v43;
  NPCHAR_0 *v44;
  Sint32 *v45;
  RECT rcRight[9];
  RECT rcLeft[9];
  unsigned __int8 deg;
  int xm;
  int ym;
  int i;
  NPCHAR_0 *boss;
  char v53[24];

  qmemcpy(rcLeft, &ActBossChar_Frog(void)::C.0, sizeof(rcLeft));
  qmemcpy(rcRight, &ActBossChar_Frog(void)::C.1, sizeof(rcRight));
  boss = gBoss;
  switch ( gBoss[0].act_no )
  {
    case 0:
      boss->x = 49152;
      boss->y = 102400;
      boss->direct = 2;
      boss->view.front = 24576;
      boss->view.top = 24576;
      boss->view.back = 0x4000;
      boss->view.bottom = 0x2000;
      boss->hit_voice = 52;
      boss->hit.front = 12288;
      boss->hit.top = 0x2000;
      boss->hit.back = 12288;
      boss->hit.bottom = 0x2000;
      boss->size = 3;
      boss->exp = 1;
      boss->code_event = 1000;
      boss->bits |= 0x8200u;
      boss->life = 300;
      break;
    case 0xA:
      boss->act_no = 11;
      boss->ani_no = 3;
      boss->cond = -128;
      v0 = boss;
      boss->rect.left = rcRight[0].left;
      v0->rect.top = rcRight[0].top;
      v0->rect.right = rcRight[0].right;
      v0->rect.bottom = rcRight[0].bottom;
      npc.cond = -112;
      npc.code_event = 1000;
      stru_81CD118.cond = -128;
      npc.damage = 5;
      stru_81CD118.damage = 5;
      for ( i = 0; i <= 7; ++i )
      {
        v1 = Random(-1536, 0);
        v2 = Random(-341, 341);
        v3 = boss->y;
        v4 = (Random(-12, 12) << 9) + v3;
        v5 = boss->x;
        v6 = Random(-12, 12);
        SetNpChar(4, v5 + (v6 << 9), v4, v2, v1, 0, 0, 256);
      }
      break;
    case 0x14:
      boss->act_no = 21;
      boss->act_wait = 0;
      goto LABEL_8;
    case 0x15:
LABEL_8:
      if ( ++boss->act_wait / 2 & 1 )
        boss->ani_no = 3;
      else
        boss->ani_no = 0;
      break;
    case 0x64:
      boss->act_no = 101;
      boss->act_wait = 0;
      boss->ani_no = 1;
      boss->xm = 0;
      goto LABEL_12;
    case 0x65:
LABEL_12:
      if ( ++boss->act_wait > 50 )
      {
        boss->act_no = 102;
        boss->ani_wait = 0;
        boss->ani_no = 2;
      }
      break;
    case 0x66:
      if ( ++boss->ani_wait > 10 )
      {
        boss->act_no = 103;
        boss->ani_wait = 0;
        boss->ani_no = 1;
      }
      break;
    case 0x67:
      if ( ++boss->ani_wait > 4 )
      {
        boss->act_no = 104;
        boss->ani_no = 5;
        boss->ym = -1024;
        PlaySoundObject(25, 1);
        if ( boss->direct )
          boss->xm = 512;
        else
          boss->xm = -512;
        boss->view.top = 0x8000;
        boss->view.bottom = 12288;
      }
      break;
    case 0x68:
      if ( !boss->direct && boss->flag & 1 )
      {
        boss->direct = 2;
        boss->xm = 512;
      }
      if ( boss->direct == 2 && boss->flag & 4 )
      {
        boss->direct = 0;
        boss->xm = -512;
      }
      if ( boss->flag & 8 )
      {
        PlaySoundObject(26, 1);
        SetQuake(30);
        boss->act_no = 100;
        boss->ani_no = 1;
        boss->view.top = 24576;
        boss->view.bottom = 0x2000;
        if ( !boss->direct && boss->x < x )
        {
          boss->direct = 2;
          boss->act_no = 110;
        }
        if ( boss->direct == 2 && boss->x > x )
        {
          boss->direct = 0;
          boss->act_no = 110;
        }
        v7 = Random(0, 4) << 13;
        v8 = Random(4, 16);
        SetNpChar(110, v8 << 13, v7, 0, 0, 4, 0, 128);
        for ( i = 0; i <= 3; ++i )
        {
          v9 = Random(-1536, 0);
          v10 = Random(-341, 341);
          v11 = boss->y + boss->hit.bottom;
          v12 = boss->x;
          v13 = Random(-12, 12);
          SetNpChar(4, v12 + (v13 << 9), v11, v10, v9, 0, 0, 256);
        }
      }
      break;
    case 0x6E:
      boss->ani_no = 1;
      boss->act_wait = 0;
      boss->act_no = 111;
      goto LABEL_39;
    case 0x6F:
LABEL_39:
      ++boss->act_wait;
      boss->xm = 8 * boss->xm / 9;
      if ( boss->act_wait > 50 )
      {
        boss->ani_no = 2;
        boss->ani_wait = 0;
        boss->act_no = 112;
      }
      break;
    case 0x70:
      if ( ++boss->ani_wait > 4 )
      {
        boss->act_no = 113;
        boss->act_wait = 0;
        boss->ani_no = 3;
        boss->count1 = 16;
        npc.bits |= 0x20u;
        boss->tgt_x = boss->life;
      }
      break;
    case 0x71:
      if ( boss->shock )
      {
        v14 = boss->count2;
        boss->count2 = v14 + 1;
        if ( v14 / 2 & 1 )
          boss->ani_no = 4;
        else
          boss->ani_no = 3;
      }
      else
      {
        boss->count2 = 0;
        boss->ani_no = 3;
      }
      boss->xm = 10 * boss->xm / 11;
      if ( ++boss->act_wait > 16 )
      {
        boss->act_wait = 0;
        --boss->count1;
        deg = boss->direct ? (unsigned __int8)GetArktan(boss->x + 0x4000 - x, boss->y - 4096 - y) : (unsigned __int8)GetArktan(boss->x - 0x4000 - x, boss->y - 4096 - y);
        v15 = Random(-16, 16);
        deg += v15;
        ym = GetSin(deg);
        xm = GetCos(deg);
        if ( boss->direct )
          SetNpChar(108, boss->x + 0x4000, boss->y - 4096, xm, ym, 0, 0, 256);
        else
          SetNpChar(108, boss->x - 0x4000, boss->y - 4096, xm, ym, 0, 0, 256);
        PlaySoundObject(39, 1);
        if ( !boss->count1 || boss->life < boss->tgt_x - 90 )
        {
          boss->act_no = 114;
          boss->act_wait = 0;
          boss->ani_no = 2;
          boss->ani_wait = 0;
          npc.bits &= 0xFFDFu;
        }
      }
      break;
    case 0x72:
      if ( ++boss->ani_wait > 10 )
      {
        if ( ++npc.count1 <= 2 )
        {
          boss->act_no = 100;
        }
        else
        {
          npc.count1 = 0;
          boss->act_no = 120;
        }
        boss->ani_wait = 0;
        boss->ani_no = 1;
      }
      break;
    case 0x78:
      boss->act_no = 121;
      boss->act_wait = 0;
      boss->ani_no = 1;
      boss->xm = 0;
      goto LABEL_64;
    case 0x79:
LABEL_64:
      if ( ++boss->act_wait > 50 )
      {
        boss->act_no = 122;
        boss->ani_wait = 0;
        boss->ani_no = 2;
      }
      break;
    case 0x7A:
      if ( ++boss->ani_wait > 20 )
      {
        boss->act_no = 123;
        boss->ani_wait = 0;
        boss->ani_no = 1;
      }
      break;
    case 0x7B:
      if ( ++boss->ani_wait > 4 )
      {
        boss->act_no = 124;
        boss->ani_no = 5;
        boss->ym = -2560;
        boss->view.top = 0x8000;
        boss->view.bottom = 12288;
        PlaySoundObject(25, 1);
      }
      break;
    case 0x7C:
      if ( boss->flag & 8 )
      {
        PlaySoundObject(26, 1);
        SetQuake(60);
        boss->act_no = 100;
        boss->ani_no = 1;
        boss->view.top = 24576;
        boss->view.bottom = 0x2000;
        for ( i = 0; i <= 1; ++i )
        {
          v16 = Random(0, 4) << 13;
          v17 = Random(4, 16);
          SetNpChar(104, v17 << 13, v16, 0, 0, 4, 0, 128);
        }
        for ( i = 0; i <= 5; ++i )
        {
          v18 = Random(0, 4) << 13;
          v19 = Random(4, 16);
          SetNpChar(110, v19 << 13, v18, 0, 0, 4, 0, 128);
        }
        for ( i = 0; i <= 7; ++i )
        {
          v20 = Random(-1536, 0);
          v21 = Random(-341, 341);
          v22 = boss->y + boss->hit.bottom;
          v23 = boss->x;
          v24 = Random(-12, 12);
          SetNpChar(4, v23 + (v24 << 9), v22, v21, v20, 0, 0, 256);
        }
        if ( !boss->direct && boss->x < x )
        {
          boss->direct = 2;
          boss->act_no = 110;
        }
        if ( boss->direct == 2 && boss->x > x )
        {
          boss->direct = 0;
          boss->act_no = 110;
        }
      }
      break;
    case 0x82:
      boss->act_no = 131;
      boss->ani_no = 3;
      boss->act_wait = 0;
      boss->xm = 0;
      PlaySoundObject(72, 1);
      for ( i = 0; i <= 7; ++i )
      {
        v25 = Random(-1536, 0);
        v26 = Random(-341, 341);
        v27 = boss->y;
        v28 = (Random(-12, 12) << 9) + v27;
        v29 = boss->x;
        v30 = Random(-12, 12);
        SetNpChar(4, v29 + (v30 << 9), v28, v26, v25, 0, 0, 256);
      }
      npc.cond = 0;
      stru_81CD118.cond = 0;
      goto LABEL_90;
    case 0x83:
LABEL_90:
      if ( !(++boss->act_wait % 5) )
      {
        v31 = Random(-1536, 0);
        v32 = Random(-341, 341);
        v33 = boss->y;
        v34 = (Random(-12, 12) << 9) + v33;
        v35 = boss->x;
        v36 = Random(-12, 12);
        SetNpChar(4, v35 + (v36 << 9), v34, v32, v31, 0, 0, 256);
      }
      if ( boss->act_wait / 2 & 1 )
        v37 = boss->x - 512;
      else
        v37 = boss->x + 512;
      boss->x = v37;
      if ( boss->act_wait > 100 )
      {
        boss->act_wait = 0;
        boss->act_no = 132;
      }
      break;
    case 0x84:
      if ( ++boss->act_wait / 2 & 1 )
      {
        boss->view.front = 10240;
        boss->view.top = 6144;
        boss->view.back = 10240;
        boss->view.bottom = 6144;
        boss->ani_no = 6;
      }
      else
      {
        boss->view.front = 24576;
        boss->view.top = 24576;
        boss->view.back = 0x4000;
        boss->view.bottom = 0x2000;
        boss->ani_no = 3;
      }
      if ( !(boss->act_wait % 9) )
      {
        v38 = Random(-1536, 0);
        v39 = Random(-341, 341);
        v40 = boss->y;
        v41 = (Random(-12, 12) << 9) + v40;
        v42 = boss->x;
        v43 = Random(-12, 12);
        SetNpChar(4, v42 + (v43 << 9), v41, v39, v38, 0, 0, 256);
      }
      if ( boss->act_wait > 150 )
      {
        boss->act_no = 140;
        boss->hit.bottom = 6144;
      }
      break;
    case 0x8C:
      boss->act_no = 141;
      goto LABEL_105;
    case 0x8D:
LABEL_105:
      if ( boss->flag & 8 )
      {
        boss->act_no = 142;
        boss->act_wait = 0;
        boss->ani_no = 7;
      }
      break;
    case 0x8E:
      if ( ++boss->act_wait > 30 )
      {
        boss->ani_no = 8;
        boss->ym = -2560;
        boss->bits |= 8u;
        boss->act_no = 143;
      }
      break;
    case 0x8F:
      boss->ym = -2560;
      if ( boss->y < 0 )
      {
        boss->cond = 0;
        PlaySoundObject(26, 1);
        SetQuake(30);
      }
      break;
    default:
      break;
  }
  boss->ym += 64;
  if ( boss->ym > 1535 )
    boss->ym = 1535;
  boss->x += boss->xm;
  boss->y += boss->ym;
  if ( boss->direct )
  {
    v44 = boss;
    v45 = (Sint32 *)&v53[16 * boss->ani_no - 308];
  }
  else
  {
    v44 = boss;
    v45 = (Sint32 *)&v53[16 * boss->ani_no - 164];
  }
  boss->rect.left = *v45;
  v44->rect.top = v45[1];
  v44->rect.right = v45[2];
  v44->rect.bottom = v45[3];
  ActBossChar02_01();
  ActBossChar02_02();
}


//----- (080A4074) --------------------------------------------------------
void ActBoss01_12()
{
  int v0;
  RECT *v1;
  int v2;
  RECT *v3;
  RECT rcRight[1];
  RECT rcLeft[1];
  int i;

  rcLeft[0].left = 80;
  rcLeft[0].top = 56;
  rcLeft[0].right = 104;
  rcLeft[0].bottom = 72;
  rcRight[0].left = 104;
  rcRight[0].top = 56;
  rcRight[0].right = 128;
  rcRight[0].bottom = 72;
  for ( i = 1; i <= 2; ++i )
  {
    *(&unk_81CCFCC + 43 * i) = (unk_81CCFCC + *(&unk_81CCFCC + 43 * (i + 2)) - 4096) / 2;
    if ( *((_DWORD *)&unk_81CD00C + 43 * i) )
    {
      v2 = 172 * i;
      v3 = &rcRight[*((_DWORD *)&unk_81CD028 + 43 * i)];
      *(_DWORD *)(v2 + 136106004) = v3->left;
      *(_DWORD *)(v2 + 136106008) = v3->top;
      *(_DWORD *)(v2 + 136106012) = v3->right;
      *(_DWORD *)(v2 + 136106016) = v3->bottom;
      *(&unk_81CCFC8 + 43 * i) = unk_81CCFC8 + 0x2000;
    }
    else
    {
      *(&unk_81CCFC8 + 43 * i) = unk_81CCFC8 - 0x2000;
      v0 = 172 * i;
      v1 = &rcLeft[*((_DWORD *)&unk_81CD028 + 43 * i)];
      *(_DWORD *)(v0 + 136106004) = v1->left;
      *(_DWORD *)(v0 + 136106008) = v1->top;
      *(_DWORD *)(v0 + 136106012) = v1->right;
      *(_DWORD *)(v0 + 136106016) = v1->bottom;
    }
  }
}

//----- (080A41E3) --------------------------------------------------------
void ActBoss01_34()
{
  signed int v0;
  int v1;
  char *v2;
  RECT rcRight[2];
  RECT rcLeft[2];
  int i;
  char v6[8];

  rcLeft[0].left = 0;
  rcLeft[0].top = 56;
  rcLeft[0].right = 40;
  rcLeft[0].bottom = 88;
  rcLeft[1].left = 40;
  rcLeft[1].top = 56;
  rcLeft[1].right = 80;
  rcLeft[1].bottom = 88;
  rcRight[0].left = 0;
  rcRight[0].top = 88;
  rcRight[0].right = 40;
  rcRight[0].bottom = 120;
  rcRight[1].left = 40;
  rcRight[1].top = 88;
  rcRight[1].right = 80;
  rcRight[1].bottom = 120;
  for ( i = 3; i <= 4; ++i )
  {
    v0 = *((_DWORD *)&unk_81CD034 + 43 * i);
    if ( v0 == 1 )
      goto LABEL_10;
    if ( v0 <= 1 )
    {
      if ( v0 )
        goto LABEL_19;
      *((_DWORD *)&unk_81CD034 + 43 * i) = 1;
LABEL_10:
      *(&unk_81CCFCC + 43 * i) = unk_81CCFCC;
      if ( i == 3 )
        *(&unk_81CCFC8 + 129) = unk_81CCFC8 - 0x2000;
      if ( i == 4 )
        *(&unk_81CCFC8 + 172) = unk_81CCFC8 + 0x2000;
      goto LABEL_19;
    }
    if ( v0 != 2 && v0 == 3 )
    {
      *((_DWORD *)&unk_81CCFE4 + 43 * i) = unk_81CCFCC + 12288;
      if ( i == 3 )
        *(&unk_81CCFC8 + 129) = unk_81CCFC8 - 0x2000;
      if ( i == 4 )
        *(&unk_81CCFC8 + 172) = unk_81CCFC8 + 0x2000;
      *(&unk_81CCFCC + 43 * i) += (*((_DWORD *)&unk_81CCFE4 + 43 * i) - *(&unk_81CCFCC + 43 * i)) / 2;
    }
LABEL_19:
    *((_DWORD *)&unk_81CD028 + 43 * i) = !(*((_DWORD *)&unk_81CCFC4 + 43 * i) & 8)
                                      && *(&unk_81CCFCC + 43 * i) > *((_DWORD *)&unk_81CCFE4 + 43 * i);
    if ( *((_DWORD *)&unk_81CD00C + 43 * i) )
    {
      v1 = 172 * i;
      v2 = &v6[16 * *((_DWORD *)&unk_81CD028 + 43 * i) - 68];
    }
    else
    {
      v1 = 172 * i;
      v2 = &v6[16 * *((_DWORD *)&unk_81CD028 + 43 * i) - 36];
    }
    *(_DWORD *)(v1 + 136106004) = *(_DWORD *)v2;
    *(_DWORD *)(v1 + 136106008) = *((_DWORD *)v2 + 1);
    *(_DWORD *)(v1 + 136106012) = *((_DWORD *)v2 + 2);
    *(_DWORD *)(v1 + 136106016) = *((_DWORD *)v2 + 3);
  }
}


//----- (080A44DD) --------------------------------------------------------
void ActBoss01_5()
{
  if ( !stru_81CD31C.act_no )
  {
    stru_81CD31C.bits |= 9u;
    stru_81CD31C.hit.front = 10240;
    stru_81CD31C.hit.top = 18432;
    stru_81CD31C.hit.back = 10240;
    stru_81CD31C.hit.bottom = 0x2000;
    stru_81CD31C.act_no = 1;
    goto LABEL_5;
  }
  if ( stru_81CD31C.act_no == 1 )
  {
LABEL_5:
    stru_81CD31C.x = unk_81CCFC8;
    stru_81CD31C.y = unk_81CCFCC;
  }
}

//----- (080A4548) --------------------------------------------------------
void ActBossChar_Omega()
{
  int v0;
  int v1;
  bool v2;
  int v3;
  bool v4;
  int v5;
  int v6;
  int v7;
  int v8;
  int v9;
  char *v10;
  RECT rect[4];
  char v12[24];

  switch ( unk_81CD034 )
  {
    case 0:
      unk_81CCFC8 = 1794048;
      unk_81CCFCC = 0x20000;
      unk_81CD04C = 20480;
      unk_81CD050 = 20480;
      unk_81CD054 = 20480;
      unk_81CD058 = 0x2000;
      unk_81CCFE0 = 1794048;
      unk_81CCFE4 = 0x20000;
      unk_81CCFF8 = 52;
      unk_81CD03C = 4096;
      unk_81CD040 = 12288;
      unk_81CD044 = 4096;
      unk_81CD048 = 0x2000;
      unk_81CD010 = -32248;
      unk_81CD008 = 3;
      unk_81CD004 = 1;
      unk_81CCFF0 = 210;
      unk_81CD000 = 400;
      npc.cond = -128;
      npc.view.front = 6144;
      npc.view.top = 4096;
      npc.view.back = 6144;
      npc.view.bottom = 4096;
      npc.bits = 8;
      qmemcpy(&stru_81CD118, &npc, sizeof(stru_81CD118));
      npc.direct = 0;
      stru_81CD118.direct = 2;
      stru_81CD1C4.cond = -128;
      stru_81CD1C4.view.front = 12288;
      stru_81CD1C4.view.top = 0x2000;
      stru_81CD1C4.view.back = 0x2000;
      stru_81CD1C4.view.bottom = 0x2000;
      stru_81CD1C4.hit_voice = 52;
      stru_81CD1C4.hit.front = 4096;
      stru_81CD1C4.hit.top = 4096;
      stru_81CD1C4.hit.back = 4096;
      stru_81CD1C4.hit.bottom = 4096;
      stru_81CD1C4.bits = 8;
      stru_81CD1C4.y = unk_81CCFCC;
      stru_81CD1C4.direct = 0;
      qmemcpy(&stru_81CD270, &stru_81CD1C4, sizeof(stru_81CD270));
      stru_81CD270.direct = 2;
      stru_81CD1C4.x = unk_81CCFC8 + 0x2000;
      stru_81CD31C.cond = -128;
      break;
    case 0x14:
      unk_81CD034 = 30;
      dword_81CD038 = 0;
      unk_81CD028 = 0;
      goto LABEL_4;
    case 0x1E:
LABEL_4:
      SetQuake(2);
      unk_81CCFCC -= 512;
      if ( !(++dword_81CD038 & 3) )
        PlaySoundObject(26, 1);
      if ( dword_81CD038 == 48 )
      {
        dword_81CD038 = 0;
        unk_81CD034 = 40;
        if ( unk_81CD000 <= 280 )
        {
          unk_81CD034 = 110;
          unk_81CD010 |= 0x20u;
          unk_81CD010 &= 0xFFF7u;
          stru_81CD1C4.bits &= 0xFFF7u;
          stru_81CD270.bits &= 0xFFF7u;
          stru_81CD1C4.act_no = 3;
          stru_81CD270.act_no = 3;
          stru_81CD31C.hit.top = 0x2000;
        }
      }
      break;
    case 0x28:
      if ( ++dword_81CD038 == 48 )
      {
        dword_81CD038 = 0;
        unk_81CD034 = 50;
        unk_81CD024 = 0;
        stru_81CD31C.hit.top = 0x2000;
        PlaySoundObject(102, 1);
      }
      break;
    case 0x32:
      if ( ++unk_81CD024 > 2 )
      {
        unk_81CD024 = 0;
        ++unk_81CD028;
      }
      if ( unk_81CD028 == 3 )
      {
        unk_81CD034 = 60;
        dword_81CD038 = 0;
        unk_81CD010 |= 0x20u;
        unk_81CD03C = 0x2000;
        unk_81CD044 = 0x2000;
      }
      break;
    case 0x3C:
      if ( ++dword_81CD038 > 20 && dword_81CD038 <= 79 && !(dword_81CD038 % 3) )
      {
        if ( Random(0, 9) <= 7 )
        {
          v0 = Random(-256, 256);
          SetNpChar(48, unk_81CCFC8, unk_81CCFCC - 0x2000, v0, -819, 0, 0, 256);
        }
        else
        {
          v1 = Random(-256, 256);
          SetNpChar(48, unk_81CCFC8, unk_81CCFCC - 0x2000, v1, -819, 2, 0, 256);
        }
        PlaySoundObject(39, 1);
      }
      v2 = dword_81CD038 == 200 || CountArmsBullet(6);
      if ( v2 )
      {
        unk_81CD024 = 0;
        unk_81CD034 = 70;
        PlaySoundObject(102, 1);
      }
      break;
    case 0x46:
      if ( ++unk_81CD024 > 2 )
      {
        unk_81CD024 = 0;
        --unk_81CD028;
      }
      if ( unk_81CD028 == 1 )
        unk_81CD064 = 20;
      if ( !unk_81CD028 )
      {
        PlaySoundObject(102, 0);
        PlaySoundObject(12, 1);
        unk_81CD034 = 80;
        dword_81CD038 = 0;
        unk_81CD010 &= 0xFFDFu;
        unk_81CD03C = 12288;
        unk_81CD044 = 12288;
        stru_81CD31C.hit.top = 18432;
        unk_81CD064 = 0;
      }
      break;
    case 0x50:
      if ( ++dword_81CD038 == 48 )
      {
        dword_81CD038 = 0;
        unk_81CD034 = 90;
      }
      break;
    case 0x5A:
      SetQuake(2);
      unk_81CCFCC += 512;
      if ( !(++dword_81CD038 & 3) )
        PlaySoundObject(26, 1);
      if ( dword_81CD038 == 48 )
      {
        dword_81CD038 = 0;
        unk_81CD034 = 100;
      }
      break;
    case 0x64:
      if ( ++dword_81CD038 == 120 )
      {
        dword_81CD038 = 0;
        unk_81CD034 = 30;
        v3 = unk_81CCFE0;
        unk_81CCFC8 = v3 + (Random(-64, 64) << 9);
        unk_81CCFCC = unk_81CCFE4;
      }
      break;
    case 0x6E:
      if ( ++unk_81CD024 > 2 )
      {
        unk_81CD024 = 0;
        ++unk_81CD028;
      }
      if ( unk_81CD028 == 3 )
      {
        unk_81CD034 = 120;
        dword_81CD038 = 0;
        unk_81CD03C = 0x2000;
        unk_81CD044 = 0x2000;
      }
      break;
    case 0x78:
      v4 = ++dword_81CD038 == 50 || CountArmsBullet(6);
      if ( v4 )
      {
        unk_81CD034 = 130;
        PlaySoundObject(102, 1);
        dword_81CD038 = 0;
        unk_81CD024 = 0;
      }
      if ( dword_81CD038 <= 29 && !(dword_81CD038 % 5) )
      {
        v5 = Random(-341, 341);
        SetNpChar(48, unk_81CCFC8, unk_81CCFCC - 0x2000, v5, -819, 0, 0, 256);
        PlaySoundObject(39, 1);
      }
      break;
    case 0x82:
      if ( ++unk_81CD024 > 2 )
      {
        unk_81CD024 = 0;
        --unk_81CD028;
      }
      if ( unk_81CD028 == 1 )
        unk_81CD064 = 20;
      if ( !unk_81CD028 )
      {
        unk_81CD034 = 140;
        unk_81CD010 |= 0x20u;
        unk_81CD03C = 0x2000;
        unk_81CD044 = 0x2000;
        unk_81CCFD4 = -1535;
        PlaySoundObject(102, 0);
        PlaySoundObject(12, 1);
        PlaySoundObject(25, 1);
        if ( unk_81CCFC8 < x )
          unk_81CCFD0 = 256;
        if ( unk_81CCFC8 > x )
          unk_81CCFD0 = -256;
        unk_81CD064 = 0;
        stru_81CD31C.hit.top = 18432;
      }
      break;
    case 0x8C:
      if ( dword_81C8584 & 8 && unk_81CCFD4 > 0 )
        stru_81CD31C.damage = 20;
      else
        stru_81CD31C.damage = 0;
      unk_81CCFD4 += 36;
      if ( unk_81CCFD4 > 1535 )
        unk_81CCFD4 = 1535;
      unk_81CCFCC += unk_81CCFD4;
      unk_81CCFC8 += unk_81CCFD0;
      if ( unk_81CCFC4 & 8 )
      {
        unk_81CD034 = 110;
        dword_81CD038 = 0;
        unk_81CD024 = 0;
        stru_81CD31C.hit.top = 0x2000;
        stru_81CD31C.damage = 0;
        PlaySoundObject(26, 1);
        PlaySoundObject(12, 1);
        SetQuake(30);
      }
      break;
    case 0x96:
      SetQuake(2);
      if ( !(++dword_81CD038 % 12) )
        PlaySoundObject(52, 1);
      v6 = unk_81CCFCC;
      v7 = (Random(-48, 24) << 9) + v6;
      v8 = unk_81CCFC8;
      v9 = Random(-48, 48);
      SetDestroyNpChar(v8 + (v9 << 9), v7, 1, 1);
      if ( dword_81CD038 > 100 )
      {
        dword_81CD038 = 0;
        unk_81CD034 = 160;
        SetFlash(unk_81CCFC8, unk_81CCFCC, 1);
        PlaySoundObject(35, 1);
      }
      break;
    case 0xA0:
      SetQuake(40);
      if ( ++dword_81CD038 > 50 )
      {
        gBoss[0].cond = 0;
        npc.cond = 0;
        stru_81CD118.cond = 0;
        stru_81CD1C4.cond = 0;
        stru_81CD270.cond = 0;
        stru_81CD31C.cond = 0;
      }
      break;
    default:
      break;
  }
  rect[0].left = 0;
  rect[0].top = 0;
  rect[0].right = 80;
  rect[0].bottom = 56;
  rect[1].left = 80;
  rect[1].top = 0;
  rect[1].right = 160;
  rect[1].bottom = 56;
  rect[2].left = 160;
  rect[2].top = 0;
  rect[2].right = 240;
  rect[2].bottom = 56;
  rect[3].left = 80;
  rect[3].top = 0;
  rect[3].right = 160;
  rect[3].bottom = 56;
  v10 = &v12[16 * unk_81CD028 - 64];
  unk_81CD014 = *(_DWORD *)v10;
  unk_81CD018 = *((_DWORD *)v10 + 1);
  unk_81CD01C = *((_DWORD *)v10 + 2);
  unk_81CD020 = *((_DWORD *)v10 + 3);
  npc.shock = unk_81CD05C;
  stru_81CD118.shock = unk_81CD05C;
  stru_81CD1C4.shock = unk_81CD05C;
  stru_81CD270.shock = unk_81CD05C;
  ActBoss01_34();
  ActBoss01_12();
  ActBoss01_5();
  if ( !unk_81CD000 && unk_81CD034 <= 149 )
  {
    unk_81CD034 = 150;
    dword_81CD038 = 0;
    unk_81CD064 = 0;
    stru_81CD31C.damage = 0;
    DeleteNpCharCode(48, 1);
  }
}


//----- (080A52CC) --------------------------------------------------------
void __cdecl GetCompileDate(int *year, int *month, int *day)
{
  char *table[13];
  char strMonth[16];
  int i;

  table[0] = (char *)&unk_814B854;
  table[1] = (char *)&unk_814B858;
  table[2] = (char *)&unk_814B85C;
  table[3] = (char *)&unk_814B860;
  table[4] = (char *)&unk_814B864;
  table[5] = (char *)&unk_814B868;
  table[6] = (char *)&unk_814B86C;
  table[7] = (char *)&unk_814B870;
  table[8] = (char *)&unk_814B874;
  table[9] = (char *)&unk_814B878;
  table[10] = (char *)&unk_814B87C;
  table[11] = (char *)&unk_814B880;
  table[12] = (char *)&unk_814B884;
  sscanf("Mar 15 2010", "%s %ld %ld", strMonth, day, year);
  for ( i = 0; i <= 11 && memcmp(strMonth, table[i], 3u); ++i )
    ;
  *month = i;
}

//----- (080A539D) --------------------------------------------------------
signed int __cdecl GetCompileVersion(int *v1, int *v2, int *v3, int *v4)
{
  *v1 = 1;
  *v2 = 0;
  *v3 = 0;
  *v4 = 4;
  return 1;
}

//----- (080A53CB) --------------------------------------------------------
signed int __cdecl ErrorLog(const char *str, int value)
{
  fprintf(stderr, "%s,%ld\n", str, value);
  return 1;
}

//----- (080A53FB) --------------------------------------------------------
int __cdecl GetFileSizeLong(char *path)
{
  int len;
  SDL_RWops_0 *fp;

  fp = SDL_RWFromFile(path, "rb");
  if ( !fp )
    return -1;
  len = fp->seek(fp, 0, 2);
  fp->close(fp);
  return len;
}

//----- (080A5457) --------------------------------------------------------
bool __cdecl IsShiftJIS(unsigned __int8 c)
{
  if ( c > 0x80u && c <= 0x9Fu )
    return 1;
  if ( c <= 0xDFu || c > 0xEFu )
    return 0;
  return 1;
}

//----- (080A5490) --------------------------------------------------------
bool __cdecl IsEnableBitmap(char *path)
{
  char str[16];
  SDL_RWops_0 *fp;
  int len;

  len = strlen(_extra_text);
  fp = SDL_RWFromFile(path, "rb");
  if ( !fp )
    return 0;
  fp->seek(fp, -len, 2);
  fp->read(fp, str, 1, len);
  fp->close(fp);
  return memcmp(str, _extra_text, len) == 0;
}

//----- (080A5548) --------------------------------------------------------
void __cdecl ActBossCharT_DragonBody(NPCHAR_0 *npc)
{
  int v1;
  __int64 v2;
  int v3;
  int v4;
  int v5;
  int v6;
  __int64 v7;
  int v8;
  int v9;
  __int64 v10;
  int v11;
  int v12;
  NPCHAR_0 *v13;
  Sint32 *v14;
  RECT rcRight[3];
  RECT rcLeft[3];
  unsigned __int8 deg;
  char v18[8];

  rcLeft[0].left = 0;
  rcLeft[0].top = 0;
  rcLeft[0].right = 40;
  rcLeft[0].bottom = 40;
  rcLeft[1].left = 40;
  rcLeft[1].top = 0;
  rcLeft[1].right = 80;
  rcLeft[1].bottom = 40;
  rcLeft[2].left = 80;
  rcLeft[2].top = 0;
  rcLeft[2].right = 120;
  rcLeft[2].bottom = 40;
  rcRight[0].left = 0;
  rcRight[0].top = 40;
  rcRight[0].right = 40;
  rcRight[0].bottom = 80;
  rcRight[1].left = 40;
  rcRight[1].top = 40;
  rcRight[1].right = 80;
  rcRight[1].bottom = 80;
  rcRight[2].left = 80;
  rcRight[2].top = 40;
  rcRight[2].right = 120;
  rcRight[2].bottom = 80;
  v1 = npc->act_no;
  if ( v1 == 100 )
  {
    v7 = npc->pNpc->count1;
    deg = LOBYTE(npc->count1) + ((signed int)((HIDWORD(v7) >> 30) + v7) >> 2);
    v8 = npc->pNpc->x;
    npc->tgt_x = v8 + npc->pNpc->tgt_x * GetCos(deg);
    v9 = npc->pNpc->y;
    npc->tgt_y = v9 + npc->pNpc->tgt_y * GetSin(deg);
    npc->x += (npc->tgt_x - npc->x) / 8;
    npc->y += (npc->tgt_y - npc->y) / 8;
    if ( npc->x <= x )
      npc->direct = 2;
    else
      npc->direct = 0;
  }
  else if ( v1 > 100 )
  {
    if ( v1 == 1000 )
    {
      npc->act_no = 1001;
      npc->bits &= 0xFFDFu;
    }
    else if ( v1 != 1001 )
    {
      goto LABEL_20;
    }
    v10 = npc->pNpc->count1;
    deg = LOBYTE(npc->count1) + ((signed int)((HIDWORD(v10) >> 30) + v10) >> 2);
    v11 = npc->pNpc->x;
    npc->tgt_x = v11 + npc->pNpc->tgt_x * GetCos(deg);
    v12 = npc->pNpc->y;
    npc->tgt_y = v12 + npc->pNpc->tgt_y * GetSin(deg);
    npc->x += (npc->tgt_x - npc->x) / 8;
    npc->y += (npc->tgt_y - npc->y) / 8;
    if ( npc->x <= npc->pNpc->x )
      npc->direct = 2;
    else
      npc->direct = 0;
  }
  else
  {
    if ( v1 )
    {
      if ( v1 != 10 )
        goto LABEL_20;
    }
    else
    {
      v2 = npc->pNpc->count1;
      deg = LOBYTE(npc->count1) + ((signed int)((HIDWORD(v2) >> 30) + v2) >> 2);
      npc->act_no = 10;
      v3 = npc->x;
      v4 = npc->pNpc->x;
      npc->x = v3 + v4 + npc->pNpc->tgt_x * GetCos(deg);
      v5 = npc->y;
      v6 = npc->pNpc->y;
      npc->y = v5 + v6 + npc->pNpc->tgt_y * GetSin(deg);
    }
    if ( npc->x <= x )
      npc->direct = 2;
    else
      npc->direct = 0;
  }
LABEL_20:
  if ( ++npc->ani_wait > 2 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 2 )
    npc->ani_no = 0;
  if ( npc->direct )
  {
    v13 = npc;
    v14 = (Sint32 *)&v18[16 * npc->ani_no - 100];
  }
  else
  {
    v13 = npc;
    v14 = (Sint32 *)&v18[16 * npc->ani_no - 52];
  }
  npc->rect.left = *v14;
  v13->rect.top = v14[1];
  v13->rect.right = v14[2];
  v13->rect.bottom = v14[3];
}


//----- (080A5A3F) --------------------------------------------------------
void __cdecl ActBossCharT_DragonHead(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  NPCHAR_0 *v3;
  Sint32 *v4;
  RECT rcRight[4];
  RECT rcLeft[4];
  unsigned __int8 deg;
  int xm;
  int ym;
  char v10[8];

  rcLeft[0].left = 0;
  rcLeft[0].top = 80;
  rcLeft[0].right = 40;
  rcLeft[0].bottom = 112;
  rcLeft[1].left = 40;
  rcLeft[1].top = 80;
  rcLeft[1].right = 80;
  rcLeft[1].bottom = 112;
  rcLeft[2].left = 80;
  rcLeft[2].top = 80;
  rcLeft[2].right = 120;
  rcLeft[2].bottom = 112;
  rcLeft[3].left = 120;
  rcLeft[3].top = 80;
  rcLeft[3].right = 160;
  rcLeft[3].bottom = 112;
  rcRight[0].left = 0;
  rcRight[0].top = 112;
  rcRight[0].right = 40;
  rcRight[0].bottom = 144;
  rcRight[1].left = 40;
  rcRight[1].top = 112;
  rcRight[1].right = 80;
  rcRight[1].bottom = 144;
  rcRight[2].left = 80;
  rcRight[2].top = 112;
  rcRight[2].right = 120;
  rcRight[2].bottom = 144;
  rcRight[3].left = 120;
  rcRight[3].top = 112;
  rcRight[3].right = 160;
  rcRight[3].bottom = 144;
  v1 = npc->act_no;
  if ( v1 == 210 )
  {
    if ( ++npc->act_wait == 3 )
      npc->ani_no = 1;
    if ( npc->act_wait == 6 )
    {
      npc->ani_no = 2;
      npc->hit.front = 4096;
      npc->bits |= 0x20u;
      npc->count2 = 0;
    }
    if ( npc->act_wait > 150 )
    {
      npc->act_no = 220;
      npc->act_wait = 0;
    }
    if ( npc->shock )
      ++npc->count2;
    if ( npc->count2 > 10 )
    {
      PlaySoundObject(51, 1);
      SetDestroyNpChar(npc->x, npc->y, npc->view.back, 4);
      npc->act_no = 300;
      npc->act_wait = 0;
      npc->ani_no = 3;
      npc->hit.front = 0x2000;
    }
  }
  else
  {
    if ( v1 <= 210 )
    {
      if ( v1 == 100 )
      {
        npc->act_no = 200;
      }
      else
      {
        if ( v1 <= 100 )
        {
          if ( !v1 )
            npc->act_no = 1;
          goto LABEL_55;
        }
        if ( v1 != 200 )
        {
          if ( v1 != 201 )
            goto LABEL_55;
LABEL_21:
          if ( npc->count1 )
          {
            --npc->count1;
          }
          else
          {
            npc->act_no = 210;
            npc->act_wait = 0;
            npc->count2 = 0;
          }
          goto LABEL_55;
        }
      }
      npc->bits &= 0xFFDFu;
      npc->ani_no = 0;
      npc->hit.front = 0x2000;
      npc->act_no = 201;
      npc->count1 = Random(100, 200);
      goto LABEL_21;
    }
    if ( v1 == 400 )
    {
      npc->act_no = 401;
      npc->act_wait = 0;
      npc->ani_no = 0;
      npc->hit.front = 0x2000;
      npc->bits &= 0xFFDFu;
    }
    else
    {
      if ( v1 <= 400 )
      {
        if ( v1 == 220 )
        {
          if ( ++npc->act_wait % 8 == 1 )
          {
            deg = GetArktan(npc->x - x, npc->y - y);
            deg += Random(-6, 6);
            ym = GetSin(deg);
            xm = GetCos(deg);
            if ( npc->direct )
              SetNpChar(202, npc->x + 4096, npc->y, xm, ym, 0, 0, 256);
            else
              SetNpChar(202, npc->x - 4096, npc->y, xm, ym, 0, 0, 256);
            PlaySoundObject(33, 1);
          }
          if ( npc->act_wait > 50 )
            npc->act_no = 200;
        }
        else if ( v1 == 300 && ++npc->act_wait > 100 )
        {
          npc->act_no = 200;
        }
        goto LABEL_55;
      }
      if ( v1 != 401 )
      {
        if ( v1 == 1000 )
        {
          npc->bits &= 0xFFDFu;
          npc->ani_no = 3;
        }
        goto LABEL_55;
      }
    }
    if ( ++npc->act_wait == 3 )
      npc->ani_no = 1;
    if ( npc->act_wait == 6 )
    {
      npc->ani_no = 2;
      npc->hit.front = 4096;
      npc->bits |= 0x20u;
      npc->count2 = 0;
    }
    if ( npc->act_wait > 20 && npc->act_wait % 32 == 1 )
    {
      deg = GetArktan(npc->x - x, npc->y - y);
      deg += Random(-6, 6);
      ym = GetSin(deg);
      xm = GetCos(deg);
      if ( npc->direct )
        SetNpChar(202, npc->x + 4096, npc->y, xm, ym, 0, 0, 256);
      else
        SetNpChar(202, npc->x - 4096, npc->y, xm, ym, 0, 0, 256);
      PlaySoundObject(33, 1);
    }
  }
LABEL_55:
  npc->direct = npc->pNpc->direct;
  if ( npc->direct )
    v2 = npc->pNpc->x + 2048;
  else
    v2 = npc->pNpc->x - 2048;
  npc->x = v2;
  npc->y = npc->pNpc->y - 4096;
  if ( npc->direct )
  {
    v3 = npc;
    v4 = (Sint32 *)&v10[16 * npc->ani_no - 140];
  }
  else
  {
    v3 = npc;
    v4 = (Sint32 *)&v10[16 * npc->ani_no - 76];
  }
  npc->rect.left = *v4;
  v3->rect.top = v4[1];
  v3->rect.right = v4[2];
  v3->rect.bottom = v4[3];
}


//----- (080A61FD) --------------------------------------------------------
void ActBossChar_Twin()
{
  int v0;
  unsigned __int16 v1;
  int v2;
  int v3;
  int v4;
  int v5;

  v0 = gBoss[0].act_no;
  if ( v0 == 400 )
  {
    if ( ++gBoss[0].act_wait > 100 )
    {
      gBoss[0].act_wait = 0;
      gBoss[0].act_no = 401;
    }
    goto LABEL_82;
  }
  if ( v0 > 400 )
  {
    if ( v0 != 1001 )
    {
      if ( v0 > 1001 )
      {
        if ( v0 == 1010 )
        {
          gBoss[0].count1 += 4;
          if ( gBoss[0].count1 > 1023 )
            gBoss[0].count1 -= 1024;
          if ( gBoss[0].tgt_x > 8 )
            --gBoss[0].tgt_x;
          if ( gBoss[0].tgt_y > 0 )
            --gBoss[0].tgt_y;
          if ( gBoss[0].tgt_x < -8 )
            ++gBoss[0].tgt_x;
          if ( gBoss[0].tgt_y < 0 )
            ++gBoss[0].tgt_y;
          if ( !gBoss[0].tgt_y )
          {
            gBoss[0].act_no = 1020;
            gBoss[0].act_wait = 0;
            SetFlash(unk_81CCFC8, unk_81CCFCC, 1);
            PlaySoundObject(35, 1);
          }
        }
        else if ( v0 == 1020 && ++dword_81CD038 > 50 )
        {
          DeleteNpCharCode(211, 1);
          gBoss[0].cond = 0;
          npc.cond = 0;
          stru_81CD118.cond = 0;
          stru_81CD1C4.cond = 0;
          stru_81CD270.cond = 0;
          stru_81CD31C.cond = 0;
          unk_81CD034 = 0;
        }
        goto LABEL_82;
      }
      if ( v0 == 401 )
      {
        if ( ++gBoss[0].act_wait > 99 )
        {
          if ( gBoss[0].act_wait > 119 )
          {
            if ( gBoss[0].act_wait > 499 )
            {
              if ( gBoss[0].act_wait > 539 )
              {
                if ( gBoss[0].act_wait > 559 )
                {
                  gBoss[0].act_no = 100;
                  gBoss[0].act_wait = 0;
                  stru_81CD118.act_no = 100;
                  stru_81CD270.act_no = 100;
                  goto LABEL_82;
                }
                ++gBoss[0].count1;
              }
              else
              {
                gBoss[0].count1 += 2;
              }
            }
            else
            {
              gBoss[0].count1 += 4;
            }
          }
          else
          {
            gBoss[0].count1 += 2;
          }
        }
        else
        {
          ++gBoss[0].count1;
        }
        if ( gBoss[0].count1 > 1023 )
          gBoss[0].count1 -= 1024;
        goto LABEL_82;
      }
      if ( v0 != 1000 )
        goto LABEL_82;
      gBoss[0].act_no = 1001;
      gBoss[0].act_wait = 0;
      stru_81CD118.act_no = 1000;
      stru_81CD1C4.act_no = 1000;
      stru_81CD270.act_no = 1000;
      stru_81CD31C.act_no = 1000;
      SetDestroyNpChar(gBoss[0].x, gBoss[0].y, gBoss[0].view.back, 40);
    }
    if ( ++gBoss[0].act_wait > 100 )
      gBoss[0].act_no = 1010;
    v2 = gBoss[0].y;
    v3 = (Random(-70, 70) << 9) + v2;
    v4 = gBoss[0].x;
    v5 = Random(-128, 128);
    SetNpChar(4, v4 + (v5 << 9), v3, 0, 0, 0, 0, 256);
    goto LABEL_82;
  }
  if ( v0 == 20 )
  {
    if ( --gBoss[0].tgt_x <= 112 )
    {
      gBoss[0].act_no = 100;
      gBoss[0].act_wait = 0;
      stru_81CD118.act_no = 100;
      stru_81CD270.act_no = 100;
      stru_81CD1C4.act_no = 100;
      stru_81CD31C.act_no = 100;
    }
  }
  else if ( v0 > 20 )
  {
    if ( v0 == 100 )
    {
      if ( ++gBoss[0].act_wait > 99 )
      {
        if ( gBoss[0].act_wait > 119 )
        {
          if ( gBoss[0].act_wait >= gBoss[0].count2 )
          {
            if ( gBoss[0].act_wait >= gBoss[0].count2 + 40 )
            {
              if ( gBoss[0].act_wait >= gBoss[0].count2 + 60 )
              {
                gBoss[0].act_wait = 0;
                gBoss[0].act_no = 110;
                gBoss[0].count2 = Random(400, 700);
                goto LABEL_82;
              }
              ++gBoss[0].count1;
            }
            else
            {
              gBoss[0].count1 += 2;
            }
          }
          else
          {
            gBoss[0].count1 += 4;
          }
        }
        else
        {
          gBoss[0].count1 += 2;
        }
      }
      else
      {
        ++gBoss[0].count1;
      }
      if ( gBoss[0].count1 > 1023 )
        gBoss[0].count1 -= 1024;
    }
    else
    {
      if ( v0 != 110 )
        goto LABEL_82;
      if ( ++gBoss[0].act_wait > 19 )
      {
        if ( gBoss[0].act_wait > 59 )
        {
          if ( gBoss[0].act_wait >= gBoss[0].count2 )
          {
            if ( gBoss[0].act_wait >= gBoss[0].count2 + 40 )
            {
              if ( gBoss[0].act_wait >= gBoss[0].count2 + 60 )
              {
                if ( gBoss[0].life > 299 )
                {
                  gBoss[0].act_wait = 0;
                  gBoss[0].act_no = 100;
                  gBoss[0].count2 = Random(400, 700);
                }
                else
                {
                  gBoss[0].act_wait = 0;
                  gBoss[0].act_no = 400;
                  stru_81CD118.act_no = 400;
                  stru_81CD270.act_no = 400;
                }
                goto LABEL_82;
              }
              --gBoss[0].count1;
            }
            else
            {
              gBoss[0].count1 -= 2;
            }
          }
          else
          {
            gBoss[0].count1 -= 4;
          }
        }
        else
        {
          gBoss[0].count1 -= 2;
        }
      }
      else
      {
        --gBoss[0].count1;
      }
      if ( gBoss[0].count1 <= 0 )
        gBoss[0].count1 += 1024;
    }
  }
  else if ( !v0 )
  {
    gBoss[0].cond = -128;
    gBoss[0].direct = 0;
    gBoss[0].act_no = 10;
    gBoss[0].exp = 0;
    gBoss[0].x = 81920;
    gBoss[0].y = 0x10000;
    gBoss[0].view.front = 4096;
    gBoss[0].view.top = 4096;
    gBoss[0].view.back = 0x10000;
    gBoss[0].view.bottom = 4096;
    gBoss[0].hit_voice = 54;
    gBoss[0].hit.front = 4096;
    gBoss[0].hit.top = 4096;
    gBoss[0].hit.back = 4096;
    gBoss[0].hit.bottom = 4096;
    gBoss[0].bits = 8;
    v1 = gBoss[0].bits;
    HIBYTE(v1) |= 2u;
    gBoss[0].bits = v1;
    gBoss[0].size = 3;
    gBoss[0].damage = 0;
    gBoss[0].code_event = 1000;
    gBoss[0].life = 500;
    gBoss[0].count2 = Random(700, 1200);
    gBoss[0].tgt_x = 180;
    gBoss[0].tgt_y = 61;
    stru_81CD118.view.back = 10240;
    stru_81CD118.view.front = 10240;
    stru_81CD118.view.top = 0x2000;
    stru_81CD118.view.bottom = 0x2000;
    stru_81CD118.hit.back = 6144;
    stru_81CD118.hit.front = 6144;
    stru_81CD118.hit.top = 5120;
    stru_81CD118.hit.bottom = 5120;
    stru_81CD118.bits = 12;
    stru_81CD118.pNpc = &stru_81CD1C4;
    stru_81CD118.cond = -112;
    stru_81CD118.damage = 10;
    stru_81CD1C4.cond = -128;
    stru_81CD1C4.view.back = 10240;
    stru_81CD1C4.view.front = 10240;
    stru_81CD1C4.view.top = 10240;
    stru_81CD1C4.view.bottom = 10240;
    stru_81CD1C4.hit.back = 6144;
    stru_81CD1C4.hit.front = 6144;
    stru_81CD1C4.hit.top = 1024;
    stru_81CD1C4.hit.bottom = 0x2000;
    stru_81CD1C4.bits = 8;
    stru_81CD1C4.pNpc = gBoss;
    stru_81CD1C4.damage = 10;
    qmemcpy(&stru_81CD270, &stru_81CD118, sizeof(stru_81CD270));
    stru_81CD270.pNpc = &stru_81CD31C;
    qmemcpy(&stru_81CD31C, &stru_81CD1C4, sizeof(stru_81CD31C));
    stru_81CD31C.count1 = 128;
  }
LABEL_82:
  ActBossCharT_DragonHead(&stru_81CD118);
  ActBossCharT_DragonBody(&stru_81CD1C4);
  ActBossCharT_DragonHead(&stru_81CD270);
  ActBossCharT_DragonBody(&stru_81CD31C);
  gBoss[0].rect.left = 0;
  gBoss[0].rect.top = 0;
  gBoss[0].rect.right = 0;
  gBoss[0].rect.bottom = 0;
}

//----- (080A6BC0) --------------------------------------------------------
void __cdecl ActNpc120(NPCHAR_0 *npc)
{
  if ( npc->direct )
  {
    npc->rect.left = 64;
    npc->rect.top = 16;
    npc->rect.right = 80;
    npc->rect.bottom = 32;
  }
  else
  {
    npc->rect.left = 64;
    npc->rect.top = 0;
    npc->rect.right = 80;
    npc->rect.bottom = 16;
  }
}

//----- (080A6C42) --------------------------------------------------------
void __cdecl ActNpc121(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT rect[3];
  char v4[8];

  rect[0].left = 0;
  rect[0].top = 0;
  rect[0].right = 16;
  rect[0].bottom = 16;
  rect[1].left = 16;
  rect[1].top = 0;
  rect[1].right = 32;
  rect[1].bottom = 16;
  rect[2].left = 112;
  rect[2].top = 0;
  rect[2].right = 128;
  rect[2].bottom = 16;
  if ( !npc->direct )
  {
    v1 = npc->act_no;
    if ( v1 != 1 )
    {
      if ( v1 == 2 )
      {
        if ( ++npc->act_wait > 8 )
        {
          npc->act_no = 1;
          npc->ani_no = 0;
        }
        goto LABEL_10;
      }
      if ( v1 )
      {
LABEL_10:
        v2 = (Sint32 *)&v4[16 * npc->ani_no - 48];
        npc->rect.left = *v2;
        npc->rect.top = v2[1];
        npc->rect.right = v2[2];
        npc->rect.bottom = v2[3];
        return;
      }
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
    }
    if ( Random(0, 120) == 10 )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
      npc->ani_no = 1;
    }
    goto LABEL_10;
  }
  npc->rect.left = rect[2].left;
  npc->rect.top = rect[2].top;
  npc->rect.right = rect[2].right;
  npc->rect.bottom = rect[2].bottom;
  if ( ++npc->act_wait > 100 )
  {
    npc->act_wait = 0;
    SetCaret(npc->x, npc->y, 5, 0);
  }
}


//----- (080A6DE6) --------------------------------------------------------
void __cdecl ActNpc122(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[10];
  RECT rcLeft[10];
  char v6[24];

  qmemcpy(rcLeft, &ActNpc122(NPCHAR *)::C.1, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc122(NPCHAR *)::C.2, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( Random(0, 120) == 10 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      if ( npc->x - 0x4000 < x && npc->x + 0x4000 > x && npc->y - 0x4000 < y && npc->y + 0x2000 > y )
      {
        if ( npc->x <= x )
          npc->direct = 2;
        else
          npc->direct = 0;
      }
      break;
    case 2:
      if ( ++npc->act_wait > 8 )
      {
        npc->act_no = 1;
        npc->ani_no = 0;
      }
      break;
    case 0xA:
      npc->life = 1000;
      npc->act_no = 11;
      npc->act_wait = Random(0, 50);
      npc->ani_no = 0;
      npc->damage = 0;
      goto LABEL_15;
    case 0xB:
LABEL_15:
      if ( npc->act_wait )
        --npc->act_wait;
      else
        npc->act_no = 13;
      break;
    case 0xD:
      npc->act_no = 14;
      npc->act_wait = Random(0, 50);
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
      goto LABEL_21;
    case 0xE:
LABEL_21:
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 5 )
        npc->ani_no = 2;
      if ( npc->direct )
        v1 = npc->xm + 64;
      else
        v1 = npc->xm - 64;
      npc->xm = v1;
      if ( npc->act_wait )
      {
        --npc->act_wait;
      }
      else
      {
        npc->bits |= 0x20u;
        npc->act_no = 15;
        npc->ani_no = 2;
        npc->ym = -512;
        npc->damage = 2;
      }
      break;
    case 0xF:
      if ( npc->flag & 8 )
      {
        npc->bits |= 0x20u;
        npc->xm = 0;
        npc->act_no = 10;
        npc->damage = 0;
      }
      break;
    case 0x14:
      if ( npc->flag & 8 )
      {
        npc->xm = 0;
        npc->act_no = 21;
        npc->damage = 0;
        if ( npc->ani_no == 6 )
          npc->ani_no = 8;
        else
          npc->ani_no = 9;
        npc->act_wait = Random(300, 400);
      }
      break;
    case 0x15:
      if ( npc->act_wait )
      {
        --npc->act_wait;
      }
      else
      {
        npc->bits |= 0x20u;
        npc->life = 1000;
        npc->act_no = 11;
        npc->act_wait = Random(0, 50);
        npc->ani_no = 0;
      }
      break;
    default:
      break;
  }
  if ( npc->act_no > 10 && npc->act_no <= 19 && npc->life != 1000 )
  {
    npc->act_no = 20;
    npc->ym = -512;
    npc->ani_no = Random(6, 7);
    npc->bits &= 0xFFDFu;
  }
  npc->ym += 32;
  if ( npc->xm > 511 )
    npc->xm = 511;
  if ( npc->xm < -511 )
    npc->xm = -511;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->y += npc->ym;
  npc->x += npc->xm;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 320];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 160];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (080A7373) --------------------------------------------------------
void __cdecl ActNpc123(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  Sint32 *v4;
  RECT rect[4];
  bool bBreak;
  char v7[8];

  rect[0].left = 192;
  rect[0].top = 0;
  rect[0].right = 208;
  rect[0].bottom = 16;
  rect[1].left = 208;
  rect[1].top = 0;
  rect[1].right = 224;
  rect[1].bottom = 16;
  rect[2].left = 224;
  rect[2].top = 0;
  rect[2].right = 240;
  rect[2].bottom = 16;
  rect[3].left = 240;
  rect[3].top = 0;
  rect[3].right = 256;
  rect[3].bottom = 16;
  bBreak = 0;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 == 1 )
    {
      v3 = npc->direct;
      if ( v3 == 1 )
      {
        if ( npc->flag & 2 )
          bBreak = 1;
      }
      else if ( v3 > 1 )
      {
        if ( v3 == 2 )
        {
          if ( npc->flag & 4 )
            bBreak = 1;
        }
        else if ( v3 == 3 && npc->flag & 8 )
        {
          bBreak = 1;
        }
      }
      else if ( !v3 && npc->flag & 1 )
      {
        bBreak = 1;
      }
      npc->x += npc->xm;
      npc->y += npc->ym;
    }
  }
  else
  {
    npc->act_no = 1;
    SetCaret(npc->x, npc->y, 3, 0);
    PlaySoundObject(32, 1);
    v2 = npc->direct;
    if ( v2 == 1 )
    {
      npc->ym = -4096;
      npc->xm = Random(-128, 128);
    }
    else if ( v2 > 1 )
    {
      if ( v2 == 2 )
      {
        npc->xm = 4096;
        npc->ym = Random(-128, 128);
      }
      else if ( v2 == 3 )
      {
        npc->ym = 4096;
        npc->xm = Random(-128, 128);
      }
    }
    else if ( !v2 )
    {
      npc->xm = -4096;
      npc->ym = Random(-128, 128);
    }
  }
  if ( bBreak )
  {
    SetCaret(npc->x, npc->y, 2, 2);
    PlaySoundObject(28, 1);
    npc->cond = 0;
  }
  v4 = (Sint32 *)&v7[16 * npc->direct - 68];
  npc->rect.left = *v4;
  npc->rect.top = v4[1];
  npc->rect.right = v4[2];
  npc->rect.bottom = v4[3];
}


//----- (080A7626) --------------------------------------------------------
void __cdecl ActNpc124(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  Sint32 *v3;
  RECT rect[2];
  char v5[8];

  rect[0].left = 160;
  rect[0].top = 0;
  rect[0].right = 192;
  rect[0].bottom = 32;
  rect[1].left = 192;
  rect[1].top = 0;
  rect[1].right = 224;
  rect[1].bottom = 32;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_9:
    npc->bits &= 0xFFF7u;
    npc->ani_no = 0;
    goto LABEL_25;
  }
  if ( v1 <= 1 )
  {
    if ( v1 )
      goto LABEL_25;
    npc->act_no = 1;
    npc->x += 4096;
    npc->y += 4096;
    goto LABEL_9;
  }
  if ( v1 == 10 )
  {
    npc->act_no = 11;
    npc->ani_no = 1;
    npc->act_wait = 0;
    npc->bits |= 8u;
  }
  else if ( v1 != 11 )
  {
    goto LABEL_25;
  }
  v2 = npc->direct;
  if ( v2 == 1 )
  {
    npc->y -= 128;
  }
  else if ( v2 > 1 )
  {
    if ( v2 == 2 )
    {
      npc->x += 128;
    }
    else if ( v2 == 3 )
    {
      npc->y += 128;
    }
  }
  else if ( !v2 )
  {
    npc->x -= 128;
  }
  if ( !(++npc->act_wait & 7) )
    PlaySoundObject(26, 1);
  SetQuake(20);
LABEL_25:
  v3 = (Sint32 *)&v5[16 * npc->ani_no - 32];
  npc->rect.left = *v3;
  npc->rect.top = v3[1];
  npc->rect.right = v3[2];
  npc->rect.bottom = v3[3];
}


//----- (080A77E5) --------------------------------------------------------
void __cdecl ActNpc125(NPCHAR_0 *npc)
{
  if ( npc->life <= 989 )
  {
    SetDestroyNpChar(npc->x, npc->y, npc->view.back, 8);
    PlaySoundObject(70, 1);
    if ( npc->direct )
      SetNpChar(86, npc->x, npc->y, 0, 0, 2, 0, 0);
    else
      SetNpChar(87, npc->x, npc->y, 0, 0, 2, 0, 0);
    npc->cond = 0;
  }
  if ( npc->direct )
  {
    npc->rect.left = 16;
    npc->rect.top = 96;
    npc->rect.right = 32;
  }
  else
  {
    npc->rect.left = 0;
    npc->rect.top = 96;
    npc->rect.right = 16;
  }
  npc->rect.bottom = 112;
}

//----- (080A795B) --------------------------------------------------------
void __cdecl ActNpc126(NPCHAR_0 *npc)
{
  int v1;
  unsigned __int16 v2;
  NPCHAR_0 *v3;
  Sint32 *v4;
  RECT rcRight[6];
  RECT rcLeft[6];
  char v7[24];

  qmemcpy(rcLeft, &ActNpc126(NPCHAR *)::C.4, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc126(NPCHAR *)::C.5, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( Random(0, 120) == 10 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      if ( npc->x - 49152 < x && npc->x + 49152 > x && npc->y - 0x4000 < y && npc->y + 0x2000 > y )
      {
        if ( npc->x <= x )
          npc->direct = 2;
        else
          npc->direct = 0;
      }
      if ( npc->x - 0x4000 < x && npc->x + 0x4000 > x && npc->y - 0x4000 < y && npc->y + 0x2000 > y )
      {
        if ( npc->x <= x )
          npc->direct = 0;
        else
          npc->direct = 2;
        npc->act_no = 10;
      }
      break;
    case 2:
      if ( ++npc->act_wait > 8 )
      {
        npc->act_no = 1;
        npc->ani_no = 0;
      }
      break;
    case 0xA:
      npc->act_no = 11;
      npc->ani_no = 4;
      npc->ani_wait = 0;
      goto LABEL_23;
    case 0xB:
LABEL_23:
      if ( npc->flag & 8 )
      {
        if ( ++npc->ani_wait > 2 )
        {
          npc->ani_wait = 0;
          ++npc->ani_no;
        }
        if ( npc->ani_no > 5 )
          npc->ani_no = 4;
      }
      else
      {
        npc->ani_no = 5;
        npc->ani_wait = 0;
      }
      if ( npc->xm < 0 && npc->flag & 1 )
      {
        npc->xm /= -2;
        npc->direct = 2;
      }
      if ( npc->xm > 0 && npc->flag & 4 )
      {
        npc->xm /= -2;
        npc->direct = 0;
      }
      if ( npc->direct )
        v1 = npc->xm + 64;
      else
        v1 = npc->xm - 64;
      npc->xm = v1;
      if ( npc->xm > 1535 )
        npc->xm = 1024;
      if ( npc->xm < -1535 )
        npc->xm = -1024;
      break;
    default:
      break;
  }
  if ( gKeyTrg & gKeyDown )
  {
    v2 = npc->bits;
    HIBYTE(v2) |= 0x20u;
  }
  else
  {
    v2 = npc->bits;
    HIBYTE(v2) &= 0xDFu;
  }
  npc->bits = v2;
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v3 = npc;
    v4 = (Sint32 *)&v7[16 * npc->ani_no - 192];
  }
  else
  {
    v3 = npc;
    v4 = (Sint32 *)&v7[16 * npc->ani_no - 96];
  }
  npc->rect.left = *v4;
  v3->rect.top = v4[1];
  v3->rect.right = v4[2];
  v3->rect.bottom = v4[3];
}


//----- (080A7DB0) --------------------------------------------------------
void __cdecl ActNpc127(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  RECT *v2;
  RECT rcH[3];
  RECT rcV[3];

  rcV[0].left = 112;
  rcV[0].top = 48;
  rcV[0].right = 128;
  rcV[0].bottom = 64;
  rcV[1].left = 112;
  rcV[1].top = 64;
  rcV[1].right = 128;
  rcV[1].bottom = 80;
  rcV[2].left = 112;
  rcV[2].top = 80;
  rcV[2].right = 128;
  rcV[2].bottom = 96;
  rcH[0].left = 64;
  rcH[0].top = 80;
  rcH[0].right = 80;
  rcH[0].bottom = 96;
  rcH[1].left = 80;
  rcH[1].top = 80;
  rcH[1].right = 96;
  rcH[1].bottom = 96;
  rcH[2].left = 96;
  rcH[2].top = 80;
  rcH[2].right = 112;
  rcH[2].bottom = 96;
  if ( ++npc->ani_wait > 0 )
  {
    npc->ani_wait = 0;
    if ( ++npc->ani_no > 2 )
      npc->cond = 0;
  }
  if ( npc->direct )
  {
    v1 = npc;
    v2 = &rcV[npc->ani_no];
  }
  else
  {
    v1 = npc;
    v2 = &rcH[npc->ani_no];
  }
  npc->rect.left = v2->left;
  v1->rect.top = v2->top;
  v1->rect.right = v2->right;
  v1->rect.bottom = v2->bottom;
}

//----- (080A7F03) --------------------------------------------------------
void __cdecl ActNpc128(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  Sint32 *v3;
  Sint32 *v4;
  Sint32 *v5;
  RECT rcDown[5];
  RECT rcUp[5];
  RECT rcRight[5];
  RECT rcLeft[5];
  char v10[12];

  qmemcpy(rcLeft, &ActNpc128(NPCHAR *)::C.9, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc128(NPCHAR *)::C.10, sizeof(rcRight));
  qmemcpy(rcUp, &ActNpc128(NPCHAR *)::C.11, sizeof(rcUp));
  qmemcpy(rcDown, &ActNpc128(NPCHAR *)::C.12, sizeof(rcDown));
  if ( !npc->act_no )
  {
    npc->act_no = 1;
    if ( npc->direct && npc->direct != 2 )
    {
      npc->view.front = 4096;
      npc->view.top = 2048;
    }
    else
    {
      npc->view.front = 2048;
      npc->view.top = 4096;
    }
  }
  if ( ++npc->ani_no > 4 )
    npc->cond = 0;
  v1 = npc->direct;
  if ( v1 == 1 )
  {
    v3 = (Sint32 *)&v10[16 * npc->ani_no - 240];
    npc->rect.left = *v3;
    npc->rect.top = v3[1];
    npc->rect.right = v3[2];
    npc->rect.bottom = v3[3];
  }
  else if ( v1 > 1 )
  {
    if ( v1 == 2 )
    {
      v4 = (Sint32 *)&v10[16 * npc->ani_no - 160];
      npc->rect.left = *v4;
      npc->rect.top = v4[1];
      npc->rect.right = v4[2];
      npc->rect.bottom = v4[3];
    }
    else if ( v1 == 3 )
    {
      v5 = (Sint32 *)&v10[16 * npc->ani_no - 320];
      npc->rect.left = *v5;
      npc->rect.top = v5[1];
      npc->rect.right = v5[2];
      npc->rect.bottom = v5[3];
    }
  }
  else if ( !v1 )
  {
    v2 = (Sint32 *)&v10[16 * npc->ani_no - 80];
    npc->rect.left = *v2;
    npc->rect.top = v2[1];
    npc->rect.right = v2[2];
    npc->rect.bottom = v2[3];
  }
}


//----- (080A80E4) --------------------------------------------------------
void __cdecl ActNpc129(NPCHAR_0 *npc)
{
  Sint32 *v1;
  RECT rect[18];
  char v3[12];

  qmemcpy(rect, &ActNpc129(NPCHAR *)::C.13, sizeof(rect));
  if ( ++npc->ani_wait > 1 )
  {
    npc->ani_wait = 0;
    if ( ++npc->ani_no > 2 )
      npc->cond = 0;
  }
  npc->y += npc->ym;
  v1 = (Sint32 *)&v3[16 * (npc->ani_no + 3 * npc->direct) - 288];
  npc->rect.left = *v1;
  npc->rect.top = v1[1];
  npc->rect.right = v1[2];
  npc->rect.bottom = v1[3];
}


//----- (080A81A9) --------------------------------------------------------
void __cdecl ActNpc130(NPCHAR_0 *npc)
{
  int v1;
  unsigned __int16 v2;
  NPCHAR_0 *v3;
  Sint32 *v4;
  RECT rcRight[4];
  RECT rcLeft[4];
  char v7[8];

  rcLeft[0].left = 48;
  rcLeft[0].top = 144;
  rcLeft[0].right = 64;
  rcLeft[0].bottom = 160;
  rcLeft[1].left = 64;
  rcLeft[1].top = 144;
  rcLeft[1].right = 80;
  rcLeft[1].bottom = 160;
  rcLeft[2].left = 48;
  rcLeft[2].top = 144;
  rcLeft[2].right = 64;
  rcLeft[2].bottom = 160;
  rcLeft[3].left = 80;
  rcLeft[3].top = 144;
  rcLeft[3].right = 96;
  rcLeft[3].bottom = 160;
  rcRight[0].left = 48;
  rcRight[0].top = 160;
  rcRight[0].right = 64;
  rcRight[0].bottom = 176;
  rcRight[1].left = 64;
  rcRight[1].top = 160;
  rcRight[1].right = 80;
  rcRight[1].bottom = 176;
  rcRight[2].left = 48;
  rcRight[2].top = 160;
  rcRight[2].right = 64;
  rcRight[2].bottom = 176;
  rcRight[3].left = 80;
  rcRight[3].top = 160;
  rcRight[3].right = 96;
  rcRight[3].bottom = 176;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    if ( Random(0, 120) == 10 )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
      npc->ani_no = 1;
    }
    if ( npc->x - 0x8000 < x && npc->x + 0x8000 > x && npc->y - 0x4000 < y && npc->y + 0x2000 > y )
    {
      if ( ++npc->ani_wait > 3 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 3 )
        npc->ani_no = 2;
    }
    if ( npc->x - 49152 < x && npc->x + 49152 > x && npc->y - 0x4000 < y && npc->y + 0x2000 > y )
    {
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
    }
    goto LABEL_24;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_24;
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->ani_wait = 0;
    v2 = npc->bits;
    HIBYTE(v2) |= 0x20u;
    npc->bits = v2;
    goto LABEL_5;
  }
  if ( ++npc->act_wait > 8 )
  {
    npc->act_no = 1;
    npc->ani_no = 0;
  }
LABEL_24:
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v3 = npc;
    v4 = (Sint32 *)&v7[16 * npc->ani_no - 128];
  }
  else
  {
    v3 = npc;
    v4 = (Sint32 *)&v7[16 * npc->ani_no - 64];
  }
  npc->rect.left = *v4;
  v3->rect.top = v4[1];
  v3->rect.right = v4[2];
  v3->rect.bottom = v4[3];
}


//----- (080A8532) --------------------------------------------------------
void __cdecl ActNpc131(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  Sint32 *v2;
  RECT rcRight[1];
  RECT rcLeft[1];
  char v5[8];

  rcLeft[0].left = 144;
  rcLeft[0].top = 144;
  rcLeft[0].right = 160;
  rcLeft[0].bottom = 160;
  rcRight[0].left = 144;
  rcRight[0].top = 160;
  rcRight[0].right = 160;
  rcRight[0].bottom = 176;
  if ( ++npc->act_wait > 100 )
  {
    npc->act_wait = 0;
    SetCaret(npc->x, npc->y, 5, 0);
  }
  if ( npc->direct )
  {
    v1 = npc;
    v2 = (Sint32 *)&v5[16 * npc->ani_no - 32];
  }
  else
  {
    v1 = npc;
    v2 = (Sint32 *)&v5[16 * npc->ani_no - 16];
  }
  npc->rect.left = *v2;
  v1->rect.top = v2[1];
  v1->rect.right = v2[2];
  v1->rect.bottom = v2[3];
}


//----- (080A8622) --------------------------------------------------------
void __cdecl ActNpc132(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[5];
  RECT rcLeft[5];
  char v6[24];

  qmemcpy(rcLeft, &ActNpc132(NPCHAR *)::C.15, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc132(NPCHAR *)::C.16, sizeof(rcRight));
  if ( npc->act_no <= 99 )
  {
    if ( x >= npc->x )
      npc->direct = 2;
    else
      npc->direct = 0;
  }
  v1 = npc->act_no;
  if ( v1 == 11 )
  {
LABEL_41:
    if ( Random(0, 120) == 10 )
    {
      npc->act_no = 12;
      npc->act_wait = 0;
      npc->ani_no = 1;
    }
    goto LABEL_56;
  }
  if ( v1 > 11 )
  {
    if ( v1 == 100 )
    {
      npc->act_no = 101;
      npc->count1 = 0;
    }
    else
    {
      if ( v1 <= 100 )
      {
        if ( v1 == 12 && ++npc->act_wait > 8 )
        {
          npc->act_no = 11;
          npc->ani_no = 0;
        }
        goto LABEL_56;
      }
      if ( v1 != 101 )
      {
        if ( v1 == 120 )
          npc->ani_no = 0;
        goto LABEL_56;
      }
    }
    if ( ++npc->ani_wait > 4 )
    {
      npc->ani_wait = 0;
      ++npc->ani_no;
    }
    if ( npc->ani_no > 4 )
    {
      if ( npc->count1 > 2 )
      {
        npc->ani_no = 0;
        npc->count1 = 0;
      }
      else
      {
        npc->ani_no = 2;
        ++npc->count1;
      }
    }
    if ( npc->ani_no == 4 && !npc->ani_wait )
      PlaySoundObject(105, 1);
  }
  else
  {
    if ( v1 == 1 )
    {
LABEL_22:
      if ( Random(0, 120) == 10 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      if ( npc->x - 0x8000 >= x || npc->x + 0x8000 <= x || npc->y - 0x2000 >= y || npc->y + 0x2000 <= y )
      {
        if ( npc->ani_no == 4 )
          npc->ani_no = 2;
      }
      else
      {
        if ( ++npc->ani_wait > 4 )
        {
          npc->ani_wait = 0;
          ++npc->ani_no;
        }
        if ( npc->ani_no > 4 )
          npc->ani_no = 2;
        if ( npc->ani_no == 4 && !npc->ani_wait )
          PlaySoundObject(105, 1);
      }
      goto LABEL_56;
    }
    if ( v1 <= 1 )
    {
      if ( v1 )
        goto LABEL_56;
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      goto LABEL_22;
    }
    if ( v1 != 2 )
    {
      if ( v1 != 10 )
        goto LABEL_56;
      npc->act_no = 11;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      goto LABEL_41;
    }
    if ( ++npc->act_wait > 8 )
    {
      npc->act_no = 1;
      npc->ani_no = 0;
    }
  }
LABEL_56:
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 160];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 80];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (080A8AB0) --------------------------------------------------------
void __cdecl ActNpc133(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[2];
  RECT rcLeft[2];
  char v6[8];

  rcLeft[0].left = 176;
  rcLeft[0].top = 32;
  rcLeft[0].right = 192;
  rcLeft[0].bottom = 48;
  rcLeft[1].left = 192;
  rcLeft[1].top = 32;
  rcLeft[1].right = 208;
  rcLeft[1].bottom = 48;
  rcRight[0].left = 176;
  rcRight[0].top = 48;
  rcRight[0].right = 192;
  rcRight[0].bottom = 64;
  rcRight[1].left = 192;
  rcRight[1].top = 48;
  rcRight[1].right = 208;
  rcRight[1].bottom = 64;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    if ( Random(0, 120) == 10 )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
      npc->ani_no = 1;
    }
    goto LABEL_9;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_9;
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->ani_wait = 0;
    goto LABEL_5;
  }
  if ( ++npc->act_wait > 8 )
  {
    npc->act_no = 1;
    npc->ani_no = 0;
  }
LABEL_9:
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 64];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 32];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (080A8C31) --------------------------------------------------------
void __cdecl ActNpc134(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  NPCHAR_0 *v3;
  Sint32 *v4;
  RECT rcRight[3];
  RECT rcLeft[3];
  char v7[8];

  rcLeft[0].left = 224;
  rcLeft[0].top = 0;
  rcLeft[0].right = 256;
  rcLeft[0].bottom = 16;
  rcLeft[1].left = 256;
  rcLeft[1].top = 0;
  rcLeft[1].right = 288;
  rcLeft[1].bottom = 16;
  rcLeft[2].left = 288;
  rcLeft[2].top = 0;
  rcLeft[2].right = 320;
  rcLeft[2].bottom = 16;
  rcRight[0].left = 224;
  rcRight[0].top = 16;
  rcRight[0].right = 256;
  rcRight[0].bottom = 32;
  rcRight[1].left = 256;
  rcRight[1].top = 16;
  rcRight[1].right = 288;
  rcRight[1].bottom = 32;
  rcRight[2].left = 288;
  rcRight[2].top = 16;
  rcRight[2].right = 320;
  rcRight[2].bottom = 32;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_9:
    if ( x > npc->x - 163840 && x < npc->x + 163840 && y > npc->y - 81920 && y < npc->y + 0x8000 )
    {
      npc->act_no = 10;
      npc->bits |= 0x20u;
      npc->bits &= 0xFFFBu;
    }
    goto LABEL_31;
  }
  if ( v1 <= 1 )
  {
    if ( v1 )
      goto LABEL_31;
    npc->act_no = 1;
    npc->ani_no = 2;
    npc->bits &= 0xFFDFu;
    npc->bits |= 4u;
    goto LABEL_9;
  }
  if ( v1 == 10 )
  {
    if ( ++npc->ani_wait > 4 )
    {
      npc->ani_wait = 0;
      ++npc->ani_no;
    }
    if ( npc->ani_no > 1 )
      npc->ani_no = 0;
    if ( !npc->direct && npc->flag & 1 )
      npc->direct = 2;
    if ( npc->direct == 2 && npc->flag & 4 )
      npc->direct = 0;
    if ( npc->direct )
      v2 = npc->x + 256;
    else
      v2 = npc->x - 256;
    npc->x = v2;
    if ( CountArmsBullet(6) != 0 )
    {
      npc->act_no = 20;
      npc->act_wait = 0;
      npc->ani_no = 2;
      npc->bits &= 0xFFDFu;
      npc->bits |= 4u;
    }
  }
  else if ( v1 == 20 && ++npc->act_wait > 100 )
  {
    npc->act_no = 10;
    npc->ani_no = 0;
    npc->ani_wait = 0;
    npc->bits |= 0x20u;
    npc->bits &= 0xFFFBu;
  }
LABEL_31:
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v3 = npc;
    v4 = (Sint32 *)&v7[16 * npc->ani_no - 96];
  }
  else
  {
    v3 = npc;
    v4 = (Sint32 *)&v7[16 * npc->ani_no - 48];
  }
  npc->rect.left = *v4;
  v3->rect.top = v4[1];
  v3->rect.right = v4[2];
  v3->rect.bottom = v4[3];
}


//----- (080A9009) --------------------------------------------------------
void __cdecl ActNpc135(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  NPCHAR_0 *v3;
  Sint32 *v4;
  RECT rcRight[2];
  RECT rcLeft[2];
  unsigned __int8 deg;
  int xm;
  int ym;
  char v10[8];

  rcLeft[0].left = 256;
  rcLeft[0].top = 32;
  rcLeft[0].right = 288;
  rcLeft[0].bottom = 64;
  rcLeft[1].left = 288;
  rcLeft[1].top = 32;
  rcLeft[1].right = 320;
  rcLeft[1].bottom = 64;
  rcRight[0].left = 256;
  rcRight[0].top = 64;
  rcRight[0].right = 288;
  rcRight[0].bottom = 96;
  rcRight[1].left = 288;
  rcRight[1].top = 64;
  rcRight[1].right = 320;
  rcRight[1].bottom = 96;
  if ( x < npc->x - 180224 || x > npc->x + 180224 || y < npc->y - 81920 || y > npc->y + 0x8000 )
    npc->act_no = 0;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->xm = 0;
      goto LABEL_8;
    case 1:
LABEL_8:
      if ( x > npc->x - 163840 && x < npc->x + 163840 && y > npc->y - 81920 && y < npc->y + 0x8000 )
        npc->act_no = 10;
      if ( npc->flag & 8 )
        npc->ani_no = 0;
      break;
    case 0xA:
      npc->xm = 0;
      npc->act_no = 11;
      npc->act_wait = 0;
      npc->ani_no = 0;
      goto LABEL_16;
    case 0xB:
LABEL_16:
      if ( ++npc->act_wait > 4 && npc->flag & 8 )
      {
        npc->act_no = 20;
        npc->ani_no = 1;
        npc->count1 = 0;
        npc->ym = -512 * Random(1, 3);
        if ( npc->shock )
        {
          if ( npc->x >= x )
            v1 = npc->xm + 256;
          else
            v1 = npc->xm - 256;
          npc->xm = v1;
        }
        else
        {
          if ( npc->x >= x )
            v2 = npc->xm - 256;
          else
            v2 = npc->xm + 256;
          npc->xm = v2;
        }
      }
      break;
    case 0x14:
      if ( npc->ym > 0 && !npc->count1 )
      {
        ++npc->count1;
        deg = GetArktan(npc->x - x, npc->y + 2048 - y);
        ym = 2 * GetSin(deg);
        xm = 2 * GetCos(deg);
        SetNpChar(50, npc->x, npc->y, xm, ym, 0, 0, 384);
        PlaySoundObject(39, 1);
      }
      if ( npc->flag & 8 )
      {
        npc->act_no = 10;
        npc->ani_no = 0;
      }
      break;
    default:
      break;
  }
  if ( npc->act_no > 9 )
  {
    if ( npc->x <= x )
      npc->direct = 2;
    else
      npc->direct = 0;
  }
  npc->ym += 51;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  if ( npc->xm > 1535 )
    npc->xm = 1535;
  if ( npc->xm < -1535 )
    npc->xm = -1535;
  npc->y += npc->ym;
  npc->x += npc->xm;
  if ( npc->direct )
  {
    v3 = npc;
    v4 = (Sint32 *)&v10[16 * npc->ani_no - 76];
  }
  else
  {
    v3 = npc;
    v4 = (Sint32 *)&v10[16 * npc->ani_no - 44];
  }
  npc->rect.left = *v4;
  v3->rect.top = v4[1];
  v3->rect.right = v4[2];
  v3->rect.bottom = v4[3];
}


//----- (080A94C0) --------------------------------------------------------
void __cdecl ActNpc136(NPCHAR_0 *npc)
{
  int v1;
  unsigned __int16 v2;
  NPCHAR_0 *v3;
  Sint32 *v4;
  RECT rcRight[2];
  RECT rcLeft[2];
  char v7[8];

  rcLeft[0].left = 48;
  rcLeft[0].top = 144;
  rcLeft[0].right = 64;
  rcLeft[0].bottom = 160;
  rcLeft[1].left = 64;
  rcLeft[1].top = 144;
  rcLeft[1].right = 80;
  rcLeft[1].bottom = 160;
  rcRight[0].left = 48;
  rcRight[0].top = 160;
  rcRight[0].right = 64;
  rcRight[0].bottom = 176;
  rcRight[1].left = 64;
  rcRight[1].top = 160;
  rcRight[1].right = 80;
  rcRight[1].bottom = 176;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    if ( Random(0, 120) == 10 )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
      npc->ani_no = 1;
    }
    goto LABEL_9;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_9;
    v2 = npc->bits;
    HIBYTE(v2) &= 0xDFu;
    npc->bits = v2;
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->ani_wait = 0;
    goto LABEL_5;
  }
  if ( ++npc->act_wait > 8 )
  {
    npc->act_no = 1;
    npc->ani_no = 0;
  }
LABEL_9:
  if ( dir )
    npc->direct = 2;
  else
    npc->direct = 0;
  npc->y = y - 5120;
  if ( npc->direct )
  {
    npc->x = x - 2048;
    v3 = npc;
    v4 = (Sint32 *)&v7[16 * npc->ani_no - 64];
  }
  else
  {
    npc->x = x + 2048;
    v3 = npc;
    v4 = (Sint32 *)&v7[16 * npc->ani_no - 32];
  }
  npc->rect.left = *v4;
  v3->rect.top = v4[1];
  v3->rect.right = v4[2];
  v3->rect.bottom = v4[3];
  if ( unk_81C85C0 & 1 )
    ++npc->rect.top;
}


//----- (080A96C1) --------------------------------------------------------
void __cdecl ActNpc137(NPCHAR_0 *npc)
{
  npc->rect.left = 96;
  npc->rect.top = 136;
  npc->rect.right = 128;
  npc->rect.bottom = 188;
}

//----- (080A9700) --------------------------------------------------------
void __cdecl ActNpc138(NPCHAR_0 *npc)
{
  int v1;
  int v2;

  v1 = npc->act_no;
  if ( v1 != 1 )
  {
    if ( v1 > 1 )
    {
      if ( v1 == 10 )
      {
        npc->act_no = 11;
        npc->ani_no = 1;
        npc->act_wait = 0;
        npc->bits |= 8u;
      }
      else if ( v1 != 11 )
      {
        return;
      }
      if ( !(++npc->act_wait & 7) )
        PlaySoundObject(26, 1);
      if ( npc->direct )
      {
        npc->x = (npc->act_wait / 8 << 9) + npc->tgt_x;
        npc->rect.left = 112;
        npc->rect.top = 112;
        npc->rect.right = 128;
        npc->rect.bottom = 136;
        npc->rect.right -= npc->act_wait / 8;
      }
      else
      {
        npc->rect.left = 96;
        npc->rect.top = 112;
        npc->rect.right = 112;
        npc->rect.bottom = 136;
        npc->rect.left += npc->act_wait / 8;
      }
      if ( npc->act_wait == 104 )
        npc->cond = 0;
    }
    else if ( !v1 )
    {
      npc->act_no = 1;
      if ( npc->direct )
      {
        npc->rect.left = 112;
        npc->rect.top = 112;
        npc->rect.right = 128;
        npc->rect.bottom = 136;
        v2 = npc->x - 4096;
      }
      else
      {
        npc->rect.left = 96;
        npc->rect.top = 112;
        npc->rect.right = 112;
        npc->rect.bottom = 136;
        v2 = npc->x + 4096;
      }
      npc->x = v2;
      npc->tgt_x = npc->x;
    }
  }
}

//----- (080A9915) --------------------------------------------------------
void __cdecl ActNpc139(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[3];
  RECT rcLeft[3];
  char v6[8];

  rcLeft[0].left = 0;
  rcLeft[0].top = 128;
  rcLeft[0].right = 24;
  rcLeft[0].bottom = 160;
  rcLeft[1].left = 24;
  rcLeft[1].top = 128;
  rcLeft[1].right = 48;
  rcLeft[1].bottom = 160;
  rcLeft[2].left = 48;
  rcLeft[2].top = 128;
  rcLeft[2].right = 72;
  rcLeft[2].bottom = 160;
  rcRight[0].left = 0;
  rcRight[0].top = 160;
  rcRight[0].right = 24;
  rcRight[0].bottom = 192;
  rcRight[1].left = 24;
  rcRight[1].top = 160;
  rcRight[1].right = 48;
  rcRight[1].bottom = 192;
  rcRight[2].left = 48;
  rcRight[2].top = 160;
  rcRight[2].right = 72;
  rcRight[2].bottom = 192;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->xm = 0;
      npc->ym = 0;
      npc->y -= 4096;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( npc->flag & 8 )
        npc->ani_no = 0;
      else
        npc->ani_no = 2;
      npc->ym += 64;
      break;
    case 0xA:
      npc->act_no = 11;
      npc->ani_no = 1;
      npc->ani_wait = 0;
      npc->count1 = 0;
      goto LABEL_8;
    case 0xB:
LABEL_8:
      if ( ++npc->ani_wait > 6 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 1 )
      {
        npc->ani_no = 0;
        ++npc->count1;
      }
      if ( npc->count1 > 8 )
      {
        npc->ani_no = 0;
        npc->act_no = 1;
      }
      break;
    case 0x14:
      npc->act_no = 21;
      npc->act_wait = 0;
      npc->ani_no = 2;
      npc->tgt_y = npc->y - 0x4000;
      goto LABEL_15;
    case 0x15:
LABEL_15:
      if ( npc->y >= npc->tgt_y )
        v1 = npc->ym - 32;
      else
        v1 = npc->ym + 32;
      npc->ym = v1;
      if ( npc->ym > 512 )
        npc->ym = 512;
      if ( npc->ym < -512 )
        npc->ym = -512;
      break;
    case 0x1E:
      npc->act_no = 31;
      npc->xm = 0;
      npc->ym = 0;
      npc->act_wait = 2 * (npc->rect.bottom - npc->rect.top);
      PlaySoundObject(29, 1);
      goto LABEL_23;
    case 0x1F:
LABEL_23:
      --npc->act_wait;
      npc->ani_no = 0;
      if ( !npc->act_wait )
        npc->cond = 0;
      break;
    case 0x28:
      npc->act_no = 41;
      npc->act_wait = 0;
      npc->xm = 0;
      npc->ym = 0;
      PlaySoundObject(29, 1);
      goto LABEL_26;
    case 0x29:
LABEL_26:
      npc->ani_no = 2;
      if ( ++npc->act_wait > 63 )
        npc->act_no = 20;
      break;
    default:
      break;
  }
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 96];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 48];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
  if ( npc->act_no == 31 || npc->act_no == 41 )
  {
    npc->rect.bottom = npc->act_wait / 2 + npc->rect.top;
    if ( npc->act_wait / 2 & 1 )
      ++npc->rect.left;
  }
}


//----- (080A9D54) --------------------------------------------------------
int __cdecl _interpolate($8D9359E30B30BEB685C90F8A0F30C069 *chan, bool left)
{
  int v2;

  if ( left )
    v2 = chan->data->lvol;
  else
    v2 = chan->data->rvol;
  return (unsigned __int16)((signed __int16)((signed __int16)(((unsigned __int16)(1024 - chan->pos_comma)
                                                             * (signed __int16)((chan->data->buf[chan->pos] - 128) << 7)
                                                             + (signed __int16)((chan->data->buf[(chan->pos + 2)
                                                                                               % chan->data->len]
                                                                               - 128) << 7)
                                                             * chan->pos_comma) >> 10)
                                           * chan->data->vol >> 10)
                          * v2 >> 8);
}

//----- (080A9E4B) --------------------------------------------------------
void __cdecl _advance($8D9359E30B30BEB685C90F8A0F30C069 *chan)
{
  Uint16 freq;

  freq = chan->data->freq;
  chan->pos += (unsigned __int8)((signed int)freq >> 10);
  chan->pos_comma += freq & 0x3FF;
  chan->pos += (signed int)chan->pos_comma >> 10;
  chan->pos_comma &= 0x3FFu;
}

//----- (080A9EC8) --------------------------------------------------------
signed int __cdecl _checkRepeat($8D9359E30B30BEB685C90F8A0F30C069 *chan)
{
  if ( chan->pos >= chan->data->len )
  {
    if ( chan->repeat <= 0 )
    {
      if ( chan->repeat >= 0 )
      {
        chan->pos = 0;
        return 1;
      }
      chan->pos = 0;
    }
    else
    {
      --chan->repeat;
      chan->pos = 0;
    }
  }
  return 0;
}

//----- (080A9F2D) --------------------------------------------------------
void __cdecl _mix_callback(void *userdata, Uint8 *stream, int len)
{
  unsigned int v3;
  _DWORD *v4;
  Sint32 accum;
  char left;
  int i;
  unsigned int c;
  $8D9359E30B30BEB685C90F8A0F30C069 *cur_chan;

  left = 1;
  for ( i = 0; len / 2 > i; ++i )
  {
    accum = 0;
    for ( c = 0; c < mix_nextfree; ++c )
    {
      cur_chan = ($8D9359E30B30BEB685C90F8A0F30C069 *)(16 * c + 136110560);
      if ( mix_chans[c].data )
      {
        accum += (signed __int16)_interpolate(cur_chan, left);
        _advance(cur_chan);
        if ( (unsigned __int8)_checkRepeat(cur_chan) )
        {
          --mix_nextfree;
          v3 = 16 * c;
          v4 = (_DWORD *)(16 * mix_nextfree);
          mix_chans[v3 / 0x10].pos = mix_chans[mix_nextfree].pos;
          *(_DWORD *)(v3 + 136110564) = v4[34027641];
          *(_DWORD *)(v3 + 136110568) = v4[34027642];
          *(_DWORD *)(v3 + 136110572) = v4[34027643];
        }
      }
    }
    if ( accum <= 0x7FFF )
    {
      if ( accum < -32768 )
        LOWORD(accum) = -32768;
    }
    else
    {
      LOWORD(accum) = 0x7FFF;
    }
    *(_WORD *)&stream[2 * i] += accum;
    left ^= 1u;
  }
  org_mixer(userdata, stream, len);
}

//----- (080AA085) --------------------------------------------------------
void __cdecl SMixer_StopChunk($FE85C58A60403E3389C96E96D80030A8 *c)
{
  unsigned int v1;
  _DWORD *v2;
  unsigned int i;

  SDL_LockAudio();
  for ( i = 0; i < mix_nextfree; ++i )
  {
    if ( mix_chans[i].data == c )
    {
      --mix_nextfree;
      v1 = 16 * i;
      v2 = (_DWORD *)(16 * mix_nextfree);
      mix_chans[v1 / 0x10].pos = mix_chans[mix_nextfree].pos;
      *(_DWORD *)(v1 + 136110564) = v2[34027641];
      *(_DWORD *)(v1 + 136110568) = v2[34027642];
      *(_DWORD *)(v1 + 136110572) = v2[34027643];
    }
  }
  SDL_UnlockAudio();
}



//----- (080AA110) --------------------------------------------------------
void __cdecl SMixer_Reset($FE85C58A60403E3389C96E96D80030A8 *c)
{
  unsigned int i;

  SDL_LockAudio();
  for ( i = 0; i < mix_nextfree; ++i )
  {
    if ( mix_chans[i].data == c )
    {
      mix_chans[i].pos = 0;
      mix_chans[i].pos_comma = 0;
      break;
    }
  }
  SDL_UnlockAudio();
}



//----- (080AA170) --------------------------------------------------------
void __cdecl SMixer_SetVolume($FE85C58A60403E3389C96E96D80030A8 *c, Uint16 volume)
{
  SDL_LockAudio();
  c->vol = (volume << 10) / 300;
  SDL_UnlockAudio();
}



//----- (080AA1B2) --------------------------------------------------------
void __cdecl SMixer_SetPan($FE85C58A60403E3389C96E96D80030A8 *c, Uint16 pan)
{
  Sint16 lpan;
  Sint16 rpan;

  SDL_LockAudio();
  lpan = 256 - pan;
  rpan = pan - 256;
  c->lvol = 256;
  c->rvol = 256;
  if ( (signed __int16)(256 - pan) > 0 && lpan <= 255 )
    c->lvol = lpan;
  if ( rpan > 0 && rpan <= 255 )
    c->rvol = rpan;
  SDL_UnlockAudio();
}



//----- (080AA22A) --------------------------------------------------------
void __cdecl SMixer_SetFrequency($FE85C58A60403E3389C96E96D80030A8 *c, Uint32 freq)
{
  SDL_LockAudio();
  c->freq = (freq << 10) / 0x15888;
  SDL_UnlockAudio();
}



//----- (080AA25A) --------------------------------------------------------
void __cdecl SMixer_InitChunk($FE85C58A60403E3389C96E96D80030A8 *c)
{
  c->vol = 1024;
  c->lvol = 256;
  c->rvol = 256;
  c->freq = 256;
}

//----- (080AA284) --------------------------------------------------------
void __cdecl SMixer_PlayChunk($FE85C58A60403E3389C96E96D80030A8 *c, Sint32 repeat)
{
  unsigned int v2;
  unsigned int v3;
  int ch_0_4;
  unsigned int i;

  SDL_LockAudio();
  for ( i = 0; i < mix_nextfree; ++i )
  {
    if ( mix_chans[i].data == c )
    {
      mix_chans[i].repeat = repeat;
      mix_chans[i].pos = 0;
      break;
    }
  }
  if ( i == mix_nextfree )
  {
    if ( mix_nextfree > 0xFE )
      return;
    LOWORD(ch_0_4) = 0;
    v2 = mix_nextfree;
    v3 = 16 * mix_nextfree;
    mix_chans[v3 / 0x10].pos = 0;
    *(_DWORD *)(v3 + 136110564) = ch_0_4;
    *(_DWORD *)(v3 + 136110568) = repeat;
    *(_DWORD *)(v3 + 136110572) = c;
    mix_nextfree = v2 + 1;
  }
  SDL_UnlockAudio();
}



//----- (080AA34F) --------------------------------------------------------
void SMixer_FreeChunks()
{
  size_t i;

  mix_nextfree = 0;
  SDL_LockAudio();
  for ( i = 0; i <= 0x9F; ++i )
  {
    if ( chunks[i] )
    {
      free(chunks[i]->buf);
      free(chunks[i]);
      chunks[i] = 0;
    }
  }
  SDL_UnlockAudio();
}



//----- (080AA3C8) --------------------------------------------------------
void SMixer_Init()
{
  SDL_AudioSpec_0 real;
  SDL_AudioSpec_0 desiredFormat;

  desiredFormat.freq = 44100;
  desiredFormat.samples = 1024;
  desiredFormat.format = -32752;
  desiredFormat.channels = 2;
  desiredFormat.callback = _mix_callback;
  if ( SDL_OpenAudio(&desiredFormat, &real) != 0 )
    fwrite("Couldn't open audio device!\n", 1u, 0x1Cu, stderr);
  device_frequency = real.freq;
  device_format = real.format;
  device_channels = real.channels;
  if ( real.format != -32752 || device_channels != 2 )
    fwrite("Wrong device format. Mixer is broken!\n", 1u, 0x26u, stderr);
}


//----- (080AA488) --------------------------------------------------------
void SMixer_Start()
{
  SDL_PauseAudio(0);
}


//----- (080AA49C) --------------------------------------------------------
void SMixer_Quit()
{
  SDL_CloseAudio();
}


//----- (080AA4AC) --------------------------------------------------------
void PutFramePerSecound()
{
  ;
}

//----- (080AA4B1) --------------------------------------------------------
int __cdecl main(int argc, const char **argv, const char **envp)
{
  size_t v3;
  int result;
  int v5;
  int v6;
  bool v7;
  SDL_Surface_0 *v8;
  $88CD5C1514A19B01CE178CB8EAE44D15 v9;
  RECT v16;
  int v20;
  int v20_4;
  signed int v20_8;
  int v20_12;
  int v15;
  const char *anonymous1;
  int i;
  int v18;
  int v19;
  int anonymous6;
  _BOOL4 v21;

  memcpy(gModulePath, ".", 2u);
  strcpy(gDataPath, gModulePath);
  v3 = strlen(gDataPath);
  memcpy(&gDataPath[v3], "/data", 6u);
  v15 = 0x100231;
  if ( SDL_Init(0x100231) >= 0 )
  {
    if ( get_language() == 0 )
      anonymous1 = aUMaxim;
    else
      anonymous1 = "Cave Story";
    SDL_WM_SetCaption(anonymous1, anonymous1);
    if ( !LoadConfigData(&v9) )
      DefaultConfigData(&v9);
    if ( v9.attack_button_mode )
    {
      if ( v9.attack_button_mode == 1 )
      {
        gKeyJump = 32;
        gKeyShot = 64;
      }
    }
    else
    {
      gKeyJump = 64;
      gKeyShot = 32;
    }
    if ( v9.ok_button_mode )
    {
      if ( v9.ok_button_mode == 1 )
      {
        gKeyOk = gKeyShot;
        gKeyCancel = gKeyJump;
      }
    }
    else
    {
      gKeyOk = gKeyJump;
      gKeyCancel = gKeyShot;
    }
    if ( v9.move_button_mode )
    {
      if ( v9.move_button_mode == 1 )
      {
        gKeyLeft = 0x10000;
        gKeyUp = 1572864;
        gKeyRight = 0x40000;
        gKeyDown = 0x20000;
      }
    }
    else
    {
      gKeyLeft = 1;
      gKeyUp = 4;
      gKeyRight = 2;
      gKeyDown = 8;
    }
    for ( i = 0; i <= 7; ++i )
    {
      switch ( *(_DWORD *)&v9.proof[4 * (i + 28) + 4] )
      {
        case 1:
          gJoystickButtonTable[i] = gKeyJump;
          break;
        case 2:
          gJoystickButtonTable[i] = gKeyShot;
          break;
        case 3:
          gJoystickButtonTable[i] = gKeyArms;
          break;
        case 4:
          gJoystickButtonTable[i] = gKeyItem;
          break;
        case 5:
          gJoystickButtonTable[i] = gKeyMap;
          break;
        case 6:
          gJoystickButtonTable[i] = gKeyArmsRev;
          break;
        default:
          continue;
      }
    }
    v18 = 2;
    v19 = 0x10000000;
    anonymous6 = 16;
    switch ( v9.display_mode )
    {
      case 0:
        v19 |= 0x80000000;
        break;
      case 1:
        v18 = 1;
        break;
      case 3:
        v19 |= 0x80000000;
        anonymous6 = 24;
        break;
      case 4:
        v19 |= 0x80000000;
        anonymous6 = 32;
        break;
      default:
        break;
    }
    gscreen = (SDL_Surface_0 *)SDL_SetVideoMode(320 * v18, 240 * v18, anonymous6, v19);
    if ( gscreen )
    {
      if ( v19 < 0 )
        SDL_ShowCursor(0);
      StartDirectDraw(gscreen, v18);
      v20 = 0;
      v20_4 = 0;
      v20_8 = 64;
      v20_12 = 8;
      v16.left = 0;
      v16.top = 0;
      v16.right = 320;
      v16.bottom = 240;
      v21 = MakeSurface_File("Loading", 15);
      CortBox(&v16, 0);
      PutBitmap3(&v16, 128, 116, (RECT *)&v20, 15);
      if ( !Flip_SystemTask(gscreen) )
      {
        ErrorLog("Flip_SystemTask exit while loading", 0);
        SDL_Quit(v6);
        result = 1;
      }
      else
      {
        InitDirectSound();
        v7 = v9.bJoystick && InitDirectInput();
        if ( v7 )
        {
          ResetJoystickStatus();
          gbUseJoystick = 1;
        }
        InitTextObject();
        InitTriangleTable();
        Game();
        EndTextObject();
        EndDirectSound();
        v8 = gscreen;
        EndDirectDraw();
        SDL_Quit(v8);
        result = 1;
      }
    }
    else
    {
      ErrorLog("SDL_SetVideoMode failed", anonymous6);
      SDL_Quit(v5);
      result = 0;
    }
  }
  else
  {
    ErrorLog("SDL_Init failed", 0);
    result = -1;
  }
  return result;
}






//----- (080AAA16) --------------------------------------------------------
void InactiveWindow()
{
  if ( _bActive )
  {
    _bActive = 0;
    StopOrganyaMusic();
    SleepNoise();
  }
  PlaySoundObject(7, 0);
}

//----- (080AAA4E) --------------------------------------------------------
void ActiveWindow()
{
  if ( _bActive != 1 )
  {
    _bActive = 1;
    StopOrganyaMusic();
    PlayOrganyaMusic();
    ResetNoise();
  }
  PlaySoundObject(7, -1);
}

//----- (080AAA8E) --------------------------------------------------------
void JoystickProc()
{
  $CC5B0FEB395DC4593A946B3182F5E0FD status;
  int i;

  if ( !((unsigned __int8)GetJoystickStatus(&status) ^ 1) )
  {
    if ( status.bLeft )
      gKey |= gKeyLeft;
    if ( status.bRight )
      gKey |= gKeyRight;
    if ( status.bUp )
      gKey |= gKeyUp;
    if ( status.bDown )
      gKey |= gKeyDown;
    for ( i = 0; i <= 7; ++i )
    {
      if ( status.bButton[i] )
        gKey |= gJoystickButtonTable[i];
    }
  }
}

//----- (080AAB51) --------------------------------------------------------
bool __cdecl SystemTask()
{
  int key_count;
  SDL_Event_0 event;
  const Uint8 *const keys;
  size_t i;
  const SystemTask::key_mapping_t *const m;

  while ( SDL_PollEvent(&event) != 0 )
  {
    if ( event.type == 12 )
      return 0;
  }
  key_count = 0;
  keys = SDL_GetKeyState(&key_count);
  gKey = 0;
  for ( i = 0; i <= 0xE; ++i )
  {
    m = (const SystemTask::key_mapping_t *const )(8 * i + 0x814C0C0);// TODO: Decode this
    if ( keys[SystemTask(void)::mapping[i].src] )
      gKey |= m->dst;
  }
  if ( gbUseJoystick )
    JoystickProc();
  return 1;
}


//----- (080AAC00) --------------------------------------------------------
void __cdecl ChangeOrganFrequency(Uint8 key, Sint8 track, Uint32 a)
{
  __int64 v3;
  int j;
  int i;

  for ( j = 0; j <= 7; ++j )
  {
    for ( i = 0; i <= 1; ++i )
    {
      v3 = freq_tbl[key] * (signed int)oct_wave[j].wave_size * oct_wave[j].oct_par;
      SMixer_SetFrequency(orgs[0][0][2 * (8 * track + j) + i], a + ((signed int)((HIDWORD(v3) >> 29) + v3) >> 3) - 1000);
    }
  }
}

//----- (080AACD3) --------------------------------------------------------
void __cdecl ChangeOrganPan(Uint8 key, Uint8 pan, Sint8 track)
{
  if ( _old_key[track] != -1 )
    SMixer_SetPan(orgs[0][0][2 * (8 * track + _old_key[track] / 0xCu) + _key_twin[track]], _pan_tbl[pan]);
}

//----- (080AAD5C) --------------------------------------------------------
void __cdecl ChangeOrganVolume(int no, int volume, Sint8 track)
{
  if ( _old_key[track] != -1 )
    SMixer_SetVolume(orgs[0][0][2 * (8 * track + _old_key[track] / 0xCu) + _key_twin[track]], volume);
}

//----- (080AADD0) --------------------------------------------------------
void __cdecl PlayOrganObject(Uint8 key, int mode, Sint8 track, Uint32 freq)
{
  if ( orgs[0][0][2 * (8 * track + key / 0xCu) + _key_twin[track]] )
  {
    if ( mode )
    {
      if ( mode > 0 )
      {
        if ( mode != 1 && mode == 2 && _old_key[track] != -1 )
        {
          SMixer_PlayChunk(orgs[0][0][2 * (8 * track + _old_key[track] / 0xCu) + _key_twin[track]], 0);
          _old_key[track] = -1;
        }
      }
      else if ( mode == -1 )
      {
        if ( _old_key[track] == -1 )
        {
          ChangeOrganFrequency(key % 0xCu, track, freq);
          SMixer_PlayChunk(orgs[0][0][2 * (8 * track + key / 0xCu) + _key_twin[track]], -1);
          _old_key[track] = key;
          _key_on[track] = 1;
        }
        else if ( _key_on[track] != 1 || _old_key[track] != key )
        {
          SMixer_PlayChunk(orgs[0][0][2 * (8 * track + _old_key[track] / 0xCu) + _key_twin[track]], 0);
          if ( ++_key_twin[track] > 1u )
            _key_twin[track] = 0;
          ChangeOrganFrequency(key % 0xCu, track, freq);
          SMixer_PlayChunk(orgs[0][0][2 * (8 * track + key / 0xCu) + _key_twin[track]], -1);
          _old_key[track] = key;
        }
        else
        {
          SMixer_PlayChunk(orgs[0][0][2 * (8 * track + _old_key[track] / 0xCu) + _key_twin[track]], 0);
          if ( ++_key_twin[track] > 1u )
            _key_twin[track] = 0;
          SMixer_PlayChunk(orgs[0][0][2 * (8 * track + key / 0xCu) + _key_twin[track]], -1);
        }
      }
    }
    else if ( _old_key[track] != -1 )
    {
      SMixer_StopChunk(orgs[0][0][2 * (8 * track + _old_key[track] / 0xCu) + _key_twin[track]]);
    }
  }
}

//----- (080AB1EE) --------------------------------------------------------
void __cdecl ReleaseOrganyaObject(Sint8 track)
{
  int i;

  for ( i = 0; i <= 7; ++i )
  {
    SMixer_StopChunk(orgs[0][8 * track + i][0]);
    SMixer_StopChunk(orgs[0][0][2 * (8 * track + i) + 1]);
    if ( orgs[0][8 * track + i][0] )
    {
      if ( orgs[0][8 * track + i][0]->buf )
        free(orgs[0][8 * track + i][0]->buf);
      free(orgs[0][8 * track + i][0]);
      orgs[0][8 * track + i][0] = 0;
    }
    if ( orgs[0][0][2 * (8 * track + i) + 1] )
    {
      if ( orgs[0][0][2 * (8 * track + i) + 1]->buf )
        free(orgs[0][0][2 * (8 * track + i) + 1]->buf);
      free(orgs[0][0][2 * (8 * track + i) + 1]);
      orgs[0][0][2 * (8 * track + i) + 1] = 0;
    }
  }
}

//----- (080AB37D) --------------------------------------------------------
signed int InitWaveData100()
{
  char *v0;
  int size;

  size = 0;
  v0 = get_resource("Wave", &size);
  memcpy(wave_data, v0, 0x6400u);
  return 1;
}

//----- (080AB3BC) --------------------------------------------------------
signed int __cdecl MakeOrganyaWave(char track, char wave_no)
{
  if ( wave_no > 99 )
    return 0;
  SDL_LockAudio();
  ReleaseOrganyaObject(track);
  SDL_UnlockAudio();
  return 1;
}



//----- (080AB3FE) --------------------------------------------------------
void __cdecl ChangeDramFrequency(unsigned __int8 key, char track)
{
  SMixer_SetFrequency(chunks[track + 150], 800 * key + 100);
}

//----- (080AB43D) --------------------------------------------------------
void __cdecl ChangeDramPan(unsigned __int8 pan, char track)
{
  SMixer_SetPan(chunks[track + 150], _pan_tbl[pan]);
}

//----- (080AB47C) --------------------------------------------------------
void __cdecl ChangeDramVolume(int volume, char track)
{
  SMixer_SetVolume(chunks[track + 150], volume);
}

//----- (080AB4AC) --------------------------------------------------------
void __cdecl PlayDramObject(unsigned __int8 key, int mode, char track)
{
  if ( chunks[track + 150] )
  {
    if ( mode )
    {
      if ( mode == 1 )
      {
        SMixer_StopChunk(chunks[track + 150]);
        ChangeDramFrequency(key, track);
        SMixer_PlayChunk(chunks[track + 150], 0);
      }
    }
    else
    {
      SMixer_StopChunk(chunks[track + 150]);
    }
  }
}

//----- (080AB548) --------------------------------------------------------
void __cdecl OrgData::OrgData(OrgData *const this)
{
  int i;

  for ( i = 0; i <= 15; ++i )
  {
    this->info.tdata[i].note_list = 0;
    this->info.tdata[i].note_p = 0;
  }
}

//----- (080AB59E) --------------------------------------------------------
void __cdecl OrgData::OrgData(OrgData *const this)
{
  int i;

  for ( i = 0; i <= 15; ++i )
  {
    this->info.tdata[i].note_list = 0;
    this->info.tdata[i].note_p = 0;
  }
}

//----- (080AB5F4) --------------------------------------------------------
void __cdecl OrgData::InitOrgData(OrgData *const this)
{
  int i;

  this->track = 0;
  this->info.alloc_note = 4096;
  this->info.dot = 4;
  this->info.line = 4;
  this->info.wait = 128;
  this->info.repeat_x = 0;
  this->info.end_x = 255 * this->info.dot * this->info.line;
  for ( i = 0; i <= 15; ++i )
  {
    this->info.tdata[i].freq = 1000;
    this->info.tdata[i].wave_no = 0;
    this->info.tdata[i].pipi = 0;
  }
  OrgData::NoteAlloc(this, this->info.alloc_note);
  OrgData::SetMusicInfo(this, &this->info, 0xFFFFFFFF);
  this->def_pan = 6;
  this->def_volume = -56;
}

//----- (080AB6FE) --------------------------------------------------------
signed int __cdecl OrgData::SetMusicInfo(OrgData *const this, MUSICINFO_0 *mi, Uint32 flag)
{
  char str[32];
  int i;

  if ( flag & 2 )
  {
    this->info.dot = mi->dot;
    this->info.line = mi->line;
  }
  if ( flag & 1 )
  {
    this->info.wait = mi->wait;
    sprintf(str, "%usd", mi->wait);
  }
  if ( flag & 8 )
  {
    this->info.repeat_x = mi->repeat_x;
    this->info.end_x = mi->end_x;
  }
  if ( flag & 0x10 )
  {
    for ( i = 0; i <= 7; ++i )
    {
      this->info.tdata[i].freq = mi->tdata[i].freq;
      this->info.tdata[i].pipi = this->info.tdata[i].pipi;
    }
  }
  if ( flag & 0x20 )
  {
    for ( i = 0; i <= 15; ++i )
      this->info.tdata[i].wave_no = mi->tdata[i].wave_no;
  }
  if ( flag & 0x40 )
  {
    for ( i = 0; i <= 15; ++i )
      this->info.tdata[i].pipi = mi->tdata[i].pipi;
  }
  return 1;
}

//----- (080AB8B6) --------------------------------------------------------
signed int __cdecl OrgData::NoteAlloc(OrgData *const this, unsigned __int16 alloc)
{
  int v3;
  int i;
  int ia;
  int j;
  int ja;

  for ( j = 0; ; ++j )
  {
    if ( j > 15 )
    {
      for ( ja = 0; ja <= 7; ++ja )
      {
        v3 = this->info.tdata[ja].pipi;
        MakeOrganyaWave(ja, this->info.tdata[ja].wave_no);
      }
      this->track = 0;
      return 1;
    }
    this->info.tdata[j].wave_no = 0;
    this->info.tdata[j].note_list = 0;
    this->info.tdata[j].note_p = (NOTELIST_0 *)malloc(16 * alloc);
    if ( !this->info.tdata[j].note_p )
      break;
    for ( ia = 0; alloc > ia; ++ia )
    {
      this->info.tdata[j].note_p[ia].from = 0;
      this->info.tdata[j].note_p[ia].to = 0;
      this->info.tdata[j].note_p[ia].length = 0;
      this->info.tdata[j].note_p[ia].pan = -1;
      this->info.tdata[j].note_p[ia].volume = -1;
      this->info.tdata[j].note_p[ia].y = -1;
    }
  }
  for ( i = 0; i <= 15; ++i )
  {
    if ( this->info.tdata[i].note_p )
    {
      free(this->info.tdata[i].note_p);
      this->info.tdata[j].note_p = 0;
    }
  }
  return 0;
}

//----- (080ABB46) --------------------------------------------------------
void __cdecl OrgData::ReleaseNote(OrgData *const this)
{
  int i;

  for ( i = 0; i <= 15; ++i )
  {
    if ( this->info.tdata[i].note_p )
    {
      free(this->info.tdata[i].note_p);
      this->info.tdata[i].note_p = 0;
    }
  }
}

//----- (080ABBBC) --------------------------------------------------------
signed int __cdecl OrgData::InitMusicData(OrgData *const this, char *path)
{
  int v3;
  $11C3EE8C60DD49A6CA3BAE14ACF35155 org_data;
  int size;
  char pass_check[6];
  NOTELIST_0 *np;
  int i;
  int j;
  char ver;
  Uint8 *p;
  char v12[8];

  ver = 0;
  size = 0;
  p = (Uint8 *)get_resource(path, &size);
  memcpy(pass_check, p, 6u);
  p += 6;
  if ( !memcmp(pass_check, pass, 6u) )
    ver = 1;
  if ( !memcmp(pass_check, pass2, 6u) )
    ver = 2;
  if ( !ver )
    return 0;
  org_data.wait = *(_WORD *)p;
  p += 2;
  org_data.line = *p++;
  org_data.dot = *p++;
  org_data.repeat_x = (p[1] << 8) | (p[2] << 16) | (p[3] << 24) | *p;
  p += 4;
  org_data.end_x = (p[1] << 8) | (p[2] << 16) | (p[3] << 24) | *p;
  p += 4;
  for ( i = 0; i <= 15; ++i )
  {
    *(_WORD *)&v12[6 * i - 128] = *(_WORD *)p;
    p += 2;
    v12[6 * i - 126] = *p++;
    v12[6 * i - 125] = *p++;
    *(_WORD *)&v12[6 * i - 124] = *(_WORD *)p;
    p += 2;
  }
  this->info.wait = org_data.wait;
  this->info.line = org_data.line;
  this->info.dot = org_data.dot;
  this->info.repeat_x = org_data.repeat_x;
  this->info.end_x = org_data.end_x;
  for ( i = 0; i <= 15; ++i )
  {
    this->info.tdata[i].freq = *(_WORD *)&v12[6 * i - 128];
    if ( ver == 1 )
      this->info.tdata[i].pipi = 0;
    else
      this->info.tdata[i].pipi = v12[6 * i - 125];
    this->info.tdata[i].wave_no = v12[6 * i - 126];
  }
  for ( j = 0; j <= 15; ++j )
  {
    if ( *(_WORD *)&v12[6 * j - 124] )
    {
      np = this->info.tdata[j].note_p;
      this->info.tdata[j].note_list = this->info.tdata[j].note_p;
      np->from = 0;
      np->to = np + 1;
      ++np;
      for ( i = 1; *(unsigned __int16 *)&v12[6 * j - 124] > i; ++i )
      {
        np->from = np - 1;
        np->to = np + 1;
        ++np;
      }
      --np;
      np->to = 0;
      np = this->info.tdata[j].note_p;
      for ( i = 0; *(unsigned __int16 *)&v12[6 * j - 124] > i; ++i )
      {
        np->x = *p | (p[1] << 8) | (p[2] << 16) | (p[3] << 24);
        p += 4;
        ++np;
      }
      np = this->info.tdata[j].note_p;
      for ( i = 0; *(unsigned __int16 *)&v12[6 * j - 124] > i; ++i )
      {
        np->y = *p++;
        ++np;
      }
      np = this->info.tdata[j].note_p;
      for ( i = 0; *(unsigned __int16 *)&v12[6 * j - 124] > i; ++i )
      {
        np->length = *p++;
        ++np;
      }
      np = this->info.tdata[j].note_p;
      for ( i = 0; *(unsigned __int16 *)&v12[6 * j - 124] > i; ++i )
      {
        np->volume = *p++;
        ++np;
      }
      np = this->info.tdata[j].note_p;
      for ( i = 0; *(unsigned __int16 *)&v12[6 * j - 124] > i; ++i )
      {
        np->pan = *p++;
        ++np;
      }
    }
    else
    {
      this->info.tdata[j].note_list = 0;
    }
  }
  for ( j = 0; j <= 7; ++j )
  {
    v3 = this->info.tdata[j].pipi;
    MakeOrganyaWave(j, this->info.tdata[j].wave_no);
  }
  for ( j = 8; j <= 15; ++j )
    i = this->info.tdata[j].wave_no;
  OrgData::SetPlayPointer(this, 0);
  return 1;
}


//----- (080AC322) --------------------------------------------------------
void __cdecl OrgData::GetMusicInfo(OrgData *const this, MUSICINFO_0 *mi)
{
  int i;

  mi->dot = this->info.dot;
  mi->line = this->info.line;
  mi->alloc_note = this->info.alloc_note;
  mi->wait = this->info.wait;
  mi->repeat_x = this->info.repeat_x;
  mi->end_x = this->info.end_x;
  for ( i = 0; i <= 15; ++i )
  {
    mi->tdata[i].freq = this->info.tdata[i].freq;
    mi->tdata[i].wave_no = this->info.tdata[i].wave_no;
    mi->tdata[i].pipi = this->info.tdata[i].pipi;
  }
}

//----- (080AC42C) --------------------------------------------------------
void __thiscall OrgData::PlayData(OrgData *const this)
{
  int i;
  int ia;
  OrgData *thisa;

  if ( _bFadeout && _Volume )
    _Volume -= 2;
  if ( _Volume < 0 )
    _Volume = 0;
  for ( i = 0; i <= 7; ++i )
  {
    if ( np[i] && np[i]->x == _PlayPos )
    {
      if ( !g_mute[i] && np[i]->y != -1 )
      {
        PlayOrganObject(np[i]->y, -1, i, thisa->info.tdata[i].freq);
        _now_leng[i] = np[i]->length;
      }
      if ( np[i]->pan != -1 )
        ChangeOrganPan(np[i]->y, np[i]->pan, i);
      if ( np[i]->volume != -1 )
        _TrackVol[i] = np[i]->volume;
      np[i] = np[i]->to;
    }
    if ( !_now_leng[i] )
      PlayOrganObject(0, 2, i, thisa->info.tdata[i].freq);
    if ( _now_leng[i] > 0 )
      --_now_leng[i];
    if ( np[i] )
      ChangeOrganVolume(np[i]->y, _Volume * _TrackVol[i] / 127, i);
  }
  for ( ia = 8; ia <= 15; ++ia )
  {
    if ( np[ia] && np[ia]->x == _PlayPos )
    {
      if ( np[ia]->y != -1 && !g_mute[ia] )
        PlayDramObject(np[ia]->y, 1, ia - 8);
      if ( np[ia]->pan != -1 )
        ChangeDramPan(np[ia]->pan, ia - 8);
      if ( np[ia]->volume != -1 )
        _TrackVol[ia] = np[ia]->volume;
      np[ia] = np[ia]->to;
    }
    if ( np[ia] )
      ChangeDramVolume(_Volume * _TrackVol[ia] / 127, ia - 8);
  }
  if ( thisa->info.end_x <= ++_PlayPos )
  {
    _PlayPos = thisa->info.repeat_x;
    OrgData::SetPlayPointer(thisa, _PlayPos);
  }
}

//----- (080AC83C) --------------------------------------------------------
void __cdecl OrgData::SetPlayPointer(OrgData *const this, Sint32 x)
{
  char v2;
  int i;

  for ( i = 0; i <= 15; ++i )
  {
    for ( np[i] = this->info.tdata[i].note_list; ; np[i] = np[i]->to )
    {
      v2 = np[i] && np[i]->x < x ? 1 : 0;
      if ( !v2 )
        break;
    }
  }
  _PlayPos = x;
}

//----- (080AC8D3) --------------------------------------------------------
signed int __cdecl StartOrganya()
{
  initORG();
  return 1;
}

//----- (080AC8E5) --------------------------------------------------------
signed int __cdecl LoadOrganya(char *path)
{
  org_data = loadORG(path);
  return 1;
}

//----- (080AC902) --------------------------------------------------------
void __cdecl SetOrganyaPosition(Sint32 x)
{
  setORGPosition(org_data, x);
  setPlayerVolume(0x64u);
  setPlayerFadeout(0);
}

//----- (080AC936) --------------------------------------------------------
Uint32 GetOrganyaPosition()
{
  return getORGPosition(org_data);
}

//----- (080AC94B) --------------------------------------------------------
void PlayOrganyaMusic()
{
  playORG(org_data);
}

//----- (080AC960) --------------------------------------------------------
signed int __cdecl ChangeOrganyaVolume(int vol)
{
  setPlayerVolume(vol);
  return 1;
}

//----- (080AC97B) --------------------------------------------------------
void StopOrganyaMusic()
{
  stopORG();
}

//----- (080AC988) --------------------------------------------------------
void SetOrganyaFadeout()
{
  setPlayerFadeout(1u);
}

//----- (080AC99C) --------------------------------------------------------
void EndOrganya()
{
  quitORG();
}

//----- (080AC9AC) --------------------------------------------------------
int __userpurge RGB@<eax>(int r, Uint8 g, Uint8 b, char a4)
{
  int result;

  result = r;
  *(_DWORD *)r = 0;
  *(_BYTE *)(r + 3) = -1;
  *(_BYTE *)r = g;
  *(_BYTE *)(r + 1) = b;
  *(_BYTE *)(r + 2) = a4;
  return result;
}

//----- (080AC9EE) --------------------------------------------------------
int __cdecl Random(int min, int max)
{
  return min + rand() % (max - min + 1);
}

//----- (080ACA1A) --------------------------------------------------------
void __cdecl PutNumber4(int x, int y, int value, bool bZero)
{
  RECT rect[10];
  int tbl[4];
  RECT rcClient;
  int a;
  int sw;
  int offset;

  rcClient.left = 0;
  rcClient.top = 0;
  rcClient.right = 320;
  rcClient.bottom = 240;
  qmemcpy(rect, &PutNumber4(long,long,long,bool)::C.0, sizeof(rect));
  tbl[0] = 1000;
  tbl[1] = 100;
  tbl[2] = 10;
  tbl[3] = 1;
  if ( value > 9999 )
    value = 9999;
  offset = 0;
  sw = 0;
  while ( offset <= 3 )
  {
    a = 0;
    while ( tbl[offset] <= value )
    {
      value -= tbl[offset];
      ++a;
      ++sw;
    }
    if ( bZero && offset == 2 || sw || offset == 3 )
      PutBitmap3(&rcClient, x + 8 * offset, y, &rect[a], 26);
    ++offset;
  }
}

//----- (080ACB41) --------------------------------------------------------
int __cdecl _ModeOpening()
{
  signed int v0;
  signed int v2;
  int frame_y;
  int frame_x;
  Uint32 wait;

  InitNpChar();
  InitCaret();
  InitStar();
  InitFade();
  InitFlash();
  InitBossLife();
  ChangeMusic(0);
  TransferStage(72, 100, 3, 3);
  SetFrameTargetMyChar(16);
  SetFadeMask();
  grcGame.left = 0;
  g_GameFlags = 3;
  CutNoise();
  wait = 0;
  while ( wait <= 0x1F3 )
  {
    ++wait;
    GetTrg();
    if ( gKey & 0x8000 )
    {
      v0 = Call_Escape(gscreen);
      if ( !v0 )
        return 0;
      if ( v0 == 2 )
        return 1;
    }
    if ( gKey & gKeyOk )
      break;
    ActNpChar();
    ActBossChar();
    ActBack();
    ResetMyCharFlag();
    HitMyCharMap();
    HitMyCharNpChar();
    HitMyCharBoss();
    HitNpCharMap();
    HitBossMap();
    HitBossBullet();
    ActCaret();
    MoveFrame3();
    ProcFade();
    CortBox(&grcFull, 0);
    GetFramePosition(&frame_x, &frame_y);
    PutBack(frame_x, frame_y);
    PutStage_Back(frame_x, frame_y);
    PutBossChar(frame_x, frame_y);
    PutNpChar(frame_x, frame_y);
    PutMapDataVector(frame_x, frame_y);
    PutStage_Front(frame_x, frame_y);
    PutFront(frame_x, frame_y);
    PutCaret(frame_x, frame_y);
    PutFade();
    v2 = TextScriptProc();
    if ( !v2 )
      return 0;
    if ( v2 == 2 )
      return 1;
    PutMapName(0);
    PutTextScript();
    PutFramePerSecound();
    if ( !Flip_SystemTask(gscreen) )
      return 0;
    ++gCounter;
  }
  wait = SDL_GetTicks();
  while ( SDL_GetTicks() < wait + 500 )
  {
    CortBox(&grcGame, 0);
    PutFramePerSecound();
    if ( !Flip_SystemTask(gscreen) )
      return 0;
  }
  return 2;
}


//----- (080ACDF2) --------------------------------------------------------
int __cdecl _ModeTitle()
{
  int v0;
  signed int eax29;
  Sint32 *eax39;
  Sint32 *eax40;
  Sint32 *v5;
  Sint32 *v6;
  Sint32 *v7;
  RECT rcSu[4];
  RECT rcKing[4];
  RECT rcToroko[4];
  RECT rcCurly[4];
  RECT rcMyChar[4];
  RECT char_rc;
  int v4;
  int v3;
  int v2;
  int v1;
  RECT rcPeriod;
  RECT rcVersion;
  RECT rcContinue;
  RECT rcNew;
  RECT rcPixel;
  RECT rcTitle;
  Uint8 r;
  Uint32 wait;
  int anime;
  int char_type;
  int time_counter;
  int char_y;
  int char_surf;
  int back_color;
  char v32[8];

  rcTitle.left = 0;
  rcTitle.top = 0;
  rcTitle.right = 144;
  rcTitle.bottom = 32;
  rcPixel.left = 0;
  rcPixel.top = 0;
  rcPixel.right = 160;
  rcPixel.bottom = 16;
  rcNew.left = 144;
  rcNew.top = 0;
  rcNew.right = 192;
  rcNew.bottom = 16;
  rcContinue.left = 144;
  rcContinue.top = 16;
  rcContinue.right = 192;
  rcContinue.bottom = 32;
  rcVersion.left = 152;
  rcVersion.top = 80;
  rcVersion.right = 208;
  rcVersion.bottom = 88;
  rcPeriod.left = 152;
  rcPeriod.top = 88;
  rcPeriod.right = 208;
  rcPeriod.bottom = 96;
  rcMyChar[0].left = 0;
  rcMyChar[0].top = 16;
  rcMyChar[0].right = 16;
  rcMyChar[0].bottom = 32;
  rcMyChar[1].left = 16;
  rcMyChar[1].top = 16;
  rcMyChar[1].right = 32;
  rcMyChar[1].bottom = 32;
  rcMyChar[2].left = 0;
  rcMyChar[2].top = 16;
  rcMyChar[2].right = 16;
  rcMyChar[2].bottom = 32;
  rcMyChar[3].left = 32;
  rcMyChar[3].top = 16;
  rcMyChar[3].right = 48;
  rcMyChar[3].bottom = 32;
  rcCurly[0].left = 0;
  rcCurly[0].top = 112;
  rcCurly[0].right = 16;
  rcCurly[0].bottom = 128;
  rcCurly[1].left = 16;
  rcCurly[1].top = 112;
  rcCurly[1].right = 32;
  rcCurly[1].bottom = 128;
  rcCurly[2].left = 0;
  rcCurly[2].top = 112;
  rcCurly[2].right = 16;
  rcCurly[2].bottom = 128;
  rcCurly[3].left = 32;
  rcCurly[3].top = 112;
  rcCurly[3].right = 48;
  rcCurly[3].bottom = 128;
  rcToroko[0].left = 64;
  rcToroko[0].top = 80;
  rcToroko[0].right = 80;
  rcToroko[0].bottom = 96;
  rcToroko[1].left = 80;
  rcToroko[1].top = 80;
  rcToroko[1].right = 96;
  rcToroko[1].bottom = 96;
  rcToroko[2].left = 64;
  rcToroko[2].top = 80;
  rcToroko[2].right = 80;
  rcToroko[2].bottom = 96;
  rcToroko[3].left = 96;
  rcToroko[3].top = 80;
  rcToroko[3].right = 112;
  rcToroko[3].bottom = 96;
  rcKing[0].left = 224;
  rcKing[0].top = 48;
  rcKing[0].right = 240;
  rcKing[0].bottom = 64;
  rcKing[1].left = 288;
  rcKing[1].top = 48;
  rcKing[1].right = 304;
  rcKing[1].bottom = 64;
  rcKing[2].left = 224;
  rcKing[2].top = 48;
  rcKing[2].right = 240;
  rcKing[2].bottom = 64;
  rcKing[3].left = 304;
  rcKing[3].top = 48;
  rcKing[3].right = 320;
  rcKing[3].bottom = 64;
  rcSu[0].left = 0;
  rcSu[0].top = 16;
  rcSu[0].right = 16;
  rcSu[0].bottom = 32;
  rcSu[1].left = 32;
  rcSu[1].top = 16;
  rcSu[1].right = 48;
  rcSu[1].bottom = 32;
  rcSu[2].left = 0;
  rcSu[2].top = 16;
  rcSu[2].right = 16;
  rcSu[2].bottom = 32;
  rcSu[3].left = 48;
  rcSu[3].top = 16;
  rcSu[3].right = 64;
  rcSu[3].bottom = 32;
  InitCaret();
  InitStar();
  CutNoise();
  anime = 0;
  char_type = 0;
  time_counter = 0;
  RGB((int)&r, 0x20u, 0x20u, 32);
  back_color = GetCortBoxColor((const SDL_Color_0 *const )&r);
  _bContinue = (unsigned __int8)IsProfile() != 0;
  time_counter = LoadTimeCounter();
  if ( time_counter && time_counter <= 17999 )
    char_type = 1;
  if ( time_counter && time_counter <= 14999 )
    char_type = 2;
  if ( time_counter && time_counter <= 11999 )
    char_type = 3;
  if ( time_counter && time_counter <= 8999 )
    char_type = 4;
  switch ( char_type )
  {
    case 1:
      ChangeMusic(36);
      break;
    case 2:
      ChangeMusic(40);
      break;
    case 3:
      ChangeMusic(41);
      break;
    case 4:
      ChangeMusic(2);
      break;
    default:
      ChangeMusic(24);
      break;
  }
  grcGame.left = 0;
  g_GameFlags = 0;
  v0 = unk_81C8598;
  BYTE1(v0) |= 1u;
  unk_81C8598 = v0;
  wait = 0;
  while ( 1 )
  {
    if ( wait <= 9 )
      ++wait;
    GetTrg();
    if ( wait > 9 )
    {
      if ( gKeyTrg & gKeyOk )
        break;
    }
    if ( gKey & 0x8000 )
    {
      eax29 = Call_Escape(gscreen);
      if ( !eax29 )
        return 0;
      if ( eax29 == 2 )
        return 1;
    }
    if ( (gKeyDown | gKeyUp) & gKeyTrg )
    {
      PlaySoundObject(1, 1);
      _bContinue = _bContinue == 0;
    }
    ActCaret();
    if ( ++anime > 39 )
      anime = 0;
    CortBox(&grcGame, back_color);
    PutBitmap3(&grcGame, 100, 216, &rcVersion, 26);
    PutBitmap3(&grcGame, 156, 216, &rcPeriod, 26);
    GetCompileVersion(&v1, &v2, &v3, &v4);
    PutNumber4(140, 216, v1, 0);
    PutNumber4(156, 216, v2, 0);
    PutNumber4(172, 216, v3, 0);
    PutNumber4(188, 216, v4, 0);
    PutBitmap3(&grcGame, 88, 40, &rcTitle, 0);
    PutBitmap3(&grcGame, 136, 128, &rcNew, 0);
    PutBitmap3(&grcGame, 136, 148, &rcContinue, 0);
    PutBitmap3(&grcGame, 80, 192, &rcPixel, 1);
    switch ( char_type )
    {
      case 0:
        eax39 = (Sint32 *)&v32[16 * (anime / 10 % 4) - 224];
        char_rc.left = *eax39;
        char_rc.top = eax39[1];
        char_rc.right = eax39[2];
        char_rc.bottom = eax39[3];
        char_surf = 16;
        break;
      case 1:
        eax40 = (Sint32 *)&v32[16 * (anime / 10 % 4) - 288];
        char_rc.left = *eax40;
        char_rc.top = eax40[1];
        char_rc.right = eax40[2];
        char_rc.bottom = eax40[3];
        char_surf = 23;
        break;
      case 2:
        v5 = (Sint32 *)&v32[16 * (anime / 10 % 4) - 352];
        char_rc.left = *v5;
        char_rc.top = v5[1];
        char_rc.right = v5[2];
        char_rc.bottom = v5[3];
        char_surf = 23;
        break;
      case 3:
        v6 = (Sint32 *)&v32[16 * (anime / 10 % 4) - 416];
        char_rc.left = *v6;
        char_rc.top = v6[1];
        char_rc.right = v6[2];
        char_rc.bottom = v6[3];
        char_surf = 23;
        break;
      case 4:
        v7 = (Sint32 *)&v32[16 * (anime / 10 % 4) - 480];
        char_rc.left = *v7;
        char_rc.top = v7[1];
        char_rc.right = v7[2];
        char_rc.bottom = v7[3];
        char_surf = 23;
        break;
    }
    if ( _bContinue == 1 )
      char_y = 147;
    else
      char_y = 127;
    PutBitmap3(&grcGame, 116, char_y, &char_rc, char_surf);
    PutCaret(0, 0);
    if ( time_counter )
      PutTimeCounter(16, 8);
    PutFramePerSecound();
    if ( !Flip_SystemTask(gscreen) )
      return 0;
  }
  PlaySoundObject(18, 1);
  ChangeMusic(0);
  wait = SDL_GetTicks();
  while ( SDL_GetTicks() < wait + 1000 )
  {
    CortBox(&grcGame, 0);
    PutFramePerSecound();
    if ( !Flip_SystemTask(gscreen) )
      return 0;
  }
  return 3;
}



//----- (080AD91F) --------------------------------------------------------
int __cdecl _ModeAction()
{
  int result;
  signed int v1;
  signed int v2;
  signed int v3;
  signed int v4;
  int frame_y;
  int frame_x;
  Uint8 r;
  unsigned int swPlay;
  unsigned int _color;

  frame_x = 0;
  frame_y = 0;
  RGB((int)&r, 0, 0, 32);
  _color = GetCortBoxColor((const SDL_Color_0 *const )&r);
  swPlay = 1;
  gCounter = 0;
  grcGame.left = 0;
  g_GameFlags = 3;
  InitMyChar();
  InitNpChar();
  InitBullet();
  InitCaret();
  InitStar();
  InitFade();
  InitFlash();
  ClearArmsData();
  ClearItemData();
  ClearPermitStage();
  StartMapping();
  InitFlags();
  InitBossLife();
  if ( _bContinue )
  {
    if ( (unsigned __int8)LoadProfile(0) ^ 1 && (unsigned __int8)InitializeGame() ^ 1 )
    {
      result = 0;
    }
    else
    {
      while ( 1 )
      {
LABEL_7:
        GetTrg();
        if ( gKeyTrg & 0x8000 )
        {
          v1 = Call_Escape(gscreen);
          if ( !v1 )
            return 0;
          if ( v1 == 2 )
            return 1;
        }
        if ( swPlay & 1 && g_GameFlags & 1 )
        {
          if ( g_GameFlags & 2 )
            ActMyChar(1);
          else
            ActMyChar(0);
          ActStar();
          ActNpChar();
          ActBossChar();
          ActValueView();
          ActBack();
          ResetMyCharFlag();
          HitMyCharMap();
          HitMyCharNpChar();
          HitMyCharBoss();
          HitNpCharMap();
          HitBossMap();
          HitBulletMap();
          HitNpCharBullet();
          HitBossBullet();
          if ( g_GameFlags & 2 )
            ShootBullet();
          ActBullet();
          ActCaret();
          MoveFrame3();
          ActFlash(frame_x, frame_y);
          if ( g_GameFlags & 2 )
            AnimationMyChar(1);
          else
            AnimationMyChar(0);
        }
        if ( g_GameFlags & 8 )
        {
          ActionCredit();
          ActionIllust();
          ActionStripper();
        }
        ProcFade();
        CortBox(&grcFull, _color);
        GetFramePosition(&frame_x, &frame_y);
        PutBack(frame_x, frame_y);
        PutStage_Back(frame_x, frame_y);
        PutBossChar(frame_x, frame_y);
        PutNpChar(frame_x, frame_y);
        PutBullet(frame_x, frame_y);
        PutMyChar(frame_x, frame_y);
        PutStar(frame_x, frame_y);
        PutMapDataVector(frame_x, frame_y);
        PutStage_Front(frame_x, frame_y);
        PutFront(frame_x, frame_y);
        PutFlash();
        PutCaret(frame_x, frame_y);
        PutValueView(frame_x, frame_y);
        PutBossLife();
        PutFade();
        if ( !(g_GameFlags & 4) )
        {
          if ( gKeyTrg & gKeyItem )
          {
            BackupSurface(10, &grcGame);
            v2 = CampLoop();
            if ( !v2 )
              return 0;
            if ( v2 == 2 )
              return 1;
            gMC.cond &= 0xFEu;
          }
          else if ( unk_81C8598 & 2 && gKeyTrg & gKeyMap )
          {
            BackupSurface(10, &grcGame);
            v3 = MiniMapLoop();
            if ( !v3 )
              return 0;
            if ( v3 == 2 )
              return 1;
          }
        }
        if ( g_GameFlags & 2 )
        {
          if ( gKeyTrg & gKeyArms )
          {
            RotationArms();
          }
          else if ( gKeyTrg & gKeyArmsRev )
          {
            RotationArmsRev();
          }
        }
        if ( swPlay & 1 )
        {
          v4 = TextScriptProc();
          if ( !v4 )
            return 0;
          if ( v4 == 2 )
            return 1;
        }
        PutMapName(0);
        PutTimeCounter(16, 8);
        if ( g_GameFlags & 2 )
        {
          PutMyLife(1);
          PutArmsEnergy(1);
          PutMyAir(120, 104);
          PutActiveArmsList();
        }
        if ( g_GameFlags & 8 )
        {
          PutIllust();
          PutStripper();
        }
        PutTextScript();
        PutFramePerSecound();
        if ( !Flip_SystemTask(gscreen) )
          break;
        ++gCounter;
      }
      result = 0;
    }
  }
  else
  {
    if ( !((unsigned __int8)InitializeGame() ^ 1) )
      goto LABEL_7;
    result = 0;
  }
  return result;
}

//----- (080ADE47) --------------------------------------------------------
signed int __cdecl Game()
{
  char path[260];
  int mode;

  if ( (unsigned __int8)LoadGenericData() ^ 1 )
    return 0;
  PlaySoundObject(7, -1);
  sprintf(path, "%s/npc.tbl", gDataPath);
  if ( (unsigned __int8)LoadNpcTable(path) ^ 1 )
    return 0;
  InitTextScript2();
  InitSkipFlags();
  InitMapData2();
  InitCreditScript();
  mode = 1;
  while ( mode )
  {
    if ( mode == 1 )
      mode = _ModeOpening();
    if ( mode == 2 )
      mode = _ModeTitle();
    if ( mode == 3 )
      mode = _ModeAction();
  }
  PlaySoundObject(7, 0);
  EndMapData();
  EndTextScript();
  ReleaseNpcTable();
  ReleaseCreditScript();
  return 1;
}

//----- (080ADF4C) --------------------------------------------------------
void GetTrg()
{
  gKeyTrg = gKey & (gKey ^ GetTrg(void)::_key_old);
  GetTrg(void)::_key_old = gKey;
}

//----- (080ADF80) --------------------------------------------------------
signed int __cdecl LoadNpcTable(char *path)
{
  signed int result;
  $3999A2E3BC6E7A1D19AF6FBFAF274F94 *v2;
  $3999A2E3BC6E7A1D19AF6FBFAF274F94 *v3;
  $3999A2E3BC6E7A1D19AF6FBFAF274F94 *v4;
  $3999A2E3BC6E7A1D19AF6FBFAF274F94 *v5;
  SDL_RWops_0 *fp;
  int n;
  int na;
  int nb;
  int nc;
  int nd;
  int ne;
  int nf;
  int ng;
  int nh;
  int ni;
  unsigned int size;
  int num;

  size = GetFileSizeLong(path);
  if ( size == -1 )
    return 0;
  num = size / 0x18;
  gNpcTable = ($3999A2E3BC6E7A1D19AF6FBFAF274F94 *)malloc(24 * (size / 0x18));
  if ( !gNpcTable )
    return 0;
  fp = SDL_RWFromFile(path, &unk_814C220);
  if ( fp )
  {
    for ( n = 0; n < num; ++n )
    {
      v2 = &gNpcTable[n];
      v2->bits = SDL_ReadLE16(fp);
    }
    for ( na = 0; na < num; ++na )
    {
      v3 = &gNpcTable[na];
      v3->life = SDL_ReadLE16(fp);
    }
    for ( nb = 0; nb < num; ++nb )
      fp->read(fp, &gNpcTable[nb].surf, 1, 1);
    for ( nc = 0; nc < num; ++nc )
      fp->read(fp, &gNpcTable[nc].destroy_voice, 1, 1);
    for ( nd = 0; nd < num; ++nd )
      fp->read(fp, &gNpcTable[nd].hit_voice, 1, 1);
    for ( ne = 0; ne < num; ++ne )
      fp->read(fp, &gNpcTable[ne].size, 1, 1);
    for ( nf = 0; nf < num; ++nf )
    {
      v4 = &gNpcTable[nf];
      v4->exp = SDL_ReadLE32(fp);
    }
    for ( ng = 0; ng < num; ++ng )
    {
      v5 = &gNpcTable[ng];
      v5->damage = SDL_ReadLE32(fp);
    }
    for ( nh = 0; nh < num; ++nh )
      fp->read(fp, &gNpcTable[nh].hit, 4, 1);
    for ( ni = 0; ni < num; ++ni )
      fp->read(fp, &gNpcTable[ni].view, 4, 1);
    fp->close(fp);
    result = 1;
  }
  else
  {
    free(gNpcTable);
    gNpcTable = 0;
    result = 0;
  }
  return result;
}



//----- (080AE32C) --------------------------------------------------------
void ReleaseNpcTable()
{
  if ( gNpcTable )
  {
    free(gNpcTable);
    gNpcTable = 0;
  }
}

//----- (080AE354) --------------------------------------------------------
int __userpurge RGB@<eax>(int r, Uint8 g, Uint8 b, char a4)
{
  int result;

  result = r;
  *(_DWORD *)r = 0;
  *(_BYTE *)(r + 3) = -1;
  *(_BYTE *)r = g;
  *(_BYTE *)(r + 1) = b;
  *(_BYTE *)(r + 2) = a4;
  return result;
}

//----- (080AE396) --------------------------------------------------------
_BOOL4 InitTextScript2()
{
  int i;

  unk_81D5ACC = 0;
  g_GameFlags &= 0xFFFFFFFB;
  for ( i = 0; i <= 3; ++i )
    MakeSurface_Generic(gRect_line.right, gRect_line.bottom, i + 30);
  memset(_text, 0, 0x100u);
  unk_81D5AC8 = (unsigned __int8 *)malloc(0x5000u);
  return unk_81D5AC8 != 0;
}

//----- (080AE435) --------------------------------------------------------
void EndTextScript()
{
  int i;

  free(unk_81D5AC8);
  ReleaseSurface(26);
  for ( i = 0; i <= 3; ++i )
    ReleaseSurface(i + 30);
}

//----- (080AE47C) --------------------------------------------------------
void __cdecl EncryptionBinaryData2(unsigned __int8 *pData, int size)
{
  int i;
  int half;
  int val1;

  half = size / 2;
  if ( pData[size / 2] )
    val1 = -pData[half];
  else
    LOBYTE(val1) = -7;
  for ( i = 0; i < size; ++i )
  {
    if ( i != half )
      pData[i] += val1;
  }
}

//----- (080AE510) --------------------------------------------------------
signed int __cdecl LoadTextScript2(char *name)
{
  char path[260];
  SDL_RWops_0 *fp;

  sprintf(path, "%s/%s", gDataPath, name);
  unk_81D5AC4 = GetFileSizeLong(path);
  if ( unk_81D5AC4 == -1 )
    return 0;
  fp = SDL_RWFromFile(path, "rb");
  if ( !fp )
    return 0;
  fp->read(fp, unk_81D5AC8, 1, unk_81D5AC4);
  unk_81D5AC8[unk_81D5AC4] = 0;
  fp->close(fp);
  strcpy(gTS.path, name);
  EncryptionBinaryData2(unk_81D5AC8, unk_81D5AC4);
  return 1;
}

//----- (080AE604) --------------------------------------------------------
signed int __cdecl LoadTextScript_Stage(char *name)
{
  char path[260];
  SDL_RWops_0 *fp;
  int head_size;
  int body_size;

  sprintf(path, "%s/%s", gDataPath, "Head.tsc");
  head_size = GetFileSizeLong(path);
  if ( head_size == -1 )
    return 0;
  fp = SDL_RWFromFile(path, "rb");
  if ( !fp )
    return 0;
  fp->read(fp, unk_81D5AC8, 1, head_size);
  EncryptionBinaryData2(unk_81D5AC8, head_size);
  unk_81D5AC8[head_size] = 0;
  fp->close(fp);
  sprintf(path, "%s/%s", gDataPath, name);
  body_size = GetFileSizeLong(path);
  if ( body_size == -1 )
    return 0;
  fp = SDL_RWFromFile(path, "rb");
  if ( !fp )
    return 0;
  fp->read(fp, &unk_81D5AC8[head_size], 1, body_size);
  EncryptionBinaryData2(&unk_81D5AC8[head_size], body_size);
  unk_81D5AC8[head_size + body_size] = 0;
  fp->close(fp);
  unk_81D5AC4 = head_size + body_size;
  strcpy(gTS.path, name);
  return 1;
}

//----- (080AE7D5) --------------------------------------------------------
void __cdecl GetTextScriptPath(char *path)
{
  strcpy(path, gTS.path);
}

//----- (080AE7F0) --------------------------------------------------------
int __cdecl GetTextScriptNo(int a)
{
  return (char)unk_81D5AC8[a + 3]
       - 48
       + 10 * (char)unk_81D5AC8[a + 2]
       - 480
       + 100 * (char)unk_81D5AC8[a + 1]
       - 4800
       + 1000 * (char)unk_81D5AC8[a]
       - 48000;
}

//----- (080AE886) --------------------------------------------------------
signed int __cdecl StartTextScript(int no)
{
  int i;
  int event_no;

  unk_81D5ACC = 1;
  g_GameFlags |= 5u;
  unk_81D5AD8 = 0;
  unk_81D5AD4 = 0;
  unk_81D5AEC = 4;
  unk_81D5ACD = 0;
  unk_81D5B20 = 0;
  unk_81D5AFC = 0;
  dword_81D5B04 = 0;
  unk_81D5B1C = 0;
  unk_81C8610 = 0;
  rcView.left = 52;
  rcView.top = 184;
  rcView.right = 268;
  rcView.bottom = 232;
  for ( i = 0; i <= 3; ++i )
  {
    dword_81D59CC[i + 68] = 16 * i;
    CortBox2(&gRect_line, 0, i + 30);
    memset((void *)((i << 6) + 136141632), 0, 0x40u);
  }
  for ( unk_81D5AD0 = 0; ; ++unk_81D5AD0 )
  {
    if ( !unk_81D5AC8[unk_81D5AD0] )
      return 0;
    if ( unk_81D5AC8[unk_81D5AD0] != 35 )
      continue;
    event_no = GetTextScriptNo(++unk_81D5AD0);
    if ( no == event_no )
      break;
    if ( no < event_no )
      return 0;
  }
  while ( unk_81D5AC8[unk_81D5AD0] != 10 )
    ++unk_81D5AD0;
  ++unk_81D5AD0;
  return 1;
}

//----- (080AEA44) --------------------------------------------------------
signed int __cdecl JumpTextScript(int no)
{
  int i;
  int event_no;

  unk_81D5ACC = 1;
  g_GameFlags |= 4u;
  unk_81D5AD8 = 0;
  unk_81D5AD4 = 0;
  unk_81D5AEC = 4;
  unk_81D5B20 = 0;
  for ( i = 0; i <= 3; ++i )
  {
    dword_81D59CC[i + 68] = 16 * i;
    CortBox2(&gRect_line, 0, i + 30);
    memset((void *)((i << 6) + 136141632), 0, 0x40u);
  }
  for ( unk_81D5AD0 = 0; ; ++unk_81D5AD0 )
  {
    if ( !unk_81D5AC8[unk_81D5AD0] )
      return 0;
    if ( unk_81D5AC8[unk_81D5AD0] != 35 )
      continue;
    event_no = GetTextScriptNo(++unk_81D5AD0);
    if ( no == event_no )
      break;
    if ( no < event_no )
      return 0;
  }
  while ( unk_81D5AC8[unk_81D5AD0] != 10 )
    ++unk_81D5AD0;
  ++unk_81D5AD0;
  return 1;
}

//----- (080AEBAB) --------------------------------------------------------
void StopTextScript()
{
  unk_81D5ACC = 0;
  g_GameFlags &= 0xFFFFFFFB;
  g_GameFlags |= 3u;
  unk_81D5ACD = 0;
}

//----- (080AEBD8) --------------------------------------------------------
void CheckNewLine()
{
  if ( dword_81D59CC[unk_81D5AD8 % 4 + 68] == 48 )
  {
    unk_81D5ACC = 3;
    g_GameFlags |= 4u;
    CortBox2(&gRect_line, 0, unk_81D5AD8 % 4 + 30);
    memset((void *)((unk_81D5AD8 % 4 << 6) + 136141632), 0, 0x40u);
  }
}

//----- (080AEC7A) --------------------------------------------------------
void __cdecl SetNumberTextScript(int index)
{
  int v1;
  int v2;
  int table[3];
  char str[5];
  Uint8 r;
  int bZero;
  int a;
  int b;
  int offset;
  int i;

  table[0] = 1000;
  table[1] = 100;
  table[2] = 10;
  a = gNumberTextScript[index];
  bZero = 0;
  offset = 0;
  for ( i = 0; i <= 2; ++i )
  {
    if ( a / table[i] || bZero )
    {
      b = a / table[i];
      str[offset] = b + 48;
      bZero = 1;
      a -= b * table[i];
      ++offset;
    }
  }
  str[offset] = a + 48;
  str[offset + 1] = 0;
  v1 = unk_81D5AD8 % 4 + 30;
  RGB((int)&r, 0xFFu, 0xFFu, 254);
  PutText2(6 * unk_81D5AD4, 0, str, (const SDL_Color_0 *const )&r, v1);
  strcat((char *)((unk_81D5AD8 % 4 << 6) + 136141632), str);
  PlaySoundObject(2, 1);
  unk_81D5B20 = 0;
  v2 = unk_81D5AD4;
  unk_81D5AD4 = v2 + strlen(str);
  if ( unk_81D5AD4 > 34 )
  {
    unk_81D5AD4 = 0;
    ++unk_81D5AD8;
    CheckNewLine();
  }
}

//----- (080AEE36) --------------------------------------------------------
void ClearTextLine()
{
  int i;

  unk_81D5AD8 = 0;
  unk_81D5AD4 = 0;
  unk_81D5B1C = 0;
  for ( i = 0; i <= 3; ++i )
  {
    dword_81D59CC[i + 68] = 16 * i;
    CortBox2(&gRect_line, 0, i + 30);
    memset((void *)((i << 6) + 136141632), 0, 0x40u);
  }
}

//----- (080AEEC8) --------------------------------------------------------
void PutTextScript()
{
  bool v0;
  bool v1;
  Uint32 v2;
  RECT rcFrame3;
  RECT rcFrame2;
  RECT rcFrame1;
  RECT rect_cur;
  RECT rect_yesno;
  RECT rcItemBox5;
  RECT rcItemBox4;
  RECT rcItemBox3;
  RECT rcItemBox2;
  RECT rcItemBox1;
  RECT rcFace;
  RECT rect;
  Uint8 r;
  int i;
  int text_offset;

  if ( unk_81D5ACC && (unk_81D5ACD & 1) == 1 )
  {
    if ( unk_81D5ACD & 0x20 )
    {
      rcView.top = 32;
      rcView.bottom = 80;
    }
    else
    {
      rcView.top = 184;
      rcView.bottom = 232;
    }
    if ( unk_81D5ACD & 2 )
    {
      rcFrame1.left = 0;
      rcFrame1.top = 0;
      rcFrame1.right = 244;
      rcFrame1.bottom = 8;
      rcFrame2.left = 0;
      rcFrame2.top = 8;
      rcFrame2.right = 244;
      rcFrame2.bottom = 16;
      rcFrame3.left = 0;
      rcFrame3.top = 16;
      rcFrame3.right = 244;
      rcFrame3.bottom = 24;
      PutBitmap3(&grcFull, 38, rcView.top - 10, &rcFrame1, 26);
      for ( i = 1; i <= 6; ++i )
        PutBitmap3(&grcFull, 38, 8 * i + rcView.top - 10, &rcFrame2, 26);
      PutBitmap3(&grcFull, 38, 8 * i + rcView.top - 10, &rcFrame3, 26);
    }
    rcFace.left = 48 * (unk_81D5AFC % 6);
    rcFace.top = 48 * (unk_81D5AFC / 6);
    rcFace.right = 48 * (unk_81D5AFC % 6) + 48;
    rcFace.bottom = 48 * (unk_81D5AFC / 6) + 48;
    if ( unk_81D5B00 <= 26623 )
      unk_81D5B00 += 4096;
    PutBitmap3(&rcView, unk_81D5B00 / 512, rcView.top - 3, &rcFace, 27);
    if ( unk_81D5AFC )
      text_offset = 56;
    else
      text_offset = 0;
    for ( i = 0; i <= 3; ++i )
      PutBitmap3(&rcView, text_offset + 52, unk_81D5B1C + dword_81D59CC[i + 68] + rcView.top, &gRect_line, i + 30);
    v0 = unk_81D5B20++ % 0x14u > 0xC;
    v1 = v0 && unk_81D5ACC == 2;
    if ( v1 )
    {
      rect.left = text_offset + 6 * unk_81D5AD4 + 52;
      rect.top = rcView.top + dword_81D59CC[unk_81D5AD8 % 4 + 68] + unk_81D5B1C;
      rect.right = text_offset + 6 * unk_81D5AD4 + 52 + 5;
      rect.bottom = rect.top + 11;
      RGB((int)&r, 0xFFu, 0xFFu, 254);
      v2 = GetCortBoxColor((const SDL_Color_0 *const )&r);
      CortBox(&rect, v2);
    }
    rcItemBox1.left = 0;
    rcItemBox1.top = 0;
    rcItemBox1.right = 72;
    rcItemBox1.bottom = 16;
    rcItemBox2.left = 0;
    rcItemBox2.top = 8;
    rcItemBox2.right = 72;
    rcItemBox2.bottom = 24;
    rcItemBox3.left = 240;
    rcItemBox3.top = 0;
    rcItemBox3.right = 244;
    rcItemBox3.bottom = 8;
    rcItemBox4.left = 240;
    rcItemBox4.top = 8;
    rcItemBox4.right = 244;
    rcItemBox4.bottom = 16;
    rcItemBox5.left = 240;
    rcItemBox5.top = 16;
    rcItemBox5.right = 244;
    rcItemBox5.bottom = 24;
    if ( dword_81D5B04 )
    {
      PutBitmap3(&grcFull, 120, 128, &rcItemBox1, 26);
      PutBitmap3(&grcFull, 120, 144, &rcItemBox2, 26);
      PutBitmap3(&grcFull, 192, 128, &rcItemBox3, 26);
      PutBitmap3(&grcFull, 192, 136, &rcItemBox4, 26);
      PutBitmap3(&grcFull, 192, 144, &rcItemBox4, 26);
      PutBitmap3(&grcFull, 192, 152, &rcItemBox5, 26);
      if ( dword_81D5B08 <= 135 )
        ++dword_81D5B08;
      if ( dword_81D5B04 > 999 )
      {
        rect.left = 32
                  * (((((unsigned int)((dword_81D5B04 - 1000) >> 31) >> 29) + (_BYTE)dword_81D5B04 + 24) & 7)
                   - ((unsigned int)((dword_81D5B04 - 1000) >> 31) >> 29));
        rect.right = 32
                   * (((((unsigned int)((dword_81D5B04 - 1000) >> 31) >> 29) + (_BYTE)dword_81D5B04 + 24) & 7)
                    - ((unsigned int)((dword_81D5B04 - 1000) >> 31) >> 29))
                   + 32;
        rect.top = 16 * ((dword_81D5B04 - 1000) / 8);
        rect.bottom = 16 * ((dword_81D5B04 - 1000) / 8) + 16;
        PutBitmap3(&grcFull, 140, dword_81D5B08, &rect, 8);
      }
      else
      {
        rect.left = 16 * (dword_81D5B04 % 16);
        rect.right = 16 * (dword_81D5B04 % 16) + 16;
        rect.top = 16 * (dword_81D5B04 / 16);
        rect.bottom = 16 * (dword_81D5B04 / 16) + 16;
        PutBitmap3(&grcFull, 148, dword_81D5B08, &rect, 12);
      }
    }
    rect_yesno.left = 152;
    rect_yesno.top = 48;
    rect_yesno.right = 244;
    rect_yesno.bottom = 80;
    rect_cur.left = 112;
    rect_cur.top = 88;
    rect_cur.right = 128;
    rect_cur.bottom = 104;
    if ( unk_81D5ACC == 6 )
    {
      if ( unk_81D5AEC > 1 )
        i = 144;
      else
        i = 4 * (38 - unk_81D5AEC);
      PutBitmap3(&grcFull, 216, i, &rect_yesno, 26);
      if ( unk_81D5AEC == 16 )
        PutBitmap3(&grcFull, 41 * unk_81D5AF8 + 211, 154, &rect_cur, 26);
    }
  }
}

//----- (080AF673) --------------------------------------------------------
signed int TextScriptProc()
{
  signed int v1;
  signed int v2;
  int v3;
  signed int v4;
  char v5;
  int v6;
  int v7;
  char str[72];
  char str_0[64];
  RECT rcSymbol;
  int z;
  char c[3];
  Uint8 r;
  Uint8 v14;
  int i;
  int w;
  int x;
  int y;
  bool bExit;

  rcSymbol.left = 64;
  rcSymbol.top = 48;
  rcSymbol.right = 72;
  rcSymbol.bottom = 56;
  switch ( unk_81D5ACC )
  {
    case 0:
      goto LABEL_479;
    case 1:
      ++unk_81D5AEC;
      if ( !(g_GameFlags & 2) && (gKeyCancel | gKeyOk) & gKey )
        unk_81D5AEC += 4;
      if ( unk_81D5AEC <= 3 )
        goto LABEL_479;
      unk_81D5AEC = 0;
      bExit = 0;
      break;
    case 2:
      if ( (gKeyCancel | gKeyOk) & gKeyTrg )
        unk_81D5ACC = 1;
      goto LABEL_479;
    case 3:
      for ( i = 0; i <= 3; ++i )
      {
        dword_81D59CC[i + 68] -= 4;
        if ( !dword_81D59CC[i + 68] )
          unk_81D5ACC = 1;
        if ( dword_81D59CC[i + 68] == -16 )
          dword_81D59CC[i + 68] = 48;
      }
      goto LABEL_479;
    case 4:
      if ( unk_81D5AF0 != 9999 )
      {
        if ( unk_81D5AEC != 9999 )
          ++unk_81D5AEC;
        if ( unk_81D5AEC >= unk_81D5AF0 )
        {
          unk_81D5ACC = 1;
          unk_81D5B20 = 0;
        }
      }
      goto LABEL_479;
    case 5:
      if ( !(unsigned __int8)GetFadeActive() )
      {
        unk_81D5ACC = 1;
        unk_81D5B20 = 0;
      }
      goto LABEL_479;
    case 6:
      if ( unk_81D5AEC > 15 )
      {
        if ( gKeyTrg & gKeyOk )
        {
          PlaySoundObject(18, 1);
          if ( unk_81D5AF8 == 1 )
          {
            JumpTextScript(no);
          }
          else
          {
            unk_81D5ACC = 1;
            unk_81D5B20 = 0;
          }
        }
        else if ( gKeyTrg & gKeyLeft )
        {
          unk_81D5AF8 = 0;
          PlaySoundObject(1, 1);
        }
        else if ( gKeyTrg & gKeyRight )
        {
          unk_81D5AF8 = 1;
          PlaySoundObject(1, 1);
        }
      }
      else
      {
        ++unk_81D5AEC;
      }
      goto LABEL_479;
    case 7:
      if ( dword_81C8584 & 8 )
      {
        unk_81D5ACC = 1;
        unk_81D5B20 = 0;
      }
      goto LABEL_479;
  }
  while ( 1 )
  {
    while ( 1 )
    {
      while ( 1 )
      {
        while ( 1 )
        {
          while ( 1 )
          {
            while ( 1 )
            {
              while ( 1 )
              {
                while ( 1 )
                {
                  while ( 1 )
                  {
                    while ( 1 )
                    {
                      while ( 1 )
                      {
                        while ( 1 )
                        {
                          while ( 1 )
                          {
                            while ( 1 )
                            {
                              while ( 1 )
                              {
                                while ( 1 )
                                {
                                  while ( 1 )
                                  {
                                    while ( 1 )
                                    {
                                      while ( 1 )
                                      {
                                        while ( 1 )
                                        {
                                          while ( 1 )
                                          {
                                            while ( 1 )
                                            {
                                              while ( 1 )
                                              {
                                                while ( 1 )
                                                {
                                                  while ( 1 )
                                                  {
                                                    while ( 1 )
                                                    {
                                                      while ( 1 )
                                                      {
                                                        while ( 1 )
                                                        {
                                                          while ( 1 )
                                                          {
                                                            while ( 1 )
                                                            {
                                                              while ( 1 )
                                                              {
                                                                while ( 1 )
                                                                {
                                                                  while ( 1 )
                                                                  {
                                                                    while ( 1 )
                                                                    {
                                                                      while ( 1 )
                                                                      {
                                                                        while ( 1 )
                                                                        {
                                                                          while ( 1 )
                                                                          {
                                                                            while ( 1 )
                                                                            {
                                                                              while ( 1 )
                                                                              {
                                                                                while ( 1 )
                                                                                {
                                                                                  while ( 1 )
                                                                                  {
                                                                                    while ( 1 )
                                                                                    {
                                                                                      while ( 1 )
                                                                                      {
                                                                                        while ( 1 )
                                                                                        {
                                                                                          while ( 1 )
                                                                                          {
                                                                                            while ( 1 )
                                                                                            {
                                                                                              while ( 1 )
                                                                                              {
                                                                                                while ( 1 )
                                                                                                {
                                                                                                  while ( 1 )
                                                                                                  {
                                                                                                    while ( 1 )
                                                                                                    {
                                                                                                      while ( 1 )
                                                                                                      {
                                                                                                        while ( 1 )
                                                                                                        {
                                                                                                          while ( 1 )
                                                                                                          {
                                                                                                            while ( 1 )
                                                                                                            {
                                                                                                              while ( 1 )
                                                                                                              {
                                                                                                                while ( 1 )
                                                                                                                {
                                                                                                                  while ( 1 )
                                                                                                                  {
                                                                                                                    while ( 1 )
                                                                                                                    {
                                                                                                                      while ( 1 )
                                                                                                                      {
                                                                                                                        while ( 1 )
                                                                                                                        {
                                                                                                                          while ( 1 )
                                                                                                                          {
                                                                                                                            while ( 1 )
                                                                                                                            {
                                                                                                                              while ( 1 )
                                                                                                                              {
                                                                                                                                while ( 1 )
                                                                                                                                {
                                                                                                                                  while ( 1 )
                                                                                                                                  {
                                                                                                                                    while ( 1 )
                                                                                                                                    {
                                                                                                                                      while ( 1 )
                                                                                                                                      {
                                                                                                                                        while ( 1 )
                                                                                                                                        {
                                                                                                                                          while ( 1 )
                                                                                                                                          {
                                                                                                                                            while ( 1 )
                                                                                                                                            {
                                                                                                                                              while ( 1 )
                                                                                                                                              {
                                                                                                                                                while ( 1 )
                                                                                                                                                {
                                                                                                                                                  while ( 1 )
                                                                                                                                                  {
                                                                                                                                                    while ( 1 )
                                                                                                                                                    {
                                                                                                                                                      while ( 1 )
                                                                                                                                                      {
                                                                                                                                                        while ( 1 )
                                                                                                                                                        {
                                                                                                                                                          while ( 1 )
                                                                                                                                                          {
                                                                                                                                                            while ( 1 )
                                                                                                                                                            {
                                                                                                                                                              while ( 1 )
                                                                                                                                                              {
                                                                                                                                                                while ( 1 )
                                                                                                                                                                {
                                                                                                                                                                  while ( 1 )
                                                                                                                                                                  {
                                                                                                                                                                    while ( 1 )
                                                                                                                                                                    {
                                                                                                                                                                      while ( 1 )
                                                                                                                                                                      {
                                                                                                                                                                        while ( 1 )
                                                                                                                                                                        {
                                                                                                                                                                          while ( 1 )
                                                                                                                                                                          {
                                                                                                                                                                            while ( 1 )
                                                                                                                                                                            {
                                                                                                                                                                              while ( 1 )
                                                                                                                                                                              {
                                                                                                                                                                                while ( 1 )
                                                                                                                                                                                {
                                                                                                                                                                                  while ( 1 )
                                                                                                                                                                                  {
                                                                                                                                                                                    while ( 1 )
                                                                                                                                                                                    {
                                                                                                                                                                                      while ( 1 )
                                                                                                                                                                                      {
                                                                                                                                                                                        while ( 1 )
                                                                                                                                                                                        {
                                                                                                                                                                                          if ( bExit == 1 )
                                                                                                                                                                                          {
LABEL_479:
                                                                                                                                                                                            if ( unk_81D5ACC )
                                                                                                                                                                                              g_GameFlags |= 4u;
                                                                                                                                                                                            else
                                                                                                                                                                                              g_GameFlags &= 0xFFFFFFFB;
                                                                                                                                                                                            return 1;
                                                                                                                                                                                          }
                                                                                                                                                                                          if ( unk_81D5AC8[unk_81D5AD0] == 60 )
                                                                                                                                                                                            break;
                                                                                                                                                                                          if ( unk_81D5AC8[unk_81D5AD0] == 13 )
                                                                                                                                                                                          {
                                                                                                                                                                                            unk_81D5AD0 += 2;
                                                                                                                                                                                            unk_81D5AD4 = 0;
                                                                                                                                                                                            if ( unk_81D5ACD & 1 )
                                                                                                                                                                                            {
                                                                                                                                                                                              ++unk_81D5AD8;
                                                                                                                                                                                              CheckNewLine();
                                                                                                                                                                                            }
                                                                                                                                                                                          }
                                                                                                                                                                                          else if ( unk_81D5ACD & 0x10 )
                                                                                                                                                                                          {
                                                                                                                                                                                            for ( x = unk_81D5AD0;
                                                                                                                                                                                                  ;
                                                                                                                                                                                                  ++x )
                                                                                                                                                                                            {
                                                                                                                                                                                              v5 = unk_81D5AC8[x] == 60 || unk_81D5AC8[x] == 13 ? 0 : 1;
                                                                                                                                                                                              if ( !v5 )
                                                                                                                                                                                                break;
                                                                                                                                                                                              if ( (unk_81D5AC8[x] & 0x80u) != 0 )
                                                                                                                                                                                                ++x;
                                                                                                                                                                                            }
                                                                                                                                                                                            y = x - unk_81D5AD0;
                                                                                                                                                                                            memcpy(str, &unk_81D5AC8[unk_81D5AD0], x - unk_81D5AD0);
                                                                                                                                                                                            str[y] = 0;
                                                                                                                                                                                            unk_81D5AD4 = x;
                                                                                                                                                                                            v6 = unk_81D5AD8 % 4 + 30;
                                                                                                                                                                                            RGB((int)&r, 0xFFu, 0xFFu, 254);
                                                                                                                                                                                            PutText2(0, 0, str, (const SDL_Color_0 *const )&r, v6);
                                                                                                                                                                                            sprintf((char *)((unk_81D5AD8 % 4 << 6) + 136141632), str);
                                                                                                                                                                                            unk_81D5AD0 += y;
                                                                                                                                                                                            if ( unk_81D5AD4 > 34 )
                                                                                                                                                                                              CheckNewLine();
                                                                                                                                                                                            bExit = 1;
                                                                                                                                                                                          }
                                                                                                                                                                                          else
                                                                                                                                                                                          {
                                                                                                                                                                                            c[0] = unk_81D5AC8[unk_81D5AD0];
                                                                                                                                                                                            if ( c[0] >= 0 )
                                                                                                                                                                                            {
                                                                                                                                                                                              c[1] = 0;
                                                                                                                                                                                            }
                                                                                                                                                                                            else
                                                                                                                                                                                            {
                                                                                                                                                                                              c[1] = unk_81D5AC8[unk_81D5AD0 + 1];
                                                                                                                                                                                              c[2] = 0;
                                                                                                                                                                                            }
                                                                                                                                                                                            if ( c[0] == 61 )
                                                                                                                                                                                            {
                                                                                                                                                                                              Surface2Surface(6 * unk_81D5AD4, 2, &rcSymbol, unk_81D5AD8 % 4 + 30, 26);
                                                                                                                                                                                            }
                                                                                                                                                                                            else
                                                                                                                                                                                            {
                                                                                                                                                                                              v7 = unk_81D5AD8 % 4 + 30;
                                                                                                                                                                                              RGB((int)&v14, 0xFFu, 0xFFu, 254);
                                                                                                                                                                                              PutText2(6 * unk_81D5AD4, 0, c, (const SDL_Color_0 *const )&v14, v7);
                                                                                                                                                                                            }
                                                                                                                                                                                            strcat((char *)((unk_81D5AD8 % 4 << 6) + 136141632), c);
                                                                                                                                                                                            PlaySoundObject(2, 1);
                                                                                                                                                                                            unk_81D5B20 = 0;
                                                                                                                                                                                            if ( c[0] >= 0 )
                                                                                                                                                                                            {
                                                                                                                                                                                              ++unk_81D5AD0;
                                                                                                                                                                                              ++unk_81D5AD4;
                                                                                                                                                                                            }
                                                                                                                                                                                            else
                                                                                                                                                                                            {
                                                                                                                                                                                              unk_81D5AD0 += 2;
                                                                                                                                                                                              unk_81D5AD4 += 2;
                                                                                                                                                                                            }
                                                                                                                                                                                            if ( unk_81D5AD4 > 34 )
                                                                                                                                                                                            {
                                                                                                                                                                                              CheckNewLine();
                                                                                                                                                                                              unk_81D5AD4 = 0;
                                                                                                                                                                                              ++unk_81D5AD8;
                                                                                                                                                                                              CheckNewLine();
                                                                                                                                                                                            }
                                                                                                                                                                                            bExit = 1;
                                                                                                                                                                                          }
                                                                                                                                                                                        }
                                                                                                                                                                                        if ( unk_81D5AC8[unk_81D5AD0 + 1] != 69 || unk_81D5AC8[unk_81D5AD0 + 2] != 78 || unk_81D5AC8[unk_81D5AD0 + 3] != 68 )
                                                                                                                                                                                          break;
                                                                                                                                                                                        unk_81D5ACC = 0;
                                                                                                                                                                                        gMC.cond &= 0xFEu;
                                                                                                                                                                                        g_GameFlags |= 3u;
                                                                                                                                                                                        unk_81D5AFC = 0;
                                                                                                                                                                                        bExit = 1;
                                                                                                                                                                                      }
                                                                                                                                                                                      if ( unk_81D5AC8[unk_81D5AD0 + 1] != 76 || unk_81D5AC8[unk_81D5AD0 + 2] != 73 || unk_81D5AC8[unk_81D5AD0 + 3] != 43 )
                                                                                                                                                                                        break;
                                                                                                                                                                                      x = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                                                                                                                      AddLifeMyChar(x);
                                                                                                                                                                                      unk_81D5AD0 += 8;
                                                                                                                                                                                    }
                                                                                                                                                                                    if ( unk_81D5AC8[unk_81D5AD0 + 1] != 77 || unk_81D5AC8[unk_81D5AD0 + 2] != 76 || unk_81D5AC8[unk_81D5AD0 + 3] != 43 )
                                                                                                                                                                                      break;
                                                                                                                                                                                    z = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                                                                                                                    AddMaxLifeMyChar(z);
                                                                                                                                                                                    unk_81D5AD0 += 8;
                                                                                                                                                                                  }
                                                                                                                                                                                  if ( unk_81D5AC8[unk_81D5AD0 + 1] != 65 || unk_81D5AC8[unk_81D5AD0 + 2] != 69 || unk_81D5AC8[unk_81D5AD0 + 3] != 43 )
                                                                                                                                                                                    break;
                                                                                                                                                                                  FullArmsEnergy();
                                                                                                                                                                                  unk_81D5AD0 += 4;
                                                                                                                                                                                }
                                                                                                                                                                                if ( unk_81D5AC8[unk_81D5AD0 + 1] != 73 || unk_81D5AC8[unk_81D5AD0 + 2] != 84 || unk_81D5AC8[unk_81D5AD0 + 3] != 43 )
                                                                                                                                                                                  break;
                                                                                                                                                                                x = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                                                                                                                PlaySoundObject(38, 1);
                                                                                                                                                                                AddItemData(x);
                                                                                                                                                                                unk_81D5AD0 += 8;
                                                                                                                                                                              }
                                                                                                                                                                              if ( unk_81D5AC8[unk_81D5AD0 + 1] != 73 || unk_81D5AC8[unk_81D5AD0 + 2] != 84 || unk_81D5AC8[unk_81D5AD0 + 3] != 45 )
                                                                                                                                                                                break;
                                                                                                                                                                              z = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                                                                                                              SubItemData(z);
                                                                                                                                                                              unk_81D5AD0 += 8;
                                                                                                                                                                            }
                                                                                                                                                                            if ( unk_81D5AC8[unk_81D5AD0 + 1] != 69 || unk_81D5AC8[unk_81D5AD0 + 2] != 81 || unk_81D5AC8[unk_81D5AD0 + 3] != 43 )
                                                                                                                                                                              break;
                                                                                                                                                                            z = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                                                                                                            EquipItem(z, 1);
                                                                                                                                                                            unk_81D5AD0 += 8;
                                                                                                                                                                          }
                                                                                                                                                                          if ( unk_81D5AC8[unk_81D5AD0 + 1] != 69 || unk_81D5AC8[unk_81D5AD0 + 2] != 81 || unk_81D5AC8[unk_81D5AD0 + 3] != 45 )
                                                                                                                                                                            break;
                                                                                                                                                                          z = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                                                                                                          EquipItem(z, 0);
                                                                                                                                                                          unk_81D5AD0 += 8;
                                                                                                                                                                        }
                                                                                                                                                                        if ( unk_81D5AC8[unk_81D5AD0 + 1] != 65 || unk_81D5AC8[unk_81D5AD0 + 2] != 77 || unk_81D5AC8[unk_81D5AD0 + 3] != 43 )
                                                                                                                                                                          break;
                                                                                                                                                                        w = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                                                                                                        x = GetTextScriptNo(unk_81D5AD0 + 9);
                                                                                                                                                                        gNumberTextScript[0] = x;
                                                                                                                                                                        gNumberTextScript[1] = z;
                                                                                                                                                                        PlaySoundObject(38, 1);
                                                                                                                                                                        AddArmsData(w, x);
                                                                                                                                                                        unk_81D5AD0 += 13;
                                                                                                                                                                      }
                                                                                                                                                                      if ( unk_81D5AC8[unk_81D5AD0 + 1] != 65 || unk_81D5AC8[unk_81D5AD0 + 2] != 77 || unk_81D5AC8[unk_81D5AD0 + 3] != 45 )
                                                                                                                                                                        break;
                                                                                                                                                                      z = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                                                                                                      SubArmsData(z);
                                                                                                                                                                      unk_81D5AD0 += 8;
                                                                                                                                                                    }
                                                                                                                                                                    if ( unk_81D5AC8[unk_81D5AD0 + 1] != 90 || unk_81D5AC8[unk_81D5AD0 + 2] != 65 || unk_81D5AC8[unk_81D5AD0 + 3] != 77 )
                                                                                                                                                                      break;
                                                                                                                                                                    ZeroArmsEnergy_All();
                                                                                                                                                                    unk_81D5AD0 += 4;
                                                                                                                                                                  }
                                                                                                                                                                  if ( unk_81D5AC8[unk_81D5AD0 + 1] != 84 || unk_81D5AC8[unk_81D5AD0 + 2] != 65 || unk_81D5AC8[unk_81D5AD0 + 3] != 77 )
                                                                                                                                                                    break;
                                                                                                                                                                  x = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                                                                                                  y = GetTextScriptNo(unk_81D5AD0 + 9);
                                                                                                                                                                  z = GetTextScriptNo(unk_81D5AD0 + 14);
                                                                                                                                                                  TradeArms(x, y, z);
                                                                                                                                                                  unk_81D5AD0 += 18;
                                                                                                                                                                }
                                                                                                                                                                if ( unk_81D5AC8[unk_81D5AD0 + 1] != 80 || unk_81D5AC8[unk_81D5AD0 + 2] != 83 || unk_81D5AC8[unk_81D5AD0 + 3] != 43 )
                                                                                                                                                                  break;
                                                                                                                                                                x = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                                                                                                y = GetTextScriptNo(unk_81D5AD0 + 9);
                                                                                                                                                                AddPermitStage(x, y);
                                                                                                                                                                unk_81D5AD0 += 13;
                                                                                                                                                              }
                                                                                                                                                              if ( unk_81D5AC8[unk_81D5AD0 + 1] != 77 || unk_81D5AC8[unk_81D5AD0 + 2] != 80 || unk_81D5AC8[unk_81D5AD0 + 3] != 43 )
                                                                                                                                                                break;
                                                                                                                                                              x = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                                                                                              SetMapping(x);
                                                                                                                                                              unk_81D5AD0 += 8;
                                                                                                                                                            }
                                                                                                                                                            if ( unk_81D5AC8[unk_81D5AD0 + 1] != 85 || unk_81D5AC8[unk_81D5AD0 + 2] != 78 || unk_81D5AC8[unk_81D5AD0 + 3] != 73 )
                                                                                                                                                              break;
                                                                                                                                                            z = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                                                                                            ChangeMyUnit(z);
                                                                                                                                                            unk_81D5AD0 += 8;
                                                                                                                                                          }
                                                                                                                                                          if ( unk_81D5AC8[unk_81D5AD0 + 1] != 83 || unk_81D5AC8[unk_81D5AD0 + 2] != 84 || unk_81D5AC8[unk_81D5AD0 + 3] != 67 )
                                                                                                                                                            break;
                                                                                                                                                          SaveTimeCounter();
                                                                                                                                                          unk_81D5AD0 += 4;
                                                                                                                                                        }
                                                                                                                                                        if ( unk_81D5AC8[unk_81D5AD0 + 1] != 84 || unk_81D5AC8[unk_81D5AD0 + 2] != 82 || unk_81D5AC8[unk_81D5AD0 + 3] != 65 )
                                                                                                                                                          break;
                                                                                                                                                        z = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                                                                                        w = GetTextScriptNo(unk_81D5AD0 + 9);
                                                                                                                                                        x = GetTextScriptNo(unk_81D5AD0 + 14);
                                                                                                                                                        y = GetTextScriptNo(unk_81D5AD0 + 19);
                                                                                                                                                        if ( (unsigned __int8)TransferStage(z, w, x, y) ^ 1 )
                                                                                                                                                          return 0;
                                                                                                                                                      }
                                                                                                                                                      if ( unk_81D5AC8[unk_81D5AD0 + 1] != 77 || unk_81D5AC8[unk_81D5AD0 + 2] != 79 || unk_81D5AC8[unk_81D5AD0 + 3] != 86 )
                                                                                                                                                        break;
                                                                                                                                                      x = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                                                                                      y = GetTextScriptNo(unk_81D5AD0 + 9);
                                                                                                                                                      SetMyCharPosition(x << 13, y << 13);
                                                                                                                                                      unk_81D5AD0 += 13;
                                                                                                                                                    }
                                                                                                                                                    if ( unk_81D5AC8[unk_81D5AD0 + 1] != 72 || unk_81D5AC8[unk_81D5AD0 + 2] != 77 || unk_81D5AC8[unk_81D5AD0 + 3] != 67 )
                                                                                                                                                      break;
                                                                                                                                                    ShowMyChar(0);
                                                                                                                                                    unk_81D5AD0 += 4;
                                                                                                                                                  }
                                                                                                                                                  if ( unk_81D5AC8[unk_81D5AD0 + 1] != 83 || unk_81D5AC8[unk_81D5AD0 + 2] != 77 || unk_81D5AC8[unk_81D5AD0 + 3] != 67 )
                                                                                                                                                    break;
                                                                                                                                                  ShowMyChar(1);
                                                                                                                                                  unk_81D5AD0 += 4;
                                                                                                                                                }
                                                                                                                                                if ( unk_81D5AC8[unk_81D5AD0 + 1] != 70 || unk_81D5AC8[unk_81D5AD0 + 2] != 76 || unk_81D5AC8[unk_81D5AD0 + 3] != 43 )
                                                                                                                                                  break;
                                                                                                                                                z = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                                                                                SetNPCFlag(z);
                                                                                                                                                unk_81D5AD0 += 8;
                                                                                                                                              }
                                                                                                                                              if ( unk_81D5AC8[unk_81D5AD0 + 1] != 70 || unk_81D5AC8[unk_81D5AD0 + 2] != 76 || unk_81D5AC8[unk_81D5AD0 + 3] != 45 )
                                                                                                                                                break;
                                                                                                                                              z = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                                                                              CutNPCFlag(z);
                                                                                                                                              unk_81D5AD0 += 8;
                                                                                                                                            }
                                                                                                                                            if ( unk_81D5AC8[unk_81D5AD0 + 1] != 83 || unk_81D5AC8[unk_81D5AD0 + 2] != 75 || unk_81D5AC8[unk_81D5AD0 + 3] != 43 )
                                                                                                                                              break;
                                                                                                                                            z = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                                                                            SetSkipFlag(z);
                                                                                                                                            unk_81D5AD0 += 8;
                                                                                                                                          }
                                                                                                                                          if ( unk_81D5AC8[unk_81D5AD0 + 1] != 83 || unk_81D5AC8[unk_81D5AD0 + 2] != 75 || unk_81D5AC8[unk_81D5AD0 + 3] != 45 )
                                                                                                                                            break;
                                                                                                                                          z = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                                                                          CutSkipFlag(z);
                                                                                                                                          unk_81D5AD0 += 8;
                                                                                                                                        }
                                                                                                                                        if ( unk_81D5AC8[unk_81D5AD0 + 1] != 75 || unk_81D5AC8[unk_81D5AD0 + 2] != 69 || unk_81D5AC8[unk_81D5AD0 + 3] != 89 )
                                                                                                                                          break;
                                                                                                                                        g_GameFlags &= 0xFFFFFFFD;
                                                                                                                                        g_GameFlags |= 1u;
                                                                                                                                        unk_81C858C = 0;
                                                                                                                                        unk_81C8610 = 0;
                                                                                                                                        unk_81D5AD0 += 4;
                                                                                                                                      }
                                                                                                                                      if ( unk_81D5AC8[unk_81D5AD0 + 1] != 80 || unk_81D5AC8[unk_81D5AD0 + 2] != 82 || unk_81D5AC8[unk_81D5AD0 + 3] != 73 )
                                                                                                                                        break;
                                                                                                                                      g_GameFlags &= 0xFFFFFFFC;
                                                                                                                                      unk_81C8610 = 0;
                                                                                                                                      unk_81D5AD0 += 4;
                                                                                                                                    }
                                                                                                                                    if ( unk_81D5AC8[unk_81D5AD0 + 1] != 70 || unk_81D5AC8[unk_81D5AD0 + 2] != 82 || unk_81D5AC8[unk_81D5AD0 + 3] != 69 )
                                                                                                                                      break;
                                                                                                                                    g_GameFlags |= 3u;
                                                                                                                                    unk_81D5AD0 += 4;
                                                                                                                                  }
                                                                                                                                  if ( unk_81D5AC8[unk_81D5AD0 + 1] != 78 || unk_81D5AC8[unk_81D5AD0 + 2] != 79 || unk_81D5AC8[unk_81D5AD0 + 3] != 68 )
                                                                                                                                    break;
                                                                                                                                  unk_81D5ACC = 2;
                                                                                                                                  unk_81D5AD0 += 4;
                                                                                                                                  bExit = 1;
                                                                                                                                }
                                                                                                                                if ( unk_81D5AC8[unk_81D5AD0 + 1] != 67 || unk_81D5AC8[unk_81D5AD0 + 2] != 76 || unk_81D5AC8[unk_81D5AD0 + 3] != 82 )
                                                                                                                                  break;
                                                                                                                                ClearTextLine();
                                                                                                                                unk_81D5AD0 += 4;
                                                                                                                              }
                                                                                                                              if ( unk_81D5AC8[unk_81D5AD0 + 1] != 77 || unk_81D5AC8[unk_81D5AD0 + 2] != 83 || unk_81D5AC8[unk_81D5AD0 + 3] != 71 )
                                                                                                                                break;
                                                                                                                              ClearTextLine();
                                                                                                                              unk_81D5ACD |= 3u;
                                                                                                                              unk_81D5ACD &= 0xCFu;
                                                                                                                              if ( unk_81D5ACD & 0x40 )
                                                                                                                                unk_81D5ACD |= 0x10u;
                                                                                                                              unk_81D5AD0 += 4;
                                                                                                                              bExit = 1;
                                                                                                                            }
                                                                                                                            if ( unk_81D5AC8[unk_81D5AD0 + 1] != 77 || unk_81D5AC8[unk_81D5AD0 + 2] != 83 || unk_81D5AC8[unk_81D5AD0 + 3] != 50 )
                                                                                                                              break;
                                                                                                                            ClearTextLine();
                                                                                                                            unk_81D5ACD &= 0xEDu;
                                                                                                                            unk_81D5ACD |= 0x21u;
                                                                                                                            if ( unk_81D5ACD & 0x40 )
                                                                                                                              unk_81D5ACD |= 0x10u;
                                                                                                                            unk_81D5AFC = 0;
                                                                                                                            unk_81D5AD0 += 4;
                                                                                                                            bExit = 1;
                                                                                                                          }
                                                                                                                          if ( unk_81D5AC8[unk_81D5AD0 + 1] != 77 || unk_81D5AC8[unk_81D5AD0 + 2] != 83 || unk_81D5AC8[unk_81D5AD0 + 3] != 51 )
                                                                                                                            break;
                                                                                                                          ClearTextLine();
                                                                                                                          unk_81D5ACD &= 0xEFu;
                                                                                                                          unk_81D5ACD |= 0x23u;
                                                                                                                          if ( unk_81D5ACD & 0x40 )
                                                                                                                            unk_81D5ACD |= 0x10u;
                                                                                                                          unk_81D5AD0 += 4;
                                                                                                                          bExit = 1;
                                                                                                                        }
                                                                                                                        if ( unk_81D5AC8[unk_81D5AD0 + 1] != 87 || unk_81D5AC8[unk_81D5AD0 + 2] != 65 || unk_81D5AC8[unk_81D5AD0 + 3] != 73 )
                                                                                                                          break;
                                                                                                                        unk_81D5ACC = 4;
                                                                                                                        unk_81D5AF0 = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                                                        unk_81D5AD0 += 8;
                                                                                                                        bExit = 1;
                                                                                                                      }
                                                                                                                      if ( unk_81D5AC8[unk_81D5AD0 + 1] != 87 || unk_81D5AC8[unk_81D5AD0 + 2] != 65 || unk_81D5AC8[unk_81D5AD0 + 3] != 83 )
                                                                                                                        break;
                                                                                                                      unk_81D5ACC = 7;
                                                                                                                      unk_81D5AD0 += 4;
                                                                                                                      bExit = 1;
                                                                                                                    }
                                                                                                                    if ( unk_81D5AC8[unk_81D5AD0 + 1] != 84 || unk_81D5AC8[unk_81D5AD0 + 2] != 85 || unk_81D5AC8[unk_81D5AD0 + 3] != 82 )
                                                                                                                      break;
                                                                                                                    unk_81D5AD0 += 4;
                                                                                                                    unk_81D5ACD |= 0x10u;
                                                                                                                  }
                                                                                                                  if ( unk_81D5AC8[unk_81D5AD0 + 1] != 83 || unk_81D5AC8[unk_81D5AD0 + 2] != 65 || unk_81D5AC8[unk_81D5AD0 + 3] != 84 )
                                                                                                                    break;
                                                                                                                  unk_81D5AD0 += 4;
                                                                                                                  unk_81D5ACD |= 0x40u;
                                                                                                                }
                                                                                                                if ( unk_81D5AC8[unk_81D5AD0 + 1] != 67 || unk_81D5AC8[unk_81D5AD0 + 2] != 65 || unk_81D5AC8[unk_81D5AD0 + 3] != 84 )
                                                                                                                  break;
                                                                                                                unk_81D5AD0 += 4;
                                                                                                                unk_81D5ACD |= 0x40u;
                                                                                                              }
                                                                                                              if ( unk_81D5AC8[unk_81D5AD0 + 1] != 67 || unk_81D5AC8[unk_81D5AD0 + 2] != 76 || unk_81D5AC8[unk_81D5AD0 + 3] != 79 )
                                                                                                                break;
                                                                                                              unk_81D5ACD &= 0xCCu;
                                                                                                              unk_81D5AD0 += 4;
                                                                                                            }
                                                                                                            if ( unk_81D5AC8[unk_81D5AD0 + 1] != 69 || unk_81D5AC8[unk_81D5AD0 + 2] != 86 || unk_81D5AC8[unk_81D5AD0 + 3] != 69 )
                                                                                                              break;
                                                                                                            z = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                                            JumpTextScript(z);
                                                                                                          }
                                                                                                          if ( unk_81D5AC8[unk_81D5AD0 + 1] != 89 || unk_81D5AC8[unk_81D5AD0 + 2] != 78 || unk_81D5AC8[unk_81D5AD0 + 3] != 74 )
                                                                                                            break;
                                                                                                          no = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                                          unk_81D5AD0 += 8;
                                                                                                          unk_81D5ACC = 6;
                                                                                                          PlaySoundObject(5, 1);
                                                                                                          unk_81D5AEC = 0;
                                                                                                          unk_81D5AF8 = 0;
                                                                                                          bExit = 1;
                                                                                                        }
                                                                                                        if ( unk_81D5AC8[unk_81D5AD0 + 1] != 70 || unk_81D5AC8[unk_81D5AD0 + 2] != 76 || unk_81D5AC8[unk_81D5AD0 + 3] != 74 )
                                                                                                          break;
                                                                                                        x = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                                        z = GetTextScriptNo(unk_81D5AD0 + 9);
                                                                                                        if ( (unsigned __int8)GetNPCFlag(x) )
                                                                                                          JumpTextScript(z);
                                                                                                        else
                                                                                                          unk_81D5AD0 += 13;
                                                                                                      }
                                                                                                      if ( unk_81D5AC8[unk_81D5AD0 + 1] != 83 || unk_81D5AC8[unk_81D5AD0 + 2] != 75 || unk_81D5AC8[unk_81D5AD0 + 3] != 74 )
                                                                                                        break;
                                                                                                      x = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                                      z = GetTextScriptNo(unk_81D5AD0 + 9);
                                                                                                      if ( (unsigned __int8)GetSkipFlag(x) )
                                                                                                        JumpTextScript(z);
                                                                                                      else
                                                                                                        unk_81D5AD0 += 13;
                                                                                                    }
                                                                                                    if ( unk_81D5AC8[unk_81D5AD0 + 1] != 73 || unk_81D5AC8[unk_81D5AD0 + 2] != 84 || unk_81D5AC8[unk_81D5AD0 + 3] != 74 )
                                                                                                      break;
                                                                                                    x = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                                    z = GetTextScriptNo(unk_81D5AD0 + 9);
                                                                                                    if ( (unsigned __int8)CheckItem(x) )
                                                                                                      JumpTextScript(z);
                                                                                                    else
                                                                                                      unk_81D5AD0 += 13;
                                                                                                  }
                                                                                                  if ( unk_81D5AC8[unk_81D5AD0 + 1] != 65 || unk_81D5AC8[unk_81D5AD0 + 2] != 77 || unk_81D5AC8[unk_81D5AD0 + 3] != 74 )
                                                                                                    break;
                                                                                                  x = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                                  z = GetTextScriptNo(unk_81D5AD0 + 9);
                                                                                                  if ( (unsigned __int8)CheckArms(x) )
                                                                                                    JumpTextScript(z);
                                                                                                  else
                                                                                                    unk_81D5AD0 += 13;
                                                                                                }
                                                                                                if ( unk_81D5AC8[unk_81D5AD0 + 1] != 85 || unk_81D5AC8[unk_81D5AD0 + 2] != 78 || unk_81D5AC8[unk_81D5AD0 + 3] != 74 )
                                                                                                  break;
                                                                                                x = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                                z = GetTextScriptNo(unk_81D5AD0 + 9);
                                                                                                if ( GetUnitMyChar() == x )
                                                                                                  JumpTextScript(z);
                                                                                                else
                                                                                                  unk_81D5AD0 += 13;
                                                                                              }
                                                                                              if ( unk_81D5AC8[unk_81D5AD0 + 1] != 69
                                                                                                || unk_81D5AC8[unk_81D5AD0 + 2] != 67
                                                                                                || unk_81D5AC8[unk_81D5AD0 + 3] != 74 )
                                                                                              {
                                                                                                break;
                                                                                              }
                                                                                              x = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                              z = GetTextScriptNo(unk_81D5AD0 + 9);
                                                                                              if ( (unsigned __int8)GetNpCharAlive(x) )
                                                                                                JumpTextScript(z);
                                                                                              else
                                                                                                unk_81D5AD0 += 13;
                                                                                            }
                                                                                            if ( unk_81D5AC8[unk_81D5AD0 + 1] != 78
                                                                                              || unk_81D5AC8[unk_81D5AD0 + 2] != 67
                                                                                              || unk_81D5AC8[unk_81D5AD0 + 3] != 74 )
                                                                                            {
                                                                                              break;
                                                                                            }
                                                                                            x = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                            z = GetTextScriptNo(unk_81D5AD0 + 9);
                                                                                            if ( (unsigned __int8)IsNpCharCode(x) )
                                                                                              JumpTextScript(z);
                                                                                            else
                                                                                              unk_81D5AD0 += 13;
                                                                                          }
                                                                                          if ( unk_81D5AC8[unk_81D5AD0 + 1] != 77
                                                                                            || unk_81D5AC8[unk_81D5AD0 + 2] != 80
                                                                                            || unk_81D5AC8[unk_81D5AD0 + 3] != 74 )
                                                                                          {
                                                                                            break;
                                                                                          }
                                                                                          x = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                          if ( (unsigned __int8)IsMapping() )
                                                                                            JumpTextScript(x);
                                                                                          else
                                                                                            unk_81D5AD0 += 8;
                                                                                        }
                                                                                        if ( unk_81D5AC8[unk_81D5AD0 + 1] != 83
                                                                                          || unk_81D5AC8[unk_81D5AD0 + 2] != 83
                                                                                          || unk_81D5AC8[unk_81D5AD0 + 3] != 83 )
                                                                                        {
                                                                                          break;
                                                                                        }
                                                                                        x = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                        SetNoise(1, x);
                                                                                        unk_81D5AD0 += 8;
                                                                                      }
                                                                                      if ( unk_81D5AC8[unk_81D5AD0 + 1] != 67
                                                                                        || unk_81D5AC8[unk_81D5AD0 + 2] != 83
                                                                                        || unk_81D5AC8[unk_81D5AD0 + 3] != 83 )
                                                                                      {
                                                                                        break;
                                                                                      }
                                                                                      CutNoise();
                                                                                      unk_81D5AD0 += 4;
                                                                                    }
                                                                                    if ( unk_81D5AC8[unk_81D5AD0 + 1] != 83
                                                                                      || unk_81D5AC8[unk_81D5AD0 + 2] != 80
                                                                                      || unk_81D5AC8[unk_81D5AD0 + 3] != 83 )
                                                                                    {
                                                                                      break;
                                                                                    }
                                                                                    SetNoise(2, x);
                                                                                    unk_81D5AD0 += 4;
                                                                                  }
                                                                                  if ( unk_81D5AC8[unk_81D5AD0 + 1] != 67
                                                                                    || unk_81D5AC8[unk_81D5AD0 + 2] != 80
                                                                                    || unk_81D5AC8[unk_81D5AD0 + 3] != 83 )
                                                                                  {
                                                                                    break;
                                                                                  }
                                                                                  CutNoise();
                                                                                  unk_81D5AD0 += 4;
                                                                                }
                                                                                if ( unk_81D5AC8[unk_81D5AD0 + 1] != 81
                                                                                  || unk_81D5AC8[unk_81D5AD0 + 2] != 85
                                                                                  || unk_81D5AC8[unk_81D5AD0 + 3] != 65 )
                                                                                {
                                                                                  break;
                                                                                }
                                                                                z = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                                SetQuake(z);
                                                                                unk_81D5AD0 += 8;
                                                                              }
                                                                              if ( unk_81D5AC8[unk_81D5AD0 + 1] != 70
                                                                                || unk_81D5AC8[unk_81D5AD0 + 2] != 76
                                                                                || unk_81D5AC8[unk_81D5AD0 + 3] != 65 )
                                                                              {
                                                                                break;
                                                                              }
                                                                              SetFlash(0, 0, 2);
                                                                              unk_81D5AD0 += 4;
                                                                            }
                                                                            if ( unk_81D5AC8[unk_81D5AD0 + 1] != 70
                                                                              || unk_81D5AC8[unk_81D5AD0 + 2] != 65
                                                                              || unk_81D5AC8[unk_81D5AD0 + 3] != 73 )
                                                                            {
                                                                              break;
                                                                            }
                                                                            z = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                            StartFadeIn(z);
                                                                            unk_81D5ACC = 5;
                                                                            unk_81D5AD0 += 8;
                                                                            bExit = 1;
                                                                          }
                                                                          if ( unk_81D5AC8[unk_81D5AD0 + 1] != 70
                                                                            || unk_81D5AC8[unk_81D5AD0 + 2] != 65
                                                                            || unk_81D5AC8[unk_81D5AD0 + 3] != 79 )
                                                                          {
                                                                            break;
                                                                          }
                                                                          z = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                          StartFadeOut(z);
                                                                          unk_81D5ACC = 5;
                                                                          unk_81D5AD0 += 8;
                                                                          bExit = 1;
                                                                        }
                                                                        if ( unk_81D5AC8[unk_81D5AD0 + 1] != 77
                                                                          || unk_81D5AC8[unk_81D5AD0 + 2] != 78
                                                                          || unk_81D5AC8[unk_81D5AD0 + 3] != 65 )
                                                                        {
                                                                          break;
                                                                        }
                                                                        StartMapName();
                                                                        unk_81D5AD0 += 4;
                                                                      }
                                                                      if ( unk_81D5AC8[unk_81D5AD0 + 1] != 70
                                                                        || unk_81D5AC8[unk_81D5AD0 + 2] != 79
                                                                        || unk_81D5AC8[unk_81D5AD0 + 3] != 77 )
                                                                      {
                                                                        break;
                                                                      }
                                                                      z = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                      SetFrameTargetMyChar(z);
                                                                      unk_81D5AD0 += 8;
                                                                    }
                                                                    if ( unk_81D5AC8[unk_81D5AD0 + 1] != 70
                                                                      || unk_81D5AC8[unk_81D5AD0 + 2] != 79
                                                                      || unk_81D5AC8[unk_81D5AD0 + 3] != 78 )
                                                                    {
                                                                      break;
                                                                    }
                                                                    x = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                    y = GetTextScriptNo(unk_81D5AD0 + 9);
                                                                    SetFrameTargetNpChar(x, y);
                                                                    unk_81D5AD0 += 13;
                                                                  }
                                                                  if ( unk_81D5AC8[unk_81D5AD0 + 1] != 70
                                                                    || unk_81D5AC8[unk_81D5AD0 + 2] != 79
                                                                    || unk_81D5AC8[unk_81D5AD0 + 3] != 66 )
                                                                  {
                                                                    break;
                                                                  }
                                                                  x = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                  y = GetTextScriptNo(unk_81D5AD0 + 9);
                                                                  SetFrameTargetBoss(x, y);
                                                                  unk_81D5AD0 += 13;
                                                                }
                                                                if ( unk_81D5AC8[unk_81D5AD0 + 1] != 83
                                                                  || unk_81D5AC8[unk_81D5AD0 + 2] != 79
                                                                  || unk_81D5AC8[unk_81D5AD0 + 3] != 85 )
                                                                {
                                                                  break;
                                                                }
                                                                z = GetTextScriptNo(unk_81D5AD0 + 4);
                                                                PlaySoundObject(z, 1);
                                                                unk_81D5AD0 += 8;
                                                              }
                                                              if ( unk_81D5AC8[unk_81D5AD0 + 1] != 67
                                                                || unk_81D5AC8[unk_81D5AD0 + 2] != 77
                                                                || unk_81D5AC8[unk_81D5AD0 + 3] != 85 )
                                                              {
                                                                break;
                                                              }
                                                              z = GetTextScriptNo(unk_81D5AD0 + 4);
                                                              ChangeMusic(z);
                                                              unk_81D5AD0 += 8;
                                                            }
                                                            if ( unk_81D5AC8[unk_81D5AD0 + 1] != 70
                                                              || unk_81D5AC8[unk_81D5AD0 + 2] != 77
                                                              || unk_81D5AC8[unk_81D5AD0 + 3] != 85 )
                                                            {
                                                              break;
                                                            }
                                                            SetOrganyaFadeout();
                                                            unk_81D5AD0 += 4;
                                                          }
                                                          if ( unk_81D5AC8[unk_81D5AD0 + 1] != 82
                                                            || unk_81D5AC8[unk_81D5AD0 + 2] != 77
                                                            || unk_81D5AC8[unk_81D5AD0 + 3] != 85 )
                                                          {
                                                            break;
                                                          }
                                                          ReCallMusic();
                                                          unk_81D5AD0 += 4;
                                                        }
                                                        if ( unk_81D5AC8[unk_81D5AD0 + 1] != 77
                                                          || unk_81D5AC8[unk_81D5AD0 + 2] != 76
                                                          || unk_81D5AC8[unk_81D5AD0 + 3] != 80 )
                                                        {
                                                          break;
                                                        }
                                                        unk_81D5AD0 += 4;
                                                        bExit = 1;
                                                        v1 = MiniMapLoop();
                                                        if ( !v1 )
                                                          return 0;
                                                        if ( v1 == 2 )
                                                          return 2;
                                                      }
                                                      if ( unk_81D5AC8[unk_81D5AD0 + 1] != 83
                                                        || unk_81D5AC8[unk_81D5AD0 + 2] != 76
                                                        || unk_81D5AC8[unk_81D5AD0 + 3] != 80 )
                                                      {
                                                        break;
                                                      }
                                                      bExit = 1;
                                                      v2 = StageSelectLoop(&z);
                                                      if ( !v2 )
                                                        return 0;
                                                      if ( v2 == 2 )
                                                        return 2;
                                                      JumpTextScript(z);
                                                      g_GameFlags &= 0xFFFFFFFC;
                                                    }
                                                    if ( unk_81D5AC8[unk_81D5AD0 + 1] != 68
                                                      || unk_81D5AC8[unk_81D5AD0 + 2] != 78
                                                      || unk_81D5AC8[unk_81D5AD0 + 3] != 80 )
                                                    {
                                                      break;
                                                    }
                                                    z = GetTextScriptNo(unk_81D5AD0 + 4);
                                                    DeleteNpCharEvent(z);
                                                    unk_81D5AD0 += 8;
                                                  }
                                                  if ( unk_81D5AC8[unk_81D5AD0 + 1] != 68
                                                    || unk_81D5AC8[unk_81D5AD0 + 2] != 78
                                                    || unk_81D5AC8[unk_81D5AD0 + 3] != 65 )
                                                  {
                                                    break;
                                                  }
                                                  z = GetTextScriptNo(unk_81D5AD0 + 4);
                                                  DeleteNpCharCode(z, 1);
                                                  unk_81D5AD0 += 8;
                                                }
                                                if ( unk_81D5AC8[unk_81D5AD0 + 1] != 66
                                                  || unk_81D5AC8[unk_81D5AD0 + 2] != 79
                                                  || unk_81D5AC8[unk_81D5AD0 + 3] != 65 )
                                                {
                                                  break;
                                                }
                                                z = GetTextScriptNo(unk_81D5AD0 + 4);
                                                SetBossCharActNo(z);
                                                unk_81D5AD0 += 8;
                                              }
                                              if ( unk_81D5AC8[unk_81D5AD0 + 1] != 67
                                                || unk_81D5AC8[unk_81D5AD0 + 2] != 78
                                                || unk_81D5AC8[unk_81D5AD0 + 3] != 80 )
                                              {
                                                break;
                                              }
                                              x = GetTextScriptNo(unk_81D5AD0 + 4);
                                              y = GetTextScriptNo(unk_81D5AD0 + 9);
                                              z = GetTextScriptNo(unk_81D5AD0 + 14);
                                              ChangeNpCharByEvent(x, y, z);
                                              unk_81D5AD0 += 18;
                                            }
                                            if ( unk_81D5AC8[unk_81D5AD0 + 1] != 65
                                              || unk_81D5AC8[unk_81D5AD0 + 2] != 78
                                              || unk_81D5AC8[unk_81D5AD0 + 3] != 80 )
                                            {
                                              break;
                                            }
                                            x = GetTextScriptNo(unk_81D5AD0 + 4);
                                            y = GetTextScriptNo(unk_81D5AD0 + 9);
                                            z = GetTextScriptNo(unk_81D5AD0 + 14);
                                            SetNpCharActionNo(x, y, z);
                                            unk_81D5AD0 += 18;
                                          }
                                          if ( unk_81D5AC8[unk_81D5AD0 + 1] != 73
                                            || unk_81D5AC8[unk_81D5AD0 + 2] != 78
                                            || unk_81D5AC8[unk_81D5AD0 + 3] != 80 )
                                          {
                                            break;
                                          }
                                          x = GetTextScriptNo(unk_81D5AD0 + 4);
                                          y = GetTextScriptNo(unk_81D5AD0 + 9);
                                          z = GetTextScriptNo(unk_81D5AD0 + 14);
                                          ChangeCheckableNpCharByEvent(x, y, z);
                                          unk_81D5AD0 += 18;
                                        }
                                        if ( unk_81D5AC8[unk_81D5AD0 + 1] != 83
                                          || unk_81D5AC8[unk_81D5AD0 + 2] != 78
                                          || unk_81D5AC8[unk_81D5AD0 + 3] != 80 )
                                        {
                                          break;
                                        }
                                        w = GetTextScriptNo(unk_81D5AD0 + 4);
                                        x = GetTextScriptNo(unk_81D5AD0 + 9);
                                        y = GetTextScriptNo(unk_81D5AD0 + 14);
                                        z = GetTextScriptNo(unk_81D5AD0 + 19);
                                        SetNpChar(w, x << 13, y << 13, 0, 0, z, 0, 256);
                                        unk_81D5AD0 += 23;
                                      }
                                      if ( unk_81D5AC8[unk_81D5AD0 + 1] != 77
                                        || unk_81D5AC8[unk_81D5AD0 + 2] != 78
                                        || unk_81D5AC8[unk_81D5AD0 + 3] != 80 )
                                      {
                                        break;
                                      }
                                      w = GetTextScriptNo(unk_81D5AD0 + 4);
                                      x = GetTextScriptNo(unk_81D5AD0 + 9);
                                      y = GetTextScriptNo(unk_81D5AD0 + 14);
                                      z = GetTextScriptNo(unk_81D5AD0 + 19);
                                      MoveNpChar(w, x << 13, y << 13, z);
                                      unk_81D5AD0 += 23;
                                    }
                                    if ( unk_81D5AC8[unk_81D5AD0 + 1] != 83
                                      || unk_81D5AC8[unk_81D5AD0 + 2] != 77
                                      || unk_81D5AC8[unk_81D5AD0 + 3] != 80 )
                                    {
                                      break;
                                    }
                                    x = GetTextScriptNo(unk_81D5AD0 + 4);
                                    y = GetTextScriptNo(unk_81D5AD0 + 9);
                                    ShiftMapParts(x, y);
                                    unk_81D5AD0 += 13;
                                  }
                                  if ( unk_81D5AC8[unk_81D5AD0 + 1] != 67
                                    || unk_81D5AC8[unk_81D5AD0 + 2] != 77
                                    || unk_81D5AC8[unk_81D5AD0 + 3] != 80 )
                                  {
                                    break;
                                  }
                                  x = GetTextScriptNo(unk_81D5AD0 + 4);
                                  y = GetTextScriptNo(unk_81D5AD0 + 9);
                                  z = GetTextScriptNo(unk_81D5AD0 + 14);
                                  ChangeMapParts(x, y, z);
                                  unk_81D5AD0 += 18;
                                }
                                if ( unk_81D5AC8[unk_81D5AD0 + 1] != 66
                                  || unk_81D5AC8[unk_81D5AD0 + 2] != 83
                                  || unk_81D5AC8[unk_81D5AD0 + 3] != 76 )
                                {
                                  break;
                                }
                                z = GetTextScriptNo(unk_81D5AD0 + 4);
                                if ( z )
                                  StartBossLife(z);
                                else
                                  StartBossLife2();
                                unk_81D5AD0 += 8;
                              }
                              if ( unk_81D5AC8[unk_81D5AD0 + 1] != 77
                                || unk_81D5AC8[unk_81D5AD0 + 2] != 89
                                || unk_81D5AC8[unk_81D5AD0 + 3] != 68 )
                              {
                                break;
                              }
                              z = GetTextScriptNo(unk_81D5AD0 + 4);
                              SetMyCharDirect(z);
                              unk_81D5AD0 += 8;
                            }
                            if ( unk_81D5AC8[unk_81D5AD0 + 1] != 77
                              || unk_81D5AC8[unk_81D5AD0 + 2] != 89
                              || unk_81D5AC8[unk_81D5AD0 + 3] != 66 )
                            {
                              break;
                            }
                            z = GetTextScriptNo(unk_81D5AD0 + 4);
                            BackStepMyChar(z);
                            unk_81D5AD0 += 8;
                          }
                          if ( unk_81D5AC8[unk_81D5AD0 + 1] != 77
                            || unk_81D5AC8[unk_81D5AD0 + 2] != 77
                            || unk_81D5AC8[unk_81D5AD0 + 3] != 48 )
                          {
                            break;
                          }
                          ZeroMyCharXMove();
                          unk_81D5AD0 += 4;
                        }
                        if ( unk_81D5AC8[unk_81D5AD0 + 1] != 73
                          || unk_81D5AC8[unk_81D5AD0 + 2] != 78
                          || unk_81D5AC8[unk_81D5AD0 + 3] != 73 )
                        {
                          break;
                        }
                        InitializeGame();
                        unk_81D5AD0 += 4;
                      }
                      if ( unk_81D5AC8[unk_81D5AD0 + 1] != 83
                        || unk_81D5AC8[unk_81D5AD0 + 2] != 86
                        || unk_81D5AC8[unk_81D5AD0 + 3] != 80 )
                      {
                        break;
                      }
                      SaveProfile(0);
                      unk_81D5AD0 += 4;
                    }
                    if ( unk_81D5AC8[unk_81D5AD0 + 1] != 76
                      || unk_81D5AC8[unk_81D5AD0 + 2] != 68
                      || unk_81D5AC8[unk_81D5AD0 + 3] != 80 )
                    {
                      break;
                    }
                    if ( (unsigned __int8)LoadProfile(0) ^ 1 )
                      InitializeGame();
                  }
                  if ( unk_81D5AC8[unk_81D5AD0 + 1] != 70
                    || unk_81D5AC8[unk_81D5AD0 + 2] != 65
                    || unk_81D5AC8[unk_81D5AD0 + 3] != 67 )
                  {
                    break;
                  }
                  z = GetTextScriptNo(unk_81D5AD0 + 4);
                  if ( unk_81D5AFC != (char)z )
                  {
                    unk_81D5AFC = (char)z;
                    unk_81D5B00 = 2048;
                  }
                  unk_81D5AD0 += 8;
                }
                if ( unk_81D5AC8[unk_81D5AD0 + 1] != 70
                  || unk_81D5AC8[unk_81D5AD0 + 2] != 65
                  || unk_81D5AC8[unk_81D5AD0 + 3] != 67 )
                {
                  break;
                }
                z = GetTextScriptNo(unk_81D5AD0 + 4);
                if ( unk_81D5AFC != (char)z )
                {
                  unk_81D5AFC = (char)z;
                  unk_81D5B00 = 2048;
                }
                unk_81D5AD0 += 8;
              }
              if ( unk_81D5AC8[unk_81D5AD0 + 1] != 71
                || unk_81D5AC8[unk_81D5AD0 + 2] != 73
                || unk_81D5AC8[unk_81D5AD0 + 3] != 84 )
              {
                break;
              }
              z = GetTextScriptNo(unk_81D5AD0 + 4);
              dword_81D5B04 = z;
              dword_81D5B08 = 128;
              unk_81D5AD0 += 8;
            }
            if ( unk_81D5AC8[unk_81D5AD0 + 1] != 78
              || unk_81D5AC8[unk_81D5AD0 + 2] != 85
              || unk_81D5AC8[unk_81D5AD0 + 3] != 77 )
            {
              break;
            }
            z = GetTextScriptNo(unk_81D5AD0 + 4);
            SetNumberTextScript(z);
            unk_81D5AD0 += 8;
          }
          if ( unk_81D5AC8[unk_81D5AD0 + 1] != 67
            || unk_81D5AC8[unk_81D5AD0 + 2] != 82
            || unk_81D5AC8[unk_81D5AD0 + 3] != 69 )
          {
            break;
          }
          g_GameFlags |= 8u;
          StartCreditScript();
          unk_81D5AD0 += 4;
        }
        if ( unk_81D5AC8[unk_81D5AD0 + 1] != 83
          || unk_81D5AC8[unk_81D5AD0 + 2] != 73
          || unk_81D5AC8[unk_81D5AD0 + 3] != 76 )
        {
          break;
        }
        z = GetTextScriptNo(unk_81D5AD0 + 4);
        SetCreditIllust(z);
        unk_81D5AD0 += 8;
      }
      if ( unk_81D5AC8[unk_81D5AD0 + 1] != 67
        || unk_81D5AC8[unk_81D5AD0 + 2] != 73
        || unk_81D5AC8[unk_81D5AD0 + 3] != 76 )
      {
        break;
      }
      CutCreditIllust();
      unk_81D5AD0 += 4;
    }
    if ( unk_81D5AC8[unk_81D5AD0 + 1] != 88 || unk_81D5AC8[unk_81D5AD0 + 2] != 88 || unk_81D5AC8[unk_81D5AD0 + 3] != 49 )
      break;
    bExit = 1;
    v3 = GetTextScriptNo(unk_81D5AD0 + 4);
    z = v3;
    v4 = Scene_DownIsland(gscreen, v3);
    if ( !v4 )
      return 0;
    if ( v4 == 2 )
      return 2;
    unk_81D5AD0 += 8;
  }
  if ( unk_81D5AC8[unk_81D5AD0 + 1] == 69 && unk_81D5AC8[unk_81D5AD0 + 2] == 83 && unk_81D5AC8[unk_81D5AD0 + 3] == 67 )
    return 2;
  sprintf(
    str_0,
    "\x95s\x96\xBE\x82̃R\x81[\x83h:<%c%c%c",
    (char)unk_81D5AC8[unk_81D5AD0 + 1],
    (char)unk_81D5AC8[unk_81D5AD0 + 2],
    (char)unk_81D5AC8[unk_81D5AD0 + 3]);
  return 0;
}

//----- (080B2B83) --------------------------------------------------------
void RestoreTextScript()
{
  int v0;
  Uint8 r;
  int i;

  for ( i = 0; i <= 3; ++i )
  {
    CortBox2(&gRect_line, 0, i + 30);
    v0 = i + 30;
    RGB((int)&r, 0xFFu, 0xFFu, 254);
    PutText2(0, 0, (const char *)((i << 6) + 136141632), (const SDL_Color_0 *const )&r, v0);
  }
}

//----- (080B2C24) --------------------------------------------------------
signed int InitMapData2()
{
  gMap.data = (unsigned __int8 *)malloc(0x4B000u);
  return 1;
}

//----- (080B2C42) --------------------------------------------------------
signed int __cdecl LoadMapData2(char *path_map)
{
  signed int result;
  char path[260];
  unsigned __int8 dum;
  char check[3];
  SDL_RWops_0 *fp;

  sprintf(path, "%s/%s", gDataPath, path_map);
  fp = SDL_RWFromFile(path, "rb");
  if ( !fp )
    return 0;
  fp->read(fp, check, 1, 3);
  if ( !memcmp(check, "PXM", 3u) )
  {
    fp->read(fp, &dum, 1, 1);
    gMap.width = SDL_ReadLE16(fp);
    gMap.length = SDL_ReadLE16(fp);
    if ( gMap.data )
    {
      fp->read(fp, gMap.data, 1, gMap.length * gMap.width);
      fp->close(fp);
      result = 1;
    }
    else
    {
      fp->close(fp);
      result = 0;
    }
  }
  else
  {
    fp->close(fp);
    result = 0;
  }
  return result;
}


//----- (080B2DA7) --------------------------------------------------------
signed int __cdecl LoadAttributeData(char *path_atrb)
{
  char path[260];
  SDL_RWops_0 *fp;

  sprintf(path, "%s/%s", gDataPath, path_atrb);
  fp = SDL_RWFromFile(path, "rb");
  if ( !fp )
    return 0;
  fp->read(fp, &gMap + 4, 1, 256);
  fp->close(fp);
  return 1;
}

//----- (080B2E36) --------------------------------------------------------
void EndMapData()
{
  free(gMap.data);
}

//----- (080B2E4B) --------------------------------------------------------
void ReleasePartsImage()
{
  ReleaseSurface(2);
}

//----- (080B2E5F) --------------------------------------------------------
void __cdecl GetMapData(unsigned __int8 **data, __int16 *mw, __int16 *ml)
{
  if ( data )
    *data = gMap.data;
  if ( mw )
    *mw = gMap.width;
  if ( ml )
    *ml = gMap.length;
}

//----- (080B2E9B) --------------------------------------------------------
int __cdecl GetAttribute(int x, int y)
{
  int result;

  if ( x >= 0 && y >= 0 && gMap.width > x && gMap.length > y )
    result = gMap.atrb[gMap.data[y * gMap.width + x]];
  else
    result = 0;
  return result;
}

//----- (080B2F00) --------------------------------------------------------
void __cdecl DeleteMapParts(int x, int y)
{
  gMap.data[y * gMap.width + x] = 0;
}

//----- (080B2F25) --------------------------------------------------------
void __cdecl ShiftMapParts(int x, int y)
{
  --gMap.data[y * gMap.width + x];
}

//----- (080B2F6D) --------------------------------------------------------
signed int __cdecl ChangeMapParts(int x, int y, unsigned __int8 no)
{
  int i;

  if ( gMap.data[y * gMap.width + x] == no )
    return 0;
  gMap.data[y * gMap.width + x] = no;
  for ( i = 0; i <= 2; ++i )
    SetNpChar(4, x << 13, y << 13, 0, 0, 0, 0, 0);
  return 1;
}

//----- (080B3033) --------------------------------------------------------
void __cdecl PutStage_Back(int fx, int fy)
{
  RECT rect;
  int i;
  int j;
  int offset;
  int num_x;
  int num_y;
  int put_x;
  int put_y;
  int atrb;

  num_x = 21;
  num_y = 16;
  put_x = (fx / 512 + 8) / 16;
  put_y = (fy / 512 + 8) / 16;
  for ( j = (fy / 512 + 8) / 16; put_y + num_y > j; ++j )
  {
    for ( i = put_x; put_x + num_x > i; ++i )
    {
      offset = i + j * gMap.width;
      atrb = (unsigned __int8)GetAttribute(i, j);
      if ( atrb <= 31 )
      {
        rect.left = 16 * (gMap.data[offset] & 0xF);
        rect.top = 16 * (gMap.data[offset] >> 4);
        rect.right = rect.left + 16;
        rect.bottom = rect.top + 16;
        PutBitmap3(&grcGame, 8 * (2 * i - 1) - fx / 512, 8 * (2 * j - 1) - fy / 512, &rect, 2);
      }
    }
  }
}

//----- (080B31CC) --------------------------------------------------------
void __cdecl PutStage_Front(int fx, int fy)
{
  RECT rect;
  RECT rcSnack;
  int i;
  int j;
  int offset;
  int num_x;
  int num_y;
  int put_x;
  int put_y;
  int atrb;

  rcSnack.left = 256;
  rcSnack.top = 48;
  rcSnack.right = 272;
  rcSnack.bottom = 64;
  num_x = 21;
  num_y = 16;
  put_x = (fx / 512 + 8) / 16;
  put_y = (fy / 512 + 8) / 16;
  for ( j = (fy / 512 + 8) / 16; put_y + num_y > j; ++j )
  {
    for ( i = put_x; put_x + num_x > i; ++i )
    {
      offset = i + j * gMap.width;
      atrb = (unsigned __int8)GetAttribute(i, j);
      if ( atrb > 63 && atrb <= 127 )
      {
        rect.left = 16 * (gMap.data[offset] & 0xF);
        rect.top = 16 * (gMap.data[offset] >> 4);
        rect.right = rect.left + 16;
        rect.bottom = rect.top + 16;
        PutBitmap3(&grcGame, 8 * (2 * i - 1) - fx / 512, 8 * (2 * j - 1) - fy / 512, &rect, 2);
        if ( atrb == 67 )
          PutBitmap3(&grcGame, 8 * (2 * i - 1) - fx / 512, 8 * (2 * j - 1) - fy / 512, &rcSnack, 20);
      }
    }
  }
}

//----- (080B33FD) --------------------------------------------------------
void __cdecl PutMapDataVector(int fx, int fy)
{
  RECT rect;
  int i;
  int j;
  int offset;
  int num_x;
  int num_y;
  int put_x;
  int put_y;
  int atrb;

  PutMapDataVector(long,long)::count += 2;
  num_x = 21;
  num_y = 16;
  put_x = (fx / 512 + 8) / 16;
  put_y = (fy / 512 + 8) / 16;
  for ( j = (fy / 512 + 8) / 16; put_y + num_y > j; ++j )
  {
    for ( i = put_x; put_x + num_x > i; ++i )
    {
      offset = i + j * gMap.width;
      atrb = (unsigned __int8)GetAttribute(i, j);
      if ( atrb == 128
        || atrb == 129
        || atrb == 130
        || atrb == 131
        || atrb == 160
        || atrb == 161
        || atrb == 162
        || atrb == 163 )
      {
        switch ( atrb )
        {
          case 128:
          case 160:
            rect.left = (PutMapDataVector(long,long)::count & 0xF) + 224;
            rect.right = (PutMapDataVector(long,long)::count & 0xF) + 240;
            rect.top = 48;
            rect.bottom = 64;
            break;
          case 129:
          case 161:
            rect.left = 224;
            rect.right = 240;
            rect.top = (PutMapDataVector(long,long)::count & 0xF) + 48;
            rect.bottom = (PutMapDataVector(long,long)::count & 0xF) + 64;
            break;
          case 130:
          case 162:
            rect.left = 240 - (PutMapDataVector(long,long)::count & 0xF);
            rect.right = rect.left + 16;
            rect.top = 48;
            rect.bottom = 64;
            break;
          case 131:
          case 163:
            rect.left = 224;
            rect.right = 240;
            rect.top = 64 - (PutMapDataVector(long,long)::count & 0xF);
            rect.bottom = rect.top + 16;
            break;
          default:
            break;
        }
        PutBitmap3(&grcGame, 8 * (2 * i - 1) - fx / 512, 8 * (2 * j - 1) - fy / 512, &rect, 19);
      }
    }
  }
}

//----- (080B3680) --------------------------------------------------------
void __cdecl ActNpc160(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  int v8;
  int v9;
  int v10;
  int v11;
  int v12;
  NPCHAR_0 *v13;
  Sint32 *v14;
  RECT rect_right[4];
  RECT rect_left[4];
  int i;
  char v18[24];

  switch ( npc->act_no )
  {
    case 0:
      npc->bits &= 0xFFFEu;
      npc->act_no = 1;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( npc->x >= x )
        npc->direct = 0;
      else
        npc->direct = 2;
      npc->ym = 2560;
      if ( npc->y > 0xFFFF )
      {
        npc->bits &= 0xFFF7u;
        npc->act_no = 2;
      }
      else
      {
        ++npc->count1;
      }
      break;
    case 2:
      npc->ym = 2560;
      if ( npc->flag & 8 )
      {
        DeleteNpCharCode(161, 1);
        for ( i = 0; i <= 3; ++i )
        {
          v1 = Random(-1536, 0);
          v2 = Random(-341, 341);
          v3 = npc->y;
          v4 = (Random(-12, 12) << 9) + v3;
          v5 = npc->x;
          v6 = Random(-12, 12);
          SetNpChar(4, v5 + (v6 << 9), v4, v2, v1, 0, 0, 256);
        }
        npc->act_no = 3;
        npc->act_wait = 0;
        SetQuake(30);
        PlaySoundObject(26, 1);
        PlaySoundObject(72, 1);
      }
      if ( npc->y < y && dword_81C8584 & 8 )
        npc->damage = 20;
      else
        npc->damage = 0;
      break;
    case 3:
      npc->damage = 20;
      npc->damage = 0;
      if ( ++npc->act_wait > 24 )
      {
        npc->act_no = 4;
        npc->count1 = 0;
        npc->count2 = 0;
      }
      break;
    case 4:
      gSuperXpos = npc->x;
      gSuperYpos = npc->y;
      if ( npc->shock & 1 )
      {
        v7 = Random(-1536, 1536);
        v8 = Random(-1536, 1536);
        v9 = npc->y;
        v10 = (Random(-12, 12) << 9) + v9;
        v11 = npc->x;
        v12 = Random(-12, 12);
        SetNpChar(161, v11 + (v12 << 9), v10, v8, v7, 0, 0, 256);
        if ( ++npc->count1 > 30 )
        {
          npc->count1 = 0;
          npc->act_no = 5;
          npc->ym = -3072;
          npc->bits |= 8u;
        }
      }
      break;
    case 5:
      gSuperXpos = npc->x;
      gSuperYpos = npc->y;
      if ( ++npc->count1 > 60 )
      {
        npc->count1 = 0;
        npc->act_no = 6;
      }
      break;
    case 6:
      gSuperXpos = x;
      gSuperYpos = 3276800;
      if ( ++npc->count1 > 110 )
      {
        npc->count1 = 10;
        npc->x = x;
        npc->y = 0;
        npc->ym = 1535;
        npc->act_no = 1;
      }
      break;
    default:
      break;
  }
  npc->y += npc->ym;
  switch ( npc->act_no )
  {
    case 0:
    case 1:
      npc->ani_no = 3;
      break;
    case 2:
      npc->ani_no = 3;
      break;
    case 3:
      npc->ani_no = 2;
      break;
    case 4:
      npc->ani_no = 0;
      break;
    case 5:
      npc->ani_no = 3;
      break;
    case 6:
      npc->ani_no = 3;
      break;
    default:
      break;
  }
  rect_left[0].left = 0;
  rect_left[0].top = 0;
  rect_left[0].right = 40;
  rect_left[0].bottom = 24;
  rect_left[1].left = 40;
  rect_left[1].top = 0;
  rect_left[1].right = 80;
  rect_left[1].bottom = 24;
  rect_left[2].left = 80;
  rect_left[2].top = 0;
  rect_left[2].right = 120;
  rect_left[2].bottom = 24;
  rect_left[3].left = 120;
  rect_left[3].top = 0;
  rect_left[3].right = 160;
  rect_left[3].bottom = 24;
  rect_right[0].left = 0;
  rect_right[0].top = 24;
  rect_right[0].right = 40;
  rect_right[0].bottom = 48;
  rect_right[1].left = 40;
  rect_right[1].top = 24;
  rect_right[1].right = 80;
  rect_right[1].bottom = 48;
  rect_right[2].left = 80;
  rect_right[2].top = 24;
  rect_right[2].right = 120;
  rect_right[2].bottom = 48;
  rect_right[3].left = 120;
  rect_right[3].top = 24;
  rect_right[3].right = 160;
  rect_right[3].bottom = 48;
  if ( npc->direct )
  {
    v13 = npc;
    v14 = (Sint32 *)&v18[16 * npc->ani_no - 132];
  }
  else
  {
    v13 = npc;
    v14 = (Sint32 *)&v18[16 * npc->ani_no - 68];
  }
  npc->rect.left = *v14;
  v13->rect.top = v14[1];
  v13->rect.right = v14[2];
  v13->rect.bottom = v14[3];
}


//----- (080B3CC3) --------------------------------------------------------
void __cdecl ActNpc161(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  Sint32 *v3;
  RECT rect[3];
  char v5[8];

  npc->exp = 0;
  if ( npc->x >= gSuperXpos )
    v1 = npc->xm - 64;
  else
    v1 = npc->xm + 64;
  npc->xm = v1;
  if ( npc->y >= gSuperYpos )
    v2 = npc->ym - 64;
  else
    v2 = npc->ym + 64;
  npc->ym = v2;
  if ( npc->xm < -4605 )
    npc->xm = -4605;
  if ( npc->xm > 4605 )
    npc->xm = 4605;
  if ( npc->ym < -4605 )
    npc->ym = -4605;
  if ( npc->ym > 4605 )
    npc->ym = 4605;
  if ( npc->life <= 99 )
  {
    npc->bits &= 0xFFDFu;
    npc->bits &= 0xFFFBu;
    npc->damage = 0;
    npc->ani_no = 2;
  }
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->ani_no <= 1 )
    npc->ani_no = Random(0, 10) != 2;
  rect[0].left = 0;
  rect[0].top = 48;
  rect[0].right = 16;
  rect[0].bottom = 64;
  rect[1].left = 16;
  rect[1].top = 48;
  rect[1].right = 32;
  rect[1].bottom = 64;
  rect[2].left = 32;
  rect[2].top = 48;
  rect[2].right = 48;
  rect[2].bottom = 64;
  v3 = (Sint32 *)&v5[16 * npc->ani_no - 48];
  npc->rect.left = *v3;
  npc->rect.top = v3[1];
  npc->rect.right = v3[2];
  npc->rect.bottom = v3[3];
}


//----- (080B3EBE) --------------------------------------------------------
void __cdecl ActNpc162(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  int v8;
  int v9;
  int v10;
  int v11;
  int v12;
  int v13;
  int v14;
  int v15;
  int i;

  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_18:
    if ( !(++npc->count1 & 3) )
    {
      v8 = npc->y;
      v9 = (Random(-12, 12) << 9) + v8;
      v10 = npc->x;
      v11 = Random(-12, 12);
      SetNpChar(161, v10 + (v11 << 9), v9, 0, 0, 0, 0, 256);
    }
    if ( npc->count1 > 160 )
    {
      npc->count1 = 0;
      npc->act_no = 2;
      npc->tgt_y = npc->y;
    }
    goto LABEL_34;
  }
  if ( v1 <= 1 )
  {
    if ( v1 )
      goto LABEL_34;
    DeleteNpCharCode(161, 1);
    PlaySoundObject(72, 1);
    for ( i = 0; i <= 9; ++i )
    {
      v2 = Random(-1536, 1536);
      v3 = Random(-1536, 1536);
      v4 = npc->y;
      v5 = (Random(-12, 12) << 9) + v4;
      v6 = npc->x;
      v7 = Random(-12, 12);
      SetNpChar(4, v6 + (v7 << 9), v5, v3, v2, 0, 0, 256);
    }
    if ( npc->x <= x )
      npc->direct = 2;
    else
      npc->direct = 0;
    if ( npc->direct )
    {
      npc->rect.left = 40;
      npc->rect.top = 24;
      npc->rect.right = 80;
      npc->rect.bottom = 48;
    }
    else
    {
      npc->rect.left = 40;
      npc->rect.top = 0;
      npc->rect.right = 80;
      npc->rect.bottom = 24;
    }
    npc->count1 = 0;
    npc->act_no = 1;
    goto LABEL_18;
  }
  if ( v1 == 2 )
  {
    SetQuake(2);
    if ( ++npc->count1 > 240 )
    {
      npc->rect.left = 0;
      npc->rect.top = 0;
      npc->rect.right = 0;
      npc->rect.bottom = 0;
      npc->count1 = 0;
      npc->act_no = 3;
    }
    else
    {
      if ( npc->direct )
      {
        npc->rect.left = 40;
        npc->rect.top = 24;
        npc->rect.right = 80;
        npc->rect.bottom = 48;
      }
      else
      {
        npc->rect.left = 40;
        npc->rect.top = 0;
        npc->rect.right = 80;
        npc->rect.bottom = 24;
      }
      npc->rect.top += npc->count1 / 8;
      npc->y = (npc->count1 / 8 << 9) + npc->tgt_y;
      npc->rect.left -= npc->count1 / 2 % 2;
    }
    if ( npc->count1 % 3 == 2 )
    {
      v12 = Random(-512, 512);
      v13 = npc->y - 6144;
      v14 = npc->x;
      v15 = Random(-12, 12);
      SetNpChar(161, v14 + (v15 << 9), v13, v12, 256, 0, 0, 256);
    }
    if ( npc->count1 % 4 == 2 )
      PlaySoundObject(21, 1);
  }
  else if ( v1 == 3 && ++npc->count1 > 59 )
  {
    DeleteNpCharCode(161, 1);
    npc->cond = 0;
  }
LABEL_34:
  gSuperXpos = npc->x;
  gSuperYpos = -512000;
}

//----- (080B43BB) --------------------------------------------------------
void __cdecl ActNpc163(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[2];
  RECT rcLeft[2];
  char v6[8];

  rcLeft[0].left = 192;
  rcLeft[0].top = 0;
  rcLeft[0].right = 208;
  rcLeft[0].bottom = 16;
  rcLeft[1].left = 208;
  rcLeft[1].top = 0;
  rcLeft[1].right = 224;
  rcLeft[1].bottom = 16;
  rcRight[0].left = 192;
  rcRight[0].top = 16;
  rcRight[0].right = 208;
  rcRight[0].bottom = 32;
  rcRight[1].left = 208;
  rcRight[1].top = 16;
  rcRight[1].right = 224;
  rcRight[1].bottom = 32;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    if ( Random(0, 120) == 10 )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
      npc->ani_no = 1;
    }
    goto LABEL_9;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_9;
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->ani_wait = 0;
    goto LABEL_5;
  }
  if ( ++npc->act_wait > 8 )
  {
    npc->act_no = 1;
    npc->ani_no = 0;
  }
LABEL_9:
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 64];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 32];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (080B453C) --------------------------------------------------------
void __cdecl ActNpc164(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[2];
  RECT rcLeft[2];
  char v6[8];

  rcLeft[0].left = 224;
  rcLeft[0].top = 0;
  rcLeft[0].right = 240;
  rcLeft[0].bottom = 16;
  rcLeft[1].left = 240;
  rcLeft[1].top = 0;
  rcLeft[1].right = 256;
  rcLeft[1].bottom = 16;
  rcRight[0].left = 224;
  rcRight[0].top = 16;
  rcRight[0].right = 240;
  rcRight[0].bottom = 32;
  rcRight[1].left = 240;
  rcRight[1].top = 16;
  rcRight[1].right = 256;
  rcRight[1].bottom = 32;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    if ( Random(0, 120) == 10 )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
      npc->ani_no = 1;
    }
    goto LABEL_9;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_9;
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->ani_wait = 0;
    goto LABEL_5;
  }
  if ( ++npc->act_wait > 8 )
  {
    npc->act_no = 1;
    npc->ani_no = 0;
  }
LABEL_9:
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 64];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 32];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (080B46BD) --------------------------------------------------------
void __cdecl ActNpc165(NPCHAR_0 *npc)
{
  int v1;
  RECT *v2;
  RECT rcRight[2];
  RECT rcLeft;

  rcRight[0].left = 192;
  rcRight[0].top = 96;
  rcRight[0].right = 208;
  rcRight[0].bottom = 112;
  rcRight[1].left = 208;
  rcRight[1].top = 96;
  rcRight[1].right = 224;
  rcRight[1].bottom = 112;
  rcLeft.left = 144;
  rcLeft.top = 96;
  rcLeft.right = 160;
  rcLeft.bottom = 112;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_12;
  }
  else
  {
    npc->act_no = 1;
    npc->y += 5120;
  }
  npc->ani_no = npc->direct == 2
             && x > npc->x - 0x4000
             && x < npc->x + 0x4000
             && y > npc->y - 0x2000
             && y < npc->y + 0x2000;
LABEL_12:
  if ( npc->direct )
  {
    v2 = &rcRight[npc->ani_no];
    npc->rect.left = v2->left;
    npc->rect.top = v2->top;
    npc->rect.right = v2->right;
    npc->rect.bottom = v2->bottom;
  }
  else
  {
    npc->rect = rcLeft;
  }
}

//----- (080B480F) --------------------------------------------------------
void __cdecl ActNpc166(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT rcLeft[2];
  char v4[8];

  rcLeft[0].left = 144;
  rcLeft[0].top = 104;
  rcLeft[0].right = 184;
  rcLeft[0].bottom = 128;
  rcLeft[1].left = 184;
  rcLeft[1].top = 104;
  rcLeft[1].right = 224;
  rcLeft[1].bottom = 128;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    if ( Random(0, 120) == 10 )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
      npc->ani_no = 1;
    }
    goto LABEL_9;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_9;
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->ani_wait = 0;
    goto LABEL_5;
  }
  if ( ++npc->act_wait > 8 )
  {
    npc->act_no = 1;
    npc->ani_no = 0;
  }
LABEL_9:
  v2 = (Sint32 *)&v4[16 * npc->ani_no - 32];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
}


//----- (080B4920) --------------------------------------------------------
void __cdecl ActNpc167(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  Sint32 *v7;
  RECT rect[3];
  int i;
  char v10[24];

  rect[0].left = 304;
  rect[0].top = 0;
  rect[0].right = 320;
  rect[0].bottom = 16;
  rect[1].left = 304;
  rect[1].top = 16;
  rect[1].right = 320;
  rect[1].bottom = 32;
  rect[2].left = 0;
  rect[2].top = 0;
  rect[2].right = 0;
  rect[2].bottom = 0;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 1;
      break;
    case 0xA:
      npc->ani_no = 0;
      npc->ym += 64;
      if ( npc->ym > 1535 )
        npc->ym = 1535;
      npc->y += npc->ym;
      break;
    case 0x14:
      npc->act_no = 21;
      npc->act_wait = 0;
      npc->ani_no = 0;
      PlaySoundObject(29, 1);
      goto LABEL_7;
    case 0x15:
LABEL_7:
      if ( ++npc->ani_no > 2 )
        npc->ani_no = 1;
      if ( ++npc->act_wait > 100 )
      {
        for ( i = 0; i <= 3; ++i )
        {
          v1 = Random(-1536, 0);
          v2 = Random(-341, 341);
          v3 = npc->y;
          v4 = (Random(-12, 12) << 9) + v3;
          v5 = npc->x;
          v6 = Random(-12, 12);
          SetNpChar(4, v5 + (v6 << 9), v4, v2, v1, 0, 0, 256);
        }
        npc->cond = 0;
      }
      break;
    default:
      break;
  }
  v7 = (Sint32 *)&v10[16 * npc->ani_no - 52];
  npc->rect.left = *v7;
  npc->rect.top = v7[1];
  npc->rect.right = v7[2];
  npc->rect.bottom = v7[3];
}


//----- (080B4B66) --------------------------------------------------------
void __cdecl ActNpc168(NPCHAR_0 *npc)
{
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      break;
    case 0xA:
      npc->act_no = 11;
      npc->act_wait = 0;
      npc->tgt_x = npc->x;
      goto LABEL_4;
    case 0xB:
LABEL_4:
      ++npc->act_wait;
      npc->x = npc->tgt_x;
      if ( npc->act_wait / 3 & 1 )
        npc->x += 512;
      break;
    case 0x14:
      npc->act_no = 21;
      npc->act_wait = 0;
      npc->ym = -1024;
      npc->xm = 256;
      PlaySoundObject(25, 1);
      goto LABEL_7;
    case 0x15:
LABEL_7:
      npc->ym += 16;
      npc->x += npc->xm;
      npc->y += npc->ym;
      if ( npc->act_wait && npc->flag & 8 )
      {
        PlaySoundObject(35, 1);
        SetQuake(40);
        npc->act_no = 0;
      }
      if ( !npc->act_wait )
        ++npc->act_wait;
      break;
    default:
      break;
  }
  npc->rect.left = 264;
  npc->rect.top = 56;
  npc->rect.right = 320;
  npc->rect.bottom = 96;
}

//----- (080B4D13) --------------------------------------------------------
void __cdecl ActNpc169(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rect_right[9];
  RECT rect_left[9];
  char v6[24];

  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->act_wait = 30;
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
      goto LABEL_5;
    case 1:
LABEL_5:
      if ( !--npc->act_wait )
      {
        npc->act_no = 2;
        ++npc->count1;
      }
      break;
    case 2:
      npc->act_no = 3;
      npc->act_wait = 0;
      npc->ani_no = 1;
      npc->ani_wait = 0;
      goto LABEL_8;
    case 3:
LABEL_8:
      if ( ++npc->ani_wait > 3 )
      {
        npc->ani_wait = 0;
        if ( ++npc->ani_no == 2 || npc->ani_no == 4 )
          PlaySoundObject(23, 1);
      }
      if ( npc->ani_no > 4 )
        npc->ani_no = 1;
      if ( npc->direct )
        v1 = npc->xm + 32;
      else
        v1 = npc->xm - 32;
      npc->xm = v1;
      if ( npc->act_wait <= 7 || npc->x - 6144 >= x || npc->x + 6144 <= x || npc->y - 6144 >= y || npc->y + 4096 <= y )
      {
        if ( ++npc->act_wait <= 75 )
        {
          if ( npc->flag & 5 )
          {
            if ( npc->count2 > 4 )
            {
              npc->act_no = 4;
              npc->act_wait = 0;
              npc->ani_no = 7;
              npc->ym = -1535;
            }
            else
            {
              ++npc->count2;
            }
          }
          else
          {
            npc->count2 = 0;
          }
          if ( (npc->count1 & 1) != 1 && npc->act_wait > 25 )
          {
            npc->act_no = 4;
            npc->act_wait = 0;
            npc->ani_no = 7;
            npc->ym = -1535;
          }
        }
        else
        {
          npc->act_no = 9;
          npc->ani_no = 0;
        }
      }
      else
      {
        npc->act_no = 10;
        npc->ani_no = 5;
        gMC.cond |= 2u;
        DamageMyChar(5);
      }
      break;
    case 4:
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
      if ( ++npc->act_wait <= 29 && npc->act_wait % 6 == 1 )
      {
        PlaySoundObject(39, 1);
        SetNpChar(170, npc->x, npc->y, 0, 0, npc->direct, 0, 256);
      }
      if ( npc->flag & 8 )
      {
        npc->act_no = 9;
        npc->ani_no = 8;
        SetQuake(30);
        PlaySoundObject(26, 1);
      }
      if ( npc->act_wait > 7 && npc->x - 6144 < x && npc->x + 6144 > x && npc->y - 6144 < y && npc->y + 4096 > y )
      {
        npc->act_no = 10;
        npc->ani_no = 5;
        gMC.cond |= 2u;
        DamageMyChar(10);
      }
      break;
    case 9:
      npc->xm = 4 * npc->xm / 5;
      if ( !npc->xm )
        npc->act_no = 0;
      break;
    case 0xA:
      x = npc->x;
      y = npc->y;
      npc->xm = 4 * npc->xm / 5;
      if ( !npc->xm )
      {
        npc->act_no = 11;
        npc->act_wait = 0;
        npc->ani_no = 5;
        npc->ani_wait = 0;
      }
      break;
    case 0xB:
      x = npc->x;
      y = npc->y;
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 6 )
        npc->ani_no = 5;
      if ( ++npc->act_wait > 100 )
        npc->act_no = 20;
      break;
    case 0x14:
      PlaySoundObject(25, 1);
      gMC.cond &= 0xFDu;
      if ( npc->direct )
      {
        x -= 2048;
        y -= 4096;
        unk_81C85B4 = -1535;
        unk_81C85B8 = -512;
        dir = 0;
        npc->direct = 0;
      }
      else
      {
        x += 2048;
        y -= 4096;
        unk_81C85B4 = 1535;
        unk_81C85B8 = -512;
        dir = 2;
        npc->direct = 2;
      }
      npc->act_no = 21;
      npc->act_wait = 0;
      npc->ani_no = 7;
      goto LABEL_61;
    case 0x15:
LABEL_61:
      if ( ++npc->act_wait > 49 )
        npc->act_no = 0;
      break;
    default:
      break;
  }
  npc->ym += 32;
  if ( npc->xm < -768 )
    npc->xm = -768;
  if ( npc->xm > 768 )
    npc->xm = 768;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  qmemcpy(rect_left, &ActNpc169(NPCHAR *)::C.12, sizeof(rect_left));
  qmemcpy(rect_right, &ActNpc169(NPCHAR *)::C.13, sizeof(rect_right));
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 288];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 144];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (080B5525) --------------------------------------------------------
void __cdecl ActNpc170(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  NPCHAR_0 *v4;
  Sint32 *v5;
  RECT rcRight[2];
  RECT rcLeft[2];
  bool bHit;
  char v9[8];

  rcLeft[0].left = 112;
  rcLeft[0].top = 96;
  rcLeft[0].right = 128;
  rcLeft[0].bottom = 104;
  rcLeft[1].left = 128;
  rcLeft[1].top = 96;
  rcLeft[1].right = 144;
  rcLeft[1].bottom = 104;
  rcRight[0].left = 112;
  rcRight[0].top = 104;
  rcRight[0].right = 128;
  rcRight[0].bottom = 112;
  rcRight[1].left = 128;
  rcRight[1].top = 104;
  rcRight[1].right = 144;
  rcRight[1].bottom = 112;
  bHit = 0;
  if ( !npc->direct && npc->flag & 1 )
    bHit = 1;
  if ( npc->direct == 2 && npc->flag & 4 )
    bHit = 1;
  if ( bHit )
  {
    PlaySoundObject(44, 1);
    SetDestroyNpChar(npc->x, npc->y, 0, 3);
    VanishNpChar(npc);
    return;
  }
  v1 = npc->act_no;
  if ( !v1 )
  {
    npc->act_no = 1;
    if ( npc->direct )
      v2 = Random(-2, -1) << 9;
    else
      v2 = Random(1, 2) << 9;
    npc->xm = v2;
    npc->ym = Random(-2, 0) << 9;
    goto LABEL_16;
  }
  if ( v1 == 1 )
  {
LABEL_16:
    ++npc->count1;
    if ( npc->direct )
    {
      npc->xm += 32;
      if ( npc->count1 % 3 == 1 )
        SetCaret(npc->x - 4096, npc->y, 7, 0);
    }
    else
    {
      npc->xm -= 32;
      if ( npc->count1 % 3 == 1 )
        SetCaret(npc->x + 4096, npc->y, 7, 2);
    }
    if ( npc->count1 > 49 )
    {
      npc->ym = 0;
    }
    else
    {
      if ( npc->y >= y )
        v3 = npc->ym - 32;
      else
        v3 = npc->ym + 32;
      npc->ym = v3;
    }
    if ( ++npc->ani_no > 1 )
      npc->ani_no = 0;
  }
  if ( npc->xm < -1024 )
    npc->xm = -1536;
  if ( npc->xm > 1024 )
    npc->xm = 1536;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v4 = npc;
    v5 = (Sint32 *)&v9[16 * npc->ani_no - 68];
  }
  else
  {
    v4 = npc;
    v5 = (Sint32 *)&v9[16 * npc->ani_no - 36];
  }
  npc->rect.left = *v5;
  v4->rect.top = v5[1];
  v4->rect.right = v5[2];
  v4->rect.bottom = v5[3];
}


//----- (080B58BB) --------------------------------------------------------
void __cdecl ActNpc171(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  NPCHAR_0 *v3;
  Sint32 *v4;
  RECT rcRight[2];
  RECT rcLeft[2];
  char v7[8];

  rcLeft[0].left = 120;
  rcLeft[0].top = 48;
  rcLeft[0].right = 152;
  rcLeft[0].bottom = 80;
  rcLeft[1].left = 152;
  rcLeft[1].top = 48;
  rcLeft[1].right = 184;
  rcLeft[1].bottom = 80;
  rcRight[0].left = 184;
  rcRight[0].top = 48;
  rcRight[0].right = 216;
  rcRight[0].bottom = 80;
  rcRight[1].left = 216;
  rcRight[1].top = 48;
  rcRight[1].right = 248;
  rcRight[1].bottom = 80;
  if ( npc->x <= x )
    npc->direct = 2;
  else
    npc->direct = 0;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_8:
    if ( npc->act_wait )
    {
      --npc->act_wait;
    }
    else
    {
      npc->act_no = 10;
      npc->ym = 512;
    }
    goto LABEL_11;
  }
  if ( v1 != 10 )
  {
    if ( v1 )
      goto LABEL_35;
    npc->act_no = 1;
    npc->act_wait = Random(0, 50);
    npc->tgt_y = npc->y;
    goto LABEL_8;
  }
LABEL_11:
  if ( ++npc->ani_wait > 0 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 1 )
    npc->ani_no = 0;
  if ( npc->y >= npc->tgt_y )
    v2 = npc->ym - 16;
  else
    v2 = npc->ym + 16;
  npc->ym = v2;
  if ( npc->ym > 512 )
    npc->ym = 512;
  if ( npc->ym < -512 )
    npc->ym = -512;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    if ( y < npc->y + 40960 && y > npc->y - 40960 && x < npc->x + 81920 && x > npc->x )
      ++npc->count1;
  }
  else if ( y < npc->y + 40960 && y > npc->y - 40960 && x < npc->x && x > npc->x - 81920 )
  {
    ++npc->count1;
  }
  if ( npc->count1 > 20 )
  {
    SetNpChar(172, npc->x, npc->y, 0, 0, npc->direct, 0, 256);
    npc->count1 = -100;
    gCurlyShoot_wait = Random(80, 100);
    gCurlyShoot_x = npc->x;
    gCurlyShoot_y = npc->y;
  }
LABEL_35:
  if ( npc->direct )
  {
    v3 = npc;
    v4 = (Sint32 *)&v7[16 * npc->ani_no - 64];
  }
  else
  {
    v3 = npc;
    v4 = (Sint32 *)&v7[16 * npc->ani_no - 32];
  }
  npc->rect.left = *v4;
  v3->rect.top = v4[1];
  v3->rect.right = v4[2];
  v3->rect.bottom = v4[3];
}


//----- (080B5C5E) --------------------------------------------------------
void __cdecl ActNpc172(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  Sint32 *v3;
  RECT rect[3];
  char v5[8];

  rect[0].left = 248;
  rect[0].top = 48;
  rect[0].right = 264;
  rect[0].bottom = 80;
  rect[1].left = 264;
  rect[1].top = 48;
  rect[1].right = 280;
  rect[1].bottom = 80;
  rect[2].left = 280;
  rect[2].top = 48;
  rect[2].right = 296;
  rect[2].bottom = 80;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_15;
  }
  else
  {
    npc->act_no = 1;
  }
  if ( ++npc->ani_wait > 1 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 2 )
    npc->ani_no = 0;
  if ( npc->direct )
    v2 = npc->x + 512;
  else
    v2 = npc->x - 512;
  npc->x = v2;
  if ( npc->flag & 1 || npc->flag & 4 )
  {
    SetCaret(npc->x, npc->y, 2, 0);
    VanishNpChar(npc);
    return;
  }
LABEL_15:
  v3 = (Sint32 *)&v5[16 * npc->ani_no - 48];
  npc->rect.left = *v3;
  npc->rect.top = v3[1];
  npc->rect.right = v3[2];
  npc->rect.bottom = v3[3];
}


//----- (080B5DCB) --------------------------------------------------------
void __cdecl ActNpc173(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  Sint32 *v2;
  RECT rcRight[4];
  RECT rcLeft[4];
  unsigned __int8 deg;
  int xm;
  int ym;
  char v8[8];

  rcLeft[0].left = 0;
  rcLeft[0].top = 128;
  rcLeft[0].right = 24;
  rcLeft[0].bottom = 152;
  rcLeft[1].left = 24;
  rcLeft[1].top = 128;
  rcLeft[1].right = 48;
  rcLeft[1].bottom = 152;
  rcLeft[2].left = 48;
  rcLeft[2].top = 128;
  rcLeft[2].right = 72;
  rcLeft[2].bottom = 152;
  rcLeft[3].left = 72;
  rcLeft[3].top = 128;
  rcLeft[3].right = 96;
  rcLeft[3].bottom = 152;
  rcRight[0].left = 0;
  rcRight[0].top = 152;
  rcRight[0].right = 24;
  rcRight[0].bottom = 176;
  rcRight[1].left = 24;
  rcRight[1].top = 152;
  rcRight[1].right = 48;
  rcRight[1].bottom = 176;
  rcRight[2].left = 48;
  rcRight[2].top = 152;
  rcRight[2].right = 72;
  rcRight[2].bottom = 176;
  rcRight[3].left = 72;
  rcRight[3].top = 152;
  rcRight[3].right = 96;
  rcRight[3].bottom = 176;
  if ( npc->x <= x + 163840 && npc->x >= x - 163840 && npc->y <= y + 122880 && npc->y >= y - 122880 )
  {
    switch ( npc->act_no )
    {
      case 0:
        npc->tgt_x = npc->x;
        npc->act_no = 1;
        goto LABEL_7;
      case 1:
LABEL_7:
        npc->ani_no = 0;
        npc->xm = 0;
        if ( npc->act_wait > 4 )
        {
          if ( npc->x - 98304 < x && npc->x + 98304 > x && npc->y - 81920 < y && npc->y + 81920 > y )
          {
            npc->act_no = 10;
            npc->act_wait = 0;
            npc->ani_no = 1;
          }
        }
        else
        {
          ++npc->act_wait;
        }
        break;
      case 0xA:
        if ( ++npc->act_wait > 3 )
        {
          if ( ++npc->count1 == 3 )
          {
            PlaySoundObject(30, 1);
            npc->count1 = 0;
            npc->act_no = 25;
            npc->act_wait = 0;
            npc->ani_no = 2;
            npc->ym = -1536;
            if ( npc->x >= npc->tgt_x )
              npc->xm = -128;
            else
              npc->xm = 128;
          }
          else
          {
            PlaySoundObject(30, 1);
            npc->act_no = 20;
            npc->ani_no = 2;
            npc->ym = -512;
            if ( npc->x >= npc->tgt_x )
              npc->xm = -512;
            else
              npc->xm = 512;
          }
        }
        break;
      case 0x14:
        ++npc->act_wait;
        if ( npc->flag & 8 )
        {
          PlaySoundObject(23, 1);
          npc->ani_no = 1;
          npc->act_no = 30;
          npc->act_wait = 0;
        }
        break;
      case 0x19:
        if ( ++npc->act_wait == 30 || npc->act_wait == 40 )
        {
          deg = GetArktan(npc->x - x, npc->y - y);
          deg += Random(-6, 6);
          ym = 3 * GetSin(deg);
          xm = 3 * GetCos(deg);
          SetNpChar(174, npc->x, npc->y, xm, ym, 0, 0, 256);
          PlaySoundObject(39, 1);
          npc->ani_no = 3;
          gCurlyShoot_wait = Random(80, 100);
          gCurlyShoot_x = npc->x;
          gCurlyShoot_y = npc->y;
        }
        if ( npc->act_wait == 35 || npc->act_wait == 45 )
          npc->ani_no = 2;
        if ( npc->flag & 8 )
        {
          PlaySoundObject(23, 1);
          npc->ani_no = 1;
          npc->act_no = 30;
          npc->act_wait = 0;
        }
        break;
      case 0x1E:
        npc->xm = 7 * npc->xm / 8;
        if ( ++npc->act_wait > 3 )
        {
          npc->ani_no = 0;
          npc->act_no = 1;
          npc->act_wait = 0;
        }
        break;
      default:
        break;
    }
    npc->ym += 51;
    if ( x >= npc->x )
      npc->direct = 2;
    else
      npc->direct = 0;
    if ( npc->ym > 1535 )
      npc->ym = 1535;
    if ( npc->ym < -1535 )
      npc->ym = 1535;
    npc->x += npc->xm;
    npc->y += npc->ym;
    if ( npc->direct )
    {
      v1 = npc;
      v2 = (Sint32 *)&v8[16 * npc->ani_no - 140];
    }
    else
    {
      v1 = npc;
      v2 = (Sint32 *)&v8[16 * npc->ani_no - 76];
    }
    npc->rect.left = *v2;
    v1->rect.top = v2[1];
    v1->rect.right = v2[2];
    v1->rect.bottom = v2[3];
    if ( npc->life <= 985 )
    {
      SetDestroyNpChar(npc->x, npc->y, 0, 2);
      npc->code_char = 154;
      npc->act_no = 0;
    }
  }
}


//----- (080B64CE) --------------------------------------------------------
void __cdecl ActNpc174(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT rect_left[3];
  bool bHit;
  char v5[8];

  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_6:
    npc->x += npc->xm;
    npc->y += npc->ym;
    bHit = 0;
    if ( npc->flag & 1 )
    {
      bHit = 1;
      npc->xm = 512;
    }
    if ( npc->flag & 4 )
    {
      bHit = 1;
      npc->xm = -512;
    }
    if ( npc->flag & 2 )
    {
      bHit = 1;
      npc->ym = 512;
    }
    if ( npc->flag & 8 )
    {
      bHit = 1;
      npc->ym = -512;
    }
    if ( bHit )
    {
      npc->act_no = 2;
      ++npc->count1;
      PlaySoundObject(31, 1);
    }
    goto LABEL_19;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_19;
    if ( npc->direct == 2 )
      npc->act_no = 2;
    goto LABEL_6;
  }
  npc->ym += 64;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->flag & 8 )
  {
    if ( ++npc->count1 > 1 )
    {
      SetCaret(npc->x, npc->y, 2, 0);
      npc->cond = 0;
    }
  }
LABEL_19:
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  if ( npc->ym < -1535 )
    npc->ym = -1535;
  rect_left[0].left = 120;
  rect_left[0].top = 80;
  rect_left[0].right = 136;
  rect_left[0].bottom = 96;
  rect_left[1].left = 136;
  rect_left[1].top = 80;
  rect_left[1].right = 152;
  rect_left[1].bottom = 96;
  rect_left[2].left = 152;
  rect_left[2].top = 80;
  rect_left[2].right = 168;
  rect_left[2].bottom = 96;
  if ( ++npc->ani_no > 2 )
    npc->ani_no = 0;
  v2 = (Sint32 *)&v5[16 * npc->ani_no - 52];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
}


//----- (080B673C) --------------------------------------------------------
void __cdecl ActNpc175(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[2];
  RECT rcLeft[2];
  char v6[8];

  rcLeft[0].left = 168;
  rcLeft[0].top = 80;
  rcLeft[0].right = 192;
  rcLeft[0].bottom = 104;
  rcLeft[1].left = 192;
  rcLeft[1].top = 80;
  rcLeft[1].right = 216;
  rcLeft[1].bottom = 104;
  rcRight[0].left = 216;
  rcRight[0].top = 80;
  rcRight[0].right = 240;
  rcRight[0].bottom = 104;
  rcRight[1].left = 240;
  rcRight[1].top = 80;
  rcRight[1].right = 264;
  rcRight[1].bottom = 104;
  if ( npc->act_no <= 2 && npc->life <= 89 )
  {
    LoseNpChar(npc, 0);
    npc->act_no = 10;
    npc->ani_no = 1;
    npc->bits &= 0xFFDFu;
    npc->damage = 0;
  }
  if ( !npc->act_no )
  {
    npc->ani_no = 0;
    npc->act_no = 1;
  }
  if ( npc->direct )
    v1 = npc->ym - 32;
  else
    v1 = npc->ym + 32;
  npc->ym = v1;
  if ( npc->ym < -1535 )
    npc->ym = -1535;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 64];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 32];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (080B68FF) --------------------------------------------------------
void __cdecl ActNpc176(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[3];
  RECT rcLeft[3];
  char v6[8];

  rcLeft[0].left = 96;
  rcLeft[0].top = 128;
  rcLeft[0].right = 128;
  rcLeft[0].bottom = 144;
  rcLeft[1].left = 128;
  rcLeft[1].top = 128;
  rcLeft[1].right = 160;
  rcLeft[1].bottom = 144;
  rcLeft[2].left = 160;
  rcLeft[2].top = 128;
  rcLeft[2].right = 192;
  rcLeft[2].bottom = 144;
  rcRight[0].left = 96;
  rcRight[0].top = 144;
  rcRight[0].right = 128;
  rcRight[0].bottom = 160;
  rcRight[1].left = 128;
  rcRight[1].top = 144;
  rcRight[1].right = 160;
  rcRight[1].bottom = 160;
  rcRight[2].left = 160;
  rcRight[2].top = 144;
  rcRight[2].right = 192;
  rcRight[2].bottom = 160;
  if ( npc->act_no <= 2 && npc->life <= 939 )
  {
    LoseNpChar(npc, 0);
    npc->act_no = 10;
    npc->ani_no = 2;
    npc->bits &= 0xFFDFu;
    npc->damage = 0;
  }
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_8:
    if ( npc->direct )
    {
      if ( npc->x < x + 81920 && npc->x > x - 81920 && npc->y < y + 0x2000 && npc->y > y - 81920 )
        ++npc->count1;
    }
    else if ( npc->x < x + 81920 && npc->x > x - 81920 && npc->y < y + 81920 && npc->y > y - 0x2000 )
    {
      ++npc->count1;
    }
    if ( npc->count1 > 10 )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
    }
    goto LABEL_33;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_33;
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->ani_wait = 0;
    goto LABEL_8;
  }
  if ( ++npc->ani_wait > 3 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 1 )
    npc->ani_no = 0;
  if ( ++npc->act_wait > 10 )
  {
    if ( ++npc->count2 <= 2 )
    {
      npc->count1 = -10;
    }
    else
    {
      npc->count2 = 0;
      npc->count1 = -90;
    }
    if ( npc->direct )
      SetNpChar(177, npc->x, npc->y + 4096, 0, 0, 2, 0, 256);
    else
      SetNpChar(177, npc->x, npc->y - 4096, 0, 0, 0, 0, 256);
    PlaySoundObject(39, 1);
    npc->act_no = 0;
    npc->ani_no = 0;
    gCurlyShoot_wait = Random(80, 100);
    gCurlyShoot_x = npc->x;
    gCurlyShoot_y = npc->y;
  }
LABEL_33:
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 96];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 48];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (080B6D6F) --------------------------------------------------------
void __cdecl ActNpc177(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  Sint32 *v5;
  RECT rc[2];
  char v7[8];

  rc[0].left = 192;
  rc[0].top = 128;
  rc[0].right = 208;
  rc[0].bottom = 144;
  rc[1].left = 208;
  rc[1].top = 128;
  rc[1].right = 224;
  rc[1].bottom = 144;
  if ( npc->flag & 0xFF )
  {
    SetCaret(npc->x, npc->y, 3, 0);
    npc->cond = 0;
    return;
  }
  v1 = npc->act_no;
  switch ( v1 )
  {
    case 1:
      goto LABEL_9;
    case 10:
      if ( npc->x >= npc->tgt_x )
        v2 = npc->xm - 32;
      else
        v2 = npc->xm + 32;
      npc->xm = v2;
      if ( npc->y >= npc->tgt_y )
        v3 = npc->ym - 32;
      else
        v3 = npc->ym + 32;
      npc->ym = v3;
      if ( ++npc->act_wait > 300 )
      {
        SetCaret(npc->x, npc->y, 3, 0);
        npc->cond = 0;
        return;
      }
      if ( npc->direct )
        v4 = npc->tgt_x + 512;
      else
        v4 = npc->tgt_x - 512;
      npc->tgt_x = v4;
      break;
    case 0:
      npc->act_no = 1;
      if ( npc->direct )
        npc->ym = 1536;
      else
        npc->ym = -1536;
LABEL_9:
      if ( npc->y < y + 0x2000 && npc->y > y - 0x2000 )
      {
        npc->act_no = 10;
        npc->tgt_x = npc->x;
        npc->tgt_y = npc->y;
        if ( npc->x <= x )
          npc->direct = 2;
        else
          npc->direct = 0;
        npc->xm = (2 * Random(0, 1) - 1) << 9;
        npc->ym = (2 * Random(0, 1) - 1) << 9;
      }
      break;
  }
  if ( npc->xm > 1024 )
    npc->xm = 1024;
  if ( npc->xm < -1024 )
    npc->xm = -1024;
  if ( npc->ym > 1024 )
    npc->ym = 1024;
  if ( npc->ym < -1024 )
    npc->ym = -1024;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( ++npc->ani_wait > 6 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 1 )
    npc->ani_no = 0;
  v5 = (Sint32 *)&v7[16 * npc->ani_no - 32];
  npc->rect.left = *v5;
  npc->rect.top = v5[1];
  npc->rect.right = v5[2];
  npc->rect.bottom = v5[3];
}


//----- (080B70DC) --------------------------------------------------------
void __cdecl ActNpc178(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  Sint32 *v3;
  RECT rect_left[3];
  char v5[8];

  if ( npc->flag & 0xFF )
  {
    SetCaret(npc->x, npc->y, 2, 0);
    npc->cond = 0;
  }
  if ( npc->flag & 0x100 )
  {
    npc->y += npc->ym / 2;
    v1 = npc->x;
    v2 = npc->xm / 2;
  }
  else
  {
    npc->y += npc->ym;
    v1 = npc->x;
    v2 = npc->xm;
  }
  npc->x = v2 + v1;
  rect_left[0].left = 0;
  rect_left[0].top = 224;
  rect_left[0].right = 16;
  rect_left[0].bottom = 240;
  rect_left[1].left = 16;
  rect_left[1].top = 224;
  rect_left[1].right = 32;
  rect_left[1].bottom = 240;
  rect_left[2].left = 32;
  rect_left[2].top = 224;
  rect_left[2].right = 48;
  rect_left[2].bottom = 240;
  if ( ++npc->ani_wait > 1 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 2 )
    npc->ani_no = 0;
  v3 = (Sint32 *)&v5[16 * npc->ani_no - 48];
  npc->rect.left = *v3;
  npc->rect.top = v3[1];
  npc->rect.right = v3[2];
  npc->rect.bottom = v3[3];
  if ( ++npc->count1 > 150 )
  {
    VanishNpChar(npc);
    SetCaret(npc->x, npc->y, 2, 0);
  }
}


//----- (080B72AD) --------------------------------------------------------
void __cdecl ActNpc179(NPCHAR_0 *npc)
{
  Sint32 *v1;
  RECT rect_left[3];
  char v3[8];

  if ( npc->flag & 0xFF )
  {
    npc->cond = 0;
    SetCaret(npc->x, npc->y, 2, 0);
  }
  npc->xm -= 32;
  npc->ym = 0;
  if ( npc->xm < -1024 )
    npc->xm = -1024;
  npc->y += npc->ym;
  npc->x += npc->xm;
  rect_left[0].left = 48;
  rect_left[0].top = 224;
  rect_left[0].right = 72;
  rect_left[0].bottom = 240;
  rect_left[1].left = 72;
  rect_left[1].top = 224;
  rect_left[1].right = 96;
  rect_left[1].bottom = 240;
  rect_left[2].left = 96;
  rect_left[2].top = 224;
  rect_left[2].right = 120;
  rect_left[2].bottom = 240;
  if ( ++npc->ani_wait > 1 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 2 )
    npc->ani_no = 0;
  v1 = (Sint32 *)&v3[16 * npc->ani_no - 48];
  npc->rect.left = *v1;
  npc->rect.top = v1[1];
  npc->rect.right = v1[2];
  npc->rect.bottom = v1[3];
  if ( ++npc->count1 > 300 )
  {
    VanishNpChar(npc);
    SetCaret(npc->x, npc->y, 2, 0);
  }
}


//----- (080B7464) --------------------------------------------------------
void __cdecl ActBossChar03_01(NPCHAR_0 *npc)
{
  int v1;
  unsigned __int16 v2;
  unsigned __int16 v3;
  unsigned __int16 v4;
  NPCHAR_0 *v5;
  Sint32 *v6;
  RECT rcDown[6];
  RECT rcUp[6];
  char v9[24];

  qmemcpy(rcUp, &ActBossChar03_01(NPCHAR *)::C.0, sizeof(rcUp));
  qmemcpy(rcDown, &ActBossChar03_01(NPCHAR *)::C.1, sizeof(rcDown));
  v1 = npc->act_no;
  if ( v1 == 201 )
  {
LABEL_37:
    if ( ++npc->act_wait > 30 )
      npc->act_no = 202;
    if ( ++npc->ani_wait > 0 )
    {
      npc->ani_wait = 0;
      ++npc->ani_no;
    }
    if ( npc->ani_no > 5 )
      npc->ani_no = 4;
    npc->xm += 32;
    goto LABEL_64;
  }
  if ( v1 <= 201 )
  {
    if ( v1 == 101 )
      goto LABEL_23;
    if ( v1 <= 101 )
    {
      if ( v1 == 10 )
      {
        npc->ani_no = 0;
        npc->bits &= 0xFFEFu;
        goto LABEL_64;
      }
      if ( v1 != 100 )
        goto LABEL_64;
      npc->bits |= 0x10u;
      npc->act_no = 101;
      npc->act_wait = 0;
      npc->ani_no = 2;
      npc->ani_wait = 0;
LABEL_23:
      if ( ++npc->act_wait > 30 )
        npc->act_no = 102;
      if ( ++npc->ani_wait > 0 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 3 )
        npc->ani_no = 2;
      npc->xm -= 32;
      goto LABEL_64;
    }
    if ( v1 != 103 )
    {
      if ( v1 >= 103 )
      {
        if ( v1 != 200 )
          goto LABEL_64;
        npc->bits |= 0x10u;
        v2 = npc->bits;
        LOBYTE(v2) = v2 | 0x80;
        npc->bits = v2;
        npc->act_no = 201;
        npc->act_wait = 0;
        npc->ani_no = 4;
        npc->ani_wait = 0;
        goto LABEL_37;
      }
      npc->bits &= 0xFFEFu;
      npc->act_no = 103;
      npc->ani_no = 0;
      npc->ani_wait = 0;
    }
    ++npc->act_wait;
    if ( ++npc->ani_wait > 1 )
    {
      npc->ani_wait = 0;
      ++npc->ani_no;
    }
    if ( npc->ani_no > 1 )
      npc->ani_no = 0;
    npc->xm -= 32;
    goto LABEL_64;
  }
  if ( v1 == 300 )
  {
    npc->act_no = 301;
    npc->ani_no = 4;
    npc->ani_wait = 0;
    npc->bits |= 0x10u;
LABEL_51:
    if ( ++npc->ani_wait > 0 )
    {
      npc->ani_wait = 0;
      ++npc->ani_no;
    }
    if ( npc->ani_no > 5 )
      npc->ani_no = 4;
    npc->xm += 32;
    if ( npc->xm > 0 )
    {
      npc->xm = 0;
      npc->act_no = 10;
    }
    goto LABEL_64;
  }
  if ( v1 > 300 )
  {
    switch ( v1 )
    {
      case 400:
        npc->act_no = 401;
        npc->ani_no = 2;
        npc->ani_wait = 0;
        npc->bits |= 0x10u;
        break;
      case 401:
        break;
      case 301:
        goto LABEL_51;
      default:
        goto LABEL_64;
    }
    if ( ++npc->ani_wait > 0 )
    {
      npc->ani_wait = 0;
      ++npc->ani_no;
    }
    if ( npc->ani_no > 3 )
      npc->ani_no = 2;
    npc->xm -= 32;
    if ( npc->xm < 0 )
    {
      npc->xm = 0;
      npc->act_no = 10;
    }
    goto LABEL_64;
  }
  if ( v1 == 202 )
  {
    npc->bits &= 0xFFEFu;
    npc->act_no = 203;
    npc->ani_no = 0;
    npc->ani_wait = 0;
  }
  else if ( v1 != 203 )
  {
    goto LABEL_64;
  }
  ++npc->act_wait;
  if ( ++npc->ani_wait > 1 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 1 )
    npc->ani_no = 0;
  npc->xm += 32;
LABEL_64:
  if ( (npc->act_no == 101 || npc->act_no == 201 || npc->act_no == 301 || npc->act_no == 401) && npc->act_wait % 2 == 1 )
    PlaySoundObject(112, 1);
  if ( (npc->act_no == 103 || npc->act_no == 203) && npc->act_wait % 4 == 1 )
    PlaySoundObject(111, 1);
  if ( npc->act_no <= 99 || y >= npc->y + 2048 || y <= npc->y - 2048 )
  {
    npc->damage = 0;
    v4 = npc->bits;
    LOBYTE(v4) = v4 & 0x7F;
    npc->bits = v4;
  }
  else
  {
    npc->damage = 10;
    v3 = npc->bits;
    LOBYTE(v3) = v3 | 0x80;
    npc->bits = v3;
  }
  if ( npc->xm > 1024 )
    npc->xm = 1024;
  if ( npc->xm < -1024 )
    npc->xm = -1024;
  npc->x += npc->xm;
  if ( npc->direct == 1 )
  {
    v5 = npc;
    v6 = (Sint32 *)&v9[16 * npc->ani_no - 96];
  }
  else
  {
    v5 = npc;
    v6 = (Sint32 *)&v9[16 * npc->ani_no - 192];
  }
  npc->rect.left = *v6;
  v5->rect.top = v6[1];
  v5->rect.right = v6[2];
  v5->rect.bottom = v6[3];
}


//----- (080B7B58) --------------------------------------------------------
void __cdecl ActBossChar03_02(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  Sint32 *v3;
  RECT rect[4];
  int direct;
  int x;
  int y;
  char v8[8];

  rect[0].left = 0;
  rect[0].top = 128;
  rect[0].right = 72;
  rect[0].bottom = 160;
  rect[1].left = 72;
  rect[1].top = 128;
  rect[1].right = 144;
  rect[1].bottom = 160;
  rect[2].left = 0;
  rect[2].top = 160;
  rect[2].right = 72;
  rect[2].bottom = 192;
  rect[3].left = 72;
  rect[3].top = 160;
  rect[3].right = 144;
  rect[3].bottom = 192;
  v1 = npc->act_no;
  if ( v1 && v1 >= 0 )
  {
    if ( v1 == 10 )
    {
      npc->act_no = 11;
      npc->act_wait = 30 * (npc->ani_no + 1);
    }
    else if ( v1 != 11 )
    {
      goto LABEL_21;
    }
    if ( npc->act_wait )
    {
      --npc->act_wait;
    }
    else
    {
      v2 = npc->ani_no;
      if ( v2 == 1 )
      {
        direct = 2;
        x = 15360;
        y = 3072;
      }
      else if ( v2 > 1 )
      {
        if ( v2 == 2 )
        {
          direct = 0;
          x = -15360;
          y = -3072;
        }
        else if ( v2 == 3 )
        {
          direct = 1;
          x = 15360;
          y = -3072;
        }
      }
      else if ( !v2 )
      {
        direct = 3;
        x = -15360;
        y = 3072;
      }
      SetNpChar(158, x + npc->x, y + npc->y, 0, 0, direct, 0, 256);
      PlaySoundObject(39, 1);
      npc->act_wait = 120;
    }
  }
LABEL_21:
  npc->x = (unk_81CCFC8 + *(&unk_81CCFC8 + 43 * npc->count1)) / 2;
  npc->y = (unk_81CCFCC + *(&unk_81CCFCC + 43 * npc->count1)) / 2;
  v3 = (Sint32 *)&v8[16 * npc->ani_no - 76];
  npc->rect.left = *v3;
  npc->rect.top = v3[1];
  npc->rect.right = v3[2];
  npc->rect.bottom = v3[3];
}


//----- (080B7DA7) --------------------------------------------------------
void __cdecl ActBossChar03_03(NPCHAR_0 *npc)
{
  switch ( npc->act_no )
  {
    case 0xA:
      npc->tgt_x += 512;
      if ( npc->tgt_x > 0x4000 )
      {
        npc->tgt_x = 0x4000;
        npc->act_no = 0;
        stru_81CD1C4.act_no = 10;
        stru_81CD270.act_no = 10;
        stru_81CD31C.act_no = 10;
        stru_81CD3C8.act_no = 10;
      }
      break;
    case 0x14:
      npc->tgt_x -= 512;
      if ( npc->tgt_x < 0 )
      {
        npc->tgt_x = 0;
        npc->act_no = 0;
        stru_81CD1C4.act_no = 0;
        stru_81CD270.act_no = 0;
        stru_81CD31C.act_no = 0;
        stru_81CD3C8.act_no = 0;
      }
      break;
    case 0x1E:
      npc->tgt_x += 512;
      if ( npc->tgt_x > 10240 )
      {
        npc->tgt_x = 10240;
        npc->act_no = 0;
        stru_81CD474.act_no = 10;
        stru_81CD87C.act_no = 10;
        stru_81CD928.act_no = 10;
        stru_81CD9D4.act_no = 10;
        stru_81CDA80.act_no = 10;
      }
      break;
    case 0x28:
      npc->tgt_x -= 512;
      if ( npc->tgt_x < 0 )
      {
        npc->tgt_x = 0;
        npc->act_no = 0;
        stru_81CD474.act_no = 0;
        stru_81CD87C.act_no = 0;
        stru_81CD928.act_no = 0;
        stru_81CD9D4.act_no = 0;
        stru_81CDA80.act_no = 0;
      }
      break;
    default:
      break;
  }
  if ( npc->direct )
  {
    npc->rect.left = 264;
    npc->rect.top = 96;
    npc->rect.right = 312;
    npc->rect.bottom = 144;
    npc->x = npc->tgt_x + unk_81CCFC8 + 12288;
  }
  else
  {
    npc->rect.left = 216;
    npc->rect.top = 96;
    npc->rect.right = 264;
    npc->rect.bottom = 144;
    npc->x = unk_81CCFC8 - 12288 - npc->tgt_x;
  }
  npc->y = unk_81CCFCC;
}

//----- (080B8026) --------------------------------------------------------
void __cdecl ActBossChar03_04(NPCHAR_0 *npc)
{
  int v1;
  char v2;
  int v3;
  Sint32 *v4;
  RECT rect[8];
  int xm;
  int ym;
  unsigned __int8 deg;
  char v9[24];

  qmemcpy(rect, &ActBossChar03_04(NPCHAR *)::C.2, sizeof(rect));
  v1 = npc->act_no;
  if ( !v1 )
  {
    npc->bits &= 0xFFDFu;
    npc->ani_no = 0;
    goto LABEL_15;
  }
  if ( v1 < 0 )
    goto LABEL_15;
  if ( v1 == 10 )
  {
    npc->act_no = 11;
    npc->act_wait = 10 * npc->tgt_x + 40;
    npc->bits |= 0x20u;
LABEL_8:
    npc->ani_no = npc->act_wait <= 15 && npc->act_wait / 2 & 1;
    if ( npc->act_wait )
    {
      --npc->act_wait;
    }
    else
    {
      deg = GetArktan(npc->x - x, npc->y - y);
      v2 = Random(-2, 2);
      deg += v2;
      ym = 3 * GetSin(deg);
      xm = 3 * GetCos(deg);
      SetNpChar(156, npc->x, npc->y, xm, ym, 0, 0, 256);
      PlaySoundObject(39, 1);
      npc->act_wait = 40;
    }
    goto LABEL_15;
  }
  if ( v1 == 11 )
    goto LABEL_8;
LABEL_15:
  v3 = npc->tgt_x;
  if ( v3 == 1 )
  {
    npc->x = unk_81CCFC8 + 14336;
    npc->y = unk_81CCFCC - 0x2000;
  }
  else if ( v3 > 1 )
  {
    if ( v3 == 2 )
    {
      npc->x = unk_81CCFC8 - 7680;
      npc->y = unk_81CCFCC + 7168;
    }
    else if ( v3 == 3 )
    {
      npc->x = unk_81CCFC8 + 8704;
      npc->y = unk_81CCFCC + 7168;
    }
  }
  else if ( !v3 )
  {
    npc->x = unk_81CCFC8 - 11264;
    npc->y = unk_81CCFCC - 0x2000;
  }
  v4 = (Sint32 *)&v9[16 * (4 * npc->ani_no + npc->tgt_x) - 140];
  npc->rect.left = *v4;
  npc->rect.top = v4[1];
  npc->rect.right = v4[2];
  npc->rect.bottom = v4[3];
}


//----- (080B82E9) --------------------------------------------------------
void __cdecl ActBossChar03_face(NPCHAR_0 *npc)
{
  int v1;
  char v2;
  RECT *v3;
  RECT rect[3];

  rect[0].left = 216;
  rect[0].top = 0;
  rect[0].right = 320;
  rect[0].bottom = 48;
  rect[1].left = 216;
  rect[1].top = 48;
  rect[1].right = 320;
  rect[1].bottom = 96;
  rect[2].left = 216;
  rect[2].top = 144;
  rect[2].right = 320;
  rect[2].bottom = 192;
  v1 = npc->act_no;
  if ( !v1 )
  {
    unk_81CD010 &= 0xFFDFu;
    npc->ani_no = 0;
    goto LABEL_13;
  }
  if ( v1 < 0 )
    goto LABEL_13;
  if ( v1 == 10 )
  {
    npc->act_no = 11;
    npc->act_wait = 10 * npc->tgt_x + 40;
    unk_81CD010 |= 0x20u;
  }
  else if ( v1 != 11 )
  {
    goto LABEL_13;
  }
  if ( unk_81CD05C )
  {
    v2 = (ActBossChar03_face(NPCHAR *)::flash++ >> 1) & 1;
    if ( v2 )
      npc->ani_no = 1;
    else
      npc->ani_no = 0;
  }
  else
  {
    npc->ani_no = 0;
  }
LABEL_13:
  stru_81CD474.x = unk_81CCFC8;
  stru_81CD474.y = unk_81CCFCC;
  if ( unk_81CD034 <= 10 )
    npc->ani_no = 2;
  v3 = &rect[npc->ani_no];
  npc->rect.left = v3->left;
  npc->rect.top = v3->top;
  npc->rect.right = v3->right;
  npc->rect.bottom = v3->bottom;
}

//----- (080B8450) --------------------------------------------------------
void ActBossChar_MonstX()
{
  int v0;
  int v1;
  int v2;
  int v3;
  int v4;
  int i;

  v0 = gBoss[0].act_no;
  if ( v0 == 400 )
  {
    gBoss[0].act_wait = 0;
    gBoss[0].act_no = 401;
    goto LABEL_93;
  }
  if ( v0 > 400 )
  {
    if ( v0 == 600 )
    {
      gBoss[0].act_no = 601;
      gBoss[0].act_wait = 0;
      gBoss[0].count2 = gBoss[0].life;
      npc.act_no = 30;
      stru_81CD118.act_no = 30;
    }
    else
    {
      if ( v0 <= 600 )
      {
        if ( v0 == 501 )
        {
LABEL_109:
          if ( ++gBoss[0].act_wait > 300 )
          {
            gBoss[0].act_no = 502;
            gBoss[0].act_wait = 0;
          }
          if ( !stru_81CD1C4.cond && !stru_81CD270.cond && !stru_81CD31C.cond && !stru_81CD3C8.cond )
          {
            gBoss[0].act_no = 502;
            gBoss[0].act_wait = 0;
          }
          goto LABEL_139;
        }
        if ( v0 > 501 )
        {
          if ( v0 == 502 )
          {
            gBoss[0].act_no = 503;
            gBoss[0].act_wait = 0;
            gBoss[0].count1 = 0;
            npc.act_no = 20;
            stru_81CD118.act_no = 20;
          }
          else if ( v0 != 503 )
          {
            goto LABEL_139;
          }
          if ( ++gBoss[0].act_wait > 50 )
          {
            if ( gBoss[0].x <= x )
              gBoss[0].act_no = 200;
            else
              gBoss[0].act_no = 100;
          }
          goto LABEL_139;
        }
        if ( v0 != 401 )
        {
          if ( v0 != 500 )
            goto LABEL_139;
          gBoss[0].act_no = 501;
          gBoss[0].act_wait = 0;
          npc.act_no = 10;
          stru_81CD118.act_no = 10;
          goto LABEL_109;
        }
LABEL_93:
        if ( ++gBoss[0].act_wait == 4 )
          stru_81CD5CC.act_no = 400;
        if ( gBoss[0].act_wait == 8 )
          stru_81CD678.act_no = 400;
        if ( gBoss[0].act_wait == 10 )
          stru_81CD724.act_no = 400;
        if ( gBoss[0].act_wait == 12 )
          stru_81CD7D0.act_no = 400;
        if ( gBoss[0].act_wait > 50 )
        {
          if ( stru_81CD1C4.cond || stru_81CD270.cond || stru_81CD31C.cond || stru_81CD3C8.cond )
            gBoss[0].act_no = 500;
          else
            gBoss[0].act_no = 600;
        }
        goto LABEL_139;
      }
      if ( v0 == 603 )
      {
LABEL_126:
        if ( ++gBoss[0].act_wait > 50 )
        {
          if ( gBoss[0].x <= x )
            gBoss[0].act_no = 200;
          else
            gBoss[0].act_no = 100;
        }
        goto LABEL_139;
      }
      if ( v0 > 603 )
      {
        if ( v0 == 1000 )
        {
          SetQuake(2);
          if ( !(++gBoss[0].act_wait & 7) )
            PlaySoundObject(52, 1);
          v1 = gBoss[0].y;
          v2 = (Random(-64, 64) << 9) + v1;
          v3 = gBoss[0].x;
          v4 = Random(-72, 72);
          SetDestroyNpChar(v3 + (v4 << 9), v2, 1, 1);
          if ( gBoss[0].act_wait > 100 )
          {
            gBoss[0].act_wait = 0;
            gBoss[0].act_no = 1001;
            SetFlash(gBoss[0].x, gBoss[0].y, 1);
            PlaySoundObject(35, 1);
          }
        }
        else if ( v0 == 1001 )
        {
          SetQuake(40);
          if ( ++gBoss[0].act_wait > 50 )
          {
            for ( i = 0; i <= 19; ++i )
              gBoss[i].cond = 0;
            DeleteNpCharCode(158, 1);
            SetNpChar(159, gBoss[0].x, gBoss[0].y - 12288, 0, 0, 0, 0, 0);
          }
        }
        goto LABEL_139;
      }
      if ( v0 != 601 )
      {
        if ( v0 != 602 )
          goto LABEL_139;
        gBoss[0].act_no = 603;
        gBoss[0].act_wait = 0;
        gBoss[0].count1 = 0;
        npc.act_no = 40;
        stru_81CD118.act_no = 40;
        goto LABEL_126;
      }
    }
    ++gBoss[0].act_wait;
    if ( gBoss[0].life < gBoss[0].count2 - 200 || gBoss[0].act_wait > 300 )
    {
      gBoss[0].act_no = 602;
      gBoss[0].act_wait = 0;
    }
    goto LABEL_139;
  }
  if ( v0 == 100 )
  {
    gBoss[0].act_wait = 0;
    gBoss[0].act_no = 101;
    ++gBoss[0].count1;
    goto LABEL_47;
  }
  if ( v0 <= 100 )
  {
    if ( v0 == 2 )
      goto LABEL_139;
    if ( v0 > 2 )
    {
      if ( v0 == 10 )
      {
        gBoss[0].act_no = 11;
        gBoss[0].act_wait = 0;
        gBoss[0].count1 = 0;
      }
      else if ( v0 != 11 )
      {
        goto LABEL_139;
      }
      if ( ++gBoss[0].act_wait > 100 )
      {
        gBoss[0].act_wait = 0;
        if ( gBoss[0].x <= x )
          gBoss[0].act_no = 200;
        else
          gBoss[0].act_no = 100;
      }
    }
    else if ( v0 )
    {
      if ( v0 == 1 )
      {
        gBoss[0].life = 700;
        gBoss[0].exp = 1;
        gBoss[0].act_no = 1;
        gBoss[0].x = 0x100000;
        gBoss[0].y = 102400;
        gBoss[0].hit_voice = 54;
        gBoss[0].hit.front = 12288;
        gBoss[0].hit.top = 12288;
        gBoss[0].hit.back = 12288;
        gBoss[0].hit.bottom = 12288;
        gBoss[0].bits = -32248;
        gBoss[0].size = 3;
        gBoss[0].code_event = 1000;
        gBoss[0].ani_no = 0;
        npc.cond = -128;
        npc.size = 3;
        npc.direct = 0;
        npc.view.front = 12288;
        npc.view.top = 12288;
        npc.view.back = 12288;
        npc.view.bottom = 12288;
        npc.bits = 8;
        qmemcpy(&stru_81CD118, &npc, sizeof(stru_81CD118));
        stru_81CD118.direct = 2;
        stru_81CD1C4.cond = -128;
        stru_81CD1C4.life = 60;
        stru_81CD1C4.hit_voice = 54;
        stru_81CD1C4.destroy_voice = 71;
        stru_81CD1C4.size = 2;
        stru_81CD1C4.view.front = 4096;
        stru_81CD1C4.view.top = 4096;
        stru_81CD1C4.view.back = 4096;
        stru_81CD1C4.view.bottom = 4096;
        stru_81CD1C4.hit.front = 2560;
        stru_81CD1C4.hit.back = 2560;
        stru_81CD1C4.hit.top = 2560;
        stru_81CD1C4.hit.bottom = 2560;
        stru_81CD1C4.bits = 8;
        stru_81CD1C4.tgt_x = 0;
        qmemcpy(&stru_81CD270, &stru_81CD1C4, sizeof(stru_81CD270));
        stru_81CD270.tgt_x = 1;
        qmemcpy(&stru_81CD31C, &stru_81CD1C4, sizeof(stru_81CD31C));
        stru_81CD31C.tgt_x = 2;
        stru_81CD31C.life = 100;
        qmemcpy(&stru_81CD3C8, &stru_81CD1C4, sizeof(stru_81CD3C8));
        stru_81CD3C8.tgt_x = 3;
        stru_81CD3C8.life = 100;
        stru_81CD474.cond = -128;
        stru_81CD474.x = 0x100000;
        stru_81CD474.y = 102400;
        stru_81CD474.view.front = 26624;
        stru_81CD474.view.top = 12288;
        stru_81CD474.view.back = 26624;
        stru_81CD474.view.bottom = 12288;
        stru_81CD474.hit_voice = 52;
        stru_81CD474.hit.front = 4096;
        stru_81CD474.hit.top = 12288;
        stru_81CD474.hit.back = 4096;
        stru_81CD474.hit.bottom = 0x2000;
        stru_81CD474.bits = 8;
        stru_81CD474.size = 3;
        stru_81CD474.ani_no = 0;
        stru_81CD5CC.cond = -128;
        stru_81CD5CC.act_no = 0;
        stru_81CD5CC.direct = 1;
        stru_81CD5CC.x = 1015808;
        stru_81CD5CC.y = 73728;
        stru_81CD5CC.view.front = 18432;
        stru_81CD5CC.view.top = 4096;
        stru_81CD5CC.view.back = 18432;
        stru_81CD5CC.view.bottom = 12288;
        stru_81CD5CC.hit_voice = 52;
        stru_81CD5CC.hit.front = 14336;
        stru_81CD5CC.hit.top = 4096;
        stru_81CD5CC.hit.back = 14336;
        stru_81CD5CC.hit.bottom = 0x2000;
        stru_81CD5CC.bits = 141;
        stru_81CD5CC.size = 3;
        qmemcpy(&stru_81CD678, &stru_81CD5CC, sizeof(stru_81CD678));
        stru_81CD678.x = 1081344;
        qmemcpy(&stru_81CD724, &stru_81CD5CC, sizeof(stru_81CD724));
        stru_81CD724.direct = 3;
        stru_81CD724.x = 1015808;
        stru_81CD724.y = 0x20000;
        stru_81CD724.view.top = 12288;
        stru_81CD724.view.bottom = 4096;
        stru_81CD724.hit.top = 0x2000;
        stru_81CD724.hit.bottom = 4096;
        qmemcpy(&stru_81CD7D0, &stru_81CD724, sizeof(stru_81CD7D0));
        stru_81CD7D0.x = 1081344;
        qmemcpy(&stru_81CD87C, &stru_81CD5CC, sizeof(stru_81CD87C));
        stru_81CD87C.cond = -128;
        stru_81CD87C.view.top = 0x2000;
        stru_81CD87C.view.bottom = 0x2000;
        stru_81CD87C.view.front = 15360;
        stru_81CD87C.view.back = 21504;
        stru_81CD87C.count1 = 9;
        stru_81CD87C.ani_no = 0;
        stru_81CD87C.bits = 8;
        qmemcpy(&stru_81CD928, &stru_81CD87C, sizeof(stru_81CD928));
        stru_81CD928.view.front = 21504;
        stru_81CD928.view.back = 15360;
        stru_81CD928.count1 = 10;
        stru_81CD928.ani_no = 1;
        stru_81CD928.bits = 8;
        qmemcpy(&stru_81CD9D4, &stru_81CD87C, sizeof(stru_81CD9D4));
        stru_81CD9D4.view.top = 0x2000;
        stru_81CD9D4.view.bottom = 0x2000;
        stru_81CD9D4.count1 = 11;
        stru_81CD9D4.ani_no = 2;
        stru_81CD9D4.bits = 8;
        qmemcpy(&stru_81CDA80, &stru_81CD9D4, sizeof(stru_81CDA80));
        stru_81CDA80.view.front = 21504;
        stru_81CDA80.view.back = 15360;
        stru_81CDA80.count1 = 12;
        stru_81CDA80.ani_no = 3;
        stru_81CDA80.bits = 8;
        gBoss[0].act_no = 2;
      }
    }
    else
    {
      gBoss[0].life = 1;
      gBoss[0].x = -163840;
    }
    goto LABEL_139;
  }
  if ( v0 == 201 )
  {
LABEL_62:
    if ( ++gBoss[0].act_wait == 4 )
      stru_81CD5CC.act_no = 200;
    if ( gBoss[0].act_wait == 8 )
      stru_81CD678.act_no = 200;
    if ( gBoss[0].act_wait == 10 )
      stru_81CD724.act_no = 200;
    if ( gBoss[0].act_wait == 12 )
      stru_81CD7D0.act_no = 200;
    if ( gBoss[0].act_wait > 120 && gBoss[0].count1 > 2 )
      gBoss[0].act_no = 400;
    if ( gBoss[0].act_wait > 121 && x < gBoss[0].x )
      gBoss[0].act_no = 100;
    goto LABEL_139;
  }
  if ( v0 <= 201 )
  {
    if ( v0 != 101 )
    {
      if ( v0 != 200 )
        goto LABEL_139;
      gBoss[0].act_wait = 0;
      gBoss[0].act_no = 201;
      ++gBoss[0].count1;
      goto LABEL_62;
    }
LABEL_47:
    if ( ++gBoss[0].act_wait == 4 )
      stru_81CD5CC.act_no = 100;
    if ( gBoss[0].act_wait == 8 )
      stru_81CD678.act_no = 100;
    if ( gBoss[0].act_wait == 10 )
      stru_81CD724.act_no = 100;
    if ( gBoss[0].act_wait == 12 )
      stru_81CD7D0.act_no = 100;
    if ( gBoss[0].act_wait > 120 && gBoss[0].count1 > 2 )
      gBoss[0].act_no = 300;
    if ( gBoss[0].act_wait > 121 && x > gBoss[0].x )
      gBoss[0].act_no = 200;
    goto LABEL_139;
  }
  if ( v0 == 300 )
  {
    gBoss[0].act_wait = 0;
    gBoss[0].act_no = 301;
  }
  else if ( v0 != 301 )
  {
    goto LABEL_139;
  }
  if ( ++gBoss[0].act_wait == 4 )
    stru_81CD5CC.act_no = 300;
  if ( gBoss[0].act_wait == 8 )
    stru_81CD678.act_no = 300;
  if ( gBoss[0].act_wait == 10 )
    stru_81CD724.act_no = 300;
  if ( gBoss[0].act_wait == 12 )
    stru_81CD7D0.act_no = 300;
  if ( gBoss[0].act_wait > 50 )
  {
    if ( stru_81CD1C4.cond || stru_81CD270.cond || stru_81CD31C.cond || stru_81CD3C8.cond )
      gBoss[0].act_no = 500;
    else
      gBoss[0].act_no = 600;
  }
LABEL_139:
  ActBossChar03_01(&stru_81CD5CC);
  ActBossChar03_01(&stru_81CD678);
  ActBossChar03_01(&stru_81CD724);
  ActBossChar03_01(&stru_81CD7D0);
  gBoss[0].x += ((stru_81CD724.x + stru_81CD678.x + stru_81CD5CC.x + stru_81CD7D0.x) / 4 - gBoss[0].x) / 16;
  ActBossChar03_face(&stru_81CD474);
  ActBossChar03_02(&stru_81CD87C);
  ActBossChar03_02(&stru_81CD928);
  ActBossChar03_02(&stru_81CD9D4);
  ActBossChar03_02(&stru_81CDA80);
  ActBossChar03_03(&npc);
  ActBossChar03_03(&stru_81CD118);
  if ( stru_81CD1C4.cond )
    ActBossChar03_04(&stru_81CD1C4);
  if ( stru_81CD270.cond )
    ActBossChar03_04(&stru_81CD270);
  if ( stru_81CD31C.cond )
    ActBossChar03_04(&stru_81CD31C);
  if ( stru_81CD3C8.cond )
    ActBossChar03_04(&stru_81CD3C8);
  if ( !gBoss[0].life && gBoss[0].act_no <= 999 )
  {
    gBoss[0].act_no = 1000;
    gBoss[0].act_wait = 0;
    gBoss[0].shock = -106;
    stru_81CD5CC.act_no = 300;
    stru_81CD678.act_no = 300;
    stru_81CD724.act_no = 300;
    stru_81CD7D0.act_no = 300;
  }
}

//----- (080B9450) --------------------------------------------------------
void __cdecl ActNpc080(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  Sint32 *v2;
  RECT rcRight[7];
  RECT rcLeft[7];
  char v5[12];

  qmemcpy(rcLeft, &ActNpc080(NPCHAR *)::C.0, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc080(NPCHAR *)::C.1, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->bits &= 0xFFDFu;
      npc->act_no = 1;
      npc->damage = 0;
      npc->hit.front = 2048;
      goto LABEL_3;
    case 1:
LABEL_3:
      npc->ani_no = 0;
      if ( npc->x - 0x10000 < x && npc->x + 0x10000 > x && npc->y - 24576 < y && npc->y + 0x4000 > y )
      {
        npc->ani_wait = 0;
        npc->act_no = 2;
      }
      if ( npc->shock )
      {
        npc->ani_no = 1;
        npc->ani_wait = 0;
        npc->act_no = 2;
        npc->bits &= 0xFFDFu;
      }
      if ( x >= npc->x )
        npc->direct = 2;
      else
        npc->direct = 0;
      break;
    case 2:
      if ( ++npc->ani_wait > 6 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 3 )
        npc->ani_no = 0;
      if ( npc->x - 0x2000 < x && npc->x + 0x2000 > x )
      {
        npc->hit.front = 9216;
        npc->act_wait = 0;
        npc->act_no = 3;
        npc->bits |= 0x20u;
        if ( npc->direct )
          npc->xm = 1024;
        else
          npc->xm = -1024;
      }
      if ( x >= npc->x )
      {
        npc->direct = 2;
        npc->xm = 256;
      }
      else
      {
        npc->direct = 0;
        npc->xm = -256;
      }
      break;
    case 3:
      npc->xm = 0;
      if ( ++npc->act_wait > 40 )
      {
        npc->act_wait = 0;
        npc->act_no = 4;
      }
      npc->ani_no = 4;
      break;
    case 4:
      npc->damage = 10;
      if ( ++npc->act_wait > 2 )
      {
        npc->act_wait = 0;
        npc->act_no = 5;
      }
      npc->ani_no = 5;
      break;
    case 5:
      npc->ani_no = 6;
      if ( ++npc->act_wait > 60 )
        npc->act_no = 0;
      break;
    default:
      break;
  }
  if ( npc->xm < 0 && npc->flag & 1 )
    npc->xm = 0;
  if ( npc->xm > 0 && npc->flag & 4 )
    npc->xm = 0;
  npc->ym += 32;
  if ( npc->xm > 1024 )
    npc->xm = 1024;
  if ( npc->xm < -1024 )
    npc->xm = -1024;
  if ( npc->ym > 1535 )
    npc->xm = 1535;
  if ( npc->ym < -1535 )
    npc->xm = -1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v1 = npc;
    v2 = (Sint32 *)&v5[16 * npc->ani_no - 224];
  }
  else
  {
    v1 = npc;
    v2 = (Sint32 *)&v5[16 * npc->ani_no - 112];
  }
  npc->rect.left = *v2;
  v1->rect.top = v2[1];
  v1->rect.right = v2[2];
  v1->rect.bottom = v2[3];
}


//----- (080B98B9) --------------------------------------------------------
void __cdecl ActNpc081(NPCHAR_0 *npc)
{
  unsigned int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[6];
  RECT rcLeft[6];
  char v6[24];

  qmemcpy(rcLeft, &ActNpc081(NPCHAR *)::C.2, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc081(NPCHAR *)::C.3, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      npc->xm = 0;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( Random(0, 100) == 1 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      else
      {
        if ( Random(0, 150) == 1 )
        {
          if ( npc->direct )
            npc->direct = 0;
          else
            npc->direct = 2;
        }
        if ( Random(0, 150) == 1 )
        {
          npc->act_no = 3;
          npc->act_wait = 50;
          npc->ani_no = 0;
        }
      }
      break;
    case 2:
      if ( ++npc->act_wait > 8 )
      {
        npc->act_no = 1;
        npc->ani_no = 0;
      }
      break;
    case 3:
      npc->act_no = 4;
      npc->ani_no = 2;
      npc->ani_wait = 0;
      goto LABEL_14;
    case 4:
LABEL_14:
      if ( !--npc->act_wait )
        npc->act_no = 0;
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 4 )
        npc->ani_no = 2;
      if ( npc->flag & 1 )
      {
        npc->direct = 2;
        npc->xm = 512;
      }
      if ( npc->flag & 4 )
      {
        npc->direct = 0;
        npc->xm = -512;
      }
      if ( npc->direct )
        npc->xm = 256;
      else
        npc->xm = -256;
      break;
    case 5:
      if ( npc->flag & 8 )
        npc->act_no = 0;
      break;
    default:
      break;
  }
  v1 = npc->act_no;
  if ( v1 <= 4 && (1 << v1) & 0x16 && npc->shock )
  {
    npc->ym = -512;
    npc->ani_no = 5;
    npc->act_no = 5;
    if ( npc->x >= x )
      npc->xm = -256;
    else
      npc->xm = 256;
  }
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 192];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 96];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (080B9C67) --------------------------------------------------------
void __cdecl ActNpc082(NPCHAR_0 *npc)
{
  unsigned int v1;
  int v2;
  NPCHAR_0 *v3;
  Sint32 *v4;
  RECT rcRight[9];
  RECT rcLeft[9];
  char v7[24];

  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 2;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( Random(0, 120) == 10 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 3;
      }
      break;
    case 2:
      if ( ++npc->act_wait > 8 )
      {
        npc->act_no = 1;
        npc->ani_no = 2;
      }
      break;
    case 0xF:
      npc->act_no = 16;
      npc->act_wait = 0;
      npc->ani_no = 4;
      goto LABEL_8;
    case 0x10:
LABEL_8:
      if ( ++npc->act_wait == 30 )
      {
        PlaySoundObject(21, 1);
        SetNpChar(66, npc->x, npc->y - 0x2000, 0, 0, 0, npc, 0);
      }
      if ( npc->act_wait == 50 )
        npc->act_no = 14;
      break;
    case 0x14:
      npc->act_no = 21;
      npc->ani_no = 0;
      npc->ym = 0;
      npc->bits |= 8u;
      goto LABEL_13;
    case 0x15:
LABEL_13:
      npc->ym -= 32;
      if ( npc->y < -4096 )
        npc->cond = 0;
      break;
    case 0x19:
      npc->act_no = 26;
      npc->act_wait = 0;
      npc->ani_no = 5;
      npc->ani_wait = 0;
      goto LABEL_16;
    case 0x1A:
LABEL_16:
      if ( ++npc->ani_no > 7 )
        npc->ani_no = 5;
      if ( ++npc->act_wait == 30 )
      {
        PlaySoundObject(101, 1);
        SetFlash(0, 0, 2);
        npc->act_no = 27;
        npc->ani_no = 7;
      }
      break;
    case 0x1B:
      if ( ++npc->act_wait == 50 )
      {
        npc->act_no = 0;
        npc->ani_no = 0;
      }
      break;
    case 0x1E:
      npc->act_no = 31;
      npc->ani_no = 3;
      npc->ani_wait = 0;
      goto LABEL_23;
    case 0x1F:
LABEL_23:
      if ( ++npc->ani_wait > 10 )
      {
        npc->act_no = 32;
        npc->ani_no = 4;
        npc->ani_wait = 0;
      }
      break;
    case 0x20:
      if ( ++npc->ani_wait > 100 )
      {
        npc->act_no = 1;
        npc->ani_no = 2;
      }
      break;
    case 0x28:
      npc->act_no = 41;
      npc->act_wait = 0;
      goto LABEL_28;
    case 0x29:
LABEL_28:
      npc->ani_no = 4;
      v1 = ++npc->act_wait - 30;
      if ( v1 <= 0x14 && (1 << v1) & 0x100401 )
      {
        v2 = Random(-512, 0);
        SetNpChar(11, npc->x + 4096, npc->y - 4096, 1536, v2, 0, 0, 256);
        PlaySoundObject(33, 1);
      }
      if ( npc->act_wait > 50 )
        npc->act_no = 0;
      break;
    case 0x32:
      npc->ani_no = 8;
      break;
    default:
      break;
  }
  npc->x += npc->xm;
  npc->y += npc->ym;
  qmemcpy(rcLeft, &ActNpc082(NPCHAR *)::C.8, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc082(NPCHAR *)::C.9, sizeof(rcRight));
  if ( npc->act_no == 11 )
  {
    if ( npc->ani_wait )
    {
      --npc->ani_wait;
      npc->ani_no = 1;
    }
    else
    {
      if ( Random(0, 100) == 1 )
        npc->ani_wait = 30;
      npc->ani_no = 0;
    }
  }
  if ( npc->act_no == 14 )
  {
    if ( npc->ani_wait )
    {
      --npc->ani_wait;
      npc->ani_no = 3;
    }
    else
    {
      if ( Random(0, 100) == 1 )
        npc->ani_wait = 30;
      npc->ani_no = 2;
    }
  }
  if ( npc->direct )
  {
    v3 = npc;
    v4 = (Sint32 *)&v7[16 * npc->ani_no - 288];
  }
  else
  {
    v3 = npc;
    v4 = (Sint32 *)&v7[16 * npc->ani_no - 144];
  }
  npc->rect.left = *v4;
  v3->rect.top = v4[1];
  v3->rect.right = v4[2];
  v3->rect.bottom = v4[3];
}


//----- (080BA248) --------------------------------------------------------
void __cdecl ActNpc083(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  Sint32 *v2;
  RECT rcRight[8];
  RECT rcLeft[8];
  char v5[24];

  qmemcpy(rcLeft, &ActNpc083(NPCHAR *)::C.12, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc083(NPCHAR *)::C.13, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->xm = 0;
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( ++npc->ani_wait > 5 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 1 )
        npc->ani_no = 0;
      break;
    case 2:
      npc->act_no = 3;
      npc->ani_no = 2;
      npc->ani_wait = 0;
      goto LABEL_8;
    case 3:
LABEL_8:
      if ( ++npc->ani_wait > 3 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 5 )
        npc->ani_no = 2;
      if ( npc->direct )
        npc->xm = 512;
      else
        npc->xm = -512;
      break;
    case 4:
      npc->xm = 0;
      npc->act_no = 5;
      npc->act_wait = 0;
      npc->ani_no = 6;
      goto LABEL_16;
    case 5:
LABEL_16:
      if ( ++npc->act_wait > 10 )
      {
        npc->act_wait = 0;
        npc->act_no = 6;
        npc->ani_no = 7;
        PlaySoundObject(70, 1);
      }
      break;
    case 6:
      if ( ++npc->act_wait > 8 )
      {
        npc->act_no = 0;
        npc->ani_no = 0;
      }
      break;
    case 7:
      npc->act_no = 1;
      break;
    default:
      break;
  }
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v1 = npc;
    v2 = (Sint32 *)&v5[16 * npc->ani_no - 256];
  }
  else
  {
    v1 = npc;
    v2 = (Sint32 *)&v5[16 * npc->ani_no - 128];
  }
  npc->rect.left = *v2;
  v1->rect.top = v2[1];
  v1->rect.right = v2[2];
  v1->rect.bottom = v2[3];
}


//----- (080BA51C) --------------------------------------------------------
void __cdecl ActNpc084(NPCHAR_0 *npc)
{
  Sint32 *v1;
  RECT rect_left[4];
  char v3[8];

  if ( npc->flag & 0xFF )
  {
    SetCaret(npc->x, npc->y, 2, 0);
    npc->cond = 0;
  }
  npc->y += npc->ym;
  npc->x += npc->xm;
  rect_left[0].left = 48;
  rect_left[0].top = 48;
  rect_left[0].right = 64;
  rect_left[0].bottom = 64;
  rect_left[1].left = 64;
  rect_left[1].top = 48;
  rect_left[1].right = 80;
  rect_left[1].bottom = 64;
  rect_left[2].left = 48;
  rect_left[2].top = 64;
  rect_left[2].right = 64;
  rect_left[2].bottom = 80;
  rect_left[3].left = 64;
  rect_left[3].top = 64;
  rect_left[3].right = 80;
  rect_left[3].bottom = 80;
  if ( ++npc->ani_wait > 2 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 3 )
    npc->ani_no = 0;
  v1 = (Sint32 *)&v3[16 * npc->ani_no - 64];
  npc->rect.left = *v1;
  npc->rect.top = v1[1];
  npc->rect.right = v1[2];
  npc->rect.bottom = v1[3];
  if ( ++npc->count1 > 300 )
  {
    SetCaret(npc->x, npc->y, 2, 0);
    npc->cond = 0;
  }
}


//----- (080BA6B7) --------------------------------------------------------
void __cdecl ActNpc085(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[3];
  RECT rcLeft[3];
  char v6[8];

  rcLeft[0].left = 256;
  rcLeft[0].top = 96;
  rcLeft[0].right = 272;
  rcLeft[0].bottom = 120;
  rcLeft[1].left = 256;
  rcLeft[1].top = 96;
  rcLeft[1].right = 272;
  rcLeft[1].bottom = 120;
  rcLeft[2].left = 272;
  rcLeft[2].top = 96;
  rcLeft[2].right = 288;
  rcLeft[2].bottom = 120;
  rcRight[0].left = 256;
  rcRight[0].top = 96;
  rcRight[0].right = 272;
  rcRight[0].bottom = 120;
  rcRight[1].left = 288;
  rcRight[1].top = 96;
  rcRight[1].right = 304;
  rcRight[1].bottom = 120;
  rcRight[2].left = 304;
  rcRight[2].top = 96;
  rcRight[2].right = 320;
  rcRight[2].bottom = 120;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 == 1 && ++npc->ani_no > 2 )
      npc->ani_no = 1;
  }
  else
  {
    npc->ani_no = 0;
    if ( npc->x - 4096 < x && npc->x + 4096 > x && npc->y - 0x2000 < y && npc->y + 4096 > y )
    {
      PlaySoundObject(43, 1);
      npc->act_no = 1;
    }
  }
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 96];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 48];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (080BA895) --------------------------------------------------------
void __cdecl ActNpc086(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  Sint32 *v3;
  RECT rect3[2];
  RECT rect1[2];
  RECT rcLast;
  char v7[8];

  rect1[0].left = 0;
  rect1[0].top = 80;
  rect1[0].right = 16;
  rect1[0].bottom = 96;
  rect1[1].left = 16;
  rect1[1].top = 80;
  rect1[1].right = 32;
  rect1[1].bottom = 96;
  rect3[0].left = 0;
  rect3[0].top = 112;
  rect3[0].right = 16;
  rect3[0].bottom = 128;
  rect3[1].left = 16;
  rect3[1].top = 112;
  rect3[1].right = 32;
  rect3[1].bottom = 128;
  rcLast.left = 16;
  rcLast.top = 0;
  rcLast.right = 32;
  rcLast.bottom = 16;
  if ( !npc->direct )
  {
    if ( ++npc->ani_wait > 2 )
    {
      npc->ani_wait = 0;
      ++npc->ani_no;
    }
    if ( npc->ani_no > 1 )
      npc->ani_no = 0;
  }
  if ( gBack.type == 5 || gBack.type == 6 )
  {
    if ( !npc->act_no )
    {
      npc->act_no = 1;
      npc->ym = Random(-32, 32);
      npc->xm = Random(127, 256);
    }
    npc->xm -= 8;
    if ( npc->x <= 40959 )
      npc->cond = 0;
    if ( npc->x < -1536 )
      npc->x = -1536;
    if ( npc->flag & 1 )
      npc->xm = 256;
    if ( npc->flag & 2 )
      npc->ym = 64;
    if ( npc->flag & 8 )
      npc->ym = -64;
    npc->x += npc->xm;
    npc->y += npc->ym;
  }
  v1 = npc->exp;
  if ( v1 == 1 )
  {
    v2 = (Sint32 *)&v7[16 * npc->ani_no - 48];
    npc->rect.left = *v2;
    npc->rect.top = v2[1];
    npc->rect.right = v2[2];
    npc->rect.bottom = v2[3];
  }
  else if ( v1 == 3 )
  {
    v3 = (Sint32 *)&v7[16 * npc->ani_no - 80];
    npc->rect.left = *v3;
    npc->rect.top = v3[1];
    npc->rect.right = v3[2];
    npc->rect.bottom = v3[3];
  }
  if ( !npc->direct )
    ++npc->count1;
  if ( npc->count1 > 550 )
    npc->cond = 0;
  if ( npc->count1 > 500 && npc->count1 / 2 & 1 )
    npc->rect.right = 0;
  if ( npc->count1 > 547 )
    npc->rect = rcLast;
}


//----- (080BAB6F) --------------------------------------------------------
void __cdecl ActNpc087(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  Sint32 *v3;
  RECT rect6[2];
  RECT rect2[2];
  RECT rcLast;
  char v7[8];

  rect2[0].left = 32;
  rect2[0].top = 80;
  rect2[0].right = 48;
  rect2[0].bottom = 96;
  rect2[1].left = 48;
  rect2[1].top = 80;
  rect2[1].right = 64;
  rect2[1].bottom = 96;
  rect6[0].left = 64;
  rect6[0].top = 80;
  rect6[0].right = 80;
  rect6[0].bottom = 96;
  rect6[1].left = 80;
  rect6[1].top = 80;
  rect6[1].right = 96;
  rect6[1].bottom = 96;
  rcLast.left = 16;
  rcLast.top = 0;
  rcLast.right = 32;
  rcLast.bottom = 16;
  if ( !npc->direct )
  {
    if ( ++npc->ani_wait > 2 )
    {
      npc->ani_wait = 0;
      ++npc->ani_no;
    }
    if ( npc->ani_no > 1 )
      npc->ani_no = 0;
  }
  if ( gBack.type == 5 || gBack.type == 6 )
  {
    if ( !npc->act_no )
    {
      npc->act_no = 1;
      npc->ym = Random(-32, 32);
      npc->xm = Random(127, 256);
    }
    npc->xm -= 8;
    if ( npc->x <= 40959 )
      npc->cond = 0;
    if ( npc->x < -1536 )
      npc->x = -1536;
    if ( npc->flag & 1 )
      npc->xm = 256;
    if ( npc->flag & 2 )
      npc->ym = 64;
    if ( npc->flag & 8 )
      npc->ym = -64;
    npc->x += npc->xm;
    npc->y += npc->ym;
  }
  v1 = npc->exp;
  if ( v1 == 2 )
  {
    v2 = (Sint32 *)&v7[16 * npc->ani_no - 48];
    npc->rect.left = *v2;
    npc->rect.top = v2[1];
    npc->rect.right = v2[2];
    npc->rect.bottom = v2[3];
  }
  else if ( v1 == 6 )
  {
    v3 = (Sint32 *)&v7[16 * npc->ani_no - 80];
    npc->rect.left = *v3;
    npc->rect.top = v3[1];
    npc->rect.right = v3[2];
    npc->rect.bottom = v3[3];
  }
  if ( !npc->direct )
    ++npc->count1;
  if ( npc->count1 > 550 )
    npc->cond = 0;
  if ( npc->count1 > 500 && npc->count1 / 2 & 1 )
    npc->rect.right = 0;
  if ( npc->count1 > 547 )
    npc->rect = rcLast;
}


//----- (080BAE49) --------------------------------------------------------
void __cdecl ActNpc088(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  char v7;
  NPCHAR_0 *v8;
  Sint32 *v9;
  RECT rcRight[12];
  RECT rcLeft[12];
  int i;
  unsigned __int8 deg;
  int xm;
  int ym;
  char v16[24];

  qmemcpy(rcLeft, &ActNpc088(NPCHAR *)::C.14, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc088(NPCHAR *)::C.15, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->xm = 0;
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( ++npc->ani_wait > 5 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 1 )
        npc->ani_no = 0;
      if ( ++npc->act_wait > 50 )
        npc->act_no = 2;
      break;
    case 2:
      npc->act_no = 3;
      npc->act_wait = 0;
      npc->ani_no = 2;
      npc->ani_wait = 0;
      if ( ++npc->count1 > 2 && npc->life <= 150 )
      {
        npc->count2 = 1;
        if ( x >= npc->x )
          npc->direct = 0;
        else
          npc->direct = 2;
      }
      else
      {
        npc->count2 = 0;
        if ( x >= npc->x )
          npc->direct = 2;
        else
          npc->direct = 0;
      }
      goto LABEL_17;
    case 3:
LABEL_17:
      ++npc->act_wait;
      if ( ++npc->ani_wait > 3 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 5 )
        npc->ani_no = 2;
      if ( npc->direct )
        npc->xm = 512;
      else
        npc->xm = -512;
      if ( npc->count2 )
      {
        if ( npc->act_wait > 16 )
        {
          npc->act_no = 9;
          npc->xm = 0;
          npc->ani_no = 10;
        }
      }
      else if ( npc->act_wait <= 50 )
      {
        if ( npc->direct )
        {
          if ( npc->x + 12288 > x )
            npc->act_no = 4;
        }
        else if ( npc->x - 12288 < x )
        {
          npc->act_no = 4;
        }
      }
      else
      {
        npc->ani_no = 8;
        npc->ym = -1024;
        npc->act_no = 7;
        npc->act_wait = 0;
        npc->xm = 3 * npc->xm / 2;
        npc->damage = 2;
      }
      break;
    case 4:
      npc->xm = 0;
      npc->act_no = 5;
      npc->act_wait = 0;
      npc->ani_no = 6;
      goto LABEL_35;
    case 5:
LABEL_35:
      if ( ++npc->act_wait > 12 )
      {
        npc->act_wait = 0;
        npc->act_no = 6;
        npc->ani_no = 7;
        PlaySoundObject(70, 1);
        npc->damage = 5;
        npc->hit.front = 12288;
        npc->hit.top = 1;
      }
      break;
    case 6:
      if ( ++npc->act_wait > 10 )
      {
        npc->act_no = 0;
        npc->ani_no = 0;
        npc->damage = 0;
        npc->hit.front = 4096;
        npc->hit.top = 0x2000;
      }
      break;
    case 7:
      if ( npc->flag & 8 )
      {
        npc->act_no = 8;
        npc->ani_no = 9;
        PlaySoundObject(26, 1);
        SetQuake(30);
        npc->damage = 0;
        for ( i = 0; i <= 3; ++i )
        {
          v1 = Random(-1536, 0);
          v2 = Random(-341, 341);
          v3 = npc->y;
          v4 = (Random(-12, 12) << 9) + v3;
          v5 = npc->x;
          v6 = Random(-12, 12);
          SetNpChar(4, v5 + (v6 << 9), v4, v2, v1, 0, 0, 256);
        }
      }
      break;
    case 8:
      npc->xm = 0;
      if ( ++npc->act_wait > 10 )
      {
        npc->act_no = 0;
        npc->ani_no = 0;
        npc->damage = 0;
      }
      break;
    case 9:
      npc->act_no = 10;
      npc->act_wait = 0;
      if ( x >= npc->x )
        npc->direct = 2;
      else
        npc->direct = 0;
      goto LABEL_49;
    case 0xA:
LABEL_49:
      if ( ++npc->act_wait > 100 && npc->act_wait % 6 == 1 )
      {
        if ( npc->direct )
          deg = -8;
        else
          deg = -120;
        v7 = Random(-16, 16);
        deg += v7;
        ym = 3 * GetSin(deg);
        xm = 3 * GetCos(deg);
        SetNpChar(11, npc->x, npc->y + 2048, xm, ym, 0, 0, 256);
        PlaySoundObject(12, 1);
      }
      if ( npc->act_wait > 50 && npc->act_wait / 2 & 1 )
        npc->ani_no = 11;
      else
        npc->ani_no = 10;
      if ( npc->act_wait > 132 )
      {
        npc->act_no = 0;
        npc->ani_no = 0;
        npc->count1 = 0;
      }
      break;
    default:
      break;
  }
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v8 = npc;
    v9 = (Sint32 *)&v16[16 * npc->ani_no - 400];
  }
  else
  {
    v8 = npc;
    v9 = (Sint32 *)&v16[16 * npc->ani_no - 208];
  }
  npc->rect.left = *v9;
  v8->rect.top = v9[1];
  v8->rect.right = v9[2];
  v8->rect.bottom = v9[3];
}


//----- (080BB63D) --------------------------------------------------------
void __cdecl ActNpc089(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  int v8;
  int v9;
  int v10;
  int v11;
  int v12;
  int v13;
  int v14;
  int v15;
  int v16;
  int v17;
  int v18;
  int v19;
  NPCHAR_0 *v20;
  Sint32 *v21;
  NPCHAR_0 *v22;
  Sint32 *v23;
  RECT rcRight[4];
  RECT rcLeft[4];
  int i;
  char v27[24];

  rcLeft[0].left = 80;
  rcLeft[0].top = 80;
  rcLeft[0].right = 120;
  rcLeft[0].bottom = 120;
  rcLeft[1].left = 240;
  rcLeft[1].top = 80;
  rcLeft[1].right = 264;
  rcLeft[1].bottom = 104;
  rcLeft[2].left = 264;
  rcLeft[2].top = 80;
  rcLeft[2].right = 288;
  rcLeft[2].bottom = 104;
  rcLeft[3].left = 288;
  rcLeft[3].top = 80;
  rcLeft[3].right = 312;
  rcLeft[3].bottom = 104;
  rcRight[0].left = 200;
  rcRight[0].top = 80;
  rcRight[0].right = 240;
  rcRight[0].bottom = 120;
  rcRight[1].left = 240;
  rcRight[1].top = 104;
  rcRight[1].right = 264;
  rcRight[1].bottom = 128;
  rcRight[2].left = 264;
  rcRight[2].top = 104;
  rcRight[2].right = 288;
  rcRight[2].bottom = 128;
  rcRight[3].left = 288;
  rcRight[3].top = 104;
  rcRight[3].right = 312;
  rcRight[3].bottom = 128;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_15:
    if ( ++npc->act_wait > 100 )
    {
      npc->act_wait = 0;
      npc->act_no = 2;
    }
    if ( !(npc->act_wait % 5) )
    {
      v8 = Random(-1536, 0);
      v9 = Random(-341, 341);
      v10 = npc->y;
      v11 = (Random(-12, 12) << 9) + v10;
      v12 = npc->x;
      v13 = Random(-12, 12);
      SetNpChar(4, v12 + (v13 << 9), v11, v9, v8, 0, 0, 256);
    }
    if ( npc->direct )
    {
      npc->rect.left = rcRight[0].left;
      npc->rect.top = rcRight[0].top;
      npc->rect.right = rcRight[0].right;
      npc->rect.bottom = rcRight[0].bottom;
    }
    else
    {
      npc->rect.left = rcLeft[0].left;
      npc->rect.top = rcLeft[0].top;
      npc->rect.right = rcLeft[0].right;
      npc->rect.bottom = rcLeft[0].bottom;
    }
    if ( npc->act_wait / 2 & 1 )
      --npc->rect.left;
    goto LABEL_44;
  }
  if ( v1 <= 1 )
  {
    if ( v1 )
      goto LABEL_44;
    PlaySoundObject(72, 1);
    if ( npc->x <= x )
      npc->direct = 2;
    else
      npc->direct = 0;
    for ( i = 0; i <= 7; ++i )
    {
      v2 = Random(-1536, 0);
      v3 = Random(-341, 341);
      v4 = npc->y;
      v5 = (Random(-12, 12) << 9) + v4;
      v6 = npc->x;
      v7 = Random(-12, 12);
      SetNpChar(4, v6 + (v7 << 9), v5, v3, v2, 0, 0, 256);
    }
    npc->act_no = 1;
    goto LABEL_15;
  }
  if ( v1 == 2 )
  {
    if ( ++npc->act_wait / 2 & 1 && npc->act_wait <= 99 )
    {
      npc->ani_no = 0;
      npc->view.back = 10240;
      npc->view.front = 10240;
      npc->view.top = 10240;
    }
    else
    {
      npc->ani_no = 1;
      npc->view.back = 6144;
      npc->view.front = 6144;
      npc->view.top = 4096;
    }
    if ( npc->act_wait > 150 )
    {
      npc->act_wait = 0;
      npc->act_no = 3;
      npc->ani_no = 1;
    }
    if ( !(npc->act_wait % 9) )
    {
      v14 = Random(-1536, 0);
      v15 = Random(-341, 341);
      v16 = npc->y;
      v17 = (Random(-12, 12) << 9) + v16;
      v18 = npc->x;
      v19 = Random(-12, 12);
      SetNpChar(4, v18 + (v19 << 9), v17, v15, v14, 0, 0, 256);
    }
    if ( npc->direct )
    {
      v20 = npc;
      v21 = (Sint32 *)&v27[16 * npc->ani_no - 132];
    }
    else
    {
      v20 = npc;
      v21 = (Sint32 *)&v27[16 * npc->ani_no - 68];
    }
    npc->rect.left = *v21;
    v20->rect.top = v21[1];
    v20->rect.right = v21[2];
    v20->rect.bottom = v21[3];
  }
  else if ( v1 == 3 )
  {
    if ( ++npc->ani_wait > 50 )
    {
      npc->ani_wait = 0;
      ++npc->ani_no;
    }
    if ( npc->ani_no == 3 )
      npc->act_no = 4;
    if ( npc->direct )
    {
      v22 = npc;
      v23 = (Sint32 *)&v27[16 * npc->ani_no - 132];
    }
    else
    {
      v22 = npc;
      v23 = (Sint32 *)&v27[16 * npc->ani_no - 68];
    }
    npc->rect.left = *v23;
    v22->rect.top = v23[1];
    v22->rect.right = v23[2];
    v22->rect.bottom = v23[3];
  }
LABEL_44:
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
}


//----- (080BBD07) --------------------------------------------------------
void __cdecl ActNpc090(NPCHAR_0 *npc)
{
  npc->rect.left = 280;
  npc->rect.top = 80;
  npc->rect.right = 296;
  npc->rect.bottom = 104;
}

//----- (080BBD46) --------------------------------------------------------
void __cdecl ActNpc091(NPCHAR_0 *npc)
{
  if ( !npc->act_no )
  {
    ++npc->act_no;
    npc->y += 0x2000;
  }
  npc->rect.left = 96;
  npc->rect.top = 88;
  npc->rect.right = 128;
  npc->rect.bottom = 112;
}

//----- (080BBDB0) --------------------------------------------------------
void __cdecl ActNpc092(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT rcLeft[3];
  char v4[8];

  rcLeft[0].left = 272;
  rcLeft[0].top = 216;
  rcLeft[0].right = 288;
  rcLeft[0].bottom = 240;
  rcLeft[1].left = 288;
  rcLeft[1].top = 216;
  rcLeft[1].right = 304;
  rcLeft[1].bottom = 240;
  rcLeft[2].left = 304;
  rcLeft[2].top = 216;
  rcLeft[2].right = 320;
  rcLeft[2].bottom = 240;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_9:
    if ( ++npc->ani_wait > 2 )
    {
      npc->ani_wait = 0;
      ++npc->ani_no;
    }
    if ( npc->ani_no > 1 )
      npc->ani_no = 0;
    if ( Random(0, 80) == 1 )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
      npc->ani_no = 1;
    }
    if ( Random(0, 120) == 10 )
    {
      npc->act_no = 3;
      npc->act_wait = 0;
      npc->ani_no = 2;
    }
    goto LABEL_21;
  }
  if ( v1 <= 1 )
  {
    if ( v1 )
      goto LABEL_21;
    npc->x -= 2048;
    npc->y += 0x2000;
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->ani_wait = 0;
    goto LABEL_9;
  }
  if ( v1 == 2 )
  {
    if ( ++npc->act_wait > 40 )
    {
      npc->act_no = 3;
      npc->act_wait = 0;
      npc->ani_no = 2;
    }
  }
  else if ( v1 == 3 && ++npc->act_wait > 80 )
  {
    npc->act_no = 1;
    npc->ani_no = 0;
  }
LABEL_21:
  v2 = (Sint32 *)&v4[16 * npc->ani_no - 48];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
}


//----- (080BBFDE) --------------------------------------------------------
void __cdecl ActNpc093(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[7];
  RECT rcLeft[7];
  char v6[24];

  qmemcpy(rcLeft, &ActNpc093(NPCHAR *)::C.18, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc093(NPCHAR *)::C.19, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( Random(0, 120) == 10 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      if ( npc->x - 0x4000 < x && npc->x + 0x4000 > x && npc->y - 0x4000 < y && npc->y + 0x2000 > y )
      {
        if ( npc->x <= x )
          npc->direct = 2;
        else
          npc->direct = 0;
      }
      break;
    case 2:
      if ( ++npc->act_wait > 8 )
      {
        npc->act_no = 1;
        npc->ani_no = 0;
      }
      break;
    case 3:
      npc->act_no = 4;
      npc->ani_no = 2;
      npc->ani_wait = 0;
      goto LABEL_15;
    case 4:
LABEL_15:
      if ( ++npc->ani_wait > 4 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 5 )
        npc->ani_no = 2;
      if ( npc->direct )
        v1 = npc->x + 512;
      else
        v1 = npc->x - 512;
      npc->x = v1;
      break;
    case 0xA:
      npc->ani_no = 6;
      if ( ++npc->act_wait > 200 )
      {
        npc->act_wait = 0;
        SetCaret(npc->x, npc->y, 5, 0);
      }
      break;
    default:
      break;
  }
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 224];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 112];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (080BC2C5) --------------------------------------------------------
void __cdecl ActNpc094(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT rect[5];
  char v4[12];

  qmemcpy(rect, &ActNpc094(NPCHAR *)::C.21, sizeof(rect));
  switch ( npc->act_no )
  {
    case 0:
      npc->ani_no = 4;
      if ( npc->shock )
      {
        npc->ani_no = 0;
        npc->act_no = 10;
        npc->act_wait = 0;
      }
      break;
    case 0xA:
      npc->bits |= 0x20u;
      npc->bits &= 0xFFFBu;
      if ( ++npc->act_wait > 40 )
      {
        npc->act_wait = 0;
        npc->ani_wait = 0;
        npc->act_no = 11;
      }
      break;
    case 0xB:
      if ( ++npc->ani_wait > 5 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 2 )
      {
        npc->act_no = 12;
        npc->ani_no = 3;
      }
      break;
    case 0xC:
      npc->ym = -341;
      if ( ++npc->act_wait > 20 )
      {
        npc->act_wait = 0;
        npc->act_no = 10;
        npc->ani_no = 0;
      }
      break;
    case 0x14:
      npc->xm /= 2;
      npc->ym += 32;
      if ( !npc->shock )
      {
        npc->act_wait = 30;
        npc->act_no = 10;
        npc->ani_no = 0;
      }
      break;
    default:
      break;
  }
  if ( npc->shock )
  {
    if ( ++npc->count2 > 12 )
    {
      npc->act_no = 20;
      npc->ani_no = 4;
      npc->bits &= 0xFFDFu;
      npc->bits |= 4u;
    }
  }
  else
  {
    npc->count2 = 0;
  }
  if ( npc->act_no > 9 )
  {
    if ( npc->flag & 1 )
    {
      npc->count1 = 50;
      npc->direct = 2;
    }
    if ( npc->flag & 4 )
    {
      npc->count1 = 50;
      npc->direct = 0;
    }
    if ( npc->count1 )
    {
      --npc->count1;
      if ( npc->direct )
        v1 = npc->xm + 128;
      else
        v1 = npc->xm - 128;
      npc->xm = v1;
    }
    else
    {
      npc->count1 = 50;
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
    }
    npc->ym += 16;
    if ( npc->flag & 8 )
      npc->ym = -1024;
  }
  if ( npc->xm > 256 )
    npc->xm = 256;
  if ( npc->xm < -256 )
    npc->xm = -256;
  if ( npc->ym > 768 )
    npc->ym = 768;
  if ( npc->ym < -768 )
    npc->ym = -768;
  npc->x += npc->xm;
  npc->y += npc->ym;
  v2 = (Sint32 *)&v4[16 * npc->ani_no - 80];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
}


//----- (080BC6B6) --------------------------------------------------------
void __cdecl ActNpc095(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  NPCHAR_0 *v4;
  Sint32 *v5;
  RECT rcRight[4];
  RECT rcLeft[4];
  char v8[8];

  rcLeft[0].left = 208;
  rcLeft[0].top = 64;
  rcLeft[0].right = 224;
  rcLeft[0].bottom = 80;
  rcLeft[1].left = 224;
  rcLeft[1].top = 64;
  rcLeft[1].right = 240;
  rcLeft[1].bottom = 80;
  rcLeft[2].left = 240;
  rcLeft[2].top = 64;
  rcLeft[2].right = 256;
  rcLeft[2].bottom = 80;
  rcLeft[3].left = 256;
  rcLeft[3].top = 64;
  rcLeft[3].right = 272;
  rcLeft[3].bottom = 80;
  rcRight[0].left = 208;
  rcRight[0].top = 80;
  rcRight[0].right = 224;
  rcRight[0].bottom = 96;
  rcRight[1].left = 224;
  rcRight[1].top = 80;
  rcRight[1].right = 240;
  rcRight[1].bottom = 96;
  rcRight[2].left = 240;
  rcRight[2].top = 80;
  rcRight[2].right = 256;
  rcRight[2].bottom = 96;
  rcRight[3].left = 256;
  rcRight[3].top = 80;
  rcRight[3].right = 272;
  rcRight[3].bottom = 96;
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->act_wait = Random(0, 50);
      npc->tgt_y = npc->y;
      npc->tgt_x = npc->x;
      if ( npc->direct )
        npc->xm = -512;
      else
        npc->xm = 512;
      goto LABEL_5;
    case 1:
LABEL_5:
      if ( --npc->act_wait > 0 )
        break;
      npc->act_no = 10;
      goto LABEL_7;
    case 0xA:
LABEL_7:
      if ( ++npc->act_wait > 10 )
      {
        npc->act_wait = 0;
        npc->ani_wait = 0;
        npc->act_no = 11;
      }
      break;
    case 0xB:
      if ( ++npc->ani_wait > 5 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no == 2 )
      {
        if ( npc->direct )
          v1 = npc->xm + 256;
        else
          v1 = npc->xm - 256;
        npc->xm = v1;
        npc->ym -= 512;
      }
      if ( npc->ani_no > 2 )
      {
        npc->act_no = 12;
        npc->ani_no = 3;
      }
      break;
    case 0xC:
      ++npc->act_wait;
      if ( npc->y > npc->tgt_y && npc->act_wait > 10 )
      {
        npc->act_wait = 0;
        npc->act_no = 10;
        npc->ani_no = 0;
      }
      break;
    default:
      break;
  }
  if ( npc->x <= npc->tgt_x )
    npc->direct = 2;
  else
    npc->direct = 0;
  if ( npc->flag & 1 )
  {
    npc->count1 = 50;
    npc->direct = 2;
  }
  if ( npc->flag & 4 )
  {
    npc->count1 = 50;
    npc->direct = 0;
  }
  npc->ym += 32;
  if ( npc->flag & 8 )
    npc->ym = -1024;
  if ( npc->xm > 256 )
    npc->xm = 256;
  if ( npc->xm < -256 )
    npc->xm = -256;
  if ( npc->ym > 512 )
    npc->ym = 512;
  if ( npc->ym < -512 )
    npc->ym = -512;
  if ( npc->shock )
  {
    npc->x += npc->xm / 2;
    v2 = npc->y;
    v3 = npc->ym / 2;
  }
  else
  {
    npc->x += npc->xm;
    v2 = npc->y;
    v3 = npc->ym;
  }
  npc->y = v3 + v2;
  if ( npc->direct )
  {
    v4 = npc;
    v5 = (Sint32 *)&v8[16 * npc->ani_no - 128];
  }
  else
  {
    v4 = npc;
    v5 = (Sint32 *)&v8[16 * npc->ani_no - 64];
  }
  npc->rect.left = *v5;
  v4->rect.top = v5[1];
  v4->rect.right = v5[2];
  v4->rect.bottom = v5[3];
}


//----- (080BCB37) --------------------------------------------------------
void __cdecl ActNpc096(NPCHAR_0 *npc)
{
  int v1;
  bool v2;
  int v3;
  int v4;
  Sint32 *v5;
  RECT rc[3];
  char v7[8];

  rc[0].left = 272;
  rc[0].top = 120;
  rc[0].right = 288;
  rc[0].bottom = 136;
  rc[1].left = 288;
  rc[1].top = 120;
  rc[1].right = 304;
  rc[1].bottom = 136;
  rc[2].left = 304;
  rc[2].top = 120;
  rc[2].right = 320;
  rc[2].bottom = 136;
  v1 = npc->act_no;
  switch ( v1 )
  {
    case 1:
      goto LABEL_7;
    case 2:
      if ( ++npc->ani_wait > 0 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 2 )
        npc->ani_no = 0;
      v2 = x > npc->x - 163840 && x < npc->x + 163840 && y > npc->y - 122880 && y < npc->y + 122880 && Random(0, 5) == 1;
      if ( v2 )
      {
        v3 = npc->y;
        v4 = Random(-8, 8);
        SetNpChar(199, npc->x, v3 + (v4 << 9), 0, 0, 0, 0, 256);
      }
      if ( y < npc->y + 4096 && y > npc->y - 4096 && x < npc->x && x > npc->x - 49152 )
      {
        unk_81C85B4 -= 136;
        gMC.cond |= 0x20u;
      }
      break;
    case 0:
      if ( npc->direct == 2 )
        npc->act_no = 2;
      else
        npc->ani_no = 1;
LABEL_7:
      npc->ani_no = 0;
      break;
  }
  v5 = (Sint32 *)&v7[16 * npc->ani_no - 48];
  npc->rect.left = *v5;
  npc->rect.top = v5[1];
  npc->rect.right = v5[2];
  npc->rect.bottom = v5[3];
}


//----- (080BCD9F) --------------------------------------------------------
void __cdecl ActNpc097(NPCHAR_0 *npc)
{
  int v1;
  bool v2;
  int v3;
  int v4;
  int v5;
  Sint32 *v6;
  RECT rc[3];
  char v8[8];

  rc[0].left = 272;
  rc[0].top = 136;
  rc[0].right = 288;
  rc[0].bottom = 152;
  rc[1].left = 288;
  rc[1].top = 136;
  rc[1].right = 304;
  rc[1].bottom = 152;
  rc[2].left = 304;
  rc[2].top = 136;
  rc[2].right = 320;
  rc[2].bottom = 152;
  v1 = npc->act_no;
  switch ( v1 )
  {
    case 1:
      goto LABEL_7;
    case 2:
      if ( ++npc->ani_wait > 0 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 2 )
        npc->ani_no = 0;
      v2 = x > npc->x - 163840 && x < npc->x + 163840 && y > npc->y - 122880 && y < npc->y + 122880 && Random(0, 5) == 1;
      if ( v2 )
      {
        v3 = npc->y;
        v4 = npc->x;
        v5 = Random(-8, 8);
        SetNpChar(199, v4 + (v5 << 9), v3, 0, 0, 1, 0, 256);
      }
      if ( x < npc->x + 4096 && x > npc->x - 4096 && y < npc->y && y > npc->y - 49152 )
        unk_81C85B8 -= 136;
      break;
    case 0:
      if ( npc->direct == 2 )
        npc->act_no = 2;
      else
        npc->ani_no = 1;
LABEL_7:
      npc->ani_no = 0;
      break;
  }
  v6 = (Sint32 *)&v8[16 * npc->ani_no - 48];
  npc->rect.left = *v6;
  npc->rect.top = v6[1];
  npc->rect.right = v6[2];
  npc->rect.bottom = v6[3];
}


//----- (080BCFFA) --------------------------------------------------------
void __cdecl ActNpc098(NPCHAR_0 *npc)
{
  int v1;
  bool v2;
  int v3;
  int v4;
  Sint32 *v5;
  RECT rc[3];
  char v7[8];

  rc[0].left = 272;
  rc[0].top = 152;
  rc[0].right = 288;
  rc[0].bottom = 168;
  rc[1].left = 288;
  rc[1].top = 152;
  rc[1].right = 304;
  rc[1].bottom = 168;
  rc[2].left = 304;
  rc[2].top = 152;
  rc[2].right = 320;
  rc[2].bottom = 168;
  v1 = npc->act_no;
  switch ( v1 )
  {
    case 1:
      goto LABEL_7;
    case 2:
      if ( ++npc->ani_wait > 0 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 2 )
        npc->ani_no = 0;
      v2 = x > npc->x - 163840 && x < npc->x + 163840 && y > npc->y - 122880 && y < npc->y + 122880 && Random(0, 5) == 1;
      if ( v2 )
      {
        v3 = npc->y;
        v4 = Random(-8, 8);
        SetNpChar(199, npc->x, v3 + (v4 << 9), 0, 0, 2, 0, 256);
      }
      if ( y < npc->y + 4096 && y > npc->y - 4096 && x < npc->x + 49152 && x > npc->x )
      {
        unk_81C85B4 += 136;
        gMC.cond |= 0x20u;
      }
      break;
    case 0:
      if ( npc->direct == 2 )
        npc->act_no = 2;
      else
        npc->ani_no = 1;
LABEL_7:
      npc->ani_no = 0;
      break;
  }
  v5 = (Sint32 *)&v7[16 * npc->ani_no - 48];
  npc->rect.left = *v5;
  npc->rect.top = v5[1];
  npc->rect.right = v5[2];
  npc->rect.bottom = v5[3];
}


//----- (080BD262) --------------------------------------------------------
void __cdecl ActNpc099(NPCHAR_0 *npc)
{
  int v1;
  bool v2;
  int v3;
  int v4;
  int v5;
  Sint32 *v6;
  RECT rc[3];
  char v8[8];

  rc[0].left = 272;
  rc[0].top = 168;
  rc[0].right = 288;
  rc[0].bottom = 184;
  rc[1].left = 288;
  rc[1].top = 168;
  rc[1].right = 304;
  rc[1].bottom = 184;
  rc[2].left = 304;
  rc[2].top = 168;
  rc[2].right = 320;
  rc[2].bottom = 184;
  v1 = npc->act_no;
  switch ( v1 )
  {
    case 1:
      goto LABEL_7;
    case 2:
      if ( ++npc->ani_wait > 0 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 2 )
        npc->ani_no = 0;
      v2 = x > npc->x - 163840 && x < npc->x + 163840 && y > npc->y - 122880 && y < npc->y + 122880 && Random(0, 5) == 1;
      if ( v2 )
      {
        v3 = npc->y;
        v4 = npc->x;
        v5 = Random(-8, 8);
        SetNpChar(199, v4 + (v5 << 9), v3, 0, 0, 3, 0, 256);
      }
      if ( x < npc->x + 4096 && x > npc->x - 4096 && y < npc->y + 49152 && y > npc->y )
        unk_81C85B8 += 136;
      break;
    case 0:
      if ( npc->direct == 2 )
        npc->act_no = 2;
      else
        npc->ani_no = 1;
LABEL_7:
      npc->ani_no = 0;
      break;
  }
  v6 = (Sint32 *)&v8[16 * npc->ani_no - 48];
  npc->rect.left = *v6;
  npc->rect.top = v6[1];
  npc->rect.right = v6[2];
  npc->rect.bottom = v6[3];
}


//----- (080BD4C0) --------------------------------------------------------
signed int IsProfile()
{
  char path[260];
  SDL_RWops_0 *fp;

  sprintf(path, "%s/%s", gModulePath, gDefaultName);
  fp = SDL_RWFromFile(path, "rb");
  if ( !fp )
    return 0;
  fp->close(fp);
  return 1;
}

//----- (080BD52B) --------------------------------------------------------
void __cdecl Swap(__int16 *variable)
{
  *variable = *variable;
}

//----- (080BD53C) --------------------------------------------------------
void __cdecl Swap(int *variable)
{
  *variable = *variable;
}

//----- (080BD54B) --------------------------------------------------------
void __cdecl ByteSwapProfile($B183609F1A8F1989C6F45ED51C9AAA7D *profile)
{
  int arm;
  int item;
  int permit_stage;

  Swap(&profile->stage);
  Swap(&profile->music);
  Swap(&profile->x);
  Swap(&profile->y);
  Swap(&profile->direct);
  Swap(&profile->max_life);
  Swap(&profile->star);
  Swap(&profile->life);
  Swap(&profile->a);
  Swap(&profile->select_arms);
  Swap(&profile->select_item);
  Swap(&profile->equip);
  Swap(&profile->unit);
  Swap(&profile->counter);
  for ( arm = 0; arm <= 7; ++arm )
  {
    Swap(&profile->arms[arm].code);
    Swap(&profile->arms[arm].level);
    Swap(&profile->arms[arm].exp);
    Swap(&profile->arms[arm].max_num);
    Swap(&profile->arms[arm].num);
  }
  for ( item = 0; item <= 31; ++item )
    Swap(&profile->stage + item + 52);
  for ( permit_stage = 0; permit_stage <= 7; ++permit_stage )
  {
    Swap(&profile->stage + 2 * (permit_stage + 42));
    Swap(&profile->music + 2 * (permit_stage + 42));
  }
}

//----- (080BD741) --------------------------------------------------------
signed int __cdecl SaveProfile(char *name)
{
  $B183609F1A8F1989C6F45ED51C9AAA7D profile;
  char path[260];
  SDL_RWops_0 *fp;
  char *FLAG;

  FLAG = "FLAG";
  if ( name )
    sprintf(path, "%s/%s", gModulePath, name);
  else
    sprintf(path, "%s/%s", gModulePath, gDefaultName);
  fp = SDL_RWFromFile(path, "wb");
  if ( !fp )
    return 0;
  memset(&profile, 0, 0x604u);
  memcpy(&profile, gProfileCode, 8u);
  memcpy(profile.FLAG, FLAG, 4u);
  profile.stage = gStageNo;
  profile.music = gMusicNo;
  profile.x = x;
  profile.y = y;
  profile.direct = dir;
  profile.max_life = unk_81C8618;
  profile.life = word_81C8614;
  profile.star = unk_81C8616;
  profile.select_arms = gSelectedArms;
  profile.select_item = gSelectedItem;
  profile.equip = unk_81C8598;
  profile.unit = unk_81C8594;
  profile.counter = gCounter;
  memcpy(profile.arms, gArmsData, 0xA0u);
  memcpy(profile.items, gItemData, 0x80u);
  memcpy(profile.permitstage, gPermitStage, 0x40u);
  memcpy(profile.permit_mapping, gMapping, 0x80u);
  memcpy(profile.flags, gFlagNPC, 0x3E8u);
  ByteSwapProfile(&profile);
  fp->write(fp, &profile, 1540, 1);
  fp->close(fp);
  return 1;
}

//----- (080BD9BD) --------------------------------------------------------
signed int __cdecl LoadProfile(char *name)
{
  $B183609F1A8F1989C6F45ED51C9AAA7D profile;
  char path[260];
  SDL_RWops_0 *fp;

  if ( name )
    strcpy(path, name);
  else
    sprintf(path, "%s/%s", gModulePath, gDefaultName);
  fp = SDL_RWFromFile(path, "rb");
  if ( !fp )
    return 0;
  fp->read(fp, &profile, 8, 1);
  if ( memcmp(&profile, gProfileCode, 8u) )
    return 0;
  fp->seek(fp, 0, 0);
  memset(&profile, 0, 0x604u);
  fp->read(fp, &profile, 1540, 1);
  ByteSwapProfile(&profile);
  fp->close(fp);
  gSelectedArms = profile.select_arms;
  gSelectedItem = profile.select_item;
  gCounter = profile.counter;
  memcpy(gArmsData, profile.arms, 0xA0u);
  memcpy(gItemData, profile.items, 0x80u);
  memcpy(gPermitStage, profile.permitstage, 0x40u);
  memcpy(gMapping, profile.permit_mapping, 0x80u);
  memcpy(gFlagNPC, profile.flags, 0x3E8u);
  ChangeMusic(profile.music);
  InitMyChar();
  if ( (unsigned __int8)TransferStage(profile.stage, 0, 0, 1) ^ 1 )
    return 0;
  unk_81C8598 = profile.equip;
  unk_81C8594 = profile.unit;
  dir = profile.direct;
  unk_81C8618 = profile.max_life;
  word_81C8614 = profile.life;
  unk_81C8616 = profile.star;
  gMC.cond = -128;
  unk_81C8624 = 1000;
  dword_81C861C = profile.life;
  x = profile.x;
  y = profile.y;
  stru_81C85F4.left = 24 * (gArmsData[gSelectedArms].code % 10);
  stru_81C85F4.right = stru_81C85F4.left + 24;
  stru_81C85F4.top = 32 * (gArmsData[gSelectedArms].code / 10);
  stru_81C85F4.bottom = stru_81C85F4.top + 16;
  ClearFade();
  SetFrameMyChar();
  SetFrameTargetMyChar(16);
  InitBossLife();
  CutNoise();
  InitStar();
  ClearValueView();
  gCurlyShoot_wait = 0;
  return 1;
}

//----- (080BDD69) --------------------------------------------------------
signed int __cdecl InitializeGame()
{
  InitMyChar();
  gSelectedArms = 0;
  gSelectedItem = 0;
  gCounter = 0;
  ClearArmsData();
  ClearItemData();
  ClearPermitStage();
  StartMapping();
  InitFlags();
  if ( (unsigned __int8)TransferStage(13, 200, 10, 8) ^ 1 )
    return 0;
  ClearFade();
  SetFrameMyChar();
  SetFrameTargetMyChar(16);
  InitBossLife();
  CutNoise();
  ClearValueView();
  gCurlyShoot_wait = 0;
  SetFadeMask();
  SetFrameTargetMyChar(16);
  return 1;
}

//----- (080BDE24) --------------------------------------------------------
void __cdecl ActNpc140(NPCHAR_0 *npc)
{
  unsigned __int16 v1;
  bool v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  int v8;
  int v9;
  int v10;
  int v11;
  int v12;
  int v13;
  int v14;
  int v15;
  int v16;
  int v17;
  int v18;
  int v19;
  int v20;
  NPCHAR_0 *v21;
  Sint32 *v22;
  RECT rcRight[14];
  RECT rcLeft[14];
  int i;
  char v26[24];

  qmemcpy(rcLeft, &ActNpc140(NPCHAR *)::C.0, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc140(NPCHAR *)::C.1, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 9;
      npc->act_wait = 0;
      v1 = npc->bits;
      HIBYTE(v1) &= 0xDFu;
      npc->bits = v1;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( ++npc->act_wait > 50 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 8;
      }
      break;
    case 2:
      if ( ++npc->ani_no > 10 )
        npc->ani_no = 9;
      if ( ++npc->act_wait > 50 )
      {
        npc->act_no = 3;
        npc->act_wait = 0;
        npc->ani_no = 0;
      }
      break;
    case 3:
      if ( ++npc->act_wait > 50 )
      {
        npc->act_no = 10;
        npc->bits |= 0x20u;
      }
      break;
    case 0xA:
      npc->bits = npc->bits;
      npc->act_no = 11;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      npc->act_wait = Random(20, 130);
      npc->xm = 0;
      goto LABEL_12;
    case 0xB:
LABEL_12:
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
      if ( ++npc->ani_wait > 4 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 1 )
        npc->ani_no = 0;
      v2 = CountArmsBullet(6) || CountArmsBullet(3) > 3;
      if ( v2 )
        npc->act_no = 20;
      if ( npc->act_wait )
      {
        --npc->act_wait;
      }
      else if ( Random(0, 99) & 1 )
      {
        npc->act_no = 20;
      }
      else
      {
        npc->act_no = 50;
      }
      break;
    case 0x14:
      npc->act_no = 21;
      npc->ani_no = 2;
      npc->act_wait = 0;
      goto LABEL_31;
    case 0x15:
LABEL_31:
      if ( ++npc->act_wait > 10 )
      {
        npc->act_no = 22;
        npc->act_wait = 0;
        npc->ani_no = 3;
        npc->ym = -1535;
        if ( npc->direct )
          npc->xm = 512;
        else
          npc->xm = -512;
      }
      break;
    case 0x16:
      if ( ++npc->act_wait > 10 )
      {
        npc->act_no = 23;
        npc->act_wait = 0;
        npc->ani_no = 6;
        SetNpChar(141, 0, 0, 0, 0, 0, npc, 0);
      }
      break;
    case 0x17:
      if ( ++npc->act_wait > 30 )
      {
        npc->act_no = 24;
        npc->act_wait = 0;
        npc->ani_no = 7;
      }
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
      break;
    case 0x18:
      if ( ++npc->act_wait > 3 )
      {
        npc->act_no = 25;
        npc->ani_no = 3;
      }
      break;
    case 0x19:
      if ( npc->flag & 8 )
      {
        npc->act_no = 26;
        npc->act_wait = 0;
        npc->ani_no = 2;
        PlaySoundObject(26, 1);
        SetQuake(20);
      }
      break;
    case 0x1A:
      npc->xm = 8 * npc->xm / 9;
      if ( ++npc->act_wait > 20 )
      {
        npc->act_no = 10;
        npc->ani_no = 0;
      }
      break;
    case 0x32:
      npc->act_no = 51;
      npc->act_wait = 0;
      npc->ani_no = 4;
      SetNpChar(141, 0, 0, 0, 0, 0, npc, 0);
      goto LABEL_49;
    case 0x33:
LABEL_49:
      if ( ++npc->act_wait > 30 )
      {
        npc->act_no = 52;
        npc->act_wait = 0;
        npc->ani_no = 5;
      }
      if ( npc->x <= x )
        npc->direct = 2;
      else
        npc->direct = 0;
      break;
    case 0x34:
      if ( ++npc->act_wait > 3 )
      {
        npc->act_no = 10;
        npc->ani_no = 0;
      }
      break;
    case 0x64:
      npc->ani_no = 3;
      npc->act_no = 101;
      npc->bits &= 0xFFDFu;
      npc->damage = 0;
      for ( i = 0; i <= 7; ++i )
      {
        v3 = Random(-1536, 0);
        v4 = Random(-341, 341);
        v5 = npc->y;
        v6 = (Random(-12, 12) << 9) + v5;
        v7 = npc->x;
        v8 = Random(-12, 12);
        SetNpChar(4, v7 + (v8 << 9), v6, v4, v3, 0, 0, 256);
      }
      break;
    case 0x65:
      if ( npc->flag & 8 )
      {
        npc->act_no = 102;
        npc->act_wait = 0;
        npc->ani_no = 2;
        PlaySoundObject(26, 1);
        SetQuake(20);
      }
      break;
    case 0x66:
      npc->xm = 8 * npc->xm / 9;
      if ( ++npc->act_wait > 50 )
      {
        npc->act_no = 103;
        npc->act_wait = 0;
        npc->ani_no = 10;
      }
      break;
    case 0x67:
      if ( ++npc->act_wait > 50 )
      {
        npc->ani_no = 9;
        npc->act_no = 104;
        npc->act_wait = 0;
      }
      break;
    case 0x68:
      if ( ++npc->ani_no > 10 )
        npc->ani_no = 9;
      if ( ++npc->act_wait > 100 )
      {
        npc->act_wait = 0;
        npc->ani_no = 9;
        npc->act_no = 105;
      }
      break;
    case 0x69:
      if ( ++npc->act_wait > 50 )
      {
        npc->ani_wait = 0;
        npc->act_no = 106;
        npc->ani_no = 11;
      }
      break;
    case 0x6A:
      if ( ++npc->ani_wait > 50 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 12 )
        npc->ani_no = 12;
      break;
    case 0x8C:
      npc->act_no = 141;
      npc->act_wait = 0;
      npc->ani_no = 12;
      PlaySoundObject(29, 1);
      goto LABEL_77;
    case 0x8D:
LABEL_77:
      if ( ++npc->ani_no > 13 )
        npc->ani_no = 12;
      if ( ++npc->act_wait > 100 )
      {
        for ( i = 0; i <= 3; ++i )
        {
          v9 = Random(-1536, 0);
          v10 = Random(-341, 341);
          v11 = npc->y;
          v12 = (Random(-12, 12) << 9) + v11;
          v13 = npc->x;
          v14 = Random(-12, 12);
          SetNpChar(4, v13 + (v14 << 9), v12, v10, v9, 0, 0, 256);
        }
        npc->cond = 0;
      }
      break;
    default:
      break;
  }
  if ( npc->act_no > 100 && npc->act_no <= 104 && !(npc->act_wait % 9) )
  {
    v15 = Random(-1536, 0);
    v16 = Random(-341, 341);
    v17 = npc->y;
    v18 = (Random(-12, 12) << 9) + v17;
    v19 = npc->x;
    v20 = Random(-12, 12);
    SetNpChar(4, v19 + (v20 << 9), v18, v16, v15, 0, 0, 256);
  }
  npc->ym += 32;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  if ( npc->ym < -1535 )
    npc->ym = -1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v21 = npc;
    v22 = (Sint32 *)&v26[16 * npc->ani_no - 452];
  }
  else
  {
    v21 = npc;
    v22 = (Sint32 *)&v26[16 * npc->ani_no - 228];
  }
  npc->rect.left = *v22;
  v21->rect.top = v22[1];
  v21->rect.right = v22[2];
  v21->rect.bottom = v22[3];
}


//----- (080BEA64) --------------------------------------------------------
void __cdecl ActNpc141(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  Sint32 *v8;
  RECT rect[2];
  int i;
  unsigned __int8 deg;
  char v12[8];

  rect[0].left = 288;
  rect[0].top = 32;
  rect[0].right = 304;
  rect[0].bottom = 48;
  rect[1].left = 304;
  rect[1].top = 32;
  rect[1].right = 320;
  rect[1].bottom = 48;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_9:
    if ( npc->pNpc->direct )
      v2 = npc->pNpc->x - 5120;
    else
      v2 = npc->pNpc->x + 5120;
    npc->x = v2;
    npc->y = npc->pNpc->y - 4096;
    if ( npc->pNpc->act_no == 24 || npc->pNpc->act_no == 52 )
    {
      npc->act_no = 10;
      if ( npc->pNpc->direct )
        v3 = npc->pNpc->x + 0x2000;
      else
        v3 = npc->pNpc->x - 0x2000;
      npc->x = v3;
      npc->y = npc->pNpc->y;
      deg = GetArktan(npc->x - x, npc->y - y);
      npc->ym = 4 * GetSin(deg);
      npc->xm = 4 * GetCos(deg);
      PlaySoundObject(39, 1);
    }
    goto LABEL_29;
  }
  if ( v1 <= 1 )
  {
    if ( v1 )
      goto LABEL_29;
    npc->act_no = 1;
    npc->act_wait = 0;
    goto LABEL_9;
  }
  if ( v1 == 10 )
  {
    if ( npc->flag & 0xF )
    {
      npc->act_no = 20;
      npc->act_wait = 0;
      SetCaret(npc->x, npc->y, 2, 0);
      PlaySoundObject(12, 1);
      for ( i = 0; i <= 3; ++i )
      {
        v4 = Random(-512, 512);
        v5 = Random(-512, 512);
        SetNpChar(4, npc->x, npc->y, v5, v4, 0, 0, 256);
      }
    }
    else
    {
      npc->x += npc->xm;
      npc->y += npc->ym;
    }
  }
  else if ( v1 == 20 )
  {
    npc->x += npc->xm;
    npc->y += npc->ym;
    if ( ++npc->act_wait > 4 )
    {
      for ( i = 0; i <= 3; ++i )
      {
        v6 = Random(-512, 512);
        v7 = Random(-512, 512);
        SetNpChar(4, npc->x, npc->y, v7, v6, 0, 0, 256);
      }
      npc->code_char = 142;
      npc->ani_no = 0;
      npc->act_no = 20;
      npc->xm = 0;
      npc->bits &= 0xFFFBu;
      npc->bits |= 0x20u;
      npc->damage = 1;
    }
  }
LABEL_29:
  if ( ++npc->ani_no > 1 )
    npc->ani_no = 0;
  v8 = (Sint32 *)&v12[16 * npc->ani_no - 40];
  npc->rect.left = *v8;
  npc->rect.top = v8[1];
  npc->rect.right = v8[2];
  npc->rect.bottom = v8[3];
}


//----- (080BEECE) --------------------------------------------------------
void __cdecl ActNpc142(NPCHAR_0 *npc)
{
  Sint32 *v1;
  RECT rect[5];
  char v3[24];

  qmemcpy(rect, &ActNpc142(NPCHAR *)::C.6, sizeof(rect));
  switch ( npc->act_no )
  {
    case 0xA:
      npc->act_no = 11;
      npc->ani_no = 0;
      npc->act_wait = 0;
      goto LABEL_3;
    case 0xB:
LABEL_3:
      if ( ++npc->act_wait > 30 )
      {
        npc->act_no = 12;
        npc->ani_no = 1;
        npc->ani_wait = 0;
      }
      break;
    case 0xC:
      if ( ++npc->ani_wait > 8 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no == 3 )
      {
        npc->act_no = 20;
        npc->ym = -512;
        if ( x >= npc->x )
          npc->xm = 512;
        else
          npc->xm = -512;
      }
      break;
    case 0x14:
      if ( npc->ym < -127 )
        npc->ani_no = 3;
      else
        npc->ani_no = 4;
      if ( npc->flag & 8 )
      {
        npc->ani_no = 2;
        npc->act_no = 21;
        npc->act_wait = 0;
        npc->xm = 0;
        PlaySoundObject(23, 1);
      }
      break;
    case 0x15:
      if ( ++npc->act_wait > 10 )
      {
        npc->act_no = 10;
        npc->ani_no = 0;
      }
      break;
    default:
      break;
  }
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  if ( npc->ym < -1535 )
    npc->ym = -1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  v1 = (Sint32 *)&v3[16 * npc->ani_no - 80];
  npc->rect.left = *v1;
  npc->rect.top = v1[1];
  npc->rect.right = v1[2];
  npc->rect.bottom = v1[3];
}


//----- (080BF123) --------------------------------------------------------
void __cdecl ActNpc143(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  RECT *v2;
  RECT rcRight[1];
  RECT rcLeft[1];

  rcLeft[0].left = 208;
  rcLeft[0].top = 32;
  rcLeft[0].right = 224;
  rcLeft[0].bottom = 48;
  rcRight[0].left = 208;
  rcRight[0].top = 48;
  rcRight[0].right = 224;
  rcRight[0].bottom = 64;
  if ( npc->direct )
  {
    v1 = npc;
    v2 = &rcRight[npc->ani_no];
  }
  else
  {
    v1 = npc;
    v2 = &rcLeft[npc->ani_no];
  }
  npc->rect.left = v2->left;
  v1->rect.top = v2->top;
  v1->rect.right = v2->right;
  v1->rect.bottom = v2->bottom;
}

//----- (080BF1C3) --------------------------------------------------------
void __cdecl ActNpc144(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  Sint32 *v2;
  int v3;
  RECT rcRight[5];
  RECT rcLeft[5];
  char v6[24];

  qmemcpy(rcLeft, &ActNpc144(NPCHAR *)::C.7, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc144(NPCHAR *)::C.8, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      npc->tgt_x = npc->x;
      PlaySoundObject(29, 1);
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( ++npc->act_wait == 64 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
      }
      break;
    case 2:
      if ( ++npc->ani_wait > 2 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 3 )
        npc->ani_no = 2;
      if ( npc->flag & 8 )
      {
        npc->act_no = 4;
        npc->act_wait = 0;
        npc->ani_no = 4;
        PlaySoundObject(23, 1);
      }
      break;
    case 0xA:
      npc->act_no = 11;
      npc->ani_no = 0;
      npc->ani_wait = 0;
      goto LABEL_12;
    case 0xB:
LABEL_12:
      if ( Random(0, 120) == 10 )
      {
        npc->act_no = 12;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      break;
    case 0xC:
      if ( ++npc->act_wait > 8 )
      {
        npc->act_no = 11;
        npc->ani_no = 0;
      }
      break;
    default:
      break;
  }
  if ( npc->act_no > 1 )
  {
    npc->ym += 32;
    if ( npc->ym > 1535 )
      npc->ym = 1535;
    npc->y += npc->ym;
  }
  if ( npc->direct )
  {
    v1 = npc;
    v2 = (Sint32 *)&v6[16 * npc->ani_no - 160];
  }
  else
  {
    v1 = npc;
    v2 = (Sint32 *)&v6[16 * npc->ani_no - 80];
  }
  npc->rect.left = *v2;
  v1->rect.top = v2[1];
  v1->rect.right = v2[2];
  v1->rect.bottom = v2[3];
  if ( npc->act_no == 1 )
  {
    npc->rect.bottom = npc->act_wait / 4 + npc->rect.top;
    if ( npc->act_wait / 2 & 1 )
      v3 = npc->tgt_x;
    else
      v3 = npc->tgt_x + 512;
    npc->x = v3;
  }
}


//----- (080BF4C7) --------------------------------------------------------
void __cdecl ActNpc145(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  RECT *v3;
  RECT rcRight[1];
  RECT rcLeft[1];

  rcLeft[0].left = 96;
  rcLeft[0].top = 32;
  rcLeft[0].right = 112;
  rcLeft[0].bottom = 48;
  rcRight[0].left = 112;
  rcRight[0].top = 32;
  rcRight[0].right = 128;
  rcRight[0].bottom = 48;
  if ( !npc->act_no )
  {
    if ( npc->pNpc->count2 )
    {
      if ( npc->pNpc->direct )
        npc->direct = 0;
      else
        npc->direct = 2;
    }
    else if ( npc->pNpc->direct )
    {
      npc->direct = 2;
    }
    else
    {
      npc->direct = 0;
    }
    if ( npc->direct )
      v1 = npc->pNpc->x + 5120;
    else
      v1 = npc->pNpc->x - 5120;
    npc->x = v1;
    npc->y = npc->pNpc->y;
  }
  if ( npc->direct )
  {
    v2 = npc;
    v3 = &rcRight[npc->ani_no];
  }
  else
  {
    v2 = npc;
    v3 = &rcLeft[npc->ani_no];
  }
  npc->rect.left = v3->left;
  v2->rect.top = v3->top;
  v2->rect.right = v3->right;
  v2->rect.bottom = v3->bottom;
}

//----- (080BF621) --------------------------------------------------------
void __cdecl ActNpc146(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  RECT rect[5];
  char v4[24];

  qmemcpy(rect, &ActNpc146(NPCHAR *)::C.10, sizeof(rect));
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_6:
    if ( ++npc->act_wait > 10 )
    {
      npc->act_no = 2;
      PlaySoundObject(101, 1);
    }
    goto LABEL_14;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_14;
    npc->act_no = 1;
    if ( npc->direct == 2 )
      SetFlash(0, 0, 2);
    goto LABEL_6;
  }
  if ( ++npc->ani_wait > 2 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no == 2 )
    npc->damage = 10;
  if ( npc->ani_no > 4 )
  {
    SetDestroyNpChar(npc->x, npc->y, 4096, 8);
    npc->cond = 0;
  }
LABEL_14:
  v2 = (Sint32 *)&v4[16 * npc->ani_no - 80];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
}


//----- (080BF784) --------------------------------------------------------
void __cdecl ActNpc147(NPCHAR_0 *npc)
{
  char v1;
  int v2;
  NPCHAR_0 *v3;
  Sint32 *v4;
  RECT rcRight[6];
  RECT rcLeft[6];
  int xm;
  int ym;
  unsigned __int8 deg;
  char v10[24];

  qmemcpy(rcLeft, &ActNpc147(NPCHAR *)::C.11, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc147(NPCHAR *)::C.12, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->y += 1536;
      npc->act_no = 1;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( npc->act_wait <= 7
        || npc->x - 49152 >= x
        || npc->x + 49152 <= x
        || npc->y - 49152 >= y
        || npc->y + 0x4000 <= y )
      {
        if ( npc->act_wait <= 7 )
          ++npc->act_wait;
        npc->ani_no = 0;
      }
      else
      {
        if ( npc->x <= x )
          npc->direct = 2;
        else
          npc->direct = 0;
        npc->ani_no = 1;
      }
      if ( npc->shock )
      {
        npc->act_no = 2;
        npc->ani_no = 0;
        npc->act_wait = 0;
      }
      if ( npc->act_wait > 7 && npc->x - 24576 < x && npc->x + 24576 > x && npc->y - 49152 < y && npc->y + 0x4000 > y )
      {
        npc->act_no = 2;
        npc->ani_no = 0;
        npc->act_wait = 0;
      }
      break;
    case 2:
      if ( ++npc->act_wait > 8 )
      {
        npc->act_no = 3;
        npc->ani_no = 2;
        npc->ym = -1535;
        PlaySoundObject(30, 1);
        if ( npc->x <= x )
          npc->direct = 2;
        else
          npc->direct = 0;
      }
      break;
    case 3:
      if ( npc->ym > 256 )
      {
        npc->tgt_y = npc->y;
        npc->act_no = 4;
        npc->ani_no = 3;
        npc->act_wait = 0;
        npc->act_wait = 0;
      }
      break;
    case 4:
      if ( npc->x >= x )
        npc->direct = 0;
      else
        npc->direct = 2;
      ++npc->act_wait;
      if ( npc->flag & 7 || npc->act_wait > 60 )
      {
        npc->damage = 3;
        npc->act_no = 5;
        npc->ani_no = 2;
      }
      else
      {
        if ( npc->act_wait % 4 == 1 )
          PlaySoundObject(109, 1);
        if ( npc->flag & 8 )
          npc->ym = -512;
        if ( npc->act_wait % 30 == 6 )
        {
          deg = GetArktan(npc->x - x, npc->y - y);
          v1 = Random(-6, 6);
          deg += v1;
          ym = 3 * GetSin(deg);
          xm = 3 * GetCos(deg);
          SetNpChar(148, npc->x, npc->y, xm, ym, 0, 0, 256);
          PlaySoundObject(39, 1);
        }
        if ( ++npc->ani_wait > 0 )
        {
          npc->ani_wait = 0;
          ++npc->ani_no;
        }
        if ( npc->ani_no > 5 )
          npc->ani_no = 3;
      }
      break;
    case 5:
      if ( npc->flag & 8 )
      {
        npc->damage = 2;
        npc->xm = 0;
        npc->act_wait = 0;
        npc->ani_no = 0;
        npc->act_no = 1;
        PlaySoundObject(23, 1);
      }
      break;
    default:
      break;
  }
  if ( npc->act_no == 4 )
  {
    if ( npc->y <= npc->tgt_y )
      v2 = npc->ym + 16;
    else
      v2 = npc->ym - 16;
    npc->ym = v2;
    if ( npc->ym > 512 )
      npc->ym = 512;
    if ( npc->ym < -512 )
      npc->ym = -512;
    if ( npc->xm > 512 )
      npc->xm = 512;
    if ( npc->xm < -512 )
      npc->xm = -512;
  }
  else
  {
    npc->ym += 32;
    if ( npc->ym > 1535 )
      npc->ym = 1535;
  }
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v3 = npc;
    v4 = (Sint32 *)&v10[16 * npc->ani_no - 204];
  }
  else
  {
    v3 = npc;
    v4 = (Sint32 *)&v10[16 * npc->ani_no - 108];
  }
  npc->rect.left = *v4;
  v3->rect.top = v4[1];
  v3->rect.right = v4[2];
  v3->rect.bottom = v4[3];
}


//----- (080BFE0D) --------------------------------------------------------
void __cdecl ActNpc148(NPCHAR_0 *npc)
{
  Sint32 *v1;
  RECT rect_left[2];
  char v3[8];

  if ( npc->flag & 0xFF )
  {
    SetCaret(npc->x, npc->y, 2, 0);
    npc->cond = 0;
  }
  npc->y += npc->ym;
  npc->x += npc->xm;
  rect_left[0].left = 96;
  rect_left[0].top = 96;
  rect_left[0].right = 104;
  rect_left[0].bottom = 104;
  rect_left[1].left = 104;
  rect_left[1].top = 96;
  rect_left[1].right = 112;
  rect_left[1].bottom = 104;
  if ( ++npc->ani_no > 1 )
    npc->ani_no = 0;
  v1 = (Sint32 *)&v3[16 * npc->ani_no - 32];
  npc->rect.left = *v1;
  npc->rect.top = v1[1];
  npc->rect.right = v1[2];
  npc->rect.bottom = v1[3];
  if ( ++npc->count1 > 300 )
  {
    SetCaret(npc->x, npc->y, 2, 0);
    npc->cond = 0;
  }
}


//----- (080BFF4C) --------------------------------------------------------
void __cdecl ActNpc149(NPCHAR_0 *npc)
{
  unsigned __int16 v1;
  int v2;
  int v3;
  int v4;
  int v5;
  unsigned __int16 v6;
  unsigned __int16 v7;
  unsigned __int16 v8;
  int v9;
  int v10;
  int v11;
  int v12;
  unsigned __int16 v13;
  unsigned __int16 v14;
  int i;
  int ia;

  switch ( npc->act_no )
  {
    case 0:
      npc->x += 4096;
      npc->y += 4096;
      if ( npc->direct )
        npc->act_no = 20;
      else
        npc->act_no = 10;
      npc->xm = 0;
      npc->ym = 0;
      npc->bits |= 0x40u;
      break;
    case 0xA:
      v1 = npc->bits;
      LOBYTE(v1) = v1 & 0x7F;
      npc->bits = v1;
      npc->damage = 0;
      if ( x < npc->x + 12800 && x > npc->x - 204800 && y < npc->y + 12800 && y > npc->y - 12800 )
      {
        npc->act_no = 11;
        npc->act_wait = 0;
      }
      break;
    case 0xB:
      if ( ++npc->act_wait % 10 == 6 )
        PlaySoundObject(107, 1);
      if ( npc->flag & 1 )
      {
        npc->xm = 0;
        npc->direct = 2;
        npc->act_no = 20;
        SetQuake(10);
        PlaySoundObject(26, 1);
        for ( i = 0; i <= 3; ++i )
        {
          v2 = Random(-1536, 0);
          v3 = Random(-341, 341);
          v4 = npc->y;
          v5 = Random(-12, 12);
          SetNpChar(4, npc->x - 0x2000, v4 + (v5 << 9), v3, v2, 0, 0, 256);
        }
      }
      else
      {
        if ( dword_81C8584 & 1 )
        {
          v6 = npc->bits;
          LOBYTE(v6) = v6 | 0x80;
          npc->bits = v6;
          npc->damage = 100;
        }
        else
        {
          v7 = npc->bits;
          LOBYTE(v7) = v7 & 0x7F;
          npc->bits = v7;
          npc->damage = 0;
        }
        npc->xm -= 32;
      }
      break;
    case 0x14:
      v8 = npc->bits;
      LOBYTE(v8) = v8 & 0x7F;
      npc->bits = v8;
      npc->damage = 0;
      if ( x > npc->x - 12800 && x < npc->x + 204800 && y < npc->y + 12800 && y > npc->y - 12800 )
      {
        npc->act_no = 21;
        npc->act_wait = 0;
      }
      break;
    case 0x15:
      if ( ++npc->act_wait % 10 == 6 )
        PlaySoundObject(107, 1);
      if ( npc->flag & 4 )
      {
        npc->xm = 0;
        npc->direct = 0;
        npc->act_no = 10;
        SetQuake(10);
        PlaySoundObject(26, 1);
        for ( ia = 0; ia <= 3; ++ia )
        {
          v9 = Random(-1536, 0);
          v10 = Random(-341, 341);
          v11 = npc->y;
          v12 = Random(-12, 12);
          SetNpChar(4, npc->x + 0x2000, v11 + (v12 << 9), v10, v9, 0, 0, 256);
        }
      }
      else
      {
        if ( dword_81C8584 & 4 )
        {
          v13 = npc->bits;
          LOBYTE(v13) = v13 | 0x80;
          npc->bits = v13;
          npc->damage = 100;
        }
        else
        {
          v14 = npc->bits;
          LOBYTE(v14) = v14 & 0x7F;
          npc->bits = v14;
          npc->damage = 0;
        }
        npc->xm += 32;
      }
      break;
    default:
      break;
  }
  if ( npc->xm > 512 )
    npc->xm = 512;
  if ( npc->xm < -512 )
    npc->xm = -512;
  npc->x += npc->xm;
  npc->rect.left = 16;
  npc->rect.top = 0;
  npc->rect.right = 48;
  npc->rect.bottom = 32;
}

//----- (080C0504) --------------------------------------------------------
void __cdecl ActNpc150(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  NPCHAR_0 *v7;
  Sint32 *v8;
  RECT rcRight[9];
  RECT rcLeft[9];
  int i;
  char v12[24];

  qmemcpy(rcLeft, &ActNpc150(NPCHAR *)::C.14, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc150(NPCHAR *)::C.15, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      npc->ani_no = 0;
      if ( npc->direct > 10 )
      {
        npc->x = x;
        npc->y = y;
        npc->direct -= 10;
      }
      break;
    case 2:
      npc->ani_no = 1;
      break;
    case 0xA:
      npc->act_no = 11;
      for ( i = 0; i <= 3; ++i )
      {
        v1 = Random(-1536, 0);
        v2 = Random(-341, 341);
        SetNpChar(4, npc->x, npc->y, v2, v1, 0, 0, 256);
      }
      PlaySoundObject(71, 1);
      goto LABEL_9;
    case 0xB:
LABEL_9:
      npc->ani_no = 2;
      break;
    case 0x14:
      npc->act_no = 21;
      npc->act_wait = 64;
      PlaySoundObject(29, 1);
      goto LABEL_11;
    case 0x15:
LABEL_11:
      if ( !--npc->act_wait )
        npc->cond = 0;
      break;
    case 0x32:
      npc->act_no = 51;
      npc->ani_no = 3;
      npc->ani_wait = 0;
      goto LABEL_14;
    case 0x33:
LABEL_14:
      if ( ++npc->ani_wait > 4 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 6 )
        npc->ani_no = 3;
      if ( npc->direct )
        v3 = npc->x + 512;
      else
        v3 = npc->x - 512;
      npc->x = v3;
      break;
    case 0x3C:
      npc->act_no = 61;
      npc->ani_no = 7;
      npc->tgt_x = npc->x;
      npc->tgt_y = npc->y;
      goto LABEL_23;
    case 0x3D:
LABEL_23:
      npc->tgt_y += 256;
      v4 = npc->tgt_x;
      npc->x = v4 + (Random(-1, 1) << 9);
      v5 = npc->tgt_y;
      npc->y = v5 + (Random(-1, 1) << 9);
      break;
    case 0x46:
      npc->act_no = 71;
      npc->act_wait = 0;
      npc->ani_no = 3;
      npc->ani_wait = 0;
      goto LABEL_25;
    case 0x47:
LABEL_25:
      if ( npc->direct )
        v6 = npc->x - 256;
      else
        v6 = npc->x + 256;
      npc->x = v6;
      if ( ++npc->ani_wait > 8 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 6 )
        npc->ani_no = 3;
      break;
    case 0x50:
      npc->ani_no = 8;
      break;
    case 0x63:
    case 0x64:
      npc->act_no = 101;
      npc->ani_no = 3;
      npc->ani_wait = 0;
      goto LABEL_34;
    case 0x65:
LABEL_34:
      npc->ym += 64;
      if ( npc->ym > 1535 )
        npc->ym = 1535;
      if ( npc->flag & 8 )
      {
        npc->ym = 0;
        npc->act_no = 102;
      }
      npc->y += npc->ym;
      break;
    case 0x66:
      if ( ++npc->ani_wait > 8 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 6 )
        npc->ani_no = 3;
      break;
    default:
      break;
  }
  if ( npc->direct )
  {
    v7 = npc;
    v8 = (Sint32 *)&v12[16 * npc->ani_no - 292];
  }
  else
  {
    v7 = npc;
    v8 = (Sint32 *)&v12[16 * npc->ani_no - 148];
  }
  npc->rect.left = *v8;
  v7->rect.top = v8[1];
  v7->rect.right = v8[2];
  v7->rect.bottom = v8[3];
  if ( npc->act_no == 21 )
  {
    npc->rect.bottom = npc->act_wait / 4 + npc->rect.top;
    if ( npc->act_wait / 2 & 1 )
      ++npc->rect.left;
  }
  if ( unk_81C8598 & 0x40 )
  {
    npc->rect.top += 32;
    npc->rect.bottom += 32;
  }
}


//----- (080C0A58) --------------------------------------------------------
void __cdecl ActNpc151(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[2];
  RECT rcLeft[2];
  char v6[8];

  rcLeft[0].left = 192;
  rcLeft[0].top = 0;
  rcLeft[0].right = 208;
  rcLeft[0].bottom = 16;
  rcLeft[1].left = 208;
  rcLeft[1].top = 0;
  rcLeft[1].right = 224;
  rcLeft[1].bottom = 16;
  rcRight[0].left = 192;
  rcRight[0].top = 16;
  rcRight[0].right = 208;
  rcRight[0].bottom = 32;
  rcRight[1].left = 208;
  rcRight[1].top = 16;
  rcRight[1].right = 224;
  rcRight[1].bottom = 32;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    if ( Random(0, 100) == 0 )
    {
      npc->act_no = 2;
      npc->act_wait = 0;
      npc->ani_no = 1;
    }
    goto LABEL_9;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_9;
    npc->act_no = 1;
    npc->ani_no = 0;
    npc->ani_wait = 0;
    goto LABEL_5;
  }
  if ( ++npc->act_wait > 16 )
  {
    npc->act_no = 1;
    npc->ani_no = 0;
  }
LABEL_9:
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 64];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 32];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (080C0BD8) --------------------------------------------------------
void __cdecl ActNpc152(NPCHAR_0 *npc)
{
  if ( !npc->act_no )
  {
    if ( npc->direct == 2 )
      npc->y += 0x2000;
    npc->act_no = 1;
  }
  npc->rect.left = 0;
  npc->rect.top = 0;
  npc->rect.right = 0;
  npc->rect.bottom = 0;
}

//----- (080C0C48) --------------------------------------------------------
void __cdecl ActNpc153(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  Sint32 *v2;
  Sint32 v3;
  Sint32 *v4;

  if ( npc->x <= x + 163840 && npc->x >= x - 163840 && npc->y <= y + 122880 && npc->y >= y - 122880 )
  {
    switch ( npc->act_no )
    {
      case 0:
        npc->act_no = 1;
        npc->xm = 0;
        npc->ani_no = 0;
        npc->y += 1536;
        goto LABEL_7;
      case 1:
LABEL_7:
        if ( Random(0, 100) == 1 )
        {
          npc->act_no = 2;
          npc->ani_no = 1;
          npc->act_wait = 0;
        }
        if ( Random(0, 100) == 1 )
        {
          if ( npc->direct )
            npc->direct = 0;
          else
            npc->direct = 2;
        }
        if ( Random(0, 100) == 1 )
          npc->act_no = 10;
        break;
      case 2:
        if ( ++npc->act_wait > 20 )
        {
          npc->act_no = 1;
          npc->ani_no = 0;
        }
        break;
      case 0xA:
        npc->act_no = 11;
        npc->act_wait = Random(25, 100);
        npc->ani_no = 2;
        npc->ani_wait = 0;
        goto LABEL_18;
      case 0xB:
LABEL_18:
        if ( ++npc->ani_wait > 3 )
        {
          npc->ani_wait = 0;
          ++npc->ani_no;
        }
        if ( npc->ani_no > 5 )
          npc->ani_no = 2;
        if ( npc->direct )
          npc->xm = 512;
        else
          npc->xm = -512;
        if ( npc->act_wait )
        {
          --npc->act_wait;
        }
        else
        {
          npc->act_no = 1;
          npc->ani_no = 0;
          npc->xm = 0;
        }
        if ( npc->direct || !(npc->flag & 1) )
        {
          if ( npc->direct == 2 )
          {
            if ( npc->flag & 4 )
            {
              npc->ani_no = 2;
              npc->ym = -1535;
              npc->act_no = 20;
              if ( !(gMC.cond & 2) )
                PlaySoundObject(30, 1);
            }
          }
        }
        else
        {
          npc->ani_no = 2;
          npc->ym = -1535;
          npc->act_no = 20;
          if ( !(gMC.cond & 2) )
            PlaySoundObject(30, 1);
        }
        break;
      case 0x14:
        if ( npc->direct || !(npc->flag & 1) )
        {
          if ( npc->direct == 2 && npc->flag & 4 )
            ++npc->count1;
          else
            npc->count1 = 0;
        }
        else
        {
          ++npc->count1;
        }
        if ( npc->count1 > 10 )
        {
          if ( npc->direct )
            npc->direct = 0;
          else
            npc->direct = 2;
        }
        if ( npc->direct )
          npc->xm = 256;
        else
          npc->xm = -256;
        if ( npc->flag & 8 )
        {
          npc->act_no = 21;
          npc->ani_no = 20;
          npc->act_wait = 0;
          npc->xm = 0;
          if ( !(gMC.cond & 2) )
            PlaySoundObject(23, 1);
        }
        break;
      case 0x15:
        if ( ++npc->act_wait > 10 )
        {
          npc->act_no = 1;
          npc->ani_no = 0;
        }
        break;
      default:
        break;
    }
    npc->ym += 64;
    if ( npc->ym > 1535 )
      npc->ym = 1535;
    npc->x += npc->xm;
    npc->y += npc->ym;
    if ( npc->direct )
    {
      v1 = npc;
      v4 = (Sint32 *)(16 * npc->ani_no);
      npc->rect.left = *(Sint32 *)((char *)&grcKitR[0].left + (_DWORD)v4);
      npc->rect.top = v4[34020881];
      npc->rect.right = v4[34020882];
      v3 = v4[34020883];
    }
    else
    {
      v1 = npc;
      v2 = (Sint32 *)(16 * npc->ani_no);
      npc->rect.left = *(Sint32 *)((char *)&grcKitL[0].left + (_DWORD)v2);
      npc->rect.top = v2[34020793];
      npc->rect.right = v2[34020794];
      v3 = v2[34020795];
    }
    v1->rect.bottom = v3;
    if ( npc->life <= 985 )
    {
      npc->code_char = 154;
      npc->act_no = 0;
    }
  }
}

//----- (080C11B7) --------------------------------------------------------
void __cdecl ActNpc154(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  Sint32 v4;
  Sint32 *v5;

  v1 = npc->act_no;
  switch ( v1 )
  {
    case 1:
      if ( npc->flag & 8 )
      {
        npc->ani_no = 10;
        npc->ani_wait = 0;
        npc->act_no = 2;
        npc->act_wait = 0;
      }
      break;
    case 2:
      npc->xm = 8 * npc->xm / 9;
      if ( ++npc->ani_wait > 3 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 11 )
        npc->ani_no = 10;
      if ( ++npc->act_wait > 50 )
        npc->cond |= 8u;
      break;
    case 0:
      npc->bits &= 0xFFDFu;
      npc->bits &= 0xFFF7u;
      npc->damage = 0;
      npc->act_no = 1;
      npc->ani_no = 9;
      npc->ym = -512;
      if ( npc->direct )
        npc->xm = -256;
      else
        npc->xm = 256;
      PlaySoundObject(53, 1);
      break;
  }
  npc->ym += 32;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v2 = npc;
    v5 = (Sint32 *)(16 * npc->ani_no);
    npc->rect.left = *(Sint32 *)((char *)&grcKitR[0].left + (_DWORD)v5);
    npc->rect.top = v5[34020881];
    npc->rect.right = v5[34020882];
    v4 = v5[34020883];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)(16 * npc->ani_no);
    npc->rect.left = *(Sint32 *)((char *)&grcKitL[0].left + (_DWORD)v3);
    npc->rect.top = v3[34020793];
    npc->rect.right = v3[34020794];
    v4 = v3[34020795];
  }
  v2->rect.bottom = v4;
}

//----- (080C13FB) --------------------------------------------------------
void __cdecl ActNpc155(NPCHAR_0 *npc)
{
  int v1;
  unsigned __int8 deg;
  int v3;
  unsigned __int8 v4;
  int v5;
  unsigned __int8 v6;
  unsigned __int8 v7;
  int ym;
  int v9;
  NPCHAR_0 *v10;
  Sint32 *v11;
  Sint32 v12;
  Sint32 *v13;

  if ( npc->x > x + 163840 || npc->x < x - 163840 || npc->y > y + 122880 || npc->y < y - 122880 )
    return;
  v1 = npc->act_no;
  switch ( v1 )
  {
    case 1:
      goto LABEL_9;
    case 2:
      if ( ++npc->ani_no > 19 )
        npc->ani_no = 18;
      if ( ++npc->act_wait > 30 )
      {
        v6 = GetArktan(npc->x - x, npc->y - y);
        v7 = Random(-6, 6) + v6;
        ym = 3 * GetSin(v7);
        v9 = GetCos(v7);
        SetNpChar(156, npc->x, npc->y, 3 * v9, ym, 0, 0, 256);
        if ( !(gMC.cond & 2) )
          PlaySoundObject(39, 1);
        npc->act_no = 1;
        npc->act_wait = Random(70, 150);
        npc->ani_no = 14;
        npc->ani_wait = 0;
      }
      break;
    case 0:
      deg = Random(0, 255);
      npc->xm = GetCos(deg);
      v3 = npc->x;
      npc->tgt_x = v3 + 8 * GetCos(deg + 64);
      v4 = Random(0, 255);
      npc->ym = GetSin(v4);
      v5 = npc->y;
      npc->tgt_y = v5 + 8 * GetSin(v4 + 64);
      npc->act_no = 1;
      npc->count1 = 120;
      npc->act_wait = Random(70, 150);
      npc->ani_no = 14;
LABEL_9:
      if ( ++npc->ani_no > 15 )
        npc->ani_no = 14;
      if ( npc->act_wait )
      {
        --npc->act_wait;
      }
      else
      {
        npc->act_no = 2;
        npc->ani_no = 18;
      }
      break;
  }
  if ( x >= npc->x )
    npc->direct = 2;
  else
    npc->direct = 0;
  if ( npc->tgt_x < npc->x )
    npc->xm -= 16;
  if ( npc->tgt_x > npc->x )
    npc->xm += 16;
  if ( npc->tgt_y < npc->y )
    npc->ym -= 16;
  if ( npc->tgt_y > npc->y )
    npc->ym += 16;
  if ( npc->xm > 512 )
    npc->xm = 512;
  if ( npc->xm < -512 )
    npc->xm = -512;
  if ( npc->ym > 512 )
    npc->ym = 512;
  if ( npc->ym < -512 )
    npc->ym = -512;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v10 = npc;
    v13 = (Sint32 *)(16 * npc->ani_no);
    npc->rect.left = *(Sint32 *)((char *)&grcKitR[0].left + (_DWORD)v13);
    npc->rect.top = v13[34020881];
    npc->rect.right = v13[34020882];
    v12 = v13[34020883];
  }
  else
  {
    v10 = npc;
    v11 = (Sint32 *)(16 * npc->ani_no);
    npc->rect.left = *(Sint32 *)((char *)&grcKitL[0].left + (_DWORD)v11);
    npc->rect.top = v11[34020793];
    npc->rect.right = v11[34020794];
    v12 = v11[34020795];
  }
  v10->rect.bottom = v12;
  if ( npc->life <= 985 )
  {
    npc->code_char = 154;
    npc->act_no = 0;
  }
}

//----- (080C18CF) --------------------------------------------------------
void __cdecl ActNpc156(NPCHAR_0 *npc)
{
  Sint32 *v1;
  RECT rect_left[3];
  char v3[8];

  if ( npc->flag & 0xFF )
  {
    SetCaret(npc->x, npc->y, 2, 0);
    npc->cond = 0;
  }
  npc->y += npc->ym;
  npc->x += npc->xm;
  rect_left[0].left = 96;
  rect_left[0].top = 112;
  rect_left[0].right = 112;
  rect_left[0].bottom = 128;
  rect_left[1].left = 112;
  rect_left[1].top = 112;
  rect_left[1].right = 128;
  rect_left[1].bottom = 128;
  rect_left[2].left = 128;
  rect_left[2].top = 112;
  rect_left[2].right = 144;
  rect_left[2].bottom = 128;
  if ( ++npc->ani_no > 2 )
    npc->ani_no = 0;
  v1 = (Sint32 *)&v3[16 * npc->ani_no - 48];
  npc->rect.left = *v1;
  npc->rect.top = v1[1];
  npc->rect.right = v1[2];
  npc->rect.bottom = v1[3];
  if ( ++npc->count1 > 300 )
  {
    SetCaret(npc->x, npc->y, 2, 0);
    npc->cond = 0;
  }
}


//----- (080C1A2A) --------------------------------------------------------
void __cdecl ActNpc157(NPCHAR_0 *npc)
{
  unsigned __int16 v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  unsigned __int16 v7;
  unsigned __int16 v8;
  unsigned __int16 v9;
  int v10;
  int v11;
  int v12;
  int v13;
  int v14;
  unsigned __int16 v15;
  unsigned __int16 v16;
  int i;
  int ia;

  switch ( npc->act_no )
  {
    case 0:
      npc->x += 4096;
      npc->y += 4096;
      if ( npc->direct )
        npc->act_no = 20;
      else
        npc->act_no = 10;
      npc->xm = 0;
      npc->ym = 0;
      npc->bits |= 0x40u;
      break;
    case 0xA:
      v1 = npc->bits;
      LOBYTE(v1) = v1 & 0x7F;
      npc->bits = v1;
      npc->damage = 0;
      if ( y < npc->y + 12800 && y > npc->y - 204800 && x < npc->x + 12800 && x > npc->x - 12800 )
      {
        npc->act_no = 11;
        npc->act_wait = 0;
      }
      break;
    case 0xB:
      if ( ++npc->act_wait % 10 == 6 )
        PlaySoundObject(107, 1);
      if ( npc->flag & 2 )
      {
        npc->ym = 0;
        npc->direct = 2;
        npc->act_no = 20;
        SetQuake(10);
        PlaySoundObject(26, 1);
        for ( i = 0; i <= 3; ++i )
        {
          v2 = Random(-1536, 0);
          v3 = Random(-341, 341);
          v4 = npc->y - 0x2000;
          v5 = npc->x;
          v6 = Random(-12, 12);
          SetNpChar(4, v5 + (v6 << 9), v4, v3, v2, 0, 0, 256);
        }
      }
      else
      {
        if ( dword_81C8584 & 2 )
        {
          v7 = npc->bits;
          LOBYTE(v7) = v7 | 0x80;
          npc->bits = v7;
          npc->damage = 100;
        }
        else
        {
          v8 = npc->bits;
          LOBYTE(v8) = v8 & 0x7F;
          npc->bits = v8;
          npc->damage = 0;
        }
        npc->ym -= 32;
      }
      break;
    case 0x14:
      v9 = npc->bits;
      LOBYTE(v9) = v9 & 0x7F;
      npc->bits = v9;
      npc->damage = 0;
      if ( y > npc->y - 12800 && y < npc->y + 204800 && x < npc->x + 12800 && x > npc->x - 12800 )
      {
        npc->act_no = 21;
        npc->act_wait = 0;
      }
      break;
    case 0x15:
      if ( ++npc->act_wait % 10 == 6 )
        PlaySoundObject(107, 1);
      if ( npc->flag & 8 )
      {
        npc->ym = 0;
        npc->direct = 0;
        npc->act_no = 10;
        SetQuake(10);
        PlaySoundObject(26, 1);
        for ( ia = 0; ia <= 3; ++ia )
        {
          v10 = Random(-1536, 0);
          v11 = Random(-341, 341);
          v12 = npc->y + 0x2000;
          v13 = npc->x;
          v14 = Random(-12, 12);
          SetNpChar(4, v13 + (v14 << 9), v12, v11, v10, 0, 0, 256);
        }
      }
      else
      {
        if ( dword_81C8584 & 8 )
        {
          v15 = npc->bits;
          LOBYTE(v15) = v15 | 0x80;
          npc->bits = v15;
          npc->damage = 100;
        }
        else
        {
          v16 = npc->bits;
          LOBYTE(v16) = v16 & 0x7F;
          npc->bits = v16;
          npc->damage = 0;
        }
        npc->ym += 32;
      }
      break;
    default:
      break;
  }
  if ( npc->ym > 512 )
    npc->ym = 512;
  if ( npc->ym < -512 )
    npc->ym = -512;
  npc->y += npc->ym;
  npc->rect.left = 16;
  npc->rect.top = 0;
  npc->rect.right = 48;
  npc->rect.bottom = 32;
}

//----- (080C1FEA) --------------------------------------------------------
void __cdecl ActNpc158(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  Sint32 *v5;
  RECT rect[8];
  int dir;
  char v8[24];

  qmemcpy(rect, &ActNpc158(NPCHAR *)::C.21, sizeof(rect));
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_28;
  }
  else
  {
    npc->act_no = 1;
    v2 = npc->direct;
    if ( v2 == 1 )
    {
      npc->count1 = 224;
    }
    else if ( v2 > 1 )
    {
      if ( v2 == 2 )
      {
        npc->count1 = 32;
      }
      else if ( v2 == 3 )
      {
        npc->count1 = 96;
      }
    }
    else if ( !v2 )
    {
      npc->count1 = 160;
    }
  }
  npc->xm = 2 * GetCos(npc->count1);
  npc->ym = 2 * GetSin(npc->count1);
  npc->y += npc->ym;
  npc->x += npc->xm;
  dir = (unsigned __int8)GetArktan(npc->x - x, npc->y - y);
  if ( npc->count1 <= dir )
  {
    if ( dir - npc->count1 > 127 )
      v4 = npc->count1 - 1;
    else
      v4 = npc->count1 + 1;
    npc->count1 = v4;
  }
  else
  {
    if ( npc->count1 - dir > 127 )
      v3 = npc->count1 + 1;
    else
      v3 = npc->count1 - 1;
    npc->count1 = v3;
  }
  if ( npc->count1 > 255 )
    npc->count1 -= 256;
  if ( npc->count1 < 0 )
    npc->count1 += 256;
LABEL_28:
  if ( ++npc->ani_wait > 2 )
  {
    npc->ani_wait = 0;
    SetCaret(npc->x, npc->y, 7, 4);
  }
  npc->ani_no = (npc->count1 + 16) / 32;
  if ( npc->ani_no > 7 )
    npc->ani_no = 7;
  v5 = (Sint32 *)&v8[16 * npc->ani_no - 132];
  npc->rect.left = *v5;
  npc->rect.top = v5[1];
  npc->rect.right = v5[2];
  npc->rect.bottom = v5[3];
}


//----- (080C226C) --------------------------------------------------------
void __cdecl ActNpc159(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  int v8;
  int v9;
  int v10;
  int v11;
  int v12;
  int v13;
  int v14;
  int i;

  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_7:
    if ( ++npc->act_wait > 50 )
    {
      npc->act_no = 2;
      npc->xm = -256;
    }
    if ( npc->act_wait / 2 & 1 )
      v8 = npc->x + 512;
    else
      v8 = npc->x - 512;
    npc->x = v8;
    goto LABEL_15;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_15;
    npc->act_no = 1;
    for ( i = 0; i <= 7; ++i )
    {
      v2 = Random(-341, 341);
      v3 = Random(-341, 341);
      v4 = npc->y;
      v5 = (Random(-16, 16) << 9) + v4;
      v6 = npc->x;
      v7 = Random(-16, 16);
      SetNpChar(4, v6 + (v7 << 9), v5, v3, v2, 0, 0, 256);
    }
    goto LABEL_7;
  }
  ++npc->act_wait;
  npc->ym += 64;
  if ( npc->y > 327680 )
    npc->cond = 0;
LABEL_15:
  npc->y += npc->ym;
  npc->x += npc->xm;
  npc->rect.left = 144;
  npc->rect.top = 128;
  npc->rect.right = 192;
  npc->rect.bottom = 200;
  if ( npc->act_wait % 8 == 1 )
  {
    v9 = Random(-341, 341);
    v10 = Random(-341, 341);
    v11 = npc->y;
    v12 = (Random(-16, 16) << 9) + v11;
    v13 = npc->x;
    v14 = Random(-16, 16);
    SetNpChar(4, v13 + (v14 << 9), v12, v10, v9, 0, 0, 256);
  }
}

//----- (080C2528) --------------------------------------------------------
void InitNpChar()
{
  memset(gNPC, 0, 0x15800u);
}

//----- (080C254C) --------------------------------------------------------
void __cdecl _SetUniqueParameter(NPCHAR_0 *npc)
{
  int code;

  code = npc->code_char;
  npc->surf = gNpcTable[code].surf;
  npc->hit_voice = gNpcTable[code].hit_voice;
  npc->destroy_voice = gNpcTable[code].destroy_voice;
  npc->damage = gNpcTable[code].damage;
  npc->size = gNpcTable[code].size;
  npc->life = gNpcTable[code].life;
  npc->hit.front = gNpcTable[code].hit.front << 9;
  npc->hit.back = gNpcTable[code].hit.back << 9;
  npc->hit.top = gNpcTable[code].hit.top << 9;
  npc->hit.bottom = gNpcTable[code].hit.bottom << 9;
  npc->view.front = gNpcTable[code].view.front << 9;
  npc->view.back = gNpcTable[code].view.back << 9;
  npc->view.top = gNpcTable[code].view.top << 9;
  npc->view.bottom = gNpcTable[code].view.bottom << 9;
}

//----- (080C2775) --------------------------------------------------------
signed int __cdecl LoadEvent(char *path_event)
{
  int v2;
  char path[260];
  $27E69A81C4D44FA41891AD1A77DE92B3 eve;
  char code[4];
  int i;
  int n;
  SDL_RWops_0 *fp;
  int count;

  sprintf(path, "%s/%s", gDataPath, path_event);
  fp = SDL_RWFromFile(path, "rb");
  if ( !fp )
    return 0;
  fp->read(fp, code, 1, 4);
  if ( memcmp(code, gPassPixEve, 3u) )
    return 0;
  count = SDL_ReadLE32(fp);
  memset(gNPC, 0, 0x15800u);
  n = 170;
  for ( i = 0; i < count; ++i )
  {
    eve.x = SDL_ReadLE16(fp);
    eve.y = SDL_ReadLE16(fp);
    eve.code_flag = SDL_ReadLE16(fp);
    eve.code_event = SDL_ReadLE16(fp);
    eve.code_char = SDL_ReadLE16(fp);
    eve.bits = SDL_ReadLE16(fp);
    if ( eve.bits & 0x1000 )
      v2 = 2;
    else
      v2 = 0;
    gNPC[n].direct = v2;
    gNPC[n].code_char = eve.code_char;
    gNPC[n].code_event = eve.code_event;
    gNPC[n].code_flag = eve.code_flag;
    gNPC[n].x = eve.x << 13;
    gNPC[n].y = eve.y << 13;
    gNPC[n].bits = eve.bits;
    gNPC[n].bits |= gNpcTable[gNPC[n].code_char].bits;
    gNPC[n].exp = gNpcTable[gNPC[n].code_char].exp;
    _SetUniqueParameter((NPCHAR_0 *)(172 * n + 136142176));
    if ( gNPC[n].bits & 0x800 )
    {
      if ( (unsigned __int8)GetNPCFlag(gNPC[n].code_flag) )
        gNPC[n].cond |= 0x80u;
    }
    else if ( gNPC[n].bits & 0x4000 )
    {
      if ( (unsigned __int8)GetNPCFlag(gNPC[n].code_flag) ^ 1 )
        gNPC[n].cond |= 0x80u;
    }
    else
    {
      gNPC[n].cond = -128;
    }
    ++n;
  }
  fp->close(fp);
  return 1;
}



//----- (080C2B09) --------------------------------------------------------
void __cdecl SetNpChar(int code_char, int x, int y, int xm, int ym, int dir, NPCHAR_0 *npc, int start_index)
{
  char v8;
  signed int n;

  for ( n = start_index; ; ++n )
  {
    v8 = n <= 511 && gNPC[n].cond ? 1 : 0;
    if ( !v8 )
      break;
  }
  if ( n != 512 )
  {
    memset((void *)(172 * n + 136142176), 0, 0xACu);
    gNPC[n].cond |= 0x80u;
    gNPC[n].direct = dir;
    gNPC[n].code_char = code_char;
    gNPC[n].x = x;
    gNPC[n].y = y;
    gNPC[n].xm = xm;
    gNPC[n].ym = ym;
    gNPC[n].pNpc = npc;
    gNPC[n].bits = gNpcTable[gNPC[n].code_char].bits;
    gNPC[n].exp = gNpcTable[gNPC[n].code_char].exp;
    _SetUniqueParameter((NPCHAR_0 *)(172 * n + 136142176));
  }
}

//----- (080C2CA8) --------------------------------------------------------
void __cdecl SetDestroyNpChar(int x, int y, int w, int num)
{
  int offset_x;
  int offset_y;
  int i;
  int wa;

  wa = w / 512;
  for ( i = 0; i < num; ++i )
  {
    offset_x = Random(-wa, wa) << 9;
    offset_y = Random(-wa, wa) << 9;
    SetNpChar(4, x + offset_x, offset_y + y, 0, 0, 0, 0, 256);
  }
  SetCaret(x, y, 12, 0);
}

//----- (080C2D8C) --------------------------------------------------------
void __cdecl SetDestroyNpCharUp(int x, int y, int w, int num)
{
  int offset_x;
  int offset_y;
  int i;
  int wa;

  wa = w / 512;
  for ( i = 0; i < num; ++i )
  {
    offset_x = Random(-wa, wa) << 9;
    offset_y = Random(-wa, wa) << 9;
    SetNpChar(4, x + offset_x, offset_y + y, 0, 0, 1, 0, 256);
  }
  SetCaret(x, y, 12, 0);
}

//----- (080C2E70) --------------------------------------------------------
void __cdecl SetExpObjects(int x, int y, int exp)
{
  char v3;
  int n;
  signed int sub_exp;

  for ( n = 256; exp; _SetUniqueParameter((NPCHAR_0 *)(172 * n + 136142176)) )
  {
    while ( 1 )
    {
      v3 = n <= 511 && gNPC[n].cond ? 1 : 0;
      if ( !v3 )
        break;
      ++n;
    }
    if ( n == 512 )
      break;
    memset((void *)(172 * n + 136142176), 0, 0xACu);
    if ( exp <= 19 )
    {
      if ( exp <= 4 )
      {
        if ( exp > 0 )
        {
          --exp;
          sub_exp = 1;
        }
      }
      else
      {
        exp -= 5;
        sub_exp = 5;
      }
    }
    else
    {
      exp -= 20;
      sub_exp = 20;
    }
    gNPC[n].cond |= 0x80u;
    gNPC[n].direct = 0;
    gNPC[n].code_char = 1;
    gNPC[n].x = x;
    gNPC[n].y = y;
    gNPC[n].bits = gNpcTable[gNPC[n].code_char].bits;
    gNPC[n].exp = sub_exp;
  }
}

//----- (080C3002) --------------------------------------------------------
signed int __cdecl SetBulletObject(int x, int y, int val)
{
  int v3;
  char v5;
  int tamakazu_ari[10];
  int n;
  int bullet_no;
  int t;

  t = 0;
  memset(tamakazu_ari, 0, 0x28u);
  for ( n = 0; n <= 7; ++n )
  {
    v3 = gArmsData[n].code;
    if ( v3 == 5 )
    {
      tamakazu_ari[t++] = 0;
    }
    else if ( v3 == 10 )
    {
      tamakazu_ari[t++] = 1;
    }
    else
    {
      tamakazu_ari[t] = 0;
    }
  }
  if ( !t )
    return 0;
  n = Random(1, 10 * t);
  bullet_no = tamakazu_ari[n % t];
  for ( n = 256; ; ++n )
  {
    v5 = n <= 511 && gNPC[n].cond ? 1 : 0;
    if ( !v5 )
      break;
  }
  if ( n == 512 )
    return 0;
  memset((void *)(172 * n + 136142176), 0, 0xACu);
  gNPC[n].cond |= 0x80u;
  gNPC[n].direct = 0;
  gNPC[n].code_event = bullet_no;
  gNPC[n].code_char = 86;
  gNPC[n].x = x;
  gNPC[n].y = y;
  gNPC[n].bits = gNpcTable[gNPC[n].code_char].bits;
  gNPC[n].exp = val;
  _SetUniqueParameter((NPCHAR_0 *)(172 * n + 136142176));
  return 1;
}

//----- (080C322E) --------------------------------------------------------
signed int __cdecl SetLifeObject(int x, int y, int val)
{
  char v3;
  int n;

  for ( n = 256; ; ++n )
  {
    v3 = n <= 511 && gNPC[n].cond ? 1 : 0;
    if ( !v3 )
      break;
  }
  if ( n == 512 )
    return 0;
  memset((void *)(172 * n + 136142176), 0, 0xACu);
  gNPC[n].cond |= 0x80u;
  gNPC[n].direct = 0;
  gNPC[n].code_char = 87;
  gNPC[n].x = x;
  gNPC[n].y = y;
  gNPC[n].bits = gNpcTable[gNPC[n].code_char].bits;
  gNPC[n].exp = val;
  _SetUniqueParameter((NPCHAR_0 *)(172 * n + 136142176));
  return 1;
}

//----- (080C337F) --------------------------------------------------------
void __cdecl VanishNpChar(NPCHAR_0 *npc)
{
  int x;
  int y;

  x = npc->x;
  y = npc->y;
  memset(npc, 0, 0xACu);
  npc->count1 = 0;
  npc->x = x;
  npc->y = y;
  npc->cond |= 0x80u;
  npc->direct = 0;
  npc->code_char = 3;
  npc->bits = gNpcTable[npc->code_char].bits;
  npc->exp = gNpcTable[npc->code_char].exp;
  _SetUniqueParameter(npc);
}

//----- (080C3446) --------------------------------------------------------
void __cdecl PutNpChar(int fx, int fy)
{
  int n;
  Sint8 a;
  int side;

  for ( n = 0; n <= 511; ++n )
  {
    if ( (gNPC[n].cond & 0x80u) != 0 )
    {
      if ( gNPC[n].shock )
      {
        a = 2 * ((gNPC[n].shock >> 1) & 1) - 1;
      }
      else
      {
        a = 0;
        if ( (gNPC[n].bits & 0x8000u) != 0 && gNPC[n].damage_view )
        {
          SetValueView((int *)(172 * n + 136142184), (int *)(172 * n + 136142188), gNPC[n].damage_view);
          gNPC[n].damage_view = 0;
        }
      }
      if ( gNPC[n].direct )
        side = gNPC[n].view.back;
      else
        side = gNPC[n].view.front;
      PutBitmap3(
        &grcGame,
        (gNPC[n].x - side) / 512 - fx / 512 + a,
        (gNPC[n].y - gNPC[n].view.top) / 512 - fy / 512,
        (RECT *)(172 * n + 136142260),
        gNPC[n].surf);
    }
  }
}

//----- (080C3648) --------------------------------------------------------
void ActNpChar()
{
  int i;

  for ( i = 0; i <= 511; ++i )
  {
    if ( (gNPC[i].cond & 0x80u) != 0 )
    {
      gpNpcFuncTbl[gNPC[i].code_char]((NPCHAR_0 *)(172 * i + 136142176));
      if ( gNPC[i].shock )
        --gNPC[i].shock;
    }
  }
}

//----- (080C36E6) --------------------------------------------------------
void __cdecl ChangeNpCharByEvent(int code_event, int code_char, int dir)
{
  int n;

  for ( n = 0; n <= 511; ++n )
  {
    if ( (gNPC[n].cond & 0x80u) != 0 && gNPC[n].code_event == code_event )
    {
      gNPC[n].bits &= 0x7F00u;
      gNPC[n].code_char = code_char;
      gNPC[n].bits |= gNpcTable[gNPC[n].code_char].bits;
      gNPC[n].exp = gNpcTable[gNPC[n].code_char].exp;
      _SetUniqueParameter((NPCHAR_0 *)(172 * n + 136142176));
      gNPC[n].cond |= 0x80u;
      gNPC[n].act_no = 0;
      gNPC[n].act_wait = 0;
      gNPC[n].count1 = 0;
      gNPC[n].count2 = 0;
      gNPC[n].ani_no = 0;
      gNPC[n].ani_wait = 0;
      gNPC[n].xm = 0;
      gNPC[n].ym = 0;
      if ( dir != 5 )
      {
        if ( dir == 4 )
        {
          if ( gNPC[n].x >= x )
            gNPC[n].direct = 0;
          else
            gNPC[n].direct = 2;
        }
        else
        {
          gNPC[n].direct = dir;
        }
      }
      gpNpcFuncTbl[code_char]((NPCHAR_0 *)(172 * n + 136142176));
    }
  }
}

//----- (080C394F) --------------------------------------------------------
void __cdecl ChangeCheckableNpCharByEvent(int code_event, int code_char, int dir)
{
  unsigned __int16 v3;
  int n;

  for ( n = 0; n <= 511; ++n )
  {
    if ( (gNPC[n].cond & 0x80u) != 0 && gNPC[n].code_event == code_event )
    {
      gNPC[n].bits &= 0x7F00u;
      v3 = gNPC[n].bits;
      HIBYTE(v3) |= 0x20u;
      gNPC[n].bits = v3;
      gNPC[n].code_char = code_char;
      gNPC[n].bits |= gNpcTable[gNPC[n].code_char].bits;
      gNPC[n].exp = gNpcTable[gNPC[n].code_char].exp;
      _SetUniqueParameter((NPCHAR_0 *)(172 * n + 136142176));
      gNPC[n].cond |= 0x80u;
      gNPC[n].act_no = 0;
      gNPC[n].act_wait = 0;
      gNPC[n].count1 = 0;
      gNPC[n].count2 = 0;
      gNPC[n].ani_no = 0;
      gNPC[n].ani_wait = 0;
      gNPC[n].xm = 0;
      gNPC[n].ym = 0;
      if ( dir != 5 )
      {
        if ( dir == 4 )
        {
          if ( gNPC[n].x >= x )
            gNPC[n].direct = 0;
          else
            gNPC[n].direct = 2;
        }
        else
        {
          gNPC[n].direct = (char)dir;
        }
      }
      gpNpcFuncTbl[code_char]((NPCHAR_0 *)(172 * n + 136142176));
    }
  }
}

//----- (080C3BE0) --------------------------------------------------------
void __cdecl SetNpCharActionNo(int code_event, int act_no, int dir)
{
  int n;

  for ( n = 0; n <= 511 && ((gNPC[n].cond & 0x80u) == 0 || gNPC[n].code_event != code_event); ++n )
    ;
  if ( n != 512 )
  {
    gNPC[n].act_no = act_no;
    if ( dir != 5 )
    {
      if ( dir == 4 )
      {
        if ( gNPC[n].x >= x )
          gNPC[n].direct = 0;
        else
          gNPC[n].direct = 2;
      }
      else
      {
        gNPC[n].direct = dir;
      }
    }
  }
}

//----- (080C3CAC) --------------------------------------------------------
void __cdecl MoveNpChar(int code_event, int x, int y, int dir)
{
  int n;

  for ( n = 0; n <= 511 && ((gNPC[n].cond & 0x80u) == 0 || gNPC[n].code_event != code_event); ++n )
    ;
  if ( n != 512 )
  {
    gNPC[n].x = x;
    gNPC[n].y = y;
    if ( dir != 5 )
    {
      if ( dir == 4 )
      {
        if ( gNPC[n].x >= ::x )
          gNPC[n].direct = 0;
        else
          gNPC[n].direct = 2;
      }
      else
      {
        gNPC[n].direct = (char)dir;
      }
    }
  }
}

//----- (080C3D91) --------------------------------------------------------
void __cdecl BackStepMyChar(int code_event)
{
  int n;

  n = 0;
  gMC.cond &= 0xFEu;
  unk_81C85B8 = -512;
  if ( code_event )
  {
    if ( code_event == 2 )
    {
      dir = 2;
      unk_81C85B4 = -512;
    }
    else
    {
      while ( n <= 511 && ((gNPC[n].cond & 0x80u) == 0 || gNPC[n].code_event != code_event) )
        ++n;
      if ( n != 512 )
      {
        if ( gNPC[n].x >= x )
        {
          dir = 2;
          unk_81C85B4 = -512;
        }
        else
        {
          dir = 0;
          unk_81C85B4 = 512;
        }
      }
    }
  }
  else
  {
    dir = 0;
    unk_81C85B4 = 512;
  }
}

//----- (080C3E82) --------------------------------------------------------
void __cdecl DeleteNpCharEvent(int code)
{
  int i;

  for ( i = 0; i <= 511; ++i )
  {
    if ( (gNPC[i].cond & 0x80u) != 0 && gNPC[i].code_event == code )
    {
      gNPC[i].cond = 0;
      SetNPCFlag(gNPC[i].code_flag);
    }
  }
}

//----- (080C3EF4) --------------------------------------------------------
void __cdecl DeleteNpCharCode(int code, bool bSmoke)
{
  int v2;
  int n;

  for ( n = 0; n <= 511; ++n )
  {
    if ( (gNPC[n].cond & 0x80u) != 0 && gNPC[n].code_char == code )
    {
      gNPC[n].cond = 0;
      SetNPCFlag(gNPC[n].code_flag);
      if ( bSmoke )
      {
        PlaySoundObject(gNPC[n].destroy_voice, 1);
        v2 = gNPC[n].size;
        switch ( v2 )
        {
          case 2:
            SetDestroyNpChar(gNPC[n].x, gNPC[n].y, gNPC[n].view.back, 8);
            break;
          case 3:
            SetDestroyNpChar(gNPC[n].x, gNPC[n].y, gNPC[n].view.back, 16);
            break;
          case 1:
            SetDestroyNpChar(gNPC[n].x, gNPC[n].y, gNPC[n].view.back, 4);
            break;
        }
      }
    }
  }
}

//----- (080C40A0) --------------------------------------------------------
void __cdecl GetNpCharPosition(int *x, int *y, int i)
{
  *x = gNPC[i].x;
  *y = gNPC[i].y;
}

//----- (080C40CD) --------------------------------------------------------
signed int __cdecl IsNpCharCode(int code)
{
  int i;

  for ( i = 0; i <= 511; ++i )
  {
    if ( (gNPC[i].cond & 0x80u) != 0 && gNPC[i].code_char == code )
      return 1;
  }
  return 0;
}

//----- (080C4124) --------------------------------------------------------
_BOOL4 __cdecl GetNpCharAlive(int code_event)
{
  int i;

  for ( i = 0; i <= 511 && ((gNPC[i].cond & 0x80u) == 0 || gNPC[i].code_event != code_event); ++i )
    ;
  return i <= 511;
}

//----- (080C4187) --------------------------------------------------------
int CountAliveNpChar()
{
  int n;
  int count;

  count = 0;
  for ( n = 0; n <= 511; ++n )
  {
    if ( (gNPC[n].cond & 0x80u) != 0 )
      ++count;
  }
  return count;
}

//----- (080C41CC) --------------------------------------------------------
void __cdecl ActNpc000(NPCHAR_0 *npc)
{
  if ( !npc->act_no )
  {
    npc->act_no = 1;
    if ( npc->direct == 2 )
      npc->y += 0x2000;
  }
  npc->rect.left = 0;
  npc->rect.top = 0;
  npc->rect.right = 16;
  npc->rect.bottom = 16;
}

//----- (080C423C) --------------------------------------------------------
void __cdecl ActNpc001(NPCHAR_0 *npc)
{
  int v1;
  Sint32 *v2;
  int v3;
  RECT rect[6];
  RECT rcNo;
  char v6[24];

  if ( gBack.type != 5 && gBack.type != 6 )
  {
    if ( !npc->act_no )
    {
      npc->act_no = 1;
      npc->ani_no = Random(0, 4);
      npc->xm = Random(-512, 512);
      npc->ym = Random(-1024, 0);
      if ( Random(0, 1) != 0 )
        npc->direct = 0;
      else
        npc->direct = 2;
    }
    if ( npc->flag & 0x100 )
      v1 = npc->ym + 21;
    else
      v1 = npc->ym + 42;
    npc->ym = v1;
    if ( npc->flag & 1 && npc->xm < 0 )
      npc->xm = -npc->xm;
    if ( npc->flag & 4 && npc->xm > 0 )
      npc->xm = -npc->xm;
    if ( npc->flag & 2 && npc->ym < 0 )
      npc->ym = -npc->ym;
    if ( npc->flag & 8 )
    {
      PlaySoundObject(45, 1);
      npc->ym = -640;
      npc->xm = 2 * npc->xm / 3;
    }
    if ( npc->flag & 0xD )
    {
      PlaySoundObject(45, 1);
      if ( ++npc->count2 > 2 )
        npc->y -= 512;
    }
    else
    {
      npc->count2 = 0;
    }
    if ( npc->xm < -1535 )
      npc->xm = -1535;
    if ( npc->xm > 1535 )
      npc->xm = 1535;
    if ( npc->ym < -1535 )
      npc->ym = -1535;
    if ( npc->ym > 1535 )
      npc->ym = 1535;
  }
  else
  {
    if ( !npc->act_no )
    {
      npc->act_no = 1;
      npc->ym = Random(-128, 128);
      npc->xm = Random(127, 256);
    }
    npc->xm -= 8;
    if ( npc->x <= 40959 )
      npc->cond = 0;
    if ( npc->x < -1536 )
      npc->x = -1536;
    if ( npc->flag & 1 )
      npc->xm = 256;
    if ( npc->flag & 2 )
      npc->ym = 64;
    if ( npc->flag & 8 )
      npc->ym = -64;
  }
  npc->y += npc->ym;
  npc->x += npc->xm;
  qmemcpy(rect, &ActNpc001(NPCHAR *)::C.1, sizeof(rect));
  rcNo.left = 0;
  rcNo.top = 0;
  rcNo.right = 0;
  rcNo.bottom = 0;
  ++npc->ani_wait;
  if ( npc->direct )
  {
    if ( npc->ani_wait > 2 )
    {
      npc->ani_wait = 0;
      if ( --npc->ani_no < 0 )
        npc->ani_no = 5;
    }
  }
  else if ( npc->ani_wait > 2 )
  {
    npc->ani_wait = 0;
    if ( ++npc->ani_no > 5 )
      npc->ani_no = 0;
  }
  v2 = (Sint32 *)&v6[16 * npc->ani_no - 112];
  npc->rect.left = *v2;
  npc->rect.top = v2[1];
  npc->rect.right = v2[2];
  npc->rect.bottom = v2[3];
  if ( npc->act_no )
  {
    v3 = npc->exp;
    if ( v3 == 5 )
    {
      npc->rect.top += 16;
      npc->rect.bottom += 16;
    }
    else if ( v3 == 20 )
    {
      npc->rect.top += 32;
      npc->rect.bottom += 32;
    }
    npc->act_no = 1;
  }
  if ( ++npc->count1 > 500 && npc->ani_no == 5 && npc->ani_wait == 2 )
    npc->cond = 0;
  if ( npc->count1 > 400 )
  {
    if ( npc->count1 / 2 & 1 )
      npc->rect = rcNo;
  }
}


//----- (080C4774) --------------------------------------------------------
void __cdecl ActNpc002(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[7];
  RECT rcLeft[7];
  char v6[12];

  qmemcpy(rcLeft, &ActNpc002(NPCHAR *)::C.2, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc002(NPCHAR *)::C.3, sizeof(rcRight));
  if ( npc->flag & 1 )
  {
    npc->direct = 2;
  }
  else if ( npc->flag & 4 )
  {
    npc->direct = 0;
  }
  v1 = npc->act_no;
  switch ( v1 )
  {
    case 1:
      npc->xm = 7 * npc->xm / 8;
      if ( ++npc->count1 > 40 )
      {
        if ( npc->shock )
        {
          npc->count1 = 0;
          npc->act_no = 2;
          npc->ani_no = 6;
          npc->ani_wait = 0;
          npc->damage = 5;
        }
        else
        {
          npc->act_no = 0;
          npc->ani_wait = 0;
        }
      }
      break;
    case 2:
      if ( npc->direct )
        npc->xm = 1024;
      else
        npc->xm = -1024;
      if ( ++npc->count1 > 200 )
      {
        npc->act_no = 0;
        npc->damage = 1;
      }
      if ( ++npc->ani_wait > 5 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 6 )
        npc->ani_no = 5;
      break;
    case 0:
      if ( npc->direct )
        npc->xm = 256;
      else
        npc->xm = -256;
      if ( ++npc->ani_wait > 8 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 3 )
        npc->ani_no = 0;
      if ( npc->shock )
      {
        npc->count1 = 0;
        npc->act_no = 1;
        npc->ani_no = 4;
      }
      break;
  }
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 224];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 112];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (080C4AA1) --------------------------------------------------------
void __cdecl ActNpc003(NPCHAR_0 *npc)
{
  if ( ++npc->count1 > 100 )
    npc->cond = 0;
  npc->rect.left = 0;
  npc->rect.top = 0;
  npc->rect.right = 0;
  npc->rect.bottom = 0;
}

//----- (080C4B00) --------------------------------------------------------
void __cdecl ActNpc004(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  Sint32 *v3;
  Sint32 *v4;
  Sint32 *v5;
  RECT rcUp[8];
  RECT rcLeft[8];
  unsigned __int8 deg;
  char v9[24];

  qmemcpy(rcLeft, &ActNpc004(NPCHAR *)::C.4, sizeof(rcLeft));
  qmemcpy(rcUp, &ActNpc004(NPCHAR *)::C.5, sizeof(rcUp));
  if ( npc->act_no )
  {
    npc->xm = 20 * npc->xm / 21;
    npc->ym = 20 * npc->ym / 21;
    npc->x += npc->xm;
    npc->y += npc->ym;
  }
  else
  {
    if ( !npc->direct || npc->direct == 1 )
    {
      deg = Random(0, 255);
      v1 = GetCos(deg);
      npc->xm = v1 * Random(512, 1535) / 512;
      v2 = GetSin(deg);
      npc->ym = v2 * Random(512, 1535) / 512;
    }
    npc->ani_no = Random(0, 4);
    npc->ani_wait = Random(0, 3);
    npc->act_no = 1;
  }
  if ( ++npc->ani_wait > 4 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no <= 7 )
  {
    if ( npc->direct == 1 )
    {
      v3 = (Sint32 *)&v9[16 * npc->ani_no - 260];
      npc->rect.left = *v3;
      npc->rect.top = v3[1];
      npc->rect.right = v3[2];
      npc->rect.bottom = v3[3];
    }
    if ( !npc->direct )
    {
      v4 = (Sint32 *)&v9[16 * npc->ani_no - 132];
      npc->rect.left = *v4;
      npc->rect.top = v4[1];
      npc->rect.right = v4[2];
      npc->rect.bottom = v4[3];
    }
    if ( npc->direct == 2 )
    {
      v5 = (Sint32 *)&v9[16 * npc->ani_no - 132];
      npc->rect.left = *v5;
      npc->rect.top = v5[1];
      npc->rect.right = v5[2];
      npc->rect.bottom = v5[3];
    }
  }
  else
  {
    npc->cond = 0;
  }
}


//----- (080C4DAF) --------------------------------------------------------
void __cdecl ActNpc005(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  Sint32 *v3;
  RECT rcRight[3];
  RECT rcLeft[3];
  char v6[8];

  rcLeft[0].left = 0;
  rcLeft[0].top = 48;
  rcLeft[0].right = 16;
  rcLeft[0].bottom = 64;
  rcLeft[1].left = 16;
  rcLeft[1].top = 48;
  rcLeft[1].right = 32;
  rcLeft[1].bottom = 64;
  rcLeft[2].left = 32;
  rcLeft[2].top = 48;
  rcLeft[2].right = 48;
  rcLeft[2].bottom = 64;
  rcRight[0].left = 0;
  rcRight[0].top = 64;
  rcRight[0].right = 16;
  rcRight[0].bottom = 80;
  rcRight[1].left = 16;
  rcRight[1].top = 64;
  rcRight[1].right = 32;
  rcRight[1].bottom = 80;
  rcRight[2].left = 32;
  rcRight[2].top = 64;
  rcRight[2].right = 48;
  rcRight[2].bottom = 80;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_9:
    if ( npc->x <= x )
      npc->direct = 2;
    else
      npc->direct = 0;
    if ( npc->act_wait <= 7 || npc->x - 57344 >= x || npc->x + 57344 <= x || npc->y - 40960 >= y || npc->y + 40960 <= y )
    {
      if ( npc->act_wait <= 7 )
        ++npc->act_wait;
      npc->ani_no = 0;
    }
    else
    {
      npc->ani_no = 1;
    }
    if ( npc->shock )
    {
      npc->act_no = 2;
      npc->ani_no = 0;
      npc->act_wait = 0;
    }
    if ( npc->act_wait > 7 && npc->x - 24576 < x && npc->x + 24576 > x && npc->y - 40960 < y && npc->y + 24576 > y )
    {
      npc->act_no = 2;
      npc->ani_no = 0;
      npc->act_wait = 0;
    }
    goto LABEL_35;
  }
  if ( v1 <= 1 )
  {
    if ( v1 )
      goto LABEL_35;
    npc->y += 1536;
    npc->act_no = 1;
    goto LABEL_9;
  }
  if ( v1 == 2 )
  {
    if ( ++npc->act_wait > 8 )
    {
      npc->act_no = 3;
      npc->ani_no = 2;
      npc->ym = -1535;
      PlaySoundObject(30, 1);
      if ( npc->direct )
        npc->xm = 256;
      else
        npc->xm = -256;
    }
  }
  else if ( v1 == 3 && npc->flag & 8 )
  {
    npc->xm = 0;
    npc->act_wait = 0;
    npc->ani_no = 0;
    npc->act_no = 1;
    PlaySoundObject(23, 1);
  }
LABEL_35:
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 96];
  }
  else
  {
    v2 = npc;
    v3 = (Sint32 *)&v6[16 * npc->ani_no - 48];
  }
  npc->rect.left = *v3;
  v2->rect.top = v3[1];
  v2->rect.right = v3[2];
  v2->rect.bottom = v3[3];
}


//----- (080C51A0) --------------------------------------------------------
void __cdecl ActNpc006(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  NPCHAR_0 *v5;
  Sint32 *v6;
  RECT rcRight[5];
  RECT rcLeft[5];
  char v9[12];

  qmemcpy(rcLeft, &ActNpc006(NPCHAR *)::C.6, sizeof(rcLeft));
  qmemcpy(rcRight, &ActNpc006(NPCHAR *)::C.7, sizeof(rcRight));
  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      if ( npc->direct )
        npc->act_no = 3;
      else
        npc->act_no = 1;
      break;
    case 1:
      npc->xm -= 16;
      if ( npc->xm < -1024 )
        npc->xm = -1024;
      if ( npc->shock )
      {
        v1 = npc->x;
        v2 = npc->xm / 2;
      }
      else
      {
        v1 = npc->x;
        v2 = npc->xm;
      }
      npc->x = v2 + v1;
      if ( ++npc->ani_wait > 1 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 2 )
        npc->ani_no = 1;
      if ( npc->flag & 1 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 0;
        npc->xm = 0;
        npc->direct = 2;
      }
      break;
    case 2:
      if ( ++npc->act_wait > 60 )
      {
        npc->act_no = 3;
        npc->ani_wait = 0;
        npc->ani_no = 1;
      }
      break;
    case 3:
      npc->xm += 16;
      if ( npc->xm > 1024 )
        npc->xm = 1024;
      if ( npc->shock )
      {
        v3 = npc->x;
        v4 = npc->xm / 2;
      }
      else
      {
        v3 = npc->x;
        v4 = npc->xm;
      }
      npc->x = v4 + v3;
      if ( ++npc->ani_wait > 1 )
      {
        npc->ani_wait = 0;
        ++npc->ani_no;
      }
      if ( npc->ani_no > 2 )
        npc->ani_no = 1;
      if ( npc->flag & 4 )
      {
        npc->act_no = 4;
        npc->act_wait = 0;
        npc->ani_no = 0;
        npc->xm = 0;
        npc->direct = 0;
      }
      break;
    case 4:
      if ( ++npc->act_wait > 60 )
      {
        npc->act_no = 1;
        npc->ani_wait = 0;
        npc->ani_no = 1;
      }
      break;
    default:
      break;
  }
  if ( npc->direct )
  {
    v5 = npc;
    v6 = (Sint32 *)&v9[16 * npc->ani_no - 160];
  }
  else
  {
    v5 = npc;
    v6 = (Sint32 *)&v9[16 * npc->ani_no - 80];
  }
  npc->rect.left = *v6;
  v5->rect.top = v6[1];
  v5->rect.right = v6[2];
  v5->rect.bottom = v6[3];
}


//----- (080C5500) --------------------------------------------------------
void __cdecl ActNpc007(NPCHAR_0 *npc)
{
  int v1;
  NPCHAR_0 *v2;
  RECT *v3;
  RECT rcRight[3];
  RECT rcLeft[3];

  rcLeft[0].left = 256;
  rcLeft[0].top = 64;
  rcLeft[0].right = 288;
  rcLeft[0].bottom = 80;
  rcLeft[1].left = 256;
  rcLeft[1].top = 80;
  rcLeft[1].right = 288;
  rcLeft[1].bottom = 96;
  rcLeft[2].left = 256;
  rcLeft[2].top = 96;
  rcLeft[2].right = 288;
  rcLeft[2].bottom = 112;
  rcRight[0].left = 288;
  rcRight[0].top = 64;
  rcRight[0].right = 320;
  rcRight[0].bottom = 80;
  rcRight[1].left = 288;
  rcRight[1].top = 80;
  rcRight[1].right = 320;
  rcRight[1].bottom = 96;
  rcRight[2].left = 288;
  rcRight[2].top = 96;
  rcRight[2].right = 320;
  rcRight[2].bottom = 112;
  v1 = npc->act_no;
  switch ( v1 )
  {
    case 1:
      npc->xm -= 64;
      if ( npc->x < x - 98304 )
        npc->act_no = 2;
      if ( npc->flag & 1 )
      {
        npc->xm = 0;
        npc->act_no = 2;
      }
      break;
    case 2:
      npc->xm += 64;
      if ( npc->x > x + 98304 )
        npc->act_no = 1;
      if ( npc->flag & 4 )
      {
        npc->xm = 0;
        npc->act_no = 1;
      }
      break;
    case 0:
      npc->x = x;
      if ( npc->direct )
        npc->act_no = 2;
      else
        npc->act_no = 1;
      break;
  }
  if ( npc->xm >= 0 )
    npc->direct = 2;
  else
    npc->direct = 0;
  if ( npc->xm > 1535 )
    npc->xm = 1535;
  if ( npc->xm < -1535 )
    npc->xm = -1535;
  npc->x += npc->xm;
  if ( ++npc->ani_wait > 1 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 2 )
    npc->ani_no = 0;
  if ( npc->direct )
  {
    v2 = npc;
    v3 = &rcRight[npc->ani_no];
  }
  else
  {
    v2 = npc;
    v3 = &rcLeft[npc->ani_no];
  }
  npc->rect.left = v3->left;
  v2->rect.top = v3->top;
  v2->rect.right = v3->right;
  v2->rect.bottom = v3->bottom;
}

//----- (080C57AF) --------------------------------------------------------
void __cdecl ActNpc008(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  NPCHAR_0 *v6;
  RECT *v7;
  RECT rcRight[2];
  RECT rcLeft[2];

  rcLeft[0].left = 80;
  rcLeft[0].top = 80;
  rcLeft[0].right = 96;
  rcLeft[0].bottom = 96;
  rcLeft[1].left = 96;
  rcLeft[1].top = 80;
  rcLeft[1].right = 112;
  rcLeft[1].bottom = 96;
  rcRight[0].left = 80;
  rcRight[0].top = 96;
  rcRight[0].right = 96;
  rcRight[0].bottom = 112;
  rcRight[1].left = 96;
  rcRight[1].top = 96;
  rcRight[1].right = 112;
  rcRight[1].bottom = 112;
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 == 1 )
    {
      if ( npc->x <= x )
      {
        npc->direct = 2;
        v2 = npc->xm + 16;
      }
      else
      {
        npc->direct = 0;
        v2 = npc->xm - 16;
      }
      npc->xm = v2;
      if ( npc->xm > 767 )
        npc->xm = 767;
      if ( npc->xm < -767 )
        npc->xm = -767;
      if ( npc->y >= npc->tgt_y )
        v3 = npc->ym - 8;
      else
        v3 = npc->ym + 8;
      npc->ym = v3;
      if ( npc->ym > 256 )
        npc->ym = 256;
      if ( npc->ym < -256 )
        npc->ym = -256;
      if ( npc->shock )
      {
        npc->x += npc->xm / 2;
        v4 = npc->y;
        v5 = npc->ym / 2;
      }
      else
      {
        npc->x += npc->xm;
        v4 = npc->y;
        v5 = npc->ym;
      }
      npc->y = v5 + v4;
    }
  }
  else
  {
    if ( x >= npc->x + 0x2000 || x <= npc->x - 0x2000 )
    {
      npc->bits &= 0xFFDFu;
      npc->rect.right = 0;
      npc->damage = 0;
      npc->xm = 0;
      npc->ym = 0;
      return;
    }
    npc->bits |= 0x20u;
    npc->ym = -256;
    npc->tgt_y = npc->y;
    npc->act_no = 1;
    npc->damage = 2;
    if ( npc->direct )
    {
      npc->x = x - 0x20000;
      npc->xm = 767;
    }
    else
    {
      npc->x = x + 0x20000;
      npc->xm = -767;
    }
  }
  if ( ++npc->ani_wait > 1 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 1 )
    npc->ani_no = 0;
  if ( npc->direct )
  {
    v6 = npc;
    v7 = &rcRight[npc->ani_no];
  }
  else
  {
    v6 = npc;
    v7 = &rcLeft[npc->ani_no];
  }
  npc->rect.left = v7->left;
  v6->rect.top = v7->top;
  v6->rect.right = v7->right;
  v6->rect.bottom = v7->bottom;
}

//----- (080C5B29) --------------------------------------------------------
void __cdecl ActNpc009(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  NPCHAR_0 *v8;
  Sint32 *v9;
  RECT rect_right[3];
  RECT rect_left[3];
  int i;
  char v13[24];

  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_5:
    npc->ym += 32;
    if ( npc->count1 > 39 )
    {
      npc->bits &= 0xFFF7u;
      npc->bits |= 1u;
    }
    else
    {
      ++npc->count1;
    }
    if ( npc->flag & 8 )
    {
      for ( i = 0; i <= 3; ++i )
      {
        v2 = Random(-1536, 0);
        v3 = Random(-341, 341);
        v4 = npc->y;
        v5 = (Random(-12, 12) << 9) + v4;
        v6 = npc->x;
        v7 = Random(-12, 12);
        SetNpChar(4, v6 + (v7 << 9), v5, v3, v2, 0, 0, 256);
      }
      npc->act_no = 2;
      npc->ani_no = 1;
      npc->act_wait = 0;
      PlaySoundObject(26, 1);
      SetQuake(30);
    }
    goto LABEL_15;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_15;
    npc->act_no = 1;
    npc->ani_no = 2;
    goto LABEL_5;
  }
  if ( ++npc->act_wait > 16 )
  {
    npc->act_no = 3;
    npc->ani_no = 0;
    npc->ani_wait = 0;
  }
LABEL_15:
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  if ( npc->ym < -1535 )
    npc->ym = -1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  rect_left[0].left = 0;
  rect_left[0].top = 0;
  rect_left[0].right = 40;
  rect_left[0].bottom = 24;
  rect_left[1].left = 80;
  rect_left[1].top = 0;
  rect_left[1].right = 120;
  rect_left[1].bottom = 24;
  rect_left[2].left = 120;
  rect_left[2].top = 0;
  rect_left[2].right = 160;
  rect_left[2].bottom = 24;
  rect_right[0].left = 0;
  rect_right[0].top = 24;
  rect_right[0].right = 40;
  rect_right[0].bottom = 48;
  rect_right[1].left = 80;
  rect_right[1].top = 24;
  rect_right[1].right = 120;
  rect_right[1].bottom = 48;
  rect_right[2].left = 120;
  rect_right[2].top = 24;
  rect_right[2].right = 160;
  rect_right[2].bottom = 48;
  if ( npc->direct )
  {
    v8 = npc;
    v9 = (Sint32 *)&v13[16 * npc->ani_no - 100];
  }
  else
  {
    v8 = npc;
    v9 = (Sint32 *)&v13[16 * npc->ani_no - 52];
  }
  npc->rect.left = *v9;
  v8->rect.top = v9[1];
  v8->rect.right = v9[2];
  v8->rect.bottom = v9[3];
}


//----- (080C5E76) --------------------------------------------------------
void __cdecl ActNpc010(NPCHAR_0 *npc)
{
  NPCHAR_0 *v1;
  Sint32 *v2;
  RECT rect_right[4];
  RECT rect_left[4];
  unsigned __int8 deg;
  int xm;
  int ym;
  char v8[8];

  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      goto LABEL_3;
    case 1:
LABEL_3:
      if ( ++npc->act_wait > 12 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->count1 = 3;
        npc->ani_no = 1;
      }
      break;
    case 2:
      if ( ++npc->act_wait > 16 )
      {
        --npc->count1;
        npc->act_wait = 0;
        deg = GetArktan(npc->x - x, npc->y + 2048 - y);
        deg += Random(-16, 16);
        ym = GetSin(deg);
        xm = GetCos(deg);
        SetNpChar(11, npc->x, npc->y + 2048, xm, ym, 0, 0, 256);
        PlaySoundObject(39, 1);
        if ( !npc->count1 )
        {
          npc->act_no = 3;
          npc->act_wait = 0;
        }
      }
      break;
    case 3:
      if ( ++npc->act_wait > 3 )
      {
        npc->act_no = 4;
        npc->act_wait = 0;
        npc->xm = (x - npc->x) / 100;
        npc->ym = -1536;
        npc->ani_no = 3;
      }
      break;
    case 4:
      if ( npc->flag & 5 )
        npc->xm = 0;
      if ( npc->y + 0x2000 >= y )
        npc->damage = 0;
      else
        npc->damage = 5;
      if ( npc->flag & 8 )
      {
        npc->act_no = 5;
        npc->act_wait = 0;
        npc->ani_no = 2;
        PlaySoundObject(26, 1);
        SetQuake(30);
        npc->damage = 0;
      }
      break;
    case 5:
      npc->xm = 0;
      if ( ++npc->act_wait > 3 )
      {
        npc->act_no = 1;
        npc->act_wait = 0;
      }
      break;
    default:
      break;
  }
  npc->ym += 32;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  rect_left[0].left = 0;
  rect_left[0].top = 0;
  rect_left[0].right = 40;
  rect_left[0].bottom = 24;
  rect_left[1].left = 40;
  rect_left[1].top = 0;
  rect_left[1].right = 80;
  rect_left[1].bottom = 24;
  rect_left[2].left = 80;
  rect_left[2].top = 0;
  rect_left[2].right = 120;
  rect_left[2].bottom = 24;
  rect_left[3].left = 120;
  rect_left[3].top = 0;
  rect_left[3].right = 160;
  rect_left[3].bottom = 24;
  rect_right[0].left = 0;
  rect_right[0].top = 24;
  rect_right[0].right = 40;
  rect_right[0].bottom = 48;
  rect_right[1].left = 40;
  rect_right[1].top = 24;
  rect_right[1].right = 80;
  rect_right[1].bottom = 48;
  rect_right[2].left = 80;
  rect_right[2].top = 24;
  rect_right[2].right = 120;
  rect_right[2].bottom = 48;
  rect_right[3].left = 120;
  rect_right[3].top = 24;
  rect_right[3].right = 160;
  rect_right[3].bottom = 48;
  if ( npc->x >= x )
    npc->direct = 0;
  else
    npc->direct = 2;
  if ( npc->direct )
  {
    v1 = npc;
    v2 = (Sint32 *)&v8[16 * npc->ani_no - 140];
  }
  else
  {
    v1 = npc;
    v2 = (Sint32 *)&v8[16 * npc->ani_no - 76];
  }
  npc->rect.left = *v2;
  v1->rect.top = v2[1];
  v1->rect.right = v2[2];
  v1->rect.bottom = v2[3];
}


//----- (080C6346) --------------------------------------------------------
void __cdecl ActNpc011(NPCHAR_0 *npc)
{
  Sint32 *v1;
  RECT rect_left[3];
  char v3[8];

  if ( npc->flag & 0xFF )
  {
    npc->cond = 0;
    SetCaret(npc->x, npc->y, 2, 0);
  }
  npc->y += npc->ym;
  npc->x += npc->xm;
  rect_left[0].left = 208;
  rect_left[0].top = 104;
  rect_left[0].right = 224;
  rect_left[0].bottom = 120;
  rect_left[1].left = 224;
  rect_left[1].top = 104;
  rect_left[1].right = 240;
  rect_left[1].bottom = 120;
  rect_left[2].left = 240;
  rect_left[2].top = 104;
  rect_left[2].right = 256;
  rect_left[2].bottom = 120;
  if ( ++npc->ani_wait > 1 )
  {
    npc->ani_wait = 0;
    if ( ++npc->ani_no > 2 )
      npc->ani_no = 0;
  }
  v1 = (Sint32 *)&v3[16 * npc->ani_no - 48];
  npc->rect.left = *v1;
  npc->rect.top = v1[1];
  npc->rect.right = v1[2];
  npc->rect.bottom = v1[3];
  if ( ++npc->count1 > 150 )
  {
    SetCaret(npc->x, npc->y, 2, 0);
    npc->cond = 0;
  }
}


//----- (080C64C5) --------------------------------------------------------
void __cdecl ActNpc012(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  int v8;
  bool v9;
  int v10;
  int v11;
  int v12;
  int v13;
  int v14;
  int v15;
  NPCHAR_0 *v16;
  Sint32 *v17;
  RECT rect_right[14];
  RECT rect_left[14];
  int i;
  int x;
  int y;
  char v23[24];

  switch ( npc->act_no )
  {
    case 0:
      if ( npc->direct == 4 )
      {
        if ( npc->x <= ::x )
          npc->direct = 2;
        else
          npc->direct = 0;
      }
      npc->act_no = 1;
      npc->ani_no = 0;
      goto LABEL_7;
    case 1:
LABEL_7:
      if ( Random(0, 100) == 0 )
      {
        npc->act_no = 2;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      break;
    case 2:
      if ( ++npc->act_wait > 16 )
      {
        npc->act_no = 1;
        npc->ani_no = 0;
      }
      break;
    case 0xA:
      if ( npc->direct == 4 )
      {
        if ( npc->x <= ::x )
          npc->direct = 2;
        else
          npc->direct = 0;
      }
      npc->act_no = 11;
      npc->ani_no = 2;
      npc->act_wait = 0;
      npc->tgt_x = 0;
      goto LABEL_16;
    case 0xB:
LABEL_16:
      if ( ++npc->act_wait > 30 )
      {
        npc->act_no = 12;
        npc->act_wait = 0;
        npc->ani_no = 3;
        npc->ym = -2048;
        npc->bits |= 8u;
      }
      break;
    case 0xC:
      if ( npc->flag & 5 )
        npc->xm = 0;
      if ( npc->y < 0 )
      {
        npc->code_char = 0;
        PlaySoundObject(26, 1);
        SetQuake(30);
      }
      break;
    case 0x14:
      if ( npc->direct == 4 )
      {
        if ( npc->x <= ::x )
          npc->direct = 2;
        else
          npc->direct = 0;
      }
      npc->act_no = 21;
      npc->ani_no = 5;
      npc->act_wait = 0;
      npc->count1 = 0;
      for ( i = 0; i <= 3; ++i )
      {
        v1 = Random(-1536, 0);
        v2 = Random(-341, 341);
        v3 = npc->y;
        v4 = (Random(-12, 12) << 9) + v3;
        v5 = npc->x;
        v6 = Random(-12, 12);
        SetNpChar(4, v5 + (v6 << 9), v4, v2, v1, 0, 0, 256);
      }
      PlaySoundObject(72, 1);
      goto LABEL_30;
    case 0x15:
LABEL_30:
      npc->tgt_x = 1;
      if ( npc->flag & 8 )
        ++npc->act_wait;
      if ( ++npc->count1 / 2 & 1 )
        v7 = npc->x + 512;
      else
        v7 = npc->x - 512;
      npc->x = v7;
      if ( npc->act_wait > 100 )
      {
        npc->act_no = 11;
        npc->act_wait = 0;
        npc->ani_no = 2;
      }
      npc->ym += 32;
      if ( npc->ym > 1535 )
        npc->ym = 1535;
      break;
    case 0x1E:
      npc->ani_no = 4;
      if ( ++npc->act_wait > 100 )
      {
        npc->act_no = 0;
        npc->ani_no = 0;
      }
      break;
    case 0x28:
      if ( npc->direct == 4 )
      {
        if ( npc->x <= ::x )
          npc->direct = 2;
        else
          npc->direct = 0;
      }
      npc->act_no = 41;
      npc->act_wait = 0;
      npc->ani_no = 5;
      goto LABEL_46;
    case 0x29:
LABEL_46:
      if ( ++npc->ani_wait / 2 & 1 )
        npc->ani_no = 5;
      else
        npc->ani_no = 6;
      break;
    case 0x2A:
      if ( npc->direct == 4 )
      {
        if ( npc->x <= ::x )
          npc->direct = 2;
        else
          npc->direct = 0;
      }
      npc->act_no = 43;
      npc->act_wait = 0;
      npc->ani_no = 6;
      goto LABEL_54;
    case 0x2B:
LABEL_54:
      if ( ++npc->ani_wait / 2 & 1 )
        npc->ani_no = 7;
      else
        npc->ani_no = 6;
      break;
    case 0x32:
      npc->ani_no = 8;
      npc->xm = 0;
      break;
    case 0x3C:
      npc->act_no = 61;
      npc->ani_no = 9;
      npc->ani_wait = 0;
      goto LABEL_59;
    case 0x3D:
LABEL_59:
      if ( ++npc->ani_wait > 3 )
      {
        npc->ani_wait = 0;
        if ( ++npc->ani_no == 10 || npc->ani_no == 11 )
          PlaySoundObject(23, 1);
      }
      if ( npc->ani_no > 12 )
        npc->ani_no = 9;
      if ( npc->direct )
        npc->xm = 512;
      else
        npc->xm = -512;
      break;
    case 0x46:
      npc->act_no = 71;
      npc->act_wait = 64;
      PlaySoundObject(29, 1);
      npc->ani_no = 13;
      goto LABEL_69;
    case 0x47:
LABEL_69:
      if ( !--npc->act_wait )
        npc->cond = 0;
      break;
    case 0x50:
      npc->count1 = 0;
      npc->act_no = 81;
      goto LABEL_72;
    case 0x51:
LABEL_72:
      if ( ++npc->count1 / 2 & 1 )
        v8 = npc->x + 512;
      else
        v8 = npc->x - 512;
      npc->x = v8;
      npc->ani_no = 5;
      npc->xm = 0;
      npc->ym += 32;
      break;
    case 0x64:
      npc->act_no = 101;
      npc->act_wait = 0;
      npc->ani_no = 2;
      goto LABEL_77;
    case 0x65:
LABEL_77:
      if ( ++npc->act_wait > 20 )
      {
        npc->act_no = 102;
        npc->act_wait = 0;
        npc->ani_no = 3;
        npc->ym = -2048;
        npc->bits |= 8u;
        DeleteNpCharCode(150, 0);
        DeleteNpCharCode(117, 0);
        SetNpChar(355, 0, 0, 0, 0, 0, npc, 256);
        SetNpChar(355, 0, 0, 0, 0, 1, npc, 256);
      }
      break;
    case 0x66:
      x = npc->x / 0x2000;
      y = npc->y / 0x2000;
      if ( y >= 0 && y <= 34 && (unsigned __int8)ChangeMapParts(x, y, 0) )
      {
        ChangeMapParts(x - 1, y, 0);
        ChangeMapParts(x + 1, y, 0);
        PlaySoundObject(44, 1);
        SetQuake2(10);
      }
      if ( npc->y < -16384 )
      {
        npc->code_char = 0;
        SetQuake(30);
      }
      break;
    default:
      break;
  }
  v9 = npc->tgt_x && !Random(0, 10);
  if ( v9 )
  {
    v10 = Random(-1536, 0);
    v11 = Random(-341, 341);
    v12 = npc->y;
    v13 = (Random(-12, 12) << 9) + v12;
    v14 = npc->x;
    v15 = Random(-12, 12);
    SetNpChar(4, v14 + (v15 << 9), v13, v11, v10, 0, 0, 256);
  }
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  qmemcpy(rect_left, &ActNpc012(NPCHAR *)::C.15, sizeof(rect_left));
  qmemcpy(rect_right, &ActNpc012(NPCHAR *)::C.16, sizeof(rect_right));
  if ( npc->direct )
  {
    v16 = npc;
    v17 = (Sint32 *)&v23[16 * npc->ani_no - 460];
  }
  else
  {
    v16 = npc;
    v17 = (Sint32 *)&v23[16 * npc->ani_no - 236];
  }
  npc->rect.left = *v17;
  v16->rect.top = v17[1];
  v16->rect.right = v17[2];
  v16->rect.bottom = v17[3];
  if ( npc->act_no == 71 )
  {
    npc->rect.bottom = npc->act_wait / 2 + npc->rect.top;
    if ( npc->act_wait & 1 )
      ++npc->rect.left;
  }
}


//----- (080C6FE5) --------------------------------------------------------
void __cdecl ActNpc013(NPCHAR_0 *npc)
{
  RECT *v1;
  RECT rect[4];

  rect[0].left = 128;
  rect[0].top = 0;
  rect[0].right = 144;
  rect[0].bottom = 16;
  rect[1].left = 144;
  rect[1].top = 0;
  rect[1].right = 160;
  rect[1].bottom = 16;
  rect[2].left = 160;
  rect[2].top = 0;
  rect[2].right = 176;
  rect[2].bottom = 16;
  rect[3].left = 176;
  rect[3].top = 0;
  rect[3].right = 192;
  rect[3].bottom = 16;
  if ( ++npc->ani_wait > 0 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 3 )
    npc->ani_no = 0;
  v1 = &rect[npc->ani_no];
  npc->rect.left = v1->left;
  npc->rect.top = v1->top;
  npc->rect.right = v1->right;
  npc->rect.bottom = v1->bottom;
}

//----- (080C70CE) --------------------------------------------------------
void __cdecl ActNpc014(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  Sint32 *v7;
  RECT rect[3];
  int i;
  char v10[24];

  rect[0].left = 192;
  rect[0].top = 0;
  rect[0].right = 208;
  rect[0].bottom = 16;
  rect[1].left = 208;
  rect[1].top = 0;
  rect[1].right = 224;
  rect[1].bottom = 16;
  rect[2].left = 224;
  rect[2].top = 0;
  rect[2].right = 240;
  rect[2].bottom = 16;
  if ( !npc->act_no )
  {
    npc->act_no = 1;
    if ( npc->direct == 2 )
    {
      npc->ym = -512;
      for ( i = 0; i <= 3; ++i )
      {
        v1 = Random(-1536, 0);
        v2 = Random(-341, 341);
        v3 = npc->y;
        v4 = (Random(-12, 12) << 9) + v3;
        v5 = npc->x;
        v6 = Random(-12, 12);
        SetNpChar(4, v5 + (v6 << 9), v4, v2, v1, 0, 0, 256);
      }
    }
  }
  if ( ++npc->ani_wait > 1 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 2 )
    npc->ani_no = 0;
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->y += npc->ym;
  v7 = (Sint32 *)&v10[16 * npc->ani_no - 52];
  npc->rect.left = *v7;
  npc->rect.top = v7[1];
  npc->rect.right = v7[2];
  npc->rect.bottom = v7[3];
}


//----- (080C72D3) --------------------------------------------------------
void __cdecl ActNpc015(NPCHAR_0 *npc)
{
  int v1;
  unsigned __int16 v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int v7;
  int v8;
  Sint32 *v9;
  RECT rcLeft[3];
  int i;
  char v12[24];

  rcLeft[0].left = 240;
  rcLeft[0].top = 0;
  rcLeft[0].right = 256;
  rcLeft[0].bottom = 16;
  rcLeft[1].left = 256;
  rcLeft[1].top = 0;
  rcLeft[1].right = 272;
  rcLeft[1].bottom = 16;
  rcLeft[2].left = 272;
  rcLeft[2].top = 0;
  rcLeft[2].right = 288;
  rcLeft[2].bottom = 16;
  v1 = npc->act_no;
  if ( v1 == 1 )
  {
LABEL_8:
    npc->ani_no = 0;
    if ( Random(0, 30) == 0 )
      npc->act_no = 2;
    goto LABEL_14;
  }
  if ( v1 != 2 )
  {
    if ( v1 )
      goto LABEL_14;
    npc->act_no = 1;
    v2 = npc->bits;
    HIBYTE(v2) |= 0x20u;
    npc->bits = v2;
    if ( npc->direct == 2 )
    {
      npc->ym = -512;
      for ( i = 0; i <= 3; ++i )
      {
        v3 = Random(-1536, 0);
        v4 = Random(-341, 341);
        v5 = npc->y;
        v6 = (Random(-12, 12) << 9) + v5;
        v7 = npc->x;
        v8 = Random(-12, 12);
        SetNpChar(4, v7 + (v8 << 9), v6, v4, v3, 0, 0, 256);
      }
    }
    goto LABEL_8;
  }
  if ( ++npc->ani_wait > 1 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 2 )
  {
    npc->act_no = 1;
    npc->ani_no = 0;
  }
LABEL_14:
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->y += npc->ym;
  v9 = (Sint32 *)&v12[16 * npc->ani_no - 52];
  npc->rect.left = *v9;
  npc->rect.top = v9[1];
  npc->rect.right = v9[2];
  npc->rect.bottom = v9[3];
}


//----- (080C753D) --------------------------------------------------------
void __cdecl ActNpc016(NPCHAR_0 *npc)
{
  int v1;
  unsigned __int16 v2;
  unsigned __int16 v3;
  int v4;
  int v5;
  int v6;
  int v7;
  int v8;
  int v9;
  unsigned __int16 v10;
  Sint32 *v11;
  RECT rect[8];
  int i;
  char v14[24];

  qmemcpy(rect, &ActNpc016(NPCHAR *)::C.18, sizeof(rect));
  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_10;
  }
  else
  {
    v2 = npc->bits;
    HIBYTE(v2) |= 0x20u;
    npc->bits = v2;
    npc->act_no = 1;
    if ( npc->direct == 2 )
    {
      v3 = npc->bits;
      HIBYTE(v3) &= 0xDFu;
      npc->bits = v3;
      npc->ym = -512;
      for ( i = 0; i <= 3; ++i )
      {
        v4 = Random(-1536, 0);
        v5 = Random(-341, 341);
        v6 = npc->y;
        v7 = (Random(-12, 12) << 9) + v6;
        v8 = npc->x;
        v9 = Random(-12, 12);
        SetNpChar(4, v8 + (v9 << 9), v7, v5, v4, 0, 0, 256);
      }
    }
  }
  if ( npc->flag & 8 )
  {
    v10 = npc->bits;
    HIBYTE(v10) |= 0x20u;
    npc->bits = v10;
  }
LABEL_10:
  if ( ++npc->ani_wait > 2 )
  {
    npc->ani_wait = 0;
    ++npc->ani_no;
  }
  if ( npc->ani_no > 7 )
    npc->ani_no = 0;
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->y += npc->ym;
  v11 = (Sint32 *)&v14[16 * npc->ani_no - 132];
  npc->rect.left = *v11;
  npc->rect.top = v11[1];
  npc->rect.right = v11[2];
  npc->rect.bottom = v11[3];
}


//----- (080C7765) --------------------------------------------------------
void __cdecl ActNpc017(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  int a;
  int aa;

  switch ( npc->act_no )
  {
    case 0:
      npc->act_no = 1;
      if ( npc->direct == 2 )
      {
        npc->ym = -512;
        for ( a = 0; a <= 3; ++a )
        {
          v1 = Random(-1536, 0);
          v2 = Random(-341, 341);
          v3 = npc->y;
          v4 = (Random(-12, 12) << 9) + v3;
          v5 = npc->x;
          v6 = Random(-12, 12);
          SetNpChar(4, v5 + (v6 << 9), v4, v2, v1, 0, 0, 256);
        }
      }
      goto LABEL_6;
    case 1:
LABEL_6:
      aa = Random(0, 30);
      if ( aa > 9 )
      {
        if ( aa > 24 )
          npc->act_no = 4;
        else
          npc->act_no = 3;
      }
      else
      {
        npc->act_no = 2;
      }
      npc->act_wait = Random(16, 64);
      npc->ani_wait = 0;
      break;
    case 2:
      npc->rect.left = 288;
      npc->rect.top = 0;
      npc->rect.right = 304;
      npc->rect.bottom = 16;
      if ( !--npc->act_wait )
        npc->act_no = 1;
      break;
    case 3:
      ++npc->ani_wait;
      if ( npc->ani_wait & 1 )
      {
        npc->rect.left = 288;
        npc->rect.top = 0;
        npc->rect.right = 304;
      }
      else
      {
        npc->rect.left = 304;
        npc->rect.top = 0;
        npc->rect.right = 320;
      }
      npc->rect.bottom = 16;
      if ( !--npc->act_wait )
        npc->act_no = 1;
      break;
    case 4:
      npc->rect.left = 304;
      npc->rect.top = 0;
      npc->rect.right = 320;
      npc->rect.bottom = 16;
      if ( !--npc->act_wait )
        npc->act_no = 1;
      break;
    default:
      break;
  }
  npc->ym += 64;
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  npc->y += npc->ym;
}

//----- (080C7A56) --------------------------------------------------------
void __cdecl ActNpc018(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int i;

  v1 = npc->act_no;
  if ( v1 )
  {
    if ( v1 == 1 )
    {
      for ( i = 0; i <= 3; ++i )
      {
        v2 = Random(-1536, 0);
        v3 = Random(-341, 341);
        SetNpChar(4, npc->x, npc->y, v3, v2, 0, 0, 256);
      }
      npc->act_no = 0;
      npc->rect.left = 224;
      npc->rect.top = 16;
      npc->rect.right = 240;
      npc->rect.bottom = 40;
    }
  }
  else if ( npc->direct )
  {
    npc->rect.left = 192;
    npc->rect.top = 112;
    npc->rect.right = 208;
    npc->rect.bottom = 136;
  }
  else
  {
    npc->rect.left = 224;
    npc->rect.top = 16;
    npc->rect.right = 240;
    npc->rect.bottom = 40;
  }
}

//----- (080C7BA0) --------------------------------------------------------
void __cdecl ActNpc019(NPCHAR_0 *npc)
{
  int v1;
  int v2;
  int v3;
  int v4;
  int v5;
  int v6;
  NPCHAR_0 *v7;
  Sint32 *v8;
  RECT rect_right[4];
  RECT rect_left[4];
  int i;
  char v12[24];

  switch ( npc->act_no )
  {
    case 0:
      for ( i = 0; i <= 15; ++i )
      {
        v1 = Random(-1536, 0);
        v2 = Random(-341, 341);
        v3 = npc->y;
        v4 = (Random(-12, 12) << 9) + v3;
        v5 = npc->x;
        v6 = Random(-12, 12);
        SetNpChar(4, v5 + (v6 << 9), v4, v2, v1, 0, 0, 256);
      }
      npc->y += 5120;
      npc->act_no = 1;
      npc->ani_no = 3;
      npc->ym = -256;
      PlaySoundObject(12, 1);
      PlaySoundObject(26, 1);
      SetQuake(30);
      goto LABEL_6;
    case 1:
LABEL_6:
      npc->ym += 16;
      if ( npc->ym > 0 && npc->flag & 8 )
      {
        npc->act_no = 2;
        npc->ani_no = 2;
        npc->act_wait = 0;
        PlaySoundObject(26, 1);
        SetQuake(30);
      }
      break;
    case 2:
      if ( ++npc->act_wait > 16 )
      {
        npc->act_no = 3;
        npc->ani_no = 0;
        npc->ani_wait = 0;
      }
      break;
    case 3:
      if ( Random(0, 100) == 0 )
      {
        npc->act_no = 4;
        npc->act_wait = 0;
        npc->ani_no = 1;
      }
      break;
    case 4:
      if ( ++npc->act_wait > 16 )
      {
        npc->act_no = 3;
        npc->ani_no = 0;
      }
      break;
    default:
      break;
  }
  if ( npc->ym > 1535 )
    npc->ym = 1535;
  if ( npc->ym < -1535 )
    npc->ym = -1535;
  npc->x += npc->xm;
  npc->y += npc->ym;
  rect_left[0].left = 0;
  rect_left[0].top = 0;
  rect_left[0].right = 40;
  rect_left[0].bottom = 24;
  rect_left[1].left = 160;
  rect_left[1].top = 0;
  rect_left[1].right = 200;
  rect_left[1].bottom = 24;
  rect_left[2].left = 80;
  rect_left[2].top = 0;
  rect_left[2].right = 120;
  rect_left[2].bottom = 24;
  rect_left[3].left = 120;
  rect_left[3].top = 0;
  rect_left[3].right = 160;
  rect_left[3].bottom = 24;
  rect_right[0].left = 0;
  rect_right[0].top = 24;
  rect_right[0].right = 40;
  rect_right[0].bottom = 48;
  rect_right[1].left = 160;
  rect_right[1].top = 24;
  rect_right[1].right = 200;
  rect_right[1].bottom = 48;
  rect_right[2].left = 80;
  rect_right[2].top = 24;
  rect_right[2].right = 120;
  rect_right[2].bottom = 48;
  rect_right[3].left = 120;
  rect_right[3].top = 24;
  rect_right[3].right = 160;
  rect_right[3].bottom = 48;
  if ( npc->direct )
  {
    v7 = npc;
    v8 = (Sint32 *)&v12[16 * npc->ani_no - 132];
  }
  else
  {
    v7 = npc;
    v8 = (Sint32 *)&v12[16 * npc->ani_no - 68];
  }
  npc->rect.left = *v8;
  v7->rect.top = v8[1];
  v7->rect.right = v8[2];
  v7->rect.bottom = v8[3];
}


//----- (080C7FE0) --------------------------------------------------------
void _libc_csu_fini(void)
{
  ;
}

//----- (080C7FF0) --------------------------------------------------------
void __cdecl _libc_csu_init(int a1, int a2, int a3)
{
  init_proc();
}

//----- (080C8050) --------------------------------------------------------
void (*_do_global_ctors_aux())(void)
{
  void (*result)(void);
  void (**v1)(void);

  result = (void (*)(void))_CTOR_LIST__;
  if ( _CTOR_LIST__ != -1 )
  {
    v1 = (void (**)(void))&_CTOR_LIST__;
    do
    {
      --v1;
      result();
      result = *v1;
    }
    while ( *v1 != (void (*)(void))-1 );
  }
  return result;
}


void term_proc()
{
  _do_global_dtors_aux();
}

#error "There were 1 decompilation failure(s) on 864 function(s)"
